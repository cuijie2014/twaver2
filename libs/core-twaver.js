+function(){function a(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function b(){return new a(null)}function c(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function d(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function e(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function f(a){return bc.charAt(a)}function g(a,b){var c=cc[a.charCodeAt(b)];return null==c?-1:c}function h(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function j(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+DV:this.t=0}function k(a){var c=b();return c.fromInt(a),c}function l(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else{if(4!=c)return void this.fromRadix(b,c);d=2}this.t=0,this.s=0;for(var e=b.length,f=!1,h=0;--e>=0;){var i=8==d?255&b[e]:g(b,e);0>i?"-"==b.charAt(e)&&(f=!0):(f=!1,0==h?this[this.t++]=i:h+d>this.DB?(this[this.t-1]|=(i&(1<<this.DB-h)-1)<<h,this[this.t++]=i>>this.DB-h):this[this.t-1]|=i<<h,h+=d,h>=this.DB&&(h-=this.DB))}8==d&&0!=(128&b[0])&&(this.s=-1,h>0&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),f&&a.ZERO.subTo(this,this)}function m(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function n(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,g="",h=this.t,i=this.DB-h*this.DB%b;if(h-->0)for(i<this.DB&&(c=this[h]>>i)>0&&(e=!0,g=f(c));h>=0;)b>i?(c=(this[h]&(1<<i)-1)<<b-i,c|=this[--h]>>(i+=this.DB-b)):(c=this[h]>>(i-=b)&d,0>=i&&(i+=this.DB,--h)),c>0&&(e=!0),e&&(g+=f(c));return e?g:"0"}function o(){var c=b();return a.ZERO.subTo(this,c),c}function p(){return this.s<0?this.negate():this}function q(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function r(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function s(){return this.t<=0?0:this.DB*(this.t-1)+r(this[this.t-1]^this.s&this.DM)}function t(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function u(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function v(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function w(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function x(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function y(b,c){var d=this.abs(),e=b.abs(),f=d.t;for(c.t=f+e.t;--f>=0;)c[f]=0;for(f=0;f<e.t;++f)c[f+d.t]=d.am(0,e[f],c,f,0,d.t);c.s=0,c.clamp(),this.s!=b.s&&a.ZERO.subTo(c,c)}function z(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function A(c,d,e){var f=c.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=d&&d.fromInt(0),void(null!=e&&this.copyTo(e));null==e&&(e=b());var h=b(),i=this.s,j=c.s,k=this.DB-r(f[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,e)):(f.copyTo(h),g.copyTo(e));var l=h.t,m=h[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,q=1<<this.F2,s=e.t,t=s-l,u=null==d?b():d;for(h.dlShiftTo(t,u),e.compareTo(u)>=0&&(e[e.t++]=1,e.subTo(u,e)),a.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h[h.t++]=0;for(;--t>=0;){var v=e[--s]==m?this.DM:Math.floor(e[s]*o+(e[s-1]+q)*p);if((e[s]+=h.am(0,v,e,t,0,l))<v)for(h.dlShiftTo(t,u),e.subTo(u,e);e[s]<--v;)e.subTo(u,e)}null!=d&&(e.drShiftTo(l,d),i!=j&&a.ZERO.subTo(d,d)),e.t=l,e.clamp(),k>0&&e.rShiftTo(k,e),0>i&&a.ZERO.subTo(e,e)}}}function B(c){var d=b();return this.abs().divRemTo(c,null,d),this.s<0&&d.compareTo(a.ZERO)>0&&c.subTo(d,d),d}function C(a){this.m=a}function D(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function E(a){return a}function F(a){a.divRemTo(this.m,null,a)}function G(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function H(a,b){a.squareTo(b),this.reduce(b)}function I(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function J(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function K(c){var d=b();return c.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),c.s<0&&d.compareTo(a.ZERO)>0&&this.m.subTo(d,d),d}function L(a){var c=b();return a.copyTo(c),this.reduce(c),c}function M(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function N(a,b){a.squareTo(b),this.reduce(b)}function O(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function P(){return 0==(this.t>0?1&this[0]:this.s)}function Q(c,d){if(c>4294967295||1>c)return a.ONE;var e=b(),f=b(),g=d.convert(this),h=r(c)-1;for(g.copyTo(e);--h>=0;)if(d.sqrTo(e,f),(c&1<<h)>0)d.mulTo(f,g,e);else{var i=e;e=f,f=i}return d.revert(e)}function R(a,b){var c;return c=256>a||b.isEven()?new C(b):new J(b),this.exp(a,c)}function S(){var a=b();return this.copyTo(a),a}function T(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function U(){return 0==this.t?this.s:this[0]<<24>>24}function V(){return 0==this.t?this.s:this[0]<<16>>16}function W(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function X(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function Y(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var c=this.chunkSize(a),d=Math.pow(a,c),e=k(d),f=b(),g=b(),h="";for(this.divRemTo(e,f,g);f.signum()>0;)h=(d+g.intValue()).toString(a).substr(1)+h,f.divRemTo(e,f,g);return g.intValue().toString(a)+h}function Z(b,c){this.fromInt(0),null==c&&(c=10);for(var d=this.chunkSize(c),e=Math.pow(c,d),f=!1,h=0,i=0,j=0;j<b.length;++j){var k=g(b,j);0>k?"-"==b.charAt(j)&&0==this.signum()&&(f=!0):(i=c*i+k,++h>=d&&(this.dMultiply(e),this.dAddOffset(i,0),h=0,i=0))}h>0&&(this.dMultiply(Math.pow(c,h)),this.dAddOffset(i,0)),f&&a.ZERO.subTo(this,this)}function $(b,c,d){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,d),this.testBit(b-1)||this.bitwiseTo(a.ONE.shiftLeft(b-1),ga,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(a.ONE.shiftLeft(b-1),this);else{var e=new Array,f=7&b;e.length=(b>>3)+1,c.nextBytes(e),f>0?e[0]&=(1<<f)-1:e[0]=0,this.fromString(e,256)}}function _(){var a=this.t,b=new Array;b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-->0)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b}function aa(a){return 0==this.compareTo(a)}function ba(a){return this.compareTo(a)<0?this:a}function ca(a){return this.compareTo(a)>0?this:a}function da(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function ea(a,b){return a&b}function fa(a){var c=b();return this.bitwiseTo(a,ea,c),c}function ga(a,b){return a|b}function ha(a){var c=b();return this.bitwiseTo(a,ga,c),c}function ia(a,b){return a^b}function ja(a){var c=b();return this.bitwiseTo(a,ia,c),c}function ka(a,b){return a&~b}function la(a){var c=b();return this.bitwiseTo(a,ka,c),c}function ma(){for(var a=b(),c=0;c<this.t;++c)a[c]=this.DM&~this[c];return a.t=this.t,a.s=~this.s,a}function na(a){var c=b();return 0>a?this.rShiftTo(-a,c):this.lShiftTo(a,c),c}function oa(a){var c=b();return 0>a?this.lShiftTo(-a,c):this.rShiftTo(a,c),c}function pa(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function qa(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+pa(this[a]);return this.s<0?this.t*this.DB:-1}function ra(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function sa(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=ra(this[c]^b);return a}function ta(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)}function ua(b,c){var d=a.ONE.shiftLeft(b);return this.bitwiseTo(d,c,d),d}function va(a){return this.changeBit(a,ga)}function wa(a){return this.changeBit(a,ka)}function xa(a){return this.changeBit(a,ia)}function ya(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b[c++]=d:-1>d&&(b[c++]=this.DV+d),b.t=c,b.clamp()}function za(a){var c=b();return this.addTo(a,c),c}function Aa(a){var c=b();return this.subTo(a,c),c}function Ba(a){var c=b();return this.multiplyTo(a,c),c}function Ca(){var a=b();return this.squareTo(a),a}function Da(a){var c=b();return this.divRemTo(a,c,null),c}function Ea(a){var c=b();return this.divRemTo(a,null,c),c}function Fa(a){var c=b(),d=b();return this.divRemTo(a,c,d),new Array(c,d)}function Ga(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Ha(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}}function Ia(){}function Ja(a){return a}function Ka(a,b,c){a.multiplyTo(b,c)}function La(a,b){a.squareTo(b)}function Ma(a){return this.exp(a,new Ia)}function Na(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()}function Oa(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function Pa(c){this.r2=b(),this.q3=b(),a.ONE.dlShiftTo(2*c.t,this.r2),this.mu=this.r2.divide(c),this.m=c}function Qa(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var c=b();return a.copyTo(c),this.reduce(c),c}function Ra(a){return a}function Sa(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function Ta(a,b){a.squareTo(b),this.reduce(b)}function Ua(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function Va(a,c){var d,e,f=a.bitLength(),g=k(1);if(0>=f)return g;d=18>f?1:48>f?3:144>f?4:768>f?5:6,e=8>f?new C(c):c.isEven()?new Pa(c):new J(c);var h=new Array,i=3,j=d-1,l=(1<<d)-1;if(h[1]=e.convert(this),d>1){var m=b();for(e.sqrTo(h[1],m);l>=i;)h[i]=b(),e.mulTo(m,h[i-2],h[i]),i+=2}var n,o,p=a.t-1,q=!0,s=b();for(f=r(a[p])-1;p>=0;){for(f>=j?n=a[p]>>f-j&l:(n=(a[p]&(1<<f+1)-1)<<j-f,p>0&&(n|=a[p-1]>>this.DB+f-j)),i=d;0==(1&n);)n>>=1,--i;if((f-=i)<0&&(f+=this.DB,--p),q)h[n].copyTo(g),q=!1;else{for(;i>1;)e.sqrTo(g,s),e.sqrTo(s,g),i-=2;i>0?e.sqrTo(g,s):(o=g,g=s,s=o),e.mulTo(s,h[n],g)}for(;p>=0&&0==(a[p]&1<<f);)e.sqrTo(g,s),o=g,g=s,s=o,--f<0&&(f=this.DB-1,--p)}return e.revert(g)}function Wa(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return b;for(f>e&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function Xa(a){if(0>=a)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c}function Ya(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return a.ZERO;for(var d=b.clone(),e=this.clone(),f=k(1),g=k(0),h=k(0),i=k(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&g.isEven()||(f.addTo(this,f),g.subTo(b,g)),f.rShiftTo(1,f)):g.isEven()||g.subTo(b,g),g.rShiftTo(1,g);for(;e.isEven();)e.rShiftTo(1,e),c?(h.isEven()&&i.isEven()||(h.addTo(this,h),i.subTo(b,i)),h.rShiftTo(1,h)):i.isEven()||i.subTo(b,i),i.rShiftTo(1,i);d.compareTo(e)>=0?(d.subTo(e,d),c&&f.subTo(h,f),g.subTo(i,g)):(e.subTo(d,e),c&&h.subTo(f,h),i.subTo(g,i))}return 0!=e.compareTo(a.ONE)?a.ZERO:i.compareTo(b)>=0?i.subtract(b):i.signum()<0?(i.addTo(b,i),i.signum()<0?i.add(b):i):i}function Za(a){var b,c=this.abs();if(1==c.t&&c[0]<=dc[dc.length-1]){for(b=0;b<dc.length;++b)if(c[0]==dc[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<dc.length;){for(var d=dc[b],e=b+1;e<dc.length&&ec>d;)d*=dc[e++];for(d=c.modInt(d);e>b;)if(d%dc[b++]==0)return!1}return c.millerRabin(a)}function $a(c){var d=this.subtract(a.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var f=d.shiftRight(e);c=c+1>>1,c>dc.length&&(c=dc.length);for(var g=b(),h=0;c>h;++h){g.fromInt(dc[Math.floor(Gb.Util.random()*dc.length)]);var i=g.modPow(f,this);if(0!=i.compareTo(a.ONE)&&0!=i.compareTo(d)){for(var j=1;j++<e&&0!=i.compareTo(d);)if(i=i.modPowInt(2,this),0==i.compareTo(a.ONE))return!1;if(0!=i.compareTo(d))return!1}}return!0}function _a(){this.i=0,this.j=0,this.S=new Array}function ab(a){var b,c,d;for(b=0;256>b;++b)this.S[b]=b;for(c=0,b=0;256>b;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function bb(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function cb(){return new _a}function db(a){gc[hc++]^=255&a,gc[hc++]^=a>>8&255,gc[hc++]^=a>>16&255,gc[hc++]^=a>>24&255,hc>=ic&&(hc-=ic)}function eb(){db((new Date).getTime())}function fb(){if(null==fc){for(eb(),fc=cb(),fc.init(gc),hc=0;hc<gc.length;++hc)gc[hc]=0;hc=0}return fc.next()}function gb(a){var b;for(b=0;b<a.length;++b)a[b]=fb()}function hb(){}function ib(b,c){return new a(b,c)}function jb(b,c){if(c<b.length+11)return null;for(var d=new Array,e=b.length-1;e>=0&&c>0;){var f=b.charCodeAt(e--);128>f?d[--c]=f:f>127&&2048>f?(d[--c]=63&f|128,d[--c]=f>>6|192):(d[--c]=63&f|128,d[--c]=f>>6&63|128,d[--c]=f>>12|224)}d[--c]=0;for(var g=new hb,h=new Array;c>2;){for(h[0]=0;0==h[0];)g.nextBytes(h);d[--c]=h[0]}return d[--c]=2,d[--c]=0,new a(d)}function kb(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function lb(a,b){this.n=ib(a,16),this.e=parseInt(b,16)}function mb(a){return a.modPowInt(this.e,this.n)}function nb(a){var b=jb(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPrivate(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function ob(a,b){for(var c=a.toByteArray(),d=0;d<c.length&&0==c[d];)++d;if(c.length-d!=b-1||2!=c[d])return null;for(++d;0!=c[d];)if(++d>=c.length)return null;for(var e="";++d<c.length;){var f=255&c[d];128>f?e+=String.fromCharCode(f):f>191&&224>f?(e+=String.fromCharCode((31&f)<<6|63&c[d+1]),++d):(e+=String.fromCharCode((15&f)<<12|(63&c[d+1])<<6|63&c[d+2]),d+=2)}return e}function pb(a,b,c){this.n=ib(a,16),this.e=parseInt(b,16),this.d=ib(c,16)}function qb(a,b,c,d,e,f,g,h){this.n=ib(a,16),this.e=parseInt(b,16),this.d=ib(c,16),this.p=ib(d,16),this.q=ib(e,16),this.dmp1=ib(f,16),this.dmq1=ib(g,16),this.coeff=ib(h,16)}function rb(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);for(var b=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);b.compareTo(c)<0;)b=b.add(this.p);return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)}function sb(a){var b=ib(a,16),c=this.doPublic(b);return null==c?null:ob(c,this.n.bitLength()+7>>3)}function tb(a,b,c){var d=0,e=0,f=b.split("\n"),g=2*a.measureText("e").width;return f.forEach(function(b){if(c){var f,h,i,j,k,l=b.split(" "),m=l.length,n="";for(i=0;m>i;i++)if(f=l[i]+(i===m-1?"":" "),h=n+f,j=a.measureText(h).width,c>j)n=h;else if(j==c)n="",e+=g;else{for(k=0;k<f.length;k++)if(h=n+f.substr(0,k+1),a.measureText(h).width>c){n=f.substring(k,f.length),e+=g;break}for(;n.length>0&&a.measureText(n).width>c;)for(k=0;k<n.length;k++)if(h=n.substr(0,k+1),a.measureText(h).width>c){n=n.substring(k,n.length),e+=g;break}}}else j=a.measureText(b).width,d=j>d?j:d;e+=g}),d=c?c:d,{w:d,h:e}}function ub(a,b,c,d){var e,f=a.animate,g=d._now,h=d._shapeDataIndex,i=c._animates;if(i||(i=c._animates={}),h.length)for(var j=0;j<h.length;j++){e=h[j];var k=i[e];k||(k=i[e]={}),i=k}else e=h;var l=i[e];l||(l=i[e]={},f.forEach(function(e){var f,h=e.attr,i=l[h];e={attr:h,to:e.to,type:e.type||"number",delay:e.delay||0,dur:e.dur||1e3,interval:e.interval||0,finish:e.finish,repeat:e.repeat||1,reverse:null==e.reverse?!0:e.reverse,onDone:e.onDone,easing:e.easing,trigger:null==e.to,start:g,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(e.dur)&&(e.groupDur=e.dur.slice(0,e.dur.length-1),e.dur=e.dur[e.dur.length-1],e.groupDurTotal=e.groupDur.reduce(function(a,b,c){return e.groupDur[c]=a+b},0),e.groupIndex=0,e.groupTime=0,e.groupStart=g),null==e.finish&&(e.finish=e.delay+e.dur+e.interval),i?Array.isArray(i)?(i.push(e),i=i[i.length-2]):l[h]=[i,e]:(f=Xc(c,b,a,h,d),l[h]=e),i&&(f=i.to,"group_set"===i.type&&(f=f[f.length-1])),e.from=f,e.trigger||(e.started=!0,Db(e),Eb(e))})),f=l,Object.keys(f).forEach(function(e){var h=f[e];if(Array.isArray(h)){var i=h[h.length-1];i.count+1===i.repeat?h.forEach(function(e){vb(e,a,b,c,d,!0)}):i.count+1<i.repeat&&(i.total>=i.finish&&h.forEach(function(a){a.trigger||(a.started=!0),a.stopped=!1,a.time=0,a.start=g,a.total=0,"group_set"===a.type&&(a.groupIndex=0,a.groupTime=0,a.groupStart=g)}),h.forEach(function(e){vb(e,a,b,c,d,!1)}))}else vb(h,a,b,c,d,!0)})}function vb(a,b,c,d,e,f){if(a.trigger){var g=Xc(d,c,b,a.attr,e,null,!1);if(!a.started){if(g===a.from)return;a.started=!0,a.start=e._now,a.to=g,Db(a),Eb(a)}a.started&&g!==a.to&&(a.start=e._now,a.from=a.current,a.to=g,a.time=0,a.total=0,a.count=0,Db(a),Eb(a))}if(a.started&&!a.stopped){var h=e._now,i=h-a.start;if(i>=a.delay&&(a.total=i,i-=a.delay,a.time=i>a.dur?a.dur:i,"group_set"===a.type&&(a.groupTime=h-a.groupStart,a.groupStart===a.start&&(a.groupTime-=a.delay),a.groupTime>=a.groupDur[a.groupIndex]&&a.groupIndex++,a.groupTime>=a.groupDurTotal&&(a.groupIndex=0,a.groupTime=a.groupTime-a.groupDurTotal,a.groupStart=h)),a.total>=a.finish))if(a.count++,"group_set"===a.type,a.count>=a.repeat)a.time=a.dur,a.stopped=!0,a.trigger&&(a.from=a.to,a.to=null,a.start=null,a.time=0,a.total=0,a.count=0,a.started=!1,a.stopped=!1),a.onDone&&a.onDone.call(c,d,e);else if(f&&(a.time=0,a.start=h,a.total=0,a.reverse)){var j=a.from;a.from=a.to,a.to=j,Eb(a)}e&&!e._invalidate&&(e._invalidate=!0)}}function wb(a){if(!gd[a.id]){if(id=!0,gd[a.id]=a,null==a.from&&a.attr&&a.source){var b;a.from=(b=a.attr.match(/^S[:@](.*)/i))?a.source.getStyle(b[1]):(b=a.attr.match(/^C[:@](.*)/i))?a.source.getClient(b[1]):Gb.Util.getValue(a.source,a.attr)}Db(a),Eb(a)}return a.resume(),a}function xb(a,b){return gd[a.id]&&(null==b&&(b=!0),b&&Cb(a,a.to),a.onStop&&a.onStop(),a.time=0,a.total=0,a.start=null,a.count=0,a.started=!1,a.stopped=!1,a.paused=!1,a.pausedTime=null,a.pausedTotal=0,a._oldSpeed=null,a._speedTotal=0,a._speedTime=null,a._percent=0,a._percentSet=null,a._percentDiff=0,delete gd[a.id]),a}function yb(a){null==a&&(a=!0),Object.keys(gd).forEach(function(b){var c=gd[b];c&&(a&&Cb(c,c.to),c.onStop&&c.onStop())}),gd={}}function zb(){Object.keys(gd).forEach(function(a){var b=gd[a];b&&b.pause()})}function Ab(){Object.keys(gd).forEach(function(a){var b=gd[a];b&&b.resume()})}function Bb(a){Object.keys(gd).forEach(function(b){var c=gd[b];if(c&&(null==c.start&&(c._speedTime=c.start=a),null!=c._percentSet&&(c._percentDiff+=(c._percentSet-c._percent)*c.finish),!c.paused||(c.pausedTime||(c.pausedTime=a),null!=c._percentSet))){if(null==c._percentSet&&c.pausedTime&&(c.pausedTotal+=(a-c.pausedTime)*(c._oldSpeed||c._speed),c.pausedTime=null),c._oldSpeed&&!c.pausedTime&&(c._speedTotal=(a-c._speedTime)*c._oldSpeed-c.pausedTotal+c._percentDiff+c._speedTotal,c._percentDiff=0,c.pausedTotal=0,c._speedTime=a,c._oldSpeed=null),c.total=(a-c._speedTime)*c._speed-c.pausedTotal+c._percentDiff+c._speedTotal,null!=c._percentSet&&c.pausedTime&&(c.total-=(a-c.pausedTime)*(c._oldSpeed||c._speed)),c._percent=c.total>=c.finish?1:c.total/c.finish,c.total>c.delay){c.time=c.total-c.delay;var d=!1;if(c.time>=c.dur&&(c.time=c.dur,c.total>=c.finish&&(d=!0)),!c.stopped&&Cb(c,Fb(c)),c.stopped=d,c.total>=c.finish)if(c.count++,c.count>=c.repeat)xb(c,!1),c.onDone&&c.onDone();else if(c.time=0,c.total=0,c.start=null,c.stopped=!1,c.reverse){var e=c.from;c.from=c.to,c.to=e,Eb(c)}}c.paused||!id&&(id=!0),null!=c._percentSet&&(c._percentSet=null)}})}function Cb(a,b){if(a.started||(a.started=!0,a.onPlay&&a.onPlay()),a.filter&&(b=a.filter(b)),a.attr&&a.source){var c;(c=a.attr.match(/^S[:@](.*)/i))?a.source.setStyle(c[1],b):(c=a.attr.match(/^C[:@](.*)/i))?a.source.setClient(c[1],b):Gb.Util.setValue(a.source,a.attr,b)}a.onUpdate&&a.onUpdate(b)}function Db(a){var b=a.type,c=a.from,d=a.to;"number"===b?(a.from=c||0,a.to=d||0):"point"===b?(c?c.length&&(a.from={x:c[0],y:c[1]}):a.from="scale"===a.attr?{x:1,y:1}:{x:0,y:0},d?d.length&&(a.to={x:d[0],y:d[1]}):a.to="scale"===a.attr?{x:1,y:1}:{x:0,y:0}):"rect"===b?(c?c.length&&(a.from={x:c[0],y:c[1],w:c[2],h:c[3]}):a.from={x:0,y:0,w:0,h:0},d?d.length&&(a.to={x:d[0],y:d[1],w:d[2],h:d[3]}):a.to={x:0,y:0,w:0,h:0}):"color"===b&&(a.from=rd(c),a.to=rd(d)),a.current=a.from}function Eb(a){var b=a.type,c=a.from,d=a.to;"number"===b?a.delta=d-c:"point"===b?a.delta={x:d.x-c.x,y:d.y-c.y}:"rect"===b?a.delta={x:d.x-c.x,y:d.y-c.y,w:d.w-c.w,h:d.h-c.h}:"color"===b&&(a.delta={r:d.r-c.r,g:d.g-c.g,b:d.b-c.b,a:d.a-c.a})}function Fb(a,b){var c=a.type,d=a.delta,e=a.from,f=a.time,g=a.dur,h=jd[a.easing||"easeNone"];return h||(h=jd.easeNone),"number"===c?b=h(f,e,d,g):"point"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g)}:"rect"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g),w:h(f,e.w,d.w,g),h:h(f,e.h,d.h,g)}:"color"===c?b="rgba("+Math.floor(h(f,e.r,d.r,g))+","+Math.floor(h(f,e.g,d.g,g))+","+Math.floor(h(f,e.b,d.b,g))+","+Math.floor(h(f,e.a,d.a,g))+")":"set"===c?a.time&&(b=a.to):"group_set"===c&&(b=a.to[a.groupIndex]),a.current=b,b}window.twaver&&(window.twaver.animateLoopId&&cancelAnimationFrame(window.twaver.animateLoopId),window.twaver.animateLoopId=null),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.indexOf(a,b)===b});var Gb={};Gb._isInitializing=!1;var Hb={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(a,b,c,d,e){Hb.images[a]=new Gb.ImageAsset(a,b,c,d,e),xd(a)},getRegisteredImageNames:function(){return Object.keys(Hb.images)},unregisterImage:function(a){delete Hb.images[a]},getImageAsset:function(a){if("string"==typeof a){var b=Hb.images[a];return b}},showVersion:function(a){Hb.isCtrlDown(a)&&a.shiftKey&&76==a.keyCode&&alert("TWaver HTML5 "+Gb.Util.getVersion()+"\n"+Ib)},callLater:function(a,b,c,d){return setTimeout(function(){a.apply(b,c)},d||Dd.CALL_LATER_DELAY)},isEmptyObject:function(a){for(var b in a)return!1;return!0},xml:function(a){if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");var b=new ActiveXObject("Microsoft.XmlDOM");return b.async=!1,b.loadXml(a),b},num:function(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)},getter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1),c=/ble$/.test(a)||/ed$/.test(a)?"is":"get";return c+b},setter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"set"+b},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){for(var a=[],b=0;32>b;b++)a[b]=this._id[Math.floor(16*Gb.Util.random())];return a[12]="4",a[16]=this._id[3&a[16]|8],a.join("")},keys:function(a){var b=new md;for(var c in a)b.add(c);return b},es:["toString","toLocaleString","valueOf"],ip:function(a,b){var c="_"+b;a[Hb.getter(b)]=function(){return this[c]},a[Hb.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},validateLicense:function(a){Ib=a,lc()},ibool:function(a,b){var c="_"+b,d=b.charAt(0).toUpperCase()+b.slice(1);a["is"+d]=function(){return this[c]},a[Hb.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},getValue:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.slice(1),e="get"+d,f="is"+d;return c?"boolean"===c?a[f]():a[e]():a[e]?a[e]():a[f]?a[f]():a[b]},setValue:function(a,b,c){a["set"+b.charAt(0).toUpperCase()+b.slice(1)](c)},clone:function(a){if(!a)return null;var b={};for(var c in a)b[c]=a[c];return b},cloneRect:function(a){return a?{x:a.x,y:a.y,width:a.width,height:a.height}:null},classCache:{},getClass:function(a){var b=Hb.classCache[a];if(!b){var c=a.split("."),d=c.length;b=window;for(var e=0;d>e;e++)b=b[c[e]],b||"twaver"===c[e]&&(b=Gb);Hb.classCache[a]=b}return b},newInstance:function(a){var b=Hb.getClass(a)||window[a];if(!b)return null;var c=arguments.length,d=arguments;if(1===c)return new b;if(2===c)return new b(d[1]);if(3===c)return new b(d[1],d[2]);if(4===c)return new b(d[1],d[2],d[3]);if(5===c)return new b(d[1],d[2],d[3],d[4]);if(6===c)return new b(d[1],d[2],d[3],d[4],d[5]);if(7===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6]);if(8===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6],d[7]);throw"don't support args more than 7"},addMethod:function(a,b){var c=a.prototype;for(var d in b)c[d]=b[d]},ext:function(a,b,c){var d;if("string"==typeof a&&(d=a,a=Hb.getClass(a)),b){var e=function(){};e.prototype=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}if(d&&(a.prototype.getClassName=function(){return d}),c){var f=a.prototype;for(var g in c)Pb.ext(g,f,c);for(var h=Hb.es.length,i=0;h>i;i++)g=Hb.es[i],c.hasOwnProperty(g)&&!c.propertyIsEnumerable(g)&&(f[g]=c[g])}},setViewBounds:function(a,b){if(a)if(a.adjustBounds)a.adjustBounds(b);else{var c=a.style;!c&&a.getView()&&(c=a.getView().style),c&&(c.position="absolute",c.left=b.x+"px",c.top=b.y+"px",c.width=b.width+"px",c.height=b.height+"px")}},getImageSrc:function(a){var b=Hb.getImageAsset(a);return b?b.getSrc()?b.getSrc():b.getImage().getAttribute("src"):a},nextColorCount:0,nextColor:function(){return Hb.nextColorCount>=Dd.COLORS.length&&(Hb.nextColorCount=0),Dd.COLORS[Hb.nextColorCount++]},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},isShiftDown:function(a){return a.shiftKey},isAltDown:function(a){return a.altKey},setText:function(a,b,c){c?Ob.isFirefox?a.textContent=b:a.innerText=b:a.innerHTML=b},fillDescendant:function(a,b){b.add(a),a.hasChildren()&&a.getChildren().forEach(function(a){Hb.fillDescendant(a,b)})}},Ib=(Date,"l=1.0\ntype=1\ngis=1\n3d=0\nstart=2017-06-29\nend=2017-10-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=4ee4186cf7fa3f498dfbefc37d9e0776e648680ac266604664268939f449e44378d7f5e64a821e7a4e271b2cbaf8c6d0f5b04b5941717569682b7e2435416006dace269bd9d0573f6d036e73d47359a08deab61b8888b9594aea18f2a6803181bed01a0e0883b42802d39588452c24705cf43707e616d08f5cc834079a2fa1d7489a5b648b3a3197a4f00dee4ec640b867c77124a2aed2333d859cd44f09a6e7ab16293ab5991b9ab712c19b17729a54c5cb6ae0d11080c9308b72ba0685673c4012f7ad30e0bc7edbdd4eee19d99019df97f9e65d370154c14d6651583974185a2164337bcf414bb91a89f55950a2a0962e733fd095b33f4573a2241a8dda726249eff7d43ca219293cc07c317244f44dc217f2afd23fd001346d71ccd550528269e00614b0046087f1116c4d8741bd1f72869717a58cae852d2decddcdcc71d023e4b0bd6f1c77fc9f01b1673f4a03a4f7c6d9763b867939b89b6421a37b616e4f5aa7d1e60a64c843868816186c98bf3c07796f841d85de85cce340b0f459540f08596af14a6c0824fa8775f5b60b3a34000a491f1c7ecf593937381637ae13d32d6e9c4431c0f33d83d5b26bfbc2c519d6290c09f4a91592df26c338f138933a64868d56c9f2e1d238ed3458999628748f1859efebfed4c5c66d0daf6f683a5388c7832331121a3b0b907cbc160d6e3f1bd1b3fb536de491100f2f7bd45425f05351d9ea1a5c0b664fcf3a488398f48b36b2451e8715dec1b66091f61fc0fa0215c633174ec2e5f51f09559fdb85befb664d27fff283d91a714f9e04e58f38f07afad314a5db6e245c781e6ccc314575cf76e3be3512d0f35f5ec36ecb7af747267ca57c3bf4de3a3214a2d77064555d0ccf73ec6b2ddd20ac0254bfbfcf");"function"==typeof define?define(function(){return Gb}):"object"==typeof exports&&(module.exports=Gb),window&&(window.twaver=Gb,window._twaver=Hb),Gb.animate={},Gb.network={},Gb.network.interaction={},Gb.controls={},Gb.charts={},Gb.layout={};var Jb,Kb,Lb=window.navigator,Mb=window.document,Nb=window.Image;window.document||(Kb=!0,Jb=function(){},Nb=Jb.Image,Lb={userAgent:""},Mb={});var Ob=function(){var a={},b=Lb.userAgent.toLowerCase();return a.isOpera=/opera/.test(b),a.isIE=/msie/.test(b)||/trident/.test(b)||/edge/.test(b),a.isFirefox=/firefox/i.test(b),a.isChrome=/chrome/i.test(b),a.isSafari=!a.isChrome&&/safari/i.test(b),a.isIPhone=/iphone/.test(b),a.isIPod=/ipod/.test(b),a.isIPad=/ipad/.test(b),a.isAndroid=/android/i.test(b),a.isWebOS=/webos/i.test(b),a.isMSTouchable=a.isIE&&(Lb.msMaxTouchPoints&&Lb.msMaxTouchPoints>1||Lb.maxTouchPoints&&Lb.maxTouchPoints>1),a.isTouchable="ontouchend"in Mb||a.isMSTouchable,a}();Hb.ua=Ob;var Pb={__accessor:function(a,b){for(var c=b.__accessor,d=c.length,e=0;d>e;e++)Hb.ip(a,c[e])},__bool:function(a,b){for(var c=b.__bool,d=c.length,e=0;d>e;e++)Hb.ibool(a,c[e])},__client:function(a,b){a.getClient=function(a){return this._clientMap[a]},a.setClient=function(a,b){var c=this._clientMap[a];return null==b?delete this._clientMap[a]:this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b)&&this.onClientChanged(a,c,b),this},a.getClientProperties=function(){return Hb.keys(this._clientMap)},a.getClientMap=function(){return this._clientMap},a.onClientChanged=function(a,b,c){}},__style:function(a,b){a.getStyle=function(a){var b=this._styleMap[a];return null==b?Ed._m[a]:b},a.setStyle=function(a,b){var c=this._styleMap[a];return null==b?delete this._styleMap[a]:this._styleMap[a]=b,this.firePropertyChange("S:"+a,c,b)&&this.onStyleChanged(a,c,b),this},a.getStyleProperties=function(){return Hb.keys(this._styleMap);
},a.onStyleChanged=function(a,b,c){}},__new:function(a,b){a.newInstance=function(){var a=Hb.getClass(this.getClassName());if(!a)return null;var b=arguments.length,c=arguments;if(0===b)return new a;if(1===b)return new a(c[0]);if(2===b)return new a(c[0],c[1]);if(3===b)return new a(c[0],c[1],c[2]);if(4===b)return new a(c[0],c[1],c[2],c[3]);if(5===b)return new a(c[0],c[1],c[2],c[3],c[4]);if(6===b)return new a(c[0],c[1],c[2],c[3],c[4],c[5]);if(7===b)return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);throw"don't support args more than 7"}},__property:function(a,b){a.getValue=function(a,b){return"accessor"===this._propertyType?Hb.getValue(a,this._propertyName):"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):"field"===this._propertyType?a[this._propertyName]:null},a.setValue=function(a,b,c){if("accessor"===this._propertyType)a[Hb.setter(this._propertyName)](b);else{if("style"===this._propertyType&&a.setStyle)return a.setStyle(this._propertyName,b);if("client"===this._propertyType&&a.setClient)return a.setClient(this._propertyName,b);"field"===this._propertyType&&(a[this._propertyName]=b)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(a,b,c){1===Pb.map[a]?Pb[a](b,c):b[a]=c[a]}};Hb.extend=Pb;var Qb=Hb.Matrix=function(a,b,c,d,e,f){this.setMatrix(a,b,c,d,e,f)};Qb.identity=function(){return new Qb(1,0,0,1,0,0)},Qb.prototype.setMatrix=function(a,b,c,d,e,f){this._m11=a,this._m12=b,this._m21=c,this._m22=d,this._offsetX=e,this._offsetY=f,this._type=0,0!=this._m21||0!=this._m12?this._type=4:((1!=this._m11||1!=this._m22)&&(this._type=2),(0!=this._offsetX||0!=this._offsetY)&&(this._type|=1),0==(3&this._type)&&(this._type=0))},Qb.prototype.transform=function(){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!a||!Hb.num(a.x)||!Hb.num(a.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:a.x,y:a.y};case 1:return{x:this._offsetX+a.x,y:this._offsetY+a.y};case 2:return{x:a.x*this._m11,y:a.y*this._m22};case 3:return{x:a.x*this._m11+this._offsetX,y:a.y*this._m22+this._offsetY}}return{x:this._m11*a.x+a.y*this._m21+this._offsetX,y:this._m22*a.y+a.x*this._m12+this._offsetY}},Qb.prototype.translate=function(a,b){this.multiply(new Qb(1,0,0,1,a,b))},Qb.prototype.scale=function(a,b){this.multiply(new Qb(a,0,0,b,0,0))},Qb.prototype.rotate=function(a,b,c){a=a*Math.PI/180;var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;this.multiply(new Qb(e,d,-d,e,f,g))},Qb.prototype.skew=function(a,b){this.multiply(new Qb(1,Math.tan(b*Math.PI/180),Math.tan(a*Math.PI/180),1,0,0))},Qb.prototype.multiply=function(a){var b=this,c=a,d=b._type,e=c._type;if(0!=e)if(0==d)b.setMatrix(c._m11,c._m12,c._m21,c._m22,c._offsetX,c._offsetY);else if(1==e)b._offsetX+=c._offsetX,b._offsetY+=c._offsetY,4!=d&&(b._type|=1);else if(1==d){var f=b._offsetX,g=b._offsetY;b.setMatrix(c._m11,c._m12,c._m21,c._m22,c._offsetX,c._offsetY),b._offsetX=f*c._m11+g*c._m21+c._offsetX,b._offsetY=f*c._m12+g*c._m22+c._offsetY,b._type=4==e?4:3}else switch(d<<4|e){case 34:return b._m11*=c._m11,void(b._m22*=c._m22);case 35:return b._m11*=c._m11,b._m22*=c._m22,b._offsetX=c._offsetX,b._offsetY=c._offsetY,void(b._type=3);case 36:case 52:case 66:case 67:case 68:return void b.setMatrix(b._m11*c._m11+b._m12*c._m21,b._m11*c._m12+b._m12*c._m22,b._m21*c._m11+b._m22*c._m21,b._m21*c._m12+b._m22*c._m22,b._offsetX*c._m11+b._offsetY*c._m21+c._offsetX,b._offsetX*c._m12+b._offsetY*c._m22+c._offsetY);case 50:return b._m11*=c._m11,b._m22*=c._m22,b._offsetX*=c._m11,void(b._offsetY*=c._m22);case 51:return b._m11*=c._m11,b._m22*=c._m22,b._offsetX=c._m11*b._offsetX+c._offsetX,void(b._offsetY=c._m22*b._offsetY+c._offsetY);default:console.log("Matrix multiply hit an invalid case: "+combinedType)}};var Rb={getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},getCenterPoint:function(a,b){return a&&b?{x:(a.x+b.x)/2,y:(a.y+b.y)/2}:null==b&&a.width?{x:a.x+a.width/2,y:a.y+a.height/2}:void 0},isPointInPolygon:function(a,b){a=a._as?a._as:a;var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;f>c;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e},unionRect:function(a,b){if(a&&!b)return Hb.cloneRect(a);if(!a&&b)return Hb.cloneRect(b);if(a&&b){var c=Math.min(a.x,b.x),d=Math.min(a.y,b.y),e=Math.max(a.x+a.width,b.x+b.width)-c,f=Math.max(a.y+a.height,b.y+b.height)-d;return a.x=c,a.y=d,a.width=e,a.height=f,a}return null},intersects:function(a,b){if(!a||!b)return!1;var c=b.width,d=b.height,e=a.width,f=a.height;if(0>=e||0>=f||0>=c||0>=d)return!1;var g=b.x,h=b.y,i=a.x,j=a.y;return e+=i,f+=j,c+=g,d+=h,(i>e||e>g)&&(j>f||f>h)&&(g>c||c>i)&&(h>d||d>j)},intersection:function(a,b){if(!a||!b)return!1;var c=b.x,d=b.y,e=a.x,f=a.y,g=c;g+=b.width;var h=d;h+=b.height;var i=e;i+=a.width;var j=f;return j+=a.height,e>c&&(c=e),f>d&&(d=f),g>i&&(g=i),h>j&&(h=j),g-=c,h-=d,0===g||0===h?null:{x:c,y:d,width:g,height:h}},contains:function(a,b){var c=b.x,d=b.y,e=b.width,f=b.height,g=a.width,h=a.height;if(0>(g|h|e|f))return!1;var i=a.x,j=a.y;if(i>c||j>d)return!1;if(g+=i,e+=c,c>=e){if(g>=i||e>g)return!1}else if(g>=i&&e>g)return!1;if(h+=j,f+=d,d>=f){if(h>=j||f>h)return!1}else if(h>=j&&f>h)return!1;return!0},getLinePoints:function(a){if(!a)return null;var b=new md;return a.forEach(function(a){b.addAll(a)}),b},getLineRect:function(a){var b=Rb.getLinePoints(a);return Rb.getRect(b)},getRect:function(a,b){if(!a)return null;a._as&&(a=a._as);var c=a.length;if(0>=c)return null;var d=a[0];b=b||{x:null,y:null,width:0,height:0};for(var e=0;c>e;e++)if(d=a[e],d instanceof md)Rb.getRect(d,b);else{null==b.x&&(b.x=d.x,b.y=d.y);var f=Math.min(b.x,d.x),g=Math.min(b.y,d.y),h=Math.max(b.x+b.width,d.x),i=Math.max(b.y+b.height,d.y);b.x=f,b.y=g,b.width=h-f,b.height=i-g}return b},addPadding:function(a,b,c,d){d=d||-1;var e=b.getStyle(c)*d;0!=e&&Rb.grow(a,e,e),e=b.getStyle(c+".left")*d,0!=e&&(a.x-=e,a.width+=e),e=b.getStyle(c+".right")*d,0!=e&&(a.width+=e),e=b.getStyle(c+".top")*d,0!=e&&(a.y-=e,a.height+=e),e=b.getStyle(c+".bottom")*d,0!=e&&(a.height+=e),a.width<0&&(a.width=-a.width,a.x-=a.width),a.height<0&&(a.height=-a.height,a.y-=a.height)},grow:function(a,b,c){if(null==a)return null;null==c&&(c=b);var d=a.width+b+b;if(!(0>d)){var e=a.height+c+c;if(!(0>e))return a.x-=b,a.y-=c,a.width=d,a.height=e,a}},containsPoint:function(a,b,c){return arguments.length<3&&(c=b.y,b=b.x),!a||b<a.x||c<a.y||b>a.x+a.width||c>a.y+a.height?!1:!0},getHotSpot:function(a,b,c,d,e){if("oval"===e){var f=.35;return{x:a+.5*c+c*f,y:b+d/2-Math.sqrt(.25-f*f)*d}}if("circle"===e){var g=a+c/2,h=b+d/2,i=Math.min(c,d)/2;a=g-i,b=h-i,c=2*i,d=2*i;var j=c/2,k=d/2,l=j*k/Math.sqrt(j*j+k*k);return{x:a+c/2+l,y:b+d/2-l}}var m={x:a+c,y:b};return c>3&&(m.x-=3),d>3&&(m.y+=3),m},getCircleRect:function(a){var b=Math.min(a.width,a.height)/2;return{x:a.x+a.width/2-b,y:a.y+a.height/2-b,width:2*b,height:2*b}},getEllipsePoint:function(a,b){if(!a||!b)return null;var c=a.x+a.width/2,d=a.y+a.height/2,e=b.x-c,f=b.y-d,g=a.width/2,h=a.height/2,i=Math.sqrt(1/(1/g/g+f*f/e/e/h/h));0>e&&(i=-i);var j;return j=0==e?f>0?h:-h:i*f/e,{x:c+i,y:d+j}},createMatrix:function(a,b,c){var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;return new Qb(e,d,-d,e,f,g)},calculatePointInfoAlongLineBySegments:function(a,b,c,d,e){return Rb.calculatePointInfoAlongLine(Rb.getPointObject(a,b),c,d,e)},calculatePointInfoAlongLine:function(a,b,c,d){if(b=void 0===b?!0:b,c=c||0,d=d||0,!a||a.size()<2)throw"must more than two points";if(!b){var e=Rb.reversePath(a);return Rb.calculatePointInfoAlongLine(e,!0,c,d)}a._as&&(a=a._as);var f,g,h,i,j,k=0,l=0,m=a.length;for(i=0;m>i;i++)if(j=a[i],0!=i){if(0>=c){h=Rb.calculatePointInfoOnStraightLine(Rb._getPoint(g),Rb._getControlPoint(j),c,d),f=h;break}if(l=Rb._getLength(j,g),k+l>c){h=Rb.getPathInfo(j,g,c-k,d,l),f=h;break}k+=l,g=j}else g=j;if(null==f){var n,o;g=a[m-1],o=Rb._getPoint(g),g instanceof md&&(g=g._as),n=g instanceof Array?Rb._getControlPoint(g):Rb._getPoint(a[m-2]);var p=Math.atan2(o.y-n.y,o.x-n.x);h=Rb.transformPoint(o,p,c-k,d),h.angle=p,f=h}return f},reversePath:function(a){var b,c=new md,d=null;a._as&&(a=a._as);for(var e=a.length-1;e>=0;e--)b=a[e],c.add(Rb._getReversePath(b,d)),d=b;return c},_getPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-1]:a},_getControlPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-2]:a},_getReversePath:function(a,b){var c=Rb._getPoint(a);return b&&b._as&&(b=b._as),null!=b&&b instanceof Array?new md(2==b.length?[b[0],c]:[b[1],b[0],c]):c},_getLength:function(a,b){var c=Rb._getPoint(b),d=Rb._getPoint(a);if(a instanceof md&&(a=a._as),a instanceof Array)return Rb.calculateCurveLength(c,a,1);var e=d.y-c.y,f=d.x-c.x;return Math.sqrt(f*f+e*e)},getPathInfo:function(a,b,c,d,e){var f,g=Rb._getPoint(b),h=Rb._getPoint(a);if(a instanceof md&&(a=a._as),a instanceof Array){0>e&&(e=Rb._getLength(a,b));var i=c/e,j=Rb.calculatePointInfoOnCurveLine(g,a,i);g=j.point,f=j.angle,c=0}else f=Math.atan2(h.y-g.y,h.x-g.x);return Rb.transformPoint(g,f,c,d)},transformPoint:function(a,b,c,d){var e={x:c,y:d},f=Rb.createMatrix(b,0,0);return e=f.transform(e),e.x+=a.x,e.y+=a.y,{point:e,angle:b}},calculatePointInfoOnStraightLine:function(a,b,c,d){var e=Math.atan2(b.y-a.y,b.x-a.x);return Rb.transformPoint(a,e,c,d)},calculatePointInfoOnCurveLine:function(a,b,c){if(0>c||c>1)throw"Illegal arguments";return b._as&&(b=b._as),2==b.length?Rb._calculatePointInfoOnCurveLine2(a,b[0],b[1],c):Rb._calculatePointInfoOnCurveLine3(a,b[0],b[1],b[2],c)},_calculatePointInfoOnCurveLine2:function(a,b,c,d){var e=2*(a.x+c.x-2*b.x)*d+2*b.x-2*a.x,f=2*(a.y+c.y-2*b.y)*d+2*b.y-2*a.y,g=Math.atan2(f,e),h=(a.x+c.x-2*b.x)*d*d+(2*b.x-2*a.x)*d+a.x,i=(a.y+c.y-2*b.y)*d*d+(2*b.y-2*a.y)*d+a.y;return{point:{x:h,y:i},angle:g}},_calculatePointInfoOnCurveLine3:function(a,b,c,d,e){var f,g,h;f=1-e,g=f*f*f,h=e*e*e;var i=g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x,j=g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y;return{point:{x:i,y:j},angle:Math.atan2(Rb._bezeSpeedY(a,b,c,d,e),Rb._bezeSpeedX(a,b,c,d,e))}},calculateCurveLength:function(a,b,c){return b._as&&(b=b._as),2==b.length?Rb._calculateCurveLength(a,b[0],b[1],c):Rb._calculateBezierCurveLength(a,b[0],b[1],b[2],c)},_calculateCurveLength:function(a,b,c,d){if(0>=d||d>1)return 0;var e=Math.floor(d*(Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))+Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)))/2),f=0;0>=e&&(e=1);for(var g,h,i=d/e,j=0,k=0;e>k;k++)j=i*k,g=2*(a.x+c.x-2*b.x)*j+2*b.x-2*a.x,h=2*(a.y+c.y-2*b.y)*j+2*b.y-2*a.y,g*=i,h*=i,f+=Math.sqrt(g*g+h*h);return f},_calculateBezierCurveLength:function(a,b,c,d,e){if(0>=e||e>1)return 0;var f=1e4,g=Math.floor(f*e);if(1==(1&g)&&g++,0==g)return 0;var h,i=Math.floor(g/2),j=0,k=0,l=e/g;for(h=0;i>h;h++)j+=Rb._bezeSpeed(a,b,c,d,(2*h+1)*l);for(h=1;i>h;h++)k+=Rb._bezeSpeed(a,b,c,d,2*h*l);return(Rb._bezeSpeed(a,b,c,d,0)+Rb._bezeSpeed(a,b,c,d,1)+2*k+4*j)*l/3},_bezeSpeedX:function(a,b,c,d,e){var f=1-e;return-3*a.x*f*f+3*b.x*f*f-6*b.x*f*e+6*c.x*f*e-3*c.x*e*e+3*d.x*e*e},_bezeSpeedY:function(a,b,c,d,e){var f=1-e;return-3*a.y*f*f+3*b.y*f*f-6*b.y*f*e+6*c.y*f*e-3*c.y*e*e+3*d.y*e*e},_bezeSpeed:function(a,b,c,d,e){var f=Rb._bezeSpeedX(a,b,c,d,e),g=Rb._bezeSpeedY(a,b,c,d,e);return Math.sqrt(f*f+g*g)},getPointObject:function(a,b){if(b&&0!=b.size()){var c=new md;b=b._as,a=a._as;var d,e,f=0,g=b.length,h=a.length;for(d=0;g>d&&(e=b[d],f!=h);d++)"cubicto"===e?h-2>f&&c.add([a[f++],a[f++],a[f++]]):"quadto"===e?h-1>f&&c.add([a[f++],a[f++]]):h>f&&c.add(a[f++]);for(;h>f;f++)c.add(a[f]);return c}return a},calculateLineLength:function(a,b){if(!a||a.size()<2)return 0;if(b)return Rb.calculateLineLength(Rb.getPointObject(a,b));a=a._as;var c,d,e,f,g,h,i,j=a.length,k=0;for(c=0;j>c;c++)f=a[c],0!=c?(e=f,e instanceof md&&(e=e._as),e instanceof Array?(g=Rb.calculateCurveLength(d,e,1),d=e[e.length-1]):(i=f.y-d.y,h=f.x-d.x,g=Math.sqrt(h*h+i*i),d=e),k+=g):d=f;return k},toDegrees:function(a){return 180*a/Math.PI},toRadians:function(a){return a/180*Math.PI},getRadiansBetweenLines:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},getAngle:function(a,b){return a.x===b.x?b.y===a.y?0:b.y>a.y?Math.PI/2:-Math.PI/2:Math.atan((b.y-a.y)/(b.x-a.x))}};Hb.math=Rb;var Sb={getPoints:function(a){var b=new md;return a.forEach(function(a){b.add({x:a.x,y:a.y}),b.add({x:a.x+a.width,y:a.y+a.height}),b.add({x:a.x+a.width,y:a.y}),b.add({x:a.x,y:a.y+a.height})}),b},rectangle:function(a){var b;return a.forEach(function(a){b=Rb.unionRect(b,a)}),b},oval:function(a){var b=Sb.rectangle(a),c=0,d=b.height/b.width,e=d*d,f=b.x+b.width/2,g=b.y+b.height/2,h=Sb.getPoints(a);h.forEach(function(a){var b=a.x-f,d=a.y-g,h=b*b+d*d/e;h>c&&(c=h)}),c=Math.sqrt(c);var i=d*c;return{x:f-c,y:g-i,width:2*c,height:2*i}},circle:function(a){var b=Sb.rectangle(a),c=0,d=b.x+b.width/2,e=b.y+b.height/2,f=Sb.getPoints(a);return f.forEach(function(a){var b=a.x-d,f=a.y-e,g=b*b+f*f;g>c&&(c=g)}),c=Math.sqrt(c),{x:d-c,y:e-c,width:2*c,height:2*c}},roundrect:function(a){var b=Sb.rectangle(a),c=Math.min(b.width,b.height)/16;return Rb.grow(b,c,c),b},star:function(a){var b=Sb.rectangle(a);return Rb.grow(b,b.width,b.height),b},triangle:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width*=2,b.y-=b.height,b.height*=2,b},hexagon:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width*=2,b},pentagon:function(a){var b=Sb.rectangle(a);return b.x-=b.width/6,b.width+=b.width/3,b.y-=b.height/4,b.height+=b.height/4,b},diamond:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b},trapezoidal:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b}};Hb.group=Sb;var Tb={"topleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y-b.height}},"topleft.topright":function(a,b){return{x:a.x,y:a.y-b.height}},"top.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y-b.height}},"topright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y-b.height}},"topright.topright":function(a,b){return{x:a.x+a.width,y:a.y-b.height}},topleft:function(a,b){return{x:a.x-b.width/2,y:a.y-b.height/2}},top:function(a,b){return{x:a.x-b.width/2+a.width/2,y:a.y-b.height/2}},topright:function(a,b){return{x:a.x-b.width/2+a.width,y:a.y-b.height/2}},"topleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y}},"topleft.bottomright":function(a,b){return{x:a.x,y:a.y}},"top.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y}},"topright.bottomleft":function(a,b){return{x:a.x-b.width+a.width,y:a.y}},"topright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y}},"left.left":function(a,b){return{x:a.x-b.width,y:a.y+a.height/2-b.height/2}},left:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height/2-b.height/2}},"left.right":function(a,b){return{x:a.x,y:a.y+a.height/2-b.height/2}},center:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height/2-b.height/2}},"right.left":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height/2-b.height/2}},right:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height/2-b.height/2}},"right.right":function(a,b){return{x:a.x+a.width,y:a.y+a.height/2-b.height/2}},"bottomleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height-b.height}},"bottomleft.topright":function(a,b){return{x:a.x,y:a.y+a.height-b.height}},"bottom.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height}},"bottomright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height-b.height}},"bottomright.topright":function(a,b){return{x:a.x+a.width,y:a.y+a.height-b.height}},bottomleft:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height-b.height/2}},bottom:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height/2}},bottomright:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height-b.height/2}},"bottomleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height}},"bottomleft.bottomright":function(a,b){return{x:a.x,y:a.y+a.height}},"bottom.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height}},"bottomright.bottomleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height}},"bottomright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y+a.height}},get:function(a,b,c){if(!b)throw"refRect can not be null";c||(c={width:0,height:0});var d=Tb[a];if(d)return d(b,c);throw"Can not resolve '"+a+"' position"}};Hb.position=Tb;var Ub={preventDefault:function(a){Dd.KEEP_DEFAULT_FUNCTION(a)||(a.preventDefault?a.preventDefault():a.preventManipulation?a.preventManipulation():a.returnValue=!1)},insertAfter:function(a,b){return b?b.parentNode.insertBefore(a,b.nextSibling):a.parentNode.insertBefore(a,a.parentNode.firstChild),a},forEach:function(a,b,c){if(Ub.isVisible(a)){for(var d=a.childNodes.length,e=0;d>e;e++)Ub.forEach(a.childNodes[e],b,c);c?b.call(c,a):b(a)}},setVisible:function(a,b){a.style.display=b?"block":"none"},isVisible:function(a){return"style"in a&&"none"!==a.style.display},release:function(a){for(var b=a.childNodes.length,c=0;b>c;c++)Ub.release(a.childNodes[c]);b>0&&Ub.clear(a),a._pool&&a._pool.release(a)},clear:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},setZoom:function(a,b){var c=a.style;if(c.setProperty)if(Ob.isFirefox)c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);else if(Ob.isOpera)c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);else if(Ob.isChrome||Ob.isSafari){c.setProperty("-webkit-transform","scale("+b+")",null),c.setProperty("-webkit-transform-origin","0 0",null);var d=null;a._webkitInvaildateDiv?d=a._webkitInvaildateDiv:(d=Mb.createElement("div"),a._webkitInvaildateDiv=d),d.parentNode&&d.parentNode==a?a.removeChild(d):a.appendChild(d)}else Ob.isIE?(c.setProperty("-ms-transform","scale("+b+")",null),c.setProperty("-ms-transform-origin","0 0",null)):(c.setProperty("transform","scale("+b+")",null),c.setProperty("transform-origin","0 0",null))},setRotate:function(a,b){var c=a.style;if(c.setProperty)if(Ob.isFirefox)c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);else if(Ob.isOpera)c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);else if(Ob.isChrome||Ob.isSafari){c.setProperty("-webkit-transform","scale("+b+")",null),c.setProperty("-webkit-transform-origin","0 0",null);var d=null;a._webkitInvaildateDiv?d=a._webkitInvaildateDiv:(d=Mb.createElement("div"),a._webkitInvaildateDiv=d),d.parentNode&&d.parentNode==a?a.removeChild(d):a.appendChild(d)}else Ob.isIE?(c.setProperty("-ms-transform","scale("+b+")",null),c.setProperty("-ms-transform-origin","0 0",null)):(c.setProperty("transform","scale("+b+")",null),c.setProperty("transform-origin","0 0",null))},setCSSStyle:function(a,b,c){a.style.setProperty(b,c,null)},removeCSSStyle:function(a,b){a.style.removeProperty(b)},getCSSStyle:function(a,b){return a.style.getPropertyValue(b)},setBorderRaidus:function(a,b){Ob.isFirefox?a.style.MozBorderRadius=b:a.style.borderRadius=b},createSelect:function(a,b){var c,d,e,f=Mb.createElement("select");if(Array.isArray(a))for(c=0;c<a.length;c++)d=a[c],e=Mb.createElement("option"),e.innerHTML=d,e.setAttribute("value",d),d===b&&e.setAttribute("selected","true"),f.appendChild(e);else for(c=0;c<a.values.length;c++)d=a.values[c],e=Mb.createElement("option"),e.innerHTML=a.map[d],e.setAttribute("value",d),d===b&&e.setAttribute("selected","true"),f.appendChild(e);return f},createImg:function(a){var b=Mb.createElement("img");return b.style.position="absolute","string"==typeof a&&b.setAttribute("src",a),b},createView:function(a,b){var c=Mb.createElement("div");return c.style.position=Dd.VIEW_POSITION,c.style.fontSize=Dd.VIEW_FONT_SIZE,c.style.fontFamily=Dd.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.style.msTouchAction="none",c.style.touchAction="none",c.tabIndex=0,b||(c.onmousedown=Ub.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null),c.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),a&&(c.style.overflow=a),c},createDiv:function(){var a=Mb.createElement("div");return a.style.position="absolute",a.style.msTouchAction="none",a.style.touchAction="none",a},createCanvas:function(a,b){if(a=a||0,b=b||0,Kb)return new Jb(a,b);var c=Mb.createElement("canvas");return c.style.position="absolute",c.style.msTouchAction="none",c.style.touchAction="none",c.width=a,c.height=b,c},setCanvas:function(a,b,c,d,e){2===arguments.length&&(c=b.y,d=b.width,e=b.height,b=b.x),a.style.left=b+"px",a.style.top=c+"px",a.setAttribute("width",d),a.setAttribute("height",e),a._viewRect={x:b,y:c,width:d,height:e};var f=a.getContext("2d");return 0!==f.shadowBlur&&(f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=0,f.shadowColor="rgba(0,0,0,0.0)"),f.clearRect(0,0,d,e),f.translate(-b,-c),f},setImg:function(a,b,c){a.setAttribute("src",b),a.style.left=c.x+"px",a.style.top=c.y+"px",a.style.width=c.width+"px",a.style.height=c.height+"px",a._viewRect=Hb.clone(c)},setDiv:function(a,b,c,d,e){d=Hb.num(d)?d:0,a.style.left=b.x-d+"px",a.style.top=b.y-d+"px",a.style.width=b.width+"px",a.style.height=b.height+"px",a._viewRect=Hb.clone(b),a.style.backgroundColor=c?c:"",a.style.border=d>0?d+"px "+e+" solid":""},changeTypeForMS:function(a){var b=a;if(0===a.indexOf("MSPointer")||0===a.indexOf("pointer")){var c;0===a.indexOf("MSPointer")?(c=a.substring(9,10).toLowerCase(),c+=a.substring(10)):c=a.substring(7,8),window.MSPointerEvent?b="MSPointer"+c.substring(0,1).toUpperCase()+c.substring(1):window.PointerEvent&&(b="pointer"+c)}return b},addEventListener:function(a,b,c,d){a=this.changeTypeForMS(a);var e="_"+a+"_";if(!d[e]){var f=function(a){f.instance[f.method](a)};f.method=b,f.instance=d,d[e]=f,c.addEventListener(a,f,!1)}},removeEventListener:function(a,b,c){a=this.changeTypeForMS(a);var d="_"+a+"_",e=c[d];e&&(b.removeEventListener(a,e,!1),delete c[d])},isValidEvent:function(a,b){if(!b)return!1;if(b.target===a)if(Ob.isFirefox){if(a.clientHeight<a.scrollHeight&&b.layerX<25)return!1;if(a.clientWidth<a.scrollWidth&&b.layerY<25)return!1}else if(b.offsetX>a.clientWidth||b.offsetY>a.clientHeight)return!1;return!0},getLogicalPoint:function(a,b,c,d){c=c?c:1;var e,f=a.getBoundingClientRect();if(Ob.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var g=b.changedTouches[0],h=Ob.isAndroid?0:yc.scrollLeft(),i=Ob.isAndroid?0:yc.scrollTop();e={x:(g.clientX+a.scrollLeft-f.left-h)/c,y:(g.clientY+a.scrollTop-f.top-i)/c}}else{if(!Ub.isValidEvent(a,b))return null;e={x:(b.clientX-f.left+a.scrollLeft)/c,y:(b.clientY-f.top+a.scrollTop)/c}}return e},handle_mousedown:function(a,b){Ub.target&&Ub.handle_mouseup(b),window.addEventListener("mousemove",Ub.handle_mousemove,!1),window.addEventListener("mouseup",Ub.handle_mouseup,!1),Ub.target=a},handle_mousemove:function(a){Ub.target.handle_mousemove&&Ub.target.handle_mousemove(a),Ub.target.handleMouseMove&&Ub.target.handleMouseMove(a)},handle_mouseup:function(a){Ub.target.handle_mouseup&&Ub.target.handle_mouseup(a),Ub.target.handleMouseUp&&Ub.target.handleMouseUp(a),window.removeEventListener("mousemove",Ub.handle_mousemove,!1),window.removeEventListener("mouseup",Ub.handle_mouseup,!1),delete Ub.target},getClientPoint:function(a){return{x:a.clientX,y:a.clientY}},windowWidth:function(){return"number"==typeof window.innerWidth?window.innerWidth:Mb.documentElement&&Mb.documentElement.clientWidth?Mb.documentElement.clientWidth:Mb.body&&Mb.body.clientWidth?Mb.body.clientWidth:0},windowHeight:function(){return"number"==typeof window.innerHeight?window.innerHeight:Mb.documentElement&&Mb.documentElement.clientHeight?Mb.documentElement.clientHeight:Mb.body&&Mb.body.clientHeight?Mb.body.clientHeight:0}};Hb.html=Ub;var Vb={cache:{},g:Ub.createCanvas().getContext("2d"),getTextSize:function(a,b){Vb.g.font=a?a:Dd.FONT;var c=Vb.cache[Vb.g.font];c||(c=2*Vb.g.measureText("e").width+4,Vb.cache[Vb.g.font]=c),b=b||"",b=String(b);for(var d,e=b.split("\n"),f=e.length,g=0,h=f-1;h>=0;h--)d=Vb.g.measureText(e[h]).width,d>g&&(g=d);return{width:g+4,height:c*f}},getSubStringInLength:function(a,b,c){var d=this,e=function(a,b,c,f,g){if(a>=b)return f.substring(0,a+1);var h=Math.floor((a+b)/2),i=f.substring(0,h+1),j=d.getTextSize(c,i).width;if(j>g)return e(a,h-1,c,f,g);var k=h+1,l=f.substring(0,k+1),m=d.getTextSize(c,l).width;return m>g?i:e(k,b,c,f,g)},f=this.getTextSize(a,b).width;return f>c?e(0,b.length-1,a,b,c):b},getCollapseTextInLength:function(a,b,c){var d=this.getTextSize(a,b).width;if(d>c){for(var e=0,f="",g=b,h=d;h>c;){var i=this.getSubStringInLength(a,g,c);f=f+i+"\n",e+=i.length,g=b.substring(e),h=this.getTextSize(a,g).width}return f+g}return b},drawText:function(a,b,c,d,e,f){b=b||"",b=String(b),d||(d=Dd.FONT);var g="center";f&&(g=f),a.font=d,a.fillStyle=e,a.textAlign=g,a.textBaseline="middle";var h,i,j=b.split("\n"),k=j.length,l=0;c?void 0===c.width?(h=c.x,i=c.y):(l=c.height/k,"left"==g?h=c.x:"center"==g&&(h=c.x+c.width/2),i=c.y+l/2):(h=0,i=0),Ob.isOpera&&(i-=2);for(var m=0;k>m;m++)"right"==g&&(a.textAlign="left",h=c.x+c.width-Vb.getTextSize(d,j[m]).width),a.fillText(j[m],h,i),i+=l},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if(Math.abs(e)>2*Math.PI&&(e=2*Math.PI),m=Math.ceil(Math.abs(e)/(Math.PI/4)),i=e/m,j=-i,k=-d,m>0){n=b+Math.cos(d)*f,o=c+Math.sin(-d)*g,h?a.lineTo(n,o):a.moveTo(n,o);for(var t=0;m>t;t++)k+=j,l=k-j/2,p=b+Math.cos(k)*f,q=c+Math.sin(k)*g,r=b+Math.cos(l)*(f/Math.cos(j/2)),s=c+Math.sin(l)*(g/Math.cos(j/2)),a.quadraticCurveTo(r,s,p,q)}},dashedLine:function(a,b,c,d,e,f,g){var h=f-d,i=g-e,j=Math.sqrt(h*h+i*i);if(0!=j){h/=j,i/=j;for(var k=j,l=-c.offset,m=c.drawing,n=c.patternIndex;k>l;)l+=b[n],l>=k&&(c.offset=b[n]-(l-k),c.patternIndex=n,c.drawing=m,l=k),m?a.lineTo(d+l*h,e+l*i):a.moveTo(d+l*h,e+l*i),m=!m,n=(n+1)%b.length}},drawLinePoints:function(a,b,c,d,e){var f,g,h,i,j,k,l=0,m=0,n=b.size();if(k=c&&c.length>0?new tc(a,c[0],c.length>1?c[1]:c[0]):a,d)for(m=0,j=d.size();j>m;m++)if(f=d.get(m),"moveto"===f&&n>l)g=b.get(l++),k.moveTo(g.x,g.y);else if("lineto"===f&&n>l)g=b.get(l++),k.lineTo(g.x,g.y);else if("cubicto"===f&&n-2>l)g=b.get(l++),h=b.get(l++),i=b.get(l++),k.bezierCurveTo(g.x,g.y,h.x,h.y,i.x,i.y);else{if(!("quadto"===f&&n-1>l))throw"Can not resolve segment '"+f+"'";g=b.get(l++),h=b.get(l++),k.quadraticCurveTo(g.x,g.y,h.x,h.y)}else this._drawLine(b,k);e&&k.closePath()},_drawLine:function(a,b){var c,d,e,f,g,h=0,i=a.size();for(c=a.get(0),b.moveTo(c.x,c.y),h=1;i>h;h++)g=a.get(h),g.size?(f=g.size(),2===f?(c=g.get(0),d=g.get(1),b.quadraticCurveTo(c.x,c.y,d.x,d.y)):3===f&&(c=g.get(0),d=g.get(1),e=g.get(2),b.bezierCurveTo(c.x,c.y,d.x,d.y,e.x,e.y))):b.lineTo(g.x,g.y)},drawRoundRect:function(a,b,c,d,e,f,g,h,i){6===arguments.length&&(g=f,h=f,i=f);var j=b+d,k=c+e,l=e>d?2*d:2*e;f=l>f?f:l,g=l>g?g:l,h=l>h?h:l,i=l>i?i:l;var m=.292893218813453*i,n=.585786437626905*i;a.moveTo(j,k-i),a.quadraticCurveTo(j,k-n,j-m,k-m),a.quadraticCurveTo(j-n,k,j-i,k),m=.292893218813453*h,n=.585786437626905*h,a.lineTo(b+h,k),a.quadraticCurveTo(b+n,k,b+m,k-m),a.quadraticCurveTo(b,k-n,b,k-h),m=.292893218813453*f,n=.585786437626905*f,a.lineTo(b,c+f),a.quadraticCurveTo(b,c+n,b+m,c+m),a.quadraticCurveTo(b+n,c,b+f,c),m=.292893218813453*g,n=.585786437626905*g,a.lineTo(j-g,c),a.quadraticCurveTo(j-n,c,j-m,c+m),a.quadraticCurveTo(j,c+n,j,c+g),a.lineTo(j,k-i)},drawVector:function(a,b,c,d,e,f,g){var h;4===arguments.length?(e=d.y,f=d.width,g=d.height,d=d.x):5===arguments.length&&"roundrect"===b&&(h={},h.topLeft=e,h.topRight=e,h.bottomLeft=e,h.bottomRight=e,e=d.y,f=d.width,g=d.height,d=d.x);var i=Vb["_"+b];i&&(a.beginPath(),c&&c.length>0&&(a=new tc(a,c[0],c.length>1?c[1]:c[0])),5===arguments.length&&"roundrect"===b?i(a,{x:d,y:e,width:f,height:g},h):i(a,d,e,f,g))},_rectangle:function(a,b,c,d,e){a.rect(b,c,d,e)},_circle:function(a,b,c,d,e){var f=b+d/2,g=c+e/2,h=Math.min(d,e)/2;a instanceof tc?Vb.drawArc(a,f,g,0,2*Math.PI,h,h,!1):a.arc(f,g,h,0,2*Math.PI,!0)},_oval:function(a,b,c,d,e){if(a instanceof tc)Vb.drawArc(a,b+d/2,c+e/2,0,2*Math.PI,d/2,e/2,!1);else{var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)}},_roundrect:function(a,b,c,d,e){if(3===arguments.length){var f=c;c=b.y,d=b.width,e=b.height,b=b.x,f.topLeft?Vb.drawRoundRect(a,b,c,d,e,f.topLeft):Vb.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))}else Vb.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))},_star:function(a,b,c,d,e){var f=2*d,g=2*e,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(b+.306*d,c+.579*e),a.lineTo(h-f/6,i+g/4),a.lineTo(b+d/2,c+.733*e),a.lineTo(h+f/6,i+g/4),a.lineTo(b+.693*d,c+.579*e),a.lineTo(h+f/4,i-g/12),a.lineTo(b+.611*d,c+.332*e),a.lineTo(h+0,i-g/4),a.lineTo(b+.388*d,c+.332*e),a.closePath()},_triangle:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.closePath()},_hexagon:function(a,b,c,d,e){a.moveTo(b,c+e/2),a.lineTo(b+d/4,c+e),a.lineTo(b+3*d/4,+c+e),a.lineTo(b+d,c+e/2),a.lineTo(b+3*d/4,c),a.lineTo(b+d/4,c),a.closePath()},_pentagon:function(a,b,c,d,e){var f=2*d,g=2*e,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(h-f/6,i+g/4),a.lineTo(h+f/6,i+g/4),a.lineTo(h+f/4,i-g/12),a.lineTo(h+0,i-g/4),a.closePath()},_trapezoidal:function(a,b,c,d,e){a.moveTo(b+d/4,c),a.lineTo(b,c+e),a.lineTo(b+d,c+e),a.lineTo(b+3*d/4,c),a.closePath()},_diamond:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b,c+e/2),a.lineTo(b+d/2,c+e),a.lineTo(b+d,c+e/2),a.closePath()},fill:function(a,b,c,d,e,f,g,h){var i=Wb[c];a.fillStyle=i?5===arguments.length?i(a,b,d,e.x,e.y,e.width,e.height):i(a,b,d,e,f,g,h):b},createRadialGradient:function(a,b,c,d,e,f,g,h,i){var j=a.createRadialGradient(d+f*h,e+g*i,Math.min(f,g)/24,d+f/2,e+g/2,Math.max(f,g)/2);return j.addColorStop(0,c),j.addColorStop(1,b),j},drawPath:function(a,b,c,d,e,f,g,h){var i=a._element,j=a.getBodyRect();d&&Rb.addPadding(j,i,c+".padding",1);var k=Hb.clone(j),l=i.getStyle(c+".outline.width");l>0&&Rb.grow(k,l/2,l/2);var m=a.setShadow(a,b,k);0!=i.getAngle()&&(i instanceof Nd||(j=i.getOriginalRect()),Gb.Util.rotateCanvas(m,j,i.getAngle()));var n,o=i.getStyle(c+".fill");if(o){n=a._innerColor&&!uc.hasDefault(a._element)?a._innerColor:i.getStyle(c+".fill.color");var p=i.getStyle(c+".gradient");p?Vb.fill(m,n,p,i.getStyle(c+".gradient.color"),j):m.fillStyle=n}var q=i.getStyle(c+".shape"),r=i.getStyle("group.shape.roundrect.radius");return o&&(m.beginPath(),f?Vb.drawLinePoints(m,f,null,g,h):"roundrect"===q&&"group"===c?Vb.drawVector(m,q,null,j,r):Vb.drawVector(m,q,null,j),m.fill()),l>0&&(m.lineWidth=l,m.lineCap=i.getStyle(c+".cap"),m.lineJoin=i.getStyle(c+".join"),m.strokeStyle=i.getStyle(c+".outline.color"),m.beginPath(),f?Vb.drawLinePoints(m,f,e,g,h):"roundrect"===q&&"group"===c?Vb.drawVector(m,q,e,j,r):Vb.drawVector(m,q,e,j),m.stroke()),k},draw3DRect:function(a,b,c,d,e,f,g){if(0!==c){arguments.length<=4&&(g=d.height,f=d.width,e=d.y,d=d.x);var h=c>0;c=Math.abs(c);var i,j;if(a.lineWidth=1,a.lineCap="square",1===c)i=Vb.brighter(b),j=Vb.darker(b),a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke();else for(var k=2*c,l=50/k,m=0;k>m;m++)i=Vb.brighter(b,50-m*l),j=Vb.darker(b,50-m*l),d+=.5,e+=.5,f-=1,g-=1,a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke()}},brighter:function(a,b){return b||(b=50),Vb.adjustBrightness2(a,b)},darker:function(a,b){return b||(b=50),Vb.adjustBrightness2(a,-b)},adjustBrightness2:function(a,b){var c,d,e;
if(0===b)return a;var f=rd(a);return 0>b?(b=(100+b)/100,c=Math.ceil(f.r*b),d=Math.ceil(f.g*b),e=Math.ceil(f.b*b)):(b/=100,c=f.r,d=f.g,e=f.b,c+=(255-c)*b,d+=(255-d)*b,e+=(255-e)*b,c=Math.min(Math.ceil(c),255),d=Math.min(Math.ceil(d),255),e=Math.min(Math.ceil(e),255)),"rgba("+c+","+d+","+e+",1)"},getColorArray:function(a){return qd.clearRect(0,0,1,1),qd.fillStyle=a,qd.fillRect(0,0,1,1),qd.getImageData(0,0,1,1).data},hit:function(a,b,c,d){if(!a)return!1;var e=a._viewRect;if(!e)return!1;if(b-=e.x,c-=e.y,0>b||0>c||b>=e.width||c>=e.height)return!1;try{for(var f=a.getContext("2d").getImageData(b,c,1,1),g=f.data,h=0,i=g.length;i>h;h+=4)if(0!==g[h+3])return!0}catch(j){return!0}return!1},intersects:function(a,b){if(!a)return!1;if(b=Rb.intersection(b,a._viewRect),!b)return!1;b.x-=a._viewRect.x,b.y-=a._viewRect.y;try{for(var c=a.getContext("2d").getImageData(b.x,b.y,b.width,b.height),d=c.data,e=0,f=d.length;f>e;e+=4)if(0!==d[e+3])return!0}catch(g){}return!1},strokeRect:function(a,b,c,d){b&&(a.beginPath(),a.strokeStyle=c?c:Gb.Util.randomColor(),a.lineWidth=d?d:2,a.strokeRect(b.x,b.y,b.width,b.height),a.stroke())}};Hb.g=Vb;var Wb={"linear.southwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e+g,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.southeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.northwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.northeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"radial.center":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.5,.5)},"radial.southwest":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.25,.75)},"radial.southeast":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.75,.75)},"radial.northwest":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.25,.25)},"radial.northeast":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.75,.25)},"radial.north":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.5,.25)},"radial.south":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.5,.75)},"radial.west":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.25,.5)},"radial.east":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.75,.5)},"spread.horizontal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.vertical":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.diagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.antidiagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h},"spread.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h}};Gb.Util={getVersion:function(){return"5.7.5"},registerImage:function(a,b,c,d,e){Hb.registerImage(a,b,c,d,e)},registerImageByUrl:function(a,b,c,d){if(b&&a&&a.indexOf(".json")>0){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a=JSON.parse(e.responseText);Gb.Util.registerImage(b,a),c&&c.invalidateElementUIs(),d&&d()}},e.open("GET",a,!0),e.send()}else{var f=new Nb;f.src=a,f.onload=function(){Gb.Util.registerImage(b,f,f.width,f.height),f.onload=null,c&&c.invalidateElementUIs(),d&&d()}}},getRegisteredImageNames:function(){return Hb.getRegisteredImageNames()},unregisterImage:function(a){Hb.unregisterImage(a)},getImageAsset:function(a){return Hb.getImageAsset(a)},validateLicense:function(a){Hb.validateLicense(a)},getLicense:function(){return Ib},isPermissionGIS:function(){return sc()},moveElements:function(a,b,c,d,e,f){if((0!==b||0!==c)&&a&&!a.isEmpty()){var g,h,i=Gb.animate.AnimateManager;i.endAnimate(),a=uc.filterMovingElements(a),d&&(g=new md,h=new md),a.forEach(function(a){a instanceof Ld&&(d?(g.add(a),h.add({x:a.getX()+b,y:a.getY()+c})):a.translate(b,c))}),d?i.start(new Gb.animate.AnimateLocation(g,h,e)):e&&e()}},isTypeOf:function(a,b){if(a===b)return!0;for(var c=a.superClass;c;){if(c===b.prototype)return!0;c=c.constructor.superClass}return!1},setFocus:function(a){if(Mb.activeElement!==a){var b,c,d,e=Mb.documentElement,f=Mb.body;e&&(Ob.isIE||Ob.isOpera||e.scrollLeft||e.scrollTop)?(b=e.scrollLeft,c=e.scrollTop,d=e):f&&(b=f.scrollLeft,c=f.scrollTop,d=f),a.focus(),d&&(d.scrollLeft=b,d.scrollTop=c)}},isOpera:Ob.isOpera,isIE:Ob.isIE,isFirefox:Ob.isFirefox,isChrome:Ob.isChrome,isSafari:Ob.isSafari,isIPhone:Ob.isIPhone,isIPod:Ob.isIPod,isIPad:Ob.isIPad,isAndroid:Ob.isAndroid,isWebOS:Ob.isWebOS,isTouchable:Ob.isTouchable,ext:function(a,b,c){Hb.ext(a,b,c)},getValue:function(a,b,c){return Hb.getValue(a,b,c)},setValue:function(a,b,c){Hb.setValue(a,b,c)},grow:function(a,b,c){Rb.grow(a,b,c)},containsPoint:function(a,b,c){return Rb.containsPoint.apply(null,arguments)},intersects:function(a,b){return Rb.intersects(a,b)},getRect:function(a){return Rb.getRect(a)},unionRect:function(a,b){return Rb.unionRect(a,b)},createDiv:function(){return Ub.createDiv()},createCanvas:function(){return Ub.createCanvas()},setCanvas:function(a,b,c,d,e){return Ub.setCanvas.apply(null,arguments)},drawVector:function(a,b,c,d,e,f,g){Vb.drawVector.apply(null,arguments)},fill:function(a,b,c,d,e,f,g,h){Vb.fill.apply(null,arguments)},getClass:function(a){return Hb.getClass(a)},getAllClassNames:function(){var a,b=[];for(a in Hb.classCache)b.push(a);return b},newInstance:function(a){return Hb.newInstance.apply(null,arguments)},isDeserializing:function(){return Hb.isDeserializing},addEventListener:function(a,b,c,d){Ub.addEventListener(a,b,c,d)},removeEventListener:function(a,b,c){Ub.removeEventListener(a,b,c)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l,m){nd.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(a,b,c,d,e){return Rb.calculatePointInfoAlongLineBySegments(a,b,c,d,e)},getSubNetwork:function(a){return uc.getSubNetwork(a)},transformPoint:function(a,b,c,d){return Rb.transformPoint(a,b,c,d)},getToolTipDiv:function(){return Ac.getToolTipDiv()},showToolTip:function(a,b){Ac.showToolTip(a,b)},hideToolTip:function(){Ac.hideToolTip()},resetToolTip:function(){Ac.resetToolTip()},setCSSStyle:function(a,b,c){Ub.setCSSStyle(a,b,c)},removeCSSStyle:function(a,b){Ub.removeCSSStyle(a,b)},getCSSStyle:function(a,b){return Ub.getCSSStyle(a,b)},toDegrees:function(a){return Rb.toDegrees(a)},toRadians:function(a){return Rb.toDegrees(a)},getRadiansBetweenLines:function(a,b){return Rb.getRadiansBetweenLines(a,b)},getElementsBounds:function(a,b){var c=null;return a.forEach(function(a){if(a.getRect){var d,e;b&&(e=b.getElementUI(a),e&&(d=e.getViewRect())),d||(d=a.getRect()),c=c?Gb.Util.unionRect(c,d):d}}),c},getPointIndex:function(a,b,c){if(c||(c=10),a)for(var d=a.size();d--;d>=0)if(Rb.getDistance(a.get(d),b)<=c)return d;return-1},registerVectorShape:function(a,b){Hb.g["_"+a]=b},rotateCanvas:function(a,b,c){a.translate(b.x+b.width/2,b.y+b.height/2),a.rotate(c*Math.PI/180),a.translate(-(b.x+b.width/2),-(b.y+b.height/2))},registerShape:function(a,b){ed(a,b)},registerDraw:function(a,b){dd(a,b)},getFilterColor:function(a,b){return sd(a,b)},registerGifImage:function(a,b){},parseVectorData:function(a){return Dc(a)},getSharedLinks:function(a,b){var c=a.getLinks(),d=b.getLinks();if(c&&0!=c.size()&&d&&0!=d.size()){var e=c.size()>d.size()?c:d;return e.toList(function(c){return c.getFromNode()==a&&c.getToNode()==b||c.getFromNode()==b&&c.getToNode()==a})}return null},isSharedLinks:function(a,b){var c=!1,d=a.getLinks(),e=b.getLinks();if(d&&0!=d.size()&&e&&0!=e.size()){var f=d.size()>e.size()?d:e;f.forEach(function(d){return d.getFromNode()==a&&d.getToNode()==b||d.getFromNode()==b&&d.getToNode()==a?(c=!0,!1):!0})}return c},playAnimate:function(a){return wb(a)},pauseAnimate:function(a){a.pause()},resumeAnimate:function(a){a.resume()},stopAnimate:function(a,b){xb(a,b)},pauseAllAnimates:function(){zb()},resumeAllAnimates:function(){Ab()},stopAllAnimates:function(a){yb(a)},randomColor:function(){return"#"+("00000"+(16777216*this.random()<<0).toString(16)).substr(-6)},random:function(){return Math.random()},getHSVColor:function(a,b,c){var d,e,f,g,h,i,j,k;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}var l="#"+toHex(255*d)+toHex(255*e)+toHex(255*f);return l},toHex:function(a){var b=parseInt(a).toString(16);return 1==b.length&&(b="0"+b),b},makeHighRes:function(a){var b=a.getContext("2d"),c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.width=Math.round(f*e),a.height=Math.round(g*e),a.style.width=f+"px",a.style.height=g+"px",b.scale(e,e)}},newFunction:function(){var a=arguments,b=a.length;return 1===b?Hb.newInstance("Function",a[0]):2===b?Hb.newInstance("Function",a[0],a[1]):3===b?Hb.newInstance("Function",a[0],a[1],a[2]):4===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3]):5===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4]):6===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4],a[5]):7===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4],a[5],a[6]):8===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]):null}},Hb.ext("twaver.Util",Object,{});var Xb,Yb=0xdeadbeefcafe,Zb=15715070==(16777215&Yb);Zb&&"Microsoft Internet Explorer"==Lb.appName?(a.prototype.am=d,Xb=30):Zb&&"Netscape"!=Lb.appName?(a.prototype.am=c,Xb=26):(a.prototype.am=e,Xb=28),a.prototype.DB=Xb,a.prototype.DM=(1<<Xb)-1,a.prototype.DV=1<<Xb;var $b=52;a.prototype.FV=Math.pow(2,$b),a.prototype.F1=$b-Xb,a.prototype.F2=2*Xb-$b;var _b,ac,bc="0123456789abcdefghijklmnopqrstuvwxyz",cc=new Array;for(_b="0".charCodeAt(0),ac=0;9>=ac;++ac)cc[_b++]=ac;for(_b="a".charCodeAt(0),ac=10;36>ac;++ac)cc[_b++]=ac;for(_b="A".charCodeAt(0),ac=10;36>ac;++ac)cc[_b++]=ac;C.prototype.convert=D,C.prototype.revert=E,C.prototype.reduce=F,C.prototype.mulTo=G,C.prototype.sqrTo=H,J.prototype.convert=K,J.prototype.revert=L,J.prototype.reduce=M,J.prototype.mulTo=O,J.prototype.sqrTo=N,a.prototype.copyTo=h,a.prototype.fromInt=j,a.prototype.fromString=l,a.prototype.clamp=m,a.prototype.dlShiftTo=t,a.prototype.drShiftTo=u,a.prototype.lShiftTo=v,a.prototype.rShiftTo=w,a.prototype.subTo=x,a.prototype.multiplyTo=y,a.prototype.squareTo=z,a.prototype.divRemTo=A,a.prototype.invDigit=I,a.prototype.isEven=P,a.prototype.exp=Q,a.prototype.toString=n,a.prototype.negate=o,a.prototype.abs=p,a.prototype.compareTo=q,a.prototype.bitLength=s,a.prototype.mod=B,a.prototype.modPowInt=R,a.ZERO=k(0),a.ONE=k(1),Ia.prototype.convert=Ja,Ia.prototype.revert=Ja,Ia.prototype.mulTo=Ka,Ia.prototype.sqrTo=La,Pa.prototype.convert=Qa,Pa.prototype.revert=Ra,Pa.prototype.reduce=Sa,Pa.prototype.mulTo=Ua,Pa.prototype.sqrTo=Ta;var dc=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ec=(1<<26)/dc[dc.length-1];a.prototype.chunkSize=W,a.prototype.toRadix=Y,a.prototype.fromRadix=Z,a.prototype.fromNumber=$,a.prototype.bitwiseTo=da,a.prototype.changeBit=ua,a.prototype.addTo=ya,a.prototype.dMultiply=Ga,a.prototype.dAddOffset=Ha,a.prototype.multiplyLowerTo=Na,a.prototype.multiplyUpperTo=Oa,a.prototype.modInt=Xa,a.prototype.millerRabin=$a,a.prototype.clone=S,a.prototype.intValue=T,a.prototype.byteValue=U,a.prototype.shortValue=V,a.prototype.signum=X,a.prototype.toByteArray=_,a.prototype.equals=aa,a.prototype.min=ba,a.prototype.max=ca,a.prototype.and=fa,a.prototype.or=ha,a.prototype.xor=ja,a.prototype.andNot=la,a.prototype.not=ma,a.prototype.shiftLeft=na,a.prototype.shiftRight=oa,a.prototype.getLowestSetBit=qa,a.prototype.bitCount=sa,a.prototype.testBit=ta,a.prototype.setBit=va,a.prototype.clearBit=wa,a.prototype.flipBit=xa,a.prototype.add=za,a.prototype.subtract=Aa,a.prototype.multiply=Ba,a.prototype.divide=Da,a.prototype.remainder=Ea,a.prototype.divideAndRemainder=Fa,a.prototype.modPow=Va,a.prototype.modInverse=Ya,a.prototype.pow=Ma,a.prototype.gcd=Wa,a.prototype.isProbablePrime=Za,a.prototype.square=Ca,_a.prototype.init=ab,_a.prototype.next=bb;var fc,gc,hc,ic=256;if(null==gc){gc=new Array,hc=0;var jc;if("Netscape"==Lb.appName&&Lb.appVersion<"5"&&window.crypto){var kc=window.crypto.random(32);for(jc=0;jc<kc.length;++jc)gc[hc++]=255&kc.charCodeAt(jc)}for(;ic>hc;)jc=Math.floor(65536*Gb.Util.random()),gc[hc++]=jc>>>8,gc[hc++]=255&jc;hc=0,eb()}hb.prototype.nextBytes=gb,kb.prototype.doPublic=mb,kb.prototype.setPublic=lb,kb.prototype.encrypt=nb,kb.prototype.doPrivate=rb,kb.prototype.setPrivate=pb,kb.prototype.setPrivateEx=qb,kb.prototype.decrypt=sb;var lc=function(){mc.v(Ib)},mc={},nc="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",oc="10001",pc="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";mc.cross=function(a){if(a){for(var b="",c=0;c<a.length;)c+1<a.length?(b+=a[c+1],b+=a[c]):b+=a[c],c+=2;return b}return null},mc.reverse=function(a){if(a){for(var b="",c=a.length;c>0;c--)b+=a[c-1];return b}return null},mc.v=function(a){if(a){var b=mc;if(b.start=null,b.beginDate=null,b.end=null,b.endDate=null,b.gis=null,b["3D"]=null,b["3d"]=null,b.l=null,b.__li__=null,a.indexOf("signature=")>0){var c=a.split("signature="),d=c[0],e=c[1],f=new kb;f.setPublic(nc,oc);for(var g=e,h=g.length,i=256,j=0,k="",l="";h>j;)k=g.substr(j,i),l+=f.decrypt(k),j+=i;if(l===d)return b.i(a),!0}}return!1},mc.i=function(a){var b=mc;b.__li__=a;var c,d,e,f,g,h=a.split("\n");for(c=h.length-1;c>=0;c--)d=h[c],g=d.split("="),e=g[0],f=g[1],b[e]=f;void 0!=b.start&&(b.beginDate=new Date(Date.parse(b.start.replace(/-/g,"/")))),void 0!=b.end&&(b.endDate=new Date(Date.parse(b.end.replace(/-/g,"/"))));var i=b.gis;void 0!=i&&(i=parseInt(i)),i&&(b._isPermissionGIS=!0);var j=b["3D"]||b["3d"];void 0!=j&&(j=parseInt(j)),j&&(b._isPermission3D=!0),b["3D"]&&(b._isPermission3D=!0),void 0!=b.l&&(b.version=b.l)};var qc=function(a){return void 0!==a.__li__&&!a._isPermission3D},rc=function(a){if(!qc(a))return!0;var b=new Date;return null!=a.beginDate&&a.beginDate.getTime()-b.getTime()>=0||null!=a.endDate&&a.endDate.getTime()-b.getTime()<=0},sc=function(){return rc(mc)?!1:mc._isPermissionGIS};mc.$z=function(a){var b=new kb;b.setPublic(nc,oc);for(var c=a,d=c.length,e=256,f=0,g="",h="";d>f;)g=c.substr(f,e),h+=b.decrypt(g),f+=e;return h},mc.twm=function(a){var b=mc,c=b.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),d=this.type,e=this.markText,f=b.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");if(a[f]=b.__li__,"3"!==d||rc(mc)||void 0!==e){void 0==a.__liLabel&&(a.__liLabel=Mb.createElement("div")),void 0===b.startDate&&(b.startDate=new Date);var g=(new Date).getTime()-b.startDate.getTime();if(!(3e5>g)){var h=rc(b)&&g>3e5,i=e;if(h?i=b.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=d||void 0!==i&&""!=i?"1"!=d||e||(i=c):i=b.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),void 0!==i){var j=a,k=j.__liLabel;if(k.innerHTML=i,j._rootCanvas)k.type=d,k.mark=e,k.expired=h,j._xyz=k;else{var l=0,m=0;k.style.position="absolute";var n=j.getView().style;void 0!=e&&null!=e&&""!=e||"2"==d?(l=10-j.getView().scrollLeft,m=10-j.getView().scrollTop):(l=n.width.replace("px","")/2-50-j.getView().scrollLeft,m=n.height.replace("px","")/2-j.getView().scrollTop),k.style.right=l+"px",k.style.bottom=m+"px",k.style.fontSize="120%",h&&(j.getView().style.opacity=.1,k.style.color="red",k.style.fontSize="150%"),j.getView().appendChild(k)}}}}},Hb.validateLicense(Ib);var tc=function(a,b,c){this.g=a,this.onLength=b,this.offLength=c,this.isLine=!0,this.overflow=0,this.dashLength=b+c,this.pen={x:0,y:0}};Hb.ext(tc,Object,{_curveaccuracy:6,moveTo:function(a,b){this.pen={x:a,y:b},this.g.moveTo(a,b),this.start||(this.start={x:a,y:b})},lineTo:function(a,b){var c=a-this.pen.x,d=b-this.pen.y,e=Math.atan2(d,c),f=Math.cos(e),g=Math.sin(e),h=this.lineLength(this.pen.x,this.pen.y,a,b);if(this.overflow){if(this.overflow>h)return this.isLine?this._lineTo(a,b):this.moveTo(a,b),void(this.overflow-=h);if(this.isLine?this._lineTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow):this.moveTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow),h-=this.overflow,this.overflow=0,this.isLine=!this.isLine,!h)return}var i=Math.floor(h/this.dashLength);if(i){for(var j=f*this.onLength,k=g*this.onLength,l=f*this.offLength,m=g*this.offLength,n=0;i>n;n++)this.isLine?(this._lineTo(this.pen.x+j,this.pen.y+k),this.moveTo(this.pen.x+l,this.pen.y+m)):(this.moveTo(this.pen.x+l,this.pen.y+m),this._lineTo(this.pen.x+j,this.pen.y+k));h-=this.dashLength*i}this.isLine?h>this.onLength?(this._lineTo(this.pen.x+f*this.onLength,this.pen.y+g*this.onLength),this.moveTo(a,b),this.overflow=this.offLength-(h-this.onLength),this.isLine=!1):(this._lineTo(a,b),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-h,this.moveTo(a,b))):h>this.offLength?(this.moveTo(this.pen.x+f*this.offLength,this.pen.y+g*this.offLength),this._lineTo(a,b),this.overflow=this.onLength-(h-this.offLength),this.isLine=!0):(this.moveTo(a,b),h==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-h)},quadraticCurveTo:function(a,b,c,d){var e,f=this.pen.x,g=this.pen.y,h=this.curveLength(f,g,a,b,c,d),i=0,j=0;if(this.overflow){if(this.overflow>h)return this.isLine?this._curveTo(a,b,c,d):this.moveTo(c,d),void(this.overflow-=h);if(i=this.overflow/h,e=this.curveSliceUpTo(f,g,a,b,c,d,i),this.isLine?this._curveTo(e[2],e[3],e[4],e[5]):this.moveTo(e[4],e[5]),this.overflow=0,this.isLine=!this.isLine,!h)return}var k=h-h*i,l=Math.floor(k/this.dashLength),m=this.onLength/h,n=this.offLength/h;if(l)for(var o=0;l>o;o++)this.isLine?(j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5]),i=j,j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5])):(j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5]),i=j,j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5])),i=j;k=h-h*i,this.isLine?k>this.onLength?(j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5]),this.moveTo(c,d),this.overflow=this.offLength-(k-this.onLength),this.isLine=!1):(e=this.curveSliceFrom(f,g,a,b,c,d,i),this._curveTo(e[2],e[3],e[4],e[5]),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-k,this.moveTo(c,d))):k>this.offLength?(j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5]),e=this.curveSliceFrom(f,g,a,b,c,d,j),this._curveTo(e[2],e[3],e[4],e[5]),this.overflow=this.onLength-(k-this.offLength),this.isLine=!0):(this.moveTo(c,d),k==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-k)},bezierCurveTo:function(a,b,c,d,e,f){this.pen={x:e,y:f};var g=[this.onLength,this.offLength];this.g.setLineDash&&this.g.setLineDash(g),this.g.lineDash=g,this.g.bezierCurveTo(a,b,c,d,e,f)},rect:function(a,b,c,d){this.pen={x:a,y:b},this.moveTo(a,b),this.lineTo(a,b+d),this.lineTo(a+c,b+d),this.lineTo(a+c,b),this.lineTo(a,b)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},curveLength:function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o=0,p=a,q=b,r=g>0?g:this._curveaccuracy,s=1;r>=s;s++)j=s/r,k=1-j,l=k*k,m=2*j*k,n=j*j,h=l*a+m*c+n*e,i=l*b+m*d+n*f,o+=this.lineLength(p,q,h,i),p=h,q=i;return o},curveSlice:function(a,b,c,d,e,f,g,h){if(0==g)return this.curveSliceUpTo(a,b,c,d,e,f,h);if(1==h)return this.curveSliceFrom(a,b,c,d,e,f,g);var i=this.curveSliceUpTo(a,b,c,d,e,f,h);return i.push(g/h),this.curveSliceFrom.apply(this,i)},curveSliceUpTo:function(a,b,c,d,e,f,g){if(1!=g){var h=c+(e-c)*g,i=d+(f-d)*g;c=a+(c-a)*g,d=b+(d-b)*g,e=c+(h-c)*g,f=d+(i-d)*g}return[a,b,c,d,e,f]},curveSliceFrom:function(a,b,c,d,e,f,g){if(1!=g){var h=a+(c-a)*g,i=b+(d-b)*g;c+=(e-c)*g,d+=(f-d)*g,a=h+(c-h)*g,b=i+(d-i)*g}return[a,b,c,d,e,f]},_lineTo:function(a,b){(a!=this.pen.x||b!=this.pen.y)&&(this.pen={x:a,y:b},this.g.lineTo(a,b))},_curveTo:function(a,b,c,d){(a!=c||b!=d||c!=this.pen.x||d!=this.pen.y)&&(this.pen={x:c,y:d},this.g.quadraticCurveTo(a,b,c,d))}}),Hb.DashedLine=tc;var uc={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(a){if(a instanceof Ld){var b=a.getStyle("body.type");return 1===uc.DEFAULTS[b]}return!0},hasVector:function(a){if(a instanceof Ld){var b=a.getStyle("body.type");return 1===uc.VECTORS[b]}return!1},hasAgentLinks:function(a){for(var b=a.getChildrenSize(),c=0;b>c;c++){var d=a.getChildAt(c);if(d instanceof Ld&&uc.hasAgentLinks(d))return!0}return a.hasAgentLinks()},getParents:function(a,b,c){c||(c=!0);for(var d=new md,e=a._parent;null!=e&&e!==b;)d.add(e,0),e=e._parent;return c&&null!=e&&e===b&&d.add(e,0),d},getSubNetwork:function(a){if(!a)return null;if(a instanceof Gb.Link){var b=a._fromAgent,c=a._toAgent;if(!b||!c)return null;var d=uc.getSubNetwork(b),e=uc.getSubNetwork(c);return d===e?d:null}var f=a._parent;if(!f)return null;for(;f instanceof Gb.Link&&!f.ISubNetwork;)f=f._parent;return f.ISubNetwork?f:uc.getSubNetwork(f)},figureSameSubNetworkAgent:function(a){if(!a)return null;for(var b=a._parent;b instanceof Nd;){if(!(b._parent instanceof Nd))return b.isExpanded()?a:b;b.isExpanded()||(a=b),b=b._parent}return a},figureSpanSubNetworkAgent:function(a,b){if(!a||!b)return null;var c=uc.getSubNetwork(a),d=uc.getSubNetwork(b);if(c!=d){for(;null!=d&&c!=d;)d=uc.getSubNetwork(d);if(c===d)return a;var e=new md;e.add(a,0);for(var f=a._parent;f instanceof Ld&&!b.isDescendantOf(f);)e.add(f,0),f=f._parent;for(var g=e.size(),h=0;g>h;h++){var i=e.get(h);if(i instanceof Nd&&!i.isExpanded())return i;if(i.ISubNetwork)return i}return a}return a},figureFromAgent:function(a){if(a.isLooped())return a.getFromNode();var b=uc.figureSameSubNetworkAgent(a.getFromNode()),c=uc.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getFromNode():uc.figureSpanSubNetworkAgent(b,c)},figureToAgent:function(a){if(a.isLooped())return a.getToNode();var b=uc.figureSameSubNetworkAgent(a.getFromNode()),c=uc.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getToNode():uc.figureSpanSubNetworkAgent(c,b)},getBundleLinks:function(a,b){if(!a||!b)return null;var c,d,e,f;if(a===b){if(f=a.getLoopedLinks(),!f)return null;f=new md(f)}else{var g=a.getAgentLinks(),h=b.getAgentLinks();if(!g||!h)return null;for(d=g.size(),c=0;d>c;c++)e=g.get(c),h.contains(e)&&(f||(f=new md),f.add(e))}if(null!=f)for(c=0;c<f.size();c++)e=f.get(c),e.getStyle("link.bundle.enable")||(e._setBundleLinks(null),f.removeAt(c),c--);return f},resetBundleLinks:function(a,b){var c=uc.getBundleLinks(a,b);if(c&&0!==c.size()){var d=null;if(1===c.size())return d=c.get(0),void d._setBundleLinks(null);var e,f,g=new md;for(e=0;e<c.size();e++)d=c.get(e),f=d.getStyle("link.bundle.id"),g.indexOf(f)<0&&g.add(f);g.sort();var h,i,j=new md;for(i=0;i<g.size();i++){f=g.get(i);var k=new md;for(e=0;e<c.size();e++)d=c.get(e),f===d.getStyle("link.bundle.id")&&k.add(d);h=new Gb.BundleLinks(k,j),j.add(h)}for(i=0;i<j.size();i++)for(h=j.get(i),e=0;e<h.getLinks().size();e++)d=h.getLinks().get(e),d._setBundleLinks(h)}},moveElements:function(a,b,c,d){for(var e=uc.filterMovingElements(a,d),f=e.size(),g=0;f>g;g++)e.get(g).translate(b,c)},filterMovingElements:function(a,b){for(var c=new md,d=a.size(),e=0;d>e;e++){var f=a.get(e);if(f instanceof Ld&&(!b||b(f))){for(var g=!0,h=c.toArray(),i=0;i<h.length;i++){var j=h[i];g&&j instanceof Gb.Follower&&f instanceof Gb.Follower&&f.isLoopedHostOn(j)?g=!1:j instanceof Gb.Follower&&j.isHostOn(f)?c.remove(j):g&&f instanceof Gb.Follower&&j instanceof Ld&&f.isHostOn(j)?g=!1:uc.isDescendantOfGroup(j,f)?c.remove(j):g&&uc.isDescendantOfGroup(f,j)&&(g=!1)}g&&c.add(f)}}return c},isDescendantOfGroup:function(a,b){if(!(a&&b instanceof Nd))return!1;if(!b.hasChildren())return!1;for(a=a._parent;a instanceof Nd;){if(a===b)return!0;a=a._parent}return!1}};Hb.element=uc;var vc={between:function(a,b,c){return c>=a&&b>=c?!0:c>=b&&a>=c?!0:!1},considerEast:function(a,b,c){return b?vc.between(b.x,c.x,a.x)?c.x>b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerWest:function(a,b,c){return b?vc.between(b.x,c.x,a.x)?c.x<b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerNorth:function(a,b,c){return b?vc.between(b.y,c.y,a.y)?c.y<b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},considerSouth:function(a,b,c){return b?vc.between(b.y,c.y,a.y)?c.y>b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},getHorizontalPoint:function(a,b,c){return vc.between(b.x,c.x,a.x)?{x:a.x,y:b.y}:Math.abs(a.x-b.x)<Math.abs(a.x-c.x)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getVerticalPoint:function(a,b,c){return vc.between(b.y,c.y,a.y)?{x:b.x,y:a.y}:Math.abs(a.y-b.y)<Math.abs(a.y-c.y)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getPoint:function(a,b,c,d,e){var f=Math.abs(d.x-c.x)>Math.abs(d.y-c.y);if("south"===e)return f&&vc.considerSouth(b,a,c)?vc.getHorizontalPoint(b,c,d):null;if("north"===e)return f&&vc.considerNorth(b,a,c)?vc.getHorizontalPoint(b,c,d):null;if("west"===e)return!f&&vc.considerWest(b,a,c)?vc.getVerticalPoint(b,c,d):null;if("east"===e)return!f&&vc.considerEast(b,a,c)?vc.getVerticalPoint(b,c,d):null;if("nearby"===e){var g;return g=f?vc.getHorizontalPoint(b,c,d):vc.getVerticalPoint(b,c,d),!a||Rb.getDistance(a,b)>Rb.getDistance(g,b)?g:null}return null},getBusPoint:function(a,b,c){var d,e=a.size();if(e>0){for(var f=a.get(0),g=1;e>g;g++){var h=a.get(g),i=vc.getPoint(d,b,f,h,c);i&&(d=i),f=h}d||(d={x:f.x,y:f.y})}return d}};Hb.bus=vc;var wc={createFromPoint:function(a,b){var c=a._element;if(!c.getFromAgent())return{x:0,y:0};var d,e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset"),h=c.getStyle("link.from.percent");if(h&&h instanceof Array&&2===h.length&&h[0]<=1&&h[0]>=0&&h[1]<=1&&h[1]>=0){var i=c.getFromAgent(),j=i.getSize(),k=i.getRect().x+j.width*h[0],l=i.getRect().y+j.height*h[1];return{x:k,y:l}}if(a._network._edgeDetect){var i=c.getFromAgent(),m=c.getToAgent(),n=i.getImage(),o=Hb.images[n],p=i.getCenterLocation(),q=m.getCenterLocation(),r=this._getPointAngleDegree(q.x,q.y,p.x,p.y),s={x:0,y:0};if(o){var t=o._image;if(t&&bd(t)||t&&Gb.Util.getImageAsset(n)._cache)return bd(t)?o._edgeData||(o._edgeData=o._createEdgeData(t,i._width,i._height)):"object"==typeof t&&(o._edgeData||(o._edgeData=o._createEdgeData(Gb.Util.getImageAsset(n)._cache,i.getWidth(),i.getHeight()))),s.x=o._edgeData[r].x+i.getRect().x,s.y=o._edgeData[r].y+i.getRect().y,s}}if(!Hb.isCalculatingBus){if(Hb.isCalculatingBus=!0,c.getFromAgent()instanceof Gb.Bus){var u=c.getFromAgent();if(uc.hasVector(u)){var v=b?b._getElementZoomRect(a,u.getRect()):u.getRect(),w=u.getStyle("vector.shape");if("oval"===w)d=Rb.getEllipsePoint(v,wc.createToPoint(a));else if("circle"===w)d=Rb.getEllipsePoint(Rb.getCircleRect(v),wc.createToPoint(a));else if("rectangle"===w||"roundrect"===w){var x=new md;x.add({x:u.x,y:u.y}),x.add({x:u.x+u.width,y:u.y}),x.add({x:u.x+u.width,y:u.y+u.height}),x.add({x:u.x,y:u.y+u.height}),x.add({x:u.x,y:u.y}),x=b?b._getShapeNodeZoomPoints(a,x):x,d=vc.getBusPoint(x,wc.createToPoint(a),u.getStyle("bus.style"))}}else{var x=b?b._getShapeNodeZoomPoints(a,u.getPoints()):u.getPoints();d=vc.getBusPoint(x,wc.createToPoint(a),u.getStyle("bus.style"))}}Hb.isCalculatingBus=!1}return d?(d.x+=f,d.y+=g):d=a._network.getPosition(e,c.getFromAgent(),null,f,g,!0),d},createToPoint:function(a,b){var c=a._element;if(!c.getToAgent())return{x:0,y:0};var d,e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset"),h=c.getStyle("link.to.percent");if(h&&h instanceof Array&&2===h.length&&h[0]<=1&&h[0]>=0&&h[1]<=1&&h[1]>=0){var i=c.getToAgent(),j=i.getSize(),k=i.getRect().x+j.width*h[0],l=i.getRect().y+j.height*h[1];return{x:k,y:l}}if(a._network._edgeDetect){var m=c.getFromAgent(),i=c.getToAgent(),n=i.getImage(),o=Hb.images[n],p=m.getLocation(),q=i.getCenterLocation(),r=this._getPointAngleDegree(p.x,p.y,q.x,q.y),s={x:0,y:0};if(o){var t=o._image;if(t&&bd(t)||t&&Gb.Util.getImageAsset(n)._cache)return bd(t)?o._edgeData||(o._edgeData=o._createEdgeData(t,i.getWidth(),i.getHeight())):"object"==typeof t&&(o._edgeData||(o._edgeData=o._createEdgeData(Gb.Util.getImageAsset(n)._cache,i.getWidth(),i.getHeight()))),s.x=o._edgeData[r].x+i.getRect().x,s.y=o._edgeData[r].y+i.getRect().y,s}}if(!Hb.isCalculatingBus){if(Hb.isCalculatingBus=!0,c.getToAgent()instanceof Gb.Bus){var u=c.getToAgent();if(uc.hasVector(u)){var v=b?b._getElementZoomRect(a,u.getRect()):u.getRect(),w=u.getStyle("vector.shape");if("oval"===w)d=Rb.getEllipsePoint(v,wc.createFromPoint(a));else if("circle"===w)d=Rb.getEllipsePoint(Rb.getCircleRect(v),wc.createFromPoint(a));else if("rectangle"===w||"roundrect"===w){var x=new md;x.add({x:u.x,y:u.y
}),x.add({x:u.x+u.width,y:u.y}),x.add({x:u.x+u.width,y:u.y+u.height}),x.add({x:u.x,y:u.y+u.height}),x.add({x:u.x,y:u.y}),x=b?b._getShapeNodeZoomPoints(a,x):x,d=vc.getBusPoint(x,wc.createFromPoint(a),u.getStyle("bus.style"))}}else{var x=b?b._getShapeNodeZoomPoints(a,u.getPoints()):u.getPoints();d=vc.getBusPoint(x,wc.createFromPoint(a),u.getStyle("bus.style"))}}Hb.isCalculatingBus=!1}return d?(d.x+=f,d.y+=g):d=a._network.getPosition(e,c.getToAgent(),null,f,g,!0),d},fillLoopedPoints:function(a,b,c){var d,e=wc.getBundleGap(a,!0),f=e,g=a.getStyle("link.looped.type"),h=a.getStyle("link.looped.direction");if("north"===h)return"arc"===g?wc.drawArc(b.x+b.width/2,b.y,0,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y},c.add({x:d.x+f,y:d.y}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width/2,y:b.y-e};if("northeast"===h)return"arc"===g?wc.drawArc(b.x+b.width,b.y,1.5*Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x+f,y:d.y+f}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+.707*e,y:b.y-.707*e};if("east"===h)return"arc"===g?wc.drawArc(b.x+b.width,b.y+b.height/2,1.5*Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+e,y:d.y-f}),c.add({x:d.x+e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x+b.width+e,y:b.y+b.height/2};if("southeast"===h)return"arc"===g?wc.drawArc(b.x+b.width,b.y+b.height,Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+f,y:d.y-f}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+.707*e,y:b.y+b.height+.707*e};if("south"===h)return"arc"===g?wc.drawArc(b.x+b.width/2,b.y+b.height,Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y+b.height},c.add({x:d.x-f,y:d.y}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x+b.width/2,y:b.y+b.height+e};if("southwest"===h)return"arc"===g?wc.drawArc(b.x,b.y+b.height,.5*Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-f,y:d.y-f}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x-.707*e,y:b.y+b.height+.707*e};if("west"===h)return"arc"===g?wc.drawArc(b.x,b.y+b.height/2,.5*Math.PI,Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-e,y:d.y-f}),c.add({x:d.x-e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x-e,y:b.y+b.height/2};if("northwest"===h)return"arc"===g?wc.drawArc(b.x,b.y,0,1.5*Math.PI,e,e,!1,c):(d={x:b.x,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x-f,y:d.y+f}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x+f,y:d.y})),{x:b.x-.707*e,y:b.y-.707*e};throw"Can not resolve link looped direction '"+h+"'"},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if(Math.abs(d)>2*Math.PI&&(d=2*Math.PI),m=Math.ceil(Math.abs(d)/(Math.PI/4)),i=d/m,j=-i,k=-c,m>0){n=a+Math.cos(c)*e,o=b+Math.sin(-c)*f,h.add({x:n,y:o});for(var t=0;m>t;t++){k+=j,l=k-j/2,p=a+Math.cos(k)*e,q=b+Math.sin(k)*f,r=a+Math.cos(l)*(e/Math.cos(j/2)),s=b+Math.sin(l)*(f/Math.cos(j/2));var u=new md;u.add({x:r,y:s}),u.add({x:p,y:q}),h.add(u)}}},fillBundlePoints:function(a,b,c,d,e,f){var g;if(a._element.getBundleCount(),a._element.getBundleIndex(),a.getStyle("link.bundle.expanded"),"parallel"!==b&&0===(g=wc.getBundleGap(a,!1)))return e.add(c),e.add(d),Rb.getCenterPoint(c,d);void 0===g&&(g=wc.getBundleGap(a,!1));var h=wc.getBundleOffset(a),i=Rb.getDistance(c,d);if(f){var j=f.getSizeZoom();h*=j,g*=j}("arc"===b||"triangle"===b)&&e.add({x:0,y:0}),"arc"===b&&e.add({x:0,y:g}),e.add({x:h,y:g}),e.add({x:i-h,y:g}),"arc"===b&&e.add({x:i,y:g}),("arc"===b||"triangle"===b)&&e.add({x:i,y:0});for(var k=Math.atan2(d.y-c.y,d.x-c.x),l=Rb.createMatrix(k,0,0),m=0,n=e.size();n>m;m++){var o=e.get(m);o=l.transform(o),o.x+=c.x,o.y+=c.y,e.set(m,o)}if("arc"===b){var p=Rb.getCenterPoint(e.get(2),e.get(3)),q=new md;return q.add(e.get(1)),q.add(e.get(2)),e.set(1,q),q=new md,q.add(e.get(4)),q.add(e.get(5)),e.set(4,q),e.removeAt(5),e.removeAt(2),p}return wc.calculateCenterPoint(e)},calculateCenterPoint:function(a){var b=a.size();if(null==a||1>b)return{x:0,y:0};if(b%2===0){var c=b/2,d=a.get(c-1),e=a.get(c);return{x:(d.x+e.x)/2,y:(d.y+e.y)/2}}return a.get((b-1)/2)},getBundleOffset:function(a){var b=Rb.getDistance(a.getFromPoint(),a.getToPoint()),c=a.getStyle("link.bundle.offset");return b>2*c?c:b/2},getBundleGap:function(a,b){var c=a._element;if(!c.getBundleLinks())return b?c.getStyle("link.looped.gap"):0;for(var d=b?"link.looped.gap":"link.bundle.gap",e=null,f=0,g=0,h=c.getBundleLinks().getSiblings(),i=0,j=c.getStyle("link.bundle.independent"),k=c.getStyle("link.bundle.group.gap"),l=0,m=h.size();m>l;l++){var n=h.get(l);if(!j||n===c.getBundleLinks()){for(var o=0,p=n.getLinks().size();p>o;o++){var q=n.getLinks().get(o);if(j===q.getStyle("link.bundle.independent")&&a._network.isVisible(q)){if(null==e)e=q,i=q.getStyle(d);else{var r=q.getStyle(d);g+=i/2+r/2,i=r}q===c&&(f=g+k/2)}}g+=k}}if(b)return g-f+i;var s=f-g/2;return null!=e&&c.getFromAgent()!==e.getFromAgent()&&(s=-s),s},isTargetPriority:function(a,b,c){if(a){if(b.height<c.height)return b.height+c.height<Math.max(b.y+b.height,c.y+c.height)-Math.min(b.y,c.y)+b.height/2}else if(b.width<c.width)return b.width+c.width<Math.max(b.x+b.width,c.x+c.width)-Math.min(b.x,c.x)+b.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(a,b,c,d){var e=wc.isHorizontal(a,b,c,d),f=new md;if(wc.isFlexionalTypeLink(a))wc.flexional(e,b,c,f,d.getStyle("link.extend"));else{wc.orthogonal(a,b,c,f,e,d);var g=wc.isSplitByPercent(a,d),h=g?wc.calculateSplitValueByPercent(a,e,b,c,d.getStyle("link.split.percent")):d.getStyle("link.split.value");0===h&&(e=!e)}var i;0===f.size()?wc.isTargetPriority(e,b,c)?(i={x:c.x+c.width/2,y:c.y+c.height/2},f.add(wc.rectanglePerimeter(b,!0,i)),f.add(wc.rectanglePerimeter(c,!1,f.get(f.size()-1)))):(i={x:b.x+b.width/2,y:b.y+b.height/2},i=wc.rectanglePerimeter(c,!1,i),f.add(wc.rectanglePerimeter(b,!0,i)),f.add(i)):(i=f.get(0),f.add(wc.rectanglePerimeter(b,!0,i),0),f.add(wc.rectanglePerimeter(c,!1,f.get(f.size()-1))));var j=f.size();if(2>j)return f;for(var k=f.get(0),l=1;j-1>l;l++){var m=f.get(l);m.x===k.x&&m.y===k.y&&(f.remove(m),j--,l--),k=m}return f},isHorizontal:function(a,b,c,d){if(a){if("flexional.horizontal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"extend.left"===a||"extend.right"===a)return!0;if("flexional.vertical"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.bottom"===a)return!1}var e=wc.calculateXGap(b,c),f=wc.calculateYGap(b,c);return e>=f},flexional:function(a,b,c,d,e){a?wc.flexionalHorizontal(b,c,d,e):wc.flexionalVertical(b,c,d,e)},isSplitByPercent:function(a,b){return b.getStyle("link.split.by.percent")},isExtendTypeLink:function(a){return a&&("extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a)},isFlexionalTypeLink:function(a){return a&&("flexional"===a||"flexional.horizontal"===a||"flexional.vertical"===a)},calculateControlPoint:function(a,b,c,d,e){if("orthogonal.H.V"===a||"orthogonal.V.H"===a)return{x:d.x+d.width/2,y:d.y+d.height/2};var f;if(wc.isExtendTypeLink(a)){var g=Math.min(c.y,d.y),h=Math.min(c.x,d.x),i=Math.max(c.y+c.height,d.y+d.height),j=Math.max(c.x+c.width,d.x+d.width);if(f=e.getStyle("link.extend"),"extend.top"===a)return{x:(h+j)/2,y:g-f};if("extend.left"===a)return{x:h-f,y:(g+i)/2};if("extend.bottom"===a)return{x:(h+j)/2,y:i+f};if("extend.right"===a)return{x:j+f,y:(g+i)/2}}var k=wc.isSplitByPercent(a,e);if(f=k?wc.calculateSplitValueByPercent(a,b,c,d,e.getStyle("link.split.percent")):e.getStyle("link.split.value"),f===Number.NEGATIVE_INFINITY||f===Number.POSITIVE_INFINITY)return{x:d.x+d.width/2,y:d.y+d.height/2};if(0===f)return{x:c.x+c.width/2,y:c.y+c.height/2};if(b){var l=c.x+c.x+c.width<d.x+d.x+d.width;return{x:wc.calculateSplitLocation(l,f,c.x,c.width),y:c.y+c.height/2}}var m=c.y+c.y+c.height<d.y+d.y+d.height;return{x:c.x+c.width/2,y:wc.calculateSplitLocation(m,f,c.y,c.height)}},calculateGap:function(a,b,c,d){var e=Math.max(b,d)-Math.min(a,c);return e-(b-a+d-c)},calculateXGap:function(a,b){var c=Math.max(a.x+a.width,b.x+b.width)-Math.min(a.x,b.x);return c-a.width-b.width},calculateYGap:function(a,b){var c=Math.max(a.y+a.height,b.y+b.height)-Math.min(a.y,b.y);return c-a.height-b.height},calculateSplitValueByPercent:function(a,b,c,d,e){var f=wc.calculateSplitGapByPercent(e,b,c,d);return f*e},calculateSplitGapByPercent:function(a,b,c,d,e){return b?wc._calculateSplitGapByPercent(a,c.x,c.x+c.width,d.x,d.x+d.width):wc._calculateSplitGapByPercent(a,c.y,c.y+c.height,d.y,d.y+d.height)},_calculateSplitGapByPercent:function(a,b,c,d,e){var f=wc.calculateGap(b,c,d,e),g=d+e>b+c;if(f>0){if(1===a)return f+(e-d)/2;if(a>=0&&1>a)return f;if(0>a)return g?d-b:c-e}return Math.abs(g&&a>0||!g&&0>a?c-e:b-d)},calculateSplitPercentByControlPoint:function(a,b,c,d){return b?wc.calculateSplitPercent(a.x,c.x,c.x+c.width,d.x,d.x+d.width):wc.calculateSplitPercent(a.y,c.y,c.y+c.height,d.y,d.y+d.height)},calculateSplitPercent:function(a,b,c,d,e){if(a>=b&&c>=a)return 0;var f=wc.calculateGap(b,c,d,e);if(f>0&&a>=d&&e>=a)return 1;var g=d+e>b+c;if(f>0){if(a>Math.min(c,e)&&a<Math.max(b,d))return Math.abs(a-(g?c:b))/f;if(g){if(b>a)return(a-b)/(d-b)}else if(a>c)return(c-a)/(c-e)}return a>c?(g?a-c:c-a)/Math.abs(c-e):(g?a-b:b-a)/Math.abs(b-d)},calculateSplitLocation:function(a,b,c,d){return a===b>0?c+d+Math.abs(b):c-Math.abs(b)},calculateAngle:function(a,b){if(0!==a&&0!==b)return Math.atan2(a,b);if(0===a){if(b>0)return 0;if(0>b)return Math.PI}return a>0?Math.PI/2:-Math.PI/2},drawCorner:function(a,b){var c=a.size();if(!(3>c)){var d=b.getStyle("link.corner");if("none"!==d){for(var e,f,g,h,i=b.getStyle("link.xradius"),j=b.getStyle("link.yradius"),k=a.get(0),l=a.get(1),m=2;c>m;m++){var n=a.get(m),o=l.x-k.x,p=l.y-k.y,q=n.x-l.x,r=n.y-l.y,s=0===p;if(0===o&&0===r||0===p&&0===q)if(s?(e=Math.min(2===m?Math.abs(o):Math.abs(o)/2,i),f=Math.min(m===c-1?Math.abs(r):Math.abs(r)/2,j),g={x:l.x-(o>0?e:-e),y:l.y},h={x:l.x,y:l.y+(r>0?f:-f)}):(e=Math.min(m===c-1?Math.abs(q):Math.abs(q)/2,i),f=Math.min(2===m?Math.abs(p):Math.abs(p)/2,j),g={x:l.x,y:l.y-(p>0?f:-f)},h={x:l.x+(q>0?e:-e),y:l.y}),a.remove(l),m--,c--,(g.x!==k.x||g.y!==k.y)&&(a.add(g,m),m++,c++),"bevel"===d)a.add(h,m),m++,c++;else if("round"===d){var t=new md;t.add(l),t.add(h),a.add(t,m),m++,c++}k=l,l=n}h&&h.x===l.x&&h.y===l.y&&a.remove(l)}}},orthogonal:function(a,b,c,d,e,f){var g=f.getStyle("link.control.point"),h=null==g;if(g){var i=Rb.unionRect(b,c);Rb.containsPoint(i,g)||(e=wc.calculateIsHorizontalByControlPoint(g.x,g.y,i.y,i.x,i.y+i.height,i.x+i.width))}else g=wc.calculateControlPoint(a,e,b,c,f);e?wc.sideToSide(b,c,g,d,h):wc.topToBottom(b,c,g,d,h)},calculateIsHorizontalByControlPoint:function(a,b,c,d,e,f){return c>b&&c-b>d-a&&c-b>a-f||b>e&&b-e>d-a&&b-e>a-f?!1:!0},contains:function(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height},topToBottom:function(a,b,c,d,e){var f=Math.max(a.y,b.y),g=Math.min(a.y+a.height,b.y+b.height),h=c?c.y:g+(f-g)/2,i=a.x+a.width/2,j=b.x+b.width/2;if(!e&&c&&(c.x>=a.x&&c.x<=a.x+a.width&&(i=c.x),c.x>=b.x&&c.x<=b.x+b.width&&(j=c.x)),wc.contains(b,i,h)||wc.contains(a,i,h)||d.add({x:i,y:h}),wc.contains(b,j,h)||wc.contains(a,j,h)||d.add({x:j,y:h}),0===d.size())if(c)wc.contains(b,c.x,h)||wc.contains(a,c.x,h)||d.add({x:c.x,y:h});else{var k=Math.max(a.x,b.x),l=Math.min(a.x+a.width,b.x+b.width);d.add({x:k+(l-k)/2,y:h})}},sideToSide:function(a,b,c,d,e){var f=Math.max(a.x,b.x),g=Math.min(a.x+a.width,b.x+b.width),h=c?c.x:g+(f-g)/2,i=a.y+a.height/2,j=b.y+b.height/2;if(!e&&c&&(c.y>=a.y&&c.y<=a.y+a.height&&(i=c.y),c.y>=b.y&&c.y<=b.y+b.height&&(j=c.y)),wc.contains(b,h,i)||wc.contains(a,h,i)||d.add({x:h,y:i}),wc.contains(b,h,j)||wc.contains(a,h,j)||d.add({x:h,y:j}),0===d.size())if(c)wc.contains(b,h,c.y)||wc.contains(a,h,c.y)||d.add({x:h,y:c.y});else{var k=Math.max(a.y,b.y),l=Math.min(a.y+a.height,b.y+b.height);d.add({x:h,y:k+(l-k)/2})}},flexionalHorizontal:function(a,b,c,d){var e=b.x+b.width<a.x,f=a.x+a.width<b.x,g=e?a.x:a.x+a.width,h=a.y+a.height/2,i=f?b.x:b.x+b.width,j=b.y+b.height/2,k=d,l=e?-k:k,m={x:g+l,y:h};l=f?-k:k;var n={x:i+l,y:j};if(e===f){var o=e?Math.min(g,i)-d:Math.max(g,i)+d;c.add({x:o,y:h}),c.add({x:o,y:j})}else if(m.x<n.x===e){var p=h+(j-h)/2;c.add(m),c.add({x:m.x,y:p}),c.add({x:n.x,y:p}),c.add(n)}else c.add(m),c.add(n)},flexionalVertical:function(a,b,c,d){var e=b.y+b.height<a.y,f=a.y+a.height<b.y,g=a.x+a.width/2,h=e?a.y:a.y+a.height,i=b.x+b.width/2,j=f?b.y:b.y+b.height,k=d,l=e?-k:k,m={x:g,y:h+l};l=f?-k:k;var n={x:i,y:j+l};if(e===f){var o=e?Math.min(h,j)-d:Math.max(h,j)+d;c.add({x:g,y:o}),c.add({x:i,y:o})}else if(m.y<n.y===e){var p=g+(i-g)/2;c.add(m),c.add({x:p,y:m.y}),c.add({x:p,y:n.y}),c.add(n)}else c.add(m),c.add(n)},rectanglePerimeter:function(a,b,c){var d=a.x+a.width/2,e=a.y+a.height/2,f=c.x-d,g=c.y-e,h=Math.atan2(g,f),i={x:0,y:0},j=Math.PI,k=Math.PI/2,l=k-h,m=Math.atan2(a.height,a.width);return-j+m>h||h>j-m?(i.x=a.x,i.y=e-a.width*Math.tan(h)/2):-m>h?(i.y=a.y,i.x=d-a.height*Math.tan(l)/2):m>h?(i.x=a.x+a.width,i.y=e+a.width*Math.tan(h)/2):(i.y=a.y+a.height,i.x=d+a.height*Math.tan(l)/2),c.x>=a.x&&c.x<=a.x+a.width?i.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(i.y=c.y),c.x<a.x?i.x=a.x:c.x>a.x+a.width&&(i.x=a.x+a.width),c.y<a.y?i.y=a.y:c.y>a.y+a.height&&(i.y=a.y+a.height),i},isSplitTypeLink:function(a){return a&&("orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.vertical"===a)},isOrthogonalOrFlexionalLink:function(a){if(a instanceof Gb.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return wc.isOrthogonalOrFlexionalType(b)},isOrthogonalLink:function(a){if(a instanceof Gb.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return wc.isOrthogonalType(b)},isOrthogonalOrFlexionalType:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a||"flexional"===a||"flexional.horizontal"===a||"flexional.vertical"===a},isOrthogonalType:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a},hasControlPoint:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.vertical"===a||"extend.bottom"===a||"extend.left"===a||"extend.right"===a||"extend.top"===a},getControlPoint:function(a,b,c){if(!a)throw"link can't be null";var d=a.getStyle("link.type");if(!wc.hasControlPoint(d))return null;var e=a.getStyle("link.control.point");if(e)return e;var f,g;if(null==b?(f=a.getFromAgent().getRect(),g=a.getToAgent().getRect()):(f=wc.getLinkSourceBounds(b,c),g=wc.getLinkTargetBounds(b,c)),null==f||null==g)return null;var h=wc.isHorizontal(d,f,g,a);return wc.calculateControlPoint(a.getStyle("link.type"),h,f,g,a)},getSplitValueByControlPoint:function(a,b,c,d,e){if("extend.top"===b)return Math.min(c.y,d.y)-a.y;if("extend.left"===b)return Math.min(c.x,d.x)-a.x;if("extend.bottom"===b)return a.y-Math.max(c.y+c.height,d.y+d.height);if("extend.right"===b)return a.x-Math.max(c.x+c.width,d.x+d.width);var f;if(e){var g=c.x+c.x+c.width<d.x+d.x+d.width;return f=g?a.x-c.x+c.width:c.x-a.x,f>0?f:f>-c.width?0:f+c.width}var h=c.y+c.y+c.height<d.y+d.y+d.height;return f=h?a.y-c.y-c.height:c.y-a.y,f>0?f:f>-c.height?0:f+c.height},isHorizontalByControlPoint:function(a,b,c,d,e){var f=Rb.unionRect(c,d);return Rb.containsPoint(f,a)?wc.isHorizontal(b,c,d,e):wc.calculateIsHorizontalByControlPoint(a.x,a.y,f.y,f.x,f.y+f.height,f.x+f.width)},setParamsByControlPoint:function(a,b,c,d,e){var f=wc.isHorizontalByControlPoint(a,d,b,c,e),g=e.getStyle("link.control.point");if((g||"orthogonal"===d||"orthogonal.horizontal"===d||"orthogonal.vertical"===d)&&e.setStyle("link.type",f?"orthogonal.horizontal":"orthogonal.vertical"),g)return void e.setStyle("link.control.point",a);var h=wc.getSplitValueByControlPoint(a,d,b,c,f);if(wc.isExtendTypeLink(d))return void e.setStyle("link.extend",h);var i=wc.isSplitByPercent(d,e);return i?0===h?void e.setStyle("link.split.percent",0):void e.setStyle("link.split.percent",wc.calculateSplitPercentByControlPoint(a,f,b,c)):void e.setStyle("link.split.value",h)},getLinkNodeBounds:function(a,b,c,d,e,f){if(f){var g=f.getLocationZoom();f.getSizeZoom(a)}if(null==a)return null;var h;if(d)f?(h=a.getZoomBodyRect(),h.x+=b,h.y+=c):(h=a.getBodyRect(),h.x+=b,h.y+=c);else{var i=a.getNetwork().getPosition(e,a,null,b,c);h=f?{x:i.x*g,y:i.y*g,width:1,height:1}:{x:i.x,y:i.y,width:1,height:1}}return h},getLinkSourceBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getFromAgent());if(null==d)return null;var e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset"),h=c.getStyle("link.from.at.edge");return wc.getLinkNodeBounds(d,f,g,h,e,b)},getLinkTargetBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getToAgent());if(null==d)return null;var e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset"),h=c.getStyle("link.to.at.edge");return wc.getLinkNodeBounds(d,f,g,h,e,b)},orthogonalAndFlexional:function(a,b,c){var d=wc.getLinkSourceBounds(a,c);if(null==d)return null;var e=wc.getLinkTargetBounds(a,c);if(null==e)return null;var f=wc.calculateOrthogonalAndFlexionalLinkPoints(b,d,e,a._element);return wc.offsetLink(a,f),a.setHotSpot(wc.calculateCenterPoint(f)),"flexional"!==b&&wc.drawCorner(f,a._element),f},offsetLink:function(a,b){var c=a._element,d=c.isBundleAgent();if(!d){var e=wc.getBundleGap(a,!1);if(0!==e)for(var f,g,h=!1,i=!1,j=b.get(0),k=Hb.clone(j),l=1,m=b.size();m>l;l++){var n=b.get(l),o=n.x-k.x,p=n.y-k.y;k=Hb.clone(n),g=wc.calculateAngle(o,p),0===o?((g-f)%Math.PI===0&&(g-f)%(2*Math.PI)!==0&&(h=!h,h&&(p=-p)),(g-f)%Math.PI!==0&&(j.x+=0>p?e:-e),n.x+=0>p?e:-e):0===p&&((g-f)%Math.PI===0&&(g-f)%(2*Math.PI)!==0&&(i=!i,i&&(o=-o)),f&&(g-f)%Math.PI===0||(j.y-=0>o?e:-e),n.y-=0>o?e:-e),f=g,j=n}}},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360}};Hb.link=wc;var xc={findMoveToBottomDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),xc.findMoveToBottomDatas(a,b,e.getChildren())},findMoveToTopDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(c.size()-1-d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),xc.findMoveToTopDatas(a,b,e.getChildren())},findMoveUpDatas:function(a,b,c){for(var d=!1,e=0;e<c.size();e++){var f=c.get(e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),xc.findMoveUpDatas(a,b,f.getChildren())},findMoveDownDatas:function(a,b,c){for(var d=!1,e=0;e<c.size();e++){var f=c.get(c.size()-1-e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),xc.findMoveDownDatas(a,b,f.getChildren())},doLayout:function(a,b){b=b||{},b.type=b.type||"round",b.animate=b.animate||!0,b.elements=b.elements||new Gb.List,b.repulsion=b.repulsion||1,b.expandGroup=b.expandGroup||!1;var c=new Gb.layout.AutoLayouter(a.getElementBox());c.getElements=function(){}}};Hb.box=xc;var yc={scrollLeft:function(){return yc._filterResults(window.pageXOffset?window.pageXOffset:0,Mb.documentElement?Mb.documentElement.scrollLeft:0,Mb.body?Mb.body.scrollLeft:0)},scrollTop:function(){return yc._filterResults(window.pageYOffset?window.pageYOffset:0,Mb.documentElement?Mb.documentElement.scrollTop:0,Mb.body?Mb.body.scrollTop:0)},_filterResults:function(a,b,c){var d=a?a:0;return b&&(!d||d>b)&&(d=b),c&&(!d||d>c)?c:d},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},getDistance:function(a){if(!yc.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return Math.sqrt(Math.pow(b.clientX-c.clientX,2)+Math.pow(b.clientY-c.clientY,2))},getCenterLocation:function(a){if(!yc.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return{x:(b.clientX+c.clientX)/2,y:(b.clientY+c.clientY)/2}}};Hb.touch=yc;var zc={_string:function(a,b,c,d){var e=c._stringPool.get();e.style.whiteSpace="nowrap",e.style.verticalAlign="middle",e.style.padding="0px 2px",Hb.setText(e,a,d),e.setAttribute("title",a),b.appendChild(e)},_boolean:function(a,b,c){var d=c._booleanPool.get();b._editInfo?(d._editInfo=b._editInfo,delete b._editInfo,d.disabled=!1):d.disabled=!0,d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d.checked=a,b.appendChild(d),""===b.style.textAlign&&(b.style.textAlign="center")},_color:function(a,b,c){var d=c._colorPool.get();d.style.width="100%",d.style.height="100%",d.style.backgroundColor=a,d.setAttribute("title",a),b.appendChild(d)},_listPoints:function(a,b,c,d){var e=c._stringPool.get();e.style.whiteSpace="nowrap",e.style.verticalAlign="middle",e.style.padding="0px 2px";var f=a._as||a,g="";f.forEach(function(a,b){g+=b==f.length-1?"["+a.x+","+a.y+"]":"["+a.x+","+a.y+"],"}),a=g,Hb.setText(e,a,d),e.setAttribute("title",a),b.appendChild(e)},render:function(a,b,c,d,e){if(null!=b){var f=zc["_"+a];f?f(b,c,d,e):"boolean"==typeof b?zc._boolean(b,c,d,e):b instanceof Gb.List?zc._listPoints(b,c,d,e):zc._string(b,c,d,e)}}};Hb.render=zc;var Ac={toolTipDiv:null,getToolTipDiv:function(){if(!Ac.toolTipDiv){Ac.toolTipDiv=Mb.createElement("div");var a=Dd,b=Ac.toolTipDiv.style;b.position="absolute",b.color=a.TOOLTIP_COLOR,b.background=a.TOOLTIP_BACKGROUND,b.fontSize=a.TOOLTIP_FONT_SIZE,b.padding=a.TOOLTIP_PADDING,b.border=a.TOOLTIP_BORDER,b.borderRadius=a.TOOLTIP_BORDER_RADIUS,b.boxShadow=a.TOOLTIP_BOX_SHADOW,b.zIndex=a.TOOLTIP_ZINDEX,b.setProperty&&b.setProperty("-webkit-box-shadow",a.TOOLTIP_BOX_SHADOW,null)}return Ac.toolTipDiv},isToolTipVisible:function(){return Ac.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){if(Ac._clearTimeout(),Ac._clearDismiss(),Ac.isToolTipVisible()){var a=Ac.getToolTipDiv();a.parentNode&&a.parentNode.removeChild(a)}},showToolTip:function(a,b,c){return a&&b?void(Ac.isToolTipVisible()||Ac._reshow_timeout?Ac._showToolTip(a,b,c):(Ac._clearTimeout(),Ac._show_timeout=setTimeout(function(){Ac._showToolTip(a,b,c)},Dd.TOOLTIP_INITIAL_DELAY))):void Ac.hideToolTip()},_showToolTip:function(a,b,c){var d,e,f;if(a.target?(d=a.clientX,e=a.clientY):(d=a.x,e=a.y),f=Ac.getToolTipDiv(),Ub.clear(f),b instanceof Element){var g=b.cloneNode(!0);f.appendChild(g)}else f.innerHTML=b;f.style.left=d+Dd.TOOLTIP_XOFFSET+"px",f.style.top=e+Dd.TOOLTIP_YOFFSET+"px",f.parentNode||Mb.body.appendChild(f),c&&c(f),Ac._clearDismiss(),Ac._dismiss_timeout=setTimeout(Ac.hideToolTip,Dd.TOOLTIP_DISMISS_DELAY),Ac._clearReshow(),Ac._reshow_timeout=setTimeout(Ac._clearReshow,Dd.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Ac._dismiss_timeout&&(clearTimeout(Ac._dismiss_timeout),Ac._dismiss_timeout=null)},_clearReshow:function(){Ac._reshow_timeout&&(clearTimeout(Ac._reshow_timeout),Ac._reshow_timeout=null)},_clearTimeout:function(){Ac._show_timeout&&(clearTimeout(Ac._show_timeout),Ac._show_timeout=null)},resetToolTip:function(){Ac.hideToolTip(),Ac.toolTipDiv=null}};Hb.popup=Ac;var Bc={handleClicked:function(a,b,c){if(!a.isSelectingElement()&&(Ob.isTouchable||0===b.button))if(c){var d=Cc(c);d&&d.onClick&&d.onClick(c,a),a.onClickElement(c,b),a.fireInteractionEvent({kind:"clickElement",event:b,element:c})}else a.onClickBackground(b),a.fireInteractionEvent({kind:"clickBackground",event:b})},handleDoubleClicked:function(a,b,c){if((Ob.isTouchable||0===b.button)&&!a.isEditingElement()){if(c){var d=Cc(c);d&&d.onDoubleClick&&d.onDoubleClick(c,a),a.onDoubleClickElement(c,b),a.fireInteractionEvent({kind:"doubleClickElement",event:b,element:c})}else a.onDoubleClickBackground(b),a.fireInteractionEvent({kind:"doubleClickBackground",event:b});c?c instanceof Gb.Link&&a.isDoubleClickToLinkBundle()?c.ISubNetwork&&a.isDoubleClickToSubNetwork()&&!Hb.isCtrlDown(b)?(a.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&a.setCurrentSubNetwork(c,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:c})}):c.reverseBundleExpanded()&&a.fireInteractionEvent({kind:"bundleLink",event:b,element:c}):c.ISubNetwork&&a.isDoubleClickToSubNetwork()?(a.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&a.setCurrentSubNetwork(c,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:c})}):c instanceof Nd&&a.isDoubleClickToGroupExpand()&&(c.reverseExpanded(),a.fireInteractionEvent({kind:"expandGroup",event:b,element:c})):a.isDoubleClickToUpSubNetwork()&&a.upSubNetwork(a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"upSubNetwork",event:b})})}},handleKeyDown:function(a,b){Hb.isCtrlDown(b)&&65==b.keyCode?(a.isKeyboardSelectEnabled()&&a.selectAll().size()>0&&a.fireInteractionEvent({kind:"selectAll"}),Ub.preventDefault(b)):46==b.keyCode?(a.isKeyboardRemoveEnabled()&&a.removeSelection()&&a.fireInteractionEvent({kind:"removeElement"}),Ub.preventDefault(b)):Hb.showVersion(b)},handleLongClicked:function(a,b,c){if(Ob.isTouchable||0===b.button)if(c){var d=Cc(c);d&&d.onLongClick&&d.onLongClick(c,a),a.onLongClickElement(c,b),a.fireInteractionEvent({kind:"longClickElement",event:b,element:c})}else a.onLongClickBackground(b),a.fireInteractionEvent({kind:"longClickBackground",event:b})}},Cc=function(a){if(a&&a._image){if("object"==typeof a._image)return a._image;var b=Hb.getImageAsset(a._image);if(b)return b._image}return null};Hb.interaction=Bc;var Dc=function(a){return a.trim()[0].match(/[mlhvcsqta]/i)?Jc(a):Fc(a)},Ec={},Fc=function(a){var b=Ec[a];return b?b:(Ec[a]=b=[],a.trim().split(" ").forEach(function(a){a=a.split(","),b.push(2===a.length?{x:parseFloat(a[0]),y:parseFloat(a[1])}:a[0])}),b)},Gc={},Hc=/[mlhvcsqtaz][\d.,\-\s]*/gi,Ic=/-?(\d)+(\.(\d)+)?/g,Jc=function(a){var b,c=Gc[a];return c?c:(b=a.trim().match(Hc),Gc[a]=c=[],b&&b.forEach(function(a){var b,d=a[0],e=a.match(Ic),f=e&&e.length;if(c.push(a={c:d}),f)switch(e.forEach(function(a,b){e[b]=parseFloat(a)}),d){case"M":case"m":case"L":case"l":for(b=0;f>b;b+=2)0!==b&&c.push(a={c:"M"===d||"L"===d?"L":"l"}),a.x=e[b],a.y=e[b+1];break;case"H":case"h":for(b=0;f>b;b++)0!==b&&c.push(a={c:d}),a.x=e[b];break;case"V":case"v":for(b=0;f>b;b++)0!==b&&c.push(a={c:d}),a.y=e[b];break;case"C":case"c":for(b=0;f>b;b+=6)0!==b&&c.push(a={c:d}),a.x1=e[b],a.y1=e[b+1],a.x2=e[b+2],a.y2=e[b+3],a.x=e[b+4],a.y=e[b+5];break;case"S":case"s":for(b=0;f>b;b+=4)0!==b&&c.push(a={c:d}),a.x2=e[b],a.y2=e[b+1],a.x=e[b+2],a.y=e[b+3];break;case"Q":case"q":for(b=0;f>b;b+=4)0!==b&&c.push(a={c:d}),a.x1=e[b],a.y1=e[b+1],a.x=e[b+2],a.y=e[b+3];break;case"T":case"t":for(b=0;f>b;b+=2)0!==b&&c.push(a={c:d}),a.x=e[b],a.y=e[b+1]}}),c)},Kc=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.transform&&Lc(a.transform);return o&&o.length&&(c=Qb.identity(),o.forEach(function(a){var b=a[0];"matrix"===b?c.multiply(new Qb(a[1],a[2],a[3],a[4],a[5],a[6])):"translate"===b?c.translate(a[1]||0,a[2]||0):"scale"===b?c.scale(a[1]||1,a[2]||a[1]||1):"rotate"===b?c.rotate(a[1]||0,a[2]||0,a[3]||0):"skewX"===b?c.skew(a[1]||0,0):"skewY"===b&&c.skew(0,a[1]||0)})),"linear"===a.type?(f=a.x1||0,g=a.y1||0,h=a.x2||0,i=a.y2||0,c&&(d=c.transform(f,g),f=d.x,g=d.y,d=c.transform(h,i),h=d.x,i=d.y),e=b.createLinearGradient(f,g,h,i)):"radial"===a.type&&(j=a.fx||0,k=a.fy||0,l=a.cx||0,m=a.cy||0,n=a.r||0,null==a.fx&&(j=l),null==a.fy&&(k=m),c&&(d=c.transform(j,k),j=d.x,k=d.y,d=c.transform(l,m),l=d.x,m=d.y,n=Math.max(c._m11,c._m22)*n),e=b.createRadialGradient(j,k,0,l,m,n)),e&&a.stop&&a.stop.length&&a.stop.forEach(function(a){e.addColorStop(parseFloat(a.offset),sd(a.color,b._color))}),e},Lc=function(a){return a.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(a){return a.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(a,b){return 0===b?a:parseFloat(a)})})},Mc=Gb.Util.drawImage=function(a,b,c,d,e,f,g){var h,i,j,k,l=1;"object"!=typeof b&&(i=b,h=Hb.images[b],b=h&&h.getImage()),bd(b)?a.drawImage(h?h.getImage(c,d.width,d.height):b,d.x,d.y,d.width,d.height):b&&"object"==typeof b&&(a._data=e,a._view=f,i?(j=d.width/(b.w&&Xc(e,b,b,"w")||e.getWidth()),k=d.height/(b.h&&Xc(e,b,b,"h")||e.getHeight()),f&&(l=f.getSizeZoom?f.getSizeZoom()*f.getGraphicsZoom():f.getZoom()),!h._cache||Math.max(j*l,k*l)>1?Nc(a,b,c,d,e,f,g):a.drawImage(c?h.getImage(c,d.width,d.height):h._cache,d.x,d.y,d.width,d.height)):Nc(a,b,c,d,e,f,g),a._data=null,a._view=null)},Nc=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=e&&e.getStyle("image.state");if(p=a._vector,w=a._color,q=a._fill,r=a._pattern,s=a._lineWidth,t=a._alpha,u=a._sx,v=a._sy,m=b,Xc(e,m,m,"visible",f)!==!1){for(a._color=c,h=Xc(e,m,m,"v",f),i=h&&h.length,y=m.w&&Xc(e,m,m,"w")||e.getWidth(),z=m.h&&Xc(e,m,m,"h")||e.getHeight(),n=d.width/y,o=d.height/z,g===!0?(a._fill=null,a._pattern=null,a._lineWidth=null,a._alpha=null):(a._sx=n,a._sy=o),a.save(),a.translate(d.x+d.width/2,d.y+d.height/2),(1!==n||1!==o)&&a.scale(n,o),m.origin&&a.translate((m.origin.x-.5)*y,(m.origin.y-.5)*z),a._vector=m,m.clip&&(a.beginPath(),m.clip===!0?a.rect(-(m.origin?m.origin.x:.5)*y,-(m.origin?m.origin.y:.5)*z,y,z):m.clip.length?m.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(m.clip),a.clip()),Sc(e,m,m,a,f),j=0,i=h.length;i>j;j++)l=h[j],a._shapeData=l,f&&(f._shapeDataIndex=j,l.animate&&ub(l,m,e,f)),x=Xc(e,m,l,"state",f),Xc(e,m,l,"visible",f)===!1||x&&!(Array.isArray(x)?x.indexOf(A)>=0:x===A)||(k=Pc[l.shape],k&&(a.save(),"vector"===l.shape||"g"===l.shape?k(a,l,e,f):Sc(e,m,l,a,f,function(){k(a,l,e,f)}),a.restore())),f&&(f._shapeDataIndex=null),a._shapeData=null;a.restore(),a._vector=p,a._shapeData=null,a._color=w,a._fill=q,a._pattern=r,a._lineWidth=s,a._alpha=t,a._sx=u,a._sy=v}},Oc=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o=a._vector,p=o.origin,q=o.w&&Xc(d,o,o,"w")||d.getWidth(),r=o.h&&Xc(d,o,o,"h")||d.getHeight();if("string"==typeof b?(n=Hb.images[b],n&&(h=n.getWidth(),i=n.getHeight())):(h=b.w&&Xc(d,b,b,"w"),i=b.h&&Xc(d,b,b,"h")),h&&i&&c)for(j=c.w/h*a._sx,k=c.h/i*a._sy,f=c.x-q/2*(a._sx-1),g=c.y-r/2*(a._sy-1),p&&(f-=(p.x-.5)*q*(a._sx-1),g-=(p.y-.5)*r*(a._sy-1)),(1!==a._sx||1!==a._sy)&&(a.scale(1/a._sx,1/a._sy),f+=((p?p.x:.5)*q+c.x)*(a._sx-1),g+=((p?p.x:.5)*r+c.y)*(a._sy-1)),c={x:0,y:0,width:h,height:i},l=0;j>l;l++)for(m=0;k>m;m++)c.x=l*h+f,c.y=m*i+g,Mc(a,b,null,c,d,e,!0)},Pc={line:function(a,b,c,d){var e,f,g,h,i=Xc(c,a._vector,b,"p1",d),j=Xc(c,a._vector,b,"p2",d);i?(e=Yc(i.length?i[0]:i.x,a),f=Zc(i.length?i[1]:i.y,a)):(e=Xc(c,a._vector,b,"x1",d,!0),f=Xc(c,a._vector,b,"y1",d,!1)),j?(g=Yc(j.length?j[0]:j.x,a),h=Zc(j.length?j[1]:j.y,a)):(g=Xc(c,a._vector,b,"x2",d,!0),h=Xc(c,a._vector,b,"y2",d,!1)),a.moveTo(e,f),a.lineTo(g,h)},rect:function(a,b,c,d){var e,f,g,h,i=Xc(c,a._vector,b,"rect",d),j=Xc(c,a._vector,b,"r",d);i?(Array.isArray(i)?(e=i[0],f=i[1],g=i[2],h=i[3]):(e=i.x,f=i.y,g=i.w,h=i.h),e=Yc(e,a),f=Zc(f,a),g=Yc(g,a),h=Zc(h,a)):(e=Xc(c,a._vector,b,"x",d,!0),f=Xc(c,a._vector,b,"y",d,!1),g=Xc(c,a._vector,b,"w",d,!0),h=Xc(c,a._vector,b,"h",d,!1)),a.drawRoundRect(e,f,g,h,j),(a._gradientFunc||a._pattern)&&(a._rect={x:e,y:f,w:g,h:h})},circle:function(a,b,c,d){var e=Xc(c,a._vector,b,"cx",d,!0),f=Xc(c,a._vector,b,"cy",d,!1),g=a._vector.w&&Xc(c,a._vector,a._vector,"w")||c.getWidth(),h=a._vector.h&&Xc(c,a._vector,a._vector,"h")||c.getHeight(),i=$c(Xc(c,a._vector,b,"r",d),Math.min(g,h),b,a._vector),j=Xc(c,a._vector,b,"startAngle",d),k=Xc(c,a._vector,b,"endAngle",d),l=Xc(c,a._vector,b,"anticlockwise",d),m=Xc(c,a._vector,b,"close",d);null==j&&(j=0),null==k&&(k=360),null==l&&(l=!1),m&&a.moveTo(e,f),a.arc(e,f,i,j/180*Math.PI,k/180*Math.PI,l),m&&a.closePath(),(a._gradientFunc||a._pattern)&&(a._rect={x:e-i,y:f-i,w:2*i,h:2*i})},ellipse:function(a,b,c,d){var e=Xc(c,a._vector,b,"cx",d,!0),f=Xc(c,a._vector,b,"cy",d,!1),g=Xc(c,a._vector,b,"rx",d,!0),h=Xc(c,a._vector,b,"ry",d,!1),i=Xc(c,a._vector,b,"startAngle",d),j=Xc(c,a._vector,b,"endAngle",d),k=Xc(c,a._vector,b,"anticlockwise",d),l=Xc(c,a._vector,b,"close",d);
null==i&&(i=0),null==j&&(j=360),null==k&&(k=!1),l&&a.moveTo(e,f),a.ellipse(e,f,g,h,0,i/180*Math.PI,j/180*Math.PI,k),l&&a.closePath(),(a._gradientFunc||a._pattern)&&(a._rect={x:e-g,y:f-h,w:2*g,h:2*h})},path:function(a,b,c,d){var e=Xc(c,a._vector,b,"data",d);a.drawPath(e)},text:function(a,b,c,d){var e=Xc(c,a._vector,b,"text",d),f=Xc(c,a._vector,b,"x",d,!0),g=Xc(c,a._vector,b,"y",d,!1),h=Xc(c,a._vector,b,"w",d,!0);if(null!=e){e=String(e);var i=e.split("\n"),j=2*a.measureText("e").width,k=tb(a,e,h);g-=(k.h/j-1)/2*j,i.forEach(function(b){if(h){var c,d,e,i,k,l=b.split(" "),m=l.length,n="";for(e=0;m>e;e++)if(c=l[e]+(e===m-1?"":" "),d=n+c,i=a.measureText(d).width,h>i)n=d;else if(i==h)a.fillText(n,f,g),n="",g+=j;else{for(k=0;k<c.length;k++)if(d=n+c.substr(0,k+1),a.measureText(d).width>h){a.fillText(d.substring(0,d.length-1),f,g),n=c.substring(k,c.length),g+=j;break}for(;n.length>0&&a.measureText(n).width>h;)for(k=0;k<n.length;k++)if(d=n.substr(0,k+1),a.measureText(d).width>h){a.fillText(n.substr(0,k),f,g),n=n.substring(k,n.length),g+=j;break}}a.fillText(n,f,g)}else a.fillText(b,f,g);g+=j})}},draw:function(a,b,c,d){var e,f,g=b.draw;"string"==typeof g&&((e=g.match(Vc))?(f="with(data) { "+e[1]+" }",g=Gb.Util.newFunction("g","data","view",f)):g=cd[g]),"function"==typeof g&&g.call(a._vector,a,c,d)},vector:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a._vector,s=Xc(c,r,b,"name",d),t=Xc(c,r,b,"x",d,!0),u=Xc(c,r,b,"y",d,!1),v=Xc(c,r,b,"w",d),w=Xc(c,r,b,"h",d);if("string"==typeof s?(l=Hb.images[s],k=l&&l._image):k=s,k)if(bd(k))null!=v&&null!=w?a.drawImage(k,t,u,Yc(v,a),Zc(w,a)):a.drawImage(k,t,u);else{for(m=Xc(c,k,k,"v",d),n=m&&m.length,o=k.w&&Xc(c,k,k,"w"),p=k.h&&Xc(c,k,k,"h"),null!=v&&null!=w?(v=Yc(v,a),w=Zc(w,a)):(v=o,w=p),a.save(),h=a._lineWidth,i=a._fill,j=a._alpha,Sc(c,k,k,a,d),Sc(c,r,b,a,d),a.translate(t,u),a.scale(v/o,w/p),k.origin&&a.translate((k.origin.x-.5)*o,(k.origin.y-.5)*p),k.clip&&(a.beginPath(),k.clip===!0?a.rect(-(k.origin?k.origin.x:.5)*o,-(k.origin?k.origin.y:.5)*p,o,p):k.clip.length?k.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(k.clip),a.clip()),q=a._shapeData,a._vector=k,e=0;n>e;e++)f=m[e],a._shapeData=f,d&&(d._shapeDataIndex.length?d._shapeDataIndex.push(e):d._shapeDataIndex=[d._shapeDataIndex,e],f.animate&&ub(f,r,c,d)),Xc(c,k,f,"visible",d)!==!1&&(g=Pc[f.shape],g&&(a.save(),"vector"===f.shape||"g"===f.shape?g(a,f,c,d):Sc(c,k,f,a,d,function(){g(a,f,c,d)}),a.restore())),d&&d._shapeDataIndex.pop();a._vector=r,a._shapeData=q,a._lineWidth=h,a._fill=i,a._alpha=j,a.restore()}},g:function(a,b,c,d){var e,f,g,h,i,j=Xc(c,a._vector,b,"v",d);j&&j.length&&(a.save(),f=a._lineWidth,g=a._fill,h=a._alpha,i=a._shapeData,Sc(c,a._vector,b,a,d),j.forEach(function(b){Xc(c,a._vector,b,"visible",d)!==!1&&(e=Pc[b.shape],e&&(a.save(),a._shapeData=b,"vector"===b.shape||"g"===b.shape?e(a,b,c,d):Sc(c,a._vector,b,a,d,function(){e(a,b,c,d)}),a.restore()))}),a._lineWidth=f,a._fill=g,a._alpha=h,a._shapeData=i,a.restore())}};Pc.image=Pc.vector;var Qc=Object.keys(Pc),Rc={M:function(a,b){return a.moveTo(b.x,b.y),a._path_start=b,a._rect&&ad(a._rect,b.x,b.y),b},m:function(a,b,c){return c&&(b={x:c.x+b.x,y:c.y+b.y}),a.moveTo(b.x,b.y),a._path_start=b,a._rect&&ad(a._rect,b.x,b.y),b},Z:function(a){return a.closePath(),a._path_start},z:function(a){return a.closePath(),a._path_start},L:function(a,b){return a.lineTo(b.x,b.y),a._rect&&ad(a._rect,b.x,b.y),b},l:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},H:function(a,b,c){var d={x:b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},h:function(a,b,c){var d={x:c.x+b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},V:function(a,b,c){var d={x:c.x,y:b.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},v:function(a,b,c){var d={x:c.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},Q:function(a,b){return a._preQ_x=b.x1,a._preQ_y=b.y1,a.quadraticCurveTo(b.x1,b.y1,b.x,b.y),a._rect&&(ad(a._rect,b.x1,b.y1),ad(a._rect,b.x,b.y)),b},q:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=c.x+b.x1,f=a._preQ_y=c.y+b.y1;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,d.x,d.y)),d},T:function(a,b,c){var d=a._preQ_x=2*c.x-a._preQ_x,e=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(d,e,b.x,b.y),a._rect&&(ad(a._rect,d,e),ad(a._rect,b.x,b.y)),b},t:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=2*c.x-a._preQ_x,f=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,d.x,d.y)),d},C:function(a,b){return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(b.x1,b.y1,b.x2,b.y2,b.x,b.y),a._rect&&(ad(a._rect,b.x1,b.y1),ad(a._rect,b.x2,b.y2),ad(a._rect,b.x,b.y)),b},c:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=c.x+b.x1,f=c.y+b.y1,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,g,h),ad(a._rect,d.x,d.y)),d},S:function(a,b,c){var d=2*c.x-a._preC_x,e=2*c.y-a._preC_y;return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(d,e,b.x2,b.y2,b.x,b.y),a._rect&&(ad(a._rect,d,e),ad(a._rect,b.x2,b.y2),ad(a._rect,b.x,b.y)),b},s:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=2*c.x-a._preC_x,f=2*c.y-a._preC_y,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,g,h),ad(a._rect,d.x,d.y)),d}},Sc=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=Xc(a,b,c,"line",e),u=Xc(a,b,c,"fill",e),v=Xc(a,b,c,"fillRule",e)||"nonzero",w=Xc(a,b,c,"gradient",e),x=Xc(a,b,c,"gradientColor",e),y=Xc(a,b,c,"pattern",e),z=Xc(a,b,c,"font",e),A=Xc(a,b,c,"textAlign",e)||"center",B=Xc(a,b,c,"textBaseline",e)||"middle",C=Xc(a,b,c,"translate",e),D=Xc(a,b,c,"rotate",e),E=Xc(a,b,c,"rotateOrigin",e),F=Xc(a,b,c,"scale",e),G=Xc(a,b,c,"transform",e),H=Xc(a,b,c,"alpha",e),I=d._lineWidth,J=d._fill,K=d._pattern,L=d._alpha,M=d._gradientFunc;if(t?(g=t.color,h=t.width,i=t.cap,j=t.join,k=t.miterLimit,l=t.dash,m=t.dashOffset):(g=Xc(a,b,c,"lineColor",e),h=Xc(a,b,c,"lineWidth",e),i=Xc(a,b,c,"lineCap",e),j=Xc(a,b,c,"lineJoin",e),k=Xc(a,b,c,"miterLimit",e),l=Xc(a,b,c,"lineDash",e),m=Xc(a,b,c,"lineDashOffset",e)),null!=g&&(d.strokeStyle=sd(g,d._color)),null!=h&&(d.lineWidth=d._lineWidth=e&&e.getSizeZoom&&!e.zoomManager.sizeChange?h/e.getSizeZoom():h),null!=i&&(d.lineCap=i),null!=j&&(d.lineJoin=j),null!=k&&(d.miterLimit=k),null!=l&&(d.lineDash=l,d.setLineDash(l)),null!=m&&(d.lineDashOffset=m),y?d._pattern=y:(u&&(d.fillStyle=d._fill=sd(u,d._color)),w&&("string"==typeof w?o=Wb[w]:(o=Wb[w.type],w.color&&(x=w.color),o||(w=Kc(w,d))),d._gradientFunc=o)),null!=z&&(d.font=z),null!=A&&(d.textAlign=A),null!=B&&(d.textBaseline=B),Tc(a,b,c,d,e),null!=G)"string"==typeof G&&(G=Lc(G)),G.length&&G.forEach(function(a){var b=a[0];"matrix"===b?d.transform(a[1],a[2],a[3],a[4],a[5],a[6]):"translate"===b?d.translate(a[1]||0,a[2]||0):"scale"===b?d.scale(a[1]||1,a[2]||a[1]||1):"rotate"===b?a.length>2?(d.translate(a[2],a[3]),d.rotate(a[1]),d.translate(-a[2],-a[3])):d.rotate(a[1]):"skewX"===b?d.transform(1,0,Math.tan(a[1]*Math.PI/180),1,0,0):"skewY"===b&&d.transform(1,Math.tan(a[1]*Math.PI/180),0,1,0,0)});else{if(null!=C&&(Array.isArray(C)?(r=C[0],s=C[1]):"object"==typeof C?(r=C.x,s=C.y):(r=C,s=0),r=Yc(r,d),s=Zc(s,d),(0!==r||0!==s)&&d.translate(r,s)),null!=D&&D%360!==0){var N,O;E&&(Array.isArray(E)?(N=E[0],O=E[1]):"object"==typeof E?(N=E.x,O=E.y):N=O=E,N=Yc(N,d),O=Zc(O,d),(0!==N||0!==O)&&d.translate(N,O)),d.rotate(D*Math.PI/180),E&&(0!==N||0!==O)&&d.translate(-N,-O)}null!=F&&(Array.isArray(F)?(p=F[0],q=F[1]):"object"==typeof F?(p=F.x,q=F.y):p=q=F,(1!==p||1!==q)&&d.scale(p,q))}null!=H&&(d.globalAlpha=d._alpha=null!=L?L*H:H),f&&(d.beginPath(),f(),n=d._rect||c.rect,d._pattern?(d._lineWidth>0&&d.stroke(),d.clip(),Oc(d,d._pattern,n,a,e)):(o&&n&&(w=o(d,sd(u||"#000000",d._color),sd(x||"#FFFFFF",d._color),n.x,n.y,n.w,n.h)),w&&(d.fillStyle=d._fill=w),d._fill&&d.fill(v),d._lineWidth>0&&d.stroke()),d._lineWidth=I,d._fill=J,d._pattern=K,d._alpha=L,d._gradientFunc=M,d._rect=null)},Tc=function(a,b,c,d,e){var f,g,h,i,j=Xc(a,b,c,"shadow",e);j?(f=j.offsetX,g=j.offsetY,h=j.blur,i=j.color):(f=Xc(a,b,c,"shadowOffsetX",e),g=Xc(a,b,c,"shadowOffsetY",e),h=Xc(a,b,c,"shadowBlur",e),i=Xc(a,b,c,"shadowColor",e)),null!=f&&(d.shadowOffsetX=f),null!=g&&(d.shadowOffsetY=g),null!=h&&(d.shadowBlur=h),null!=i&&(d.shadowColor=i)},Uc=/<%=([\s\S]+?)%>/,Vc=/<%([\s\S]+?)%>/,Wc=new RegExp([Uc.source,Vc.source].join("|")),Xc=function(a,b,c,d,e,f,g){var h,i,j,k,l,m=c[d],n=typeof m;if("string"===n&&(h=m.match(Wc))?(i="with(data) { "+(h[1]?"return "+h[1]:h[2])+" }",j=Gb.Util.newFunction("data","view",i),m=j.call(b,a,e)):"function"===n&&(m=m.call(b,a,e)),f===!0?(k=b.w&&Xc(a,b,b,"w")||a.getWidth(),(c.rel===!0||void 0===c.rel&&b.rel)&&1>=m&&m>=-1?m*=k:"string"==typeof m&&(m=parseInt(m)/100*k),m=m||0):f===!1&&(l=b.h&&Xc(a,b,b,"h")||a.getHeight(),(c.rel===!0||void 0===c.rel&&b.rel)&&1>=m&&m>=-1?m*=l:"string"==typeof m&&(m=parseInt(m)/100*l),m=m||0),g!==!1&&e&&a&&c.animate&&a._animates){var o,p=a._animates,q=e._shapeDataIndex;if(q.length)for(var r=0;r<q.length;r++)o=q[r],p=p[o];else o=q;var s=p[o],t=s[d];if(t)if(Array.isArray(t))for(var r=t.length-1;r>=0;r--){var u=t[r];if((u.stopped||u.time>0)&&u.started)return Fb(u,m)}else if(t.started)return Fb(t,m)}return m},Yc=function(a,b){if(!a)return 0;var c=b._vector.w&&Xc(b._data,b._vector,b._vector,"w")||b._data.getWidth();return(b._shapeData&&b._shapeData.rel===!0||(!b._shapeData||void 0===b._shapeData.rel)&&b._vector.rel)&&1>=a&&a>=-1?a*c:"string"==typeof a?parseInt(a)/100*c:a},Zc=function(a,b){if(!a)return 0;var c=b._vector.h&&Xc(b._data,b._vector,b._vector,"h")||b._data.getHeight();return(b._shapeData&&b._shapeData.rel===!0||(!b._shapeData||void 0===b._shapeData.rel)&&b._vector.rel)&&1>=a&&a>=-1?a*c:"string"==typeof a?parseInt(a)/100*c:a},$c=function(a,b,c,d){return a?(c.rel===!0||void 0===c.rel&&d.rel)&&1>=a&&a>=-1?a*b:"string"==typeof a?parseInt(a)/100*b:a:0},_c=(window.CanvasRenderingContext2D||Jb.Context2d).prototype;_c.drawShape=function(a){var b=this,c=b._vector,d=b._shapeData,e=b._data,f=b._view,g=Pc[a.shape];g&&(b.save(),b._shapeData=a,"vector"===a.shape||"g"===a.shape?g(b,a,e,f):Sc(e,c,a,b,f,function(){g(b,a,e,f)}),b._shapeData=d,b.restore())},_c.drawPath=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;if("string"==typeof a&&(a=Dc(a)),j=a?a.length:0,!(1>=j)){if((n._gradientFunc||n._pattern)&&(n._rect=k={x:0,y:0,w:0,h:0}),b=a&&a[0]&&a[0].c,b||(c=a&&a[0]&&null!=a[0].x,d="z"===a[j-1]||"Z"===a[j-1],d&&j--),b){for(e=0;j>e;e++)g=a[e],h=Rc[g.c],h&&(f=h(n,g,f));n._path_start=null,n._preC_x=null,n._preC_y=null,n._preQ_x=null,n._preQ_y=null}else if(c){for(i=a[0],l=Yc(i.x,n),m=Zc(i.y,n),n.moveTo(l,m),k&&ad(k,l,m),e=1;j>e;e++)i=a[e],l=Yc(i.x,n),m=Zc(i.y,n),n.lineTo(l,m),k&&ad(k,l,m);d&&n.closePath()}else{for(l=Yc(a[0],n),m=Zc(a[1],n),n.moveTo(l,m),k&&ad(k,l,m),e=2;j>e;e+=2)l=Yc(a[e],n),m=Zc(a[e+1],n),n.lineTo(l,m),k&&ad(k,l,m);d&&n.closePath()}return a}};var ad=function(a,b,c){var d=Math.min(a.x,b),e=Math.max(a.x+a.w,b),f=Math.min(a.y,c),g=Math.max(a.y+a.h,c);a.x=d,a.y=f,a.w=e-d,a.h=g-f};_c._fillPath=function(a,b){var c=this;c.beginPath(),c.fillStyle=a,c.drawPath(b),c.fill()},_c._fillRect=function(a,b,c,d,e){var f=this;f.beginPath(),f.fillStyle=a,f.rect(b,c,d,e),f.fill()},_c.ellipse||(_c.ellipse=function(a,b,c,d){var e=this,f=.5522848,g=c*f,h=d*f,i=a+c,j=b+d,k=a-c,l=b-d;e.moveTo(k,b),e.bezierCurveTo(k,b-h,a-g,l,a,l),e.bezierCurveTo(a+g,l,i,b-h,i,b),e.bezierCurveTo(i,b+h,a+g,j,a,j),e.bezierCurveTo(a-g,j,k,b+h,k,b)}),_c.drawRoundRect=function(a,b,c,d,e){var f=this;if(!e)return void f.rect(a,b,c,d);var g,h,i,j;if(Array.isArray(e))if(1===e.length)g=h=i=j=e[0];else if(2===e.length)g=h=e[0],i=j=e[1];else{if(4!==e.length)return void f.rect(a,b,c,d);g=e[0],h=e[1],i=e[2],j=e[3]}else g=h=i=j=e;var k=a+c,l=b+d,m=d>c?2*c:2*d;g=m>g?g:m,h=m>h?h:m,i=m>i?i:m,j=m>j?j:m;var n=.292893218813453*j,o=.585786437626905*j;f.moveTo(k,l-j),f.quadraticCurveTo(k,l-o,k-n,l-n),f.quadraticCurveTo(k-o,l,k-j,l),n=.292893218813453*i,o=.585786437626905*i,f.lineTo(a+i,l),f.quadraticCurveTo(a+o,l,a+n,l-n),f.quadraticCurveTo(a,l-o,a,l-i),n=.292893218813453*g,o=.585786437626905*g,f.lineTo(a,b+g),f.quadraticCurveTo(a,b+o,a+n,b+n),f.quadraticCurveTo(a+o,b,a+g,b),n=.292893218813453*h,o=.585786437626905*h,f.lineTo(k-h,b),f.quadraticCurveTo(k-o,b,k-n,b+n),f.quadraticCurveTo(k,b+o,k,b+h),f.lineTo(k,l-j)};var bd=function(a){return Jb?a instanceof Jb||a instanceof Nb:a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement},cd={},dd=function(a,b){"function"==typeof b&&(cd[a]=b)},ed=function(a,b){"function"==typeof b&&Qc.indexOf(a)<0&&(Pc[a]=b)};!function(){for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;++b){var c=a[b];window.requestAnimationFrame=window[c+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var d=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(d+16,b);return setTimeout(function(){a(d=c)},c-b)},window.cancelAnimationFrame=clearTimeout}}();var fd=Gb.Animate=function(a){var b=this;b.type=null==a.type?"number":a.type,b.delay=null==a.delay?0:a.delay,b.dur=null==a.dur?1e3:a.dur,b.interval=null==a.interval?0:a.interval,b.finish=null==a.finish?b.delay+b.dur+b.interval:a.finish,null==a.finish?b.finish=b.delay+b.dur+b.interval:(b.finish=a.finish,b.interval=b.finish-b.delay-b.dur),b.repeat=null==a.repeat?1:a.repeat,b.reverse=null==a.reverse?!0:a.reverse,b.easing=null==a.easing?"easeNone":a.easing,b.onUpdate=a.onUpdate,b.onDone=a.onDone,b.onStop=a.onStop,b.onPlay=a.onPlay,b.attr=a.attr,b.source=a.source,b.filter=a.filter,b.from=a.from,b.to=a.to,b.start=null,b.time=0,b.total=0,b.count=0,b.started=!1,b.stopped=!1,b.paused=!1,b.pausedTime=null,b.pausedTotal=0,b._speed=1,b._oldSpeed=null,b._speedTotal=0,b._speedTime=null,b._percent=0,b._percentSet=null,b._percentDiff=0,b.id=hd++};Hb.ext("twaver.Animate",Object,{play:function(){return wb(this)},stop:function(a){return xb(this,a)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,id=!0)},isPaused:function(){return this.paused},percent:function(a){return null==a?this._percentSet||this._percent:(this._percentSet=0>a?0:a>100?100:a,this.paused&&(id=!0),this.started||(this.play(),this.pause()),this)},speed:function(a){return null==a?this._speed:(a=0>a?1:a,a!==this.speed&&(this.stopped||(this._oldSpeed=this._speed),this._speed=a),this)},clone:function(){return new fd(this)},chain:function(a){var b,c=this;return c.next=a,a.pre=c,c.onDone?(b=c.onDone,c.onDone=function(){b.call(c),a.play()}):c.onDone=function(){a.play()},c}});var gd={},hd=1,id=!1;!function Nf(a){Gb.animateLoopId=requestAnimationFrame(Nf),id&&(id=!1,Bb(a))}(0);var jd={easeNone:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},elasticOut:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},elasticBoth:function(a,b,c,d,e,f){var g;return 0===a?b:2===(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},backIn:function(a,b,c,d,e){return void 0===e&&(e=1.70158),a===d&&(a-=.001),c*(a/=d)*a*((e+1)*a-e)+b},backOut:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return"undefined"==typeof e&&(e=5.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-jd.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return d/2>a?.5*jd.bounceIn(2*a,0,c,d)+b:.5*jd.bounceOut(2*a-d,0,c,d)+.5*c+b}},kd={draw:function(a,b){var c=null==b.getCurrentSubNetwork()?b.getElementBox():b.getCurrentSubNetwork(),d=c.getStyle("background.type");"image"==d?this.drawImage(a,c,b):"vector"==d?this.drawVector(a,c,b):"image.vector"==d?(this.drawImage(a,c,b),this.drawVector(a,c,b)):"vector.image"==d&&(this.drawVector(a,c,b),this.drawImage(a,c,b))},drawImage:function(a,b,c){var d=b.getStyle("background.image"),e=Hb.getImageAsset(d),f=c.getGraphicsZoom?c.getGraphicsZoom():c.getZoom();if(null!=e){var g=b.getStyle("background.image.scope"),h=c.getScopeRect(g),i=c._dragToPan?0:-h.x/f,j=c._dragToPan?0:-h.y/f;("rootcanvas"==g||"viewport"==g)&&(h.x=i,h.y=j),"rootcanvas"==g&&(h.width=Math.max(e.getWidth(),h.width/f),h.height=Math.max(e.getHeight(),h.height/f)),"none"==b.getStyle("background.image.stretch")&&(h.width=e.getWidth(),h.height=e.getHeight());var k=b.getStyle("background.image.padding");if(k&&Rb.grow(h,k,k),"tile"==b.getStyle("background.image.stretch")){if(bd(e.getImage()))for(var l=0;l<h.width;l+=e.getWidth())for(var m=0;m<h.height;m+=e.getHeight())a.drawImage(e.getImage(),l,m)}else("fill"==b.getStyle("background.image.stretch")||"none"==b.getStyle("background.image.stretch"))&&Mc(a,e.getImage(),null,h,b,c)}},drawVector:function(a,b,c){var d=b.getStyle("background.vector.scope"),e=c.getScopeRect(d),f=c.getGraphicsZoom?c.getGraphicsZoom():c.getZoom(),g=c._dragToPan?0:-e.x/f,h=c._dragToPan?0:-e.y/f;("rootcanvas"==d||"viewport"==d)&&(e.x=g,e.y=h),"rootcanvas"==d&&(e.width=e.width/f,e.height=e.height/f);var i=b.getStyle("background.outline.width"),j=(b.getStyle("background.outline.color"),b.getStyle("background.vector.fill")),k=b.getStyle("background.vector.fill.color"),l=b.getStyle("background.vector.padding"),m=b.getStyle("background.vector.shape"),n=b.getStyle("background.vector.pattern");l&&Rb.grow(e,l,l);var o=b.getStyle("background.vector.gradient");j&&(o?Vb.fill(a,k,o,b.getStyle("background.vector.gradient.color"),e):a.fillStyle=k,Vb.drawVector(a,m,n,e),a.fill()),i>0&&(a.lineWidth=i,a.strokeStyle=b.getStyle("background.outline.color"),Vb.drawVector(a,m,n,e),a.stroke())}},ld=Gb.UndoManager=function(a){var b=this;b._list=[],b._cursor=-1,b._suspended=!1,b._dispatcher=new Gb.EventDispatcher,b._box=a,b._enabled=!1,b._limit=100};ld._IGNORE_PROPERTIES={alarmState:1,propagateSeverity:1,enablePropagation:1,children:1,fromAgent:1,toAgent:1,bundleLinks:1},Hb.ext("twaver.UndoManager",Object,{setEnabled:function(a){var b=this,c=b._box;b._enabled!=a&&(a?(c.addDataBoxChangeListener(b._handleDataBoxChange,b,!0),c.addDataPropertyChangeListener(b._handleDataPropertyChange,b,!0)):(c.removeDataBoxChangeListener(b._handleDataBoxChange,b),c.removeDataPropertyChangeListener(b._handleDataPropertyChange,b))),b._enabled=a},isEnabled:function(){return this._enabled},undo:function(){var a,b,c,d=this,e=d._list;if(d.canUndo()){if(a=e[d._cursor--],d._suspended=!0,a.length)for(c=a.length,b=c-1;b>=0;b--)a[b].undo();else a.undo();d._suspended=!1,d._fire({kind:"undo",action:a})}},redo:function(){var a,b=this,c=b._list;b.canRedo()&&(a=c[++b._cursor],b._suspended=!0,a.length?a.forEach(function(a){a.redo()}):a.redo(),b._suspended=!1,b._fire({kind:"redo",action:a}))},canUndo:function(){return this._cursor>=0},canRedo:function(){return this._cursor<this._list.length-1},_add:function(a){var b=this,c=b._batch,d=b._list;c?c.push(a):(b._cursor!==d.length-1&&d.splice(b._cursor+1,d.length),0!==b._limit&&d.length===b._limit&&d.splice(0,1),d.push(a),b._cursor=d.length-1,b._fire({kind:"add",action:a}))},_handleDataBoxChange:function(a){if(!this._suspended){var b=this,c=b._box,d=a.kind,e=a.data;"add"===d?b._add({undo:function(){var a=this;a.parent=e.getParent(),a.host=e.getHost&&e.getHost(),e.getFromNode&&(a.fromNode=e.getFromNode(),a.toNode=e.getToNode()),c.remove(e)},redo:function(){var a=this;a.parent&&e.setParent(a.parent),e.getHost&&a.host&&e.setHost(a.host),e.getFromNode&&(a.fromNode&&e.setFromNode(a.fromNode),a.toNode&&e.setToNode(a.toNode)),c.add(e)}}):"remove"===d&&b._add({undo:function(){c.add(e)},redo:function(){c.remove(e)}})}},_handleDataPropertyChange:function(a){if(!this._suspended){var b=this,c=a.property,d=c.substr(0,2),e=a.source,f=a.oldValue,g=a.newValue;"C:"===d?(c=c.substr(2),b._add({undo:function(){e.setClient(c,f)},redo:function(){e.setClient(c,g)}})):"S:"===d?(c=c.substr(2),b._add({undo:function(){e.setStyle(c,f)},redo:function(){e.setStyle(c,g)}})):ld._IGNORE_PROPERTIES[c]||b._add({undo:function(){e[Hb.setter(c)](f)},redo:function(){e[Hb.setter(c)](g)}})}},size:function(){return this._list.length},getCursor:function(){return this._cursor},_fire:function(a){this._dispatcher.fire(a)},on:function(a,b,c){this._dispatcher.add(a,b,c)},off:function(a,b){this._dispatcher.remove(a,b)},isSuspended:function(){return this._suspended},setSuspended:function(a){this._suspended=a},getLimit:function(){return this._limit},setLimit:function(a){var b,c,d=this,e=d._list;return 0>a&&(a=0),a!==d._limit&&(b=e.length-a,a>0&&b>0&&(c=d._cursor+1,d._cursor-=b,d._cursor<-1&&(d._cursor=-1),c>0&&e.splice(0,c),b-=c,b>0&&e.splice(e.length-b,b)),d._limit=a,d._fire({kind:"change"})),d},clear:function(){var a=this;return a._list=[],a._cursor=-1,a._fire({kind:"clear"}),a},batch:function(a,b){var c=this;return c.startBatch(),a.call(b),c.endBatch(),c},startBatch:function(){var a=this;return a._batch||(a._batch=[]),a},endBatch:function(){var a,b=this;return b._batch&&(a=b._batch,b._batch=null,a.length&&b._add(a)),b}}),Gb.Pool=function(a,b){this.func="string"==typeof a?function(){return Mb.createElement(a)}:a,this.tagName=a,null!=b&&(this.redundancy=b)},Hb.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){if(this.currentIndex++,this.currentIndex===this.size()){var a=this.func();return a._pool=this,a.style.margin="0px",a.style.padding="0px",this.list||(this.list=new md),this.list.add(a),a}return this.list.get(this.currentIndex)},release:function(a){this.list&&this.list.remove(a)>=0&&(delete a._selectData,delete a._expandData,delete a._checkData,delete a._editInfo,delete a.keepDefault,a.style.margin="0px",a.style.padding="0px",a.style.backgroundColor="",a.removeAttribute("title"),"img"===this.tagName&&a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height"),a.removeAttribute("src")),this.list.add(a),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)for(;this.redundancy+this.currentIndex<this.list.size()-1;)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}});var md=function(){if(this._as=[],1===arguments.length){var a=arguments[0];if(a instanceof md&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this._as.push(a[c]);else a===!1?(this._duplicatable=!1,this._map={}):null!=a&&this._as.push(a)}else if(arguments.length>1)for(b=arguments.length,c=0;b>c;c++)this._as.push(arguments[c])};Gb.List=md,Hb.ext("twaver.List",Object,{_duplicatable:!0,size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(a,b){if(!this._duplicatable){if(this._map[a._id])return;this._map[a._id]=!0}return void 0===b?this._as.push(a):this._as.splice(b,0,a)},addAll:function(a){if(a instanceof md&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this.add(a[c]);else this.add(a)},get:function(a){return this._as[a]},remove:function(a){if(!this._duplicatable&&!this._map[a&&a._id])return-1;var b=this._as.indexOf(a);return b>=0&&b<this._as.length&&this.removeAt(b),b},removeAt:function(a){var b=this._as.splice(a,1)[0];return!this._duplicatable&&b&&delete this._map[b._id],b},set:function(a,b){var c=this._as[a];if(c===b)return b;if(!this._duplicatable){if(this._map[b._id])throw"duplicate item:"+b;delete this._map[c._id],this._map[b._id]=!0}return this._as[a]=b,c},clear:function(){return this._duplicatable||(this._map={}),this._as.splice(0,this._as.length)},contains:function(a){return this._duplicatable?this.indexOf(a)>=0:!!this._map[a&&a._id]},indexOf:function(a){return this._as.indexOf(a)},forEach:function(a,b){for(var c=this._as.length,d=0;c>d;d++){var e=this._as[d];b?a.call(b,e):a(e)}},forEachReverse:function(a,b){for(var c=this._as.length,d=c-1;d>=0;d--){var e=this._as[d];b?a.call(b,e):a(e)}},toArray:function(a,b){if(a){for(var c=[],d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.push(f):a(f)&&c.push(f)}return c}return this._as.concat()},toList:function(a,b){if(a){for(var c=new md,d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.add(f):a(f)&&c.add(f)}return c}return new md(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}});var nd={shapeMap:{},init:function(){nd.register("arrow.standard",nd.createStandardArrow()),nd.register("arrow.delta",nd.createDeltaArrow()),nd.register("arrow.diamond",nd.createDiamondArrow()),nd.register("arrow.short",nd.createShortArrow()),nd.register("arrow.slant",nd.createSlantArrow()),nd.register("arrow.doubledelta",nd.createDoubleDeltaArrow()),nd.register("arrow.tee",nd.createTeeArrow()),nd.register("arrow.box",nd.createBoxArrow()),nd.register("arrow.dot",nd.createDotArrow()),nd.register("arrow.tail",nd.createTailArrow())},createStandardArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-.75,y:0}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),{points:a}},createDeltaArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),{points:a}},createDoubleDeltaArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:-.5,y:0}),a.add({x:-.5,y:-5/9}),a.add({x:0,y:0}),a.add({x:-.5,y:5/9}),a.add({x:-.5,y:0}),a.add({x:-1,y:-5/9}),{points:a}},createTeeArrow:function(){var a=new md;return a.add({x:-1/9,y:-5/9}),a.add({x:-1/9,y:5/9}),a.add({x:0,y:5/9}),a.add({x:0,y:-5/9}),a.add({x:-1/9,y:-5/9}),{points:a}},createBoxArrow:function(){var a=new md;return a.add({x:-10/9,y:-5/9}),a.add({x:-10/9,y:5/9}),a.add({x:0,y:5/9}),a.add({x:0,y:-5/9}),a.add({x:-10/9,y:-5/9}),{points:a}},createDotArrow:function(){var a={},b=new Gb.List;return b.add({x:-.5,y:0}),a.points=b,a.draw=function(a,b){if(a&&b&&b.points&&!(b.points.size()<=0)){var c=b.points._as,d=c[0],e=Math.min(b.width,b.height)/2;a.save(),a.beginPath(),a.arc(d.x,d.y,e,0,2*Math.PI,!1),a.closePath(),a.restore()}},a},createTailArrow:function(){for(var a={},b=new Gb.List,c=30,d=-c/2;c/2>d;d++)b.add({x:-d/9,y:0});return a.points=b,a.draw=function(a,b){if(a&&b&&b.points&&!(b.points.size()<=0))for(var c=b.points._as,d=b.shadow,e=b.shadowColor,f=b.shadowXOffset,g=b.shadowYOffset,h=b.shadowBlur,e=b.shadowColor,i=c.length-4,j=Math.min(b.width,b.height)/2,k=0;i>k;k++){var l=k/i,m=c[k],n=.4*j;a.save(),a.restore(),a.beginPath(),a.globalAlpha=l*l,d&&(a.shadowOffsetX=f,a.shadowOffsetY=g,a.shadowBlur=h,a.shadowColor=e),a.arc(m.x,m.y,n,0,2*Math.PI,!1),a.closePath(),a.fill()}},a},createDiamondArrow:function(){var a=new md;return a.add({x:-7/12,y:5/9}),a.add({x:-14/12,y:0}),a.add({x:-7/12,y:-5/9}),a.add({x:0,y:0}),a.add({x:-7/12,y:5/9}),{points:a}},createShortArrow:function(){var a=new md;return a.add({x:-8/12,y:6/9}),a.add({x:-5/12,y:0}),a.add({x:-8/12,y:-6/9}),a.add({x:0,y:0}),a.add({x:-8/12,y:6/9}),{points:a}},createSlantArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-6.5/12,y:0}),a.add({x:-.75,y:4/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),{points:a}},register:function(a,b){nd.shapeMap[a]=b},getShape:function(a){if(a)return nd.shapeMap[a];throw"shape type can't be null"},getArrowRect:function(a,b,c,d,e,f,g,h,i){var j=nd.getShape(d);if(j&&j.points&&!(j.points&&j.points.size()<=0)){if(g>0&&1>g){var k;k=a.getLineLength?a.getLineLength():a._element.getLineLength(),g*=k}else a.getLineLength&&(g+=nd.calculateArrowXOffsetAtEdge(b,a,c,i));var l,m,n,o=Rb.calculatePointInfoAlongLine(b,c,g,h),p=o.point,q=o.angle,r=j.points._as,s=r.length,t=new md;for(n=new Qb(e,0,0,f,p.x,p.y),l=0;s>l;l++)t.add(n.transform(r[l]));for(n=Rb.createMatrix(q+Math.PI,p.x,p.y),l=0;s>l;l++)m=t.get(l),m instanceof md&&(m=m._as),m instanceof Array?(m[0]=n.transform(m[0]),m[1]=n.transform(m[1])):t.set(l,n.transform(m));return Rb.getLineRect(t)}},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l,m){i=i||0,j=j||0,k=k||0;var n=m._element.getStyle("arrow.from.shadow"),o=m._element.getStyle("arrow.from.shadow.color"),p=m._element.getStyle("arrow.from.shadow.xoffset"),q=m._element.getStyle("arrow.from.shadow.yoffset"),r=m._element.getStyle("arrow.from.shadow.blur"),s=k>=0&&l;if(g||s){var t=nd.getShape(f);if(t&&t.points&&!(t.points&&t.points.size()<=0)){var u=Rb.calculatePointInfoAlongLine(d,e,i,j),v=u.point,w=u.angle;g&&(a.fillStyle=h),a.beginPath(),s&&(a.lineWidth=k,a.strokeStyle=l),nd._drawArrow(a,t,w,v,b,c,l,o,n,p,q,r),n&&(a.shadowOffsetX=p,a.shadowOffsetY=q,a.shadowBlur=r,a.shadowColor=o),g&&a.fill(),s&&a.stroke()}}},_drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l){if(b.draw){for(var m=new Gb.List,n=0;n<b.points._as.length;n++)m.add(b.points.get(n));m.add({x:-1,y:-.5}),m.add({x:-1,y:.5}),m.add({x:0,y:.5}),m.add({x:0,y:-.5}),m=m._as;var n,o,p,q=m.length,r=new md;p=new Qb(e,0,0,f,d.x,d.y);for(var n=0;q>n;n++)r.add(p.transform(m[n]));r=r._as,p=Rb.createMatrix(c+Math.PI,d.x,d.y);for(var s=new md,n=0;q>n;n++)s.add(p.transform(r[n]));b.draw&&b.draw(a,{points:s,width:e,height:f,shadowColor:h,shadow:i,shadowXOffset:j,shadowYOffset:k,shadowBlur:l})}else{var n,o,p,m=b.points._as,q=m.length,r=new md;for(p=new Qb(e,0,0,f,d.x,d.y),n=0;q>n;n++)r.add(p.transform(m[n]));r=r._as,p=Rb.createMatrix(c+Math.PI,d.x,d.y);var t=r[0];for(t=p.transform(t),a.moveTo(t.x,t.y),n=1;q>n;n++)o=r[n],o instanceof md&&(o=o._as),o instanceof Array?(o[0]=p.transform(o[0]),o[1]=p.transform(o[1]),a.quadraticCurveTo(o[0].x,o[0].y,o[1].x,o[1].y)):(o=p.transform(o),a.lineTo(o.x,o.y))}},drawLinkArrow:function(a,b,c,d){if(!(c.size()<2)){var e=a._element.isBundleAgent?a._element.isBundleAgent():!1;a._element.getStyle(e?"arrow.agent.from":"arrow.from")&&nd._drawFromArrow(a,b,c,d),a._element.getStyle(e?"arrow.agent.to":"arrow.to")&&nd._drawToArrow(a,b,c,d)}},_drawFromArrow:function(a,b,c,d){var e=a._element,f=e.isBundleAgent?e.isBundleAgent():!1,g=e.getStyle(f?"arrow.agent.from.fill":"arrow.from.fill"),h=e.getStyle(f?"arrow.agent.from.outline.width":"arrow.from.outline.width");if(e.getStyle(f?"arrow.agent.from.shadow.color":"arrow.from.shadow.color"),g||h>=0){var i=e.getStyle(f?"arrow.agent.from.width":"arrow.from.width"),j=e.getStyle(f?"arrow.agent.from.height":"arrow.from.height"),k=e.getStyle(f?"arrow.agent.from.xoffset":"arrow.from.xoffset");if(k>0&&1>k){var l;l=a.getLineLength?a.getLineLength():a._element.getLineLength(),k*=l}else a.getLineLength&&(k+=nd.calculateArrowXOffsetAtEdge(c,a,!0,d));var m=e.getStyle(f?"arrow.agent.from.yoffset":"arrow.from.yoffset"),n=e.getStyle(f?"arrow.agent.from.shape":"arrow.from.shape");nd.drawArrow(b,i,j,c,!0,n,g,e.getStyle(f?"arrow.agent.from.color":"arrow.from.color"),k,m,h,e.getStyle(f?"arrow.agent.from.outline.color":"arrow.from.outline.color"),a)}},_drawToArrow:function(a,b,c,d){var e=a._element,f=e.isBundleAgent?e.isBundleAgent():!1,g=e.getStyle(f?"arrow.agent.to.fill":"arrow.to.fill"),h=e.getStyle(f?"arrow.agent.to.outline.width":"arrow.to.outline.width");
if(g||h>=0){var i=e.getStyle(f?"arrow.agent.to.width":"arrow.to.width"),j=e.getStyle(f?"arrow.agent.to.height":"arrow.to.height"),k=e.getStyle(f?"arrow.agent.to.xoffset":"arrow.to.xoffset");if(k>0&&1>k){var l;l=a.getLineLength?a.getLineLength():a._element.getLineLength(),k*=l}else a.getLineLength&&(k+=nd.calculateArrowXOffsetAtEdge(c,a,!1,d));var m=e.getStyle(f?"arrow.agent.to.yoffset":"arrow.to.yoffset"),n=e.getStyle(f?"arrow.agent.to.shape":"arrow.to.shape");nd.drawArrow(b,i,j,c,!1,n,g,e.getStyle(f?"arrow.agent.to.color":"arrow.to.color"),k,m,h,e.getStyle(f?"arrow.agent.to.outline.color":"arrow.to.outline.color"),a)}},calculateArrowXOffsetAtEdge:function(a,b,c,d){if(null==a||a.size()<2)return 0;var e=b._element,f=e.getStyle(c?"arrow.from.at.edge":"arrow.to.at.edge");if(!f)return 0;var g=b._network.getElementUI(c?e.getFromAgent():e.getToAgent());if(!g)return 0;if(d)var h=g.getZoomBodyRect();else var h=g._bodyRect;if(null==h)return 0;for(var i=Rb._getPoint(a.get(c?0:a.size()-1)),j=0,k=b.getLineLength();nd._containsByInt(h,Math.floor(i.x),Math.floor(i.y),!1)&&k>j;)i=Rb.calculatePointInfoAlongLine(a,c,j++).point;return j},_containsByInt:function(a,b,c,d){return d=void 0===d?!0:d,d?b>=Math.floor(a.x)&&b<=Math.floor(a.x+a.width)&&c>=Math.floor(a.y)&&c<=Math.floor(a.y+a.height):b>Math.floor(a.x)&&b<Math.floor(a.x+a.width)&&c>Math.floor(a.y)&&c<Math.floor(a.y+a.height)}};nd.init(),Hb.arrow=nd,Gb.EventDispatcher=function(){this._f=0},Hb.ext("twaver.EventDispatcher",null,{contains:function(a,b){if(this._ls)for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),a===c.l&&b===c.s)return!0;return!1},add:function(a,b,c){var d={l:a,s:b,a:c};this._ls||(this._ls=new md),this._f?(this._addPendings||(this._addPendings=new md),this._addPendings.add(d)):d.a?this._ls.add(d,0):this._ls.add(d)},remove:function(a,b){this._ls&&(this._f?(this._removePendings||(this._removePendings=new md),this._removePendings.add({l:a,s:b})):this._remove(a,b))},_remove:function(a,b){for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),c.l===a&&c.s===b)return void this._ls.removeAt(d)},fire:function(a){if(this._ls){var b,c,d=this._ls.size();for(this._f++,b=0;d>b;b++)c=this._ls.get(b),c.s?c.l.call(c.s,a):c.l(a);if(this._f--,!this._f){if(this._removePendings){for(d=this._removePendings.size(),b=0;d>b;b++)c=this._removePendings.get(b),this._remove(c.l,c.s);delete this._removePendings}if(this._addPendings){for(d=this._addPendings.size(),b=0;d>b;b++)c=this._addPendings.get(b),c.a?this._ls.add(c,0):this._ls.add(c);delete this._addPendings}}}}}),Gb.ImageAsset=function(a,b,c,d,e){this._name=a,this._width=c,this._height=d,this._svg=e,this._edgeData,"string"==typeof b?this._src=b:"function"==typeof b?this._func=b:bd(b)?this._image=b:"object"==typeof b&&(this._image=b,this._width=b.w||b.width,this._height=b.h||b.height,b.cache!==!1&&yd(b)&&(wd(a,b),this._cache=Bd(b)))},Hb.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(a,b,c){if(!a||!this._image)return this._image;this._map||(this._map={});var d;d=this._svg&&3===arguments.length?a+","+b+","+c:a;var e=this._map[d];return e?e:(e=td(this._cache||this._image,rd(a),this._svg?b||this.getWidth():this.getWidth(),this._svg?c||this.getHeight():this.getHeight()),this._map[d]=e,e)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(a,b,c){var d=300,e=d/b;b>c&&(e=d/c);var f=Math.floor(b*e),g=Math.floor(c*e);this.tempCanvas||(this.tempCanvas=Mb.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=f,this.tempCanvas.height=g,this.ctx.clearRect(0,0,f,g),this.ctx.drawImage(a,0,0,f,g);for(var h=this.ctx.getImageData(0,0,f,g),i=!0,j=[],k=0,b=f,c=g;c>k;k++)for(var l=0;b>l;l++){var m=4*(k*b+l),n=this._isTransparentPoint(h.data,m),o=i!=n||!n&&(0==l||l==b-1);if(o){var p=n?1:0;j.push({x:l-p,y:k})}i=n}i=!0;for(var l=0,b=f,c=g;b>l;l++)for(var k=0;c>k;k++){var m=4*(k*b+l),n=this._isTransparentPoint(h.data,m),o=i!=n||!n&&(0==k||k==c-1);if(o){var p=n?1:0;j.push({x:l,y:k-p})}i=n}for(var q=b/2,r=c/2,s=[],t=0;360>t;t++)s.push({x:q,y:r,dist:0});for(var t=0,u=j.length;u>t;t++){var v=j[t],w=this._getPointAngleDegree(v.x,v.y,q,r),x=this._getPointDist(v.x,v.y,q,r);s[w].dist<x&&(s[w]={x:v.x,y:v.y,dist:x})}for(var t=0,u=s.length;u>t;t++){var o=s[t];o.x=o.x/e,o.y=o.y/e,delete o.dist}return s},_isTransparentPoint:function(a,b){return a[b]+a[b+1]+a[b+2]+a[b+3]==0},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360},_getPointDist:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)}});var od={},pd=Ub.createCanvas();pd.width=1,pd.height=1;var qd=pd.getContext("2d"),rd=function(a){a=a||"black";var b,c=od[a];return c||(qd.clearRect(0,0,1,1),qd.fillStyle=a,qd.fillRect(0,0,1,1),b=qd.getImageData(0,0,1,1).data,c=od[a]={r:b[0],g:b[1],b:b[2],a:b[3]}),c},sd=function(a,b){if(!b)return a;if(b=rd(b),a=rd(a),Dd.PIXEL_FILTER_FUNCTION){var c=Dd.PIXEL_FILTER_FUNCTION(a,b);return"rgba("+c.r+","+c.g+","+c.b+","+a.a+")"}return null},td=function(a,b,c,d){var e=Ub.createCanvas(c,d),f=e.getContext("2d");f.drawImage(a,0,0,c,d);try{for(var g=f.getImageData(0,0,c,d),h=g.data,i=0,j=h.length;j>i;i+=4){var k={r:h[i+0],g:h[i+1],b:h[i+2]},l=Dd.PIXEL_FILTER_FUNCTION(k,b);h[i+0]=l.r,h[i+1]=l.g,h[i+2]=l.b}f.putImageData(g,0,0)}catch(m){return a}return e},ud={},vd=function(a,b){if(a){var c=typeof a;"string"===c&&(a.match(Wc)||Hb.images[a]||(ud[a]||(ud[a]=[])).push(b))}},wd=function(a,b){b.pattern&&vd(b.pattern,a),b.v&&b.v.forEach(function(b){b.pattern&&vd(b.pattern,a)})},xd=function(a){var b=ud[a];b&&(b.forEach(function(a){var b=Hb.images[a];b._cache=Bd(b._image)}),delete ud[a])},yd=function(a){return a.w&&a.h?zd(a):!1},zd=function(a){return!Object.keys(a).some(function(b){if(/^on/.test(b))return!1;var c=a[b],d=Ad(c);return d||"v"!==b||(d=c.some(function(a){if("draw"===a.shape)return!0;if("vector"===a.shape){var b=Hb.images[a.name];if(b&&!b._cache)return!0}var c=Object.keys(a).some(function(b){return"state"===b||"animate"===b?!0:Ad(a[b])});return c?!0:"g"===a.shape&&a.v&&a.v.length?!zd(a):!1})),d})},Ad=function(a){var b=typeof a;return"string"===b&&a.match(Wc)||"function"===b},Bd=function(a){var b=Ub.createCanvas(a.w,a.h),c=b.getContext("2d");return Gb.Util.makeHighRes(b),Nc(c,a,null,{x:0,y:0,width:a.w,height:a.h}),b},Cd=Gb.imageUtil={IMAGE_LOAD_COMPLETED:"IMAGE_LOAD_COMPLETED",_dispatcher:new Gb.EventDispatcher,addEventListener:function(a,b,c){Cd._dispatcher.add(a,b,c)},removeEventListener:function(a,b){Cd._dispatcher.remove(a,b)},images:{},registerImageByUrl:function(a,b,c){if(b=b||Cd.getImageType(a),c=c||Cd.getImageName(a),!Cd.images[c]){Cd.images[c]=a;var d=new Nb;d.src=a,d.onload=function(){Hb.registerImage(c,d,d.width,d.height,b===!0),d.onload=null,delete Cd.images[c];var e={type:Cd.IMAGE_LOAD_COMPLETED,url:a,svg:b,name:c};Cd._dispatcher.fire(e)}}},getImageName:function(a){if("string"!=typeof a)return null;var b=a.lastIndexOf("/"),c=a;return b>=0&&(c=a.substring(b+1)),b=c.lastIndexOf("."),b>=0&&(c=c.substring(0,b)),c},getImageType:function(a){if("string"!=typeof a)return null;var b=a.lastIndexOf("/"),c=a;return b>=0&&(c=a.substring(b+1)),b=c.lastIndexOf("."),b>=0&&(c=c.substring(b+1)),c}},Dd={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,COLUMN_RENDER_EDITOR:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,PROPERTY_RENDER_EDITOR:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",SPLITPANE_UP_EXPAND_ICON:"up_expand_icon",SPLITPANE_DOWN_EXPAND_ICON:"down_expand_icon",SPLITPANE_LEFT_EXPAND_ICON:"left_expand_icon",SPLITPANE_RIGHT_EXPAND_ICON:"right_expand_icon",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,GROUP_EXPAND_ALIGN:"center",ELEMENTUI_FUNCTION:function(a,b){var c=b.getElementUIClass();return c?new c(a,b):null},CANVASUI_FUNCTION:function(a,b){var c=b.getCanvasUIClass();return c?new c(a,b):null},VECTORUI_FUNCTION:function(a,b){var c=b.getVectorUIClass();return c?new c(a,b):null},KEEP_DEFAULT_FUNCTION:function(a){return a.target.keepDefault||a.target.getAttribute("keepDefault")?!0:a.target.parentNode&&(a.target.parentNode.keepDefault||a.target.parentNode.getAttribute("keepDefault"))?!0:a.shiftKey?!0:!1},SORT_FUNCTION:function(a,b){if(a===b)return 0;if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c,d=typeof a,e=typeof b;return"string"===d&&"string"===e&&(c=a.localeCompare(b)),"number"===d&&"number"===e&&(c=a-b),void 0===c&&(c=(""+a).localeCompare(""+b)),c>0?1:0>c?-1:0},CENTER_LOCATION:!1,PIXEL_FILTER_FUNCTION:function(a,b){if(!b)return a;var c=.3*a.r+.59*a.g+.11*a.b;return{r:Math.floor(b.r*c/255),g:Math.floor(b.g*c/255),b:Math.floor(b.b*c/255)}}};!function(){var a=Dd;if(window.OverrideTWaverDefaults)for(var b in OverrideTWaverDefaults)a[b]=OverrideTWaverDefaults[b];a.FONT=a.VIEW_FONT_SIZE&&a.VIEW_FONT_FAMILY?a.VIEW_FONT_SIZE+" "+a.VIEW_FONT_FAMILY:Mb.createElement("canvas").getContext("2d").font,a.CHART_VALUE_FONT||(a.CHART_VALUE_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_XSCALE_TEXT_FONT||(a.BARCHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_YSCALE_TEXT_FONT||(a.BARCHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_XAXIS_TEXT_FONT||(a.BARCHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BARCHART_YAXIS_TEXT_FONT||(a.BARCHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.LINECHART_XSCALE_TEXT_FONT||(a.LINECHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.LINECHART_YSCALE_TEXT_FONT||(a.LINECHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.LINECHART_XAXIS_TEXT_FONT||(a.LINECHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.LINECHART_YAXIS_TEXT_FONT||(a.LINECHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_XAXIS_TEXT_FONT||(a.BUBBLECHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_YAXIS_TEXT_FONT||(a.BUBBLECHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_XSCALE_TEXT_FONT||(a.BUBBLECHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_YSCALE_TEXT_FONT||(a.BUBBLECHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.RADARCHART_AXIS_TEXT_FONT||(a.RADARCHART_AXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.RADARCHART_SCALE_TEXT_FONT||(a.RADARCHART_SCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.DIALCHART_SCALE_TEXT_FONT||(a.DIALCHART_SCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY)}(),Gb.Defaults=Dd,Hb.ext("twaver.Defaults",Object,{}),Gb.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},Gb.SerializationSettings=function(){var a=Gb.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isLayerBoxSerializable=a.isLayerBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this.isImageSerializable=a.isImageSerializable,this._pm=Hb.clone(a._pm),this._sm=Hb.clone(a._sm),this._cm=Hb.clone(a._cm)},function(){var a=Gb.SerializationSettings;a.isDataBoxSerializable=!0,a.isLayerBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a.isImageSerializable=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),Hb.ext("twaver.SerializationSettings",Object,{setPropertyType:function(a,b){this._pm[a]=b},getPropertyType:function(a){return this._pm[a]},setStyleType:function(a,b){this._sm[a]=b},getStyleType:function(a){return this._sm[a]},setClientType:function(a,b){this._cm[a]=b},getClientType:function(a){return this._cm[a]}});var Ed=Gb.Styles={_m:{},setStyle:function(a,b){null==b?delete Ed._m[a]:Ed._m[a]=b},getStyle:function(a){return Ed._m[a]},getStyleProperties:function(){return Hb.keys(Gb.Styles._m)}};!function(){var a=function(a,b){Gb.SerializationSettings.setPropertyType(a,b)};a("name","cdata"),a("name2","cdata"),a("icon","string"),a("toolTip","cdata"),a("parent","data"),a("layerId","string"),a("alarmState","alarmstate"),a("image","string"),a("imageUrl","string"),a("location","point"),a("width","number"),a("height","number"),a("expanded","boolean"),a("host","data"),a("fromNode","data"),a("toNode","data"),a("points","list.point"),a("segments","list.string"),a("angle","number"),a("visible","boolean"),a=function(a,b,c){null==c&&(c=null!=b?typeof b:"string"),Gb.Styles.setStyle(a,b),Gb.SerializationSettings.setStyleType(a,c)},a("chart.color",null),a("chart.value",0),a("chart.values",null,"list.number"),a("chart.value.color","#000000"),a("chart.value.font",null),a("chart.line.width",2),a("chart.marker.size",6),a("chart.marker.shape","circle"),a("chart.bubble.shape","circle"),a("chart.names",null,"list.string"),a("chart.xaxis.values",null,"list.number"),a("chart.yaxis.values",null,"list.number"),a("dialchart.rear.extension",0),a("dialchart.base.width",5),a("dialchart.top.width",0),a("dialchart.radius",.8),a("inner.color",null),a("outer.shape","rectangle"),a("outer.color",null),a("outer.width",2),a("outer.padding",1),a("outer.padding.left",0),a("outer.padding.right",0),a("outer.padding.top",0),a("outer.padding.bottom",0),a("outer.cap","butt"),a("outer.join","miter"),a("outer.style","border"),a("shadow.color",null),a("shadow.xoffset",3),a("shadow.yoffset",3),a("shadow.blur",6),a("select.style","shadow"),a("select.color","rgba(0, 0, 0, 0.7)"),a("select.shape","rectangle"),a("select.width",2),a("select.padding",2),a("select.padding.left",0),a("select.padding.right",0),a("select.padding.top",0),a("select.padding.bottom",0),a("select.cap","butt"),a("select.join","miter"),a("whole.alpha",1),a("body.type","default"),a("network.label",null,"cdata"),a("image.padding",0),a("image.padding.left",0),a("image.padding.right",0),a("image.padding.top",0),a("image.padding.bottom",0),a("image.state",null),a("vector.shape","rectangle"),a("vector.fill",!0),a("vector.fill.color","#CCCCFF"),a("vector.outline.width",-1),a("vector.outline.pattern",null,"array.number"),a("vector.outline.color","#5B5B5B"),a("vector.gradient","none"),a("vector.gradient.color","#FFFFFF"),a("vector.padding",0),a("vector.padding.left",0),a("vector.padding.right",0),a("vector.padding.top",0),a("vector.padding.bottom",0),a("vector.cap","butt"),a("vector.join","miter"),a("vector.deep",0),a("group.shape","rectangle"),a("group.fill",!0),a("group.fill.color","#CCCCFF"),a("group.outline.width",-1),a("group.outline.color","#5B5B5B"),a("group.gradient","none"),a("group.gradient.color","#FFFFFF"),a("group.padding",5),a("group.padding.left",0),a("group.padding.right",0),a("group.padding.top",0),a("group.padding.bottom",0),a("group.cap","butt"),a("group.join","miter"),a("group.deep",1),a("group.shape.roundrect.radius",-1),a("group.expend.image",null),a("group.expend.image.vector",!1),a("label.alpha",1),a("label.color","#000000"),a("label.font",null),a("label.position","bottom.bottom"),a("label.direction","below"),a("label.corner.radius",0),a("label.pointer.length",0),a("label.pointer.width",8),a("label.xoffset",0),a("label.yoffset",2),a("label.padding",0),a("label.padding.left",0),a("label.padding.right",0),a("label.padding.top",0),a("label.padding.bottom",0),a("label.fill",!1),a("label.fill.color","#C0C0C0"),a("label.gradient","none"),a("label.gradient.color","#FFFFFF"),a("label.outline.width",-1),a("label.outline.color","#000000"),a("label.cap","butt"),a("label.join","miter"),a("label.shadowable",!0),a("label.align","center"),a("label.rotate.angle",0),a("label.maxlength",0),a("link.label.rotatable",!1),a("label2.alpha",1),a("label2.color","#000000"),a("label2.font",null),a("label2.position","top.top"),a("label2.direction","below"),a("label2.corner.radius",0),a("label2.pointer.length",0),a("label2.pointer.width",8),a("label2.xoffset",0),a("label2.yoffset",-2),a("label2.padding",0),a("label2.padding.left",0),a("label2.padding.right",0),a("label2.padding.top",0),a("label2.padding.bottom",0),a("label2.fill",!1),a("label2.fill.color","#C0C0C0"),a("label2.gradient","none"),a("label2.gradient.color","#FFFFFF"),a("label2.outline.width",-1),a("label2.outline.color","#000000"),a("label2.cap","butt"),a("label2.join","miter"),a("label2.shadowable",!0),a("label2.align","center"),a("label2.rotate.angle",0),a("label2.maxlength",0),a("link.label2.rotatable",!1),a("icons.names",null,"array.string"),a("icons.colors",null,"array.string"),a("icons.position",null,"array.string"),a("icons.orientation",null,"array.string"),a("icons.xoffset",[0],"array.number"),a("icons.yoffset",[0],"array.number"),a("icons.xgap",[1],"array.number"),a("icons.ygap",[1],"array.number"),a("alarm.alpha",1),a("alarm.color","#000000"),a("alarm.font",null),a("alarm.position","hotspot"),a("alarm.direction","aboveright"),a("alarm.corner.radius",5),a("alarm.pointer.length",10),a("alarm.pointer.width",8),a("alarm.xoffset",0),a("alarm.yoffset",0),a("alarm.padding",0),a("alarm.padding.left",0),a("alarm.padding.right",0),a("alarm.padding.top",0),a("alarm.padding.bottom",0),a("alarm.gradient","none"),a("alarm.gradient.color","#FFFFFF"),a("alarm.outline.width",-1),a("alarm.outline.color","#000000"),a("alarm.cap","butt"),a("alarm.join","miter"),a("alarm.shadowable",!0),a("link.color","#658DC1"),a("link.width",3),a("link.cap","butt"),a("link.join","miter"),a("link.type","arc"),a("link.pattern",null,"array.number"),a("link.extend",20),a("link.control.point",null,"point"),a("link.bundle.id",0),a("link.bundle.enable",!0),a("link.bundle.expanded",!0),a("link.bundle.independent",!1),a("link.bundle.offset",20),a("link.bundle.gap",12),a("link.bundle.group.gap",0),a("link.looped.gap",6),a("link.looped.direction","northwest"),a("link.looped.type","arc"),a("link.from.position","center"),a("link.from.xoffset",0),a("link.from.yoffset",0),a("link.from.percent",null),a("link.from.at.edge",!0),a("link.to.position","center"),a("link.to.xoffset",0),a("link.to.yoffset",0),a("link.to.percent",null),a("link.to.at.edge",!0),a("link.split.by.percent",!0),a("link.split.percent",.5),a("link.split.value",20),a("link.corner","round"),a("link.xradius",8),a("link.yradius",8),a("link.flow",!1),a("link.flow.converse",!1),a("link.flow.offset",0),
a("link.handler.alpha",1),a("link.handler.color","#000000"),a("link.handler.font",null),a("link.handler.position","topleft.topleft"),a("link.handler.direction","below"),a("link.handler.corner.radius",0),a("link.handler.pointer.length",0),a("link.handler.pointer.width",8),a("link.handler.xoffset",0),a("link.handler.yoffset",0),a("link.handler.padding",0),a("link.handler.padding.left",0),a("link.handler.padding.right",0),a("link.handler.padding.top",0),a("link.handler.padding.bottom",0),a("link.handler.fill",!1),a("link.handler.fill.color","#C0C0C0"),a("link.handler.gradient","none"),a("link.handler.gradient.color","#FFFFFF"),a("link.handler.outline.width",-1),a("link.handler.outline.color","#000000"),a("link.handler.cap","butt"),a("link.handler.join","miter"),a("link.handler.shadowable",!0),a("link.agent",!1),a("link.agent.color","#658DC1"),a("link.agent.width",3),a("link.agent.cap","butt"),a("link.agent.join","miter"),a("link.agent.type","arc"),a("link.agent.pattern",null,"array.number"),a("link.agent.extend",20),a("link.agent.control.point",null,"point"),a("link.agent.from.position","center"),a("link.agent.from.xoffset",0),a("link.agent.from.yoffset",0),a("link.agent.from.percent",null),a("link.agent.from.at.edge",!0),a("link.agent.to.position","center"),a("link.agent.to.xoffset",0),a("link.agent.to.yoffset",0),a("link.agent.to.percent",null),a("link.agent.to.at.edge",!0),a("link.agent.split.by.percent",!0),a("link.agent.split.percent",.5),a("link.agent.split.value",20),a("link.agent.corner","round"),a("link.agent.xradius",8),a("link.agent.yradius",8),a("link.agent.flow",!1),a("link.agent.flow.converse",!1),a("link.agent.flow.offset",0),a("follower.row.index",0),a("follower.column.index",0),a("follower.row.span",1),a("follower.column.span",1),a("follower.padding",0),a("follower.padding.left",0),a("follower.padding.right",0),a("follower.padding.top",0),a("follower.padding.bottom",0),a("follower.fill.cell",!0),a("follower.cell.position","center"),a("glow.blur",20),a("grid.row.count",1),a("grid.column.count",1),a("grid.row.percents",null,"array.number"),a("grid.column.percents",null,"array.number"),a("grid.border",1),a("grid.border.left",0),a("grid.border.right",0),a("grid.border.top",0),a("grid.border.bottom",0),a("grid.padding",1),a("grid.padding.left",0),a("grid.padding.right",0),a("grid.padding.top",0),a("grid.padding.bottom",0),a("grid.fill",!0),a("grid.fill.color","#C0C0C0"),a("grid.deep",1),a("grid.cell.deep",-1),a("shapelink.type","lineto"),a("shapenode.closed",!1),a("shapenode.pattern",null,"array.number"),a("bus.style","nearby"),a("arrow.from",!1),a("arrow.from.fill",!0),a("arrow.from.shape","arrow.standard"),a("arrow.from.color","#000000"),a("arrow.from.xoffset",0),a("arrow.from.yoffset",0),a("arrow.from.width",12),a("arrow.from.height",9),a("arrow.from.outline.color","#000000"),a("arrow.from.outline.width",-1),a("arrow.from.at.edge",!0),a("arrow.from.shadow",!1),a("arrow.from.shadow.color","#000000"),a("arrow.from.shadow.xoffset",0),a("arrow.from.shadow.yoffset",0),a("arrow.from.shadow.blur",16),a("arrow.to",!1),a("arrow.to.fill",!0),a("arrow.to.shape","arrow.standard"),a("arrow.to.color","#000000"),a("arrow.to.xoffset",0),a("arrow.to.yoffset",0),a("arrow.to.width",12),a("arrow.to.height",9),a("arrow.to.outline.color","#000000"),a("arrow.to.outline.width",-1),a("arrow.to.at.edge",!0),a("arrow.agent.from",!1),a("arrow.agent.from.fill",!0),a("arrow.agent.from.shape","arrow.standard"),a("arrow.agent.from.color","#000000"),a("arrow.agent.from.xoffset",0),a("arrow.agent.from.yoffset",0),a("arrow.agent.from.width",12),a("arrow.agent.from.height",9),a("arrow.agent.from.outline.color","#000000"),a("arrow.agent.from.outline.width",-1),a("arrow.agent.from.at.edge",!0),a("arrow.agent.from.shadow",!1),a("arrow.agent.from.shadow.color","#000000"),a("arrow.agent.from.shadow.xoffset",0),a("arrow.agent.from.shadow.yoffset",0),a("arrow.agent.from.shadow.blur",16),a("arrow.agent.to",!1),a("arrow.agent.to.fill",!0),a("arrow.agent.to.shape","arrow.standard"),a("arrow.agent.to.color","#000000"),a("arrow.agent.to.xoffset",0),a("arrow.agent.to.yoffset",0),a("arrow.agent.to.width",12),a("arrow.agent.to.height",9),a("arrow.agent.to.outline.color","#000000"),a("arrow.agent.to.outline.width",-1),a("arrow.agent.to.at.edge",!0),a("background.image",null),a("background.image.scope","viewport"),a("background.type","none"),a("background.outline.width",-1),a("background.outline.color",null),a("background.vector.padding",0),a("background.image.padding",0),a("background.image.stretch","fill"),a("background.vector.scope","viewport"),a("background.vector.fill",null),a("background.vector.fill.color",null),a("background.vector.gradient",!1),a("background.vector.gradient.color",null),a("background.vector.shape","rectangle"),a("background.outline.pattern",null,"array.number"),a("attachment.label.style","html"),a("attachment.label2.style","html"),a("attachment.alarm.style","html"),a("attachment.htmllabel.hyperlink",!1),a("attachment.htmllabel2.hyperlink",!1)}(),Hb.ext("twaver.Styles",Object,{}),Gb.PropertyChangeDispatcher=function(){this._dispatcher=new Gb.EventDispatcher},Hb.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(a,b,c){this._dispatcher.add(a,b,c)},removePropertyChangeListener:function(a,b){this._dispatcher.remove(a,b)},firePropertyChange:function(a,b,c){if(b==c)return!1;var d={property:a,oldValue:b,newValue:c,source:this};return this._dispatcher.fire(d),this.onPropertyChanged(d),!0},onPropertyChanged:function(a){}}),Gb.animate.Animate=function(){},Hb.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(a){}}),Gb.animate.AnimateProperty=function(a,b,c){this.objects=a,this.newValues=b,this.finishFunction=c,this.oldValues=new md;for(var d=this.objects.size(),e=0;d>e;e++){var f=this.objects.get(e);this.oldValues.add(this.getPropertyValue(f))}},Hb.ext("twaver.animate.AnimateProperty",Gb.animate.Animate,{action:function(a){for(var b=this.objects.size(),c=0;b>c;c++){var d=this.objects.get(c),e=this.oldValues.get(c),f=this.newValues.get(c);this.currentAction(d,e,f,a)}},getPropertyValue:function(a){},currentAction:function(a,b,c,d){}}),Gb.animate.AnimateBounds=function(a,b,c){this.node=a,this.newBounds=b,this.oldBounds=a.getRect(),this.finishFunction=c},Hb.ext("twaver.animate.AnimateBounds",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){var b=this.oldBounds,c=this.newBounds;this.node.setLocation(b.x+(c.x-b.x)*a,b.y+(c.y-b.y)*a),this.node.setSize(b.width+(c.width-b.width)*a,b.height+(c.height-b.height)*a)}}),Gb.animate.AnimateCenterLocation=function(a,b,c){Gb.animate.AnimateCenterLocation.superClass.constructor.call(this,a,b,c)},Hb.ext("twaver.animate.AnimateCenterLocation",Gb.animate.AnimateProperty,{getPropertyValue:function(a){return a.getCenterLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setCenterLocation(e,f)}}),Gb.animate.AnimateLocation=function(a,b,c){Gb.animate.AnimateLocation.superClass.constructor.call(this,a,b,c)},Hb.ext("twaver.animate.AnimateLocation",Gb.animate.AnimateProperty,{getPropertyValue:function(a){return a.getLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setLocation(e,f)}}),Gb.animate.AnimateScrollPosition=function(a,b,c){this.view=a,this.oldHorizontalOffset=a.scrollLeft,this.oldVerticalOffset=a.scrollTop,this.newHorizontalOffset=b,this.newVerticalOffset=c},Hb.ext("twaver.animate.AnimateScrollPosition",Gb.animate.Animate,{action:function(a){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*a,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*a}}),Gb.animate.AnimateZoom=function(a,b,c){this.view=a,this.oldZoom=a.getZoom(),this.newZoom=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*a,!1)}}),Gb.animate.AnimateXZoom=function(a,b,c){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateXZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1)}}),Gb.animate.AnimateYZoom=function(a,b,c){this.view=a,this.oldYZoom=a.getYZoom(),this.newYZoom=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateYZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),Gb.animate.AnimateXYZoom=function(a,b,c,d){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.oldYZoom=a.getYZoom(),this.newYZoom=c,this.finishFunction=d},Hb.ext("twaver.animate.AnimateXYZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),Gb.animate.AnimateSubNetwork=function(a,b,c){this.network=a,this.subNetwork=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateSubNetwork",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){a>.5?(this.network.getView().style.opacity=2*a-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-2*a}}),Gb.animate.AnimateManager={timer:null,animate:null,start:function(a,b){var c=Gb.animate.AnimateManager;a.current<0&&(a.current=0),b?Hb.callLater(c.startImpl,null,[a],b):c.startImpl(a)},startImpl:function(a){var b=Gb.animate.AnimateManager;b.animate&&b.endAnimate(),b.animate=a,b.timer=setTimeout(b.tick,a.getCurrentDelay())},tick:function(){var a=Gb.animate.AnimateManager,b=a.animate;if(b){if(b.current<0)return void b.current++;b.current<b.step&&(b.current++,b.action(b.current/b.step),a.timer=setTimeout(a.tick,b.getCurrentDelay())),b.current>=b.step&&a.endAnimate()}},endAnimate:function(){var a=Gb.animate.AnimateManager;if(a.animate){a.animate.shouldBeFinished&&a.animate.current<a.animate.step&&(a.animate.current=a.animate.step,a.animate.action(a.animate.current/a.animate.step));var b=a.animate.finishFunction;a.animate=null,a.timer&&(clearTimeout(a.timer),a.timer=null),b&&b()}else a.timer&&(clearTimeout(a.timer),a.timer=null)}},Gb.DataBox=function(a){Gb.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=a),this._dataList=new md,this._dataMap={},this._rootList=new md,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new Gb.EventDispatcher,this._dataPropertyChangeDispatcher=new Gb.EventDispatcher,this._hierarchyChangeDispatcher=new Gb.EventDispatcher,this._selectionModel=new Gb.SelectionModel(this)},Hb.ext("twaver.DataBox",Gb.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:Dd.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(a){var b=this._limit;this._limit=a,this.firePropertyChange("limit",b,a),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(a){for(0===arguments.length&&(a=1);a>0&&this._dataList.size()>0;){var b=this._dataList.get(0);this.remove(b),a--}},getSiblings:function(a){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var b=a.getParent();return b?b.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(a,b){return this._dataList.toList(a,b)},forEach:function(a,b){this._dataList.forEach(a,b)},forEachReverse:function(a,b){this._dataList.forEachReverse(a,b)},forEachByDepthFirst:function(a,b,c){if(b)this._depthFirst(a,b,c);else for(var d=this._rootList.size(),e=0;d>e;e++){var f=this._rootList.get(e);if(this._depthFirst(a,f,c)===!1)return}},_depthFirst:function(a,b,c){for(var d=b.getChildrenSize(),e=0;d>e;e++){var f=b.getChildAt(e);if(this._depthFirst(a,f,c)===!1)return!1}if(c){if(a.call(c,b)===!1)return!1}else if(a(b)===!1)return!1},forEachByBreadthFirst:function(a,b,c){var d=new md;for(b?d.add(b):this._rootList.forEach(d.add,d);d.size()>0;)if(b=d.removeAt(0),b.getChildren().forEach(d.add,d),c){if(a.call(c,b)===!1)return}else if(a(b)===!1)return},add:function(a,b){if(a){1===arguments.length&&(b=-1);var c=a.getId();if(this._dataMap.hasOwnProperty(c))throw"Data with ID '"+c+"' already exists";this._dataBoxChangeDispatcher.fire({kind:"preAdd",data:a}),this._dataMap[c]=a,this._dataList.add(a),a.getParent()||(this._rootMap[c]=a,b>=0?this._rootList.add(a,b):this._rootList.add(a)),a.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:a}),this._checkLimit()}},addByDescendant:function(a){this.add(a),a.getChildren().size()>0&&a.getChildren().forEach(function(a){this.addByDescendant(a)},this)},remove:function(a){this.removeById(a.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(a){this.remove(a)},this)},removeById:function(a){var b=this.getDataById(a);b&&(this._dataBoxChangeDispatcher.fire({kind:"preRemove",data:b}),b instanceof Gb.Link&&(b.setFromNode(null),b.setToNode(null)),b instanceof Ld&&b.getLinks()&&b.getLinks().toList().forEach(function(a){this.remove(a)},this),b instanceof Ld&&b.getFollowers()&&b.getFollowers().toList().forEach(function(a){a.setHost(null)}),b instanceof Gb.Follower&&b.getHost()&&b.setHost(null),b.toChildren().forEach(function(a){this.remove(a)},this),b.getParent()&&b.getParent().removeChild(b),this._dataList.remove(b),delete this._dataMap[a],this._rootMap[a]&&(delete this._rootMap[a],this._rootList.remove(b)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:b}),b.removePropertyChangeListener(this.handleDataPropertyChange,this))},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var a=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:a})}},getDataById:function(a){return this._dataMap[a]},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a._id]===a:!1},moveTo:function(a,b){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var c=this.getSiblings(a),d=c.indexOf(a);d===b||0>d||b>=0&&b<=c.size()&&(c.remove(a),b>c.size()&&b--,c.add(a,b),this._hierarchyChangeDispatcher.fire({data:a,oldIndex:d,newIndex:b}))},moveUp:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)-1)},moveDown:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)+1)},moveToTop:function(a){this.moveTo(a,0)},moveToBottom:function(a){var b=this.getSiblings(a);this.moveTo(a,b.size())},moveSelectionUp:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveUpDatas(a,b,this._rootList),b.forEach(this.moveUp,this)},moveSelectionDown:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveDownDatas(a,b,this._rootList),b.forEach(this.moveDown,this)},moveSelectionToTop:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveToTopDatas(a,b,this._rootList),b.forEach(this.moveToTop,this)},moveSelectionToBottom:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveToBottomDatas(a,b,this._rootList),b.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(a){var b=a.source;if("parent"===a.property){var c=b.getId();b.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(b)):this._rootMap[c]||(this._rootMap[c]=b,this._rootList.add(b))}this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},addHierarchyChangeListener:function(a,b,c){this._hierarchyChangeDispatcher.add(a,b,c)},removeHierarchyChangeListener:function(a,b){this._hierarchyChangeDispatcher.remove(a,b)},getRandomData:function(a){if(a){for(var b=new Gb.List,c=0;c<this._dataList.size()-1;c++){var d=this._dataList.get(c);d instanceof a&&b.add(d)}if(0==b.size())return null}var e=a?b.get(parseInt(Gb.Util.random()*b.size())):this._dataList.get(parseInt(Gb.Util.random()*this._dataList.size()));return e}}),Gb.ElementBox=function(a){Gb.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new Gb.AlarmBox(this),this._layerBox=new Gb.LayerBox(this),this._alarmStatePropagator=new Gb.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new Gb.EventDispatcher,this._undoManager=new Gb.UndoManager(this)},Gb.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},Hb.ext("twaver.ElementBox",Gb.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(a,b){if(a){if(!a.IElement)throw"Only IElement can be added into ElementBox";Gb.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(a)}},onDataPropertyChanged:function(a,b){Gb.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[b.property]&&this.adjustElementIndex(a),Gb.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(a,b,c){this._indexChangeDispatcher.add(a,b,c)},removeIndexChangeListener:function(a,b){this._indexChangeDispatcher.remove(a,b)},sendToTop:function(a){if(this.contains(a)){if(a!==this.getDatas().get(this.size()-1)){var b=this.getDatas().indexOf(a);this.getDatas().removeAt(b),this.getDatas().add(a),this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:this.size()-1})}a instanceof Gb.Link&&(a.getFromAgent()&&!a.getFromAgent().isAdjustedToBottom()&&this.sendToTop(a.getFromAgent()),a.getToAgent()&&!a.getToAgent().isAdjustedToBottom()&&this.sendToTop(a.getToAgent())),a instanceof Ld&&a.getFollowers()&&a.getFollowers().forEach(function(b){b.isRelatedTo(a)||a instanceof Gb.Follower&&b.isLoopedHostOn(a)||this.sendToTop(b)},this),a.ISubNetwork||a instanceof Nd&&!a.isExpanded()||a.getChildren().forEach(function(a){a instanceof Gb.Link||this.sendToTop(a)},this)}},sendToBottom:function(a,b){if(a!==b&&this.contains(a)&&(!b||this.contains(b))){var c=this.getDatas().remove(a),d=0;b&&(d=this.getDatas().indexOf(b)),this.getDatas().add(a,d),c!=d&&(this._indexChangeDispatcher.fire({element:a,oldIndex:c,newIndex:d}),!a.getParent()||a.getParent().ISubNetwork||a.getParent()instanceof Gb.Link||this.sendToBottom(a.getParent(),a))}},fireIndexChange:function(a,b,c){this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:c})},adjustElementIndex:function(a){this.contains(a)&&(a.isAdjustedToBottom()?(this.sendToBottom(a),a.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(a))},forEachByLayer:function(a,b,c){var d=this.size(),e=this.getDatas();if(b)for(var f=0;d>f;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}else this._layerBox.forEachByDepthFirst(function(b){for(var f=0;d>f;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},null,this)},forEachByLayerReverse:function(a,b,c){var d=new md;this.forEachByLayer(function(a){d.add(a,0)},b),d.forEach(a,c)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(a,b){Gb._isInitializing=!0,Gb._bundleLinks={},Gb._links={},a.call(b);var c,d;for(var e in Gb._links)c=Gb._links[e],c._checkAgentNodeImpl();for(var e in Gb._bundleLinks)d=Gb._bundleLinks[e],uc.resetBundleLinks(d[0],d[1]);Gb._bundleLinks=null,Gb._links=null,Gb._isInitializing=!1},getUndoManager:function(){return this._undoManager}}),Gb.SelectionModel=function(a){Gb.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new md,this._selectionChangeDispatcher=new Gb.EventDispatcher,this._selectionMap={},this._setDataBox(a)},Hb.ext("twaver.SelectionModel",Gb.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(a){if(this._selectionMode!==a&&("noneSelection"===a||"singleSelection"===a||"multipleSelection"===a)){this.clearSelection();var b=this._selectionMode;this._selectionMode=a,this.firePropertyChange("selectionMode",b,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(a){if(!a)throw"dataBox can not be null";if(this._dataBox!==a){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var b=this._dataBox;this._dataBox=a,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",b,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(a){if("remove"===a.kind){var b=a.data;this.contains(b)&&(this._selectionList.remove(b),delete this._selectionMap[b.getId()],this.fireSelectionChange("remove",new md(b)))}else"clear"===a.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(a){if(this._filterFunction!==a){this.clearSelection();var b=this._filterFunction;this._filterFunction=a,this.firePropertyChange("filterFunction",b,this._filterFunction)}},fireSelectionChange:function(a,b,c){c&&(this._selectionList.forEach(function(a){c.contains(a)?c.remove(a):c.add(a)}),b=c.toList()),this._selectionChangeDispatcher.fire({kind:a,datas:new md(b)})},addSelectionChangeListener:function(a,b,c){this._selectionChangeDispatcher.add(a,b,c)},removeSelectionChangeListener:function(a,b){this._selectionChangeDispatcher.remove(a,b)},_filterList:function(a,b){for(var c=new md(a),d=0;d<c.size();d++){var e=c.get(d);(this._filterFunction&&!this._filterFunction(e)||b&&this.contains(e)||!b&&!this.contains(e)||!this._dataBox.contains(e))&&(c.removeAt(d),d--)}return c},appendSelection:function(a){if("noneSelection"!==this._selectionMode){var b=this._filterList(a,!0);if(!b.isEmpty()){var c=null;"singleSelection"===this._selectionMode&&(c=new md(this._selectionList),this._selectionList.clear(),this._selectionMap={},b=new md(b.get(b.size()-1)));for(var d=0;d<b.size();d++){var e=b.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("append",b,c)}}},removeSelection:function(a){var b=this._filterList(a);if(0!==b.size()){for(var c=0;c<b.size();c++){var d=b.get(c);this._selectionList.remove(d),delete this._selectionMap[d.getId()]}this.fireSelectionChange("remove",b)}},toSelection:function(a,b){return this._selectionList.toList(a,b)},getSelection:function(){return this._selectionList},setSelection:function(a){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=a)){var b=new md(this._selectionList);this._selectionList.clear(),this._selectionMap={};var c=this._filterList(a,!0);"singleSelection"===this._selectionMode&&c.size()>1&&(c=new md(c.get(c.size()-1)));for(var d=0;d<c.size();d++){var e=c.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("set",null,b)}},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var a=this._dataBox.toDatas(),b=0,c=null;if(this._filterFunction)for(b=0;b<a.size();b++)c=a.get(b),this._filterFunction(c)||(a.removeAt(b),b--);var d=new md(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&a.size()>1&&(a=new md(a.get(a.size()-1))),b=0;b<a.size();b++)c=a.get(b),this._selectionList.add(c),this._selectionMap[c.getId()]=c;this.fireSelectionChange("all",null,d)}},size:function(){return this._selectionList.size()},contains:function(a){return a?null!=this._selectionMap[a.getId()]:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?"noneSelection"===this._selectionMode?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),Gb.QuickFinder=function(a,b,c,d,e){if(this._map={},!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=Hb.getter(b)),this._valueFunction=d||this.getValue,this._filterFunction=e||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Hb.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){"add"===a.kind?this._addData(a.data):"remove"===a.kind?this._removeData(a.data):"clear"===a.kind&&(this._map={})},handleDataPropertyChange:function(a){if(this._filterFunction.call(this,a.source)){if("accessor"===this._propertyType&&this._propertyName===a.property);else if("style"===this._propertyType&&a.source.IStyle&&"S:"+this._propertyName===a.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==a.property)return;var b=this._getMap(a.oldValue);b&&b.remove(a.source),this._addData(a.source)}},_getMap:function(a){return a=null==a?this._NULL_:a,this._map[a]},find:function(a){var b=this._getMap(a);return b?b.toList():new md},findFirst:function(a){var b=this._getMap(a);return!b||b.isEmpty()?null:b.get(0)},_addData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c||(c=new md,b=null==b?this._NULL_:b,this._map[b]=c),c.add(a)}},_removeData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c&&(c.remove(a),c.isEmpty()&&(b=null==b?this._NULL_:b,delete this._map[b]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return"style"===this._propertyType&&!a.IStyle||"accessor"===this._propertyType&&this._valueFunction===this.getValue&&!a[this._getter]?!1:!0},getValue:function(a){return"accessor"===this._propertyType?a[this._getter]():"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):null}}),Gb.PropertyPropagator=function(a,b,c){if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=Hb.getter(b),this._setter=Hb.setter(b)),this._enable=!1,this._isPropagating=!1},Hb.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){this._enable!==a&&(this._enable=a,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(a){this.propagate(a)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)))},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(a){if(this.isInterestedProperty(a))this.propagate(a.source);else if("parent"===a.property){var b=a.oldValue;b&&this.propagate(b),this.propagate(a.source)}},isInterestedProperty:function(a){return"accessor"===this._propertyType&&this._propertyName===a.property?!0:"style"===this._propertyType&&a.IElement&&"S:"+this._propertyName===a.property?!0:"client"===this._propertyType&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){a&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1)},propagateToTop:function(a){for(this.propagateToParent(null,a);a&&a.getParent();)this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(a,b){}}),Gb.AlarmStatePropagator=function(a){Gb.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},Hb.ext("twaver.AlarmStatePropagator",Gb.PropertyPropagator,{handleDataPropertyChange:function(a){"enablePropagation"===a.property?this.propagate(a.source):Gb.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(a,b){var c=null;b.getChildren().forEach(function(a){var b=a.getAlarmState().getHighestOverallAlarmSeverity();Gb.AlarmSeverity.compare(b,c)>0&&(c=b)}),b.getAlarmState().setPropagateSeverity(c)}}),Gb.AlarmSeverity=function(a,b,c,d,e){this.value=a,this.name=b,this.nickName=c,this.color=d,this.displayName=e},Hb.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=Gb.AlarmSeverity;a.severities=new md,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:0>c?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?0===a.value:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),Gb.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Hb.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){
return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var a=null;for(var b in this._am)b=Gb.AlarmSeverity.getByName(b),Gb.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getAcknowledgedAlarmCount(b)&&(a=a&&Gb.AlarmSeverity.compare(a,b)>0?a:b);this._haa=a},_c2:function(){var a=null;for(var b in this._nm)b=Gb.AlarmSeverity.getByName(b),Gb.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getNewAlarmCount(b)&&(a=a&&Gb.AlarmSeverity.compare(a,b)>0?a:b);this._hna=a},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var a in this._nm)if(a=Gb.AlarmSeverity.getByName(a),!Gb.AlarmSeverity.isClearedAlarmSeverity(a)&&0!==this.getNewAlarmCount(a)&&Gb.AlarmSeverity.compare(this._hna,a)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var a=this._haa,b=this._hna,c=this._ps;this._hoa=a,Gb.AlarmSeverity.compare(b,this._hoa)>0&&(this._hoa=b),Gb.AlarmSeverity.compare(c,this._hoa)>0&&(this._hoa=c)},_c5:function(){var a=this._haa,b=this._hna;this._hta=a,Gb.AlarmSeverity.compare(b,this._hta)>0&&(this._hta=b)},increaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];null==c&&(c=0),c+=b,this._am[a.name]=c,this._f()}},increaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];null==c&&(c=0),c+=b,this._nm[a.name]=c,this._f()}},decreaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._am[a.name]=c,this._f()}},decreaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._nm[a.name]=c,this._f()}},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(a){if(a){var b=this.getNewAlarmCount(a);this.decreaseNewAlarm(a,b),this.increaseAcknowledgedAlarm(a,b)}else for(var c in this._nm)this.acknowledgeAllAlarms(Gb.AlarmSeverity.getByName(c))},_c6:function(){this._aac=0;for(var a in this._am)a=Gb.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(a){if(a){var b=this._am[a.name];return null==b?0:b}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm)a=Gb.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)},getNewAlarmCount:function(a){if(a){var b=this._nm[a.name];return null==b?0:b}return this._nac},setNewAlarmCount:function(a,b){this._nm[a.name]=b,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,b){this._am[a.name]=b,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){if(this._ep||(a=null),this._ps!==a){var b=this._ps;this._ps=a,this._f(),this._e.firePropertyChange("propagateSeverity",b,a)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(a){var b=this._ep;this._ep=a,this._e.firePropertyChange("enablePropagation",b,a)&&(a||this.setPropagateSeverity(null))}}),Gb.AlarmBox=function(a){if(!a)throw"elementBox can not be null.";Gb.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new Gb.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Hb.ext("twaver.AlarmBox",Gb.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(a){var b=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=a,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",b,a),a&&this.toDatas(function(a){return a.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(a){if(!a)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==a){var b=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=a,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",b,a)}},handleElementBoxChange:function(a){"add"===a.kind?this.handleElementAdded(a.data):"remove"===a.kind?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):"clear"===a.kind&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){"add"===a.kind?this._increaseAlarmState(a.data):"remove"===a.kind?this._decreaseAlarmState(a.data):"clear"===a.kind&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(a){var b=a.source;b.isCleared()||("alarmSeverity"===a.property?this.handleAlarmSeverityChange(b,a):"acked"===a.property&&this.handleAckedChange(b,a)),"cleared"===a.property&&(b.isCleared()?(this._decreaseAlarmState(b,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(b)):this._increaseAlarmState(b,!0))},handleAckedChange:function(a,b){if(a.getAlarmSeverity()){var c=this.getCorrespondingElements(a);if(c)for(var d=0;d<c.size();d++){var e=c.get(d);b.oldValue?e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()),b.newValue?e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity())}}},handleAlarmSeverityChange:function(a,b){var c=b.oldValue,d=b.newValue,e=this.getCorrespondingElements(a);if(e)for(var f=0;f<e.size();f++){var g=e.get(f);c&&(a.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(c):g.getAlarmState().decreaseNewAlarm(c)),d&&(a.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(a){var b=this.getCorrespondingAlarms(a);if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(!d.isCleared()){var e=d.getAlarmSeverity();e&&(d.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(e):a.getAlarmState().increaseNewAlarm(e))}}},_increaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().increaseAcknowledgedAlarm(c):f.getAlarmState().increaseNewAlarm(c)}}}},_decreaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().decreaseAcknowledgedAlarm(c):f.getAlarmState().decreaseNewAlarm(c)}}}},handleElementRemoved:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(function(b){!b.isCleared()&&b.getAlarmSeverity()&&(b.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity()))})},removeAlarmsByElement:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(this.remove,this)},add:function(a,b){if(!a.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&a.isCleared()||Gb.AlarmBox.superClass.add.apply(this,arguments)}}),Gb.AlarmElementMapping=function(a,b){if(!b)throw"ElementBox can not be null";if(!a)throw"AlarmBox can not be null";this._elementBox=b,this._alarmBox=a,this._alarmsFinder=new Gb.QuickFinder(a,"elementId")},Hb.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(a){var b=this._elementBox.getDataById(a.getElementId());return new md(b)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Gb.AlarmStateStatistics=function(a){Gb.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(a)},Hb.ext("twaver.AlarmStateStatistics",Gb.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._elementBox!==a){var b=this._elementBox;b&&(b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=a,this.reset(),a.addDataPropertyChangeListener(this.handleElementPropertyChange,this),a.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",b,a)}},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(a){"alarmState"===a.property&&(this.increase(a.source),this.fireAlarmStateChange())},handleElementBoxChange:function(a){"add"===a.kind?(this.increase(a.data),this.fireAlarmStateChange()):"remove"===a.kind?(this.decrease(a.data),this.fireAlarmStateChange()):"clear"===a.kind&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,Gb.AlarmSeverity.forEach(function(a){var b=this.getSumInfo(a);this.sumAcked+=b.ackedCount,this.sumNew+=b.newCount,this.sumTotal+=b.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(a){if(!a)return this.sumNew;var b=this.getSumInfo(a);return b.newCount},getAcknowledgedAlarmCount:function(a){if(!a)return this.sumAcked;var b=this.getSumInfo(a);return b.ackedCount},getTotalAlarmCount:function(a){if(!a)return this.sumTotal;var b=this.getSumInfo(a);return b.totalCount},getSumInfo:function(a){var b=this.severtiyMap[a.name];return b||(b={},b.newCount=0,b.ackedCount=0,b.totalCount=0,this.severtiyMap[a.name]=b),b},decrease:function(a){var b=this.elementMap[a.getId()];b&&(delete this.elementMap[a.getId()],Gb.AlarmSeverity.forEach(function(a){var c=b[a.name],d=this.getSumInfo(a);d.newCount=d.newCount-c.newCount,d.ackedCount=d.ackedCount-c.ackedCount,d.totalCount=d.totalCount-c.totalCount},this))},increase:function(a){if(this.decrease(a),!this._filterFunction||this._filterFunction(a)){var b={};this.elementMap[a.getId()]=b,Gb.AlarmSeverity.forEach(function(c){var d={};d.newCount=a.getAlarmState().getNewAlarmCount(c),d.ackedCount=a.getAlarmState().getAcknowledgedAlarmCount(c),d.totalCount=a.getAlarmState().getAlarmCount(c),b[c.name]=d;var e=this.getSumInfo(c);e.newCount=e.newCount+d.newCount,e.ackedCount=e.ackedCount+d.ackedCount,e.totalCount=e.totalCount+d.totalCount},this)}},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(a){var b=this._filterFunction;this._filterFunction=a,this.reset(),this.firePropertyChange("filterFunction",b,a)},getFilterFunction:function(){return _filterFunction}}),Gb.LayerBox=function(a){Gb.LayerBox.superClass.constructor.call(this),this._elementBox=a,this._defaultLayer=new Gb.Layer(Dd.LAYER_DEFAULT_ID,Dd.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},Hb.ext("twaver.LayerBox",Gb.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(a,b){if(!a.ILayer)throw"Only ILayer can be added into LayerBox";Gb.LayerBox.superClass.add.apply(this,arguments)},removeById:function(a){if(a===this._defaultLayer.getId())throw"Cannot remove default layer";Gb.LayerBox.superClass.removeById.call(this,a)},getLayerByElement:function(a){if(!a)return null;if(a._layerId===Dd.LAYER_DEFAULT_ID)return this._defaultLayer;var b=this.getDataById(a.getLayerId());return b?b:this._defaultLayer},clear:function(){this.toDatas().forEach(function(a){a!=this._defaultLayer&&this.removeById(a.getId())},this)}}),Gb.BundleLinks=function(a,b){this._links=a,this._siblings=b;var c,d,e=Ed._m["link.bundle.expanded"];for(c=0;c<a.size();c++){d=a.get(c);var f=d.getStyle("link.bundle.expanded");if(null!=f){e=f;break}}if(null==e&&(e=!0),Dd.LINK_BUNDLE_AGENT_FUNCTION){var g=Dd.LINK_BUNDLE_AGENT_FUNCTION(a);null==g?g=a.get(0):g!=a.get(0)&&(a.remove(g),a.add(g,0))}for(c=0;c<a.size();c++)a.get(c).setStyle("link.bundle.expanded",e)},Hb.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(a,b){this._siblings.forEach(function(c){c.getLinks().forEach(a,b)})}});var Fd={bitsToNum:function(a){return a.reduce(function(a,b){return 2*a+b},0)},byteToBitArr:function(a){for(var b=[],c=7;c>=0;c--)b.push(!!(a&1<<c));return b},lzwDecode:function(a,b){for(var c,d,e=0,f=function(a){for(var c=0,d=0;a>d;d++)b.charCodeAt(e>>3)&1<<(7&e)&&(c|=1<<d),e++;return c},g=[],h=1<<a,i=h+1,j=a+1,k=[],l=function(){k=[],j=a+1;for(var b=0;h>b;b++)k[b]=[b];k[h]=[],k[i]=null};;)if(d=c,c=f(j),c!==h){if(c===i)break;if(c<k.length)d!==h&&k.push(k[d].concat(k[c][0]));else{if(c!==k.length)throw new Error("Invalid LZW code.");k.push(k[d].concat(k[d][0]))}g.push.apply(g,k[c]),k.length===1<<j&&12>j&&j++}else l();return g}},Gd=function(a){this.data=a,this.len=this.data.length,this.pos=0};Hb.ext(Gd,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},readBytes:function(a){for(var b=[],c=0;a>c;c++)b.push(this.readByte());return b},read:function(a){for(var b="",c=0;a>c;c++)b+=String.fromCharCode(this.readByte());return b},readUnsigned:function(){var a=this.readBytes(2);return(a[1]<<8)+a[0]}});var Hd=function(a){var b,c=a,d=null,e=null,f=null,g=0,h=null,i=null,j=null;this.frames=[],this.size={};var k=this,l=Mb.createElement("canvas");this.loaded=!1;var m=function(){d=null,e=null,h=f,f=null,i=null};this.doParse=function(){Id(c,t)};var n=function(a){b=a,k.size.width=b.width,k.size.height=b.height},o=function(a){p(),m(),d=a.transparencyGiven?a.transparencyIndex:null,e=a.delayTime,f=a.disposalMethod},p=function(){i&&k.frames.push({data:i.getImageData(0,0,b.width,b.height),delay:e})},q=function(a){i||(i=l.getContext("2d"));var c=k.frames.length,e=a.lctFlag?a.lct:b.gct;c>0&&(3===h?i.putImageData(k.frames[g].data,0,0):g=c-1,2===h&&(j||i.clearRect(j.leftPos,j.topPos,j.width,j.height)));var f=i.getImageData(a.leftPos,a.topPos,a.width,a.height);a.pixels.forEach(function(a,b){a!==d&&(f.data[4*b+0]=e[a][0],f.data[4*b+1]=e[a][1],f.data[4*b+2]=e[a][2],f.data[4*b+3]=255)}),i.putImageData(f,a.leftPos,a.topPos),j=a},r=function(){},s=function(a){return function(b){a(b)}},t={hdr:s(n),gce:s(o),com:s(r),app:{NETSCAPE:s(r)},img:s(q),eof:function(a){p(),k.loaded=!0}}},Id=function(a,b){b||(b={});var c=function(b){for(var c=[],d=0;b>d;d++)c.push(a.readBytes(3));return c},d=function(){var b,c;c="";do b=a.readByte(),c+=a.read(b);while(0!==b);return c},e=function(){var d={};if(d.sig=a.read(3),d.ver=a.read(3),"GIF"!==d.sig)throw new Error("Not a GIF file.");d.width=a.readUnsigned(),d.height=a.readUnsigned();var e=Fd.byteToBitArr(a.readByte());d.gctFlag=e.shift(),d.colorRes=Fd.bitsToNum(e.splice(0,3)),d.sorted=e.shift(),d.gctSize=Fd.bitsToNum(e.splice(0,3)),d.bgColor=a.readByte(),d.pixelAspectRatio=a.readByte(),d.gctFlag&&(d.gct=c(1<<d.gctSize+1)),b.hdr&&b.hdr(d)},f=function(c){var e=function(c){var d=(a.readByte(),Fd.byteToBitArr(a.readByte()));c.reserved=d.splice(0,3),c.disposalMethod=Fd.bitsToNum(d.splice(0,3)),c.userInput=d.shift(),c.transparencyGiven=d.shift(),c.delayTime=a.readUnsigned(),c.transparencyIndex=a.readByte(),c.terminator=a.readByte(),b.gce&&b.gce(c)},f=function(a){a.comment=d(),b.com&&b.com(a)},g=function(c){a.readByte(),c.ptHeader=a.readBytes(12),c.ptData=d(),b.pte&&b.pte(c)},h=function(c){var e=function(c){a.readByte(),c.unknown=a.readByte(),c.iterations=a.readUnsigned(),c.terminator=a.readByte(),b.app&&b.app.NETSCAPE&&b.app.NETSCAPE(c)},f=function(a){a.appData=d(),b.app&&b.app[a.identifier]&&b.app[a.identifier](a)};switch(a.readByte(),c.identifier=a.read(8),c.authCode=a.read(3),c.identifier){case"NETSCAPE":e(c);break;default:f(c)}},i=function(a){a.data=d(),b.unknown&&b.unknown(a)};switch(c.label=a.readByte(),c.label){case 249:c.extType="gce",e(c);break;case 254:c.extType="com",f(c);break;case 1:c.extType="pte",g(c);break;case 255:c.extType="app",h(c);break;default:c.extType="unknown",i(c)}},g=function(e){var f=function(a,b){for(var c=new Array(a.length),d=a.length/b,e=function(d,e){var f=a.slice(e*b,(e+1)*b);c.splice.apply(c,[d*b,b].concat(f))},f=[0,4,2,1],g=[8,8,4,2],h=0,i=0;4>i;i++)for(var j=f[i];d>j;j+=g[i])e(j,h),h++;return c};e.leftPos=a.readUnsigned(),e.topPos=a.readUnsigned(),e.width=a.readUnsigned(),e.height=a.readUnsigned();var g=Fd.byteToBitArr(a.readByte());e.lctFlag=g.shift(),e.interlaced=g.shift(),e.sorted=g.shift(),e.reserved=g.splice(0,2),e.lctSize=Fd.bitsToNum(g.splice(0,3)),e.lctFlag&&(e.lct=c(1<<e.lctSize+1)),e.lzwMinCodeSize=a.readByte();var h=d();e.pixels=Fd.lzwDecode(e.lzwMinCodeSize,h),e.interlaced&&(e.pixels=f(e.pixels,e.width)),b.img&&b.img(e)},h=function(){var c={};switch(c.sentinel=a.readByte(),String.fromCharCode(c.sentinel)){case"!":c.type="ext",f(c);break;case",":c.type="img",g(c);break;case";":c.type="eof",b.eof&&b.eof(c);break;default:throw new Error("Unknown block: 0x"+c.sentinel.toString(16))}"eof"!==c.type&&setTimeout(h,0)},i=function(){e(),setTimeout(h,0)};i()},Jd=function(a,b,c){var d=Mb.createElement("canvas");return Kd(d,b.width,b.height),d.getContext("2d").clearRect(0,0,b.width,b.height),d.getContext("2d").putImageData(a[c].data,0,0),d},Kd=function(a,b,c){a.width=b,a.height=c,a.style.width=b+"px",a.style.height=c+"px"};Gb.Data=function(a){if(Gb.Data.superClass.constructor.apply(this,arguments),this._childList=new md,this._childMap={},this._clientMap={},void 0===a||null===a)this._id=Hb.id();else if("string"==typeof a||"number"==typeof a||"boolean"==typeof a)this._id=a;else{for(var b in a)if("clients"===b)for(var c in a.clients)this._clientMap[c]=a.clients[c];else if("styles"===b)for(var d in a.styles)this._styleMap[d]=a.styles[d];else null!=a[b]&&("id"===b?this._id=a[b]:this[Hb.setter(b)]&&this[Hb.setter(b)](a[b]));null==this._id&&(this._id=Hb.id())}},Hb.ext("twaver.Data",Gb.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:Dd.ICON_DATA,_dragBoundsFunc:null,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(a,b){return this._childList.toList(a,b)},addChild:function(a,b){return void 0===b&&(b=this._childList.size()),a&&a!==this?this._childMap[a.getId()]?!1:this.isDescendantOf(a)?!1:(a.getParent()&&a.getParent().removeChild(a),(0>b||b>this._childList.size())&&(b=this._childList.size()),this._childList.add(a,b),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,b),!0):!1},onChildAdded:function(a,b){},removeChild:function(a){if(!a)return!1;if(!this._childMap[a._id])return!1;var b=this._childList.remove(a);return delete this._childMap[a._id],this.firePropertyChange("children",a,null),a.setParent(null),this.onChildRemoved(a,b),!0},onChildRemoved:function(a,b){},getChildAt:function(a){return this._childList.get(a)},clearChildren:function(){if(0===this._childList.size())return!1;for(var a=this._childList.toArray(),b=a.length,c=0;b>c;c++)this.removeChild(a[c]);return this.onChildrenCleared(a),!0},onChildrenCleared:function(a){},getParent:function(){return this._parent},setParent:function(a){if(!(this._isUpdatingParent||this._parent===a||this===a||a&&a.isDescendantOf(this))){var b=this._parent;this._parent=a,this._isUpdatingParent=!0,b&&b.removeChild(this),a&&a.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",b,a),this.onParentChanged(b,a)}},onParentChanged:function(a,b){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(a){return a?this.isDescendantOf(a)||a.isDescendantOf(this):!1},isParentOf:function(a){return a?null!=this._childMap[a._id]:!1},isDescendantOf:function(a){if(!a)return!1;if(!a.hasChildren())return!1;for(var b=this._parent;b;){if(a===b)return!0;b=b.getParent()}return!1},getDragBoundsFunc:function(){return this._dragBoundsFunc},setDragBoundsFunc:function(a){this._dragBoundsFunc=a},toString:function(){return this.getName()?this.getName():this._id}}),Gb.Alarm=function(a,b,c,d,e){Gb.Alarm.superClass.constructor.call(this,a),this._elementId=b,this._alarmSeverity=c,this._acked=d||!1,this._cleared=e||!1},Hb.ext("twaver.Alarm",Gb.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),Gb.Layer=function(a){Gb.Layer.superClass.constructor.call(this,a)},Hb.ext("twaver.Layer",Gb.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),Gb.Element=function(a){this._styleMap=this._styleMap||{},this._alarmState=new Gb.AlarmState(this),Gb.Element.superClass.constructor.call(this,a)},Hb.ext("twaver.Element",Gb.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible","movable"],__style:1,_layerId:Dd.LAYER_DEFAULT_ID,_visible:!0,_movable:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(a,b){return void 0===b?this.getStyle(a):(this.setStyle(a,b),this)},c:function(a,b){return void 0===b?this.getClient(a):(this.setClient(a,b),this)}}),Gb.Dummy=function(a){Gb.Dummy.superClass.constructor.call(this,a)},Hb.ext("twaver.Dummy",Gb.Element,{IDummy:!0});var Ld=function(a){this._location={x:0,y:0},Ld.superClass.constructor.call(this,a)};Gb.Node=Ld,Ld.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},Hb.ext("twaver.Node",Gb.Element,{_icon:Dd.ICON_NODE,_image:Dd.IMAGE_NODE,_imageUrl:null,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(a){this._followers||(this._followers=new md),this._followers.add(a)},_removeFollower:function(a){this._followers.remove(a),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._links||(this._links=new md(!1)),this._fromLinks||(this._fromLinks=new md(!1)),this._links.add(a),this._toLinks&&this._toLinks.contains(a)&&(this._loopedLinks||(this._loopedLinks=new md(!1)),this._loopedLinks.add(a)),this._fromLinks.add(a)},_addToLink:function(a){this._links||(this._links=new md(!1)),this._toLinks||(this._toLinks=new md(!1)),this._links.add(a),this._fromLinks&&this._fromLinks.contains(a)&&(this._loopedLinks||(this._loopedLinks=new md(!1)),this._loopedLinks.add(a)),this._toLinks.add(a)},_removeFromLink:function(a){this._links&&this._links.remove(a),this._fromLinks&&this._fromLinks.remove(a),this._loopedLinks&&this._loopedLinks.remove(a)},_removeToLink:function(a){this._links&&this._links.remove(a),this._toLinks&&this._toLinks.remove(a),this._loopedLinks&&this._loopedLinks.remove(a)},hasAgentLinks:function(){return null!=this._agentLinks&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(a){this._fromAgentLinks||(this._fromAgentLinks=new md(!1)),this._agentLinks||(this._agentLinks=new md(!1)),this._fromAgentLinks.add(a),this._agentLinks.add(a)},_addToAgentLink:function(a){this._toAgentLinks||(this._toAgentLinks=new md(!1)),this._agentLinks||(this._agentLinks=new md(!1)),this._toAgentLinks.add(a),this._agentLinks.add(a)},_removeFromAgentLink:function(a){this._fromAgentLinks&&this._fromAgentLinks.remove(a),this._agentLinks&&this._agentLinks.remove(a)},_removeToAgentLink:function(a){this._toAgentLinks&&this._toAgentLinks.remove(a),this._agentLinks&&this._agentLinks.remove(a)},getImage:function(){return this._image},setImage:function(a){var b=this._image,c=this.getWidth(),d=this.getHeight();this._image=a,this.firePropertyChange("image",b,a),this.firePropertyChange("width",c,this.getWidth()),this.firePropertyChange("height",d,this.getHeight())},getImageUrl:function(){return this._imageUrl},setImageUrl:function(a){if(this._imageUrl!=a){var b=this._imageUrl;this._imageUrl=a,Cd.images[a]||Gb.imageUtil.registerImageByUrl(a,"svg"===Gb.imageUtil.getImageType(a),a),this.setImage(a),this.firePropertyChange("imageUrl",b,a)}},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(a){this.setLocation(a,this._location.y)},setY:function(a){this.setLocation(this._location.x,a)},getLocation:function(){return this._location},setLocation:function(a,b){var c;if(c=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],Hb.num(c.x)&&Hb.num(c.y)&&(c.x!==this._location.x||c.y!==this._location.y)){this._dragBoundsFunc&&(c=this._dragBoundsFunc(c));var d=this._location;this._location=c,this.firePropertyChange("location",d,c)}},getCenterLocation:function(){return Dd.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(a,b){var c;c=2===arguments.length?{x:arguments[0],y:arguments[1]}:Hb.clone(arguments[0]),Hb.num(c.x)&&Hb.num(c.y)&&(Dd.CENTER_LOCATION||(c.x-=this.getWidth()/2,c.y-=this.getHeight()/2),this.setLocation(c))},translate:function(a,b){this.setLocation(this.getX()+a,this.getY()+b)},getWidth:function(){if(Hb.num(this._width)&&this._width>=0)return this._width;if("object"!=typeof this._image){var a=Hb.getImageAsset(this._image);if(a){var b=a.getWidth();return Hb.num(b)&&b>=0?b:(a=a._image,Xc(this,a,a,"w"))}}else if(this._image)return this._image.w;return Dd.NODE_WIDTH},setWidth:function(a){var b=this._width;this._width=a,this.firePropertyChange("width",b,a)},getHeight:function(){if(Hb.num(this._height)&&this._height>=0)return this._height;if("object"!=typeof this._image){var a=Hb.getImageAsset(this._image);if(a){var b=a.getHeight();return Hb.num(b)&&b>=0?b:(a=a._image,Xc(this,a,a,"h"))}}else if(this._image)return this._image.h;return Dd.NODE_HEIGHT},setHeight:function(a){var b=this._height;this._height=a,this.firePropertyChange("height",b,a)},setSize:function(){2===arguments.length?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var a=this.getOriginalRect();if(0===this._angle)return a;for(var b=Rb.createMatrix(this._angle*Math.PI/180,a.x+a.width/2,a.y+a.height/2),c=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}],d=0,e=c.length;e>d;d++)c[d]=b.transform(c[d]);var f=Rb.getRect(c);return f},getOriginalRect:function(){var a=this,b=a.getWidth(),c=a.getHeight();return Dd.CENTER_LOCATION?{x:a._location.x-b/2,y:a._location.y-c/2,width:b,height:c}:{x:a.getX(),y:a.getY(),width:b,height:c}},getAngle:function(){return this._angle},setAngle:function(a){var b=this._angle;this._angle=a%360,this.firePropertyChange("angle",b,this._angle)},onParentChanged:function(a,b){Ld.superClass.onParentChanged.call(this,a,b),this._checkLinkAgent()},_checkLinkAgent:function(){if(Gb._isInitializing){if(this._links)for(var a=this._links.size(),b=0;a>b;b++)this._links.get(b)._checkAgentNode()}else Gb.ElementBox.prototype.startBatch(function(){if(this._links)for(var a=this._links.size(),b=0;a>b;b++)this._links.get(b)._checkAgentNode()},this)},onPropertyChanged:function(a){if(Ld.superClass.onPropertyChanged.call(this,a),this._followers)for(var b=this._followers.toList(),c=b.size(),d=0;c>d;d++)b.get(d).handleHostPropertyChange(a);this.getParent()instanceof Nd&&Ld.IS_INTERESTED_NODE_PROPERTY[a.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return Gb.network.NodeUI},getCanvasUIClass:function(){return Gb.canvas.NodeUI},getVectorUIClass:function(){return Gb.vector.NodeUI}});var Md=function(a){Md.superClass.constructor.call(this,a)};Gb.HTMLNode=Md,Hb.ext("twaver.HTMLNode",Gb.Node,{getElementUIClass:function(){return Gb.network.HTMLNodeUI},getCanvasUIClass:function(){return Gb.canvas.HTMLNodeUI},getVectorUIClass:function(){return Gb.vector.HTMLNodeUI}}),Gb.Link=function(a,b,c){Gb.Link.superClass.constructor.call(this,a instanceof Ld?null:a),a instanceof Ld&&(c=b,b=a),b&&this.setFromNode(b),c&&this.setToNode(c)},Gb.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},Hb.ext("twaver.Link",Gb.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:Dd.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(a){if(this._fromNode!==a){var b=this._fromNode;this._fromNode=a,b&&b._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",b,a)}},setToNode:function(a){if(this._toNode!==a){var b=this._toNode;this._toNode=a,b&&b._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",b,a)}},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},_checkAgentNode:function(){Gb._isInitializing?Gb._links[this._id]||(Gb._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var a,b,c=uc.figureFromAgent(this),d=this;this._fromAgent!=c&&(a=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=c,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",a,this._fromAgent),Gb._isInitializing?(a&&this._toAgent&&(b=a._id+":"+this._toAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[a,this._toAgent])),this._fromAgent&&this._toAgent&&(b=this._fromAgent._id+":"+this._toAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[this._fromAgent,this._toAgent]))):(uc.resetBundleLinks(a,d._toAgent),uc.resetBundleLinks(d._fromAgent,d._toAgent)));var e=uc.figureToAgent(this);this._toAgent!=e&&(a=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=e,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",a,this._toAgent),Gb._isInitializing?(a&&this._fromAgent&&(b=a._id+":"+this._fromAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[a,this._fromAgent])),this._toAgent&&this._fromAgent&&(b=this._toAgent._id+":"+this._fromAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[this._toAgent,this._fromAgent]))):(uc.resetBundleLinks(a,d._fromAgent),uc.resetBundleLinks(d._toAgent,d._fromAgent)))},_setBundleLinks:function(a){this._bundleLinks=a,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1;
},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var a,b,c=this._bundleLinks.getLinks(),d=!this.getStyle("link.bundle.expanded");for(a=0;a<c.size();a++)b=c.get(a),b.setStyle("link.bundle.expanded",d);var e=this._bundleLinks.getSiblings();for(a=0;a<e.size();a++){var f=e.get(a);if(f!=this._bundleLinks){c=f.getLinks();for(var g=0;g<c.size();g++)b=c.get(g),b.firePropertyChange("bundleLinks",null,f)}}return!0}return!1},isBundleAgent:function(){return null!=this._bundleLinks&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(a,b,c){Gb.Link.superClass.onStyleChanged.call(this,a,b,c),Gb.Link.IS_INTERESTED_BUNDLE_STYLE[a]&&uc.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return Gb.network.LinkUI},getCanvasUIClass:function(){return Gb.canvas.LinkUI},getVectorUIClass:function(){return Gb.vector.LinkUI},isAdjustedToBottom:function(){return Dd.IS_LINK_ADJUSTED_TO_BOTTOM}}),Gb.HTMLLink=function(a,b,c){Gb.HTMLLink.superClass.constructor.call(this,a,b,c)},Gb.Util.ext("twaver.HTMLLink",Gb.Link,{getElementUIClass:function(){return Gb.network.HTMLLinkUI},getCanvasUIClass:function(){return Gb.canvas.HTMLLinkUI},getVectorUIClass:function(){return Gb.vector.HTMLLinkUI}}),Gb.Follower=function(a){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,Gb.Follower.superClass.constructor.call(this,a)},Gb.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},Gb.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},Hb.ext("twaver.Follower",Ld,{_host:null,getHost:function(){return this._host},setHost:function(a){if(this!==a&&this._host!==a){var b=this._host;b&&b._removeFollower(this),this._host=a,this._host&&this._host._addFollower(this),this.firePropertyChange("host",b,a),this.onHostChanged(b,a)}},onStyleChanged:function(a,b,c){Gb.Follower.superClass.onStyleChanged.call(this,a,b,c),Gb.Follower.IS_INTERESTED_FOLLOWER_STYLE[a]&&this.updateFollower(null)},setLocation:function(){this._isUpdatingLocation||(this._isUpdatingLocation=!0,Gb.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1)},onHostChanged:function(a,b){this.updateFollower(null)},handleHostPropertyChange:function(a){this.updateFollower(a)},updateFollower:function(a){this._isUpdatingFollower||Hb.isDeserializing||(this._isUpdatingFollower=!0,this.updateFollowerImpl(a),this._isUpdatingFollower=!1)},updateFollowerImpl:function(a){var b=this.getHost();if(b instanceof Gb.Grid){if(!a||Gb.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[a.property]){var c=this.getStyle("follower.row.index"),d=this.getStyle("follower.column.index"),e=b.getCellRect(c,d);if(!e)return;var f=this.getStyle("follower.row.span"),g=this.getStyle("follower.column.span");if(1!=f||1!=g){var h=b.getCellRect(c+f-1,d+g-1);h&&(e=Rb.unionRect(e,h))}if(Rb.addPadding(e,this,"follower.padding"),this.getStyle("follower.fill.cell"))this.setLocation(e.x,e.y),this.setWidth(e.width),this.setHeight(e.height);else{var i=this.getStyle("follower.cell.position");e=Tb.get(i,e,this.getRect()),this.setLocation(e.x,e.y)}}}else if(null!=a&&"location"===a.property){var j=a.oldValue,k=a.newValue,l=this.getLocation();this.setLocation(l.x+(k.x-j.x),l.y+(k.y-j.y))}},isHostOn:function(a){if(!a)return!1;for(var b={},c=this._host;c&&c!=this&&!b[c.getId()];){if(c===a)return!0;b[c.getId()]=c,c=c instanceof Gb.Follower?c.getHost():null}return!1},isLoopedHostOn:function(a){return this.isHostOn(a)&&a.isHostOn(this)}});var Nd=function(a){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,Nd.superClass.constructor.call(this,a)};Gb.Group=Nd,Hb.ext("twaver.Group",Gb.Follower,{_image:Dd.IMAGE_GROUP,_icon:Dd.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&uc.hasAgentLinks(this)},onChildAdded:function(a,b){Nd.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(a,b){Nd.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(!this._isAdjusting&&!Hb.isDeserializing){for(var a,b,c=0,d=this.getChildrenSize();d>c;c++)b=this.getChildAt(c),b instanceof Ld&&(a=Rb.unionRect(a,this.getChildRect(b)));a&&(this._isUpdatingLocationFromChildren=!0,"lefttop"===Dd.GROUP_EXPAND_ALIGN?this.setLocation(a.x-this.getWidth()/2,a.y-this.getHeight()/2):this.setLocation(a.x+a.width/2-this.getWidth()/2,a.y+a.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)}},getChildRect:function(a){var b;return a instanceof Ld&&(a instanceof Nd?(a.isExpanded()&&a.getChildren().forEach(function(c){b=Rb.unionRect(b,a.getChildRect(c))}),b||(b=a.getRect())):b=a.getRect()),b},setLocation:function(){if(!this._isAdjusting){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Hb.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var b=a.x-this.getX(),c=a.y-this.getY();uc.moveElements(this.getChildren(),b,c),this._isAdjusting=!1}Nd.superClass.setLocation.call(this,a)}},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(a){if(this._expanded!==a){var b=this._expanded;this._expanded=a,this.firePropertyChange("expanded",b,this._expanded),this._checkLinkAgent()}},_checkLinkAgent:function(){Nd.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Ld&&c._checkLinkAgent()}},getElementUIClass:function(){return Gb.network.GroupUI},getCanvasUIClass:function(){return Gb.canvas.GroupUI},getVectorUIClass:function(){return Gb.vector.GroupUI}}),Gb.SubNetwork=function(a){Gb.SubNetwork.superClass.constructor.call(this,a)},Hb.ext("twaver.SubNetwork",Gb.Follower,{ISubNetwork:!0,_image:Dd.IMAGE_SUBNETWORK,_icon:Dd.ICON_SUBNETWORK,_checkLinkAgent:function(){Gb.SubNetwork.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Ld&&c._checkLinkAgent()}}}),Gb.Grid=function(a){Gb.Grid.superClass.constructor.call(this,a)},Hb.ext("twaver.Grid",Gb.Follower,{_icon:Dd.ICON_GRID,_image:null,getCellObject:function(a,b){1===arguments.length&&(b=a.y,a=a.x);for(var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count"),e=0;c>e;e++)for(var f=0;d>f;f++){var g=this.getCellRect(e,f);if(Rb.containsPoint(g,a,b))return{rowIndex:e,columnIndex:f,rect:g}}return null},getCellRect:function(a,b){var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");if(0>=c||0>=d)return null;if(0>a||a>=c)return null;if(0>b||b>=d)return null;var e=this.getRect();Rb.addPadding(e,this,"grid.border");var f=0,g=this.getStyle("grid.row.percents"),h=this.getStyle("grid.column.percents");if(g&&g.length===c){var i=0;for(f=0;a>f;f++)i+=e.height*g[f];e.y+=i,e.height=e.height*g[a]}else e.height=e.height/c,e.y+=e.height*a;if(h&&h.length===d){var j=0;for(f=0;b>f;f++)j+=e.width*h[f];e.x+=j,e.width=e.width*h[b]}else e.width=e.width/d,e.x+=e.width*b;return Rb.addPadding(e,this,"grid.padding"),e},getElementUIClass:function(){return Gb.network.GridUI},getCanvasUIClass:function(){return Gb.canvas.GridUI},getVectorUIClass:function(){return Gb.vector.GridUI}}),Gb.ShapeNode=function(a){this._isUpdatingShapeNode=!1,this._points=new md,Gb.ShapeNode.superClass.constructor.call(this,a)},Hb.ext("twaver.ShapeNode",Gb.Follower,{_icon:Dd.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return Gb.network.ShapeNodeUI},getCanvasUIClass:function(){return Gb.canvas.ShapeNodeUI},getVectorUIClass:function(){return Gb.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new md);var b=new md(this._points);this._points=a,this.firePointsChange(b,this._points)},getSegments:function(){return this._segments},setSegments:function(a){a||(a=new md);var b=new md(this._segments);this._segments=a,this._reCalculateLineLength(),this.firePropertyChange("segments",b,this._segments)},addPoint:function(a,b){var c=new md(this._points);this._points.add(a,b),this.firePointsChange(c,this._points)},setPoint:function(a,b){var c=new md(this._points);this._points.set(a,b),this.firePointsChange(c,this._points)},removePoint:function(a){var b=new md(this._points);this._points.remove(a),this.firePointsChange(b,this._points)},removeAt:function(a){var b=new md(this._points);this._points.removeAt(a),this.firePointsChange(b,this._points)},setWidth:function(a){if(1>a&&(a=1),!this._isUpdatingShapeNode&&!Hb.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=new md(this._points),c=0;c<this._points.size();c++){var d=this._points.get(c);d.x=(d.x-this.getX())*a/this.getWidth()+this.getX()}this.firePointsChange(b,this._points),this._isUpdatingShapeNode=!1}Gb.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(a){if(1>a&&(a=1),!this._isUpdatingShapeNode&&!Hb.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=new md(this._points),c=0;c<this._points.size();c++){var d=this._points.get(c);d.y=(d.y-this.getY())*a/this.getHeight()+this.getY()}this.firePointsChange(b,this._points),this._isUpdatingShapeNode=!1}Gb.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!Hb.isDeserializing){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Hb.num(a.x)||!Hb.num(a.y))return;var b=a.x-this.getX(),c=a.y-this.getY();if(0===b&&0===c)return;this._isUpdatingShapeNode=!0;for(var d=new md(this._points),e=0;e<this._points.size();e++){var f=this._points.get(e);f.x+=b,f.y+=c}this.firePointsChange(d,this._points),this._isUpdatingShapeNode=!1}Gb.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(a,b){if(!this._isUpdatingShapeNode&&!Hb.isDeserializing){var c=Rb.getRect(b);c?(this._isUpdatingShapeNode=!0,Dd.CENTER_LOCATION?this.setLocation(c.x+c.width/2,c.y+c.height/2):this.setLocation(c.x,c.y),this.setWidth(c.width),this.setHeight(c.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",a,b)},_reCalculateLineLength:function(){this._lineLength=null!=this._points&&this._points.size()>0?Rb.calculateLineLength(this._points,this._segments):0},getLineLength:function(){return this._lineLength}}),Gb.Bus=function(a){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,Gb.Bus.superClass.constructor.call(this,a)},Hb.ext("twaver.Bus",Gb.ShapeNode,{_icon:Dd.ICON_BUS,firePointsChange:function(a,b){var c=b.size();if(!Hb.isDeserializing&&c>=2)for(var d=b.get(0),e=1;c>e;e++){var f=b.get(e);Math.abs(f.x-d.x)>Math.abs(f.y-d.y)?f.y=d.y:f.x=d.x,d=f}Gb.Bus.superClass.firePointsChange.apply(this,arguments)}}),Gb.ShapeLink=function(a,b,c){this._points=new md,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,Gb.ShapeLink.superClass.constructor.call(this,a,b,c)},Hb.ext("twaver.ShapeLink",Gb.Link,{_icon:Dd.ICON_SHAPELINK,getElementUIClass:function(){return Gb.network.ShapeLinkUI},getCanvasUIClass:function(){return Gb.canvas.ShapeLinkUI},getVectorUIClass:function(){return Gb.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new md);var b=new md(this._points);this._points=a,this.firePointsChange(b,this._points)},addPoint:function(a,b){var c=new md(this._points);this._points.add(a,b),this.firePointsChange(c,this._points)},setPoint:function(a,b){var c=new md(this._points);this._points.set(a,b),this.firePointsChange(c,this._points)},removePoint:function(a){var b=new md(this._points);this._points.remove(a),this.firePointsChange(b,this._points)},removeAt:function(a){var b=new md(this._points);this._points.removeAt(a),this.firePointsChange(b,this._points)},firePointsChange:function(a,b){this.firePropertyChange("points",a,b)}}),Gb.ShapeSubNetwork=function(a){Gb.ShapeSubNetwork.superClass.constructor.call(this,a)},Hb.ext("twaver.ShapeSubNetwork",Gb.ShapeNode,{ISubNetwork:!0,_icon:Dd.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){Gb.ShapeSubNetwork.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Ld&&c._checkLinkAgent()}}}),Gb.LinkSubNetwork=function(){Gb.LinkSubNetwork.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.LinkSubNetwork",Gb.Link,{ISubNetwork:!0,_icon:Dd.ICON_LINKSUBNETWORK}),Gb.ShapeLinkSubNetwork=function(){Gb.ShapeLinkSubNetwork.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.ShapeLinkSubNetwork",Gb.ShapeLink,{ISubNetwork:!0,_icon:Dd.ICON_LINKSUBNETWORK}),Gb.RotatableNode=function(a){Gb.RotatableNode.superClass.constructor.call(this,a)},Hb.ext("twaver.RotatableNode",Gb.Follower,{getWidth:function(){return 0==this._angle?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(a){},getHeight:function(){return 0==this._angle?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(a){},getElementUIClass:function(){return Gb.network.RotatableNodeUI},getCanvasUIClass:function(){return Gb.canvas.RotatableNodeUI},getVectorUIClass:function(){return Gb.vector.RotatableNodeUI},_getRotateRect:function(){for(var a=this._getOrignalWidth(),b=this._getOrignalHeight(),c=Rb.createMatrix(this._angle*Math.PI/180,a/2,b/2),d=[{x:0,y:0},{x:a,y:0},{x:a,y:b},{x:0,y:b}],e=0,f=d.length;f>e;e++)d[e]=c.transform(d[e]);return Rb.getRect(d)},_getOrignalWidth:function(){return Gb.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return Gb.RotatableNode.superClass.getHeight.call(this)}}),Gb.controls.ControlBase=function(){Gb.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new md},Hb.ext("twaver.controls.ControlBase",Gb.PropertyChangeDispatcher,{_autoAdjustBounds:!1,addPool:function(a){this._pools.contains(a)||this._pools.add(a)},removePool:function(a){this._pools.remove(a)},adjustBounds:function(a){var b=this._view.style;b.position="absolute",b.left=a.x+"px",b.top=a.y+"px",b.width=a.width+"px",b.height=a.height+"px",this._autoAdjustBounds===!0&&(b.left="0px",b.top="0px",b.right="0px",b.bottom="0px"),this.invalidate&&this.invalidate()},setAutoAdjustBounds:function(a){a===!0?Ub.addEventListener("resize","_handleResize",window,this):Ub.removeEventListener("resize",window,this),this._autoAdjustBounds=a},isAutoAdjustBounds:function(){return this._autoAdjustBounds},_handleResize:function(a){this.adjustBounds({x:0,y:0,width:Mb.documentElement.clientWidth,height:Mb.documentElement.clientHeight})},getView:function(){return this._view},invalidate:function(a){this._invalidate||(this._invalidate=!0,Hb.callLater(this.validate,this,null,a))},validate:function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(void 0===this._reinvalidateCount&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl())},validateImpl:function(){}}),Gb.controls.ViewBase=function(){Gb.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new Gb.EventDispatcher,this._viewDispatcher=new Gb.EventDispatcher},Hb.ext("twaver.controls.ViewBase",Gb.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:Dd.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return null==this._selectionModel},setShareSelectionModel:function(a){var b=null==this._selectionModel;b!==a&&(a?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new Gb.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",b,a))},onShareSelectionModelChanged:function(){},removeSelection:function(){if(0===this.getSelectionModel().size())return null;var a=this.getSelectionModel().toSelection();return this._box._undoManager._enabled&&this._box._undoManager.startBatch(),a.forEach(function(a){this._box.remove(a)},this),this._box._undoManager._enabled&&this._box._undoManager.endBatch(),a},selectAll:function(){var a=new md;return this._box.forEach(function(b){this.isVisible(b)&&a.add(b)},this),this.getSelectionModel().setSelection(a),a},isSelected:function(a){return this.getSelectionModel().contains(a)},isSelectable:function(a){return this.getSelectionModel().isSelectable(a)},getLabel:function(a){return a.getName()},getToolTip:function(a){return a.getToolTip()},getIcon:function(a){return a.getIcon()},getSelectColor:function(a){return Dd.SELECT_COLOR},addViewListener:function(a,b,c){this._viewDispatcher.add(a,b,c)},removeViewListener:function(a,b){this._viewDispatcher.remove(a,b)},fireViewEvent:function(a){this._viewDispatcher.fire(a)},addInteractionListener:function(a,b,c){this._interactionDispatcher.add(a,b,c)},removeInteractionListener:function(a,b){this._interactionDispatcher.remove(a,b)},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},invalidate:function(a){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),Hb.callLater(this.validate,this,null,a))},validate:function(){this._invalidate&&(this._invalidate=!1,Kb||0!==this._view.offsetWidth||0!==this._view.offsetHeight||null===this._reinvalidateCount?(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating):(void 0===this._reinvalidateCount&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()))}}),Gb.controls.View=function(){Gb.controls.View.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.View",Gb.controls.ViewBase,{_zoom:1,_maxZoom:Dd.ZOOM_MAX,_minZoom:Dd.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(a){return Ub.isValidEvent(this._view,a)},getAlarmFillColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b)return b.color}return null},getInnerColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:a.getStyle("inner.color")}return null},getOuterColor:function(a){if(a.IElement){var b=a.getAlarmState().getPropagateSeverity();return b?b.color:a.getStyle("outer.color")}return null},zoomOverview:function(a){var b=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(b,a)},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(a,b,c){c&&Gb.animate.AnimateManager.endAnimate();var d=this._view.scrollWidth-this._view.clientWidth,e=this._view.scrollHeight-this._view.clientHeight,f=(a-this._view.clientWidth/this._zoom/2)*this._zoom,g=(b-this._view.clientHeight/this._zoom/2)*this._zoom;0>f&&(f=0),0>g&&(g=0),f>d&&(f=d),g>e&&(g=e),c?Gb.animate.AnimateManager.start(new Gb.animate.AnimateScrollPosition(this._view,f,g)):(this._view.scrollLeft=f,this._view.scrollTop=g)},panByOffset:function(a,b){a*=this.getZoom(),b*=this.getZoom();var c=this._view.scrollLeft+a,d=this._view.scrollTop+b,e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight;0>c&&(c=0),c>e&&(c=e),0>d&&(d=0),d>f&&(d=f);var g={x:(c-this._view.scrollLeft)/this.getZoom(),y:(d-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=c,this._view.scrollTop=d,g},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(!(0>a)){var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getZoom()>a&&this.setZoom(a)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(!(0>a)){var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getZoom()<a&&this.setZoom(a,!1)}},getZoom:function(){return this._zoom},onZoomChanged:function(a,b){},zoomIn:function(a){this.setZoom(this._zoom*Dd.ZOOM_INCREMENT,a)},zoomOut:function(a){this.setZoom(this._zoom/Dd.ZOOM_INCREMENT,a)},zoomReset:function(a){this.setZoom(1,a)},checkZoom:function(a){return a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a},setZoom:function(a,b){if(Hb.num(a)&&!(0>=a)&&(a=this.checkZoom(a),a!==this._zoom))if(null==b&&(b=Dd.ZOOM_ANIMATE),b)Gb.animate.AnimateManager.start(new Gb.animate.AnimateZoom(this,a));else{var c=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,d=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,e=this._zoom;this._zoom=a,Ub.setZoom(this._rootDiv,a),this.firePropertyChange("zoom",e,a),this.onZoomChanged(e,a),this.centerByLogicalPoint(c,d,!1)}},setTouchZoom:function(a){this.setZoom(a,!1)}}),function(){var a=function(a,b,c,d){var e=new Nb;e.src=d,Gb.Util.registerImage(a,e,b,c)};a("subnetwork_image",64,46,"data:image/png;base64,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"),a("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),a("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),a("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),a("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),a("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),a("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),a("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),a("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),a("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),a("node_image",30,32,"data:image/png;base64,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"),
a("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),a("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),a("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),a("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),a=function(a,b,c,d){Gb.Util.registerImage(a,d,b,c)},a("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),a("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),a("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),a("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),a("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),a("submenu_enable_icon",8,8,"data:image/png;base64,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"),a("submenu_disable_icon",8,8,"data:image/png;base64,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"),a("checkbox_selected_icon",16,16,"data:image/png;base64,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"),a("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),a("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),a("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg=="),a("right_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjJGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjNGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE5MUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE5MkZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqPQWR4AAABJSURBVHjaYvT08vrPwMAgCsQM27ZufcMABUxQ+jWI8PL2FkGXwJBElkCRRJeAS2KTAEvikhDFJiGKzSi4f5iwCSLrwPA5QIABAAmgFhOOHdKvAAAAAElFTkSuQmCC"),a("left_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjZGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjdGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3RkFFMUVCNEZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3RkFFMUVCNUZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmpWGHAAAABISURBVHjaYvz//z8DDHh5e4tAma+ZsAmCCCZsgiDAfOr0aQxBuA50QZgEhiBMQhSXBAM2SaZtW7e+wSYJ1oFNEu5BdEmAAAMAvV8Xc/cw3YgAAAAASUVORK5CYII="),a("up_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEZGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOTBGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE4REZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE4RUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnCNygcAAABGSURBVHjaYvz//z8DDHh5e4tAma+BWBTE2LZ16xuYPBMOhXAaSRyiGItCBmwaGD29vHApRAaiyM7ApxAuz0SEQrgGgAADALOxFSETkKKwAAAAAElFTkSuQmCC"),a("down_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOENGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEJGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPgXX8AAAA7SURBVHjaYvH08vrPQCRgAmJRItWKMsEYhBSCTd62desbAhrA4iB1TDAGDg2iyPIwZ2DTIIomzgAQYAAmahUFv1Iq6AAAAABJRU5ErkJggg==")}(),Pb.__tree=function(a,b){a._rootVisible=!0,a._initTree=function(a){this._rootData=null,this._expandMap={},this._levelMap={}},a.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},a._buildData=function(a){this._dataRowMap[a.getId()]=this._rowDatas.size(),this._rowDatas.add(a),this._levelMap[a.getId()]=this._currentLevel,this.isExpanded(a)&&(this._currentLevel++,this._buildChildren(a),this._currentLevel--)},a._buildChildren=function(a){var b=a?a.getChildren():this._box.getRoots(),c=this.getCurrentSortFunction();c&&this.isChildrenSortable(a)?b.toList(this.isVisible,this).sort(c).forEach(function(a){this._buildData(a)},this):b.forEach(function(a){this.isVisible(a)&&this._buildData(a)},this)},a.getLevel=function(a){return this._levelMap[a.getId()]},a.getToggleImage=function(a){return a.getChildrenSize()>0?this.isExpanded(a)?this._expandIcon:this._collapseIcon:null},a.isCheckable=function(a){return this.isCheckMode()},a.isCheckMode=function(){return 1===Pb.__tree._checkMap[this._checkMode]},a.isChildrenSortable=function(a){return!0},a.handleDataBoxChange=function(a){"remove"===a.kind?delete this._expandMap[a.data.getId()]:"clear"===a.kind&&(this._expandMap={}),this.invalidateModel()},a.isExpanded=function(a){return 1===this._expandMap[a.getId()]},a.expand=function(a){if(!this.isExpanded(a)){for(var b=a.getParent();null!=b&&b!==this._rootData;)this._expandMap[b.getId()]=1,b=b.getParent();this._expandMap[a.getId()]=1,this.invalidateModel()}},a.collapse=function(a){this.isExpanded(a)&&(delete this._expandMap[a.getId()],this.invalidateModel())},a.expandAll=function(){this._box.forEach(function(a){this._expandMap[a.getId()]=1},this),this.invalidateModel()},a.collapseAll=function(){this._expandMap={},this.invalidateModel()},a._handleClick=function(a){if(this.isFocusOnClick()&&Gb.Util.setFocus(this._view),!this._isValidating){var b;if(a.target._expandData&&!a.target.ableExpand)b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b}));else if(a.target._selectData||a.target.parentNode._selectData){if(this._handlePressSelection(a.target._selectData||a.target.parentNode._selectData,a),this.isCheckMode()){var c=this.getRowIndexAt(a);c>=0&&this.__handleClick(a)}}else this._treeColumn?(b=this.getDataAt(a),b&&(this.isCheckMode()?a.target._checkData||this.__handleClick(a):this._handlePressSelection(b,a))):this.isCheckMode()&&!a.target._checkData&&this.__handleClick(a);if(this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor){var d=this;setTimeout(function(){d.updateCurrentEditor(a)},0)}}},a.__handleClick=function(a){var b=this.getDataAt(a);if(b){var c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}}},a._handleDoubleClick=function(a){if(this.isFocusOnClick()&&Gb.Util.setFocus(this._view),!this._isValidating){var b;a.target.ableExpand&&a.target._expandData&&(b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b})))}},a.handleChange=function(a){if(!(this._isCommitting||this._isCanceling||this._isValidating)){var b=a.target._checkData;if(b){var c,d=this.isSelected(b),e=this.getSelectionModel();if("default"===this._checkMode)d?e.removeSelection(b):e.appendSelection(b);else if("children"===this._checkMode)c=new md(b),c.addAll(b.getChildren());else if("descendant"===this._checkMode)c=new md,Hb.fillDescendant(b,c);else if("descendantAncestor"===this._checkMode&&(c=new md,Hb.fillDescendant(b,c),!d))for(var f=b.getParent();f;)c.add(f),f=f.getParent();d?e.removeSelection(c):e.appendSelection(c)}a.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(a.target._editInfo,a.target))}},a.onLabelRendered=function(a,b,c,d,e,f){},a.onToggleImageRendered=function(a){},a._renderTree=function(a,b,c,d){var e=this._levelMap[b.getId()],f=this.getToggleImage(b),g=this.getLineType(),h=this._indent,i=this.__spanPool.get();i.style.display="inline-block",i.style.position="relative",i.style.verticalAlign="top",i.style.margin="0px 1px 0px 1px",i.style.width=(e+1)*h+"px",a.appendChild(i);var j=b,k=j.getParent(),l=0;if("dotted"===g||"solid"===g){if(null==k){var m=this.getIcon(b);this._addLine(i,b,m,!0)}for(;null!==k;){var n=k.getChildren(),o=j===n.get(n.size()-1),m=this.getIcon(j);j.setClient("isLast",o),0==l&&this._addLine(i,b,m,o),l++,j=k,k=k.getParent()}}if(f){var p=this.__imagePool.get();p.setAttribute("src",Hb.getImageSrc(f)),p.style.verticalAlign="middle",p._expandData=b,p.style.position="absolute",p.style.right="0px";var q=this;p.onload=function(){p.style.top=q.getRowHeight()/2-p.height/2+"px"},i.appendChild(p),this.onToggleImageRendered(p)}var r=this.isCheckable(b),s="disabled"===this.getUncheckableStyle();if(r||s){var t=this._addCheckBox(a,b,d);t.disabled=!r}var m=this.getIcon(b);if(m){var u=this.isCheckMode()||this._treeColumn?null:b;this._addIcon(a,b,m,u)}var v=this.getLabel(b);v&&(i=this.__textPool.get(),i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",Hb.setText(i,v,this._treeColumn?this._treeColumn.isInnerText():this._innerText),f&&(i._expandData=b,i.ableExpand=!0),this.isCheckMode()||this._treeColumn?this._focusedRow===c&&(i.style.backgroundColor=this.getSelectColor(b)):(i._selectData=b,i.style.backgroundColor=d?this.getSelectColor(b):""),this.onLabelRendered(i,b,v,c,e,d),a.appendChild(i),a.title=this.getToolTip(b))}},Pb.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},Gb.Column=function(a){Gb.Column.superClass.constructor.call(this,a)},Hb.ext("twaver.Column",Gb.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:Dd.COLUMN_INNER_TEXT,_width:Dd.COLUMN_WIDTH,_horizontalAlign:Dd.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Dd.COLUMN_PROPERTY_TYPE,_valueType:Dd.COLUMN_VALUE_TYPE,_editable:Dd.COLUMN_EDITABLE,_sortable:Dd.COLUMN_SORTABLE,_visible:Dd.COLUMN_VISIBLE,_resizable:Dd.COLUMN_RESIZABLE,_movable:Dd.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:Dd.SORT_FUNCTION,_enumInfo:null,renderCell:Dd.COLUMN_RENDER_CELL,renderHeader:Dd.COLUMN_RENDER_HEADER,renderEditor:Dd.COLUMN_RENDER_EDITOR,setParent:function(a){throw"parent not supported"},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0;
}}),Gb.ColumnBox=function(a){Gb.ColumnBox.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.ColumnBox",Gb.DataBox,{_name:"ColumnBox",add:function(a,b){if(!a.IColumn)throw"Only IColumn can be added into ColumnBox";Gb.ColumnBox.superClass.add.apply(this,arguments)}}),Gb.Property=function(a){Gb.Property.superClass.constructor.call(this,a)},Hb.ext("twaver.Property",Gb.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:Dd.PROPERTY_INNER_TEXT,_horizontalAlign:Dd.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Dd.PROPERTY_PROPERTY_TYPE,_valueType:Dd.PROPERTY_VALUE_TYPE,_editable:Dd.PROPERTY_EDITABLE,_categoryName:Dd.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:Dd.PROPERTY_RENDER_NAME,renderValue:Dd.PROPERTY_RENDER_VALUE,isVisible:null,renderEditor:Dd.PROPERTY_RENDER_EDITOR,setParent:function(a){throw"parent not supported"},setPropertyName:function(a){var b=this._propertyName;this._propertyName=a,this.firePropertyChange("propertyName",b,a)},setPropertyType:function(a){var b=this._propertyType;this._propertyType=a,this.firePropertyChange("propertyType",b,a)},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0}}),Gb.PropertyBox=function(a){Gb.PropertyBox.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.PropertyBox",Gb.DataBox,{_name:"PropertyBox",add:function(a,b){if(!a.IProperty)throw"Only IProperty can be added into PropertyBox";Gb.PropertyBox.superClass.add.apply(this,arguments)}}),Gb.Tab=function(a){Gb.Tab.superClass.constructor.call(this,a)},Hb.ext("twaver.Tab",Gb.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:Dd.TAB_WIDTH,_closable:Dd.TAB_CLOSABLE,_resizable:Dd.TAB_RESIZABLE,_movable:Dd.TAB_MOVABLE,_disabled:Dd.TAB_DISABLED,_visible:Dd.TAB_VISIBLE,setParent:function(a){throw"parent not supported"}}),Gb.TabBox=function(a){Gb.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},Hb.ext("twaver.TabBox",Gb.DataBox,{_name:"TabBox",add:function(a,b){if(!a.ITab)throw"Only ITab can be added into TabBox";Gb.TabBox.superClass.add.apply(this,arguments)}}),Gb.controls.ListBase=function(a){Gb.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new md,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new Gb.Pool("div",20),this.__imagePool=new Gb.Pool("img",20),this.__canvasPool=new Gb.Pool("canvas",20),this.__spanPool=new Gb.Pool("span",20),this.__textPool=new Gb.Pool("span",20),this.__checkBoxPool=new Gb.Pool("input",20),this.__linePool=new Gb.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=Ub.createView("auto",!0),this._rootDiv=Ub.createDiv(),this._dataDiv=Ub.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new Gb.DataBox);var b=this;b.handleChange&&b._view.addEventListener("change",function(a){b.handleChange(a)},!1),Ob.isTouchable?Ob.isMSTouchable?new Gb.controls.ListBaseMSTouchInteraction(this):(new Gb.controls.ListBaseTouchInteraction(this),new Gb.controls.ListBaseInteraction(this)):new Gb.controls.ListBaseInteraction(this)},Hb.ext("twaver.controls.ListBase",Gb.controls.View,{__bool:["innerText"],_innerText:Dd.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(a){return this._dataRowMap[a.getId()]},getRowIndexById:function(a){return this._dataRowMap[a]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)}},onPropertyChanged:function(a){"zoom"===a.property?this.invalidate():this.invalidateModel()},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateData:function(a){this._invalidateDisplay||(this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[a.getId()]=a,this.invalidate())},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},Ub.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var c;if(this._invalidateDatas){for(c in this._invalidateDatas){var d=this._renderMap[c];d&&(Ub.release(d),this._dataDiv.removeChild(d),delete this._renderMap[c])}this._invalidateDatas=null}var e=this._view.scrollTop/this._zoom,f=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(e/this._rowHeight)-2,this._endRowIndex=Math.ceil((e+f)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());for(var g=this._rowHeight-this._rowLineWidth-2+"px",h=this._rowLineWidth+"px",i=this._startRowIndex;i<this._endRowIndex;i++){var j=this._rowDatas.get(i);c=j.getId();var k=this._renderMap[c];if(!k){k=this.__divPool.get();var l=k.style;l.position="absolute",l.whiteSpace="nowrap",l.lineHeight=g,l.top=i*this._rowHeight+"px",l.borderStyle="solid",l.borderWidth="0px",l.borderBottomWidth=h,l.borderBottomColor=this._rowLineColor,l.opacity=j.getStyle?j.getStyle("whole.alpha"):1,this._dataDiv.appendChild(k),this._renderMap[c]=k;var m=this.isSelected(j);this.renderData(k,j,i,m),this.onDataRendered(k,j,i,m)}}this._dataDiv.style.width=this.calculateSumWidth()+"px","0px"===this._dataDiv.style.height&&(this._dataDiv.style.height="1px"),Hb.keys(this._renderMap).forEach(function(a){var b=this.getRowIndexById(a);if(b<this._startRowIndex||b>=this._endRowIndex){var c=this._renderMap[a];Ub.release(c),this._dataDiv.removeChild(c),delete this._renderMap[a]}},this),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var a,b,c=this._rowHeight-this._rowLineWidth+"px",d=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(a in this._renderMap)b=this._renderMap[a],b.style.height=c,b.style.width=d},onValidated:function(){},onDataRendered:function(a,b,c,d){},calculateSumWidth:function(){return 0},_addCheckBox:function(a,b,c){var d=this.__checkBoxPool.get();return d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d._checkData=b,d.checked=c,d.disabled=!1,a.appendChild(d),d},_addIcon:function(a,b,c,d){var e,f=Hb.getImageAsset(c),g=this.getInnerColor(b),h=this.getOuterColor(b),i=this.getAlarmFillColor(b);if(f&&f.getImage()){var j=f.getWidth(),k=f.getHeight();e=this.__canvasPool.get(),e.style.verticalAlign="middle",e.setAttribute("width",j),e.setAttribute("height",k);var l=e.getContext("2d");l.clearRect(0,0,j,k);var m={x:0,y:0,width:j,height:k};Mc(l,c,g,m,b,this),h&&(l.lineWidth=2,l.strokeStyle=h,l.beginPath(),l.rect(0,0,j,k),l.closePath(),l.stroke()),i&&(l.fillStyle=Vb.createRadialGradient(l,i,"white",1,k-9,8,8,.75,.25),l.beginPath(),l.arc(5,k-5,4,0,2*Math.PI,!0),l.closePath(),l.fill())}else e=this.__imagePool.get(),e.style.verticalAlign="middle",e.setAttribute("src",Hb.getImageSrc(c));e.style.margin="0px 1px 0px 1px",e._selectData=d,a.appendChild(e)},_addLine:function(a,b,c,d){var e,f,g=this.__linePool.get(),h=Hb.getImageAsset(c),i=this.getToggleImage(b),j=this._levelMap[b.getId()],k=this._indent,l=k,m=k,n=0;this.isCheckable(b),"disabled"===this.getUncheckableStyle(),n=2,h&&(l=h.getWidth(),m=h.getHeight()),e=(j+n-1)*k+l,f=this.getRowHeight(),a.style.width=(j+n-1)*k+l+"px",a.style.height=f+m+"px";var o=this.getLineType(),p=this.getLineColor(),q=this.getLineAlpha(),r=this.getLineThickness(),s=this.getLineDash();Hb.getImageSrc(i),g.style.verticalAlign="top",g.style.margin="0px 0px 0px 0px",g.style.zIndex=-1,g.setAttribute("width",e),g.setAttribute("height",f);var t=g.getContext("2d");t.lineWidth=r,t.strokeStyle=p,t.globalAlpha=q,"dotted"===o&&t.setLineDash(s);var u=2*(j+n);if(d){var v=b,w=v.getParent();t.clearRect(0,0,e,f),null===w&&0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((j+n+1)*e/u,f/2+m/2),t.lineTo((j+n+1)*e/u,f),t.stroke());for(var x=2*j-1;x>=1;x-=2){if(v.getClient("isLast")){if(v=w,w=v.getParent(),(x+1)/2!=j)continue}else v=w,w=v.getParent();x==2*j-1?(t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f/2),t.stroke(),t.moveTo((x+n)*e/u,f/2),t.lineTo((x+n+1)*e/u,f/2),t.stroke(),0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((x+n+2)*e/u,f/2+m/2),t.lineTo((x+n+2)*e/u,f),t.stroke())):(t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f),t.stroke())}}else{var v=b,w=v.getParent();t.clearRect(0,0,e,f);for(var x=2*j-1;x>=1;x-=2){if(v.getClient("isLast")){if(v=w,w=v.getParent(),(x+1)/2!=j)continue}else v=w,w=v.getParent();t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f),t.stroke(),x==2*j-1&&(t.moveTo((x+n)*e/u,f/2),t.lineTo((x+n+1)*e/u,f/2),t.stroke(),0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((x+n+2)*e/u,f/2+m/2),t.lineTo((x+n+2)*e/u,f),t.stroke()))}}return a.appendChild(g),g},isVisible:function(a){return this._box.contains(a)?this._visibleFunction?this._visibleFunction(a):!0:!1},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){"parent"===a.property?this.invalidateModel():this.invalidateData(a.source)},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){a.datas.forEach(function(a){this.invalidateData(a)},this),this.onSelectionChanged(a)},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowDatas.size()?c:-1},getDataAt:function(a){var b=this.getRowIndexAt(a);return b>=0?this._rowDatas.get(b):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var a=this.getCurrentSortFunction();a&&this._rowDatas.sort(a);for(var b=this._rowDatas.size(),c=0;b>c;c++)this._dataRowMap[this._rowDatas.get(c).getId()]=c},_buildChildren:function(a){a.forEach(function(a){this._rowDatas.add(a),this._buildChildren(a.getChildren())},this)},_handlePressSelection:function(a,b){var c=this.getSelectionModel();if(Hb.isCtrlDown(b))c.contains(a)?c.removeSelection(a):c.appendSelection(a);else if(b.shiftKey&&c.getLastData()){var d=c.getLastData(),e=this.getRowIndexByData(d),f=this.getRowIndexByData(a),g=new md;for(g.add(this.getRowDatas().get(e));e!==f;)e+=f>e?1:-1,g.add(this.getRowDatas().get(e));c.setSelection(g)}else 1===c.size()&&c.contains(a)||c.setSelection(a);this.fireInteractionEvent({kind:2===b.detail?"doubleClick":"click",data:a})},_handleDoubleClick:function(a){var b=this.getDataAt(a);this.fireInteractionEvent({kind:2===a.detail?"doubleClick":"click",data:b})},_handleClick:function(a){this.isFocusOnClick()&&Gb.Util.setFocus(this._view);var b=this.getDataAt(a);if(b){if(this.isCheckMode()&&!a.target._checkData){var c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}}this.isCheckMode()||this._handlePressSelection(b,a)}if(this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor){var e=this;setTimeout(function(){e.updateCurrentEditor(a)},0)}},handleChange:function(a){if(!this._isCanceling&&!this._isValidating){var b=a.target._checkData;if(b){var c=this.isSelected(b),d=this.getSelectionModel();c?d.removeSelection(b):d.appendSelection(b)}a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)}},scrollToData:function(a){if(a){var b=this.getRowIndexById(a.getId());if(!(0>b)){var c=b*this._rowHeight*this._zoom,d=c+this._rowHeight*this._zoom,e=this._view.scrollTop;this._view.scrollTop>c&&(e=c),this._view.scrollTop+this._view.clientHeight<d&&(e=d-this._view.clientHeight),this._view.scrollTop!=e&&(this._view.scrollTop=e,this.invalidate())}}},makeVisible:function(a){this.isVisible(a)&&(this.expand&&this.expand(a),Hb.callLater(this.scrollToData,this,[a],2*Dd.CALL_LATER_DELAY))},onSelectionChanged:function(a){this._makeVisibleOnSelected&&("append"===a.kind||"set"===a.kind||"all"===a.kind)&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(a){a.getParent()&&this.expand(a.getParent())},this),Hb.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],2*Dd.CALL_LATER_DELAY))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),Gb.controls.TableBase=function(a){this._columnBox=new Gb.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),Gb.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new Gb.Pool("div",20),this._stringPool=new Gb.Pool("span",20),this._booleanPool=new Gb.Pool("input",20),this._colorPool=new Gb.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},Hb.ext("twaver.controls.TableBase",Gb.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){a.source!==this._sortColumn||"sortDirection"!==a.property&&"sortFunction"!==a.property&&"sortable"!==a.property?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},renderData:function(a,b,c,d){for(var e,f=this._columnBox.getRoots(),g=f.size(),h=0,i=this._rowHeight-this._rowLineWidth+"px",j=0;g>j;j++){var k=f.get(j),l=k.getWidth();0>l&&(l=0);var m=Math.min(this._columnLineWidth,l);if(k.isVisible()){var n=this._cellPool.get();e=n.style,e.position="absolute",e.whiteSpace="nowrap",e.verticalAlign="middle",e.textAlign=k.getHorizontalAlign(),e.overflow="hidden",e.textOverflow="ellipsis",e.left=h+"px",e.width=l-m+"px",e.height=i,e.borderStyle="solid",e.borderWidth="0px",e.borderRightWidth=m+"px",e.borderRightColor=this._columnLineColor,0===j?(e.borderLeftWidth=m+"px",e.borderLeftColor=this._columnLineColor):e.borderLeftWidth="0px",a.appendChild(n);var o={data:b,value:this.getValue(b,k),div:n,view:this,column:k,rowIndex:c,selected:d};this.renderCell(o),this.onCellRendered(o),h+=l}}e=a.style,e.width=h+"px",e.height=i,e.backgroundColor=this.isCheckMode()&&this._focusedRow===c||!this.isCheckMode()&&d?this.getSelectColor(b):""},adjustRowSize:function(){},onCellRendered:function(a){},calculateSumWidth:function(){for(var a=this._columnBox.getRoots(),b=a.size(),c=0,d=0;b>d;d++){var e=a.get(d),f=e.getWidth();0>f&&(f=0),c+=f}return c},getCurrentSortFunction:function(){var a=this._sortColumn;if(a){var b=a.getSortFunction();if(b){var c=this,d="asc"===a.getSortDirection()?1:-1;return function(e,f){var g=c.getValue(e,a),h=c.getValue(f,a);return b.call(c,g,h,e,f)*d}}}return this._sortFunction},renderCell:function(a){var b=a.column;if(b.renderCell)return void b.renderCell(a);var c=a.value,d=b.getEnumInfo(a.rowIndex);d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.div._editInfo=a),zc.render(b.getValueType(),c,a.div,a.view,b.isInnerText())},getValue:function(a,b){return b.getValue(a,this)},setValue:function(a,b,c){b.setValue(a,c,this)},getColumnAt:function(a){var b=this.getLogicalPoint(a);if(!b)return null;for(var c=this._columnBox.getRoots(),d=0,e=c.size(),f=0;e>d;d++){var g=c.get(d),h=g.getWidth();if(0>h&&(h=0),b.x>f&&b.x<f+h)return g;f+=h}return null},isCellEditable:function(a,b){return this.isEditable()&&b.isEditable()},commitEditValue:function(a,b){if(!this._isCanceling){var c;c="checkbox"===b.type?b.checked:b.value;var d=a.column,e=d.getValueType();if("int"===e&&"string"==typeof c)c=parseInt(c);else if("number"===e&&"string"==typeof c)c=parseFloat(c);else if("list.points"===e){for(var f=c.replace(/\]/g,"").replace(/\[/g,"").split(","),g=new Gb.List,h=0;h<f.length;h+=2)h+1>=f.length||g.add({x:parseInt(f[h]),y:parseInt(f[h+1])});c=g}if(this.setValue(a.data,d,c),this._currentEditor){var i=this._currentEditor.parentNode,j=this._currentEditor;delete this._currentEditor,i&&i.removeChild(j),Gb.Util.setFocus(this._view)}delete this._isCommitting}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var a=this._currentEditor.parentNode,b=this._currentEditor;delete this._currentEditor,a&&a.removeChild(b),Gb.Util.setFocus(this._view),delete this._isCanceling}},renderEditor:function(a){},onEditorRendered:function(a){},getEditorValue:function(a){var b=a.column.getValueType(),c=a.value,d="";if("list.points"===b){var e=c._as?c._as:c;e.forEach(function(a,b){d+=b==e.length-1?"["+a.x+","+a.y+"]":"["+a.x+","+a.y+"],"})}else d=c;return d},updateCurrentEditor:function(a){var b=a.target;if(b!==this._currentEditor&&b.parentNode!==this._currentEditor){for(var c;b&&b!==this._view&&!(c=b._editInfo);)b=b.parentNode;if(c&&b===c.div){var d=this.renderEditor&&this.renderEditor(c);d?(this._currentEditor=d.view,null!=c.value&&(this._currentEditor.value=this.getEditorValue(c))):c.enumInfo?this._currentEditor=Ub.createSelect(c.enumInfo,c.value):(this._currentEditor=Mb.createElement("input"),null!=c.value&&(this._currentEditor.value=this.getEditorValue(c)));var e=this;if(c.column&&c.column.renderEditor){var d="function"==typeof c.column.renderEditor?c.column.renderEditor(e,c):c.column.renderEditor;d&&(e._currentEditor=d)}if(this._currentEditor){if(d&&d.onKeyDown){var f=d.onKeyDown;f&&Array.isArray(f)&&e._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<f.length;b++)if(f[b].combKey){var c=null;switch(f[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===f[b].keyCode&&c&&f[b].handlerEvent&&f[b].handlerEvent(a)}else a.keyCode===f[b].keyCode&&f[b].handlerEvent&&f[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;13===a.keyCode&&a.shiftKey||(13===a.keyCode?b.commitEditValue(a.target._editInfo,a.target):27===a.keyCode&&b.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;b._isCanceling||b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=c,!this._currentEditor.parentNode){var g=this._currentEditor.style;g.position="absolute",g.margin="0px",g.border="0px",g.padding="0px",g.left=c.div.style.left,g.top=c.div.parentNode.style.top,g.width=c.div.style.width,g.height=c.div.style.height,this._rootDiv.appendChild(this._currentEditor)}Gb.Util.setFocus(this._currentEditor)}}}},onColumnSorted:function(a){},getCurrentEditor:function(){return this._currentEditor}}),Gb.controls.List=function(a){Gb.controls.List.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.List",Gb.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:Dd.LIST_ROW_HEIGHT,_indent:Dd.LIST_INDENT,_rowLineWidth:Dd.LIST_ROW_LINE_WIDTH,_rowLineColor:Dd.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:Dd.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},isCheckable:function(a){return this._checkMode===!0},renderData:function(a,b,c,d){var e;this._indent>0&&(e=this.__spanPool.get(),e.style.width=this._indent+"px",e.style.display="inline-block",a.appendChild(e));var f=this.isCheckable(b);f&&this._addCheckBox(a,b,d);var g=this.getIcon(b);g&&this._addIcon(a,b,g);var h=this.getLabel(b);if(h){e=this.__textPool.get();var i=e.style;i.whiteSpace="nowrap",i.verticalAlign="middle",i.padding="1px 2px 1px 2px",i.display="inline-block",Hb.setText(e,h,this._innerText),this.onLabelRendered(e,b,h,c,d),a.appendChild(e)}a.style.backgroundColor=this.isCheckMode()?this._focusedRow===c?this.getSelectColor(b):"":d?this.getSelectColor(b):""},onLabelRendered:function(a,b,c,d,e){}}),Gb.controls.ListBaseInteraction=function(a){this.listBase=a,this.view=a._view,this.clickTimer=0,this.doubleClickInterval=300;var b=this;this.view.addEventListener("scroll",function(a){b.handleScroll(a)},!1),this.view.addEventListener("mouseup",function(a){b.handleMouseUp(a)},!1),this.view.addEventListener("keydown",function(a){b.handleKeyDown(a)},!1)},Hb.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseUp:function(a){var b=this.listBase,c=this;a.target!==b._currentEditor&&a.target.parentNode!==b._currentEditor&&(c.clickTimer?(clearTimeout(c.clickTimer),c.clickTimer=0,b._handleDoubleClick(a)):(b._handleClick(a),c.clickTimer=setTimeout(function(){clearTimeout(c.clickTimer),c.clickTimer=0},300)))},handleKeyDown:function(a){var b=this.listBase;if(!b._currentEditor)if(Hb.isCtrlDown(a)&&65==a.keyCode)b.isKeyboardSelectEnabled()&&b.selectAll().size()>0&&b.fireInteractionEvent({kind:"selectAll"}),Ub.preventDefault(a);else if(46==a.keyCode)b.isKeyboardRemoveEnabled()&&b.removeSelection()&&b.fireInteractionEvent({kind:"removeElement"}),Ub.preventDefault(a);else if(b.isCheckMode()||38!==a.keyCode&&40!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode)Hb.showVersion(a);else{var c=b.getSelectionModel().getLastData();if(c)if(38===a.keyCode||40===a.keyCode){var d=b.getRowDatas(),e=b.getRowIndexByData(c);e>=0&&(38===a.keyCode?0!==e&&(c=d.get(e-1),b.getSelectionModel().setSelection(c)):e!==d.size()-1&&(c=d.get(e+1),b.getSelectionModel().setSelection(c)))}else!b.expand||37!==a.keyCode&&39!==a.keyCode||c.hasChildren()&&(37===a.keyCode?b.collapse(c):b.expand(c));else b.getRowDatas().size()>0&&(c=b.getRowDatas().get(0),b.getSelectionModel().setSelection(c))}},handleScroll:function(a){this.listBase.invalidate()}}),Gb.controls.ListBaseTouchInteraction=function(a){this.listBase=a,this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.startPoint=this.lastPoint=this.listBase.getLogicalPoint(a),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.listBase._zoom)},handleTouchmove:function(a){Ub.preventDefault(a);var b=this.listBase.getLogicalPoint(a);if(!(Rb.getDistance(this.startPoint,b)<20))if(this.moved||(this.moved=!0),yc.isSingleTouch(a)){if(this.lastPoint){var c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.listBase.panByOffset(c,d);this.listBase.invalidate(),this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=yc.getDistance(a)/this.distance;this.listBase.setZoom(this.zoom*f,!1)}},handleTouchend:function(a){Ub.preventDefault(a),this.moved||a.target===this.listBase._currentEditor||a.target.parentNode===this.listBase._currentEditor||this.listBase._handleClick(a),delete this.startPoint,delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)}}),Gb.controls.ListBaseMSTouchInteraction=function(a){Gb.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=Gb.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},Hb.ext("twaver.controls.ListBaseMSTouchInteraction",Gb.controls.ListBaseInteraction,{handleMouseDown:function(a){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[a.pointerId]||null==this.listBase.getLogicalPoint(a)||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),1==this._pointerIdArray.length?(this._startTouchPoint=this.listBase.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.listBase.getLogicalPoint(a);if(null==c)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.listBase.panByOffset(d,e);this.listBase.invalidate(),this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(this._startTouchPoint&&1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.listBase.getLogicalPoint(a);if(b){var c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.controls.Tree=function(a){this._interactionDispatcher=new Gb.EventDispatcher,this._initTree(a),Gb.controls.Tree.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.Tree",Gb.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:Dd.TREE_INDENT,_rowHeight:Dd.TREE_ROW_HEIGHT,_rowLineWidth:Dd.TREE_ROW_LINE_WIDTH,_rowLineColor:Dd.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:Dd.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:Dd.TREE_EXPAND_ICON,_collapseIcon:Dd.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:Dd.TREE_LINE_TYPE,_lineColor:Dd.TREE_LINE_COLOR,_lineThickness:Dd.TREE_LINE_THICKNESS,_lineAlpha:Dd.TREE_LINE_ALPHA,_lineDash:Dd.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},renderData:function(a,b,c,d){this._renderTree(a,b,c,d)},getToolTip:function(a){return a.getToolTip()||a.getName()}}),Gb.controls.Table=function(a){this._checkColumn=new Gb.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var b=this;this._checkColumn.getValue=function(a,c){return b.isSelected(a)},Gb.controls.Table.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.Table",Gb.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Dd.TABLE_EDITABLE,_rowHeight:Dd.TABLE_ROW_HEIGHT,_rowLineWidth:Dd.TABLE_ROW_LINE_WIDTH,_rowLineColor:Dd.TABLE_ROW_LINE_COLOR,_columnLineWidth:Dd.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:Dd.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Dd.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(a){a!==this.isCheckMode()&&(delete this._focusedRow,a?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!a,a))},renderCheckCell:function(a){var b=a.view._booleanPool.get();b.disabled=!1,b.type="checkbox",b.style.margin="0px 2px",b.style.verticalAlign="middle",b.checked=a.selected;var c=a.div;c.appendChild(b),""===c.style.textAlign&&(c.style.textAlign="center"),b._checkData=a.data}}),Gb.controls.TableHeader=function(a){Gb.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new Gb.Pool("div"),this._imagePool=new Gb.Pool("img"),this._textPool=new Gb.Pool("span"),this._resizePool=new Gb.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=a,this._tableView=a.getView(),this._columnBox=a.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var b=this;a.getView().addEventListener("scroll",function(a){b.invalidateScroll()},!1),a.addPropertyChangeListener(function(a){b.invalidateDisplay()},this),this._view=Ub.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=Dd.TABLEHEADER_BACKGROUND,this._rootDiv=Ub.createDiv(),this._view.appendChild(this._rootDiv),
this.invalidateDisplay(),Ob.isTouchable&&new Gb.controls.TableHeaderTouchInteraction(this),new Gb.controls.TableHeaderInteraction(this)},Hb.ext("twaver.controls.TableHeader",Gb.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:Dd.TABLEHEADER_HEIGHT,_moveBackground:Dd.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:Dd.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:Dd.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:Dd.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:Dd.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:Dd.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:Dd.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){this.invalidateDisplay()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},onPropertyChanged:function(a){this.invalidateDisplay()},invalidateScroll:function(){this._invalidateScroll||(this._invalidateScroll=!0,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate())},validate:function(){this._invalidate&&(this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px"))},validateDisplay:function(){Ub.release(this._rootDiv);for(var a=this._table.getZoom(),b=this.getHeight()+"px",c=this.getHeight()-2+"px",d=this._table.getColumnBox().getRoots(),e=d.size(),f=0,g=this._table._columnLineWidth*a,h=0;e>h;h++){var i=d.get(h);if(i.isVisible()){var j=i.getWidth()*a;0>j&&(j=0);var k=Math.min(g,j),l=this._divPool.get();l._column=i;var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=c,m.overflow="hidden",m.textOverflow="ellipsis",m.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",m.backgroundRepeat="no-repeat",m.backgroundImage="",m.textAlign=i.getHorizontalAlign(),m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=k+"px",m.borderRightColor=this._columnLineColor,0===h?(m.borderLeftWidth=k+"px",m.borderLeftColor=this._columnLineColor):m.borderLeftWidth="0px",m.left=f+"px",m.width=j-k+"px",m.height=b,l._x=f,l._width=j-k,this._rootDiv.insertBefore(l,this._rootDiv.firstChild),this.renderColumn(l,i),this.onColumnRendered(l,i),f+=j,i.isResizable()&&(l=this._resizePool.get(),l._resizeColumn=i,m=l.style,m.position="absolute",m.backgroundColor="white",m.opacity=0,m.left=f-k-this._resizeTolerance+"px",m.width=k+2*this._resizeTolerance+"px",m.height=b,this._rootDiv.appendChild(l))}}this._pools.forEach(function(a){a.clear()}),this._rootDiv.style.width=f+"px",this._rootDiv.style.height=b},renderColumn:function(a,b){if(b.renderHeader)b.renderHeader(a);else{var c=this._textPool.get();if(c.style.whiteSpace="nowrap",c.style.verticalAlign="middle",c.style.padding="1px 2px 1px 2px",c.innerHTML=b.getName()?b.getName():b.getPropertyName(),c.setAttribute("title",c.innerHTML),a.appendChild(c),Ob.isOpera){var d=a.cloneNode(!1);d.style.left="0px",d.style.top="0px",d.style.opacity=0,a.appendChild(d)}}if(this._table.getSortColumn()===b&&b.isSortable()){var e="asc"===b.getSortDirection()?this._sortAscIcon:this._sortDescIcon,f=Hb.getImageSrc(e);if(this._sortIconPosition&&""!==this._sortIconPosition)a.style.backgroundImage="url("+f+")";else{var g=this._imagePool.get();g.setAttribute("src",f),g.style.verticalAlign="middle",a.appendChild(g)}}},onColumnRendered:function(a,b){}}),Gb.controls.TableHeaderInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view;var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(a){if(0===a.button){if(this.movableDiv)return void this.handleMouseUp(a);this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this._startClient=Ub.getClientPoint(a),this.lastX=this.getX(a),this._startLogicalX=this.lastX,Ub.handle_mousedown(this,a)}},changeCursor:function(a){var b="";if(a.target._resizeColumn)b="ew-resize";else{var c=this.getColumnAt(a);c&&(c.isMovable()||c.isSortable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(null==this.lastX)return void this.changeCursor(a);if(Ub.target===this){var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeColumn){if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();10>c&&(c=10,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleMouseUp:function(a){if(0===a.button){var b;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else if(b=this.getColumnAt(a),b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?("desc"===d&&this.table.setSortColumn(null),b.setSortDirection("asc"===d?"desc":"asc")):this.table.setSortColumn(b),this.table.onColumnSorted(this.table.getSortColumn())}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){for(var b=this._startLogicalX+a.clientX-this._startClient.x+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1,h=0;d>h;h++){var i=c.get(h);if(i===this.movableDiv._column&&(g=!0),i.isVisible()){var j=i.getWidth()*e;if(0>=j)continue;if(b>=f&&f+j>=b){var k=f+j/2>b;!g||i===this.movableDiv._column&&k||h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),Gb.controls.TableHeaderTouchInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(a){return Ub.preventDefault(a),this.movableDiv?void this.handleTouchend(a):(this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),void Ub.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(a){if(Ub.preventDefault(a),null!=this.lastX){var b;if(this.resizeColumn){if(b=this.getX(a),null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();0>c&&(c=0,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){b=this.getX(a);var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleTouchend:function(a){Ub.preventDefault(a);var b;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else if(b=this.getColumnAt(a),b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?("desc"===d&&this.table.setSortColumn(null),b.setSortDirection("asc"===d?"desc":"asc")):this.table.setSortColumn(b)}this.clear(),Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){for(var b=this.getX(a)+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1,h=0;d>h;h++){var i=c.get(h);if(i===this.movableDiv._column&&(g=!0),i.isVisible()){var j=i.getWidth()*e;if(0>=j)continue;if(b>=f&&f+j>=b){var k=f+j/2>b;!g||i===this.movableDiv._column&&k||h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),Gb.controls.TablePane=function(a,b){Gb.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=a,this._tableHeader=b?b:new Gb.controls.TableHeader(a),this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var c=this;this._tableHeader.addPropertyChangeListener(function(a){"height"===a.property&&c.invalidate()})},Hb.ext("twaver.controls.TablePane",Gb.controls.ControlBase,{onPropertyChanged:function(a){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:a,height:c}),this._table.adjustBounds({x:0,y:c,width:a,height:Math.max(0,b-c)})}}),Gb.controls.TreeTable=function(a){this._treeColumn=new Gb.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(a),Gb.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},Hb.ext("twaver.controls.TreeTable",Gb.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Dd.TREETABLE_EDITABLE,_indent:Dd.TREETABLE_INDENT,_rowHeight:Dd.TREETABLE_ROW_HEIGHT,_rowLineWidth:Dd.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:Dd.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:Dd.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:Dd.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Dd.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:Dd.TREETABLE_EXPAND_ICON,_collapseIcon:Dd.TREETABLE_COLLAPSE_ICON,_lineType:Dd.TREE_LINE_TYPE,_lineColor:Dd.TREE_LINE_COLOR,_lineThickness:Dd.TREE_LINE_THICKNESS,_lineAlpha:Dd.TREE_LINE_ALPHA,_lineDash:Dd.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(a){a.view._renderTree(a.div,a.data,a.rowIndex,a.selected)},getTreeValue:function(a,b){return b.getLabel(a)},setTreeValue:function(a,b,c){a.setName(b)}}),Gb.controls.PropertySheet=function(a){Gb.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=Ub.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new md,this._categoryMap={},this._rowList=new md,this._propertyBox=new Gb.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new Gb.Pool("div",2),this.__cellPool=new Gb.Pool("div",2),this.__imagePool=new Gb.Pool("img",2),this.__textPool=new Gb.Pool("span",2),this._stringPool=new Gb.Pool("span",2),this._booleanPool=new Gb.Pool("input",2),this._colorPool=new Gb.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=Ub.createView("auto"),this._rootDiv=Ub.createDiv(),this._dataDiv=Ub.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new Gb.DataBox);var b=this;this._view.addEventListener("change",function(a){b.handleChange(a)},!1),Ob.isTouchable?Ob.isMSTouchable?new Gb.controls.PropertySheetMSTouchInteraction(this):(new Gb.controls.PropertySheetTouchInteraction(this),new Gb.controls.PropertySheetInteraction(this)):new Gb.controls.PropertySheetInteraction(this)},Hb.ext("twaver.controls.PropertySheet",Gb.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:Dd.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:Dd.SELECT_COLOR,_categorizable:Dd.PROPERTYSHEET_CATEGORIZABLE,_editable:Dd.PROPERTYSHEET_EDITABLE,_propertyNameWidth:Dd.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:Dd.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:Dd.PROPERTYSHEET_SUM_WIDTH,_indent:Dd.PROPERTYSHEET_INDENT,_rowHeight:Dd.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:Dd.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:Dd.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:Dd.PROPERTYSHEET_BORDER_COLOR,_expandIcon:Dd.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:Dd.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:Dd.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",b,this._box)}},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(a){"zoom"!==a.property&&this.invalidate()},isVisible:function(a){return a.isVisible&&!a.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(a):!0},handlePropertyChange:function(a){this._currentData===a.source&&this.invalidate()},handleSelectionChange:function(a){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(a){if(!a)return!0;var b=this._categoryMap[a];return b?b.isExpanded:Dd.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(a){if(a){var b=this._categoryMap[a];b&&!b.isExpanded&&(b.isExpanded=!0,this.invalidate())}},expandAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!0)}this.invalidate()},collapse:function(a){if(a){var b=this._categoryMap[a];b&&b.isExpanded&&(b.isExpanded=!1,this.invalidate())}},collapseAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!1)}this.invalidate()},getCategoryName:function(a){if(!this.isCategorizable())return"null";var b=a.getCategoryName();return b?b:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var a,b,c,d,e,f={},g=new md,h=this._currentData?this._propertyBox.getRoots():new md;for(d=h.size(),a=0;d>a;a++)e=h.get(a),this.isVisible(e)&&(g.add(e),c=this.getCategoryName(e),f[c]||(this._categoryList.add(c),f[c]={isExpanded:this.isExpanded(c),properties:new md}));for(this._sortFunction&&g.sort(this._sortFunction),this._categoryMap=f,d=g.size(),a=0;a<this._categoryList.size();a++){c=this._categoryList.get(a),"null"!==c&&this._rowList.add(c);var i=f[c];if(i.isExpanded)for(b=0;d>b;b++)e=g.get(b),this.getCategoryName(e)===c&&(i.properties.add(e),this._rowList.add({view:this,data:this._currentData,property:e,value:this._currentData?this.getValue(this._currentData,e):null}))}},adjustWidth:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight;a<=this._indent||0>=b||(a-=this._indent,this._rowList.size()*this._rowHeight>b&&(a-=Dd.SCROLL_BAR_WIDTH,0>=a)||(this._propertyNameWidth=0===this._sumWidth||this._propertyNameWidth>this._sumWidth?a/2:a*(this._propertyNameWidth/this._sumWidth),this._sumWidth=a,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"))},validateDisplay:function(){var a=this._rowList.size(),b=this._borderColor,c=this._indent,d=this._rowHeight,e=this._propertyNameWidth,f=Math.max(0,this._sumWidth-e),g=this._rowLineWidth,h=this._columnLineWidth,i=d-g+"px",j=d-g-2+"px",k=c+"px",l=e-h+"px",m=f-h+"px",n=e+f+"px",o=g+"px",p=h+"px",q=e+"px",r=this._dataDiv,s=r.style;s.height=a*d+"px",s.width=c+e+f+"px";var t=this.__divPool.get();s=t.style,s.position="absolute",s.left="0px",s.top="0px",s.width=k,s.height=r.style.height,s.borderWidth="0px",s.backgroundColor=b,r.appendChild(t);for(var u=0;a>u;u++){var v=this._rowList.get(u),w=u*d+"px",x=this.__divPool.get();if(v.rowDiv=x,s=x.style,s.position="absolute",s.whiteSpace="nowrap",s.overflow="hidden",s.textOverflow="ellipsis",s.left=k,s.top=w,s.width=n,s.height=i,s.lineHeight=j,s.borderStyle="solid",s.borderWidth="0px",s.borderBottomWidth=o,s.borderBottomColor=b,r.appendChild(x),"string"==typeof v){s.backgroundColor=b,t=this.__divPool.get(),s=t.style,s.position="absolute",s.left="0px",s.top=w,s.width=k,s.height=i,s.lineHeight=j,s.borderWidth="0px",r.appendChild(t);var y=this.__imagePool.get(),z=this.isExpanded(v)?this._expandIcon:this._collapseIcon;y.setAttribute("src",Hb.getImageSrc(z)),s=y.style,s.verticalAlign="middle",y._expandData=v,t.appendChild(y),this.renderCategory(x,v),this.onCategoryRendered(x,v)}else{var A=v.property,B=this.__cellPool.get();v.nameRender=B,s=B.style,this._currentRowIndex===u&&(s.backgroundColor=this.getSelectColor()),s.position="absolute",s.verticalAlign="middle",s.textAlign=this._propertyNameHorizontalAlign,s.overflow="hidden",s.textOverflow="ellipsis",s.whiteSpace="nowrap",s.left="0px",s.top="0px",s.width=l,s.height=i,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=p,s.borderRightColor=b,x.appendChild(B),this.renderName(v),this.onNameRendered(v),B=this.__cellPool.get(),v.valueRender=B,s=B.style,s.position="absolute",s.verticalAlign="middle",s.textAlign=A.getHorizontalAlign(),s.whiteSpace="nowrap",s.overflow="hidden",s.textOverflow="ellipsis",s.left=q,s.top="0px",s.width=m,s.height=i,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=p,s.borderRightColor=b,x.appendChild(B),this.renderValue(v),this.onValueRendered(v)}}s=this._resizeDiv.style,s.left=c+e-h-this._resizeTolerance+"px",s.width=h+2*this._resizeTolerance+"px",s.height=r.style.height,r.appendChild(this._resizeDiv)},renderCategory:function(a,b){var c=this.__textPool.get(),d=c.style;d.fontWeight="bold",d.whiteSpace="nowrap",d.overflow="hidden",d.textOverflow="ellipsis",d.verticalAlign="middle",d.padding="1px 2px 1px 2px",c.innerHTML=b,c.setAttribute("title",b),a.appendChild(c)},onCategoryRendered:function(a,b){},renderName:function(a){if(a.property.renderName)return void a.property.renderName(a);var b=this.__textPool.get(),c=b.style;c.fontWeight="",c.whiteSpace="nowrap",c.verticalAlign="middle",c.padding="1px 2px 1px 2px";var d=a.property.getName();d||(d=a.property.getPropertyName()),b.innerHTML=d,b.setAttribute("title",d),a.nameRender.appendChild(b)},onNameRendered:function(a){},renderValue:function(a){var b=a.property;if(b.renderValue)return void b.renderValue(a);var c=a.value,d=b.getEnumInfo(this._currentData);d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.valueRender._editInfo=a),a.valueRender.innerHTML="",zc.render(b.getValueType(),c,a.valueRender,a.view,b.isInnerText())},onValueRendered:function(a){},renderEditor:function(a){},onEditorRendered:function(a){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;Ub.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b)},getValue:function(a,b){return a?b.getValue(a,this):null},setValue:function(a,b,c){a&&b.setValue(a,c,this)},isCellEditable:function(a,b){return a?this.isEditable()&&b.isEditable():!1},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowList.size()?c:-1},handleChange:function(a){this._isCommitting||this._isCanceling||this._isValidating||a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},commitEditValue:function(a,b){var c;c="checkbox"===b.type?b.checked:b.value;var d=a.property,e=d.getValueType();if("int"===e&&"string"==typeof c)c=parseInt(c);else if("number"===e&&"string"==typeof c)c=parseFloat(c);else if("array.string"===e)c=c.split(",");else if("array.number"===e){c=c.split(",");for(var f=0,g=c.length;g>f;f++)c[f]=parseFloat(c[f])}else if("list.points"===e){for(var h=c.replace(/\]/g,"").replace(/\[/g,"").split(","),i=new Gb.List,f=0;f<h.length;f+=2)f+1>=h.length||i.add({x:parseInt(h[f]),y:parseInt(h[f+1])});c=i}if(b._rowInfo&&(b._rowInfo.value=c,this.renderValue(b._rowInfo)),this.setValue(a.data,d,c),Gb.Util.setFocus(this._view),this._currentEditor){var j=this._currentEditor.parentNode;j&&j.removeChild(this._currentEditor),delete this._currentEditor}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){var a=this._currentEditor.parentNode;a&&a.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling}},getEditorValue:function(a){var b=a.valueRender._editInfo,c=b.property.getValueType(),d=a.valueRender._editInfo.value,e="";if("list.points"===c){var f=d._as?d._as:d;f.forEach(function(a,b){e+=b==f.length-1?"["+a.x+","+a.y+"]":"["+a.x+","+a.y+"],"})}else e=d;return e},updateCurrentRowIndex:function(a){var b=this._rowList.size();(0>a||a>=b)&&(a=-1);var c,d=this._currentRowIndex;if(a!==d&&(d>=0&&b>d&&(c=this._rowList.get(d),c.nameRender&&(c.nameRender.style.backgroundColor="")),this._currentRowIndex=a),a>=0&&(c=this._rowList.get(a),c.nameRender&&(c.nameRender.style.backgroundColor=this.getSelectColor(),!this._currentEditor&&c.valueRender&&c.valueRender._editInfo))){var e=c.valueRender._editInfo,f=this.renderEditor&&this.renderEditor(c);f?(this._currentEditor=f.view,null!=e.value&&(this._currentEditor.value=this.getEditorValue(c))):e.enumInfo?this._currentEditor=Ub.createSelect(e.enumInfo,e.value):(this._currentEditor=Mb.createElement("input"),null!=e.value&&(this._currentEditor.value=this.getEditorValue(c)));var g=this;if(c.property&&c.property.renderEditor){var f="function"==typeof c.property.renderEditor?c.property.renderEditor(g,c):c.property.renderEditor;f&&(g._currentEditor=f)}if(this._currentEditor){if(f&&f.onKeyDown){var h=f.onKeyDown;h&&Array.isArray(h)&&g._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<h.length;b++)if(h[b].combKey){var c=null;switch(h[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===h[b].keyCode&&c&&h[b].handlerEvent&&h[b].handlerEvent(a)}else a.keyCode===h[b].keyCode&&h[b].handlerEvent&&h[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(13!==a.keyCode||!a.shiftKey)if(13===a.keyCode){if(b._isCommitting)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)}else 27===a.keyCode&&(b._isCanceling=!0,b.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;b._isCommitting||b._isCanceling||(b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target))},!1),this._currentEditor.keepDefault=!0,this._currentEditor._rowInfo=c,this._currentEditor._editInfo=e,!this._currentEditor.parentNode){var i=this._currentEditor.style;i.position="absolute",i.margin="0px",i.border="0px",i.padding="0px",i.left=this._indent+this._propertyNameWidth+"px",i.top=c.rowDiv.style.top,i.width=c.valueRender.style.width,i.height=c.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}Gb.Util.setFocus(this._currentEditor),this.onEditorRendered&&this.onEditorRendered(c)}}}}),Gb.controls.PropertySheetInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv;var b=this;this.view.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(a){if(a.target!==this.sheet._currentEditor&&a.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Gb.Util.setFocus(this.view),!this.sheet._isValidating))if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv)this.lastX=this.getX(a),Ub.handle_mousedown(this,a);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}},handleMouseMove:function(a){if(null==this.lastX&&!Ub.target)return void this.changeCursor(a);if(Ub.target===this&&null!=this.lastX){var b=this.getX(a);if(null!=this.stopLeft){if(b<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b}},handleMouseUp:function(a){0===a.button&&(this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX)},changeCursor:function(a){this.view.style.cursor=a.target===this.resizeDiv?"ew-resize":"default"},getX:function(a){return a.clientX/this.sheet.getZoom()}}),Gb.controls.PropertySheetTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(a){Ub.preventDefault(a),a.target!==this.sheet._currentEditor&&a.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Gb.Util.setFocus(this.view),this.sheet._isValidating||(a.target===this.resizeDiv&&(this.lastX=this.getX(a)),this.lastPoint=this.sheet.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.sheet.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)))},handleTouchmove:function(a){if(Ub.preventDefault(a),this.moved||(this.moved=!0),null!=this.lastX){var b=this.getX(a);if(null!=this.stopLeft){if(b<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b}else if(yc.isSingleTouch(a)){if(this.lastPoint){var d=this.sheet.getLogicalPoint(a),e=this.lastPoint.x-d.x,f=this.lastPoint.y-d.y,g=this.sheet.panByOffset(e,f);this.lastPoint.x-=e-g.x,this.lastPoint.y-=f-g.y}}else if(this.distance){var h=yc.getDistance(a)/this.distance;this.sheet.setZoom(this.zoom*h,!1)}},handleTouchend:function(a){if(Ub.preventDefault(a),!this.moved)if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv);else{var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)},getX:function(a){var b=a.changedTouches[0];return b.clientX}}),Gb.controls.PropertySheetMSTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=Gb.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},Hb.ext("twaver.controls.PropertySheetMSTouchInteraction",Gb.controls.PropertySheetInteraction,{handleMouseDown:function(a){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},
this._pointerIdArray=[]),this._pointerMap[a.pointerId]||null==this.sheet.getLogicalPoint(a)||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),1==this._pointerIdArray.length?(this._startTouchPoint=this.sheet.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.sheet.getLogicalPoint(a);if(null==c)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.sheet.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.sheet.getLogicalPoint(a),c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.controls.SplitPane=function(a,b,c,d){Gb.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=Ub.createDiv(),this._dividerDiv.tabIndex=-1,this._isPercentPosition=!0,this._view.appendChild(this._dividerDiv),a&&this.setFirstView(a),b&&this.setNextView(b),c&&this.setOrientation(c),d>1&&(this._isPercentPosition=!1),null!=d&&this.setPosition(d,this._isPercentPosition),this.setDividerDraggable(!0),this.setExpandable(!1),this.invalidate(),Ob.isTouchable&&new Gb.controls.SplitPaneTouchInteraction(this),new Gb.controls.SplitPaneInteraction(this)},Hb.ext("twaver.controls.SplitPane",Gb.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground","upExpandIcon","downExpandIcon","leftExpandIcon","rightExpandIcon"],__bool:["dividerDraggable","expandable"],_position:Dd.SPLITPANE_POSITION,_orientation:Dd.SPLITPANE_ORIENTATION,_dividerWidth:Dd.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:Dd.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:Dd.SPLITPANE_DIVIDER_OPACITY,_maskBackground:Dd.SPLITPANE_MASK_BACKGROUND,_upExpandIcon:Dd.SPLITPANE_UP_EXPAND_ICON,_downExpandIcon:Dd.SPLITPANE_DOWN_EXPAND_ICON,_leftExpandIcon:Dd.SPLITPANE_LEFT_EXPAND_ICON,_rightExpandIcon:Dd.SPLITPANE_RIGHT_EXPAND_ICON,onPropertyChanged:function(a){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(a,b){if(b&&0>a&&(a=0),a!==this._position){var c=this._position;this._position=a,this.firePropertyChange("position",c,a),null==this.lastDividerLocation&&(this.lastDividerLocation=a)}},setFirstView:function(a){if(this._firstView!==a){var b=this._firstView;b&&this._view.removeChild(b.getView?b.getView():b),this._firstView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("firstView",b,a)}},getFirstView:function(){return this._firstView},setNextView:function(a){if(this._nextView!==a){var b=this._nextView;b&&this._view.removeChild(b.getView?b.getView():b),this._nextView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("nextView",b,a)}},getNextView:function(){return this._nextView},validateImpl:function(){var a,b=this._position,c=this._view.offsetWidth,d=this._view.offsetHeight,e=this._dividerWidth;if(e>=8||0===e?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=Ub.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv)),"horizontal"===this._orientation){if(e>c&&(e=c),this._isPercentPosition)var f=(c-e)*b;else var f=b;var g=c-e-f+1;Hb.setViewBounds(this._firstView,{x:0,y:0,width:f,height:d}),Hb.setViewBounds(this._nextView,{x:f+e,y:0,width:g,height:d}),Hb.setViewBounds(this._dividerDiv,{x:f,y:0,width:e,height:d}),this._dividerDiv.position=f,this._coverDiv&&Hb.setViewBounds(this._coverDiv,{x:e/2-4,y:0,width:8,height:d}),this._expandable&&(this._expandCvs1||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:0,y:0,width:e,height:11}),this._expandCvs1=Hb.html.createImg(Hb.getImageSrc(this._leftExpandIcon)),this._expandCvs1.style.left=e/2-3+"px",a.appendChild(this._expandCvs1),this._dividerDiv.appendChild(a)),this._expandCvs2||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:0,y:15,width:e,height:11}),this._expandCvs2=Hb.html.createImg(Hb.getImageSrc(this._rightExpandIcon)),this._expandCvs2.style.left=e/2-3+"px",a.appendChild(this._expandCvs2),this._dividerDiv.appendChild(a)))}else{if(e>d&&(e=d),this._isPercentPosition)var h=(d-e)*b;else var h=b;var i=d-e-h;Hb.setViewBounds(this._firstView,{x:0,y:0,width:c,height:h}),Hb.setViewBounds(this._nextView,{x:0,y:h+e,width:c,height:i}),Hb.setViewBounds(this._dividerDiv,{x:0,y:h,width:c,height:e}),this._dividerDiv.position=h,this._coverDiv&&Hb.setViewBounds(this._coverDiv,{x:0,y:e/2-4,width:c,height:8}),this._expandable&&(this._expandCvs1||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:0,y:0,width:11,height:e}),this._expandCvs1=Hb.html.createImg(Hb.getImageSrc(this._upExpandIcon)),this._expandCvs1.style.top=e/2-3+"px",a.appendChild(this._expandCvs1),this._dividerDiv.appendChild(a)),this._expandCvs2||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:15,y:0,width:11,height:e}),this._expandCvs2=Hb.html.createImg(Hb.getImageSrc(this._downExpandIcon)),this._expandCvs2.style.top=e/2-3+"px",a.appendChild(this._expandCvs2),this._dividerDiv.appendChild(a)))}var j=this._dividerDiv.style;j.background=this._dividerBackground}}),Gb.controls.SplitPaneInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,this.isPercentPosition=a._isPercentPosition;var b=this;this.view.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(a){if(this.splitPane.isExpandable()){var b,c,d=this.splitPane._dividerWidth;if(a.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(a.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.splitPane.isDividerDraggable())if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=Ub.createDiv();var e=this.resizeDiv.style;e.left=this.dividerDiv.style.left,e.top=this.dividerDiv.style.top,e.width=this.dividerDiv.style.width,e.height=this.dividerDiv.style.height,e.opacity=this.splitPane.getDividerOpacity(),e.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?a.clientX:a.clientY,this.resizeDiv.maskDiv=Ub.createDiv(),e=this.resizeDiv.maskDiv.style,e.left="0px",e.top="0px",e.width=this.view.clientWidth+"px",e.height=this.view.clientHeight+"px",e.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),Ub.handle_mousedown(this,a),a.preventDefault()}},handleMouseMove:function(a){if((!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable())if(this.resizeDiv||Ub.target)this.resizeDiv&&Ub.target===this&&("horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition+"px");else{var b="horizontal"===this.splitPane._orientation?"ew-resize":"ns-resize";this.view.style.cursor=a.target===this.dividerDiv||a.target===this.splitPane._coverDiv?b:"default"}},handleMouseUp:function(a){(!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable()&&0===a.button&&this.clear(a)},clear:function(a){if(this.resizeDiv){var b,c=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var d=this.view.clientWidth;c>d&&(c=d),b=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(this.isPercentPosition?b/(d-c):b)}else{var e=this.view.clientHeight;c>e&&(c=e),b=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(this.isPercentPosition?b/(e-c):b)}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Gb.controls.SplitPaneTouchInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,this.isPercentPosition=a._isPercentPosition,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(a){if(Ub.preventDefault(a),this.splitPane.isExpandable()){var b,c,d=this.splitPane._dividerWidth;if(a.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(a.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=Ub.createDiv();var e=this.resizeDiv.style;e.left=this.dividerDiv.style.left,e.top=this.dividerDiv.style.top,e.width=this.dividerDiv.style.width,e.height=this.dividerDiv.style.height,e.opacity=this.splitPane.getDividerOpacity(),e.background=this.splitPane.getDividerBackground();var f=a.changedTouches[0];this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?f.clientX:f.clientY,this.resizeDiv.maskDiv=Ub.createDiv();var e=this.resizeDiv.maskDiv.style;e.left="0px",e.top="0px",e.width=this.view.clientWidth+"px",e.height=this.view.clientHeight+"px",e.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(Ub.preventDefault(a),(!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&this.resizeDiv){var b=a.changedTouches[0];"horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition+"px"}},handleTouchend:function(a){(!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&(Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this),this.clear(a))},clear:function(a){var b=a.changedTouches[0];if(this.resizeDiv){var c=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var d=this.view.clientWidth;c>d&&(c=d);var e=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(this.isPercentPosition?e/(d-c):e)}else{var f=this.view.clientHeight;c>f&&(c=f);var e=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(this.isPercentPosition?e/(f-c):e)}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Gb.controls.TabPane=function(){Gb.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new Gb.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=Ub.createView("hidden",!0),this._tabDiv=Ub.createDiv(),this._tabDiv.onmousedown=Ub.preventDefault,this._tabDiv.onkeydown=Ub.preventDefault,this._contentDiv=Ub.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new Gb.Pool("div"),this._iconPool=new Gb.Pool("img"),this._closePool=new Gb.Pool("img"),this._textPool=new Gb.Pool("span"),this._resizePool=new Gb.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab(),Ob.isTouchable&&new Gb.controls.TabPaneTouchInteraction(this),new Gb.controls.TabPaneInteraction(this)},Hb.ext("twaver.controls.TabPane",Gb.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:Dd.TABPANE_TAB_GAP,_tabRadius:Dd.TABPANE_TAB_RADIUS,_tabHeight:Dd.TABPANE_TAB_HEIGHT,_resizeTolerance:Dd.TABPANE_RESIZE_TOLERANCE,_tabOrientation:Dd.TABPANE_TAB_ORIENTATION,_tabBackground:Dd.TABPANE_TAB_BACKGROUND,_disabledColor:Dd.TABPANE_DISABLED_COLOR,_selectBackground:Dd.TABPANE_SELECT_BACKGROUND,_moveBackground:Dd.TABPANE_MOVE_BACKGROUND,_insertBackground:Dd.TABPANE_INSERT_BACKGROUND,_horizontalAlign:Dd.TABPANE_HORIZONTAL_ALIGN,_closeIcon:Dd.TABPANE_CLOSE_ICON,_selectNextOnClose:Dd.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:Dd.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(a){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(a){if(this._selectNextOnInVisible&&"visible"===a.property&&!a.newValue&&this._tabBox.getSelectionModel().contains(a.source)){for(var b,c,d=a.source,e=this._tabBox.getRoots().indexOf(d),f=this._tabBox.getRoots(),g=f.size(),h=e;g-1>h;)if(b=f.get(++h),b.isVisible()&&!b.isDisabled()){c=b;break}if(!c)for(h=e;h>0;)if(b=f.get(--h),b.isVisible()&&!b.isDisabled()){c=b;break}this._tabBox.getSelectionModel().setSelection(c)}this.invalidateTab()},invalidateTab:function(a){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(a))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var a,b=this._view.offsetWidth,c=this._view.offsetHeight;"top"===this._tabOrientation?(this._tabDiv.style.top="0px",a={x:0,y:this._tabHeight,width:b,height:Math.max(0,c-this._tabHeight)}):(this._tabDiv.style.top=c-this._tabHeight+"px",a={x:0,y:0,width:b,height:Math.max(0,c-this._tabHeight)}),this._currentView&&Hb.setViewBounds(this._currentView,a)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(a){},onViewAdded:function(a){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var a=this._currentTab?this._currentTab.getView():null;if(a!==this._currentView){var b,c;this._currentView&&(b=this._currentView.getView?this._currentView.getView():this._currentView,b.style.visibility="hidden",this.onViewRemoved(this._currentView)),a&&(c=a.getView?a.getView():a,c.style.visibility="inherit",c.parentNode||this._contentDiv.appendChild(c),this.onViewAdded(a)),this._currentView=a}Ub.release(this._tabDiv);for(var d=this._tabBox.getRoots(),e=this._tabHeight+"px",f=this._tabHeight-2+"px",g=this._tabRadius+"px",h=d.size(),i=0,j=0;h>j;j++){var k=d.get(j);if(k.isVisible()){var l=this._currentTab===k,m=k.getWidth();0>m&&(m=0);var n=Math.min(this._tabGap,m),o=this._divPool.get();o._tab=k;var p=o.style;p.position="absolute",p.whiteSpace="nowrap",p.lineHeight=f,p.overflow="hidden",p.textOverflow="ellipsis",p.background=l?this._selectBackground:this._tabBackground,p.textAlign=this._horizontalAlign,"top"===this._tabOrientation?(p.borderTopLeftRadius=g,p.borderTopRightRadius=g,p.borderBottomLeftRadius="0px",p.borderBottomRightRadius="0px"):(p.borderTopLeftRadius="0px",p.borderTopRightRadius="0px",p.borderBottomLeftRadius=g,p.borderBottomRightRadius=g),p.left=i+"px",p.width=m-n+"px",p.height=e,o._x=i,o._width=m-n,this.renderTab(o,k),this.onTabRendered(o,k),this._tabDiv.insertBefore(o,this._tabDiv.firstChild),i+=m,k.isResizable()&&(o=this._resizePool.get(),o._resizeTab=k,p=o.style,p.position="absolute",p.backgroundColor="white",p.opacity=0,p.left=i-n-this._resizeTolerance+"px",p.width=n+2*this._resizeTolerance+"px",p.height=e,this._tabDiv.appendChild(o))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=i+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(a){a.clear()})},renderTab:function(a,b){if(b.renderTab)b.renderTab(a);else{var c=b.getIcon();if(c){var d=this._iconPool.get();d.setAttribute("src",Hb.getImageSrc(c)),d.style.paddingLeft="4px",d.style.verticalAlign="middle",a.appendChild(d)}var e=b.getName();if(e){var f=this._textPool.get();f.style.whiteSpace="nowrap",f.style.verticalAlign="middle",f.style.padding="2px 4px",f.innerHTML=e,a.appendChild(f)}if(Ob.isOpera){var g=a.cloneNode(!1);g.style.left="0px",g.style.top="0px",g.style.opacity=0,a.appendChild(g)}}if(b.isClosable()){var h=this._tabRadius/4+2,d=this._closePool.get();d._closeTab=b,d.setAttribute("src",Hb.getImageSrc(this._closeIcon)),d.style.position="absolute",d.style.top=h+"px",d.style.right=h+"px",a.appendChild(d)}a.style.color=b.isDisabled()?this.getDisabledColor():""},onTabRendered:function(a,b){}}),Gb.controls.TabPaneInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv();var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(a){if(0===a.button){if(this.movableDiv)return void this.handleMouseUp(a);this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this.lastX=this.getX(a),this._startClient=Ub.getClientPoint(a),this._startLogicalX=this.lastX,Ub.handle_mousedown(this,a)}},changeCursor:function(a){var b="";if(a.target._resizeTab)b="ew-resize";else{var c=this.getTabAt(a);!c||c.isDisabled()&&!c.isMovable()||(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(null==this.lastX)return void this.changeCursor(a);if(Ub.target===this){var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeTab){if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);10>c&&(c=10,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleMouseUp:function(a){if(0===a.button){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){for(var b=this._startLogicalX+a.clientX-this._startClient.x,c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1,g=0;d>g;g++){var h=c.get(g);if(h===this.movableDiv._tab&&(f=!0),h.isVisible()){var i=h.getWidth();if(0>=i)continue;if(b>=e&&e+i>=b){var j=e+i/2>b;!f||h===this.movableDiv._tab&&j||g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),Gb.controls.TabPaneTouchInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv(),Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(a){return Ub.preventDefault(a),this.movableDiv?void this.handleTouchend(a):(this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),void Ub.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(a){if(null!=this.lastX)if(this.resizeTab){var b=this.getX(a);if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);0>c&&(c=0,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var b=this.getX(a),d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(a){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear(),Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){for(var b=this.getX(a),c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1,g=0;d>g;g++){var h=c.get(g);if(h===this.movableDiv._tab&&(f=!0),h.isVisible()){var i=h.getWidth();if(0>=i)continue;if(b>=e&&e+i>=b){var j=e+i/2>b;!f||h===this.movableDiv._tab&&j||g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),Gb.controls.TitlePane=function(a,b,c){Gb.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=Ub.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=Ub.preventDefault,this._span=Mb.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=Mb.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),b&&this.setTitle(b),a&&this.setContent(a),c&&this.setIcon(c)},Hb.ext("twaver.controls.TitlePane",Gb.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:Dd.TITLEPANE_TITLE_HEIGHT,_titleBackground:Dd.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:Dd.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(a){if(this._content!==a){var b=this._content;b&&this._view.removeChild(b.getView?b.getView():b),this._content=a,a&&this._view.appendChild(a.getView?a.getView():a),this.firePropertyChange("content",b,a)}},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._titleDiv.style;c.textAlign=this._titleHorizontalAlign,c.lineHeight=this._titleHeight-2+"px",c.background=this._titleBackground,Ub.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",Hb.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var c=this._titleDiv.style;c.left="0px",c.top="0px",c.width=a+"px",c.height=this._titleHeight+"px",Hb.setViewBounds(this._content,{x:0,y:this._titleHeight,width:a,height:Math.max(b-this._titleHeight,0)})}}),Gb.controls.Accordion=function(){Gb.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new md,this._currentTitle=null,this._currentView=null,this._view=Ub.createView("hidden",!0),this.invalidate();var a=this;this._view.addEventListener("mousedown",function(b){a.handleMouseDown(b)},!1)},Hb.ext("twaver.controls.Accordion",Gb.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:Dd.ACCORDION_EXPAND_ICON,_collapseIcon:Dd.ACCORDION_COLLAPSE_ICON,_titleHeight:Dd.ACCORDION_TITLE_HEIGHT,_titleBackground:Dd.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:Dd.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:Dd.ACCORDION_ICON_POSITION,onPropertyChanged:function(a){this.invalidate()},handleMouseDown:function(a){if(0===a.button){var b=a.target._title;b||(b=a.target.parentNode._title),b&&(this._currentTitle===b?this.collapse():this.expand(b))}},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(a,b){if(this._titleMap[a])throw"Title ' + title + ' already exists";var c=Ub.createDiv();c._title=a,c.onmousedown=Ub.preventDefault,c.style.cursor="pointer",c.style.textAlign="left",c.style.textOverflow="ellipsis",c.style.whiteSpace="nowrap",c.style.overflow="hidden",c.style.borderBottomWidth="1px",c.style.borderBottomStyle="solid";var d=Mb.createElement("img");d.style.verticalAlign="middle",d.style.paddingLeft="4px";var e=Mb.createElement("span");if(e.style.verticalAlign="middle",e.style.paddingLeft="4px",e.innerHTML=a,e.setAttribute("title",a),this._view.appendChild(c),c.appendChild(d),c.appendChild(e),"right"==this._iconPosition){var f=d.style,g=(this._titleHeight-8)/2;f.marginTop=g+"px",f.right="15px",f.position="absolute"}this._titleMap[a]={content:b,titleDiv:c,span:e,img:d},this._titleList.add(a),this.invalidate();
},remove:function(a){var b=this._titleMap[a];b&&this._view.removeChild(b.titleDiv),delete this._titleMap[a],this._titleList.remove(a),this.invalidate()},clear:function(){var a=this;Object.keys(a._titleMap).forEach(function(b){a._view.removeChild(a._titleMap[b].titleDiv)}),a._titleMap={},a._titleList.clear(),a.invalidate()},expand:function(a){this._titleMap[a]&&this._currentTitle!==a&&(this._currentTitle=a,this.onExpanded(a),this.invalidate())},onExpanded:function(a){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(a){},validateImpl:function(){var a=this._currentView;this._currentView=null;for(var b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._titleList.size(),e=0,f=0;d>f;f++){var g=this._titleList.get(f),h=this._titleMap[g],i=h.titleDiv.style;i.lineHeight=this._titleHeight-3+"px",i.background=this._titleBackground,i.borderBottomColor=this._borderBottomColor,i.left="0px",i.top=e+"px",i.width=b+"px",i.height=this._titleHeight-1+"px";var j=this._currentTitle===g,k=j?this._expandIcon:this._collapseIcon;if(h.img.setAttribute("src",Hb.getImageSrc(k)),j){var l=Math.max(0,c-d*this._titleHeight);h.content&&(this._currentView=h.content.getView?h.content.getView():h.content,Hb.setViewBounds(h.content,{x:0,y:e+this._titleHeight,width:b,height:l}),h.content.style.overflowY="auto"),e+=this._titleHeight+l}else e+=this._titleHeight}this._currentView&&this._currentView!==a&&this._view.appendChild(this._currentView),a&&a!==this._currentView&&this._view.removeChild(a)}}),Gb.controls.BorderPane=function(a,b,c,d,e){Gb.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,a&&this.setCenter(a),b&&this.setTop(b),c&&this.setRight(c),d&&this.setBottom(d),e&&this.setLeft(e)},Hb.ext("twaver.controls.BorderPane",Gb.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:Dd.BORDERPANE_HGAP,_vGap:Dd.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(a){this.invalidate()},getCenter:function(){return this._center},setCenter:function(a){this._setContent("center",a)},getTop:function(){return this._top},setTop:function(a){this._setContent("top",a)},getRight:function(){return this._right},setRight:function(a){this._setContent("right",a)},getBottom:function(){return this._bottom},setBottom:function(a){this._setContent("bottom",a)},getLeft:function(){return this._left},setLeft:function(a){this._setContent("left",a)},_setContent:function(a,b){var c=this["_"+a];if(c!==b){if(c){var d=c.getView?c.getView():c;this._view.contains(d)&&this._view.removeChild(d)}this["_"+a]=b,b&&this._view.appendChild(b.getView?b.getView():b),this.firePropertyChange(a,c,b)}},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=0,d=0,e=a,f=b,g=0,h=0,i=0,j=0;this._top&&(g=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),d=g+this._vGap),this._bottom&&(h=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),f=b-h-this._vGap),this._left&&(i=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),c=i+this._hGap),this._right&&(j=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),e=a-j-this._hGap);var k=Math.max(0,e-c),l=Math.max(0,f-d);this._top&&Hb.setViewBounds(this._top,{x:0,y:0,width:a,height:g}),this._bottom&&Hb.setViewBounds(this._bottom,{x:0,y:f,width:a,height:h}),this._left&&Hb.setViewBounds(this._left,{x:0,y:d,width:i,height:l}),this._right&&Hb.setViewBounds(this._right,{x:e,y:d,width:j,height:l}),this._center&&Hb.setViewBounds(this._center,{x:c,y:d,width:k,height:l})}}),Gb.controls.PopupMenu=function(a){this._view=Ub.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(a);var b=this._view,c=this;b.addEventListener("mouseover",function(a){c._mouseOver=!0},!1),b.addEventListener("mouseout",function(a){c._mouseOver=!1},!1),b.oncontextmenu=function(a){a.preventDefault()},Ub.addEventListener("mousedown","_handleClick",b,this)},Hb.ext("twaver.controls.PopupMenu",Object,{_width:200,_xOffset:0,_yOffset:0,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"white",_focusBackground:"#C2CFF1",_color:"black",_subMenuEnableIcon:Dd.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:Dd.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:Dd.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:Dd.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:Dd.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:Dd.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(a){if(this._removeContextmenuListener(),this._contextView=a,a){var b=a.getView?a.getView():a;Ob.isTouchable?(b.addEventListener("touchstart",this._getTouchStartListener(),!1),b.addEventListener("touchmove",this._getTouchMoveListener(),!1),b.addEventListener("touchend",this._getTouchEndListener(),!1),Ub.addEventListener("contextmenu","_handleContextmenu",b,this)):Ub.addEventListener("contextmenu","_handleContextmenu",b,this)}},getMenuItems:function(){return this._items},setMenuItems:function(a){if(this._items=[],this._itemsMap={},a)for(var b=0,c=a.length;c>b;b++)this.addMenuItem(a[b])},addMenuItem:function(a){a.separator!==!0&&(this._itemsMap[a.id||a.label]=a),this._items.push(a)},getMenuItem:function(a){return this._itemsMap[a]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(a){return this._itemsMap[a]},isVisible:function(a){return a.visible!==!1},isEnabled:function(a){return a.enabled!==!1},show:function(a){this.hide();var b,c,d=this._view,e=this._view.style;if(Ob.isTouchable?(b=a.changedTouches&&a.changedTouches[0].clientX||a.clientX,c=a.changedTouches&&a.changedTouches[0].clientY||a.clientY):(b=a.clientX,c=a.clientY),Ub.clear(d),this.renderMenu(d,this._items),0!==this._height){Ob.isTouchable&&Ub.addEventListener("touchstart","_handleBodyClicked",Mb.body,this),Ub.addEventListener("mousedown","_handleBodyClicked",Mb.body,this);var f=Ub.windowWidth()-this._width-10,g=Ub.windowHeight()-this._height-10;b=b>f?f:b,c=c>g?g:c,b=0>b?0:b,c=0>c?0:c,e.left=b+yc.scrollLeft()+this._xOffset+"px",e.top=c+yc.scrollTop()+this._yOffset+"px",Mb.body.appendChild(d)}},_showMenuItem:function(a,b){this._hideMenuItem(b);var c=Mb.createElement("div");b.menuItem.childrenDiv=c;var d=c.style;d.color="#000000",d.position="absolute";var e=this._width,f=b.offsetTop,g=b.menuItem.items;if(this._itemsShow=!0,b._itemsShow=!0,Ub.clear(c),this.renderMenu(c,g),0!==this._height){var h=Ub.windowWidth()-this._width-10,i=Ub.windowHeight()-10,j=this._getPosition(this._view);e=j.left+this._width>h?-this._width:e,f=j.top+f+g.length*this._menuItemHeight>i?f-(g.length-1)*this._menuItemHeight:f,d.left=e+"px",d.top=f+"px",b.appendChild(c)}},hide:function(){Mb.body.contains(this._view)&&Mb.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,Ob.isTouchable&&Ub.removeEventListener("touchstart",Mb.body,this),Ub.removeEventListener("mousedown",Mb.body,this)},_hideMenuItem:function(a){var b=a.menuItem.childrenDiv;b&&a.contains(b)&&a.removeChild(b),this._itemsShow=!1,a._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(a){return!0},onAction:function(a){},renderMenu:function(a,b){var c=a.style;c.background=this._background,c.border=this._border,c.width=this._width+"px",this._height=0,delete this._separator,a.menuItems=b;for(var d,e=0,f=b.length;f>e;e++)if(d=b[e],this.isVisible(d))if(d.separator===!0)this._separator=!0;else{var g=Mb.createElement("div");this.isEnabled(d)&&this._addMouseoverListener(g,d),g._itemsShow=!1,g.menuItem=d,a.appendChild(g),this.renderMenuItem(g,d),this.onMenuItemRendered(g,d),this._separator=!1,this._height+=this._menuItemHeight}},renderMenuItem:function(a,b){var c=a.style;c.height=this._menuItemHeight+"px",this._separator&&(c.borderTop="1px solid gray"),this.isEnabled(b)||(c.color=this._disabledColor);var d=Mb.createElement("span");c=d.style,c.position="absolute",c.width="25px",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.textAlign="center",a.appendChild(d);var e;if("check"===b.type?e=b.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:"radio"===b.type?e=b.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:b.icon&&(e=b.icon),e){var f=new Nb;f.src=Hb.getImageSrc(e),f.style.verticalAlign="middle",d.appendChild(f)}var g=Mb.createElement("label");if(Hb.setText(g,b.label,!0),c=g.style,c.position="absolute",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.left="25px",a.appendChild(g),b.items&&a.parentNode){var h=Mb.createElement("img");c=h.style,this.isEnabled(b)?h.setAttribute("src",Hb.getImageSrc(this._subMenuEnableIcon)):h.setAttribute("src",Hb.getImageSrc(this._subMenuDisableIcon));var i=(this._menuItemHeight-8)/2;c.marginTop=i+"px",c.right="5px",c.position="absolute",a.appendChild(h)}},onMenuItemRendered:function(a,b){},_addMouseoverListener:function(a,b){var c=this;this._contextView,Ob.isTouchable&&(a.addEventListener("touchstart",function(d){a.style.background=c._focusBackground,a.style.color=c._focusColor,this===d.relatedTarget||this.contains(d.relatedTarget)||b.items&&!c._itemsShow&&a.parentNode==c._view&&c._showMenuItem(d,a)},!1),a.addEventListener("touchend",function(d){if(a.style.background=c._background,a.style.color=c._color,this!==d.relatedTarget&&!this.contains(d.relatedTarget)&&b.items&&a.parentNode===c._view){var e=d.clientX,f=d.clientY,g=b.childrenDiv,h=c._getPosition(g);(e<h.left+2||e>h.left+g.offsetWidth-2||f<h.top+2||f>h.top+g.offsetHeight-2)&&c._hideMenuItem(a)}},!1)),a.addEventListener("mouseenter",function(d){a.style.background=c._focusBackground,a.style.color=c._focusColor,this===d.relatedTarget||this.contains(d.relatedTarget)||b.items&&!this._itemsShow&&this.parentNode&&c._showMenuItem(d,this)},!1),a.addEventListener("mouseleave",function(a){if(this.style.background=c._background,this.style.color=c._color,this!==a.relatedTarget&&!this.contains(a.relatedTarget)&&b.items&&this.parentNode){var d=a.clientX,e=a.clientY,f=b.childrenDiv,g=c._getPosition(f);(d<g.left+2||d>g.left+f.offsetWidth-2||e<g.top+2||e>g.top+f.offsetHeight-2)&&c._hideMenuItem(this)}},!1)},_getPosition:function(a){for(var b=0,c=0;a;)c+=a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;return{left:c,top:b}},_removeContextmenuListener:function(){var a=this._contextView;a&&(a=a.getView?a.getView():a,Ob.isTouchable?(a.removeEventListener("touchstart",this._getTouchStartListener(),!1),a.removeEventListener("touchmove",this._getTouchMoveListener(),!1),a.removeEventListener("touchend",this._getTouchEndListener(),!1),Ub.removeEventListener("contextmenu",a,this)):Ub.removeEventListener("contextmenu",a,this))},_handleContextmenu:function(a){this.onMenuShowing(a)===!0&&this.show(a),a.preventDefault()},_handleBodyClicked:function(a){if(Ob.isTouchable){for(var b=a.target;b&&b!==this._view;)b=b.parentElement;b!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(a){if(0===a.button){for(var b=a.target;!b.menuItem&&b.parentElement;)b=b.parentElement;var c=b?b.menuItem:null;c&&this.isEnabled(c)&&("check"===c.type&&(c.selected=!c.selected),"radio"===c.type&&(c.groupName?(c.selected=!0,this._items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1),a.items&&a.items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1)})})):c.selected=!c.selected),c.action&&c.action(c),this.onAction(c),c.items&&c.items.length>0||this.hide())}},_getTouchStartListener:function(){if(!this._touchStartListener){var a=this;this._touchStartListener=function(b){a._touchMoved=!1,a._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var a=this;this._touchMoveListener=function(b){a._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var a=this;this._touchEndListener=function(b){!a._touchMoved&&(new Date).getTime()-a._lastTouch.getTime()>1e3&&a._handleContextmenu(b)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(a){this._menuItemHeight=a},getBackground:function(){return this._background},setBackground:function(a){this._background=a},getBorder:function(){return this._border},setBorder:function(a){this._border=a},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(a){this._disabledColor=a},getFocusColor:function(){return this._focusColor},setFocusColor:function(a){this._focusColor=a},getFocusBackground:function(){return this._focusBackground},setFocusBackground:function(a){this._focusBackground=a},getColor:function(){return this._color},setColor:function(a){this._color=a},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(a){this._subMenuEnableIcon=a},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(a){this._subMenuDisableIcon=a},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(a){this._checkboxSelectedIcon=a},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(a){this._checkboxUnselectedIcon=a},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(a){this._radiobuttonSelectedIcon=a},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(a){this._radiobuttonUnselectedIcon=a},getXOffset:function(){return this._xOffset},setXOffset:function(a){this._xOffset=a},getYOffset:function(){return this._yOffset},setYOffset:function(a){this._yOffset=a}}),Gb.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},Gb.charts.ChartBase=function(a){Gb.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new md,this._view=Ub.createView("hidden"),this._canvas=Ub.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(a?a:new Gb.ElementBox),this.invalidate(),Ob.isTouchable?Ob.isMSTouchable?new Gb.charts.ChartMSTouchInteraction(this):(new Gb.charts.ChartTouchInteraction(this),new Gb.charts.ChartInteraction(this)):new Gb.charts.ChartInteraction(this),this.setToolTipEnabled(Dd.CHART_TOOLTIP_ENABLED)},Hb.ext("twaver.charts.ChartBase",Gb.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:Dd.CHART_BACKGROUND_VISIBLE,_backgroundFill:Dd.CHART_BACKGROUND_FILL,_backgroundFillColor:Dd.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:Dd.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:Dd.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:Dd.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:Dd.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:Dd.CHART_SELECT_TOLERANCE,_doubleClickToReset:Dd.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:Dd.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:Dd.CHART_XGAP,_yGap:Dd.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:Dd.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:Dd.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:Dd.ZOOM_MAX,_minZoom:Dd.ZOOM_MIN,_xZoomEnabled:Dd.CHART_XZOOM_ENABLED,_yZoomEnabled:Dd.CHART_YZOOM_ENABLED,_valueVisible:Dd.CHART_VALUE_VISIBLE,_valueFont:Dd.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(a){if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){Ac.showToolTip(a,b.getToolTip(a))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(a){if(this._toolTipInfos){var b=this.getLogicalPoint(a);b.x-=this._xTranslate,b.y-=this._yTranslate;for(var c=this._toolTipInfos.size(),d=c-1;d>=0;d--){var e=this._toolTipInfos.get(d);if(e.rect&&Rb.containsPoint(e.rect,b))return this.getToolTipByData(e.data,e)}}else{var f=this.tryGetDataAt(a);if(f)return this.getToolTipByData(f,{value:this.getValue(f)})}return null},getToolTipByData:function(a,b){return void 0!==b.value?this.formatValueText(b.value,a):null},addToolTipInfo:function(a,b,c,d,e,f,g){this._toolTipInfos&&this._toolTipInfos.add({data:f,rect:{x:a,y:b,width:c,height:d},value:e,index:g})},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._canvas,a,this._outerZoom)},getTextSize:function(a,b){var c=Vb.getTextSize(a,b);return c.width&&(c.width+=4),c},getUniqueColor:function(a,b){if(null==a)return null;var c;if(!b&&(c=this._nonDataColors[a]))return c;var d=Vb.getColorArray(a);if(!b)return c=255!=d[3]?a:"rgba("+d[0]+","+d[1]+","+d[2]+",0.99)",this._nonDataColors[a]=c,c;var e="rgb("+d[0]+","+d[1]+","+d[2]+")";if(void 0===this._uniqueColors[e]||this._uniqueColors[e]===b);else{var f=1,g=-1,h=1;for(Ob.isOpera&&(d=[d[0],d[1],d[2]]);(d[0]+=f,d[0]>=255?(d[0]=255,f=-1):d[0]<=0&&(d[0]=0,f=1),e="rgb("+d[0]+","+d[1]+","+d[2]+")",void 0!==this._uniqueColors[e]&&this._uniqueColors[e]!==b)&&(d[1]+=g,d[1]>=255?(d[1]=255,g=-1):d[1]<=0&&(d[1]=0,g=1),e="rgb("+d[0]+","+d[1]+","+d[2]+")",void 0!==this._uniqueColors[e]&&this._uniqueColors[e]!==b)&&(d[2]+=h,d[2]>=255?(d[2]=255,h=-1):d[2]<=0&&(d[2]=0,h=1),e="rgb("+d[0]+","+d[1]+","+d[2]+")",void 0!==this._uniqueColors[e]&&this._uniqueColors[e]!==b););}return this._uniqueColors[e]=b,e},tryGetDataAt:function(a,b){if((null==b||0>b)&&(b=this._selectTolerance),a.target&&(a=Ub.getLogicalPoint(this._canvas,arguments[0],this._outerZoom)),!a)return null;var c=a.x-b,d=a.y-b,e=2*b+1,f=2*b+1;try{for(var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data,h=0,i=g.length;i>h;h+=4)if(255===g[h+3]){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null},_getPoint:function(){var a,b;if(2===arguments.length)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=Ub.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!c)return null;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;return{x:a,y:b}},getDataAt:function(){var a=this._getPoint.apply(this,arguments),b=a.x,c=a.y;if(0>b||0>c||b>this._canvasWidth||c>this._canvasHeight)return null;try{var d=this._canvas.getContext("2d").getImageData(b,c,1,1).data;if(255===d[3]){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(a,b){this._backgroundRect=Hb.clone(b),null!=b&&b.width>0&&b.height>0&&this._backgroundVisible&&(this._backgroundFill&&Vb.fill(a,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),b),this._backgroundOutlineWidth>0&&(a.lineWidth=this._backgroundOutlineWidth,a.strokeStyle=this._backgroundOutlineColor),a.beginPath(),a.rect(b.x,b.y,b.width,b.height),a.closePath(),this._backgroundFill&&a.fill(),this._backgroundOutlineWidth>0&&a.stroke())},getName:function(a){return a.getName()},getColor:function(a){return a.getStyle?a.getStyle("chart.color"):a.getClient("chart.color")},getValue:function(a){return a.getStyle?a.getStyle("chart.value"):0},getValueColor:function(a){return a.getStyle?a.getStyle("chart.value.color"):Gb.Styles.getStyle("chart.value.color")},setValueFont:function(a){if(a!==this._valueFont){var b=a;this._valueFont=a,this.firePropertyChange("valueFont",b,a)}},getValueFont:function(a){if(a){var b=a.getStyle?a.getStyle("chart.value.font"):Gb.Styles.getStyle("chart.value.font");if(b)return b}return this._valueFont},formatValueText:function(a,b){return a},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(a){return this._internalVisibleFunction&&!this._internalVisibleFunction(a)?!1:this._visibleFunction?this._visibleFunction(a):!0},onPropertyChanged:function(a){Gb.charts.IS_INVALIDATE_PROPERTY[a.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)}},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){this.invalidateModel()},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new md,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(a,b){a.forEach(function(a){b.add(a),this._buildChildren(a.getChildren(),b)},this)},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this.invalidate())},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(a){a.IStyle?a.getStyle("chart.color")||a.setStyle("chart.color",Hb.nextColor()):a.getClient("chart.color")||a.setClient("chart.color",Hb.nextColor())}),this.validateModel());var a=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),a.clearRect(0,0,this._canvasWidth,this._canvasHeight),Gb.Util.makeHighRes(this._canvas),this._canvasWidth>0&&this._canvasHeight>0&&(a.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new md:null,this.validateDisplay(a,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,a.translate(-this._xTranslate,-this._yTranslate))},adjustBounds:function(a){Gb.charts.ChartBase.superClass.adjustBounds.apply(this,arguments)},validateModel:function(){},validateDisplay:function(a,b,c){},drawLine:function(a,b,c,d,e,f,g){c>0&&(a.lineWidth=c,a.strokeStyle=this.getUniqueColor(b),a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke())},drawValueTexts:function(a){this._valueTexts&&this._valueTexts.forEach(function(b){Vb.drawText(a,b.text,b,b.font,b.color)})},drawVerticalText:function(a,b,c,d,e){e=this.getUniqueColor(e),a.translate(c.x,c.y),a.rotate(-Math.PI/2),Vb.drawText(a,b,null,d,e),a.rotate(Math.PI/2),a.translate(-c.x,-c.y)},_getValueTextInfo:function(a,b){if(this._valueTexts){var c=this.formatValueText(b,a);if(c&&""!==c){var d=this.getValueColor(a),e={text:c,font:this.getValueFont(a),color:this.getUniqueColor(d,a)};return this._valueTexts.add(e),e}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(!(0>a)){var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getXZoom()>a&&this.setXZoom(a,!1),this.getYZoom()>a&&this.setYZoom(a,!1)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(!(0>a)){var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getXZoom()<a&&this.setXZoom(a),this.getYZoom()<a&&this.setYZoom(a)}},zoomIn:function(a){null==a&&(a=Dd.ZOOM_ANIMATE),a?Gb.animate.AnimateManager.start(new Gb.animate.AnimateXYZoom(this,this._xZoom*Dd.ZOOM_INCREMENT,this._yZoom*Dd.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(a){null==a&&(a=Dd.ZOOM_ANIMATE),a?Gb.animate.AnimateManager.start(new Gb.animate.AnimateXYZoom(this,this._xZoom/Dd.ZOOM_INCREMENT,this._yZoom/Dd.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(a){null==a&&(a=Dd.ZOOM_ANIMATE),a?Gb.animate.AnimateManager.start(new Gb.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(a,b){},xZoomIn:function(a){this.setXZoom(this._xZoom*Dd.ZOOM_INCREMENT,a)},xZoomOut:function(a){this.setXZoom(this._xZoom/Dd.ZOOM_INCREMENT,a)},xZoomReset:function(a){this.setXZoom(1,a)},setXZoom:function(a,b){if(Hb.num(a)&&!(0>=a)&&(a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a!==this.xZoom))if(null==b&&(b=Dd.ZOOM_ANIMATE),b)Gb.animate.AnimateManager.start(new Gb.animate.AnimateXZoom(this,a));else{var c=this._xZoom,d=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/c*(a-c);this._xZoom=a,this.firePropertyChange("xZoom",c,a),this.onXZoomChanged(c,a),this.setXTranslate(d)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(a,b){},yZoomIn:function(a){this.setYZoom(this._yZoom*Dd.ZOOM_INCREMENT,a)},yZoomOut:function(a){this.setYZoom(this._yZoom/Dd.ZOOM_INCREMENT,a)},yZoomReset:function(a){this.setYZoom(1,a)},setYZoom:function(a,b){if(Hb.num(a)&&!(0>=a)&&(a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a!==this.YZoom))if(null==b&&(b=Dd.ZOOM_ANIMATE),b)Gb.animate.AnimateManager.start(new Gb.animate.AnimateYZoom(this,a));else{var c=this._yZoom,d=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/c*(a-c);this._yZoom=a,this.firePropertyChange("yZoom",c,a),this.onYZoomChanged(c,a),this.setYTranslate(d)}}}),Gb.charts.ScaleChart=function(a){Gb.charts.ScaleChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.ScaleChart",Gb.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,null!=this._upperLimit&&(this._max=this._upperLimit),null!=this._lowerLimit&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},formatYScaleText:function(a){return a.toFixed(2)},_initRange:function(){null==this._lowerLimit&&(this._min>=this._max&&(this._min=this._max-.1*Math.abs(this._max)),this._min=this._min-.1*(this._max-this._min)),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.values.forEach(function(a){b.proportions.add(null==a?null:0==this._range?0:a/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a)};this._initInfo&&this._initInfo(a,c),this._map[a.getId()]=c,(null==this._upperLimit||null==this._lowerLimit)&&b.forEach(function(a){null!=a&&(null==this._upperLimit&&a>this._max&&(this._max=a),null==this._lowerLimit&&a<this._min&&(this._min=a))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(a,b,c){var d=0;this._xAxisText&&(d=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var e=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(a){var b=this.getTextSize(this._xScaleTextFont,a),c="vertical"===this._xScaleTextOrientation?b.width:b.height;c>e&&(e=c)},this);var f=c-this._yGap-d-e,g=f-this._yGap,h=null==this._upperLimit?.9*g:g,i=0;this._yAxisText&&(i=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var j,k;this._yScaleValueGap>0?(j=Math.max(this._yScaleValueGap/this._range*h,1),k=this._yScaleValueGap):(j=Math.max(this._yScalePixelGap,1),k=this._range*(j/h));var l,m,n=0,o=new md;if(this._yScaleTextVisible){l=this._yScaleMinTextVisible?0:j;for(var p=this._min+(this._yScaleMinTextVisible?0:k);g+1>=l;){if(m=this.formatYScaleText(p)){var q=this.getTextSize(this._yScaleTextFont,m);q.width>n&&(n=q.width),o.add({text:m,size:q,cursor:l})}l+=j,p+=k}}var r={x:this._xGap+i+n,y:this._yGap,width:b-this._xGap-i-n-this._xGap,height:c-this._yGap-e-d-this._yGap};if(this.drawBackground(a,r),this._columnWidth=this._columnCount>0?r.width/(3*this._columnCount+1)*2:r.width/2,0===this._columnWidth&&(this._columnWidth=1),this._yScaleLineWidth>0)for(l=0;g+1>=l;)this.drawLine(a,this._yScaleLineColor,this._yScaleLineWidth,r.x,f-l,r.x+r.width,f-l),l+=j;this._xAxisText&&Vb.drawText(a,this._xAxisText,{x:r.x+r.width/2,y:f+e+d/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(a,this._yAxisText,{x:this._xGap+i/2,y:g/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(a,this._yAxisLineColor,this._yAxisLineWidth,r.x,r.y+r.height,r.x,r.y);var s=this.getUniqueColor(this._yScaleTextColor);o.forEach(function(b){var c={x:this._xGap+i+n-b.size.width/2,y:f-b.cursor};Vb.drawText(a,b.text,c,this._yScaleTextFont,s)},this);var t=r.y+r.height+e/2;s=this.getUniqueColor(this._xScaleTextColor);for(var u=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null,v=0;v<this._columnCount;v++){var w=r.x+this._columnWidth*(1+1.5*v);if(this._xScaleTexts&&v<this._xScaleTexts.size()&&(m=this._xScaleTexts.get(v))){var x={x:w,y:t};"vertical"===this._xScaleTextOrientation?this.drawVerticalText(a,m,x,this._yScaleTextFont,s):this._valueSpanCount?v%this._valueSpanCount==0&&Vb.drawText(a,m,x,this._xScaleTextFont,s):Vb.drawText(a,m,x,this._xScaleTextFont,s)}"default"!==this._type&&u&&(this._valueSpanCount?v%this._valueSpanCount==0&&this.drawLine(a,u,this._xScaleLineWidth,w,r.y+r.height,w,r.y):this.drawLine(a,u,this._xScaleLineWidth,w,r.y+r.height,w,r.y))}var y=f+this._min/k*j;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(a,r,h,y),this.drawLine(a,this._xAxisLineColor,this._xAxisLineWidth,r.x,r.y+r.height,r.x+r.width,r.y+r.height);
}}),Gb.charts.PieChart=function(a){this._sum=0,this._map={},Gb.charts.PieChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.PieChart",Gb.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:Dd.PIECHART_TYPE,_lineRate:Dd.PIECHART_LINE_RATE,_donutRate:Dd.PIECHART_DONUT_RATE,_startAngle:Dd.PIECHART_START_ANGLE,_shadowColor:Dd.PIECHART_SHADOW_COLOR,_shadowOffset:Dd.PIECHART_SHADOW_OFFSET,_selectOffset:Dd.PIECHART_SELECT_OFFSET,_valuePosition:Dd.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)},this._sum+=b},this);var a=this._startAngle;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.proportion=0===this._sum?0:c.value/this._sum,"line"!==this._type&&(c.startAngle=a,c.arc=c.proportion*Math.PI*2,a+=c.arc)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),Rb.grow(d,-4,-4),!(d.width<=0||d.height<=0)){var e=this._shadowOffset;if(e>0&&(a.shadowOffsetX=e,a.shadowOffsetY=e,a.shadowBlur=1.5*e,a.shadowColor=this._shadowColor),"oval"===this._type||"circle"===this._type){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;"circle"===this._type&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(0!==c.arc){var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}a.fillStyle=c.color,a.beginPath(),a.moveTo(f+d,g-e),Vb.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.closePath(),a.fill();var k=this._getValueTextInfo(b,c.value);if(k){var j=c.startAngle+c.arc/2;k.x=f+d+Math.cos(j)*h*this._valuePosition,k.y=g-e-Math.sin(j)*i*this._valuePosition}}},this)}else if("donut"===this._type||"ovalDonut"===this._type){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;"donut"===this._type&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(0!==c.arc){var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}var k=f+Math.cos(c.startAngle)*h*this._donutRate,l=g-Math.sin(c.startAngle)*i*this._donutRate,m=f+Math.cos(c.startAngle+c.arc)*h*this._donutRate,n=g-Math.sin(c.startAngle+c.arc)*i*this._donutRate;a.fillStyle=c.color,a.beginPath(),a.moveTo(k+d,l-e),Vb.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.lineTo(m+d,n-e),Vb.drawArc(a,f+d,g-e,c.startAngle+c.arc,-c.arc,h*this._donutRate,i*this._donutRate,!0),a.closePath(),a.fill();var o=this._getValueTextInfo(b,c.value);if(o){var j=c.startAngle+c.arc/2,p=this._donutRate+(1-this._donutRate)*this._valuePosition;o.x=f+d+Math.cos(j)*h*p,o.y=g-e-Math.sin(j)*i*p}}},this)}else if("line"===this._type){var j=d.height*this._lineRate;d.y=d.y+d.height/2-j/2,d.height=j;var k=d.x;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],e=d.width*c.proportion;if(0!==e){a.beginPath(),a.fillStyle=c.color;var f=this.isSelected(b)?-this._selectOffset:0;a.rect(k,d.y+f,e,d.height),a.closePath(),a.fill();var g=this._getValueTextInfo(b,c.value);g&&(g.x=k+e/2,g.y=d.y+d.height+f-d.height*this._valuePosition),k+=e}},this)}this._shadowOffset>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),this.drawValueTexts(a)}}}),Gb.charts.BarChart=function(a){Gb.charts.BarChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.BarChart",Gb.charts.ScaleChart,{__accessor:["type"],_upperLimit:Dd.BARCHART_UPPER_LIMIT,_lowerLimit:Dd.BARCHART_LOWER_LIMIT,_type:Dd.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:Dd.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Dd.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:Dd.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Dd.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Dd.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Dd.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:Dd.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Dd.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Dd.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:Dd.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Dd.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:Dd.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Dd.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Dd.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:Dd.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Dd.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Dd.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:Dd.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Dd.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var a=this._type+"ValidateModel";this[a]&&(this._reset(),this[a]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(a){var b=this.getValue(a);null==this._upperLimit&&b>this._max&&(this._max=b),null==this._lowerLimit&&b<this._min&&(this._min=b),this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)}},this),this._initRange(),this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.proportion=0==this._range?0:b.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){if(this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this),null==this._upperLimit||null==this._lowerLimit)for(var a=0;a<this._columnCount;a++){var b=0,c=0;this._publishedDatas.forEach(function(d){var e=this._map[d.getId()];if(e.values.size()>a){var f=e.values.get(a);null!=f&&(f>=0?b+=f:c+=f)}},this),null==this._upperLimit&&b>this._max&&(this._max=b),null==this._lowerLimit&&c<this._min&&(this._min=c)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);for(var a=new md,b=0;b<this._columnCount;b++){var c=0;this._publishedDatas.forEach(function(a){var d=this._map[a.getId()];if(d.values.size()>b){var e=d.values.get(b);null!=e&&(c+=e)}},this),a.add(c)}for(var b=0;b<this._columnCount;b++)this._publishedDatas.forEach(function(c){var d=this._map[c.getId()],e=a.get(b);if(0!==e&&d.values.size()>b){var f=d.values.get(b);if(null!=f)return void d.proportions.add(f/e)}d.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(a,b,c,d,e,f,g){a.fillStyle=b,c&&this._selectInfos.add({x:d,y:e,w:f,h:g,color:this.getUniqueColor(Vb.darker(b))}),a.beginPath(),a.rect(d,e,f,g),a.closePath(),a.fill()},drawContent:function(a,b,c,d){this._selectInfos=new md,this._toolTipInfos=this.isToolTipEnabled()?new md:null,"default"===this._type?this.drawDefaultContent(a,b,c,d):"group"===this._type?this.drawGroupContent(a,b,c,d):"percent"===this._type?this.drawPercentContent(a,b,c,d):"stack"===this._type?this.drawStackContent(a,b,c,d):"layer"===this._type&&this.drawLayerContent(a,b,c,d),this.drawValueTexts(a),this._selectInfos.forEach(function(b){a.lineWidth=2,a.strokeStyle=b.color,a.beginPath(),a.rect(b.x,b.y,b.w,b.h),a.closePath(),a.stroke()},this),delete this._selectInfos},drawDefaultContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnWidth,g=0;e>g;g++){var h=this._publishedDatas.get(g),i=this._map[h.getId()],j=b.x+f*(.5+1.5*g),k=Math.abs(c*i.proportion),l=i.proportion>0?d-k:d;this.drawRect(a,i.color,this.isSelected(h),j,l,f,k),this.addToolTipInfo(j,l,f,k,i.value,h);var m=this._getValueTextInfo(h,i.value);if(m){var n=this.getTextSize(m.font,m.text);m.x=j+f/2,m.y=l-n.height/2+1}}},drawPercentContent:function(a,b,c,d){this.drawStackContent(a,b,c,d)},drawStackContent:function(a,b,c,d){for(var e=this._columnCount,f=this._columnWidth,g=0;e>g;g++){var h=d,i=b.x+f*(.5+1.5*g);this._publishedDatas.forEach(function(b){var d=this._map[b.getId()];if(g<d.proportions.size()){var e=d.proportions.get(g);if(null!=e){var j=c*e;h-=j,this.drawRect(a,d.color,this.isSelected(b),i,h,f,j),this.addToolTipInfo(i,h,f,j,d.values.get(g),b);var k=this._getValueTextInfo(b,d.values.get(g));k&&(k.x=i+f/2,k.y=h+j/2)}}},this)}},drawLayerContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=3*g/8/e,i=0;f>i;i++){var j=b.x+g*(.5+1.5*i),k=0;this._publishedDatas.forEach(function(b){var f=this._map[b.getId()];if(i<f.proportions.size()){var l=f.proportions.get(i);if(null!=l){var m=c*l,n=d-m,o=j+g/2-g/8-h*(e-k),p=2*(g/8+h*(e-k));this.drawRect(a,f.color,this.isSelected(b),o,n,p,m),this.addToolTipInfo(o,n,p,m,f.values.get(i),b);var q=this._getValueTextInfo(b,f.values.get(i));if(q){var r=this.getTextSize(q.font,q.text);q.x=o+p/2,q.y=n-r.height/2+1}}}k++},this)}},drawGroupContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g/e,i=0;f>i;i++){var j=b.x+g*(.5+1.5*i),k=0;this._publishedDatas.forEach(function(b){var e=this._map[b.getId()];if(i<e.proportions.size()){var f=e.proportions.get(i);if(null!=f){var g=c*f,l=d-g;this.drawRect(a,e.color,this.isSelected(b),j+h*k,l,h,g),this.addToolTipInfo(j+h*k,l,h,g,e.values.get(i),b);var m=this._getValueTextInfo(b,e.values.get(i));if(m){var n=this.getTextSize(m.font,m.text);m.x=j+h*k+h/2,m.y=l-n.height/2+1}}}k++},this)}}}),Gb.charts.LineChart=function(a){Gb.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Hb.ext("twaver.charts.LineChart",Gb.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:Dd.LINECHART_INTERRUPTABLE,_upperLimit:Dd.LINECHART_UPPER_LIMIT,_lowerLimit:Dd.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Dd.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Dd.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Dd.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Dd.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Dd.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Dd.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Dd.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Dd.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Dd.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Dd.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Dd.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Dd.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Dd.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:Dd.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:Dd.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Dd.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Dd.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Dd.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Dd.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Dd.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Dd.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Dd.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):Gb.Styles.getStyle("chart.line.width")},getMarkerShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):Gb.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):Gb.Styles.getStyle("chart.marker.size")},_initInfo:function(a,b){b.markerShape=this.getMarkerShape(a),b.markerSize=this.getMarkerSize(a),b.lineWidth=this.getLineWidth(a),this.isSelected(a)&&(b.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var a=this._getPoint.apply(this,arguments),b=this.tryGetDataAt(a);if(!b)return-1;for(var c,d=this._map[b.getId()],e=d.points,f=d.markerSize,g=0,h=e.size();h>g;g++)if(c=e.get(g),c&&Rb.getDistance(a,c)<=f)return g;return-1},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new md:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.markerSize>0?new md:null;a.strokeStyle=f.color,a.lineWidth=f.lineWidth,a.beginPath();var h=f.proportions,i=null,j=h.size(),k=new md;f.points=k;for(var l=0;j>l;l++){var m=h.get(l);if(null!=m){var n={x:b.x+this._columnWidth*(1+1.5*l),y:d-c*m};k.add(n),null==i?a.moveTo(n.x,n.y):a.lineTo(n.x,n.y);var o=f.values.get(l),p=this._getValueTextInfo(e,o);if(p){var q=this.getTextSize(p.font,p.text);p.x=n.x,p.y=n.y-q.height/2+2}g&&g.add({point:n,value:o,data:e,index:l}),i=n}else this._interruptable&&(i=null,k.add(null))}if(a.stroke(),g){var r=f.markerSize/2;g.forEach(function(b){a.fillStyle=f.color;var c=b.point.x-r,d=b.point.y-r,e=f.markerSize,g=f.markerSize;Vb.drawVector(a,f.markerShape,null,c,d,e,g),a.fill(),this.addToolTipInfo(c,d,e,g,b.value,b.data,b.index)},this)}},this),this.drawValueTexts(a)}}),Gb.charts.BubbleChart=function(a){Gb.charts.BubbleChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.BubbleChart",Gb.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:Dd.BUBBLECHART_UPPER_LIMIT,_lowerLimit:Dd.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:Dd.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:Dd.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Dd.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Dd.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Dd.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Dd.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Dd.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Dd.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Dd.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Dd.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Dd.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Dd.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Dd.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Dd.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Dd.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:Dd.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Dd.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Dd.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Dd.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Dd.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Dd.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Dd.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Dd.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:Dd.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Dd.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,null!=this._xAxisUpperLimit&&(this._xMax=this._xAxisUpperLimit),null!=this._xAxisLowerLimit&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(a){return a.getStyle?a.getStyle("chart.bubble.shape"):Gb.Styles.getStyle("chart.bubble.shape")},getSize:function(a,b){return b},getNames:function(a){return a.getStyle?a.getStyle("chart.names"):Gb.Styles.getStyle("chart.names")},getXAxisValues:function(a){return a.getStyle?a.getStyle("chart.xaxis.values"):Gb.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(a){return a.getStyle?a.getStyle("chart.yaxis.values"):Gb.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){null==this._xAxisLowerLimit&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-.1*Math.abs(this._xMax)),this._xMin=this._xMin-.1*(this._xMax-this._xMin)),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.xAxisValues.forEach(function(a){b.xAxisProportions.add(null==a?null:0==this._xRange?0:a/this._xRange)},this),b.yAxisValues.forEach(function(a){b.yAxisProportions.add(null==a?null:0==this._range?0:a/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=null==this._xScaleTexts?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(a){var b=new md(this.getYAxisValues(a)),c=new md(this.getXAxisValues(a)),d=new md(this.getValues(a));d.size()>this._columnCount&&(this._columnCount=d.size());var e={data:a,values:d,yAxisValues:b,xAxisValues:c,yAxisProportions:new md,xAxisProportions:new md,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getShape(a)};this._map[a.getId()]=e,(null==this._upperLimit||null==this._lowerLimit)&&b.forEach(function(a){null!=a&&(null==this._upperLimit&&a>this._max&&(this._max=a),null==this._lowerLimit&&a<this._min&&(this._min=a))},this),(null==this._upperLimit||null==this._lowerLimit)&&c.forEach(function(a){null!=a&&(null==this._xAxisUpperLimit&&a>this._xMax&&(this._xMax=a),null==this._xAxisLowerLimit&&a<this._xMin&&(this._xMin=a))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new md:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.yAxisProportions,h=f.xAxisProportions,i=f.values,j=f.yAxisProportions.size(),k=this._selectShadowOffset;this.isSelected(e)&&k>0?(a.shadowOffsetX=k,a.shadowOffsetY=k,a.shadowBlur=2*k,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=f.color),a.fillStyle=f.color;for(var l=0;j>l;l++){var m=g.get(l),n=h.get(l);if(null!=m){var o={x:b.x+b.width*n,y:d-c*m},p=i.get(l),q=this.getSize(e,p),k=q/2,r=o.x-k,s=o.y-k,t=q,u=q;Vb.drawVector(a,f.anchorShape,null,r,s,t,u),a.fill(),this.addToolTipInfo(r,s,t,u,p,e,l);var v=this._getValueTextInfo(e,p);if(v){var q=this.getTextSize(v.font,v.text);v.x=o.x,v.y=o.y}}}},this),this.drawValueTexts(a)}}),Gb.charts.DialChart=function(a){Gb.charts.DialChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.DialChart",Gb.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:Dd.DIALCHART_UPPER_LIMIT,_lowerLimit:Dd.DIALCHART_LOWER_LIMIT,_startAngle:Dd.DIALCHART_START_ANGLE,_endAngle:Dd.DIALCHART_END_ANGLE,_innerRadius:Dd.DIALCHART_INNER_RADIUS,_colorRangeFillColor:Dd.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:Dd.DIALCHART_OUTLINE_WIDTH,_outlineColor:Dd.DIALCHART_OUTLINE_COLOR,_scaleInside:Dd.DIALCHART_SCALE_INSIDE,_majorScaleCount:Dd.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:Dd.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:Dd.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:Dd.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:Dd.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:Dd.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:Dd.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:Dd.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:Dd.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:Dd.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:Dd.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:Dd.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:Dd.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:Dd.DIALCHART_PIVOT_RADIUS,_pivotFill:Dd.DIALCHART_PIVOT_FILL,_pivotFillColor:Dd.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:Dd.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:Dd.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:Dd.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:Dd.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:Dd.DIALCHART_VALUE_POSITION,_innerDarkerRadius:Dd.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:Dd.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:Dd.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Dd.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(a){return a.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var a=this._startAngle;0!=a&&(a=(a%360+360)%360,0==a&&(a=360)),this._positiveStartAngle=a;var b=this._endAngle;0!=b&&(b=(b%360+360)%360,0==b&&(b=360)),this._positiveEndAngle=b,this._whole=360==Math.abs(a-b),this._startAngleByRadian=a*Math.PI/180,this._endAngleByRadian=b*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a),angle:this._startAngleByRadian+(this._clockwise?-1:1)*b/this._valueRange*this._angleRange}},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),this._startAngleByRadian!=this._endAngleByRadian){var e,f,g=this._lowerLimit,h=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,i=0,j=0,k=null,l=null;if(this._scaleTextVisible)for(k=new md,e=0;e<this._majorScaleCount;e++)0==e&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(f=null,k.add({text:"",size:{width:0,height:0}})):(l=this.formatScaleText(g),f=this.getTextSize(this._scaleTextFont,l),k.add({text:l,size:f})),this._scaleInside||null==f||(f.width>i&&(i=f.width),f.height>j&&(j=f.height)),g+=h;if(this._angleRange<=Math.PI&&(i=Math.max(i,this._pivotRadius),j=Math.max(j,this._pivotRadius)),Rb.grow(d,-i,-j),this._calcluateCenterAndRadius(d),a.lineWidth=0,null==this._colorRangeList||0==this._colorRangeList.size())this._drawArcGroup(a,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(a,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var m=this._angleRange/this._colorRangeList.size(),n=this._startAngleByRadian;for(e=0;e<this._colorRangeList.size();e++){var o=this.getUniqueColor(this._colorRangeList.get(e)),p=n+(this._clockwise?-1:1)*m;this._drawArcGroup(a,n,p,o),this._drawArcOutLine(a,n,n+(this._clockwise?-1:1)*m,0==e,e==this._colorRangeList.size()-1),n+=(this._clockwise?-1:1)*m}}var q,r,s,t,u,v,w,x,y=this._startAngleByRadian,z=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0;for(v=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,w=v+this._majorScaleLineLength*(this._scaleInside?1:-1),x=v+this._minorScaleLineLength*(this._scaleInside?1:-1),e=0;e<this._majorScaleCount;e++){if(r=this._center.x+Math.cos(y)*v,s=this._center.y+Math.sin(-y)*v,t=this._center.x+Math.cos(y)*w,u=this._center.y+Math.sin(-y)*w,a.lineWidth=this._majorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),a.beginPath(),a.moveTo(r,s),a.lineTo(t,u),a.closePath(),a.stroke(),this._scaleTextVisible)if(0==e&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible);else{var A=k.get(e);if(A){var B=this.getScaleTextPosition(y/Math.PI*180,r,s,A.size.width,A.size.height);A.x=B.x,A.y=B.y}}if(this._whole||!this._whole&&e<this._majorScaleCount-1){var C=y,D=this._minorScaleCount>0?z/(this._minorScaleCount+1):0;for(q=0;q<this._minorScaleCount;q++)C+=(this._clockwise?-1:1)*D,r=this._center.x+Math.cos(C)*v,s=this._center.y+Math.sin(-C)*v,t=this._center.x+Math.cos(C)*x,u=this._center.y+Math.sin(-C)*x,a.lineWidth=this._minorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),a.beginPath(),a.moveTo(r,s),a.lineTo(t,u),a.closePath(),a.stroke()}y+=(this._clockwise?-1:1)*z}this._pivotFill&&Vb.fill(a,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,2*this._pivotRadius,2*this._pivotRadius),a.lineWidth=this._pivotOutlineWidth,a.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),a.beginPath(),a.arc(this._center.x,this._center.y,this._pivotRadius,0,2*Math.PI,!0),a.closePath(),this._pivotFill&&a.fill(),k&&k.forEach(function(b){b&&Vb.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=this._getDataStyle("dialchart.rear.extension",b),e=this._getDataStyle("dialchart.base.width",b),f=this._getDataStyle("dialchart.top.width",b),g=this._getDataStyle("dialchart.radius",b);g>=-1&&1>=g&&(g*=this._innerRadiusByPixel),a.fillStyle=c.color,a.lineWidth=0;var h=Rb.createMatrix(-c.angle,this._center.x,this._center.y),i=h.transform(this._center.x+g,this._center.y+f/2),j=h.transform(this._center.x+g,this._center.y-f/2),k=h.transform(this._center.x-d,this._center.y-e/2),l=h.transform(this._center.x-d,this._center.y+e/2),m=this._selectShadowOffset;this.isSelected(b)&&m>0?(a.shadowOffsetX=m,a.shadowOffsetY=m,a.shadowBlur=2*m,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=c.color),a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(k.x,k.y),a.lineTo(l.x,l.y),a.lineTo(i.x,i.y),a.closePath(),a.fill();var n=this._getValueTextInfo(b,c.value);if(n){var o=h.transform(this._center.x+g*this._valuePosition,this._center.y);n.x=o.x,n.y=o.y}},this),this.drawValueTexts(a)}},_getDataStyle:function(a,b){return b.getStyle?b.getStyle(a):b.getClient(a)},_calcluateCenterAndRadius:function(a){var b=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,c=this._clockwise?this._positiveStartAngle:this._positiveEndAngle;Math.abs(this._positiveEndAngle-this._positiveStartAngle),b>=0&&90>b?c>=0&&90>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):c>90&&180>=c?(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height+this._outerRadius)/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):b>=90&&180>b?c>=90&&180>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):c>180&&270>=c?(this._outerRadius=Math.min(a.width,a.height/2),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+a.height/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):b>=180&&270>b?c>=180&&270>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(a,b,c,d,e){if(!(this._outlineWidth<=0)){var f=Math.abs(b-c),g=this._center.x+Math.cos(b)*this._innerRadiusByPixel,h=this._center.y+Math.sin(-b)*this._innerRadiusByPixel,i=this._center.x+Math.cos(b)*this._outerRadius,j=this._center.y+Math.sin(-b)*this._outerRadius,k=this._center.x+Math.cos(c)*this._innerRadiusByPixel,l=this._center.y+Math.sin(-c)*this._innerRadiusByPixel,m=this._center.x+Math.cos(c)*this._outerRadius,n=this._center.y+Math.sin(-c)*this._outerRadius;this._clockwise?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,c,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(g,h),a.stroke(),a.beginPath(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,b,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(m,n),a.stroke()):(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,b,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(k,l),a.stroke(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,c,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(i,j),a.stroke())}},_drawArcGroup:function(a,b,c,d){0!=this._outerBrighterRadiusByPixel&&this._drawArc(a,b,c,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,Vb.brighter(d)),this._drawArc(a,b,c,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,d),0!=this._innerDarkerRadiusByPixel&&this._drawArc(a,b,c,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,Vb.darker(d,20))},_drawArc:function(a,b,c,d,e,f){var g=Math.abs(b-c);a.lineWidth=0,a.fillStyle=f;var h=this._center.x+Math.cos(b)*d,i=this._center.y+Math.sin(-b)*d,j=(this._center.x+Math.cos(b)*e,this._center.y+Math.sin(-b)*e,this._center.x+Math.cos(c)*d),k=this._center.y+Math.sin(-c)*d;this._center.x+Math.cos(c)*e,this._center.y+Math.sin(-c)*e,a.beginPath(),this._clockwise?(a.moveTo(j,k),Vb.drawArc(a,this._center.x,this._center.y,c,g,e,e,!0),a.lineTo(h,i),Vb.drawArc(a,this._center.x,this._center.y,b,-g,d,d,!0),a.closePath()):(a.moveTo(h,i),Vb.drawArc(a,this._center.x,this._center.y,b,g,e,e,!0),a.lineTo(j,k),Vb.drawArc(a,this._center.x,this._center.y,c,-g,d,d,!0),a.closePath()),a.fill()},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f=this._scaleInside?{x:b-d/2,y:c}:{x:b+d/2,y:c}),180==a&&(f=this._scaleInside?{x:b+d/2,y:c}:{x:b-d/2,y:c}),90==a&&(f=this._scaleInside?{x:b,y:c+e/2}:{x:b,y:c-e/2}),270==a&&(f=this._scaleInside?{x:b,y:c-e/2}:{x:b,y:c+e/2}),a>270&&360>a&&(f=this._scaleInside?{x:b-d/2,y:c-e/2}:{x:b+d/2,y:c+e/2}),a>180&&270>a&&(f=this._scaleInside?{x:b+d/2,y:c-e/2}:{x:b-d/2,y:c+e/2}),a>90&&180>a&&(f=this._scaleInside?{x:b+d/2,y:c+e/2}:{x:b-d/2,y:c-e/2}),a>0&&90>a&&(f=this._scaleInside?{x:b-d/2,y:c+e/2}:{x:b+d/2,y:c-e/2}),f}}),Gb.charts.RadarChart=function(a){Gb.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Hb.ext("twaver.charts.RadarChart",Gb.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:Dd.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:Dd.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:Dd.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:Dd.RADARCHART_SCALE_TEXT_VISIBLE,
_scaleTextFont:Dd.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:Dd.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:Dd.RADARCHART_AXIS_VISIBLE,_axisLineColor:Dd.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:Dd.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:Dd.RADARCHART_AXIS_START_ANGLE,_ringVisible:Dd.RADARCHART_RING_VISIBLE,_ringType:Dd.RADARCHART_RING_TYPE,_ringLineColor:Dd.RADARCHART_RING_LINE_COLOR,_ringLineWidth:Dd.RADARCHART_RING_LINE_WIDTH,_scaleCount:Dd.RADARCHART_SCALE_COUNT,_scaleMaxValue:Dd.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:Dd.RADARCHART_SCALE_MINVALUE,_anchorVisible:Dd.RADARCHART_ANCHOR_VISIBLE,_areaFill:Dd.RADARCHART_AREA_FILL,_areaFillAlpha:Dd.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:Dd.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(a,b){return a.toFixed(2)},getAnchorSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):Gb.Styles.getStyle("chart.marker.size")},getAnchorShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):Gb.Styles.getStyle("chart.marker.shape")},getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):Gb.Styles.getStyle("chart.line.width")},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},tryGetDataAt:function(a,b){if((null==b||0>b)&&(b=this._selectTolerance),a.target&&(a=Ub.getLogicalPoint(this._canvas,arguments[0],1)),!a)return null;if(!this._areaFill){var c=a.x-b,d=a.y-b,e=2*b+1,f=2*b+1;try{for(var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data,h=0,i=g.length;i>h;h+=4)if(255===g[h+3]){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null}if(!this._center)return null;a={x:a.x-this._xTranslate,y:a.y-this._yTranslate};for(var h=this._publishedDatas.size()-1;h>=0;h--){var k=this._publishedDatas.get(h),m=this._map[k.getId()],n=Rb.isPointInPolygon(m.points,a);if(n)return k}return null},getDataAt:function(){var a,b;if(2===arguments.length)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=Ub.getLogicalPoint(this._canvas,arguments[0],1);if(!c)return;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;if(0>a||0>b||a>this._canvasWidth||b>this._canvasHeight)return null;if(!this._areaFill){try{var d=this._canvas.getContext("2d").getImageData(a,b,1,1).data;if(255===d[3]){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null}for(var h=this._publishedDatas.size()-1;h>=0;h--){var f=this._publishedDatas.get(h),i=this._map[f.getId()],j=Rb.isPointInPolygon(i.points,{x:a-this._xTranslate,y:b-this._yTranslate});if(j)return f}return null},validateModel:function(){if(this._map={},this._axisTexts=new md,this._axisMaxValues=new md,this._axisMinValues=new md,this._axisRangeValues=new md,this._axisCount=null==this._axisList?0:this._axisList.size(),0!=this._axisCount){this._averageAngleByRadian=2*Math.PI/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(a){if("string"==typeof a)this._axisTexts.add(a),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(a.text);var b=isNaN(a.max)?this._scaleMaxValue:a.max,c=isNaN(a.min)?this._scaleMinValue:a.min;this._axisMaxValues.add(b),this._axisMinValues.add(c),this._axisRangeValues.add(b-c)}},this),this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a)),c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getAnchorShape(a),anchorSize:this.getAnchorSize(a),lineWidth:this.getLineWidth(a),points:new md};this.isSelected(a)&&(c.lineWidth+=2),this._map[a.getId()]=c},this);for(var a=0;a<this._axisCount;a++)this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=0;if(c.values.size()>a){var e=c.values.get(a),f=this._axisMinValues.get(a),g=this._axisRangeValues.get(a);g>0&&(d=(e-f)/g)}c.proportions.add(d)},this)}},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),!(d.width<=0||d.height<=0||this._axisCount<3)){var e=0,f=0,g=0,h=null,i=null,j=null,k=null;if(this._axisTextVisible)for(k=new md,g=0;g<this._axisCount;g++)j=this._axisTexts.get(g),h=this.getTextSize(this._axisTextFont,j),k.add({text:j,size:h}),h.width>e&&(e=h.width),h.height>f&&(f=h.height);var l=d.width/2-e>d.height/2-f?d.height/2-2*f:d.width/2-e,m={x:d.x+d.width/2,y:d.y+d.height/2};this._center={x:m.x+this._xTranslate,y:m.y+this._yTranslate};var n=null;this._scaleTextVisible&&(n=new md);var o=this._axisStartAngle/180*Math.PI;for(g=0;g<this._axisCount;g++){var p=180*o/Math.PI,q=m.x+Math.cos(o)*l,r=m.y+Math.sin(-o)*l,s=null;n&&(s=new md,n.add(s)),this._ringVisible&&this._ringLineWidth>0&&(a.lineWidth=this._ringLineWidth,a.strokeStyle=this._ringLineColor);for(var t=1;t<=this._scaleCount;t++){var u=t/this._scaleCount,v=l*u,w=m.x+Math.cos(o)*v,x=m.y+Math.sin(-o)*v;if(this._ringVisible&&this._ringLineWidth>0){var y=m.x+Math.cos(o+this._averageAngleByRadian)*v,z=m.y+Math.sin(-o-this._averageAngleByRadian)*v;"line"==this._ringType?this.drawLine(a,this._ringLineColor,this._ringLineWidth,w,x,y,z):"arc"==this._ringType&&(a.beginPath(),a.moveTo(m.x,m.y),Vb.drawArc(a,m.x,m.y,o,this._averageAngleByRadian,v,v,!0),a.closePath(),a.stroke())}s&&(j=this.formatScaleText(this._axisMinValues.get(g)+this._axisRangeValues.get(g)*u,g),h=this.getTextSize(this._scaleTextFont,j),i=this.getScaleTextPosition(p,w,x,h.width,h.height),s.add({text:j,x:i.x,y:i.y}))}if(this._axisVisible&&this.drawLine(a,this._axisLineColor,this._axisLineWidth,m.x,m.y,q,r),k){var A=k.get(g);i=this.getAxisTextPosition(p,q,r,A.size.width,A.size.height),A.x=i.x,A.y=i.y}o+=this._averageAngleByRadian}this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.points.clear();var d=c.anchorSize>0?new md:null,e=c.proportions;if(a.lineWidth=0,a.globalAlpha=this.isSelected(b)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(a.fillStyle=c.color),this._drawItem(a,e,m,l,d,c),this._areaFill&&a.fill(),a.lineWidth=c.lineWidth,a.strokeStyle=c.color,a.globalAlpha=1,this._drawItem(a,e,m,l),a.lineWidth=0,null!=d&&d.size()>0){var f=c.anchorSize/2;d.forEach(function(b){a.fillStyle=c.color,Vb.drawVector(a,c.anchorShape,null,b.x-f,b.y-f,c.anchorSize,c.anchorSize),a.fill()})}},this),n&&n.forEach(function(b){b.forEach(function(b){Vb.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this)},this),k&&k.forEach(function(b){Vb.drawText(a,b.text,b,this._axisTextFont,this._axisTextColor)},this)}},_drawItem:function(a,b,c,d,e,f){var g=this._axisStartAngle/180*Math.PI,h=null;a.beginPath();for(var i=0;i<this._axisCount;i++){var j=b.get(i),k={x:c.x+Math.cos(g)*d*j,y:c.y+Math.sin(-g)*d*j};null==h?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),null!=e&&this._anchorVisible&&e.add(k),f&&f.points.add(k),0==i&&(h=k),g+=this._averageAngleByRadian}null!=h&&a.lineTo(h.x,h.y),a.closePath(),a.stroke()},getAxisTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f={x:b+d/2,y:c}),180==a&&(f={x:b-d/2,y:c}),90==a&&(f={x:b,y:c-e/2}),270==a&&(f={x:b,y:c+e/2}),a>270&&360>a&&(f={x:b+d/2,y:c+e/2}),a>180&&270>a&&(f={x:b-d/2,y:c+e/2}),a>90&&180>a&&(f={x:b-d/2,y:c-e/2}),a>0&&90>a&&(f={x:b+d/2,y:c-e/2}),f},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f={x:b,y:c+e/2}),180==a&&(f={x:b-d/2,y:c+e/2}),90==a&&(f={x:b+d/2,y:c}),270==a&&(f={x:b+d/2,y:c}),a>270&&360>a&&(f={x:b+d/2,y:c-e/2}),a>180&&270>a&&(f={x:b-d/2,y:c-e/2}),a>90&&180>a&&(f={x:b-d/2,y:c+e/2}),a>0&&90>a&&(f={x:b+d/2,y:c+e/2}),f}}),Gb.charts.LegendPane=function(a){Gb.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new Gb.Pool("div"),this._iconPool=new Gb.Pool("div"),this._textPool=new Gb.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=a,this._chart.addViewListener(this.handleViewChange,this),this._view=Ub.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=Ub.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var b=this;this._chart._internalVisibleFunction=function(a){return!b.isHidden(a)},Ob.isTouchable&&new Gb.charts.LegendPaneTouchInteraction(this),new Gb.charts.LegendPaneInteraction(this)},Hb.ext("twaver.charts.LegendPane",Gb.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:Dd.LEGENDPANE_ICON_WIDTH,_iconHeight:Dd.LEGENDPANE_ICON_HEIGHT,_iconRadius:Dd.LEGENDPANE_ICON_RADIUS,_rowHeight:Dd.LEGENDPANE_ROW_HEIGHT,_orientation:Dd.LEGENDPANE_ORIENTATION,_hiddenColor:Dd.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:Dd.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:Dd.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(a){this.invalidate()},getChart:function(){return this._chart},isHidden:function(a){return null!=this._hiddenMap[a.getId()]},handleViewChange:function(a){"validateEnd"===a.kind&&(this._invalidate=!0,this.validate())},validate:function(){if(this._invalidate){this._invalidate=!1,Ub.release(this._legendDiv),Hb.keys(this._hiddenMap).forEach(function(a){this._chart.getDataBox().containsById(a)||delete this._hiddenMap[a]},this);for(var a=new md(this._chart.getUnfilteredDatas()),b=0;b<a.size();b++){var c=a.get(b);this._chart.isVisible(c)||this.isHidden(c)||(a.removeAt(b),b--)}var d=a.size(),e=this._view.style,f="horizontal"===this._orientation;for(f?(e.textAlign="center",e.height=this._rowHeight+"px"):(e.textAlign="",e.height=this._rowHeight*d+"px"),e.lineHeight=this._rowHeight-2+"px",b=0;d>b;b++){var c=a.get(b),g=this._divPool.get();g._data=c,g.style.cursor="pointer",g.style.height=this._rowHeight+"px",g.style.display=f?"inline-block":"block",this._legendDiv.appendChild(g),this.renderLegend(g,c),this.onLegendRendered(g,c)}this._pools.forEach(function(a){a.clear()})}},renderLegend:function(a,b){var c=!this.isHidden(b),d=this._chart.isSelected(b),e=this._iconPool.get(),f=e.style;f.display="inline-block",f.verticalAlign="middle",f.marginLeft="4px",f.width=this.getIconWidth()+"px",f.height=this.getIconHeight()+"px",f.backgroundColor=c?this._chart.getColor(b):this.getHiddenColor(),a.appendChild(e);var g=this._textPool.get();f=g.style,f.paddingLeft="2px",f.paddingRight="4px",f.display="inline-block",f.verticalAlign="middle",f.color=c?d?this._selectForegroundColor:"":this.getHiddenColor(),g.innerHTML=this._chart.getName(b),a.appendChild(g),a.style.backgroundColor=c&&d?this._selectBackgroundColor:""},onLegendRendered:function(a,b){}}),Gb.charts.ChartPane=function(a,b,c,d){Gb.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=a,this._legendPane=new Gb.charts.LegendPane(a),this._titleDiv=Ub.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=Ub.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var e=this;this._legendPane.addPropertyChangeListener(function(a){("rowHeight"===a.property||"orientation"===a.porperty)&&e.invalidate()}),arguments.length>1&&this.setTitle(b),arguments.length>2&&this.setLegendOrientation(c),arguments.length>3&&this.setLegendWidth(d)},Hb.ext("twaver.charts.ChartPane",Gb.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:Dd.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:Dd.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:Dd.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:Dd.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(a){if(this._legendOrientation!==a){var b=this._legendOrientation;this._legendOrientation=a,this.firePropertyChange("orientation",b,a),this._adjustLegendOrientation()}},_adjustLegendOrientation:function(){this._legendPane.setOrientation("left"===this._legendOrientation||"right"===this._legendOrientation?"vertical":"horizontal")},onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var a,b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._legendPane.getRowHeight();this._title&&""!==this._title?(a=this._titleHeight,this._titleDiv.innerHTML=this._title):(a=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var e=this._titleDiv.style;e.left="0px",e.top="0px",e.width=b+"px",e.height=a+"px";var f,g;"bottom"===this._legendOrientation?(f={x:0,y:a,width:b,height:Math.max(c-a-d,0)},g={x:0,y:Math.max(c-d,0),width:b,height:d}):"right"===this._legendOrientation?(f={x:0,y:a,width:Math.max(b-this._legendWidth,0),height:Math.max(c-a,0)},g={x:Math.max(b-this._legendWidth,0),y:a,width:this._legendWidth,height:Math.max(c-a,0)}):"top"===this._legendOrientation?(f={x:0,y:a+d,width:b,height:Math.max(c-a-d,0)},g={x:0,y:a,width:b,height:d}):"left"===this._legendOrientation&&(f={x:this._legendWidth,y:a,width:Math.max(b-this._legendWidth,0),height:Math.max(c-a,0)},g={x:0,y:a,width:this._legendWidth,height:Math.max(c-a,0)}),f&&this._chart.adjustBounds(f),g&&this._legendPane.adjustBounds(g)}}),Gb.charts.ChartInteraction=function(a){this.chart=a,this.canvas=a._canvas;var b=this;this.canvas.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a),a.preventDefault()},!1);var c=Ob.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},Hb.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(a){this.chart.isFocusOnClick()&&Gb.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(a);var b=this.chart.tryGetDataAt(a);2===a.detail&&null==b?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=Ub.getClientPoint(a),Ub.handle_mousedown(this,a))},handleMouseMove:function(a){if(this.lastPoint){var b={x:this._startLogical.x+a.clientX-this._startClient.x,y:this._startLogical.y+a.clientY-this._startClient.y};!this.startPan&&Rb.getDistance(this.lastPoint,b)>3&&(this.startPan=!0,this.lastPoint=b),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.lastPoint.y),this.lastPoint=b)}},handleMouseUp:function(a){if(!this.startPan&&1===a.detail){var b=this.chart.tryGetDataAt(a),c=this.chart.getSelectionModel();b?Hb.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):Hb.isCtrlDown(a)||c.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(a){Ub.preventDefault(a);var b=Ob.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>b&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),Gb.charts.ChartTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,Ub.addEventListener("touchstart","handleTouchstart",this.canvas,this)},Hb.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.chart.isFocusOnClick()&&Gb.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.canvas,this),Ub.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(a){if(Ub.preventDefault(a),this.endPoint){var b=this.chart.getLogicalPoint(a);if(!this.moved&&Rb.getDistance(this.endPoint,b)>10&&(this.moved=!0,this.lastPoint=b),this.moved)if(yc.isSingleTouch(a))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.endPoint.y),this.endPoint=b);else if(this.distance){var c=yc.getDistance(a)/this.distance,d=this.xZoom*c,e=this.yZoom*c;this.chart.isXZoomEnabled()&&this.chart.setXZoom(d,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(e,!1)}}},handleTouchend:function(a){if(Ub.preventDefault(a),!this.moved){this.endPoint=this.chart.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var c=this.chart.tryGetDataAt(a);if(b&&null==c)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var d=this.chart.getSelectionModel();c?d.contains(c)||d.setSelection(c):d.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,Ub.removeEventListener("touchmove",this.canvas,this),Ub.removeEventListener("touchend",this.canvas,this)}}),Gb.charts.ChartMSTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.canvas,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.canvas,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.canvas,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.canvas,this);var b=Ob.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(b,function(a){self.handleMouseWheel(a)},!1)},Hb.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(a){this.chart.isFocusOnClick()&&Gb.Util.setFocus(this.canvas);var b=this.chart.getLogicalPoint(a);a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&b&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);var c=this.chart.tryGetDataAt(a);if(1==this._pointerIdArray.length&&b){var d=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=10;d&&null==c?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=b,this._startTouchTime=new Date,this._startClientPoint={x:a.clientX,y:a.clientY},Ub.handle_mousedown(this,a))}else 2==this._pointerIdArray.length&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=3)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance,c=this.xZoom*b,d=this.yZoom*b;this.chart.isXZoomEnabled()&&this.chart.setXZoom(c,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(d,!1)}},handleTouchend:function(a){var b=this.chart.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b&&!this.moved){var c=this.chart.tryGetDataAt(a),d=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=10,e=this.chart.getSelectionModel();c&&d?Hb.isCtrlDown(a)?e.contains(c)?e.removeSelection(c):e.appendSelection(c):e.contains(c)||e.setSelection(c):Hb.isCtrlDown(a)||e.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(a){Ub.preventDefault(a);var b=Ob.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>b&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(a){if(1==this._pointerIdArray.length&&this._startTouchPoint&&this._startClientPoint){var b={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.chart.getYZoom()};Rb.getDistance(this._startTouchPoint,b)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this._startTouchPoint.y),this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY)}},handle_mouseup:function(a){this.handleTouchend(a)},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.charts.LegendPaneInteraction=function(a){this.legendPane=a;var b=this;this.legendPane._legendDiv.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1)},Hb.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(a){if(0===a.button){var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}}),Gb.charts.LegendPaneTouchInteraction=function(a){this.legendPane=a,Ub.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},Hb.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a);var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),Gb.network.Network=function(a){Gb.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new md,this._view=Ub.createView("auto"),this._rootDiv=Ub.createDiv(),this._topDiv=Ub.createDiv(),this._attachmentDiv=Ub.createDiv(),this._layersDiv=Ub.createDiv(),this._bottomDiv=Ub.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(a?a:new Gb.ElementBox),Ob.isTouchable?Ob.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1);var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Gb.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.drawBody()})}},this.setToolTipEnabled(Dd.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(a){mc.twm(b)}),this.addPropertyChangeListener(function(a){"zoom"===a.property&&mc.twm(b)}),Gb.imageUtil.addEventListener(this.invalidateElementUIs,this)},Hb.ext("twaver.network.Network",Gb.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:Dd.NETWORK_SELECT_MODE,_noAgentLinkVisible:Dd.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:Dd.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Dd.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:Dd.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:Dd.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:Dd.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:Dd.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:Dd.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Dd.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Dd.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Dd.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Dd.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:Dd.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:Dd.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Dd.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Dd.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:Dd.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Dd.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Dd.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Dd.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Dd.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:Dd.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Dd.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Dd.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Dd.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Dd.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Dd.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:Dd.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Dd.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Dd.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Dd.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Dd.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Dd.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Dd.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Dd.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Dd.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Dd.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Dd.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Dd.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Dd.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Dd.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Dd.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Dd.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Dd.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Dd.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Dd.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Gb.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(a){return a.getStyle("network.label")||a.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Ac.showToolTip({x:a.pageX,y:a.pageY},d);var e=Ac.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Mb.documentElement.scrollLeft||Mb.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Mb.documentElement.scrollTop||Mb.body.scrollTop)+"px")}}else Ac.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){if(mc.twm(this),this.__lics__){var a=0,b=null,c=null,d=null,e=this._invalidateElementVisibility;if(this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(e){e.validate();var f=e.getElement();if(e.setVisible(this.isVisible(f)),this._removeElementUIOnInvisible){if(b=this.getLayerDivByElement(f),e.isVisible()){if(e.getView().parentNode!==b)for(b.appendChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}else if(e.getView().parentNode===b)for(b.removeChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(d.getView())}else if(!e.getView().parentNode)for(b=this.getLayerDivByElement(f),b.appendChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())},null,this)),this._invalidateElementIndex){this._invalidateElementIndex=!1;var f,g=this;this._box.getLayerBox().forEachByDepthFirst(function(a){var b,c=g._layerMap[a.getId()];g._box.forEachByLayer(function(a){var d=g._elementUIMap[a.getId()];if(d&&d.getView().parentNode===c){b=Ub.insertAfter(d.getView(),b);for(var e=d.getAttachments(),h=0;h<e.size();h++){
var i=e.get(h);i.getView().parentNode===g._attachmentDiv&&(f=Ub.insertAfter(i.getView(),f))}}},a)})}if(e&&!this._invalidateElementVisibility){var h;for(var i in this._elementUIMap){var j=this._elementUIMap[i];j.isVisible()&&(h=Rb.unionRect(h,j.getViewRect()))}if(h=h?{x:0,y:0,width:h.x+h.width,height:h.y+h.height}:{x:0,y:0,width:0,height:0},h.x!==this._viewRect.x||h.y!==this._viewRect.y||h.width!==this._viewRect.width||h.height!==this._viewRect.height){var k=this._viewRect;this._viewRect=h,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=h.width+"px",this._rootDiv.style.height=h.height+"px",this.firePropertyChange("viewRect",k,h)}}}},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(uc.getSubNetwork(this._currentSubNetwork),a,b)},sendToTop:function(a){if(this.isVisible(a)){for(var b=a;this.isVisible(b.getParent())&&(b=b.getParent()););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){Ub.clear(this._layersDiv),Ub.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var a=this;this._box.getLayerBox().forEachByDepthFirst(function(b){var c=Ub.createDiv();Ub.setVisible(c,b.isVisible()),a._layerMap[b.getId()]=c,a._layersDiv.appendChild(c),a._layerList.add(b)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){var d=Gb.animate.AnimateManager;if(d.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";d.start(new Gb.animate.AnimateSubNetwork(this,a,c))}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility()}},isVisible:function(a){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(a))return!1;if(!this._box.getLayerBox().getLayerByElement(a).isVisible())return!1;if(uc.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof Gb.Link){if(!this.isNoAgentLinkVisible()){if(!a.getFromAgent()||!a.getToAgent())return!1;if(!this.isVisible(a.getFromAgent())||!this.isVisible(a.getToAgent()))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var b=a.getParent();b&&!b.ISubNetwork;){if(b instanceof Nd&&(!b.isExpanded()||!this.isVisible(b)))return!1;b=b.getParent()}return a.IDummy?!1:!0},isMovable:function(a){return this._box.contains(a)?a instanceof Gb.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isMovable():!1},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isEditable():!1},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return null==this._linkableFunction||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Gb.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",b,this._box)}},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},getElementUI:function(a){return a?this._elementUIMap[a.getId()]:null},getLayerDivByElement:function(a){var b=this._box.getLayerBox().getLayerByElement(a);return b?this._layerMap[b.getId()]:null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b)),b){var c=this.getLayerDivByElement(a);b.getView().parentNode!==c&&(c.appendChild(b.getView()),b.getAttachments().forEach(function(a){a.isShowInAttachmentDiv()&&a.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(a.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(a){if(a instanceof Gb.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},handleLayerBoxChange:function(a){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){var b=a.source;if("visible"===a.property){var c=this._layerMap[b.getId()];Ub.setVisible(c,b.isVisible())}else"editable"===a.property&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(a){var b;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(a){var c=this._layerMap[a.getId()];b=Ub.insertAfter(c,b),this._layerList.add(a)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this),this.invalidateElementVisibility();var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b))},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=uc.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Hb.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Nd&&e.setExpanded(!0);var f=b.getUnionBodyBounds();if(f){var g={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};Rb.intersects(g,f)||this.isVisible(a)&&Hb.callLater(this.centerByLogicalPoint,this,[f.x+f.width/2,f.y+f.height/2])}}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);if(c){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode===e&&e.removeChild(c.getView()),c.dispose(),delete this._elementUIMap[b.getId()]}b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===a.kind&&(this.forEachElementUI(function(a){a.dispose()}),this._elementUIMap={},this.updateLayers(),null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);if(c&&(c.handlePropertyChange(a),"layerId"===a.property)){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode!==e&&(e.appendChild(c.getView()),this.invalidateElementIndex())}this.invalidateBundleLink(b),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(a){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||this.updateLayers()}},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},getSelectColor:function(a){return a.getStyle("select.color")},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(a){var b=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=a,this.firePropertyChange("removeElementUIOnInvisible",b,a),this.invalidateElementVisibility()},setDefaultInteractions:function(a,b){var c=[new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.MoveInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)];b&&c.push(new Gb.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setPanInteractions:function(){this.setInteractions([new Gb.network.interaction.PanInteraction(this),new Gb.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(a,b){var c=[new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.EditInteraction(this,a),new Gb.network.interaction.MoveInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)];b&&c.push(new Gb.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setCreateElementInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateElementInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateLinkInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateShapeLinkInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateShapeNodeInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){var a=[new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.MoveInteraction(this,!1),new Gb.network.interaction.DefaultInteraction(this),new Gb.network.interaction.TouchInteraction(this)];this.setInteractions(a)},setMSTouchInteractions:function(){this.setInteractions([new Gb.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.MoveInteraction(this),new Gb.network.interaction.DefaultInteraction(this),new Gb.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Gb.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Ld){var f=this.getElementUI(e);f&&(b=Rb.unionRect(b,f.getViewRect()))}}return b},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getPosition:function(a,b,c,d,e){var f,g=b instanceof Gb.network.ElementUI?b:this.getElementUI(b);if(g)if("from"===a||"to"===a){if(g.getFromPosition&&(f="from"===a?g.getFromPosition(d,e):g.getToPosition(d,e)))return{x:f.x-c.width/2,y:f.y-c.height/2}}else f="hotspot"===a?g.getHotSpot():Tb.get(a,g.getBodyRect(),c);if(!f&&b.getRect&&(f=Tb.get(a,b.getRect(),c)),f)return{x:f.x+d,y:f.y+e};throw"position '"+a+"' object '"+b+"'"},getViewRect:function(){return this._viewRect?Hb.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(a,b,c){b?this._box.forEachReverse(function(d){if(this.getLayerByElement(d)===b){var e=this.getElementUI(d);e&&(c?a.call(c,e):a(e))}},this):this._layerList.forEachReverse(function(b){this.forEachElementUI(a,b,c)},this)},findFirstElement:function(a,b){for(var c=this._layerList.size()-1,d=this._box.size()-1,e=c;e>=0;e--)for(var f=this._layerList.get(e),g=d;g>=0;g--){var h=this._box.getDataAt(g);if(this.getLayerByElement(h)===f)if(b){if(a.call(b,h)===!0)return h}else if(a(h)===!0)return h}return null},getElementAt:function(a,b){if(1===arguments.length&&(b=!0),!this.isValidEvent(a))return null;a=this._getPoint(a),a||console.log("null");var c=a.x,d=a.y,e=this._selectionTolerance;if(e&&e>0){var f={x:c,y:d,width:0,height:0};Rb.grow(f,e,e)}return this.findFirstElement(function(a){if(b&&!this.isSelectable(a))return!1;var e=this.getElementUI(a);return e?f?!!e.intersectsTest(f):!!e.hitTest(c,d):!1},this)},_getPoint:function(a){return a?a.target?this.getLogicalPoint(a):a:null},getElementsAtRect:function(a,b,c,d){var e=new md;return d=void 0===d?!0:d,this.forEachElementUI(function(f){f.isVisible()&&(!c||c(f._element))&&(d&&this.isSelectable(f._element)||!d)&&(b?f.intersectsTest(a)&&e.add(f._element):Rb.contains(a,f.getViewRect())&&e.add(f._element))},null,this),e},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);return c?(a=this._getPoint(a),c.hitTest(a.x,a.y)):null},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Dd.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c){c||(c=Ub.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var d=c.getContext("2d");if(d.clearRect(0,0,a,b),0===this._view.clientWidth||0===this._view.clientHeight)return c;var e=a/this._view.scrollWidth*this._zoom,f=b/this._view.scrollHeight*this._zoom;return d.scale(e,f),Ub.forEach(this._view,function(a){if(("CANVAS"===a.tagName||"IMG"===a.tagName)&&!a._isIgnored){var b=a._viewRect;if(b)try{d.drawImage(a,b.x,b.y,b.width,b.height)}catch(a){}}}),c},toCanvasByRegion:function(a,b,c){c||(c=Ub.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e);var f=c.getContext("2d");return f.clearRect(0,0,d,e),0===this._view.clientWidth||0===this._view.clientHeight?c:(f.save(),f.scale(b,b),Ub.forEach(this._view,function(b){if(("CANVAS"===b.tagName||"IMG"===b.tagName)&&!b._isIgnored){var c=b._viewRect;if(c&&Rb.intersects(c,a))try{f.drawImage(b,c.x-a.x,c.y-a.y,c.width,c.height)}catch(b){}}}),f.restore(),c)},getGroupChildrenRects:function(a){var b=new md;return a.getChildren().forEach(function(a){if(a instanceof Ld){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){},setMovingElement:function(a){if(a!=this._movingElement){var b=this._movingElement;this._movingElement=a,this.firePropertyChange("movingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(a){if(a!=this._editingElement){var b=this._editingElement;this._editingElement=a,this.firePropertyChange("editingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){Gb.imageUtil.removeEventListener(this.invalidateElementUIs,this)}}),Gb.network.Overview=function(a){Gb.network.Overview.superClass.constructor.apply(this,arguments),this._view=Ub.createView(),this._rootDiv=Ub.createDiv(),this._imageCanvas=Ub.createCanvas(),this._imageDiv=Ub.createDiv(),this._maskCanvas=Ub.createCanvas(),this._selectDiv=Ub.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Ub.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a),Ob.isTouchable?Ob.isMSTouchable?new Gb.network.OverviewMSTouchInteraction(this):(new Gb.network.OverviewTouchInteraction(this),new Gb.network.OverviewInteraction(this)):new Gb.network.OverviewInteraction(this)},Hb.ext("twaver.network.Overview",Gb.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Dd.OVERVIEW_FILL_COLOR,_outlineColor:Dd.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Dd.OVERVIEW_OUTLINE_WIDTH,_selectColor:Dd.OVERVIEW_SELECT_COLOR,_selectWidth:Dd.OVERVIEW_SELECT_WIDTH,_padding:Dd.OVERVIEW_PADDING,_animate:Dd.OVERVIEW_ANIMATE,_maxPackingWidth:Dd.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Dd.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Ub.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Ub.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Hb.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Hb.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network._view.clientWidth&&0!==this._network._view.clientHeight){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Rb.grow(a,-this._padding,-this._padding);var c=Math.min(a.width/this._network._view.scrollWidth,a.height/this._network._view.scrollHeight);b&&(Ub.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var d=this._network._view.scrollWidth*c,e=this._network._view.scrollHeight*c,f=a.x+(a.width-d)/2,g=a.y+(a.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),Ub.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network._view.scrollLeft*c,y:this._network._view.scrollTop*c,width:d*this._network._view.clientWidth/this._network._view.scrollWidth,height:e*this._network._view.clientHeight/this._network._view.scrollHeight},j=Ub.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,j.beginPath(),Vb.drawVector(j,"rectangle",null,f,g,d,e),j.fill(),j.clearRect(f+i.x,g+i.y,i.width,i.height);var k=this._outlineWidth<0?0:this._outlineWidth;j.lineWidth=k,j.strokeStyle=this._outlineColor,j.beginPath(),Vb.drawVector(j,"rectangle",null,f+i.x+k,g+i.y+k,i.width-2*k,i.height-2*k),k>=0&&j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Rb.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network._view.scrollWidth/this._network.getZoom(),(a.y-c.y)/c.height*this._network._view.scrollHeight/this._network.getZoom(),b),this._invalidateMask())}}),Gb.network.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.network.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(Ub.preventDefault(a),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),yc.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=yc.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Gb.network.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("mousedown","handleMousedown",this.view,this)},Hb.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(a){0===a.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Hb.isCtrlDown(a)&&(this.startPoint=this.endPoint,Ub.setVisible(this.overview._selectDiv,!0)),Ub.addEventListener("mousemove","handleMousemove",this.view,this),Ub.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f),h=this.network._view.scrollWidth/this.network.getZoom()*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network._view.scrollHeight/this.network.getZoom()*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);this.network.setZoom(g*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),Hb.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Ub.setVisible(this.overview._selectDiv,!1),Ub.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Ub.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("mousemove",this.view,this),Ub.removeEventListener("mouseup",this.view,this))}}),Gb.network.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Hb.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.network.ElementUI=function(a,b){this._view=Ub.createDiv(),this._bodyView=Ub.createDiv(),this._view.appendChild(this._bodyView),this._network=a,this._element=b,this._attachments=new md,this._bodyBounds=new md,this.invalidate(!0)},Hb.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);
return b?b:Dd.FONT},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?Hb.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},getUnionBodyBounds:function(){return Hb.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Hb.clone(this._bodyRect)},invalidate:function(a){void 0===a&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateMeasure:function(){},validate:function(){if(this._invalidateFlag){this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),Ub.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var a=this._element.getStyle("whole.alpha");this._view.style.opacity=a,this._attachments.forEach(function(b){b.updateMeasure();var c=b.getAlpha();b._view.style.opacity=b.isShowInAttachmentDiv()?c*a:c});var b;this._bodyBounds.forEach(function(a){b=Rb.unionRect(b,a)}),this._unionBodyBounds=Hb.clone(b),this._attachments.forEach(function(a){b=Rb.unionRect(b,a.getViewRect())}),this._viewRect=b}},cleanUp:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=this[d];e&&!e.parentNode&&(this[d]=null)}},setVisible:function(a){this.isVisible()!==a&&(Ub.setVisible(this._view,a),this._attachments.forEach(function(b){b.isShowInAttachmentDiv()&&Ub.setVisible(b._view,a)}),this.invalidate(!0))},isVisible:function(){return Ub.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Gb.network.LabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Gb.network.AlarmAttachment(this,Dd.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Gb.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new Gb.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(a){a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose()}),this._attachments.clear()},addAttachment:function(a){this._attachments.add(a),a.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(a.getView()):this._view.appendChild(a.getView()),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose(),this.invalidate(!1)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},addComponent:function(a){this._bodyView.appendChild(a)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return Hb.clone(this._viewRect)},setShadow:function(a,b,c){var d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;d&&(this._shadowXOffset>0?c.width+=this._shadowXOffset:(c.x+=this._shadowXOffset,c.width+=-this._shadowXOffset),this._shadowYOffset>0?c.height+=this._shadowYOffset:(c.y+=this._shadowYOffset,c.height+=-this._shadowYOffset),Rb.grow(c,this._shadowBlur,this._shadowBlur));var e=Ub.setCanvas(b,c);return d&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},hit:function(a,b){return!1},hitCanvas:function(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],g=this[f];if(Vb.hit(g,a,b,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],g=this[f];if(g&&Rb.containsPoint(g._viewRect,a,b))return!0}return!1},hitTest:function(a,b){if(!this.isVisible()||!Rb.containsPoint(this._viewRect,a,b))return null;var c,d,e=this._attachments.size();for(c=e-1;c>=0;c--)if(d=this._attachments.get(c),d.isShowInAttachmentDiv()&&d.hit(a,b))return d;for(c=e-1;c>=0;c--)if(d=this._attachments.get(c),!d.isShowInAttachmentDiv()&&d.hit(a,b))return d;return Rb.containsPoint(this._unionBodyBounds,a,b)&&this.hit(a,b)?this:null},intersects:function(a){return!1},intersectsComponent:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this[e];if(f&&Rb.intersects(f._viewRect,a))return!0}return!1},intersectsCanvas:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this[e];if(Vb.intersects(f,a))return!0}return!1},intersectsTest:function(a){if(!this.isVisible()||!Rb.intersects(this._viewRect,a))return null;var b,c,d=this._attachments.size();for(b=d-1;b>=0;b--)if(c=this._attachments.get(b),c.isShowInAttachmentDiv()&&c.intersects(a))return c;for(b=d-1;b>=0;b--)if(c=this._attachments.get(b),!c.isShowInAttachmentDiv()&&c.intersects(a))return c;return Rb.intersects(this._unionBodyBounds,a)&&this.intersects(a)?this:null}}),Gb.network.Attachment=function(a,b){this._view=Ub.createDiv(),this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._isShowInAttachmentDiv=b===!0,this._isShowInAttachmentDiv&&Ub.setVisible(this._view,a.isVisible())},Hb.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return Hb.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(a,b){return Rb.containsPoint(this._viewRect,a,b)},intersects:function(a){return Rb.intersects(this._viewRect,a)}}),Gb.network.BasicAttachment=function(a,b){Gb.network.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=Ub.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},Hb.ext("twaver.network.BasicAttachment",Gb.network.Attachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+2*c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if("aboveleft"===k)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("aboveright"===k)i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("belowleft"===k)i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("belowright"===k)i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("leftabove"===k)i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("leftbelow"===k)i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("rightabove"===k)i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("rightbelow"===k)i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("above"===k)i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if("below"===k)i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if("left"===k)i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();0!=m&&Rb.grow(i,m,m),m=this.getPaddingLeft(),0!=m&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),0!=m&&(i.width+=m),m=this.getPaddingTop(),0!=m&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),0!=m&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},updateMeasure:function(){Gb.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var a=this.isFill(),b=this.getOutlineWidth();this._viewRect=Rb.getRect(this._pointers),this._viewRect=Rb.unionRect(this._viewRect,this._roundRect),b>0&&Rb.grow(this._viewRect,b/2,b/2);var c=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if((b>0||a)&&(c.beginPath(),Vb.drawRoundRect(c,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(c.moveTo(this._pointers[0].x,this._pointers[0].y),c.lineTo(this._pointers[1].x,this._pointers[1].y),c.lineTo(this._pointers[2].x,this._pointers[2].y)),c.closePath(),b>0&&(c.lineWidth=b,c.strokeStyle=this.getOutlineColor(),c.lineCap=this.getCap(),c.lineJoin=this.getJoin(),c.stroke()),a)){var d=this.getFillColor(),e=this.getGradient();e?Vb.fill(c,d,e,this.getGradientColor(),this._viewRect):c.fillStyle=d,c.fill()}return c},getRoundRect:function(){return Hb.clone(this._roundRect)},getContentRect:function(){return Hb.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(a){this._content!==a&&(this._content&&this._view.removeChild(this._content),this._content=a,a&&this._view.appendChild(a))},getContentWidth:function(){return Dd.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Dd.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Dd.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Dd.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Dd.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Dd.ATTACHMENT_POSITION},getXOffset:function(){return Dd.ATTACHMENT_XOFFSET},getYOffset:function(){return Dd.ATTACHMENT_YOFFSET},getPadding:function(){return Dd.ATTACHMENT_PADDING},getPaddingLeft:function(){return Dd.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Dd.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Dd.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Dd.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Dd.ATTACHMENT_DIRECTION},isFill:function(){return Dd.ATTACHMENT_FILL},getFillColor:function(){return Dd.ATTACHMENT_FILL_COLOR},getGradient:function(){return Dd.ATTACHMENT_GRADIENT},getGradientColor:function(){return Dd.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Dd.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Dd.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Dd.ATTACHMENT_CAP},getJoin:function(){return Dd.ATTACHMENT_JOIN},isShadowable:function(){return Dd.ATTACHMENT_SHADOWABLE},hit:function(a,b){return Rb.containsPoint(this._viewRect,a,b)?Rb.containsPoint(this._contentRect,a,b)?!0:Vb.hit(this._attachmentCanvas,a,b):!1},intersects:function(a){return Rb.intersects(this._viewRect,a)?Rb.intersects(this._contentRect,a)?!0:Vb.intersects(this._attachmentCanvas,a):!1}}),Gb.network.LabelAttachment=function(a,b){Gb.network.LabelAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.LabelAttachment",Gb.network.BasicAttachment,{updateMeasure:function(){var a,b=this.getFont("label.font"),c=this.getLabel(),d=Hb.g.getTextSize(b,c),e=this.getMaxLength();0!==e&&d.width>e?(a=Hb.g.getCollapseTextInLength(b,c,e),this._textSize=Hb.g.getTextSize(b,a)):(a=c,this._textSize=d);var f=Gb.network.LabelAttachment.superClass.updateMeasure.call(this),g=this._element.getStyle("label.align");Vb.drawText(f,a,this._contentRect,b,this.getStyle("label.color"),g)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Gb.network.AlarmAttachment=function(a,b){Gb.network.AlarmAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.AlarmAttachment",Gb.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._textSize=Vb.getTextSize(a,b),this._fillColor=this._network.getAlarmFillColor(this._element);var c=Gb.network.AlarmAttachment.superClass.updateMeasure.call(this);Vb.drawText(c,b,this._contentRect,a,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Gb.network.LinkHandlerAttachment=function(a,b){Gb.network.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.LinkHandlerAttachment",Gb.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("link.handler.font"),b=this._network.getLinkHandlerLabel(this._element);this._textSize=Vb.getTextSize(a,b);var c=Gb.network.LabelAttachment.superClass.updateMeasure.call(this);Vb.drawText(c,b,this._contentRect,a,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Gb.network.EditAttachment=function(a,b){Gb.network.EditAttachment.superClass.constructor.call(this,a,b),this._attachmentDiv=Ub.createDiv(),this._view.appendChild(this._attachmentDiv)},Hb.ext("twaver.network.EditAttachment",Gb.network.Attachment,{updateMeasure:function(){Gb.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof Ld&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Ld)||this._element instanceof Gb.ShapeNode||this._element instanceof Gb.Grid||this._element instanceof Gb.Group||this._addRotatePoint(this._element),this._element instanceof Gb.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Gb.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof Gb.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(a){var b=this._network.getRotatePointSize();if(!(0>=b)){var c=a.getOriginalRect();if(!this._rotateDiv){var d=Ub.createDiv();this._attachmentDiv.appendChild(d),this._rotateDiv=d}var e,f=this._network.getRotatePointOutlineWidth(),g=this._network.getRotatePointOutlineColor(),h=this._network.getRotatePointFillColor(),b=this._network.getRotatePointSize(),i=2*b,j={x:c.x+c.width/2-b,y:c.y-this._network.getRotatePointOffset()-i,width:i,height:i};e=0==a.angle?j:this._getRotateRect(j,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2});var k=Rb.unionRect(a.getRect(),e);this._viewRect=Rb.unionRect(k,this._viewRect),Ub.setDiv(this._rotateDiv,j,h,f,g),this._rotateDiv._viewRect=e,Ub.setBorderRaidus(this._rotateDiv,i+"px"),this._rotateAttachments(this._rotateDiv,i/2,f)}},_addResizingPoint:function(a){var b=this._network.getResizePointSize();if(!(0>=b)){var c=a.getOriginalRect(),d=new md([{x:c.x,y:c.y},{x:c.x+c.width/2,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x,y:c.y+c.height/2},{x:c.x+c.width,y:c.y+c.height/2},{x:c.x,y:c.y+c.height},{x:c.x+c.width/2,y:c.y+c.height},{x:c.x+c.width,y:c.y+c.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var e=0;8>e;e++){var f=Ub.createDiv();this._attachmentDiv.appendChild(f),this._resizeDivs[e]=f}}if(this._resizeDivs){this._resizeRects=new Array;for(var e=0;8>e;e++){var g,h=d.get(e),i={x:h.x-b,y:h.y-b,width:2*b,height:2*b};g=0==a.getAngle()?i:this._getRotateRect(i,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2}),this._resizeRects[e]=g}}var j=this._network.getResizePointOutlineWidth(),k=this._network.getResizePointOutlineColor(),l=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,j,k,l,!0)}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>=g)){var h=g+c;Rb.grow(a,h,h),this._viewRect=Rb.unionRect(a,this._viewRect);var i,j,k,l,m=2*g,n=new md;for(i=0,j=b.size();j>i;i++)k=b.get(i),l={x:k.x-g,y:k.y-g,width:m,height:m},n.add(l);var o;if(f)o=this._resizeDivs;else{if(this._controlDivs||(this._controlDivs=new Array),this._controlDivs.length<j)for(i=this._controlDivs.length;j>i;i++){var p=Ub.createDiv();this._attachmentDiv.appendChild(p),this._controlDivs[i]=p}else if(this._controlDivs.length>j){for(i=j;i<this._controlDivs.length;i++)this._attachmentDiv.removeChild(this._controlDivs[i]);this._controlDivs.splice(j)}o=this._controlDivs}for(i=0,j=n.size();j>i;i++)l=n.get(i),Ub.setDiv(o[i],l,e,c,d),Ub.setBorderRaidus(o[i],(f?"0":m)+"px"),this._rotateAttachments(o[i],m/2,c,b.get(i))}},_rotateAttachments:function(a,b,c,d){if(this._element instanceof Ld){var e=this._element.getAngle();if(0==e)return;var f=this._element.getOriginalRect(),g=a.style.left.split("px")[0],h=a.style.top.split("px")[0];f.x+f.width/2,f.y+f.height/2,d||(d={x:parseFloat(g)+b+c,y:parseFloat(h)+b+c});var i=Rb.createMatrix(e*Math.PI/180,f.x+f.width/2,f.y+f.height/2),j=i.transform(d);a.style.webkitTransform="rotate("+e+"deg)",a.style.mozTransform="rotate("+e+"deg)",a.style.OTransform="rotate("+e+"deg)",a.style.msTransform="rotate("+e+"deg)",a.style.transform="rotate("+e+"deg)",a.style.left=j.x-b-c+"px",a.style.top=j.y-b-c+"px"}},_addShapeLinkPoints:function(a){this._addEditPoints(a._element.getPoints())},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(wc.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new md;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Rb.getRect(a);if(b){var c=this._network.getEditPointOutlineWidth(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor();this._addPoints(b,a,c,d,e,!1)}},hit:function(a,b){if(!Rb.containsPoint(this._viewRect,a,b))return!1;var c;if(this._resizeDivs)for(c=this._resizeDivs.length-1;c>=0;c--)if(Rb.containsPoint(this._resizeRects[c],a,b))return!0;if(this._rotateDiv&&Rb.containsPoint(this._rotateDiv._viewRect,a,b))return!0;if(this._controlDivs)for(c=this._controlDivs.length-1;c>=0;c--)if(Rb.containsPoint(this._controlDivs[c]._viewRect,a,b))return!0;return!1},intersects:function(a){if(!Rb.intersects(this._viewRect,a))return!1;var b;if(this._resizeDivs)for(b=this._resizeDivs.length-1;b>=0;b--)if(Rb.intersects(this._resizeRects[b],a))return!0;if(this._rotateDiv&&Rb.containsPoint(this._rotateDiv._viewRect,a))return!0;if(this._controlDivs)for(b=this._controlDivs.length-1;b>=0;b--)if(Rb.intersects(this._controlDivs[b]._viewRect,a))return!0;return Rb.intersects(this._viewRect,a)?!1:!1},_getRotateRect:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Gb.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Rb.getRect(g)}}),Gb.network.IconsAttachment=function(a,b){Gb.network.IconsAttachment.superClass.constructor.call(this,a,b),this._iconsCanvas=null},Hb.ext("twaver.network.IconsAttachment",Gb.network.Attachment,{isShadowable:function(){return Dd.ATTACHMENT_SHADOWABLE},updateMeasure:function(){Gb.network.IconsAttachment.superClass.updateMeasure.call(this);var a=this._network.getIconsNames(this._element);if(a&&0!=a.length){var b=this._network.getIconsColors(this._element),c=this._element.getStyle("icons.orientation"),d=this._element.getStyle("icons.position"),e=this._element.getStyle("icons.xoffset");e=e instanceof Array?e[0]:e;var f=this._element.getStyle("icons.yoffset");f=f instanceof Array?f[0]:f;var g=this._element.getStyle("icons.xgap");g=g instanceof Array?g[0]:g;var h=this._element.getStyle("icons.ygap");h=h instanceof Array?h[0]:h;var i=this._getIconsSize(a,c,g,h);if(i){var j=this._network.getPosition(d,this._ui,i,e,f);this._viewRect={x:j.x,y:j.y,width:i.width,height:i.height},"top"===c?j.y+=i.height:"left"===c&&(j.x+=i.width),this._iconsCanvas||(this._iconsCanvas=Ub.createCanvas(),this._view.appendChild(this._iconsCanvas));var k=this._ui.setShadow(this,this._iconsCanvas,Hb.clone(this._viewRect)),l=j.x,m=j.y,n=0;for(var o in a){var p=null,q=null;b&&b.length>n&&(q=b[n++]);var r=Hb.getImageAsset(a[o]);if(null!=r){if("right"===c)p={x:l,y:m,width:r.getWidth(),height:r.getHeight()},l+=p.width+g;else if("left"===c)p={x:l-r.getWidth(),y:m,width:r.getWidth(),height:r.getHeight()},l-=p.width+g;else if("top"===c)p={x:l,y:m-r.getHeight(),width:r.getWidth(),height:r.getHeight()},m-=p.height+h;else{if("bottom"!==c)throw"Can not resolve '"+c+"' orientation";p={x:l,y:m,width:r.getWidth(),height:r.getHeight()},m+=p.height+h}Mc(k,r.getImage(q,p.width,p.height),q,p,this._element,this._network)}}}}},_getIconsSize:function(a,b,c,d){var e=0,f=0,g=null,h=null,i=null;for(var j in a)if(h=Hb.getImageAsset(a[j])){if("right"===b)g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},e+=g.width+c;else if("left"===b)g={x:e-h.getWidth(),y:f,width:h.getWidth(),height:h.getHeight()},e-=g.width+c;else if("top"===b)g={x:e,y:f-h.getHeight(),width:h.getWidth(),height:h.getHeight()},f-=g.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},f+=g.height+d}i=null==i?Hb.clone(g):Rb.unionRect(i,g)}return i?{width:Math.abs(i.width),height:Math.abs(i.height)}:null}}),Gb.network.HTMLBasicAttachment=function(a,b){function c(a,b,c,d,e,f,g){c||(c=this._origin.x),d||(d=this._origin.y),e||(e=this._location.x),f||(f=this._location.y),a=a-c-e,b=b-d-f;var h=Gb.Util.transformPoint({x:c+e,y:d+f},g?this._radian:-this._radian,a,b).point;return h}Gb.network.HTMLBasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var d=this;this.hit=function(a,b){if(this._radian&&this._origin){var e=c.call(d,a,b);a=e.x,b=e.y}return Gb.Util.containsPoint(this._roundRect,a,b)||Gb.Util.containsPoint(this._pointerRect,a,b)},this.intersects=function(a){var b={x:a.x,y:a.y},e={x:a.x+a.width,y:a.y},f={x:a.x,y:a.y+a.height},g={x:a.x+a.width,y:a.y+a.height};if(this._radian&&this._origin){if(a.width*a.height>50)return!1;b=c.call(d,b.x,b.y),e=c.call(d,e.x,e.y),f=c.call(d,f.x,f.y),g=c.call(d,g.x,g.y)}return a=Gb.Util.getRect([b,e,f,g]),Gb.Util.intersects(this._roundRect,a)||Gb.Util.intersects(this._pointerRect,a)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Gb.Util.ext("twaver.network.HTMLBasicAttachment",Gb.network.BasicAttachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=Math.min(this.getCornerRadius(),b/2),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset();this._contentRect.width=a,this._contentRect.height=b,this._contentRect.x=c;var i=this._roundRect;i.width=a+2*c,i.height=b;var j;if(d>0){var k=this.getDirection();if(j=this._network.getPosition(f,this._ui,null,g,h),"aboveleft"===k){i.y=j.y-d-i.height,i.x=j.x-(i.width-c),this._pointers=[j,{x:j.x,y:j.y-d},{x:j.x-Math.min(e,a),y:j.y-d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle=n+" "+n+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if("aboveright"===k){i.y=j.y-d-i.height,i.x=j.x-c,this._pointers=[j,{x:j.x,y:j.y-d},{x:j.x+Math.min(e,a),y:j.y-d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle=n+" transparent transparent "+n,this._triangleDivLocation=this._pointers[1]}else if("belowleft"===k){i.y=j.y+d,i.x=j.x-(i.width-c),this._pointers=[j,{x:j.x,y:j.y+d},{x:j.x-Math.min(e,a),y:j.y+d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle=" transparent "+n+" "+n+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:j.y}}else if("belowright"===k){i.y=j.y+d,i.x=j.x-c,this._pointers=[j,{x:j.x,y:j.y+d},{x:j.x+Math.min(e,a),y:j.y+d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle="transparent transparent "+n+" "+n,this._triangleDivLocation=this._pointers[0]}else if("above"===k){i.y=j.y-d-i.height,i.x=j.x-i.width/2,this._pointers=[j,{x:j.x-Math.min(e,a)/2,
y:j.y-d},{x:j.x+Math.min(e,a)/2,y:j.y-d}];var l=d,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px 0px "+m+"px",this._triangleBorderColorStyle=n+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if("below"===k){i.y=j.y+d,i.x=j.x-i.width/2,this._pointers=[j,{x:j.x-Math.min(e,a)/2,y:j.y+d},{x:j.x+Math.min(e,a)/2,y:j.y+d}];var l=d,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle="0px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle="transparent transparent "+n+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:j.y}}else if("left"===k){i.y=j.y-i.height/2,i.x=j.x-i.width-d,this._pointers=[j,{x:j.x-d,y:j.y-Math.min(e,b)/2},{x:j.x-d,y:j.y+Math.min(e,b)/2}];var l=Math.min(e,b)/2,m=d,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px 0px "+l+"px "+m+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+n,this._triangleDivLocation=this._pointers[1]}else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,this._pointers=[j,{x:j.x+d,y:j.y-Math.min(e,b)/2},{x:j.x+d,y:j.y+Math.min(e,b)/2}];var l=Math.min(e,b)/2,m=d,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px 0px",this._triangleBorderColorStyle="transparent "+n+" transparent  transparent ",this._triangleDivLocation={x:j.x,y:this._pointers[1].y}}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._location=j},updateMeasure:function(){if(this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?Gb.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):Gb.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=Gb.Util.getRect(this._pointers),this._viewRect=Gb.Util.unionRect(this._pointerRect,this._roundRect),Gb.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),Gb.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),Gb.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),Gb.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),Gb.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),Gb.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),Gb.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),Gb.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),Gb.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),Gb.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(Gb.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),Gb.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),Gb.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),Gb.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv),this._element.getStyle("label.rotatable")&&this.label){var a=this._ui.getFromPoint(),b=this._ui.getToPoint(),c=this._ui.getLinkPoints();c.size()%2==0&&(a=c.get(c.size()/2-1),b=c.get(c.size()/2)),this._radian=a.x>b.x?Gb.Util.getRadiansBetweenLines(b,a):Gb.Util.getRadiansBetweenLines(a,b),this._origin={x:this._contentRect.width/2,y:0};var d="rotate("+Gb.Util.toDegrees(this._radian)+"deg)",e=this._origin.x+"px "+this._origin.y+"px";Gb.Util.isChrome||Gb.Util.isSafari?(Gb.Util.setCSSStyle(this._roundDiv,"-webkit-transform",d),Gb.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",e)):Gb.Util.isIE?(Gb.Util.setCSSStyle(this._roundDiv,"-ms-transform",d),Gb.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",e)):(Gb.Util.setCSSStyle(this._roundDiv,"transform",d),Gb.Util.setCSSStyle(this._roundDiv,"transform-origin",e))}else Gb.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),Gb.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),Gb.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),Gb.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),Gb.Util.removeCSSStyle(this._roundDiv,"transform"),Gb.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),Gb.network.HTMLLabelAttachment=function(a,b){Gb.network.HTMLBasicAttachment.call(this,a,b),this.label=!0},Gb.Util.ext("twaver.network.HTMLLabelAttachment",Gb.network.LabelAttachment,{updateMeasure:function(){var a=this.getFont("label.font"),b=this.getLabel();this._contentDiv.innerHTML=b,Gb.Util.setCSSStyle(this._contentDiv,"font",a),Gb.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),Gb.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:Gb.network.HTMLBasicAttachment.prototype.calculateMeasure}),Gb.network.HTMLAlarmAttachment=function(a,b){Gb.network.HTMLBasicAttachment.call(this,a,b),this.alarm=!0},Gb.Util.ext("twaver.network.HTMLAlarmAttachment",Gb.network.AlarmAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),Gb.Util.setCSSStyle(this._contentDiv,"font",a),this._fillColor=this._network.getAlarmFillColor(this._element),Gb.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),Gb.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:Gb.network.HTMLBasicAttachment.prototype.calculateMeasure}),Gb.network.NodeUI=function(a,b){Gb.network.NodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.NodeUI",Gb.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(a){Gb.network.NodeUI.superClass.invalidate.call(this,a);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this)},updateMeasure:function(){Gb.network.NodeUI.superClass.updateMeasure.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Rb.getHotSpot(b.x,b.y,b.width,b.height,a),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var c=this._element.getParent();c instanceof Nd&&this._network.invalidateElementUI(c,!1)},drawBody:function(){var a=this.getStyle("body.type");"default"===a?this.drawDefaultBody():"vector"===a?this.drawVectorBody():"default.vector"===a?(this.drawVectorBody(),this.drawDefaultBody()):"vector.default"===a?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var a=this._element,b=a.getStyle("outer.width");if(b>0){var c=this.getBodyRect();Rb.addPadding(c,a,"outer.padding",1),this._outerCanvas||(this._outerCanvas=Ub.createCanvas());var d=Hb.clone(c);Rb.grow(d,b/2,b/2);var e=Ub.setCanvas(this._outerCanvas,d);e.lineWidth=b,e.lineCap=a.getStyle("outer.cap"),e.lineJoin=a.getStyle("outer.join"),e.strokeStyle=this._outerColor,Vb.drawVector(e,a.getStyle("outer.shape"),null,c),e.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(d)}},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();c=Hb.clone(c);var d=a.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(c,a,"select.padding",1/d),this._selectCanvas||(this._selectCanvas=Ub.createCanvas()),Rb.grow(c,b/2/d,b/2/d);var e=Ub.setCanvas(this._selectCanvas,bounds);e.lineWidth=b/d,e.lineCap=a.getStyle("select.cap"),e.lineJoin=a.getStyle("select.join"),e.strokeStyle=a.getStyle("select.color"),Vb.drawVector(e,a.getStyle("select.shape"),null,c),e.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}},drawDefaultBody:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return this.addBodyBounds(c),void(this._currentImageAsset=null);if(Rb.addPadding(c,this._element,"image.padding",1),b.getImage()){this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var d=Hb.clone(c),e=this.setShadow(this,this._nodeCanvas,d);0!=a.getAngle()&&(c=a.getOriginalRect(),Gb.Util.rotateCanvas(e,c,a.getAngle())),Mc(e,a.getImage(),this.getInnerColor(),c,a,this._network),c=d,this.addComponent(this._nodeCanvas)}else if(b.getSrc())this._nodeImage||(this._nodeImage=Ub.createImg()),Ub.setImg(this._nodeImage,b.getSrc(),c),this.addComponent(this._nodeImage);else{if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this._nodeComponent=this._currentImageAsset!==b?b.getFunction()(this,c):b.getFunction()(this,c,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=Hb.clone(c)}this.addBodyBounds(c),this._currentImageAsset=b},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Hb.math.containsPoint(c,a,b))return!0}return this.hitCanvas(a,b,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(a,b,["_nodeImage","_nodeComponent"])},intersects:function(a){if(this._network._transparentSelectionEnable){var b=this.getBodyRect();if(Hb.math.intersects(b,a))return!0}return this.intersectsCanvas(a,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(a,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=Ub.createCanvas());var a=Vb.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("vector.deep"),c=this._vectorCanvas.getContext("2d"),d=this.getBodyRect(),e=this.getStyle("vector.fill.color");if(0!==b&&e){var f=this._element.getAngle();0!=f&&(d=this._element.getOriginalRect(),Gb.Util.rotateCanvas(c,d,-f),Gb.Util.rotateCanvas(c,d,f)),"rectangle"===this.getStyle("vector.shape")&&Vb.draw3DRect(c,e,b,d)}this.addBodyBounds(a),this.addComponent(this._vectorCanvas)}}),Gb.network.LinkUI=function(a,b){Gb.network.LinkUI.superClass.constructor.call(this,a,b),this._linkCanvas=Ub.createCanvas()},Hb.ext("twaver.network.LinkUI",Gb.network.ElementUI,{isEditable:function(){return wc.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},hit:function(a,b){return this.hitCanvas(a,b,["_linkCanvas"])},intersects:function(a){return this.intersectsCanvas(a,["_linkCanvas"])},checkAttachments:function(){Gb.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Gb.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Rb.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,Gb.network.LinkUI.superClass.invalidate.call(this,a)},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=wc.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=wc.createToPoint(this)),this._toPoint},updateMeasure:function(){Gb.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new md;if(wc.isOrthogonalOrFlexionalLink(this._element))d=wc.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());null!=e&&(this._hotSpot=wc.fillLoopedPoints(this,e.getBodyRect(),d))}else{if("arc"!==c&&"triangle"!==c&&"parallel"!==c)throw"Can not resolve link type '"+c+"'";this._hotSpot=wc.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new tc(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Vb._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:Dd.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=h,Vb._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Vb.drawLinePoints(a,b,e),a.stroke()},drawBody:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Rb.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Rb.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=Rb.unionRect(c,nd.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=Rb.unionRect(c,nd.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))));var i=this.setShadow(this,this._linkCanvas,c);i.lineCap=b.getStyle("link.cap"),i.lineJoin=b.getStyle("link.join");var j=b.getStyle("link.pattern");g&&this.drawLinePoints(i,a,e,b.getStyle("select.color"),j),this._outerColor&&this.drawLinePoints(i,a,d+2*f,this._outerColor,j),this.drawLinePoints(i,a,d,this._innerColor||b.getStyle("link.color"),j),this.addBodyBounds(c),this.addComponent(this._linkCanvas),nd.drawLinkArrow(this,i,a)}},getControlPoint:function(){return wc.getControlPoint(this._element,this)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(wc.hasControlPoint(b)){var c=wc.getLinkSourceBounds(this),d=wc.getLinkTargetBounds(this);wc.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength}}),Gb.network.HTMLLinkUI=function(a,b){Gb.network.HTMLLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.HTMLLinkUI",Gb.network.LinkUI,{checkAttachments:function(){Gb.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Gb.network.GroupUI=function(a,b){Gb.network.GroupUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.GroupUI",Gb.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){this.getBodyRect(),this._shapeRect?this.drawExpandedGroup():Gb.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var a=Vb.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Vb.draw3DRect(this._nodeCanvas.getContext("2d"),c,b,this._bodyRect),this.addBodyBounds(a),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element;if(a.isExpanded()){var b=this.getChildrenRects();if(!b.isEmpty()){var c=a.getStyle("group.shape"),d=Sb[c];if(!d)throw"Can not resolve group shape '"+c+"'";this._shapeRect=d(b)}}return this._shapeRect?(Rb.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Gb.network.GroupUI.superClass.createBodyRect.call(this)}}),Gb.network.GridUI=function(a,b){Gb.network.GridUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.GridUI",Gb.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?Gb.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var a=this.getStyle("grid.fill"),b=this.getStyle("grid.deep"),c=this.getStyle("grid.cell.deep");if(a||0!==b||0!==c){var d=this.getBodyRect(),e=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var f=Hb.clone(d),g=this.setShadow(this,this._nodeCanvas,f);if(g.rect(d.x,d.y,d.width,d.height),this.addComponent(this._nodeCanvas),a&&(g.fillStyle=e,g.fill()),0!=b&&Vb.draw3DRect(g,e,b,d.x,d.y,d.width,d.height),0!=c)for(var h=this.getStyle("grid.row.count"),i=this.getStyle("grid.column.count"),j=0;h>j;j++)for(var k=0;i>k;k++){var l=this._element.getCellRect(j,k);null!=l&&Vb.draw3DRect(g,e,c,l.x,l.y,l.width,l.height)}this.addBodyBounds(f)}}}),Gb.network.ShapeNodeUI=function(a,b){Gb.network.ShapeNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.ShapeNodeUI",Gb.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)return void this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var a=Vb.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(a),this.addComponent(this._nodeCanvas),nd.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),Rb.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();c=Hb.clone(c);var d=a.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(c,a,"select.padding",1/d);var e=a.getStyle("vector.outline.width");e>0&&Rb.grow(c,e/2,e/2),this._selectCanvas||(this._selectCanvas=Ub.createCanvas()),Rb.grow(c,b/2/d,b/2/d);var f=Ub.setCanvas(this._selectCanvas,c);f.lineWidth=b/d,f.lineCap=a.getStyle("select.cap"),f.lineJoin=a.getStyle("select.join"),f.strokeStyle=a.getStyle("select.color"),Vb.drawVector(f,a.getStyle("select.shape"),null,c),f.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}}}),Gb.network.ShapeLinkUI=function(a,b){Gb.network.ShapeLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.ShapeLinkUI",Gb.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new md,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._element._points),c.add(b);var e=c.size(),f=Math.floor(e/2);if(e%2===0){var g=c.get(f),h=c.get(f-1);this._hotSpot={x:(g.x+h.x)/2,y:(g.y+h.y)/2}}else this._hotSpot=Hb.clone(c.get(f));var i,j,k;if("lineto"===d);else if("quadto"===d){for(i=new md(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-1>j?new md([c.get(j++),c.get(j)]):c.get(j));c=i}else if("cubicto"===d){for(i=new md(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-2>j?new md([c.get(j++),c.get(j++),c.get(j)]):e-1>j?new md([c.get(j++),c.get(j)]):c.get(j));c=i}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(k=c.get(0),i=new md(k),j=1,e=c.size();e>j;j++)if(e-1>j){var l=Hb.clone(c.get(j)),m=l.x,n=l.y,o=m-k.x,p=n-k.y;Math.abs(o)>Math.abs(p)?(l.x=m,l.y=k.y):(l.x=k.x,l.y=n),k=l,i.add(k)}else i.add(c.get(j));c=i}return c}}),Gb.network.RotatableNodeUI=function(a,b){Gb.network.RotatableNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.RotatableNodeUI",Gb.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return this.addBodyBounds(c),void(this._currentImageAsset=null);if(Rb.addPadding(c,this._element,"image.padding",1),b.getImage()){this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var d=Hb.clone(c),e=this.setShadow(this,this._nodeCanvas,d),f=this._element._getOrignalWidth(),g=this._element._getOrignalHeight(),h=this._element._getRotateRect();e.save(),e.translate(c.x-h.x+f/2,c.y-h.y+g/2),e.rotate(this._element._angle*Math.PI/180);var c={x:-f/2,y:-g/2,width:f,height:g};Mc(e,b.getImage(this._innerColor,c.width,c.height),this._innerColor,c,a,this._network),e.restore(),this.addComponent(this._nodeCanvas)}else if(b.getSrc());else if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this.addBodyBounds(c),this._currentImageAsset=b}}),Gb.network.HTMLNodeUI=function(a,b){Gb.network.HTMLNodeUI.superClass.constructor.call(this,a,b)},Gb.Util.ext("twaver.network.HTMLNodeUI",Gb.network.NodeUI,{checkAttachments:function(){Gb.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.network.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Gb.network.interaction.BaseInteraction=function(a){this.network=a},Hb.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Ub.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Ub.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint(a),this._startClient=Ub.getClientPoint(a),this._startLogical&&Ub.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Gb.network.interaction.SelectInteraction=function(a){Gb.network.interaction.SelectInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.SelectInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(a){if(this._button=a.button,this.network.isValidEvent(a)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!a.shiftKey){var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?Hb.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(Hb.isCtrlDown(a)||c.clearSelection(),this.end(a),this.network.getLogicalPoint(a)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(0!==this._button||this.network.isMovingElement()||this.network.isEditingElement())return void this.end(a);this._handle_mousemove(a),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Ub.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=Rb.getRect([this._startLogical,this._endLogical]);Ub.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(a){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}var e=this;setTimeout(function(){e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(a)}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),Gb.network.interaction.MoveInteraction=function(a,b){this.lazyMode=b,this.xoffset=0,this.yoffset=0,Gb.network.interaction.MoveInteraction.superClass.constructor.call(this,a),this.currentKeyEvent=null},Hb.ext("twaver.network.interaction.MoveInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown","mouseleave")},tearDown:function(){this.removeListener("mousedown","keydown","mouseleave"),this.end()},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},handle_mouseleave:function(a){this.end(a)},isParenting:function(){return this._startLogical&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var d=this;if(a=this.network.getLogicalPoint(a),!b&&this.isParenting()){var e={};e.x=a.x-1,e.y=a.y-1,e.width=2,e.height=2;var f=this.network.getElementsAtRect(e,!0);if(f&&f.size()>0)for(var g=f.size(),h=0;g>h;h++){var i=f.get(h);if(!d.network.getElementBox().getSelectionModel().contains(i)){d.parent=i;break}}}null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),null==c||b?this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null):(this.parentMark||(this.parentMark=Hb.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),Hb.html.setDiv(this.parentMark,c,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()))},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);this.network.isMovable(b)&&(this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical)return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a});else{this.mark=Ub.createDiv();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Rb.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Ub.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})),this.network.moveSelectedElements(this.xoffset,this.yoffset);this.parentProcess(a,!1)},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this._handle_mouseup(a)}}}),Gb.network.interaction.DefaultInteraction=function(a){Gb.network.interaction.DefaultInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.DefaultInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(this.network.isValidEvent(a)){this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);2===a.detail?this.handleDoubleClicked(a,b):this.handleClicked(a,b)}},handleClicked:function(a,b){Bc.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Bc.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Bc.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Cc(c),e=Cc(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),Gb.network.interaction.PanInteraction=function(a){Gb.network.interaction.PanInteraction.superClass.constructor.call(this,a);
},Hb.ext("twaver.network.interaction.PanInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startLogical&&(this._handle_mousedown(a),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(this._startLogical){this._handle_mousemove(a);var b=this._startLogical.x-this._endLogical.x,c=this._startLogical.y-this._endLogical.y;this.network.panByOffset(b,c),this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a)}},_clear:function(a){this._startLogical&&(this._handle_mouseup(a),this.network.getView().style.cursor=this._oldCursor)}}),Gb.network.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,Gb.network.interaction.EditInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.EditInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(0===a.button)if(!Hb.isAltDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Hb.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Hb.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(b instanceof Gb.ShapeNode){var d=this.getPointIndex(b.getPoints(),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Gb.ShapeLink){var e=new Gb.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:this.lazyMode?"lazeMovePointStart":"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=Hb.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Gb.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection}),c.clear()});Gb.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&b){var e=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&b){var e=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.lazyMode||this.clear()},handle_mousemove:function(a){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.showRotateScale());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}else if(this.network.isValidEvent(a)){if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint(a);if(b instanceof Ld){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Gb.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Gb.network.LinkUI){var e=this.network.getEditPointSize();if(wc.isOrthogonalLink(c._element)){this.linkUI=c;var f=this.linkUI.getControlPoint();return void(f&&this._contains(d,f,e)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Rb.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(180*Math.atan2(c.x-a.x,a.y-c.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(a){if(this._handle_mousemove(a),!this.mouseMoved&&Hb.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var d=this.shapeNode.getPoints().get(this.pointIndex),e=Hb.clone(this._endLogical);this.horizontal&&(e.y=d.y),this.vertical&&(e.x=d.x),this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){if(this._handle_mousemove(a),!this.mouseMoved&&Hb.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var d=this.shapeLink.getPoints().get(this.pointIndex),e=Hb.clone(this._endLogical);this.horizontal&&(e.y=d.y),this.vertical&&(e.x=d.x),this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this._handle_mousemove(a),this.linkUI.setControlPoint(Hb.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.mark||(this.mark=Ub.createDiv(),this.mark.style.webkitTransform="rotate("+b+"deg)",this.mark.style.mozTransform="rotate("+b+"deg)",this.mark.style.OTransform="rotate("+b+"deg)",this.mark.style.msTransform="rotate("+b+"deg)",this.mark.style.transform="rotate("+b+"deg)",this.network.getTopDiv().appendChild(this.mark)),Ub.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){var b=this.network.getEditPointSize();if(this.node instanceof Gb.ShapeNode){this.shapeNode=this.node;for(var c=this.shapeNode.getPoints(),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.shapeLink.getPoints(),c=this.network.getEditPointSize(),d=0,e=b.size();e>d;d++){var f=b.get(d);if(this._contains(a,f,c))return this._setCrossCursor(),this.pointIndex=d,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){var f=this.network.getResizePointSize();return this._contains(a,{x:b,y:c},f)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Rb.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=Hb.html.createCanvas());var a,b,c,d,e,f=(new Gb.List,this.network.getRotateScaleWidth()),g=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),i=this.node.getAngle(),j=this.node.getOriginalRect(),k={x:j.x+j.width/2,y:j.y-this.network.getRotatePointOffset()-h},l=this._rotatePoint(k,i,j),m="13px Arial",n=i+"";this.node.getAngle()>=0&&this.node.getAngle()<=180?(b={x:l.x+h,y:l.y},c={x:b.x+f,y:b.y},d={x:c.x,y:c.y-g},e={x:b.x,y:d.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(b={x:l.x-h,y:l.y},c={x:b.x-f,y:b.y},d={x:c.x,y:c.y-g},e={x:b.x,y:d.y});var o=new Gb.List([b,c,d,e]),a=Hb.math.getRect(o),p=Hb.html.setCanvas(this.rotateScale,a);p.fillStyle=this.network.getRotateScaleFillColor(),p.fillRect(a.x,a.y,a.width,a.height),p.fillStyle=this.network.getRotateScaleFontColor(),p.textBaseline="middle",p.textAlign="center",p.font=m,p.fillText(n,a.x+a.width/2,a.y+a.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Gb.network.interaction.MoveLinkInteraction=function(a,b){Gb.network.interaction.MoveLinkInteraction.superClass.constructor.call(this,a),this.xoffset=0,this.yoffset=0},Hb.ext("twaver.network.interaction.MoveLinkInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);b instanceof Gb.Link&&(this.element=b,this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a,element:this.element});else{this.mark=Ub.createCanvas();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Rb.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Ub.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var c=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(c,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a,element:this.element}))}},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a,element:this.element}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))},d=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(d,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a,element:this.element}));this._handle_mouseup(a),delete this.element}}}),Gb.network.interaction.CreateElementInteraction=function(a,b){b||(b=Ld),this.elementFunction=Gb.Util.isTypeOf(b,Ld)?function(a){var c=new b;return c instanceof Ld&&c.setCenterLocation(a),c}:b,Gb.network.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.CreateElementInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Gb.network.interaction.CreateLinkInteraction=function(a,b){b||(b=Gb.Link),this.linkFunction=Gb.Util.isTypeOf(b,Gb.Link)?function(a,c){var d=new b;return d instanceof Gb.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Gb.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.CreateLinkInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var a=this;setTimeout(function(){a._fromRectangle&&(a.network.getTopDiv().removeChild(a._fromRectangle),a._fromRectangle=null),a._currentRectangle&&(a.network.getTopDiv().removeChild(a._currentRectangle),a._currentRectangle=null),a._line&&(a.network.getTopDiv().removeChild(a._line),a._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.updateMark()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.updateMark()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Ld&&this.network.isLinkable(b)?b:null},updateMark:function(){var a;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(a=this.network.getElementUI(this.currentNode),this._currentRectangle=Ub.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),Ub.setDiv(this._currentRectangle,a._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var a=this.fromNode.getCenterLocation(),b=a.x,c=a.y,d=this.currentPoint.x,e=this.currentPoint.y;this._line||(this._line=Ub.createCanvas(),this.network.getTopDiv().appendChild(this._line));var f=Ub.setCanvas(this._line,Math.min(b,d),Math.min(c,e),Math.abs(b-d),Math.abs(c-e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),f.moveTo(b,c),f.lineTo(d,e),f.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),Gb.network.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Gb.ShapeNode),this.shapeNodeFunction=Gb.Util.isTypeOf(b,Gb.ShapeNode)?function(a){var c=new b;return c instanceof Gb.ShapeNode&&a&&c.setPoints(a),c}:b,Gb.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a),this.timeStamp=-1},Hb.ext("twaver.network.interaction.CreateShapeNodeInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new md),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this._handle_mousedown(a),this.points.size()>0&&Hb.isCtrlDown(a)&&(this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=b,this.points.add(b),this.updateMark()}this.timeStamp=a.timeStamp}}},handle_mousemove:function(a){if(this.points){if(this.currentPoint=this.network.getLogicalPoint(a),Hb.isCtrlDown(a)){var b=this.currentPoint.x-this.lastPoint.x,c=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=Ub.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var b=new md(this.points);b.add(this.currentPoint);var c=Rb.getRect(b),d=this.network.getEditLineWidth();Hb.math.grow(c,d,d);var e=Ub.setCanvas(this.mark,c);e.lineWidth=d,e.strokeStyle=this.network.getEditLineColor(),e.beginPath(),Vb.drawLinePoints(e,b),e.stroke()}}}),Gb.network.interaction.CreateShapeLinkInteraction=function(a,b){Gb.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Gb.ShapeLink),this.linkFunction=Gb.Util.isTypeOf(b,Gb.ShapeLink)?function(a,c,d){var e=new b;return e instanceof Gb.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d&&e.setPoints(d)),e}:b},Hb.ext("twaver.network.interaction.CreateShapeLinkInteraction",Gb.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),Gb.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b)if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new md),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b),this.updateMark()}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=Ub.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()}},updateLine:function(){if(this.currentPoint&&this.polyline){var a=new md(this.points);a.add(this.fromNode.getCenterLocation(),0),a.add(this.currentPoint);var b=Rb.getRect(a),c=Ub.setCanvas(this.polyline,b);c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),Vb.drawLinePoints(c,a),c.stroke()}}}),Gb.network.interaction.CreateOrthogonalLinkInteraction=function(a,b,c,d,e,f){Gb.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,a,b),this.linkType=c||"orthogonal",this.isByControlPoint=d,this.splitPercent=e,this.isSplitByPercent=f,this.link=new Gb.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),wc.isFlexionalTypeLink(this.linkType)||wc.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):wc.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},Hb.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",Gb.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),Gb.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var a=Gb.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);if(a.setStyle("link.type",this.linkType),a.setStyle("link.split.by.percent",this.isSplitByPercent),this.isByControlPoint){var b=wc.getControlPoint(a);if(b)return a.SetStyle("link.control.point",b),a}else wc.isFlexionalTypeLink(this.linkType)||wc.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle("link.extend")),a.setStyle("link.extend",this.splitPercent)):wc.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?a.setStyle("link.split.percent",this.splitPercent):a.setStyle("link.split.value",this.splitPercent));return a},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var a,b=this.network.getElementUI(this.fromNode);if(!b)return;if(a=b.getBodyRect(),null==a)return;var c;if(this.currentNode&&this.currentNode!==this.fromNode){var d=this.network.getElementUI(this.currentNode);if(!d)return;c=d.getBodyRect()}else c={
x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!c)return;var e=wc.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,a,c,this.link);if(wc.drawCorner(e,this.link),e.size()<2)return;this.line||(this.line=Ub.createCanvas(),this.network.getTopDiv().appendChild(this.line));var f=Ub.setCanvas(this.line,Rb.getLineRect(e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),Vb.drawLinePoints(f,e),f.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),Gb.network.interaction.MagnifyInteraction=function(a,b,c,d,e){Gb.network.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Ub.createCanvas(),this.markCanvas._isIgnored=!0},Hb.ext("twaver.network.interaction.MagnifyInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);b&&(this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=b,this.updateMark())},updateMark:function(){var a,b=this.network._zoom,c=this.zoom*b,d=this.lastPoint.x*b-this.xRadius,e=this.lastPoint.y*b-this.yRadius,f=2*this.xRadius,g=2*this.yRadius,h={x:this.lastPoint.x-this.xRadius/c,y:this.lastPoint.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=Ub.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),Ub.setCanvas(this.markCanvas,d,e,f,g),a=this.markCanvas.getContext("2d"),a.save(),a.beginPath(),Vb.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,Vb.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()},_clear:function(a){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.updateMark()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.updateMark()}}),Gb.network.interaction.TouchInteraction=function(a){Gb.network.interaction.TouchInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.TouchInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("touchstart","handleTouchstart",a,this),Ub.addEventListener("touchmove","handleTouchmove",a,this),Ub.addEventListener("touchend","handleTouchend",a,this),Ub.addEventListener("touchcancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("touchstart",a,this),Ub.removeEventListener("touchmove",a,this),Ub.removeEventListener("touchend",a,this),Ub.removeEventListener("touchcancel",a,this)},handleTouchstart:function(a){if(Ub.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b;var d=this;c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Bc.handleLongClicked(d.network,a,c)},1e3)}else a.touches&&2==a.touches.length&&(this._distance=yc.getDistance(a),this._zoom=this.network.getZoom(),this._startTouchPoint={x:a.touches[0].clientX,y:a.touches[0].clientY});this._touchCount=a.touches.length},handleTouchmove:function(a){if(Ub.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-yc.getDistance(a))>=Dd.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=yc.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=a.touches[0],d=this._startTouchPoint.x-c.clientX,e=this._startTouchPoint.y-c.clientY,f=this.network.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var g=this.network.getLogicalPoint(a),h=this.network.getElementAt(g);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==h&&this.network.getMovableSelectedElements().contains(h)){var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=g,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer)))}else{var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(a);var d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(d)>=Dd.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Dd.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Ub.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer));var i=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]);Ub.setDiv(this.mark,i,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(a){if(Ub.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var e=new Date,f=this.network.getLogicalPoint(a),g=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&f&&e.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,f)<=20&&(g?this.network.getSelectionModel().contains(g)||this.network.getSelectionModel().setSelection(g):this.network.getSelectionModel().clearSelection(),Bc.handleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer),this._endTouchTime&&e.getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,f)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Bc.handleDoubleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=e,this._endTouchPoint=f))}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Gb.network.interaction.MSTouchInteraction=function(a){Gb.network.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Hb.ext("twaver.network.interaction.MSTouchInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("MSPointerDown","handleTouchstart",a,this),Ub.addEventListener("MSPointerMove","handleTouchmove",a,this),Ub.addEventListener("MSPointerUp","handleTouchend",a,this),Ub.addEventListener("MSPointerCancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("MSPointerDown",a,this),Ub.removeEventListener("MSPointerMove",a,this),Ub.removeEventListener("MSPointerUp",a,this),Ub.removeEventListener("MSPointerCancel",a,this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Bc.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20?(Bc.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Ub.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Hb.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Hb.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var e=-1,f=0;f<this._pointerIdArray.length;f++)if(this._pointerIdArray[f]==a.pointerId){e=f;break}e>=0&&this._pointerIdArray.splice(e,1),delete this._pointerMap[a.pointerId]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){if(this._startTouchPoint&&1==this._pointerIdArray.length){if(this._moveTouchPoint={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.network.getZoom()},Rb.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(null==this._startTouchElement&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Ub.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]);Ub.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var c=this.network.getElementAt(this._moveTouchPoint),d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;null!=this._startTouchElement||this.network.isRectSelectEnabled()?(this.network.isMovingElement()||null!=this._startTouchElement&&c==this._startTouchElement&&this.network.getMovableSelectedElements().contains(c))&&(this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))):this.network.panByOffset(-d,-e),this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY}}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}}});var Od={_hitCanvas:null,getHitCanvas:function(a,b){null==this._hitCanvas&&(this._hitCanvas=Ub.createCanvas()),0==arguments.length&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,b,c){void 0!=b&&(a.fillStyle=b,a.fill()),void 0!=c&&(a.strokeStyle=c,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",null!=e&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return 0>=e?g|=this.OUT_LEFT|this.OUT_RIGHT:c>a?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),0>=f?g|=this.OUT_TOP|this.OUT_BOTTOM:d>b?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if(0==(j=this.outcode(c,d,e,f,g,h)))return!0;for(;0!=(i=this.outcode(a,b,e,f,g,h));){if(0!=(i&j))return!1;if(0!=(i&(this.OUT_LEFT|this.OUT_RIGHT))){var k=e;0!=(i&this.OUT_RIGHT)&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;0!=(i&this.OUT_BOTTOM)&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};Gb.canvas={},Gb.canvas.interaction={},Gb.canvas.Network=function(a){Gb.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=Ub.createCanvas(),this._topCanvas=Ub.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Gb.List,this._topAttachmentList=new Gb.List,this.setElementBox(a?a:new Gb.ElementBox),Kb||(this._view=Ub.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),Ob.isTouchable?Ob.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(Gb.Defaults.NETWORK_TOOLTIP_ENABLED));var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Gb.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.invalidate(!1)})}},Gb.imageUtil.addEventListener(this.invalidateElementUIs,this)},Hb.ext("twaver.canvas.Network",Gb.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","debug","showShadowInEdit"],_currentSubNetwork:null,_subNetworkAnimate:Gb.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Gb.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Gb.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Gb.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Dd.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Gb.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Gb.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Gb.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Gb.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Gb.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Gb.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Gb.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Gb.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Gb.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Gb.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Gb.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Gb.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Gb.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Gb.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Gb.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:Gb.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Gb.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Gb.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Gb.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:Gb.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Gb.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Gb.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Dd.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Dd.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Dd.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Dd.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Dd.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Dd.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Dd.NETWORK_SELECTION_TOLERANCE,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:Gb.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,_showShadowInEdit:!1,adjustBounds:function(a){if(Kb)this._rootCanvas=new Jb(a.width,a.height),this._topCanvas=new Jb(a.width,a.height),this.setViewRect(a.x,a.y,a.width,a.height);else{var b=!1,c=this._view.style;if(c.left==a.x+"px"&&c.top==a.y+"px"&&c.width==a.width+"px"&&c.height==a.height+"px"&&(b=!0),Gb.canvas.Network.superClass.adjustBounds.apply(this,arguments),1==b)return;var d=this._view.offsetWidth,e=this._view.offsetHeight;this._rootCanvas.setAttribute("width",d),this._rootCanvas.setAttribute("height",e),this._topCanvas.setAttribute("width",d),this._topCanvas.setAttribute("height",e),this.setViewRect(this.viewRect.x,this.viewRect.y,d,e)}"undefined"==typeof Gb.gis&&(Gb.Util.makeHighRes(this._rootCanvas),Gb.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(a){if(this._backgroundImage!=a){var b=this._backgroundImage;this._backgroundImage=a;var c=this._backgroundImage;if(c&&!c._viewRect)if(c.width>0)c._viewRect={x:0,y:0,width:c.width,height:c.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",b,c);else{var d=this;c.onload=function(){c._viewRect={x:0,y:0,width:c.width,height:c.height},d.validateCanvasSize(),d.firePropertyChange("backgroundImage",b,c),c.onload=null}}else this.firePropertyChange("backgroundImage",b,c),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(!Kb&&mc.twm(this),1==this._invalidateElementVisibility){this._invalidateElementVisibility=!1;var a,b,c,d=this.getElementBox().getDatas()._as,e=d.length,f={},g=this._visibleFunction,h=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(a=0;e>a;a++)b=d[a],f[b._id]=this.isVisible(b,g,h);if(this._visibleMap)for(a=0;e>a;a++)b=d[a],f[b._id]!==this._visibleMap[b._id]&&(c=this._elementUIMap[b._id],c&&c.invalidate());for(a=0;e>a;a++)b=d[a],c=this._elementUIMap[b._id],c&&c.validate();this._visibleMap=f,this.paintRoot()}this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Gb.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);c&&(c.dispose(),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else if("clear"===a.kind){for(var d in this._elementUIMap)this._elementUIMap[d]&&this._elementUIMap[d].dispose&&this._elementUIMap[d].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&c.handlePropertyChange(a),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){"editable"===a.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this);var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),this.invalidateElementVisibility()},sendToTop:function(a){if(this._box.contains(a)){for(var b=a;b._parent&&this.isVisible(b._parent)&&(b=b._parent););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},getScopeRect:function(a){var b=this._zoom;if("viewsize"===a)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if("viewport"===a){if(this.viewRect)return Hb.cloneRect(this.viewRect)}else if("rootcanvas"===a)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*b,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*b};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?Hb.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},getUnionBounds:function(){return this._unionBounds},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){1==this.isLimitViewInCanvas()&&(0>a&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),0>b&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;(null==this.viewRect||a!=this.viewRect.x||b!=this.viewRect.y||c!=this.viewRect.width||d!=this.viewRect.height)&&(this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility())},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},dispose:function(){Gb.imageUtil.removeEventListener(this.invalidateElementUIs,this);for(var a in this._elementUIMap){var b=this._elementUIMap[a];b.curInterval&&clearTimeout(b.curInterval)}this.setInteractions(null)},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(!this.isMovingElement()){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var a=this.getElementBox().getDatas(),b=a.size();if(b>0){for(var c={x:0,y:0,width:0,height:0},d=0;b>d;d++){var e=a.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(c=Rb.unionRect(c,f._viewRect))}}var g=this.getBackgroundImage();if(g&&(c=Rb.unionRect(c,g._viewRect)),this.realWidth==(c.x+c.width)*this.getZoom()&&this.realHeight==(c.y+c.height)*this.getZoom())return;var h=this.getZoom();this.realWidth=(c.x+c.width)*h+this._paddingRight,this.realHeight=(c.y+c.height)*h+this._paddingBottom,this._unionBounds={x:c.x*h,y:c.y*h,width:c.width*h+this._paddingRight,height:c.height*h+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)}},getElementUI:function(a){return null==a?null:this._elementUIMap[a._id]},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a);
},this)},invalidateBundleLink:function(a){if(a instanceof Gb.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(){var a=this._rootCanvas.getContext("2d");if(a.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new Gb.List,this._topAttachmentList=new Gb.List,null!=this.getElementBox()){kd.draw(a,this);var b=this.getElementBox().getDatas()._as,c=b.length;a.save(),a.scale(this.getZoom(),this.getZoom()),a.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(a);var d={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},e=this.getBackgroundImage(),f=this.getBackgroundImageRect();if(e instanceof Nb&&(f?a.drawImage(e,f.x,f.y,f.width,f.height):a.drawImage(e,0,0,e.width,e.height),e._viewRect={x:0,y:0,width:e.width,height:e.height}),"string"==typeof e){var g=Hb.getImageAsset(e),h={x:0,y:0,width:g.getWidth(),height:g.getHeight()};Mc(a,e,null,h,null,this)}var i,j,k,l,m=this._box._layerBox;if(1===m.size())for(i=0;c>i;i++)j=b[i],this._visibleMap[j._id]&&(k=this._elementUIMap[j._id],null!=k&&this._isInView(k,d)?(k.paint(a),k.setAttachmentVisible&&k.setAttachmentVisible(!0),this.visibleList.add(j)):k.setAttachmentVisible&&k.setAttachmentVisible(!1));else m.forEachByDepthFirst(function(e){for(i=0;c>i;i++)j=b[i],m.getLayerByElement(j)===e&&this._visibleMap[j._id]&&(k=this._elementUIMap[j._id],null!=k&&this._isInView(k,d)?(k.paint(a),k.setAttachmentVisible&&k.setAttachmentVisible(!0),this.visibleList.add(j)):k.setAttachmentVisible&&k.setAttachmentVisible(!1))},null,this);for(c=this._topAttachmentList.size(),i=0;c>i;i++)l=this._topAttachmentList.get(i),l.getElementUI().paintAttachment(a,l);if(this._xyz){var c,n=this._xyz,o=n.markText,p=n.type,q=(n.expired,n.innerHTML),r=0,s=0,t=this.viewRect;a.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),a.scale(1/this.getZoom(),1/this.getZoom()),this.getZoom(),void 0!=o&&null!=o&&""!=o||"2"==p?(a.font="15px Arial sans-serif",c=Hb.g.getTextSize(a.font,q),a.fillStyle="red",r=t.width-c.width,s=t.height-20):(a.font="10px Arial sans-serif",c=Hb.g.getTextSize(a.font,q),r=t.width/2-c.width/2,s=t.height/2),a.fillText(q,r,s)}a.restore()}},paintBottom:function(a){},_isInView:function(a,b){return Rb.intersects(b,a._viewRect)},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){for(var b=this.markerList.size(),c=0;b>c;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint:function(a){var b;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=this._view.getBoundingClientRect(),d=a.changedTouches[0],e=Ob.isAndroid?0:yc.scrollLeft(),f=Ob.isAndroid?0:yc.scrollTop();return b={x:(d.clientX+this.viewRect.x-c.left-e)/this._zoom,y:(d.clientY+this.viewRect.y-c.top-f)/this._zoom}}return b=Ob.isFirefox?{x:(a.layerX+this.viewRect.x)/this.getZoom(),y:(a.layerY+this.viewRect.y)/this.getZoom()}:{x:(a.offsetX+this.viewRect.x)/this.getZoom(),y:(a.offsetY+this.viewRect.y)/this.getZoom()}},getElementAt:function(a,b){if(null==this.visibleList)return null;1===arguments.length&&(b=!0);var c,d;if(a.target?c=this.getLogicalPoint(a):a.event?a.event.target&&(c=this.getLogicalPoint(a.event)):c=a,null!=this._topAttachmentList)for(var e=this._topAttachmentList.size(),f=e-1;f>=0;f--){var g=this._topAttachmentList.get(f);if(d=g.getElement(),(!b||this.isSelectable(d))&&g.hit(c.x,c.y))return d}if(null!=this.visibleList)for(var h=this.visibleList.size(),i=h-1;i>=0;i--){var j=this.visibleList.get(i),k=this.getElementUI(j);if((!b||this.isSelectable(j))&&k&&k.hit(c.x,c.y))return j}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return d=a.target?this.getLogicalPoint(a):a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,b,c,d){var e=new Gb.List;if(null==this.visibleList)return e;d=void 0===d?!0:d;for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);i&&(!c||c(i._element))&&(d&&this.isSelectable(i._element)||!d)&&(b?i.intersects(a)&&e.add(h):Rb.contains(a,i.getViewRect())&&e.add(h))}return e},getPosition:function(a,b,c,d,e){var f,g=b instanceof Gb.canvas.ElementUI?b:this.getElementUI(b);if(g)if("from"===a||"to"===a){if(g.getFromPosition&&(f="from"===a?g.getFromPosition(d,e):g.getToPosition(d,e)))return c?{x:f.x-c.width/2,y:f.y-c.height/2}:f}else f="hotspot"===a?g.getHotSpot():Tb.get(a,g.getBodyRect(),c);if(!f&&b.getRect&&(f=Tb.get(a,b.getRect(),c)),f)return{x:f.x+d,y:f.y+e};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){if(Ob.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY),1==this.isHScrollBarVisible()&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof Gb.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Gb.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Ld){var f=this.getElementUI(e);f&&(b=Rb.unionRect(b,f.getViewRect()))}}return b},isVisible:function(a,b,c){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(3!==arguments.length&&(b=this._visibleFunction),b&&!b(a))return!1;if(!(c||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(uc.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof Gb.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,c)||!this.isVisible(a._toAgent,b,c))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var d=a._parent;d&&!d.ISubNetwork;){if(d instanceof Gb.Group&&(!d.isExpanded()||!this.isVisible(d,b,c)))return!1;d=d._parent}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return null==this._linkableFunction||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a,b){var c=[new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.MoveInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)];b&&c.push(new Gb.canvas.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setTouchInteractions:function(){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.MoveInteraction(this,!1),new Gb.canvas.interaction.ScrollInteraction(this),new Gb.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Gb.canvas.interaction.ScrollInteraction(this),new Gb.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.EditInteraction(this,a),new Gb.canvas.interaction.MoveInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateElementInteraction(this,a)])},setCreateLinkInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateLinkInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateShapeLinkInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateShapeNodeInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.PanInteraction(this),new Gb.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.MoveInteraction(this),new Gb.canvas.interaction.ScrollInteraction(this),new Gb.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement())return void Ac.hideToolTip();var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Ac.showToolTip({x:a.pageX,y:a.pageY},d);var e=Ac.getToolTipDiv(),e=Ac.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Mb.documentElement.scrollLeft||Mb.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Mb.documentElement.scrollTop||Mb.body.scrollTop)+"px")}}else Ac.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a){a=this.checkZoom(a);var b=this._zoom;if(this._zoom!=a){var c={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*a,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*a};this._zoom=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(c.x-this.viewRect.width/2,c.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",b,this._zoom)}},getZoom:function(){return this._zoom},setTouchZoom:function(a){this.setZoom(a,!1)},zoomOverview:function(a){if(!(this.realWidth<=0||this.realHeight<=0)){var b=this.realWidth/this.getZoom(),c=this.realHeight/this.getZoom(),d=this.viewRect.width/b,e=this.viewRect.height/c,f=Math.min(d,e);this.setZoom(f)}},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(1.2*this.getZoom())},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(uc.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){if(Gb.animate.AnimateManager.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var d=new Gb.animate.AnimateSubNetwork(this,a,c);Gb.animate.AnimateManager.start(d)}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility(),this.invalidateCanvasSize()}},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=uc.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Hb.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Gb.Group&&e.setExpanded(!0);var f=b.getViewRect();if(f){var g={x:f.x*this.getZoom(),y:f.y*this.getZoom(),width:f.width*this.getZoom(),height:f.height*this.getZoom()};Rb.intersects(this.viewRect,g)||this.isVisible(a)&&Hb.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])}}},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Dd.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c,d,e,f){c||(c=Ub.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var g=c.getContext("2d");if(g.translate(-e,-f),g.clearRect(0,0,a,b),kd.draw(g,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;a/this.realWidth*this.getZoom(),b/this.realHeight*this.getZoom(),g.scale(d,d);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new Gb.List;var j,k,l,m,n,o,p=this.getElementBox().getLayerBox(),q=p.getRoots(),r=q.size();if(1===r)for(l=0;i>l;l++)m=h[l],this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));else for(j=0;r>j;j++)for(k=q.get(j),l=0;i>l;l++)m=h[l],p.getLayerByElement(m)===k&&this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));for(i=this._topAttachmentList.size(),l=0;i>l;l++)o=this._topAttachmentList.get(l),o.getElementUI().paintAttachment(g,o);return c},toCanvasByRegion:function(a,b,c){c||(c=Ub.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");if(f.clearRect(0,0,d,e),kd.draw(f,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;f.save(),f.scale(b,b),f.beginPath(),f.translate(-a.x,-a.y);var g=this.getElementBox().getDatas()._as,h=g.length;this._topAttachmentList=new Gb.List;var i=this.getBackgroundImage();if(i&&i._viewRect&&Rb.intersects(a,i._viewRect)){var a=Rb.intersection(a,i._viewRect),j=i._viewRect;try{f.drawImage(i,j.x,j.y,j.width,j.height)}catch(k){}}var l,m,n,o,p,q,r=this.getElementBox().getLayerBox(),s=r.getRoots(),t=s.size();if(1===t)for(n=0;h>n;n++)o=g[n],this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&Rb.intersects(a,p._viewRect)&&p.paint(f));else for(l=0;t>l;l++)for(m=s.get(l),n=0;h>n;n++)o=g[n],r.getLayerByElement(o)===m&&this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&Rb.intersects(a,p._viewRect)&&p.paint(f));for(h=this._topAttachmentList.size(),n=0;h>n;n++)q=this._topAttachmentList.get(n),q.getElementUI().paintAttachment(f,q);return f.restore(),c},getGroupChildrenRects:function(a){var b=new md;return a.getChildren().forEach(function(a){if(a instanceof Ld){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){},setMovingElement:function(a){if(a!=this._movingElement){var b=this._movingElement;this._movingElement=a,this.firePropertyChange("movingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(a){if(a!=this._editingElement){var b=this._editingElement;this._editingElement=a,this.firePropertyChange("editingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}}}),Gb.canvas.Overview=function(a){Gb.canvas.Overview.superClass.constructor.apply(this,a),this._view=Ub.createView(),this._rootDiv=Ub.createDiv(),this._imageCanvas=Ub.createCanvas(),this._imageDiv=Ub.createDiv(),this._maskCanvas=Ub.createCanvas(),this._selectDiv=Ub.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Ub.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=Ub.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(a),Ob.isTouchable?Ob.isMSTouchable?new Gb.canvas.OverviewMSTouchInteraction(this):(new Gb.canvas.OverviewTouchInteraction(this),new Gb.canvas.OverviewInteraction(this)):new Gb.canvas.OverviewInteraction(this)},Hb.ext("twaver.canvas.Overview",Gb.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Dd.OVERVIEW_FILL_COLOR,_outlineColor:Dd.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Dd.OVERVIEW_OUTLINE_WIDTH,_selectColor:Dd.OVERVIEW_SELECT_COLOR,_selectWidth:Dd.OVERVIEW_SELECT_WIDTH,_padding:Dd.OVERVIEW_PADDING,_animate:Dd.OVERVIEW_ANIMATE,_maxPackingWidth:Dd.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Dd.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Ub.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Ub.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property||"canvasSizeChange"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Hb.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Hb.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Rb.grow(a,-this._padding,-this._padding),b&&(Ub.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var c=this._network.getZoom(),d=this._network._unionBounds;d=Rb.unionRect(d,{x:0,y:0,width:d.x,height:d.y}),d={x:d.x/c,y:d.y/c,width:d.width/c,height:d.height/c};var e={x:this._network.viewRect.x/c,y:this._network.viewRect.y/c,width:this._network.viewRect.width/c,height:this._network.viewRect.height/c},f=Rb.unionRect(d,e),g=Math.min(a.width/f.width,a.height/f.height),h=f.width*g,i=f.height*g,j=f.width*g,k=f.height*g,l=a.x+(a.width-j)/2,m=a.y+(a.height-k)/2;if(this._isNetworkDirty){var n={x:l,y:m,width:j,height:k};this._network.toCanvas(h,i,this._exportImageCanvas,g,f.x*g,f.y*g),this._imageCanvas.setAttribute("width",j),this._imageCanvas.setAttribute("height",k),this._imageCtx.drawImage(this._exportImageCanvas,0,0,h,i),Ub.setDiv(this._imageDiv,n,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var o={x:(e.x-f.x)*g,y:(e.y-f.y)*g,width:e.width*g,height:e.height*g},p=Ub.setCanvas(this._maskCanvas,l,m,j,k);p.lineWidth=0,p.fillStyle=this._fillColor,Vb.drawVector(p,"rectangle",null,l,m,j,k),p.closePath(),p.fill(),p.stroke(),p.clearRect(l+o.x,m+o.y,o.width,o.height),p.lineWidth=this._outlineWidth,p.strokeStyle=this._outlineColor;var q=o.width-2*this._outlineWidth,r=o.height-2*this._outlineWidth;q=Math.min(q,j-2-o.x-this._outlineWidth),r=Math.min(r,k-2-o.y-this._outlineWidth),Vb.drawVector(p,"rectangle",null,l+o.x+this._outlineWidth,m+o.y+this._outlineWidth,q,r),p.closePath(),p.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Rb.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network.getCanvasSize().width,(a.y-c.y)/c.height*this._network.getCanvasSize().height,b),this._invalidateMask())}}),Gb.canvas.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.network.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),yc.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=yc.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Gb.canvas.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Hb.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.canvas.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("mousedown","handleMousedown",this.view,this)},Hb.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(a){0===a.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Hb.isCtrlDown(a)&&(this.startPoint=this.endPoint,Ub.setVisible(this.overview._selectDiv,!0)),Ub.addEventListener("mousemove","handleMousemove",this.view,this),Ub.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f);this.network.setZoom(g*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var h=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network.getCanvasSize().height*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);Hb.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Ub.setVisible(this.overview._selectDiv,!1),Ub.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Ub.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("mousemove",this.view,this),Ub.removeEventListener("mouseup",this.view,this))}}),Gb.canvas.ElementUI=function(a,b){this._network=a,this._element=b,
this._attachments=new Gb.List,this._bodyBounds=new Gb.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Hb.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},invalidate:function(a){void 0===a&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var a;this._bodyBounds.forEach(function(b){a=Rb.unionRect(a,b)}),this._unionBodyBounds=Hb.clone(a),this._attachments.forEach(function(b){a=Rb.unionRect(a,b.getViewRect())}),this._viewRect=a}},validateImpl:function(){},setShadow:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur?b:((c||this._network._showShadowInEdit)&&(b.shadowOffsetX=this._shadowXOffset,b.shadowOffsetY=this._shadowYOffset,b.shadowBlur=this._shadowBlur,b.shadowColor=this._shadowColor),b)},clearShadow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return c&&(this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset),Rb.grow(b,this._shadowBlur,this._shadowBlur)),b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(a){this._attachments.add(a)},removeAttachment:function(a){this._attachments.remove(a)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Gb.canvas.LabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Gb.canvas.AlarmAttachment(this,Dd.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Gb.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Gb.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Gb.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore()},paintBody:function(a){},paintAttachments:function(a){a.beginPath();for(var b=this._attachments.size(),c=0;b>c;c++){var d=this._attachments.get(c);1==this._hitTest&&0==d.isShowOnTop()&&this.paintAttachment(a,d),1==this._intersectTest&&this.paintAttachment(a,d),0==this._hitTest&&0==this._intersectTest&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){a.beginPath(),b.paint(a),this.clearShadow(a)},getViewRect:function(){return Hb.clone(this._viewRect)},getUnionBodyBounds:function(){return Hb.clone(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Hb.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?Hb.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return Rb.contains(a,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);if(c.save(),c.translate(-a.x,-a.y),this._element.getImage){var d=Hb.getImageAsset(this._element.getImage());if(d&&d.getImage()instanceof Hd)return 1}this.paintBody(c);try{for(var e=c.getImageData(0,0,a.width,a.height),f=e.data,g=0;g<e.width;g++)for(var h=0;h<e.height;h++){var i=4*(h*e.width+g),j=f[i+3];if(0!==j)return c.restore(),1}}catch(k){if(Od.disposeHitCanvas(),Rb.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),1}}catch(j){Od.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var b=Rb.intersection(a,this._viewRect),c=this.hitCanvasRectAtBody(b);if(1==c)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return 1==d?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==c)},hitCanvasPoint:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this._viewRect,c))return!1;this._hitTest=!0;var e=this.hitCanvasRect(c);return this._hitTest=!1,e},hitTest:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this._viewRect,c))return null;var e=Rb.intersection(c,this._viewRect),f=this.hitCanvasRectAtBody(e);if(1==f)return this;for(var g=this._attachments.size(),h=0;g>h;h++){var i=this._attachments.get(h);if(i.hit(a,b))return i}return 0==f?this:null},dispose:function(){this._attachments.forEach(function(a){a.dispose()}),this._attachments.clear()}}),Gb.canvas.NodeUI=function(a,b){Gb.canvas.NodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.NodeUI",Gb.canvas.ElementUI,{invalidate:function(a){Gb.canvas.NodeUI.superClass.invalidate.call(this,a),this.curInterval&&clearInterval(this.curInterval);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this);var c=this._element.getParent();c instanceof Gb.Group&&this._network.invalidateElementUI(c,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Gb.canvas.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Rb.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Gb.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");"default"===a?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===a?this.addBodyBounds(this.getVectorBody()):"default.vector"===a?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===a&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return c;Rb.addPadding(c,this._element,"image.padding",1),this._defaultRect=c;var d=Hb.clone(c);return this.appendShadowBound(this,d),c=d},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var d=this.getBodyRect();Rb.addPadding(d,b,a+".padding",1);var e=Hb.clone(d);return Rb.grow(e,c/2,c/2),e}return null},getPathRect:function(a,b){var c=this._element,d=this.getBodyRect();b&&Rb.addPadding(d,c,a+".padding",1);var e=Hb.clone(d),f=c.getStyle(a+".outline.width");return f>0&&Rb.grow(e,f/2,f/2),this.appendShadowBound(this,e),e},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");"default"===b?this.drawDefaultBody(a):"vector"===b?this.drawVectorBody(a):"default.vector"===b?(this.drawVectorBody(a),this.drawDefaultBody(a)):"vector.default"===b&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getBodyRect();Rb.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,Vb.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b=this._element,c=Hb.getImageAsset(b.getImage()),d=this._defaultRect;if(c&&c.getImage()){if(0!=b.getAngle()&&(a.save(),d=b.getOriginalRect(),Gb.Util.rotateCanvas(a,d,b.getAngle())),this.setShadow(this,a),c.getImage()instanceof Hd){var e,f=c.getImage().frames,g=c.getImage().size,h=0;e=Jd(f,g,0),a.drawImage(e,d.x,d.y,d.width,d.height),this.curInterval=setInterval(function(){h=(h+f.length)%f.length,e=Jd(f,g,h),a.drawImage(e,d.x,d.y,d.width,d.height),h++},100)}else Mc(a,b.getImage(),this.getInnerColor(),d,b,this._network);0!=b.getAngle()&&a.restore()}},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();d=Hb.clone(d);var e=b.getStyle("select.physicalZoom")?1:this._network.getZoom();Rb.addPadding(d,b,"select.padding",1/e),Rb.grow(d,c/2/e,c/2/e),a.lineWidth=c/e,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Vb.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color"),d=this.getBodyRect();if(0!==b&&c){var e=this._element.getAngle();0!=e&&(a.save(),d=this._element.getOriginalRect(),Gb.Util.rotateCanvas(a,d,e)),"rectangle"===this.getStyle("vector.shape")&&Vb.draw3DRect(a,c,b,d),0!=e&&a.restore()}},drawPath:function(a,b,c,d,e,f,g){var h=this._element,i=this.getBodyRect();c&&Rb.addPadding(i,h,b+".padding",1);var j=h.getStyle(b+".outline.width");this.setShadow(this,a),0!=h.getAngle()&&(h instanceof Nd||(i=h.getOriginalRect()),a.save(),Gb.Util.rotateCanvas(a,i,h.getAngle()));var k,l=h.getStyle(b+".fill");if(l){k=this._innerColor&&!uc.hasDefault(this._element)?this._innerColor:h.getStyle(b+".fill.color");var m=h.getStyle(b+".gradient");m?Vb.fill(a,k,m,h.getStyle(b+".gradient.color"),i):a.fillStyle=k}var n=h.getStyle(b+".shape"),o=h.getStyle("group.shape.roundrect.radius");0>o&&(o=10),l&&(a.beginPath(),e?Vb.drawLinePoints(a,e,null,f,g):"roundrect"===n&&"group"===b?Vb.drawVector(a,n,null,i,o):Vb.drawVector(a,n,null,i),a.fill()),j>0&&(a.lineWidth=j,a.lineCap=h.getStyle(b+".cap"),a.lineJoin=h.getStyle(b+".join"),a.strokeStyle=h.getStyle(b+".outline.color"),a.beginPath(),e?Vb.drawLinePoints(a,e,d,f,g):"roundrect"===n&&"group"===b?Vb.drawVector(a,n,d,i,o):Vb.drawVector(a,n,d,i),a.stroke()),0!=h.getAngle()&&a.restore()},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),this._network._transparentSelectionEnable){var e=this.getBodyRect();if(Hb.math.intersects(e,c))return!0}return Rb.intersects(this.getViewRect(),c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Hb.math.intersects(c,a))return!0}return Rb.intersects(a,this.getViewRect())?this.hitCanvasRect(a):!1}}),Gb.canvas.LinkUI=function(a,b){Gb.canvas.LinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.LinkUI",Gb.canvas.ElementUI,{isEditable:function(){return wc.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Gb.canvas.LinkUI.superClass.invalidate.call(this,a)},validateImpl:function(){this.validateBodyBounds(),Gb.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Rb.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Rb.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(this._network._debug&&(this._arrowFromRect=nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"))),c=Rb.unionRect(c,nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(this._network._debug&&(this._arrowToRect=nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))),c=Rb.unionRect(c,nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,c),this.addBodyBounds(c)}},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this._linkPoints;if(b&&!(b.size()<2)){var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===c.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=2*h}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+2*f,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),nd.drawLinkArrow(this,a,b)}},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new tc(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset"),h=Math.floor(g/(e[0]+e[1]));h>2&&(g-=(e[0]+e[1])*h),this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Vb._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var i=this._element.getStyle("link.flow.color");i=i?i:Dd.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=i,Vb._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Vb.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Rb.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=wc.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=wc.createToPoint(this)),this._toPoint},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new Gb.List;if(wc.isOrthogonalOrFlexionalLink(this._element))d=wc.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());null!=e&&(this._hotSpot=wc.fillLoopedPoints(this,e.getBodyRect(),d))}else{if("arc"!==c&&"triangle"!==c&&"parallel"!==c)throw"Can not resolve link type '"+c+"'";this._hotSpot=wc.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},checkAttachments:function(){Gb.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Gb.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return wc.getControlPoint(this._element,this)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(wc.hasControlPoint(b)){var c=wc.getLinkSourceBounds(this),d=wc.getLinkTargetBounds(this);wc.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();return d&&d>0&&Rb.grow(c,d,d),Rb.intersects(this.getViewRect(),c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(0==Rb.intersects(a,this.getViewRect()))return!1;var c=this.getLinkPoints(),d=c.size();if(2==d)for(var e=0;d>e;e+=2){var f=c.get(e);if(d>e+1){var g=c.get(e+1);if(Od.intersectsLine(f.x,f.y,g.x,g.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Rb.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),Gb.canvas.GroupUI=function(a,b){Gb.canvas.GroupUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.GroupUI",Gb.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):Gb.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):Gb.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Vb.draw3DRect(a,c,b,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var c=this.getChildrenRects();if(!c.isEmpty()){var d=a.getStyle("group.shape"),e=Sb[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(c)}}return this._shapeRect?(Rb.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Gb.canvas.GroupUI.superClass.createBodyRect.call(this)}}),Gb.canvas.ShapeNodeUI=function(a,b){Gb.canvas.ShapeNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.ShapeNodeUI",Gb.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(a){this._element._points.size()<2||(this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),nd.drawLinkArrow(this,a,Rb.getPointObject(this._element._points,this._element._segments)))},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();d=Hb.clone(d);var e=b.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(d,b,"select.padding",1/e),Rb.grow(d,c/2,c/2);var f=b.getStyle("vector.outline.width");f>0&&Rb.grow(d,f/2/e,f/2/e),a.lineWidth=c/e,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Vb.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}}}),Gb.canvas.ShapeLinkUI=function(a,b){Gb.canvas.ShapeLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.ShapeLinkUI",Gb.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Gb.List,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._element._points),c.add(b);var e,f,g,h,i,j,k,l=Rb.calculateLineLength(c)/2,m=c.size(),n=0,o=0;for(e=0;m>e;e++)if(h=c.get(e),0!=e){if(g=h,g instanceof md&&(g=g._as),g instanceof Array?(i=Rb.calculateCurveLength(f,g,1),f=g[g.length-1]):(k=h.y-f.y,j=h.x-f.x,i=Math.sqrt(j*j+k*k),f=g),o+=i,l>=n&&o>=l){var p=l-n,q=c.get(e-1);q instanceof md&&(q=q._as,q instanceof Array&&(q=q[q.length-1]));var r=c.get(e),s=Rb.getPathInfo(r,q,p,0,-1).point;this._hotSpot=Hb.clone(s)}n=o}else f=h;var t,u,v;if("lineto"===d);else if("quadto"===d){for(t=new Gb.List(c.get(0)),u=1,pointCount=c.size();u<pointCount;u++)t.add(u<pointCount-1?new Gb.List([c.get(u++),c.get(u)]):c.get(u));c=t}else if("cubicto"===d){for(t=new Gb.List(c.get(0)),u=1,pointCount=c.size();u<pointCount;u++)t.add(u<pointCount-2?new Gb.List([c.get(u++),c.get(u++),c.get(u)]):u<pointCount-1?new Gb.List([c.get(u++),c.get(u)]):c.get(u));c=t}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(v=c.get(0),t=new Gb.List(v),u=1,pointCount=c.size();u<pointCount;u++)if(u<pointCount-1){var h=Hb.clone(c.get(u)),w=h.x,x=h.y,j=w-v.x,k=x-v.y;Math.abs(j)>Math.abs(k)?(h.x=w,h.y=v.y):(h.x=v.x,h.y=x),v=h,t.add(v)}else t.add(c.get(u));c=t}return c}}),Gb.canvas.GridUI=function(a,b){Gb.canvas.GridUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.GridUI",Gb.canvas.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?Gb.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())Gb.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=Hb.clone(a);this.appendShadowBound(this,b),this.addBodyBounds(b)}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(b||0!==c||0!==d){a.beginPath();var e=this._element.getRect(),f=this.getDyeColor("grid.fill.color");if(this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),0!=c&&Vb.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath(),0!=d)for(var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),i=0;g>i;i++)for(var j=0;h>j;j++){var k=this._element.getCellRect(i,j);null!=k&&(a.beginPath(),Vb.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),Gb.canvas.RotatableNodeUI=function(a,b){Gb.canvas.RotatableNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.RotatableNodeUI",Gb.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(Rb.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=Hb.getImageAsset(b.getImage()),d=this.getBodyRect();if(Rb.addPadding(d,this._element,"image.padding",1),c.getImage()){var e=this._element._getOrignalWidth(),f=this._element._getOrignalHeight(),g=this._element._getRotateRect();a.save(),a.translate(d.x-g.x+e/2,d.y-g.y+f/2),a.rotate(this._element._angle*Math.PI/180);var d={x:-e/2,y:-f/2,width:e,height:f};Mc(a,c.getImage(this._innerColor,d.width,d.height),this._innerColor,d,b,this._network),a.restore()}else if(c.getSrc());else if(!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),Gb.canvas.HTMLNodeUI=function(a,b){Gb.canvas.HTMLNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.HTMLNodeUI",Gb.canvas.NodeUI,{checkAttachments:function(){Gb.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.canvas.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),Gb.canvas.HTMLLinkUI=function(a,b){Gb.canvas.HTMLLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.HTMLLinkUI",Gb.canvas.LinkUI,{checkAttachments:function(){Gb.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Gb.canvas.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},Hb.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return Hb.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},hit:function(a,b){return Rb.containsPoint(this._viewRect,a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),!0}}catch(j){Od.disposeHitCanvas()}return c.restore(),!1},dispose:function(){},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e}}),Gb.canvas.BasicAttachment=function(a,b){Gb.canvas.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Hb.ext("twaver.canvas.BasicAttachment",Gb.canvas.Attachment,{paint:function(a){Gb.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),c=this.getOutlineWidth();if(this.getElementUI().setShadow(this,a),(c>0||b)&&(Vb.drawRoundRect(a,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(a.moveTo(this._pointers[0].x,this._pointers[0].y),a.lineTo(this._pointers[1].x,this._pointers[1].y),a.lineTo(this._pointers[2].x,this._pointers[2].y)),a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b)){var d=this.getFillColor(),e=this.getGradient();e?Vb.fill(a,d,e,this.getGradientColor(),this._viewRect):a.fillStyle=d,a.fill()}},validate:function(){Gb.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();this._viewRect=Rb.getRect(this._pointers),this._viewRect=Rb.unionRect(this._viewRect,this._roundRect),a>0&&Rb.grow(this._viewRect,a/2,a/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;
i.width=a+c,i.height=b;var j;if(this._ui._element instanceof Gb.Link){var k,l=this._ui.getLinkPoints();k=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(g)>0&&Math.abs(g)<1?"from"===f?g*=k:"to"===f?g=k*(1-g):(g/=2,g+=.5,g*=k):"from"===f?g=g:"to"===f?g=k-g:g+=k/2;var m,n=Rb.calculatePointInfoAlongLine(l,!0,g,h),o=n.point;n.angle,m="from"===f?this._ui.getFromPoint():"to"===f?this._ui.getToPoint():this._ui._hotSpot,g=o.x-m.x,h=o.y-m.y}if(d>0){var p=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h,!1);var q;if("aboveleft"===p)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("aboveright"===p)i.y=j.y-d-i.height,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("belowleft"===p)i.y=j.y+d,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("belowright"===p)i.y=j.y+d,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("leftabove"===p)i.y=j.y+c-i.height,i.x=j.x-d-i.width,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("leftbelow"===p)i.y=j.y-c,i.x=j.x-d-i.width,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("rightabove"===p)i.y=j.y+c-i.height,i.x=j.x+d,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("rightbelow"===p)i.y=j.y-c,i.x=j.x+d,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("above"===p)i.y=j.y-d-i.height,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y-d},{x:j.x+q,y:j.y-d}];else if("below"===p)i.y=j.y+d,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y+d},{x:j.x+q,y:j.y+d}];else if("left"===p)i.y=j.y-i.height/2,i.x=j.x-d-i.width,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+q},{x:j.x-d,y:j.y-q}];else{if("right"!==p)throw"Can not resolve '"+p+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+q},{x:j.x+d,y:j.y-q}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h,!1),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var r=this.getPadding();0!=r&&Rb.grow(i,r,r),r=this.getPaddingLeft(),0!=r&&(i.x-=r,i.width+=r),r=this.getPaddingRight(),0!=r&&(i.width+=r),r=this.getPaddingTop(),0!=r&&(i.y-=r,i.height+=r),r=this.getPaddingBottom(),0!=r&&(i.height+=r),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return Gb.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Gb.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Gb.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Gb.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Gb.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Gb.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Gb.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Gb.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Gb.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Gb.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Gb.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Gb.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Gb.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Gb.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Gb.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Gb.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Gb.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Gb.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Gb.Defaults.ATTACHMENT_CAP},getJoin:function(){return Gb.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Hb.clone(this._roundRect)},getContentRect:function(){return Hb.clone(this._contentRect)}}),Gb.canvas.LabelAttachment=function(a,b){Gb.canvas.LabelAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.LabelAttachment",Gb.canvas.BasicAttachment,{paint:function(a){var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this._viewRect.x+this._viewRect.width/2,d=this._viewRect.y+this._viewRect.height/2;a.translate(c,d),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-c,-d)}Gb.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var e=this._element.getStyle("label.align"),f=this._element&&this._element.getStyle("label.rotate.angle");0!==f&&(a.save(),Gb.Util.rotateCanvas(a,this._contentRect,f)),Vb.drawText(a,this.text,this._contentRect,this.font,this.getStyle("label.color"),e),(b||0!==f)&&a.restore()},validate:function(){this.font=this.getFont("label.font");var a=this.getLabel(),b=Hb.g.getTextSize(this.font,a),c=this.getMaxLength();0!==c&&b.width>c?(this.text=Hb.g.getCollapseTextInLength(this.font,a,c),this._textSize=Hb.g.getTextSize(this.font,this.text)):(this.text=a,this._textSize=b),Gb.canvas.LabelAttachment.superClass.validate.call(this);var d=this._viewRect,e=this._element&&this._element.getStyle("label.rotate.angle");if(0!==e){var f=new Gb.List;f.add({x:d.x,y:d.y}),f.add({x:d.x+d.width,y:d.y}),f.add({x:d.x+d.width,y:d.y+d.height}),f.add({x:d.x,y:d.y+d.height}),f=this._rotatePointList(f,e,d);var g=Gb.Util.getRect(f);this._viewRect=g}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Gb.canvas.AlarmAttachment=function(a,b){Gb.canvas.AlarmAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.AlarmAttachment",Gb.canvas.BasicAttachment,{paint:function(a){Gb.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),Vb.drawText(a,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Vb.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Gb.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Gb.canvas.LinkHandlerAttachment=function(a,b){Gb.canvas.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.LinkHandlerAttachment",Gb.canvas.BasicAttachment,{paint:function(a){Gb.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),Vb.drawText(a,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Vb.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Gb.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Gb.canvas.IconsAttachment=function(a,b){Gb.canvas.IconsAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.IconsAttachment",Gb.canvas.Attachment,{isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Gb.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element));len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var c,d;for(i=0;i<len;i++){var e=a[i],f=this.iconsOrientation[i]||"right",g=this.iconsPosition[i]||"topleft.bottomright",h=this.iconsXgap[i]||1,j=this.iconsYgap[i]||1,k=this.iconsXoffset[i]||0,l=this.iconsYoffset[i]||0;if(this._ui._element instanceof Gb.Link){var m,n=this._ui.getLinkPoints();m=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(k)>0&&Math.abs(k)<1?"from"===g?k*=m:"to"===g?k=m*(1-k):(k/=2,k+=.5,k*=m):"from"===g?k=k:"to"===g?k=m-k:k+=m/2;var o,p=Rb.calculatePointInfoAlongLine(n,!0,k,l),q=p.point;p.angle,o="from"===g?this._ui.getFromPoint():"to"===g?this._ui.getToPoint():this._ui._hotSpot,k=q.x-o.x,l=q.y-o.y}d=null,c=this._getIconsSize(e,f,h,j),c&&(d=this._network.getPosition(g,this._ui,c,k,l),"top"===f?d.y+=c.height:"left"===f&&(d.x+=c.width)),this.locations.push(d),this.iconsSizes.push(c)}var r=null;for(i=0;i<this.locations.length;i++)d=this.locations[i],c=this.iconsSizes[i],null!=d&&(r=null==r?{x:d.x,y:d.y,width:c.width,height:c.height}:Rb.unionRect(r,{x:d.x,y:d.y,width:c.width,height:c.height}));this._viewRect=r||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b;var s=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(s instanceof Array&&s[i]&&this._viewRect){var t=this._viewRect.x+this._viewRect.width/2,u=this._viewRect.y+this._viewRect.height/2,v=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:t-v/2,y:u-v/2,width:v,height:v}}}},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b,c,d,e=[],f=!1,g=a.length;for(b=0;g>b;b++)c=a[b],Array.isArray(c)?(f=!0,e.push(c)):(d=[c],e.push(d));return f||(e.length=0,e.push(a)),e},_makeArray:function(a,b,c){if(Array.isArray(a))return a;for(var d=[],e=0;b>e;e++)d.push(a||c);return d},paint:function(a){if(Gb.canvas.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var b,c,d,e,f,g,h,i,j,k;for(b=0;b<this.iconsGroups.length;b++)if(c=this.locations[b]){f=c.x,g=c.y,e=this.iconsGroups[b],h=this.colorGroups[b],i=this.iconsOrientation[b],j=this.iconsXgap[b]||1,k=this.iconsYgap[b]||1,d=0;for(var l in e){var m=null,n=null;h&&h.length>d&&(n=h[d++]);var o=Hb.getImageAsset(e[l]);if(null!=o){if("right"===i)m={x:f,y:g,width:o.getWidth(),height:o.getHeight()},f+=m.width+j;else if("left"===i)m={x:f-o.getWidth(),y:g,width:o.getWidth(),height:o.getHeight()},f-=m.width+j;else if("top"===i)m={x:f,y:g-o.getHeight(),width:o.getWidth(),height:o.getHeight()},g-=m.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";m={x:f,y:g,width:o.getWidth(),height:o.getHeight()},g+=m.height+k}var p=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");if(p instanceof Array&&p[b]){a.save();var q=m,f=q.x+q.width/2,g=q.y+q.height/2;a.translate(f,g),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-f,-g),Mc(a,o.getImage(n,m.width,m.height),n,m,this._element,this._network),a.restore()}else Mc(a,o.getImage(n,m.width,m.height),n,m,this._element,this._network);if(this._network._debug){var m=this._viewRect;Vb.strokeRect(a,m,"#FCFC00",1),Vb.strokeRect(a,m,"#FCFC00",1)}}}}}},_getIconsSize:function(a,b,c,d){var e=0,f=0,g=null,h=null,i=null;for(var j in a)if(h=Hb.getImageAsset(a[j])){if("right"===b)g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},e+=g.width+c;else if("left"===b)g={x:e-h.getWidth(),y:f,width:h.getWidth(),height:h.getHeight()},e-=g.width+c;else if("top"===b)g={x:e,y:f-h.getHeight(),width:h.getWidth(),height:h.getHeight()},f-=g.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},f+=g.height+d}i=null==i?Hb.clone(g):Rb.unionRect(i,g)}return i?{width:Math.abs(i.width),height:Math.abs(i.height)}:null}}),Gb.canvas.EditAttachment=function(a,b){Gb.canvas.EditAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.EditAttachment",Gb.canvas.Attachment,{paint:function(a){Gb.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(!(0>=b)){var c=2*this.resizePointSize,d=2*this.resizePointSize,e=this._network.getResizePointFillColor(),f=this._network.getResizePointOutlineWidth(),g=this._network.getResizePointOutlineColor(),h=this._element.getAngle(),i=this._element.getOriginalRect();a.lineWidth=f;for(var j=0;b>j;j++){var k=this.resizingPoints.get(j),l={x:k.x-this.resizePointSize,y:k.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},m=this._getRotateRect(l,h,{x:i.x+i.width/2,y:i.y+i.height/2});a.save(),Gb.Util.rotateCanvas(a,m,h),Od.rect(a,m.x,m.y,c,d),a.restore()}a.fillStyle=e,a.strokeStyle=g,a.fill(),a.stroke()}},paintEditPoints:function(a){var b=this.editPoints.size();if(!(0>=b)){var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;b>f;f++){var g=this.editPoints.get(f);a.beginPath(),Od.circle(a,g.x,g.y,this.editPointSize,d,c),a.closePath()}}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(!(0>=b)){var c=this._network.getRotatePointOutlineColor(),d=this._network.getRotatePointFillColor(),e=this._network.getRotatePointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;b>f;f++){var g=this.rotatePoints.get(f);a.beginPath(),Od.circle(a,g.x,g.y,this.rotatePointSize,d,c),a.closePath()}}},validate:function(){Gb.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Gb.List,this.editPoints=new Gb.List,this.rotatePoints=new Gb.List,this._element instanceof Gb.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Ld)||this._element instanceof Gb.ShapeNode||this._element instanceof Gb.Grid||this._element instanceof Gb.Group||this._addRotatePoint(this._element),this._element instanceof Gb.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Gb.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Gb.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(a){var b=a.getOriginalRect();if(b){var c=this._network.getResizePointSize();if(!(0>=c)){var d=new md([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)}}},_addRotatePoint:function(a){var b=a.getOriginalRect();if(b){var c=this._network.getRotatePointSize();if(!(0>=c)){var d=2*c,e=new Gb.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()-d/2}]),f=a.getAngle();0!=f&&(e=this._rotatePointList(e,f,a.getOriginalRect()));var g=e.get(0),h={x:g.x-d/2,y:g.y-d/2,width:d,height:d},i=this._network.getRotatePointOutlineWidth(),j=this.rotatePointSize+i;Rb.grow(b,j,j);var k=Rb.unionRect(a.getRect(),h);this._viewRect=Rb.unionRect(k,this._viewRect),this.rotatePoints=e}}},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addShapeLinkPoints:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(wc.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new Gb.List;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Rb.getRect(a);if(b){var c=this._network.getEditPointSize();if(!(0>=c)){var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)}}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>g)){var h=g+c;Rb.grow(a,h,h),this._viewRect=Rb.unionRect(a,this._viewRect),1==f?this.resizingPoints=b:this.editPoints=b}},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e},_getRotateRect:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Gb.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Rb.getRect(g)}}),Gb.canvas.HTMLLabelAttachment=function(a,b){Gb.canvas.HTMLLabelAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.canvas.HTMLLabelAttachment",Gb.canvas.LabelAttachment,{validate:function(){var a=this._element.getStyle("attachment.htmllabel.hyperlink");a?(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var b=(this.getFont("label.font"),this.getLabel());this._contentDiv.innerHTML=b,this._contentDiv.style.visibility="hidden",Gb.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._pointers;a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Vb.strokeRect(a,this._contentRect,"#AAAAAA")},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.canvas.HTMLAlarmAttachment=function(a,b){Gb.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none"),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.canvas.HTMLAlarmAttachment",Gb.canvas.AlarmAttachment,{validate:function(){var a=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=a,this._contentDiv.style.visibility="hidden",Gb.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._pointers;a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Vb.strokeRect(a,this._contentRect,"#AAAAAB"),Gb.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.canvas.interaction.BaseInteraction=function(a){this.network=a},Hb.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(a){var b=a.x*this.network.getZoom()-this.network.getViewRect().x,c=a.y*this.network.getZoom()-this.network.getViewRect().y;return{x:b,y:c}},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.getZoom();return{x:a.x*d-this.network.getViewRect().x+b*d,y:a.y*d-this.network.getViewRect().y+c*d,width:a.width*d,height:a.height*d}},getMarkerPoint:function(a){var b;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY}}return b=Ob.isFirefox?{x:a.layerX,y:a.layerY}:{x:a.offsetX,y:a.offsetY}},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Ub.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Ub.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint(a),this._startClient=Ub.getClientPoint(a),this._startLogical&&Ub.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Gb.canvas.interaction.SelectInteraction=function(a){Gb.canvas.interaction.SelectInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.SelectInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(a){if(null!=this.startPoint&&null!=this.endPoint){var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},handle_mousedown:function(a){if(this.network.isValidEvent(a)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!a.shiftKey){var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?Hb.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(Hb.isCtrlDown(a)||c.clearSelection(),this.end(a),this.startPoint=this.network.getLogicalPoint(a),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.end(a);var b=this.network.getLogicalPoint(a);b&&(this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:a}:{kind:"selectBetween",event:a}),this.endPoint=b,this.repaint())},end:function(a){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var b=Rb.getRect([this.startPoint,this.endPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),Gb.canvas.interaction.MoveInteraction=function(a,b){this.lazyMode=b,Gb.canvas.interaction.MoveInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.MoveInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),
this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0)for(var h=g.size(),i=0;h>i;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}else this.parent=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==c||b?null:c},paint:function(a){if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;a.beginPath();var b=this.dragPoint.x-this.pressPoint.x,c=this.dragPoint.y-this.pressPoint.y,d=this.network.getMovableSelectedElements(),e=d.size(),f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;for(var i=0;e>i;i++){var j=d.get(i),k=this.network.getElementUI(j);if(k){var l=this.convertFromUIToMarkerRect(k.getViewRect(),b,c);Od.rect(a,l.x,l.y,l.width,l.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;var l=this.parentRect;Od.rect(a,l.x,l.y,l.width,l.height),a.fill(),a.stroke()}},handle_mousedown:function(a){if(0===a.button&&this.network.isValidEvent(a)&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);this.network.isMovable(b)&&(this.end(a),this.lastPoint=this.network.getLogicalPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove"))}},handle_mouseup:function(a){this.end(a)},handle_mouseout:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements())return void this.end(a);var b=this.network.getLogicalPoint(a);b&&this.lastPoint&&(this.xoffset=b.x-this.lastPoint.x,this.yoffset=b.y-this.lastPoint.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1||(this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()))},end:function(a){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.network.setMovingElement(!1)},d=this.dragPoint.x-this.pressPoint.x,e=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(d,e,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),Gb.canvas.interaction.ScrollInteraction=function(a){Gb.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,a),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},Hb.ext("twaver.canvas.interaction.ScrollInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),Ob.isFirefox?Ub.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):Ub.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),Ub.addEventListener("mouseup","handleMouseUp",window,this),Ub.addEventListener("mousemove","handleMouseMove",window,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),Ob.isFirefox?Ub.removeEventListener("DOMMouseScroll",this.network.getView(),this):Ub.removeEventListener("mousewheel",this.network.getView(),this),Ub.removeEventListener("mouseup",window,this),Ub.removeEventListener("mousemove",window,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(a){("viewRect"==a.property||"canvasSizeChange"==a.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=e.width,g=e.height;if(f>b&&(0>c||c+b>f))return void this.repaint();if(g>a&&(0>d||d+a>g))return void this.repaint();var h=0,i=g>a,j=f>b,k=this.getScrollBarWidth();if(g>a){h=j?a*(a-k)/g:a*a/g;var l=d/(g-a)*(a-h-k);this.vThumbRect={x:b-k,y:l,width:k,height:h}}var m=0;if(f>b){m=i?b*(b-k)/f:b*b/f;var n=c/(f-b)*(b-m-k);this.hThumbRect={x:n,y:a-k,width:m,height:k}}this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mousedown:function(a){if(1!=this.network.isValidEvent(a)){var b=this.getMarkerPoint(a);this.hBarDownPoint=null,this.vBarDownPoint=null,null!=this.vThumbRect&&Rb.containsPoint(this.vThumbRect,b.x,b.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),null!=this.hThumbRect&&Rb.containsPoint(this.hThumbRect,b.x,b.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)}},handle_mouseover:function(a){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(a){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handleMouseUp:function(a){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(a){var b={x:a.screenX,y:a.screenY},c=this.network.getCanvasSize(),d=this.network.getViewRect().height,e=this.network.getViewRect().width,f=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var g=b.x-this.hBarDownPoint.x;return this.hBarDownPoint=b,void this.network.setViewOffSet(g*c.width/(e-f),0)}if(null!=this.vBarDownPoint){var h=b.y-this.vBarDownPoint.y;return this.vBarDownPoint=b,void this.network.setViewOffSet(0,h*c.height/(d-f))}},handleMouseWheel:function(a){var b=!1;a.wheelDelta!==a.wheelDeltaX?(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b)):(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b))},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,Vb.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();null!=this.hThumbRect&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),null!=this.vThumbRect&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}}}),Gb.canvas.interaction.DefaultInteraction=function(a){Gb.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.DefaultInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(this.network.isValidEvent(a)){this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);2===a.detail?this.handleDoubleClicked(a,b):this.handleClicked(a,b)}},handleClicked:function(a,b){Bc.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Bc.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Bc.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Cc(c),e=Cc(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),Gb.canvas.interaction.PanInteraction=function(a){Gb.canvas.interaction.PanInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.PanInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(a){this.network.isValidEvent(a)&&(this.lastPoint=this.getMarkerPoint(a),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer"))},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(this.lastPoint){var b=this.getMarkerPoint(a);if(b){var c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y;this.network.panByOffset(-c,-d),this.lastPoint=b}}},_clear:function(a){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),Gb.canvas.interaction.CreateElementInteraction=function(a,b){b||(b=Gb.Node),this.elementFunction=Gb.Util.isTypeOf(b,Gb.Node)?function(a){var c=new b;return c instanceof Gb.Node&&c.setCenterLocation(a),c}:b,Gb.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.CreateElementInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Gb.canvas.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,Gb.canvas.interaction.EditInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.EditInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(1==this.lazyMode&&null!=this.resizingRect){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0);a.save(),Gb.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),Od.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},isKeyDown:function(a){return Hb.isAltDown(a)},handle_mousedown:function(a){if(0===a.button)if(!this.isKeyDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?this.isKeyDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?this.isKeyDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(b instanceof Gb.ShapeNode){var d=this.getPointIndex(b.getPoints(),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Gb.ShapeLink){var e=new Gb.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Gb.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection}),c.clear()});Gb.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.lazyMode||this.clear()},handle_mousemove:function(a){if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint(a);if(b instanceof Gb.Node){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Gb.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Gb.canvas.LinkUI){var e=this.network.getEditPointSize();if(wc.isOrthogonalLink(c._element)){this.linkUI=c;var f=this.linkUI.getControlPoint();return void(f&&this._contains(d,f,e)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Rb.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(180*Math.atan2(c.x-a.x,a.y-c.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this.linkUI.setControlPoint(this.network.getLogicalPoint(a)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){var b=this.network.getEditPointSize();if(this.node instanceof Gb.ShapeNode){this.shapeNode=this.node;for(var c=this.shapeNode.getPoints(),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.network.getEditPointSize(),c=this.shapeLink.getPoints(),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){var f=this.network.getResizePointSize();return this._contains(a,{x:b,y:c},f)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Rb.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(a){var b,c,d,e,f,g=(new Gb.List,this.network.getRotateScaleWidth()),h=this.network.getRotateScaleHeight(),i=this.network.getRotatePointSize(),j=this.node.getAngle(),k=this.node.getOriginalRect(),l={x:k.x+k.width/2,y:k.y-this.network.getRotatePointOffset()-i},m=this._rotatePoint(l,j,k),n="13px Arial",o=j+"";this.node.getAngle()>=0&&this.node.getAngle()<=180?(c={x:m.x+i,y:m.y},d={x:c.x+g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(c={x:m.x-i,y:m.y},d={x:c.x-g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y});var p=new Gb.List([c,d,e,f]),b=Hb.math.getRect(p);a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=n,a.fillText(o,b.x+b.width/2,b.y+b.height/2)},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Gb.canvas.interaction.CreateLinkInteraction=function(a,b){b||(b=Gb.Link),this.linkFunction=Gb.Util.isTypeOf(b,Gb.Link)?function(a,c){var d=new b;return d instanceof Gb.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Gb.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.CreateLinkInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.convertPointFromView(this.fromNode.getCenterLocation()),d=c.x,e=c.y,f=this.currentPoint.x,g=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Ld&&this.network.isLinkable(b)&&this.network.getElementBox().getSelectionModel().isSelectable(b)?b:null}}),Gb.canvas.interaction.CreateShapeLinkInteraction=function(a,b){Gb.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Gb.ShapeLink),this.linkFunction=Gb.Util.isTypeOf(b,Gb.ShapeLink)?function(a,c,d){var e=new b;return e instanceof Gb.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d&&e.setPoints(d)),e}:b},Hb.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",Gb.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Gb.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){
var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new Gb.List),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(a){if(this.currentPoint){var b,c=new Gb.List;if(b=this.convertPointFromView(this.fromNode.getCenterLocation()),c.add(b,0),this.points&&this.points.size()>0)for(var d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.currentPoint,c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}}}),Gb.canvas.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Gb.ShapeNode),this.shapeNodeFunction=Gb.Util.isTypeOf(b,Gb.ShapeNode)?function(a){var c=new b;return c instanceof Gb.ShapeNode&&a&&c.setPoints(a),c}:b,Gb.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a),this.timeStamp=-1},Hb.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){for(var b,c=new Gb.List,d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.convertPointFromView(this.currentPoint),c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Gb.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.timeStamp=a.timeStamp,this.repaint()}}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.repaint())}}),Gb.canvas.interaction.MagnifyInteraction=function(a,b,c,d,e){Gb.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Ub.createCanvas()},Hb.ext("twaver.canvas.interaction.MagnifyInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network._zoom,c=this.zoom*b,d=this.point.x*b-this.network.viewRect.x-this.xRadius,e=this.point.y*b-this.network.viewRect.y-this.yRadius,f=2*this.xRadius,g=2*this.yRadius,h={x:this.point.x-this.xRadius/c,y:this.point.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=Ub.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),a.save(),a.beginPath(),Vb.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,Vb.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a),this.point&&this.repaint()},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.network.repaintTopCanvas()}}),Gb.canvas.interaction.TouchInteraction=function(a){Gb.canvas.interaction.TouchInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.TouchInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("touchstart","handleTouchstart",a,this),Ub.addEventListener("touchmove","handleTouchmove",a,this),Ub.addEventListener("touchend","handleTouchend",a,this),Ub.addEventListener("touchcancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("touchstart",this.network.getView(),this),Ub.removeEventListener("touchmove",a,this),Ub.removeEventListener("touchend",a,this),Ub.removeEventListener("touchcancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(Ub.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b,this._startTouchClient=this.getMarkerPoint(a),c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Bc.handleLongClicked(self.network,a,c)},1e3)}else a.touches&&2==a.touches.length&&(this._distance=yc.getDistance(a),this._zoom=this.network.getZoom());this._touchCount=a.touches.length},handleTouchmove:function(a){if(Ub.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-yc.getDistance(a))>=Dd.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=yc.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var f=this.network.getLogicalPoint(a),g=this.network.getElementAt(f);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==g&&this.network.getMovableSelectedElements().contains(g)){var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=f,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer)))}else{var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}}else{var h=this.network.getLogicalPoint(a);if(!h)return;var d=h.x-this._startTouchPoint.x,e=h.y-this._startTouchPoint.y;Math.abs(d)>=Dd.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Dd.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=h,this.repaint())}},handleTouchend:function(a){if(Ub.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var f=new Date,g=this.network.getLogicalPoint(a),h=this.network.getElementAt(this._startTouchPoint);g&&f.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,g)<=20&&(h?this.network.getSelectionModel().contains(h)||this.network.getSelectionModel().setSelection(h):this.network.getSelectionModel().clearSelection(),Bc.handleClicked(this.network,a,h),this.timer&&clearTimeout(this.timer),this._endTouchTime&&f.getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,g)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Bc.handleDoubleClicked(this.network,a,h)):(this._endTouchTime=f,this._endTouchPoint=g))}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Gb.canvas.interaction.MSTouchInteraction=function(a){Gb.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Hb.ext("twaver.canvas.interaction.MSTouchInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("MSPointerDown","handleTouchstart",a,this),Ub.addEventListener("MSPointerMove","handleTouchmove",a,this),Ub.addEventListener("MSPointerUp","handleTouchend",a,this),Ub.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("MSPointerDown",a,this),Ub.removeEventListener("MSPointerMove",a,this),Ub.removeEventListener("MSPointerUp",a,this),Ub.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Bc.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20?(Bc.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Ub.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Hb.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Hb.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var f=-1,g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(!(Rb.getDistance(this._startClientPoint,b)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint(a);if(!c)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else{var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}this._startClientPoint=b}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}});var Pd=function(a,b){Hb.registerImage(a,b),Qd[a]=1},Qd={};Pd("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),Pd("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),Pd("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Pd("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Pd("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Pd("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Pd("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),Pd("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Pd("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",
data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),Pd("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});var Od={_hitCanvas:null,getHitCanvas:function(a,b){null==this._hitCanvas&&(this._hitCanvas=Ub.createCanvas()),0==arguments.length&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,b,c){void 0!=b&&(a.fillStyle=b,a.fill()),void 0!=c&&(a.strokeStyle=c,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",null!=e&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return 0>=e?g|=this.OUT_LEFT|this.OUT_RIGHT:c>a?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),0>=f?g|=this.OUT_TOP|this.OUT_BOTTOM:d>b?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if(0==(j=this.outcode(c,d,e,f,g,h)))return!0;for(;0!=(i=this.outcode(a,b,e,f,g,h));){if(0!=(i&j))return!1;if(0!=(i&(this.OUT_LEFT|this.OUT_RIGHT))){var k=e;0!=(i&this.OUT_RIGHT)&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;0!=(i&this.OUT_BOTTOM)&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};Gb.vector={},Gb.vector.interaction={},Gb.vector.Network=function(a){Gb.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new Gb.vector.PhysicalZoomManager(this),this._view=Ub.createView("hidden"),this._rootCanvas=Ub.createCanvas(),this._topCanvas=Ub.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.state={zooming:!1,panning:!1,autoLayout:!1},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Gb.List,this._topAttachmentList=new Gb.List,this._hitTestTopAttachmentList=new Gb.List,this.setElementBox(a?a:new Gb.ElementBox),Ob.isTouchable?Ob.isMSTouchable?this.setDefaultInteractions(!1,!1):this.setTouchInteractions():this.setDefaultInteractions(!1,!1);var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Gb.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a),b.invalidateElementUI(a)})}},this.setToolTipEnabled(Gb.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new md,this._invalidateMap={},this._invalidateAll=!0,b._count=0,b._invalidate=!0,function c(a){b._loopId=requestAnimationFrame(c),b._invalidate&&(b._count++,b._now=a,b.validate())}(0),Gb.imageUtil.addEventListener(this.invalidateElementUIs,this),Ub.addEventListener("mousemove","handle_mousemove",this._view,this)},Hb.ext("twaver.vector.Network",Gb.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug","zoomDivVisible","showShadowInEdit","showAttachOnChg"],_currentSubNetwork:null,_subNetworkAnimate:Gb.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Gb.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Gb.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Gb.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Dd.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Gb.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Gb.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Gb.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Gb.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Gb.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Gb.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Gb.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Gb.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Gb.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Gb.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Gb.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Gb.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Gb.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Gb.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Gb.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Gb.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Gb.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Gb.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Dd.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Dd.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Dd.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Dd.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:Gb.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Gb.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Gb.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Gb.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:Dd.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Dd.NETWORK_SELECTION_TOLERANCE,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Gb.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,_showShadowInEdit:!1,_showAttachOnChg:!0,adjustBounds:function(a){var b=!1,c=this._view.style;if(c.left==a.x+"px"&&c.top==a.y+"px"&&c.width==a.width+"px"&&c.height==a.height+"px"&&(b=!0),Gb.vector.Network.superClass.adjustBounds.apply(this,arguments),1!=b){var d=a.width,e=a.height;this._rootCanvas.setAttribute("width",d),this._rootCanvas.setAttribute("height",e),this._topCanvas.setAttribute("width",d),this._topCanvas.setAttribute("height",e),this.setViewRect(this.viewRect.x,this.viewRect.y,d,e),"undefined"==typeof Gb.gis&&(Gb.Util.makeHighRes(this._rootCanvas),Gb.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()}},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getLabel2:function(a){return a.getStyle("network.label")||a.getName2()},setZoomManager:function(a){var b=this.zoomManager;b!=a&&(this.zoomManager=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",b,a))},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){mc.twm(this);var a,b,c,d,e=this.getElementBox().getDatas()._as,f=e.length,g={},h=this._visibleFunction,i=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(a=0;f>a;a++)c=e[a],g[c._id]=this.isVisible(c,h,i);var j=this.getGraphicsZoom(),k=null,l={x:this.viewRect.x/j,y:this.viewRect.y/j,width:this.viewRect.width/j,height:this.viewRect.height/j};if(this._invalidateAll){if(this._visibleMap)for(a=0;f>a;a++)c=e[a],g[c._id]!==this._visibleMap[c._id]&&(d=this._elementUIMap[c._id],d&&d.invalidate());for(a=0;f>a;a++)c=e[a],d=this._elementUIMap[c._id],d&&d.validate();this._paintAll=!0}else if(this._paintAll){for(b in this._invalidateMap)d=this._elementUIMap[b],d&&d.invalidate();for(b in this._invalidateMap)d=this._elementUIMap[b],d&&d.validate()}else{for(b in this._invalidateMap)d=this._elementUIMap[b],d&&(this._dirtyRects.add(d.getZoomViewRect(!1)),d.invalidate());for(b in this._invalidateMap)d=this._elementUIMap[b],d&&(d.validate(),this._dirtyRects.add(d.getZoomViewRect(!0)))}this._paintAll?k=l:(this._dirtyRects.forEach(function(a){k=null==k?Hb.cloneRect(a):Rb.unionRect(k,a)}),k?(Rb.grow(k,2,2),k=Rb.intersection(k,l)):k=l),this._visibleMap=g,k&&this.paintRoot(k),this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Gb.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);c&&(this._dirtyRects.add(c.getZoomViewRect()),c.dispose(),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),delete this._invalidateMap[b._id]}else if("clear"===a.kind){for(var d in this._elementUIMap)this._elementUIMap[d]&&this._elementUIMap[d].dispose&&this._elementUIMap[d].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),this._paintAll=!0}else"layoutEnd"===a.kind?this.state.layouting=!1:"layouting"===a.kind&&(this.state.layouting=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&(this.invalidateElementUI(b),c.handlePropertyChange(a)),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){"editable"===a.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a),this.invalidateElementUI(b)},this),this.invalidateElementVisibility()},sendToTop:function(a){if(this._box.contains(a)){for(var b=a;b._parent&&this.isVisible(b._parent)&&(b=b._parent););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},getScopeRect:function(a){var b=this.getGraphicsZoom();if(this.zoomManager,"viewsize"===a)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if("viewport"===a){if(this.viewRect)return Hb.cloneRect(this.viewRect)}else if("rootcanvas"===a)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*b,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*b};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?Hb.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){1==this.isLimitViewInCanvas()&&(0>a&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),0>b&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;(null==this.viewRect||a!=this.viewRect.x||b!=this.viewRect.y||c!=this.viewRect.width||d!=this.viewRect.height)&&(this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0)},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},setZoomVisibilityThresholds:function(a){var b=this._visibilityThresholds;this._zoomVisibilityThresholds=a,this.firePropertyChange("zoomVisibilityThresholds",b,a),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var a,b=this.getElementBox().getDatas(),c=b.size();if(c>0){for(var d=0;c>d;d++){var e=b.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(a=a?Rb.unionRect(a,f.getZoomViewRect(!0)):Hb.cloneRect(f.getZoomViewRect(!0)))}}null==a&&(a={x:0,y:0,width:0,height:0});var g=this.getGraphicsZoom();if(this._unionBounds={x:a.x*g,y:a.y*g,width:a.width*g,height:a.height*g},this.realWidth==(a.x+a.width)*g&&this.realHeight==(a.y+a.height)*g)return;this.realWidth=(a.x+a.width)*g,this.realHeight=(a.y+a.height)*g}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return null==a?null:this._elementUIMap[a._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(a){var b=this.getElementUI(a);return b?b.getZoomBodyRect():null},getShapeNodeZoomPoints:function(a,b){if(a._points){var c=this.getElementUI(a);if(c)return c._getZoomPoints()}return null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(!b){if(b=this._elementUIFunction(this,a),!b){var c=a.getClassName(),d=c.substr(c.indexOf(".")+1)+"UI",e=Gb.vector[d];e&&(b=new e(this,a))}b&&(this._elementUIMap[a.getId()]=b)}return this._invalidateMap&&(this._invalidateMap[a._id]=a),b},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(a,b){if(!this._invalidateAll){if(this._invalidateMap[a._id]=a,this.getElementUI(a),a instanceof Ld){var c=a.getAgentLinks();null!=c&&c.forEach(this.invalidateElementUI,this);var d=a.getParent();d instanceof Gb.Group&&this.invalidateElementUI(d)}this.invalidateElementVisibility()}},invalidateElementUIs:function(a){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){if(a instanceof Gb.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(a){var b=this._rootCanvas.getContext("2d");b.save();var c=this.getGraphicsZoom();b.beginPath(),b.rect(Math.round(a.x*c-this.viewRect.x),Math.round(a.y*c-this.viewRect.y),Math.round(a.width*c),Math.round(a.height*c)),b.clip(),b.clearRect(Math.round(a.x*c-this.viewRect.x),Math.round(a.y*c-this.viewRect.y),Math.round(a.width*c),Math.round(a.height*c)),this.visibleList=new Gb.List,this._topAttachmentList=new Gb.List,kd.draw(b,this);var d=this.getElementBox().getDatas()._as,e=d.length,f=this.zoomManager;f._zoomGraphicsBegin(b),this.paintBottom(b,a);var g,h,i,j,k=this._box._layerBox,c=this.getGraphicsZoom(),l={x:this.viewRect.x/c,y:this.viewRect.y/c,width:this.viewRect.width/c,height:this.viewRect.height/c};if(this.adjustLinkIndex(),1===k.size())for(g=0;e>g;g++)h=d[g],
this._visibleMap[h._id]?(i=this._elementUIMap[h._id],this._debug&&Vb.strokeRect(b,a,"red"),null!=i&&this._isInView(i,a)&&(i.paint(b),i.setAttachmentVisible&&i.setAttachmentVisible(!0)),null!=i&&Rb.intersects(l,i.getZoomViewRect())?i.setAttachmentVisible&&i.setAttachmentVisible(!0):i.setAttachmentVisible&&i.setAttachmentVisible(!1),this.visibleList.add(h)):(i=this._elementUIMap[h._id],i&&i.setAttachmentVisible&&i.setAttachmentVisible(!1));else k.forEachByDepthFirst(function(c){for(g=0;e>g;g++)h=d[g],k.getLayerByElement(h)===c&&this._visibleMap[h._id]?(i=this._elementUIMap[h._id],null!=i&&this._isInView(i,a)&&(i.paint(b),i.setAttachmentVisible&&i.setAttachmentVisible(!0)),null!=i&&Rb.intersects(l,i.getZoomViewRect())?i.setAttachmentVisible&&i.setAttachmentVisible(!0):i.setAttachmentVisible&&i.setAttachmentVisible(!1),i&&i.validateZIndex&&i.validateZIndex(k.getDatas().indexOf(c)),this.visibleList.add(h)):i=this._elementUIMap[h._id]},null,this);for(e=this._topAttachmentList.size(),g=0;e>g;g++)j=this._topAttachmentList.get(g),j.getElementUI().paintAttachment(b,j);if(this.paintTop(b,a),void 0!==this._xyz){var e,m=this._xyz,n=m.markText,o=m.type,p=(m.expired,m.innerHTML),q=0,r=0,s=this.viewRect;b.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),b.scale(1/this.getZoom(),1/this.getZoom());var c=this.getZoom();void 0!=n&&null!=n&&""!=n||"2"==o?(b.font="15px Arial sans-serif",e=Hb.g.getTextSize(b.font,p),b.fillStyle="red",q=s.width-e.width,r=s.height-20):(b.font="10px Arial sans-serif",e=Hb.g.getTextSize(b.font,p),q=s.width/2-e.width/2,r=s.height/2),b.fillText(p,q,r)}b.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new md},adjustLinkIndex:function(){var a,b,c=this._box.getDatas()._as,d=this.hasEditInteraction();if(d){for(this._hasAdjustedLinks=!1,i=c.length-1;i>-1;i--)if(a=c[i],a instanceof Gb.Link)if(this.isEditable(a)&&this.getElementUI(a).isEditable()&&this.isSelected(a))b=this._box.getDatas().indexOf(a),this._box.getDatas().removeAt(b),this._box.getDatas().add(a),this._hasAdjustedLinks=!0;else{var e=a.getToNode();b=this._box.getDatas().indexOf(e),this._box.getDatas().removeAt(b),this._box.getDatas().add(e);var f=a.getFromNode();b=this._box.getDatas().indexOf(f),this._box.getDatas().removeAt(b),this._box.getDatas().add(f)}}else if(this._hasAdjustedLinks){for(i=c.length-1;i>-1;i--)if(a=c[i],a instanceof Gb.Link){var e=a.getToNode();b=this._box.getDatas().indexOf(e),this._box.getDatas().removeAt(b),this._box.getDatas().add(e);var f=a.getFromNode();b=this._box.getDatas().indexOf(f),this._box.getDatas().removeAt(b),this._box.getDatas().add(f)}this._hasAdjustedLinks=!1}},paintBottom:function(a,b){},paintTop:function(a,b){},_isInView:function(a,b){return Rb.intersects(b,a.getZoomViewRect())},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){for(var b=this.markerList.size(),c=0;b>c;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint2:function(a){return this.zoomManager._getLogicalPoint(a)},getLogicalPoint:function(a){return this.zoomManager._getLogicalPoint(a,!0)},getElementAt:function(a){if(null==this.visibleList)return null;var b;if(a.target?b=this.getLogicalPoint2(a):a.event?a.event.target&&(b=this.getLogicalPoint2(a.event)):b=a,null!=this._hitTestTopAttachmentList)for(var c=this._hitTestTopAttachmentList.size(),d=c-1;d>=0;d--){var e=this._hitTestTopAttachmentList.get(d);if(e.hit(b.x,b.y))return e.getElement()}if(null!=this.visibleList)for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);if(i&&i.hit(b.x,b.y))return h}return null},getElementsAt:function(a){var b=new Gb.List;if(null==this.visibleList)return null;var c;if(a.target?c=this.getLogicalPoint2(a):a.event?a.event.target&&(c=this.getLogicalPoint2(a.event)):c=a,null!=this._hitTestTopAttachmentList)for(var d=this._hitTestTopAttachmentList.size(),e=d-1;e>=0;e--){var f=this._hitTestTopAttachmentList.get(e);f.hit(c.x,c.y)&&b.add(f.getElement())}if(null!=this.visibleList)for(var g=this.visibleList.size(),h=g-1;h>=0;h--){var i=this.visibleList.get(h),j=this.getElementUI(i);j&&j.hit(c.x,c.y)&&b.add(i)}return b},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return d=a.target?this.getLogicalPoint2(a):a.event?this.getLogicalPoint2(a.event):a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,b,c,d){var e=new Gb.List;if(null==this.visibleList)return e;d=void 0===d?!0:d;for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);i&&(!c||c(i._element))&&(d&&this.isSelectable(i._element)||!d)&&(b?i.intersects(a)&&e.add(h):Rb.contains(a,i.getZoomViewRect(jc))&&e.add(h))}return e},getPosition:function(a,b,c,d,e,f){var g,h=b instanceof Gb.vector.ElementUI?b:this.getElementUI(b);if(h)if("from"===a||"to"===a){if(h.getFromPosition&&(g="from"===a?h.getFromPosition(d,e):h.getToPosition(d,e)))return c?{x:g.x-c.width/2,y:g.y-c.height/2}:g}else g="hotspot"===a?f?h.getZoomHotSpot(this.zoomManager):h.getHotSpot():Tb.get(a,f?h.getZoomBodyRect():h.getBodyRect(),c);if(!g&&b.getRect&&(g=Tb.get(a,b.getRect(),c)),g)return{x:g.x+d,y:g.y+e};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){if(Ob.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY),1==this.isHScrollBarVisible()&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)&&a.isMovable()?this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Gb.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Ld){var f=this.getElementUI(e);f&&(b=Rb.unionRect(b,f.getViewRect()))}}return b},isVisibleAttachment:function(a){return!this.state.zooming&&!this.state.panning&&!this.state.layouting},isVisible:function(a,b,c){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(3!==arguments.length&&(b=this._visibleFunction),b&&!b(a))return!1;if(!(c||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(uc.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(a))return!1;if(a instanceof Gb.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,c)||!this.isVisible(a._toAgent,b,c))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var d=a._parent;d&&!d.ISubNetwork;){if(d instanceof Gb.Group&&(!d.isExpanded()||!this.isVisible(d,b,c)))return!1;d=d._parent}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a,b){return null==this._linkableFunction||this._linkableFunction(a,b)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a,b){var c=[new Gb.vector.interaction.DefaultInteraction(this,a)];b&&c.push(new Gb.vector.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setTouchInteractions:function(){this.setInteractions([new Gb.vector.interaction.DefaultInteraction(this,!1),new Gb.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Gb.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a,b){var c=[new Gb.vector.interaction.EditInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)];b&&c.push(new Gb.vector.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setCreateElementInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateElementInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateLinkInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateShapeLinkInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateShapeNodeInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Gb.vector.interaction.DefaultInteraction(this),new Gb.vector.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement())return void Ac.hideToolTip();var c=b.getElementAt(a);if(b._preElement!==c){if(b._preElement=c,c){var d=b.getToolTip(c);return void Ac.showToolTip({x:a.pageX,y:a.pageY},d,function(a){var c=b._view.getBoundingClientRect(),d=a.getBoundingClientRect();d.width+d.left>c.width+c.left&&(a.style.left=c.width+c.left-d.width+(Mb.documentElement.scrollLeft||Mb.body.scrollLeft)+"px"),d.height+d.top>c.height+c.top&&(a.style.top=c.height+c.top-d.height+(Mb.documentElement.scrollTop||Mb.body.scrollTop)+"px")})}Ac.hideToolTip()}},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a,b){if(a=this.checkZoom(a),this.isAsyncZoomAndViewRect())var c=this._zoomMap[this._currentSubNetwork].zoom;else var c=this._zoom;if(a!=c){var d=this.getViewRect();b||(b={x:d.width/2,y:d.height/2});var e=this.viewRect,f=b.x-(b.x+e.x)*a/c,g=b.y-(b.y+e.y)*a/c;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=a:this._zoom=a,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-f,-g,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange("zoom",c,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange("zoom",c,this._zoom),this.state.zooming=!0;var h=null,i=this;h?clearTimeout(h):h=setTimeout(function(){h=null,i.state.zooming=!1,i.invalidateElementUIs(!0)},100)}},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var a=this._zoomMap[this._currentSubNetwork];return a||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(a){return this.zoomManager.getSizeZoom(a)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(a){if(!(this._unionBounds.width<=0||this._unionBounds.width<=0)){var b=this.getZoom(),c=this._unionBounds,d=c.width/b,e=c.height/b,f=this.viewRect.width/d,g=this.viewRect.height/e,h=Math.min(f,g);this.setZoom(h);var i=this.getZoom(),j=this.viewRect.width/2-this._unionBounds.width/2*i/b,k=this.viewRect.height/2-this._unionBounds.height/2*i/b;if(this.setViewRect(this._unionBounds.x*i/b-j,this._unionBounds.y*i/b-k,this.viewRect.width,this.viewRect.height),1!=this.getLocationZoom()){var l=null==arguments[1]?5:arguments[1];if(l>0){l--;var m=this;setTimeout(function(){m.zoomOverview(a,l)},25)}}}},zoomReset:function(a){this.setZoom(1,a)},zoomIn:function(a){this.setZoom(1.2*this.getZoom(),a)},zoomOut:function(a){this.setZoom(this.getZoom()/1.2,a)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(uc.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){if(Gb.animate.AnimateManager.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var d=new Gb.animate.AnimateSubNetwork(this,a,c);Gb.animate.AnimateManager.start(d)}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var b=this._viewRectMap[this._currentSubNetwork];this._viewRectMap[this._currentSubNetwork]=b?this.viewRect:this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var c=this._currentSubNetwork;if(this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",c,a),this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var b=this._viewRectMap[this._currentSubNetwork];this.setViewRect(b.x,b.y,b.width,b.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0}},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=uc.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Hb.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Gb.Group&&e.setExpanded(!0);var f=b.getViewRect();if(f){var g,h=b.getZoomViewRect(this.zoomManager);g=f.x==h.x&&f.y==h.y&&f.width==h.width&&f.height==h.height?{x:f.x*this.getGraphicsZoom(),y:f.y*this.getGraphicsZoom(),width:f.width*this.getGraphicsZoom(),height:f.height*this.getGraphicsZoom()}:h,Rb.intersects(this.viewRect,g)||this.isVisible(a)&&Hb.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])}}},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Dd.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c,d,e,f){c||(c=Ub.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var g=c.getContext("2d");if(g.translate(-e,-f),g.clearRect(0,0,a,b),kd.draw(g,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;a/this.realWidth*this.getGraphicsZoom(),b/this.realHeight*this.getGraphicsZoom(),g.scale(d,d);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new Gb.List;var j,k,l,m,n,o,p=this.getElementBox().getLayerBox(),q=p.getRoots(),r=q.size();if(this.adjustLinkIndex(),1===r)for(l=0;i>l;l++)m=h[l],this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));else for(j=0;r>j;j++)for(k=q.get(j),l=0;i>l;l++)m=h[l],p.getLayerByElement(m)===k&&this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));for(i=this._topAttachmentList.size(),l=0;i>l;l++)o=this._topAttachmentList.get(l),o.getElementUI().paintAttachment(g,o);return c},toCanvasByRegion:function(a,b,c){c||(c=Ub.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");if(f.clearRect(0,0,d,e),kd.draw(f,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;f.save(),f.scale(b,b),f.beginPath(),f.translate(-a.x,-a.y);var g=this.getElementBox().getDatas()._as,h=g.length;this._topAttachmentList=new Gb.List;var i,j,k,l,m,n,o=this.getElementBox().getLayerBox(),p=o.getRoots(),q=p.size();if(this.adjustLinkIndex(),1===q)for(k=0;h>k;k++)l=g[k],this._visibleMap[l._id]&&(m=this._elementUIMap[l._id],null!=m&&Rb.intersects(a,m.getZoomViewRect())&&m.paint(f));else for(i=0;q>i;i++)for(j=p.get(i),k=0;h>k;k++)l=g[k],o.getLayerByElement(l)===j&&this._visibleMap[l._id]&&(m=this._elementUIMap[l._id],null!=m&&Rb.intersects(a,m.getZoomViewRect())&&m.paint(f));for(h=this._topAttachmentList.size(),k=0;h>k;k++)n=this._topAttachmentList.get(k),n.getElementUI().paintAttachment(f,n);return f.restore(),c},getGroupChildrenRects:function(a){return this.zoomManager._getGroupChildrenRects(a)},convertPointFromView:function(a){return this.zoomManager._convertPointFromView(a)},getOffset:function(a,b){return this.zoomManager._getOffset(a,b)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},moveElementsToCenter:function(){if(this._limitViewInCanvas){var a=this.viewRect,b=this._unionBounds,c=a.x+a.width/2-b.x-b.width/2,d=a.y+a.height/2-b.y-b.height/2;Gb.Util.moveElements(this._box.toDatas(),c,d)}else{var c=this.viewRect.width/2-this._unionBounds.width/2,d=this.viewRect.height/2-this._unionBounds.height/2;this.setViewRect(this._unionBounds.x-c,this._unionBounds.y-d,this.viewRect.width,this.viewRect.height)}},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){this._invalidate&&(Kb||0!==this._view.offsetWidth||0!==this._view.offsetHeight)&&(this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1)},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){},setMovingElement:function(a){if(a!=this._movingElement){var b=this._movingElement;this._movingElement=a,this.firePropertyChange("movingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(a){if(a!=this._editingElement){var b=this._editingElement;this._editingElement=a,this.firePropertyChange("editingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){Gb.imageUtil.removeEventListener(this.invalidateElementUIs,this),this.setInteractions(null),cancelAnimationFrame(this._loopId)},handle_mousemove:function(a){var b=this.getElementAt(a),c=this.__preElement,d=Cc(c),e=Cc(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this),this.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this),this.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this),this.onMouseMove(b,a),this.__preElement=b}}),Gb.vector.Overview=function(a){Gb.vector.Overview.superClass.constructor.apply(this,a),this._view=Ub.createView(),this._rootDiv=Ub.createDiv(),this._imageCanvas=Ub.createCanvas(),this._imageDiv=Ub.createDiv(),this._maskCanvas=Ub.createCanvas(),this._selectDiv=Ub.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Ub.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=Ub.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(a),Ob.isTouchable?Ob.isMSTouchable?new Gb.vector.OverviewMSTouchInteraction(this):(new Gb.vector.OverviewTouchInteraction(this),new Gb.vector.OverviewInteraction(this)):new Gb.vector.OverviewInteraction(this)},Hb.ext("twaver.vector.Overview",Gb.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Dd.OVERVIEW_FILL_COLOR,_outlineColor:Dd.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Dd.OVERVIEW_OUTLINE_WIDTH,_selectColor:Dd.OVERVIEW_SELECT_COLOR,_selectWidth:Dd.OVERVIEW_SELECT_WIDTH,_padding:Dd.OVERVIEW_PADDING,_animate:Dd.OVERVIEW_ANIMATE,_maxPackingWidth:Dd.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Dd.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Ub.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Ub.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property||"canvasSizeChange"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Hb.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Hb.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Rb.grow(a,-this._padding,-this._padding),b&&(Ub.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var c=this._network.getGraphicsZoom(),d=this._network._unionBounds;d=Rb.unionRect(d,{x:0,y:0,width:d.x,height:d.y}),d={x:d.x/c,y:d.y/c,width:d.width/c,height:d.height/c};var e={x:this._network.viewRect.x/c,y:this._network.viewRect.y/c,width:this._network.viewRect.width/c,height:this._network.viewRect.height/c},f=d,g=Math.min(a.width/f.width,a.height/f.height),h=f.width*g,i=f.height*g,j=f.width*g,k=f.height*g,l=a.x+(a.width-j)/2,m=a.y+(a.height-k)/2;if(this._isNetworkDirty){var n={x:l,y:m,width:j,height:k};this._network.toCanvas(h,i,this._exportImageCanvas,g,f.x*g,f.y*g),this._imageCanvas.setAttribute("width",j),this._imageCanvas.setAttribute("height",k),this._imageCtx.drawImage(this._exportImageCanvas,0,0,h,i),Ub.setDiv(this._imageDiv,n,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var o={x:(e.x-f.x)*g,y:(e.y-f.y)*g,width:e.width*g,height:e.height*g},p=Ub.setCanvas(this._maskCanvas,l,m,j,k);p.lineWidth=0,p.fillStyle=this._fillColor,Vb.drawVector(p,"rectangle",null,l,m,j,k),p.closePath(),p.fill(),p.stroke(),p.clearRect(l+o.x,m+o.y,o.width,o.height),p.lineWidth=this._outlineWidth,p.strokeStyle=this._outlineColor;var q=o.width-2*this._outlineWidth,r=o.height-2*this._outlineWidth;q=Math.min(q,j-2-o.x-this._outlineWidth),r=Math.min(r,k-2-o.y-this._outlineWidth),Vb.drawVector(p,"rectangle",null,l+o.x+this._outlineWidth,m+o.y+this._outlineWidth,q,r),p.closePath(),p.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;if(Rb.containsPoint(c,a)){var d=this._network.getGraphicsZoom(),e=this._network._unionBounds;e=Rb.unionRect(e,{x:0,y:0,width:e.x,height:e.y}),e={x:e.x/d,y:e.y/d,width:e.width/d,height:e.height/d};var f={x:this._network.viewRect.x/d,y:this._network.viewRect.y/d,width:this._network.viewRect.width/d,height:this._network.viewRect.height/d},g=Rb.unionRect(e,f);this._network.centerByLogicalPoint((g.x+(a.x-c.x)/c.width*g.width)*d,(g.y+(a.y-c.y)/c.height*g.height)*d,b),this._invalidateMask()}}}),Gb.vector.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.network.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),yc.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=yc.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Gb.vector.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Hb.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate);
}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.vector.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("mousedown","handleMousedown",this.view,this)},Hb.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Hb.isCtrlDown(a)&&(this.startPoint=this.endPoint,Ub.setVisible(this.overview._selectDiv,!0)),Ub.addEventListener("mousemove","handleMousemove",this.view,this),Ub.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Hb.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f);this.network.setZoom(g*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var h=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network.getCanvasSize().height*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);Hb.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Ub.setVisible(this.overview._selectDiv,!1),Ub.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Ub.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("mousemove",this.view,this),Ub.removeEventListener("mouseup",this.view,this))}}),Gb.vector.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new Gb.List,this._bodyBounds=new Gb.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Hb.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){},handleSelectionChange:function(a){},invalidate:function(a){void 0===a&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom(),this.setAttachmentVisible&&this.setAttachmentVisible(!1))},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._glowBlur=this._element.getStyle("glow.blur"),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var a=this;if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var b;this._bodyBounds.forEach(function(a){b=Rb.unionRect(b,a)}),null==b&&(b=Hb.cloneRect(this._element.getLocation()),b.width=0,b.height=0),this._unionBodyBounds={x:b.x,y:b.y,width:b.width,height:b.height},this._attachments.forEach(function(c){b=c instanceof Gb.vector.EditAttachment?c.getElementUI()instanceof Gb.vector.LinkUI?Rb.unionRect(b,c._viewRect):Rb.unionRect(b,a._network.zoomManager._reverseElementZoomRect(a,c._viewRect)):c.getElementUI()instanceof Gb.vector.LinkUI?Rb.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(c,c._viewRect)):c.getElementUI()instanceof Gb.vector.GroupUI&&c.getElementUI()._shapeRect?c instanceof Gb.vector.IconsAttachment?Rb.unionRect(b,c._viewRect):Rb.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(c,c._viewRect)):Rb.unionRect(b,c._viewRect)}),this._viewRect=b}},validateImpl:function(){},setGlow:function(a,b){"glow"===this._element.getStyle("outer.style")&&(b.shadowColor=this._outerColor,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=this._glowBlur)},clearGlow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},setShadow:function(a,b){var c=this._network.zoomManager,d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur)return b;if(d||this._network._showShadowInEdit){var e=c.getGraphicsZoom(),f=c.getSizeZoom();e*=f,e>1&&(e=1),b.shadowOffsetX=this._shadowXOffset*e,b.shadowOffsetY=this._shadowYOffset*e,b.shadowBlur=this._shadowBlur*e,b.shadowColor=this._shadowColor}return b},clearShadow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){var d=this._network.zoomManager,e=d.getGraphicsZoom(),f=d.getSizeZoom();e*=f,e>1&&(e=1),this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var g=this._shadowBlur;g=Math.ceil(g/e),Rb.grow(b,g+1,g+1)}return b},appendGlowBound:function(a,b){if("glow"===this._element.getStyle("outer.style")){var c=this._network.zoomManager,d=c.getGraphicsZoom(),e=c.getSizeZoom();d*=e,d>1&&(d=1);var f=this._glowBlur;f=Math.ceil(f/d),Rb.grow(b,f+1,f+1)}},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(a){this._attachments.add(a),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Gb.vector.LabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._network.getLabel2(this._element);null!=a&&""!==a?this._label2Attachment||(this._label2Attachment=new Gb.vector.Label2Attachment(this,Dd.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Gb.vector.AlarmAttachment(this,Dd.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Gb.vector.IconsAttachment(this,Dd.SHOW_ICON_IN_ATTACHMENT_DIV),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Gb.vector.EditAttachment(this,Dd.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Gb.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),this.clearGlow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore(),this._network._debug&&Vb.strokeRect(a,this.getZoomBodyRect(),"orange")},paintBody:function(a){},getZoomBodyRect:function(a){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),Hb.clone(this._zoomHotSpot)},getZoomPointers:function(a,b){return this._network.zoomManager._getZoomPointers(a,this,b)},_getZoomViewRect:function(a,b,c){var d=this._network.zoomManager;if(b){var e=Hb.cloneRect(d._getAttachmentZoomRect(b,a));return e}var f=d.getLocationZoom(),g=d.getSizeZoom(this),h=this._bodyRect?this._bodyRect:this.getBodyRect();a=a||{x:h.x,y:h.y,width:0,height:0};var i=h.x+h.width/2,j=h.y+h.height/2;return{x:i*f+(a.x-i)*g,y:j*f+(a.y-j)*g,width:a.width*g,height:a.height*g}},getZoomViewRect:function(a){var b=this._network.zoomManager,c=b.getLocationZoom();if(b.getGraphicsZoom(),1==c)return Hb.cloneRect(this._viewRect);if(!this._zoomViewRect||a){var d,e=this._getZoomViewRect(Hb.cloneRect(this._unionBodyBounds),!1);d=Rb.unionRect(d,e),this._attachments.forEach(function(a){d=a instanceof Gb.vector.EditAttachment?Rb.unionRect(d,a._viewRect):Rb.unionRect(d,a.getZoomViewRect())}),this._zoomViewRect=d}return Hb.cloneRect(this._zoomViewRect)},paintAttachments:function(a){a.beginPath();for(var b=this._attachments.size(),c=0;b>c;c++){var d=this._attachments.get(c);(this._network.isShowAttachOnChg()||this._network.isVisibleAttachment(d))&&(1==this._hitTest&&0==d.isShowOnTop()&&this.paintAttachment(a,d),1==this._intersectTest&&this.paintAttachment(a,d),0==this._hitTest&&0==this._intersectTest&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d)))}},paintAttachment:function(a,b){var c=this._network.zoomManager;c.isAttachmentVisible(this._element)&&(b!=this._labelAttachment&&b!=this._label2Attachment||c.isLabelVisible(this._element))&&(b!=this._alarmAttachment||c.isAlarmBalloonVisible(this._element))&&(a.beginPath(),b.paint(a),this.clearShadow(a))},getViewRect:function(){return Hb.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return Hb.cloneRect(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(a){return void 0==a&&(a=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),a?Hb.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?Hb.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return Rb.contains(a,this.getZoomViewRect())?!0:!1},hitCanvasRectAtBody:function(a){a.width<1&&(a.width=1),a.height<1&&(a.height=1);var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);if(c.save(),c.translate(-a.x,-a.y),this._element.getImage){var d=Hb.getImageAsset(this._element.getImage());if(d&&d.getImage()instanceof Hd)return 1}this.paintBody(c);try{for(var e=c.getImageData(0,0,a.width,a.height),f=e.data,g=0;g<e.width;g++)for(var h=0;h<e.height;h++){var i=4*(h*e.width+g),j=f[i+3];if(0!==j)return c.restore(),1}}catch(k){if(Od.disposeHitCanvas(),Rb.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),1}}catch(j){Od.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var b=Rb.intersection(a,this.getZoomViewRect()),c=this.hitCanvasRectAtBody(b);if(1==c)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return 1==d?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==c)},hitCanvasPoint:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this.getZoomViewRect(),c))return!1;this._hitTest=!0;var e=this.hitCanvasRect(c);return this._hitTest=!1,e},hitTest:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this.getZoomViewRect(),c))return null;for(var e=Rb.intersection(c,this.getZoomViewRect()),f=this._attachments.size(),g=0;f>g;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}var i=this.hitCanvasRectAtBody(e);return 1==i?this:0==i?this:null},dispose:function(){this._attachments.forEach(function(a){a.dispose()}),this._attachments.clear()}}),Gb.vector.NodeUI=function(a,b){Gb.vector.NodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.NodeUI",Gb.vector.ElementUI,{invalidate:function(a){this.curInterval&&clearInterval(this.curInterval),Gb.vector.NodeUI.superClass.invalidate.call(this,a)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Gb.vector.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Rb.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Gb.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");"default"===a?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===a?this.addBodyBounds(this.getVectorBody()):"default.vector"===a?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===a&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&"border"===this.getStyle("outer.style")&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=this.getBodyRect();if(!a.getImage()||"string"==typeof a.getImage()&&!Hb.getImageAsset(a.getImage()))return b;Rb.addPadding(b,this._element,"image.padding",1);var c=Hb.cloneRect(b);return this.appendGlowBound(this,c),this.appendShadowBound(this,c),b=c},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width"),d=b.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();if(c>0){c="select"===a?c/d:c;var e=this.getBodyRect();Rb.addPadding(e,b,a+".padding","select"===a?1/d:1);var f=Hb.cloneRect(e);return Rb.grow(f,2*c,2*c),f}return null},getPathRect:function(a,b){var c=this._element,d=this.getBodyRect();this._network.zoomManager.getSizeZoom(),b&&Rb.addPadding(d,c,a+".padding",1);var e=Hb.cloneRect(d),f=c.getStyle(a+".outline.width");if(f>0)if(this._getZoomPoints){for(var g=this._element._points,h=g.size(),i=0,j=0;h>j;j++){if(0==j)var k=g.get(j),l=g.get(h-1),m=g.get(j+1);else if(j==h-1)var k=g.get(j),l=g.get(j-1),m=g.get(0);else var k=g.get(j),l=g.get(j-1),m=g.get(j+1);var n=Rb.getCenterPoint(l,m),o=Rb.getAngle(n,k),p=Math.abs(5*(f+1)*Math.sin(o));i=p>i?p:i,p=Math.abs(5*(f+1)*Math.cos(o)),i=p>i?p:i}Rb.grow(e,i,i)}else Rb.grow(e,f/2,f/2);return this.appendGlowBound(this,e),this.appendShadowBound(this,e),e},getZoomPathRect:function(a,b){var c=this._element,d=this.getZoomBodyRect();this._network.zoomManager.getSizeZoom(),b&&Rb.addPadding(d,c,a+".padding",1);var e=Hb.cloneRect(d),f=c.getStyle(a+".outline.width");if(f>0)if(this._getZoomPoints){for(var g=this._getZoomPoints(),h=g.size(),i=0,j=0;h>j;j++){if(0==j)var k=g.get(j),l=g.get(h-1),m=g.get(j+1);else if(j==h-1)var k=g.get(j),l=g.get(j-1),m=g.get(0);else var k=g.get(j),l=g.get(j-1),m=g.get(j+1);var n=Rb.getCenterPoint(l,m),o=Rb.getAngle(n,k),p=Math.abs(5*(f+1)*Math.sin(o));i=p>i?p:i,p=Math.abs(5*(f+1)*Math.cos(o)),i=p>i?p:i}Rb.grow(e,i,i)}else Rb.grow(e,f/2,f/2);return this.appendGlowBound(this,e),this.appendShadowBound(this,e),e},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");"default"===b?this.drawDefaultBody(a):"vector"===b?this.drawVectorBody(a):"default.vector"===b?(this.drawVectorBody(a),this.drawDefaultBody(a)):"vector.default"===b&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawOuterBorder(a),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getZoomBodyRect();Rb.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,Vb.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b,c=this._element;if(c.getImage()&&("string"!=typeof c.getImage()||(b=Hb.getImageAsset(c.getImage())))&&(!this._shapeRect||c.getStyle("group.expend.image")&&("string"!=typeof c.getStyle("group.expend.image")||(b=Hb.getImageAsset(c.getStyle("group.expend.image")))))){var d=this.getZoomBodyRect();if(Rb.addPadding(d,this._element,"image.padding",1),0!=c.getAngle()&&(a.save(),d=c.getOriginalRect(),d=this._network.zoomManager._getElementZoomRect(this,d),Gb.Util.rotateCanvas(a,d,c.getAngle())),this.setGlow(this,a),this.setShadow(this,a),b&&b.getImage()instanceof Hd){var e,f=b.getImage().frames,g=b.getImage().size,h=0;e=Jd(f,g,0),a.drawImage(e,d.x,d.y,d.width,d.height),this.curInterval=setInterval(function(){h=(h+f.length)%f.length,e=Jd(f,g,h),a.drawImage(e,d.x,d.y,d.width,d.height),h++},100)}else this._shapeRect?Mc(a,c.getStyle("group.expend.image"),this.getInnerColor(),d,c,this._network):Mc(a,c.getImage(),this.getInnerColor(),d,c,this._network);0!=c.getAngle()&&a.restore()}},drawSelectBorder:function(a){this.clearGlow(a);var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getZoomBodyRect();d=Hb.cloneRect(d);var e=b.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(d,b,"select.padding",1/e),Rb.grow(d,c/2/e,c/2/e),a.lineWidth=c/e,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Vb.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");if(0!==b&&c&&"rectangle"===this.getStyle("vector.shape")){var d=this.getZoomBodyRect(),e=this._element.getAngle();if(0!=e){a.save();var f=this._element.getOriginalRect();f=this._network.zoomManager._getElementZoomRect(this,f),Gb.Util.rotateCanvas(a,f,e)}Vb.draw3DRect(a,c,b,d),0!=e&&a.restore()}},drawPath:function(a,b,c,d,e,f,g){var h=this._network.zoomManager,i=this._element,j=null;j="group"==b?this._shapeRect:this.getZoomBodyRect(),c&&Rb.addPadding(j,i,b+".padding",1);var k=i.getStyle(b+".outline.width");this.setGlow(this,a),this.setShadow(this,a),0!=i.getAngle()&&(i instanceof Nd||(j=i.getOriginalRect(),j=h._getElementZoomRect(this,j)),a.save(),Gb.Util.rotateCanvas(a,j,i.getAngle()));var l,m=i.getStyle(b+".fill");if(m){l=this._innerColor&&!uc.hasDefault(this._element)?this._innerColor:i.getStyle(b+".fill.color");var n=i.getStyle(b+".gradient");n?Vb.fill(a,l,n,i.getStyle(b+".gradient.color"),j):a.fillStyle=l}var o=i.getStyle(b+".shape"),p=i.getStyle("group.shape.roundrect.radius");0>p&&(p=10),m&&(a.beginPath(),e?Vb.drawLinePoints(a,e,null,f,g):"roundrect"===o&&"group"===b?Vb.drawVector(a,o,null,j,p):Vb.drawVector(a,o,null,j),a.fill()),k>0&&(a.lineWidth=k,a.lineCap=i.getStyle(b+".cap"),a.lineJoin=i.getStyle(b+".join"),a.strokeStyle=i.getStyle(b+".outline.color"),a.beginPath(),e?Vb.drawLinePoints(a,e,d,f,g):"roundrect"===o&&"group"===b?Vb.drawVector(a,o,d,j,p):Vb.drawVector(a,o,d,j),a.stroke()),0!=i.getAngle()&&a.restore()},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),this._network._transparentSelectionEnable){var e=this.getBodyRect();if(Hb.math.intersects(e,c))return!0}return Rb.intersects(this.getZoomViewRect(),c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Hb.math.intersects(c,a))return!0}return Rb.intersects(a,this.getZoomViewRect())?this.hitCanvasRect(a):!1}}),Gb.vector.LinkUI=function(a,b){Gb.vector.LinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.LinkUI",Gb.vector.ElementUI,{isEditable:function(){return!0},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Gb.vector.LinkUI.superClass.invalidate.call(this,a)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,Gb.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),Gb.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Rb.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Rb.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowFromRect=nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),0,0,this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowFromRect=nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"),this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"),this._network.zoomManager)))),b.getStyle("arrow.to")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowToRect=nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),0,0,this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowToRect=nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"),this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"),this._network.zoomManager)))),this.appendShadowBound(this,c),this.addBodyBounds(c),this._growLinkJoinBounds(c,e)}},_growLinkJoinBounds:function(a,b){},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this.getLinkPoints();if(b&&!(b.size()<2)){var c=this._element,d=c.isBundleAgent()&&c.getStyle("link.agent"),e=c.getStyle(d?"link.agent.width":"link.width"),f=e;if(this._outerColor&&"border"===this.getStyle("outer.style")){var g=c.getStyle("outer.width");f+=2*g}var h=!this._editAttachment&&"border"===c.getStyle("select.style")&&this._network.isSelected(this._element);if(h){var i=c.getStyle("select.width");f+=2*i}this.setGlow(this,a),this.setShadow(this,a),a.lineCap=c.getStyle(d?"link.agent.cap":"link.cap"),a.lineJoin=c.getStyle(d?"link.agent.join":"link.join");var j=c.getStyle(d?"link.agent.pattern":"link.pattern");h&&this.drawLinePoints(a,b,f,c.getStyle("select.color"),j),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawLinePoints(a,b,e+2*g,this._outerColor,j),this.drawLinePoints(a,b,e,this._innerColor||c.getStyle(d?"link.agent.color":"link.color"),j),nd.drawLinkArrow(this,a,b,this._network.zoomManager),this._network._debug&&(Vb.strokeRect(a,this._arrowToRect,Gb.Util.randomColor()),Vb.strokeRect(a,this._arrowFromRect,Gb.Util.randomColor()))}},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d;var f=this._element.isBundleAgent()&&this._element.getStyle("link.agent");if(this._element.getStyle(f?"link.agent.flow":"link.flow")===!0&&e&&e.length>1){var g=new tc(a,e[0],e[1]),h=this._element.getStyle(f?"link.agent.flow.offset":"link.flow.offset"),i=Math.floor(h/(e[0]+e[1]));i>2&&(h-=(e[0]+e[1])*i),this._element.getStyle(f?"link.agent.flow.converse":"link.flow.converse")?h<e[0]?g.overflow=e[0]-h:h>=e[0]&&h<=e[0]+e[1]?(g.overflow=e[1]-(h-e[0]),g.overflow&&(g.isLine=!1)):(h-=e[0]+e[1],g.overflow=e[0]-h):h<=e[1]?(g.overflow=h,h&&(g.isLine=!1)):h>e[1]&&h<=e[0]+e[1]?g.overflow=h-e[1]:(h-=e[0]+e[1],h&&(g.isLine=!1),g.overflow=h),this._element._styleMap[f?"link.agent.flow.offset":"link.flow.offset"]=h,a.beginPath(),Vb._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var j=this._element.getStyle(f?"link.agent.flow.color":"link.flow.color");j=j?j:Dd.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=j,Vb._drawLine(b,g),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Vb.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Rb.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=wc.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=wc.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var a=this._network.zoomManager,b=this.getStyle("link.type"),c=new Gb.List;if(wc.isOrthogonalOrFlexionalLink(this._element))c=wc.orthogonalAndFlexional(this,b,a);else if(this._element.isLooped()){var d=this._network.getElementUI(this._element.getFromAgent());null!=d&&(this._hotSpot=wc.fillLoopedPoints(this,d.getZoomBodyRect(),c))}else{if("arc"!==b&&"triangle"!==b&&"parallel"!==b)throw"Can not resolve link type '"+b+"'";var e=this.getFromPoint(),f=this.getToPoint();this._hotSpot=wc.fillBundlePoints(this,b,e,f,c,a)}if(this._network._linkPathFunction){var g=this._network._linkPathFunction(this,c);g&&(c=g)}return c},checkAttachments:function(){Gb.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Gb.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return wc.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(wc.hasControlPoint(b)){var c=wc.getLinkSourceBounds(this,this._network.zoomManager),d=wc.getLinkTargetBounds(this,this._network.zoomManager);wc.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();return d&&d>0&&Rb.grow(c,d,d),Rb.intersects(this._viewRect,c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(0==Rb.intersects(a,this._viewRect))return!1;var c=this.getLinkPoints(),d=c.size();if(2==d)for(var e=0;d>e;e+=2){var f=c.get(e);if(d>e+1){var g=c.get(e+1);if(Od.intersectsLine(f.x,f.y,g.x,g.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Rb.getAngle(this._fromPoint,this._toPoint)),this._angle||0},getAbsoluteAngle:function(){var a={x:10,y:0},b=this._fromPoint,c=this._toPoint,d={x:c.x-b.x,y:c.y-b.y},e=180*Math.acos((d.x*a.x+d.y*a.y)/(Math.sqrt(a.x*a.x+a.y*a.y)*Math.sqrt(d.x*d.x+d.y*d.y)))/Math.PI;return e=b.y<=c.y?e:360-e,e=e%360*Math.PI/180},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;Rb.grow(b,d+1,d+1)}return b}}),Gb.vector.GroupUI=function(a,b){Gb.vector.GroupUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.GroupUI",Gb.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this._element.getStyle("group.expend.image")?(Gb.vector.GroupUI.superClass.paintBody.apply(this,arguments),
this._element.getStyle("group.expend.image.vector")&&this.drawExpandedGroup(a)):this.drawExpandedGroup(a):Gb.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){if(this.getBodyRect(),this._shapeRect){var a=this.getPathRect("group",!1),b=this.getStyle("group.deep");Rb.grow(a,b+1,b+1),this.addBodyBounds(a)}else Gb.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():Gb.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():Gb.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Vb.draw3DRect(a,c,b,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var c=this.getChildrenRects();if(!c.isEmpty()){var d=a.getStyle("group.shape"),e=Sb[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(c)}}return this._shapeRect?(Rb.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Gb.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;Rb.grow(b,d+1,d+1)}return b}}),Gb.vector.ShapeNodeUI=function(a,b){Gb.vector.ShapeNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.ShapeNodeUI",Gb.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(a){this._element._points.size()<2||(this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),nd.drawLinkArrow(this,a,Rb.getPointObject(this._element._points,this._element._segments)))},invalidateZoom:function(){this._zoomPoints=null,Gb.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),Gb.vector.ShapeLinkUI=function(a,b){Gb.vector.ShapeLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.ShapeLinkUI",Gb.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Gb.List,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)),c.add(b);var e,f,g;if("lineto"===d);else if("quadto"===d){for(e=new Gb.List(c.get(0)),f=1,pointCount=c.size();f<pointCount;f++)e.add(f<pointCount-1?new Gb.List([c.get(f++),c.get(f)]):c.get(f));c=e}else if("cubicto"===d){for(e=new Gb.List(c.get(0)),f=1,pointCount=c.size();f<pointCount;f++)e.add(f<pointCount-2?new Gb.List([c.get(f++),c.get(f++),c.get(f)]):f<pointCount-1?new Gb.List([c.get(f++),c.get(f)]):c.get(f));c=e}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(g=c.get(0),e=new Gb.List(g),f=1,pointCount=c.size();f<pointCount;f++)if(f<pointCount-1){var h=Hb.clone(c.get(f)),i=h.x,j=h.y,k=i-g.x,l=j-g.y;Math.abs(k)>Math.abs(l)?(h.x=i,h.y=g.y):(h.x=g.x,h.y=j),g=h,e.add(g)}else e.add(c.get(f));c=e}var m,n,o,h,p,k,l,q=Rb.calculateLineLength(c)/2,r=c.size(),s=0,t=0;for(m=0;r>m;m++)if(h=c.get(m),0!=m){if(o=h,o instanceof md&&(o=o._as),o instanceof Array?(p=Rb.calculateCurveLength(n,o,1),n=o[o.length-1]):(l=h.y-n.y,k=h.x-n.x,p=Math.sqrt(k*k+l*l),n=o),t+=p,q>=s&&t>=q){var u=q-s,v=c.get(m-1);v instanceof md&&(v=v._as,v instanceof Array&&(v=v[v.length-1]));var w=c.get(m),x=Rb.getPathInfo(w,v,u,0,-1).point;this._hotSpot=Hb.clone(x)}s=t}else n=h;return c},_growLinkJoinBounds:function(a,b){Rb.grow(a,3*b,3*b)}}),Gb.vector.GridUI=function(a,b){Gb.vector.GridUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.GridUI",Gb.vector.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?Gb.vector.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())Gb.vector.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=Hb.clone(a),c=this._element.getStyle("outer.width");Rb.grow(b,c,c),this.appendShadowBound(this,b),this.addBodyBounds(b)}},_getZoomCellRect:function(a,b){var c=this._element.getCellRect(a,b),d=this._element.getRect(),e=d.x+d.width/2,f=d.y+d.height/2,g=this.getZoomBodyRect(),h=g.width/d.width,i=g.x+g.width/2,j=0==e?1:i/e;return{x:e*j+(c.x-e)*h,y:f*j+(c.y-f)*h,width:c.width*h,height:c.height*h}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(b||0!==c||0!==d){a.beginPath();var e=this.getZoomBodyRect(),f=this.getDyeColor("grid.fill.color");if(this.setGlow(this,a),this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),0!=c&&Vb.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath(),0!=d)for(var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),i=0;g>i;i++)for(var j=0;h>j;j++){var k=this._getZoomCellRect(i,j);null!=k&&(a.beginPath(),Vb.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),Gb.vector.RotatableNodeUI=function(a,b){Gb.vector.RotatableNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.RotatableNodeUI",Gb.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(Rb.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=Hb.getImageAsset(b.getImage());if(c){var d=this.getBodyRect();if(Rb.addPadding(d,this._element,"image.padding",1),c.getImage()){var e=this._element._getOrignalWidth(),f=this._element._getOrignalHeight(),g=this._element._getRotateRect();a.save(),a.translate(d.x-g.x+e/2,d.y-g.y+f/2),a.rotate(this._element._angle*Math.PI/180),a.drawImage(c.getImage(this._innerColor),-e/2,-f/2,e,f),a.restore()}else if(c.getSrc());else if(!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}}),Gb.vector.HTMLNodeUI=function(a,b){Gb.vector.HTMLNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.HTMLNodeUI",Gb.vector.NodeUI,{checkAttachments:function(){Gb.vector.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.vector.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._element.getStyle("attachment.label2.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkLabel2Attachment.call(this);var b=this._network.getLabel2(this._element);null!=b&&""!==b?this._label2Attachment||(this._label2Attachment=new Gb.vector.HTMLLabel2Attachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))},validateZIndex:function(a){this._labelAttachment&&this._labelAttachment.validateZIndex(a)}}),Gb.vector.HTMLLinkUI=function(a,b){Gb.vector.HTMLLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.HTMLLinkUI",Gb.vector.LinkUI,{checkAttachments:function(){Gb.vector.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.vector.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._element.getStyle("attachment.label2.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel2(this._element);null!=b&&""!==b?this._label2Attachment||(this._label2Attachment=new Gb.vector.HTMLLabel2Attachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),Gb.vector.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b,b&&this._network._hitTestTopAttachmentList.add(this)},Hb.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return Hb.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},getZoomViewRect:function(){var a=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return a},hit:function(a,b){return Rb.containsPoint(this.getZoomViewRect(),a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),!0}}catch(j){Od.disposeHitCanvas()}return c.restore(),!1},dispose:function(){this._network._hitTestTopAttachmentList.remove(this)},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e}}),Gb.vector.BasicAttachment=function(a,b){Gb.vector.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Hb.ext("twaver.vector.BasicAttachment",Gb.vector.Attachment,{paint:function(a){Gb.vector.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),c=this.getOutlineWidth(),d=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);if(this.getElementUI().setGlow(this,a),this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._network._debug&&Vb.strokeRect(a,d,"#C71585"),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}},validate:function(){Gb.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();(null==a||0>=a)&&(a=1),this._viewRect=Rb.getRect(this._pointers),this._viewRect=Rb.unionRect(this._viewRect,this._roundRect),a>0&&Rb.grow(this._viewRect,2*a,2*a),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){var c=this._viewRect.x+this._viewRect.width/2,d=this._viewRect.y+this._viewRect.height/2,e=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:c-e,y:d-e,width:2*e,height:2*e}}},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c,i.height=b;var j;if(this._ui._element instanceof Gb.Link){var k,l=this._ui.getLinkPoints();k=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(g)>0&&Math.abs(g)<1?"from"===f?g*=k:"to"===f?g=k*(1-g):(g/=2,g+=.5,g*=k):"from"===f?g=g:"to"===f?g=k-g:g+=k/2;var m,n=Rb.calculatePointInfoAlongLine(l,!0,g,h),o=n.point;n.angle,m="from"===f?this._ui.getFromPoint():"to"===f?this._ui.getToPoint():this._ui._hotSpot,g=o.x-m.x,h=o.y-m.y}if(d>0){var p=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h,!1);var q;if("aboveleft"===p)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("aboveright"===p)i.y=j.y-d-i.height,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("belowleft"===p)i.y=j.y+d,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("belowright"===p)i.y=j.y+d,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("leftabove"===p)i.y=j.y+c-i.height,i.x=j.x-d-i.width,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("leftbelow"===p)i.y=j.y-c,i.x=j.x-d-i.width,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("rightabove"===p)i.y=j.y+c-i.height,i.x=j.x+d,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("rightbelow"===p)i.y=j.y-c,i.x=j.x+d,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("above"===p)i.y=j.y-d-i.height,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y-d},{x:j.x+q,y:j.y-d}];else if("below"===p)i.y=j.y+d,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y+d},{x:j.x+q,y:j.y+d}];else if("left"===p)i.y=j.y-i.height/2,i.x=j.x-d-i.width,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+q},{x:j.x-d,y:j.y-q}];else{if("right"!==p)throw"Can not resolve '"+p+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+q},{x:j.x+d,y:j.y-q}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h,!1),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var r=this.getPadding();0!=r&&Rb.grow(i,r,r),r=this.getPaddingLeft(),0!=r&&(i.x-=r,i.width+=r),r=this.getPaddingRight(),0!=r&&(i.width+=r),r=this.getPaddingTop(),0!=r&&(i.y-=r,i.height+=r),r=this.getPaddingBottom(),0!=r&&(i.height+=r),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return Gb.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Gb.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Gb.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Gb.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Gb.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Gb.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Gb.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Gb.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Gb.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Gb.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Gb.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Gb.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Gb.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Gb.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Gb.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Gb.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Gb.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Gb.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Gb.Defaults.ATTACHMENT_CAP},getJoin:function(){return Gb.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Hb.clone(this._roundRect)},getContentRect:function(){return Hb.clone(this._contentRect)}}),Gb.vector.LabelAttachment=function(a,b){Gb.vector.LabelAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.LabelAttachment",Gb.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this.getZoomViewRect(),d=c.x+c.width/2,e=c.y+c.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}Gb.vector.LabelAttachment.superClass.paint.apply(this,arguments);var f=this._network.zoomManager,g=f._getAttachmentZoomRect(this,this._contentRect),h=this._element.getStyle("label.align"),i=this._element&&this._element.getStyle("label.rotate.angle");if(0!==i&&(a.save(),Gb.Util.rotateCanvas(a,this._contentRect,i)),f._drawText(this,a,this.text,g,this.font,this.getStyle("label.color"),h),(b||0!==i)&&a.restore(),this._network._debug){var j=this._viewRect;Vb.strokeRect(a,j,"#AAABBB")}},validate:function(){this.font=this.getFont("label.font");var a=this.getLabel(),b=Hb.g.getTextSize(this.font,a),c=this.getMaxLength();0!==c&&b.width>c?(this.text=Hb.g.getCollapseTextInLength(this.font,a,c),this._textSize=Hb.g.getTextSize(this.font,this.text)):(this.text=a,this._textSize=b),Gb.vector.LabelAttachment.superClass.validate.call(this);var d=this._viewRect,e=this._element&&this._element.getStyle("label.rotate.angle");if(0!==e){var f=new Gb.List;f.add({x:d.x,y:d.y}),f.add({x:d.x+d.width,y:d.y}),f.add({x:d.x+d.width,y:d.y+d.height}),f.add({x:d.x,y:d.y+d.height}),f=this._rotatePointList(f,e,d);var g=Gb.Util.getRect(f);this._viewRect=g}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Gb.vector.Label2Attachment=function(a,b){Gb.vector.Label2Attachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.Label2Attachment",Gb.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this.getZoomViewRect(),d=c.x+c.width/2,e=c.y+c.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}Gb.vector.Label2Attachment.superClass.paint.apply(this,arguments);var f=this._network.zoomManager,g=f._getAttachmentZoomRect(this,this._contentRect),h=this._element.getStyle("label.align"),i=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==i&&(a.save(),Gb.Util.rotateCanvas(a,this._contentRect,i)),f._drawText(this,a,this.text,g,this.font,this.getStyle("label2.color"),h),(b||0!==i)&&a.restore(),this._network._debug){var j=f.getAttachmentSizeZoom(this),k=g;k.width*=j,k.height*=j,Vb.strokeRect(a,k,"#AAABBB")}},validate:function(){this.font=this.getFont("label2.font");var a=this.getLabel(),b=Hb.g.getTextSize(this.font,a),c=this.getMaxLength();0!==c&&b.width>c?(this.text=Hb.g.getCollapseTextInLength(this.font,a,c),this._textSize=Hb.g.getTextSize(this.font,this.text)):(this.text=a,this._textSize=b),Gb.vector.LabelAttachment.superClass.validate.call(this);var d=this._viewRect,e=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==e){var f=new Gb.List;f.add({x:d.x,y:d.y}),f.add({x:d.x+d.width,y:d.y}),f.add({x:d.x+d.width,y:d.y+d.height}),f.add({x:d.x,y:d.y+d.height}),f=this._rotatePointList(f,e,d);var g=Gb.Util.getRect(f);this._viewRect=g}},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},getMaxLength:function(){return this.getStyle("label2.maxlength")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Gb.vector.AlarmAttachment=function(a,b){Gb.vector.AlarmAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.AlarmAttachment",Gb.vector.BasicAttachment,{paint:function(a){Gb.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var b=this._network.zoomManager,c=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.text,c,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Vb.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Gb.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Gb.vector.LinkHandlerAttachment=function(a,b){Gb.vector.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.LinkHandlerAttachment",Gb.vector.BasicAttachment,{paint:function(a){var b=this._network.zoomManager;Gb.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var c=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.linkHandlerLabel,c,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Vb.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Gb.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Gb.vector.IconsAttachment=function(a,b){Gb.vector.IconsAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.IconsAttachment",Gb.vector.Attachment,{isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Gb.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element)),c=this._network.zoomManager;len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],
this.iconsOrientations=[];var d,e,f;for(i=0;i<len;i++){var g=a[i],f=this.iconsOrientation[i]||"right",h=this.iconsPosition[i]||"topleft.bottomright",j=this.iconsXgap[i]||1,k=this.iconsYgap[i]||1,l=this.iconsXoffset[i]||0,m=this.iconsYoffset[i]||0;if(this._ui._element instanceof Gb.Link){var n,o=this._ui.getLinkPoints();n=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(l)>0&&Math.abs(l)<1?"from"===h?l*=n:"to"===h?l=n*(1-l):(l/=2,l+=.5,l*=n):"from"===h?l=l:"to"===h?l=n-l:l+=n/2;var p,q=Rb.calculatePointInfoAlongLine(o,!0,l,m),r=q.point;q.angle,p="from"===h?this._ui.getFromPoint():"to"===h?this._ui.getToPoint():this._ui._hotSpot,l=r.x-p.x,m=r.y-p.y}e=null,d=this._getIconsSize(g,f,j,k,c),d&&(e=this._network.getPosition(h,this._ui,d,l,m),this._iconLocation=e,"top"===f?e.y+=d.height:"left"===f&&(e.x+=d.width)),this.locations.push(e),this.iconsSizes.push(d),this.iconsOrientations.push(f)}var s=null;for(i=0;i<this.locations.length;i++)e=this.locations[i],d=this.iconsSizes[i],f=this.iconsOrientations[i],null!=e&&(s=null==s?"top"===f?{x:e.x,y:e.y-d.height,width:d.width,height:d.height}:"left"===f?{x:e.x-d.width,y:e.y,width:d.width,height:d.height}:{x:e.x,y:e.y,width:d.width,height:d.height}:"top"===f?Rb.unionRect(s,{x:e.x,y:e.y-d.height,width:d.width,height:d.height}):"left"===f?Rb.unionRect(s,{x:e.x-d.width,y:e.y,width:d.width,height:d.height}):Rb.unionRect(s,{x:e.x,y:e.y,width:d.width,height:d.height}));this._viewRect=c?s||this.getElementUI().getViewRect():s||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b;var t=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(t instanceof Array&&t[i]&&this._viewRect){var u=this._viewRect.x+this._viewRect.width/2,v=this._viewRect.y+this._viewRect.height/2,w=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:u-w/2,y:v-w/2,width:w,height:w}}}},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b,c,d,e=[],f=!1,g=a.length;for(b=0;g>b;b++)c=a[b],Array.isArray(c)?(f=!0,e.push(c)):(d=[c],e.push(d));return f||(e.length=0,e.push(a)),e},_makeArray:function(a,b,c){if(Array.isArray(a))return a;for(var d=[],e=0;b>e;e++)d.push(a||c);return d},paint:function(a){if(Gb.vector.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var b,c,d,e,f,g,h,i,j,k,l=this._network.zoomManager;for(b=0;b<this.iconsGroups.length;b++)if(c=this.locations[b]){f=c.x,g=c.y,e=this.iconsGroups[b],h=this.colorGroups[b],i=this.iconsOrientation[b],j=this.iconsXgap[b]||1,k=this.iconsYgap[b]||1,d=0;for(var m in e){var n=null,o=null;h&&h.length>d&&(o=h[d++]);var p=Hb.getImageAsset(e[m]);if(null!=p){if(l&&this._ui instanceof Gb.vector.GroupUI&&this._ui._shapeRect){var q=l.getAttachmentSizeZoom(this),r=p.getWidth()*q,s=p.getHeight()*q;if("right"===i)n={x:f,y:g,width:r,height:s},f+=n.width+j;else if("left"===i)n={x:f-r,y:g,width:r,height:s},f-=n.width+j;else if("top"===i)n={x:f,y:g-s,width:r,height:s},g-=n.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";n={x:f,y:g,width:r,height:s},g+=n.height+k}}else{if("right"===i)n={x:f,y:g,width:p.getWidth(),height:p.getHeight()},f+=n.width+j;else if("left"===i)n={x:f-p.getWidth(),y:g,width:p.getWidth(),height:p.getHeight()},f-=n.width+j;else if("top"===i)n={x:f,y:g-p.getHeight(),width:p.getWidth(),height:p.getHeight()},g-=n.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";n={x:f,y:g,width:p.getWidth(),height:p.getHeight()},g+=n.height+k}n=l._getAttachmentZoomOutLineRect(this,n)}var t=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");if(t instanceof Array&&t[b]){a.save();var u=n,f=u.x+u.width/2,g=u.y+u.height/2;a.translate(f,g),a.rotate(this._network.getElementUI(this._element).getAbsoluteAngle()),a.translate(-f,-g),Mc(a,p.getImage(o,n.width,n.height),o,n,this._element,this._network),a.restore()}else Mc(a,p.getImage(o,n.width,n.height),o,n,this._element,this._network);if(this._network._debug){var n=this._viewRect;Vb.strokeRect(a,n,"#FCFC00",1),Vb.strokeRect(a,n,"#FCFC00",1)}}}}}},_getIconsSize:function(a,b,c,d,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a)if(i=Hb.getImageAsset(a[k])){if("right"===b)h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if("left"===b)h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if("top"===b)h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+d}j=null==j?Hb.clone(h):Rb.unionRect(j,h)}return j?e&&this._ui instanceof Gb.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(j.width)*e.getAttachmentSizeZoom(this),height:Math.abs(j.height)*e.getAttachmentSizeZoom(this)}:{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),Gb.vector.EditAttachment=function(a,b){Gb.vector.EditAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.EditAttachment",Gb.vector.Attachment,{paint:function(a){Gb.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(!(0>=b)){var c=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),d=this.resizePointSize/c,e=2*d,f=2*d,g=this._network.getResizePointFillColor(),h=this._network.getResizePointOutlineWidth()/c,i=this._network.getResizePointOutlineColor(),j=this._element.getAngle(),k=this._network.zoomManager,l=k._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());a.lineWidth=h;for(var m=this.resizingPoints,n=0;b>n;n++){var o=m.get(n),p={x:o.x-d,y:o.y-d,width:2*d,height:2*d},q=this._getRotateRect(p,j,{x:l.x+l.width/2,y:l.y+l.height/2});a.save(),Gb.Util.rotateCanvas(a,q,j),Od.rect(a,q.x,q.y,e,f),a.restore()}if(a.fillStyle=g,a.strokeStyle=i,a.fill(),a.stroke(),this._network._debug){var r=this.getViewRect("resize");Vb.strokeRect(a,r,"#CCDDCC");var r=k._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);Vb.strokeRect(a,r,"#FD7766")}}},paintEditPoints:function(a){var b=this.editPoints.size();if(!(0>=b)){var c=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor(),f=this._network.getEditPointOutlineWidth()/c;a.beginPath(),a.lineWidth=f;for(var g=this.editPoints,h=0;b>h;h++){var i=g.get(h);a.beginPath(),Od.circle(a,i.x,i.y,this.editPointSize,e,d),a.closePath()}if(this._network._debug){var j=this.getViewRect("edit");Vb.strokeRect(a,j,"#AAABBC")}}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(!(0>=b)){var c=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),d=this._network.getRotatePointOutlineColor(),e=this._network.getRotatePointFillColor(),f=this._network.getRotatePointOutlineWidth()/c;a.beginPath(),a.lineWidth=f;for(var g=this.rotatePoints,h=0;b>h;h++){var i=g.get(h);a.beginPath(),Od.circle(a,i.x,i.y,this.rotatePointSize/c,e,d),a.closePath(),a.beginPath()}if(this._network._debug){var j=this.getViewRect("rotate");Vb.strokeRect(a,j,"green")}}},getViewRect:function(a){if(a){if("resize"===a)return this._resizeRect;if("rotate"===a)return this._rotateRect;if("edit"===a)return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){Gb.vector.EditAttachment.superClass.validate.call(this);var a=this._network.getGraphicsZoom();this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Gb.List,this.editPoints=new Gb.List,this.rotatePoints=new Gb.List,this._element instanceof Gb.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Ld)||this._element instanceof Gb.ShapeNode||this._element instanceof Gb.Grid||this._element instanceof Gb.Group||this._addRotatePoint(this._element),this._element instanceof Gb.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Gb.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Gb.vector.LinkUI&&this._addLinkControlPoint(this._ui);var b=this._network.getResizePointOutlineWidth()/a,c=this.getElementUI().getZoomBodyRect(),d=2*Math.sqrt(2);if(this._resizeOffset=(this.resizePointSize+b+1)*d,Rb.grow(c,this._resizeOffset,this._resizeOffset),this._resizeRect=c,b=this._network.getEditPointOutlineWidth()/a,this.editPoints.size()>0){var e=Rb.getRect(this.editPoints);Rb.grow(e,2*this.editPointSize+2*b),c=Rb.unionRect(c,e)}this._editRect=e,b=this._network.getRotatePointOutlineWidth()/a;var f=this.rotatePointSize;if(this.rotatePoints.size()>0){var g=this.rotatePoints.get(0),h={x:g.x-f-b-1,y:g.y-f-b-1,width:2*f+2*b+2,height:2*f+2*b+2};c=Rb.unionRect(c,h),this._rotateRect=h}this._viewRect=c},_addResizingPoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(b){var c=this._network.getResizePointSize();if(!(0>=c)){var d=new md([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)}}},_addRotatePoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(b){var c=this._network.getRotatePointSize()/this._network.getGraphicsZoom();if(!(0>=c)){var d=2*c,e=new Gb.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()/this._network.getGraphicsZoom()-c}]),f=a.getAngle();0!=f&&(e=this._rotatePointList(e,f,b));var g=e.get(0),h={x:g.x-d/2,y:g.y-d/2,width:d,height:d},i=this._network.getRotatePointOutlineWidth(),j=this.rotatePointSize+i;Rb.grow(b,j,j),Rb.unionRect(a.getRect(),h),this.rotatePoints=e}}},_addShapeNodePoint:function(a){var b=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),a.getPoints());this._addEditPoints(b)},_addShapeLinkPoints:function(a){var b=this._network.zoomManager._getShapeLinkZoomPoints(a.getPoints());this._addEditPoints(b)},_addLinkControlPoint:function(a){var b,c=new Gb.List,d=a._element.getFromAgent();b=d?a._element.getFromAgent():a._element.getFromNode();var e=a._element.getStyle("link.from.xoffset"),f=a._element.getStyle("link.from.yoffset"),g=this._network.getElementUI(b),h=g.getZoomBodyRect(),i={x:h.x+h.width/2,y:h.y+h.height/2},j={x:i.x+e,y:i.y+f};c.add(j);var k,l=a._element.getToAgent();k=l?a._element.getToAgent():a._element.getToNode();var m=a._element.getStyle("link.to.xoffset"),n=a._element.getStyle("link.to.yoffset"),o=this._network.getElementUI(k),p=o.getZoomBodyRect(),q={x:p.x+p.width/2,y:p.y+p.height/2},r={x:q.x+m,y:q.y+n};if(c.add(r),wc.isOrthogonalLink(a._element)&&a.getControlPoint()){var s=a.getControlPoint();s&&c.add(s)}var t=this.editPoints.size();if(t>0)for(var u=0;t>u;u++)c.add(this.editPoints.get(u));this._addEditPoints(c)},_addEditPoints:function(a){var b=Rb.getRect(a);if(b){var c=this._network.getEditPointSize();if(!(0>=c)){var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)}}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>g)){var h=g+c;Rb.grow(a,h,h),1==f?this.resizingPoints=b:this.editPoints=b}},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e},_getRotateRect:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Gb.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Rb.getRect(g)}}),Gb.vector.HTMLLabelAttachment=function(a,b){Gb.vector.HTMLLabelAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.vector.HTMLLabelAttachment",Gb.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var a=this._element.getStyle("attachment.htmllabel.hyperlink");a?(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var b=(this.getFont("label.font"),this.getLabel());b!==this.text&&(this.text&&("object"==typeof this.text?window.jquery?window.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),b&&("object"==typeof b?window.jquery?window.jquery(this._contentDiv).append(b):this._contentDiv.appendChild(b):this._contentDiv.innerHTML=b),this.text=b),this._contentDiv.style.visibility="hidden",Gb.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(a){this._roundDiv.style.zIndex=1e5*a+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setGlow(this,a),this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,Ob.isFirefox?(Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform-origin","0 0")):Ob.isOpera?(Gb.Util.setCSSStyle(this._contentDiv,"-o-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-o-transform-origin","0 0")):Ob.isChrome||Ob.isSafari?(Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform-origin","0 0")):Ob.isIE?(Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform-origin","0 0")):(Gb.Util.setCSSStyle(this._contentDiv,"transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"transform-origin","0 0")),this._network._debug&&(Vb.strokeRect(a,this._contentRect,"blue"),Vb.strokeRect(a,this._roundRect,"red"),Vb.strokeRect(a,this._viewRect,"green"));var n=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(n){var o=this.getZoomViewRect(),p=(o.x+o.width/2,o.y+o.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*j,this._contentDiv.offsetHeight/2*j,Ob.isFirefox?Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isOpera?Gb.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isChrome||Ob.isSafari?Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+p+"deg) scale("+j+")"):Ob.isIE?Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Gb.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")")}},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.vector.HTMLLabel2Attachment=function(a,b){Gb.vector.HTMLLabel2Attachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.vector.HTMLLabel2Attachment",Gb.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var a=this._element.getStyle("attachment.htmllabel2.hyperlink");a?(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var b=(this.getFont("label2.font"),this.getLabel());b!==this.text&&(this.text&&("object"==typeof this.text?window.jquery?window.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),b&&("object"==typeof b?window.jquery?window.jquery(this._contentDiv).append(b):this._contentDiv.appendChild(b):this._contentDiv.innerHTML=b),this.text=b),this._contentDiv.style.visibility="hidden",Gb.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(a){this._roundDiv.style.zIndex=1e5*a+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setGlow(this,a),this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("label2.font"),this.getLabel(),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&(Vb.strokeRect(a,this._contentRect,"blue"),Vb.strokeRect(a,this._roundRect,"red"),Vb.strokeRect(a,this._viewRect,"green"));var n=this._element instanceof Gb.Link&&this._element.getStyle("link.label2.rotatable");if(n){var o=this.getZoomViewRect(),p=(o.x+o.width/2,o.y+o.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*j,this._contentDiv.offsetHeight/2*j,Ob.isFirefox?Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isOpera?Gb.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isChrome||Ob.isSafari?Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+p+"deg) scale("+j+")"):Ob.isIE?Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Gb.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")")}},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv},getLabel:function(){return this._network.getLabel2(this._element)},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Gb.vector.HTMLAlarmAttachment=function(a,b){Gb.vector.HTMLAlarmAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none"),this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.vector.HTMLAlarmAttachment",Gb.vector.AlarmAttachment,{validate:function(){var a=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=a,this._contentDiv.style.visibility="hidden",Gb.vector.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Vb.strokeRect(a,this._contentRect,"#DDDDDD"),Gb.vector.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.vector.BaseZoomManager=function(a){this.network=a,this.visibilityThresholds=a.visibilityThresholds},Hb.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(a){return 1},getAttachmentSizeZoom:function(a){var b=a.getElementUI();return this.getSizeZoom(b)},getLocationZoom:function(a){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(a){var b=a.x*this.getGraphicsZoom()-this.network.getViewRect().x,c=a.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:b,y:c}},_getElementViewRect:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d)return b;var e=this._getZoomPoint(a),f=e.x,g=e.y;return null==b&&console.log("View rect is null"),{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(a){var b=new md;return a.getChildren().forEach(function(a){if(a instanceof Ld){var c=this.network.getElementUI(a);if(c){var d=c.getZoomViewRect(this);d&&b.add(d)}}},this),b},_zoomGraphicsBegin:function(a){var b=this.network,c=this.getGraphicsZoom();a.scale(c,c),a.translate(-b.viewRect.x/c,-b.viewRect.y/c)},_getEditZoomPoints:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d||a instanceof Gb.vector.LinkUI&&!(a instanceof Gb.vector.ShapeLinkUI))return b;var e;e=a instanceof Gb.vector.ShapeLinkUI?Rb.getCenterPoint(Rb.getRect(b)):this._getZoomPoint(a);var f=e.x,g=e.y;if(b.forEach){var h,i=new md;return b.forEach(function(a){a instanceof md?(h=new md,a.forEach(function(a){h.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),i.add(h)):i.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),i}return b.x?{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d}:void 0},_getShapeNodeZoomPoints:function(a,b,c){var d=this.getLocationZoom(a),e=this.getSizeZoom(a);if(1==d&&1==e)return b;c&&(d=1/d,e=1/e);var f,g=Rb.getRect(b),h=g.x+g.width/2,i=g.y+g.height/2,j=new md;return b.forEach(function(a){a instanceof md?(f=new md,a.forEach(function(a){f.add({x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e})}),j.add(f)):j.add({x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e})}),j},_getShapeLinkZoomPoints:function(a,b){var c=this.getLocationZoom(),d=c;if(1==c&&1==d)return a;b&&(c=1/c,d=1/d);var e,f=Rb.getRect(a),g=f.x+f.width/2,h=f.y+f.height/2,i=new md;return a.forEach(function(a){a instanceof md?(e=new md,a.forEach(function(a){e.add({x:g*c+(a.x-g)*d,y:h*c+(a.y-h)*d})}),i.add(e)):i.add({x:g*c+(a.x-g)*d,y:h*c+(a.y-h)*d})}),i},_getLogicalPoint:function(a,b){var c,d=b?this.getZoom():this.getGraphicsZoom(),e=this.network;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var f=e._view.getBoundingClientRect(),g=a.changedTouches[0],h=Ob.isAndroid?0:yc.scrollLeft(),i=Ob.isAndroid?0:yc.scrollTop();return c={x:(g.clientX+e.viewRect.x-f.left-h)/d,y:(g.clientY+e.viewRect.y-f.top-i)/d}}return c=Ob.isFirefox?{x:(a.layerX+e.viewRect.x)/d,y:(a.layerY+e.viewRect.y)/d}:{x:(a.offsetX+e.viewRect.x)/d,y:(a.offsetY+e.viewRect.y)/d}},_getVisibleRect:function(a){return a},_getElementZoomRect:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d)return Hb.cloneRect(b);var e=null!=a?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},f=e.x,g=e.y;return{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_reverseElementZoomRect:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d)return Hb.cloneRect(b);var e=null!=a?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},f=e.x,g=e.y;return{x:f+(b.x-f*c)/d,y:g+(b.y-g*c)/d,width:b.width/d,height:b.height/d}},_getZoomContentRect:function(a,b,c,d,e,f){var g=this.getSizeZoom(a.getElementUI()),h=this.getAttachmentSizeZoom(a),i=a.getElementUI();return void 0==f?i instanceof Gb.vector.GroupUI&&i._shapeRect?{x:d.x*e+1*(b.x-d.x)+(c.x-b.x)*h,y:d.y*e+1*(b.y-d.y)+(c.y-b.y)*h,width:c.width,height:c.height}:{x:d.x*e+(b.x-d.x)*g+(c.x-b.x)*h,y:d.y*e+(b.y-d.y)*g+(c.y-b.y)*h,width:c.width,height:c.height}:{x:d.x*e+(b.x-d.x)*g+(c.x-b.x)*h,y:d.y*e+(b.y-d.y)*g+(c.y-b.y)*h+f*(a.textHeight-4)*h,width:c.width,height:a.textHeight}},_getAttachmentZoomRect:function(a,b,c){var d=this.getLocationZoom(a.getElementUI()),e=a.getElementUI(),f=this.getSizeZoom(a.getElementUI()),g=this.getAttachmentSizeZoom(a),h=a._pointers;if(1==d&&1==g&&1==f)return void 0==c?b:{x:b.x,y:b.y+c*(a.textHeight-4),width:b.width,height:a.textHeight};var e=a.getElementUI(),i=this._getZoomPoint(e,a),j=(i.x,i.y,a.getPosition?a.getPosition():"center"),k=h?h[0]:Rd.get(j,b);return void 0==c?e instanceof Gb.vector.LinkUI||e instanceof Gb.vector.GroupUI&&e._shapeRect?this._getZoomContentRect(a,k,b,i,1):this._getZoomContentRect(a,k,b,i,d):this._getZoomContentRect(a,k,b,i,d,c)},_getZoomPoint:function(a,b){var c,d,e=a._element;if(e instanceof Gb.Follower&&e.getHost()&&e.getHost()instanceof Gb.Grid)return c=e.getHost(),d=c.getRect(),{x:d.x+d.width/2,y:d.y+d.height/2};if(d=a.getBodyRect(),a instanceof Gb.vector.LinkUI&&b&&b.getPosition){if(b.getXOffset(),b.getYOffset(),"from"===b.getPosition())return a._fromPoint;if("to"===b.getPosition())return a._toPoint}return{x:d.x+d.width/2,y:d.y+d.height/2}},_getZoomPointers:function(a,b,c){if(c){var d=this._getZoomPoint(b),e=this.getLocationZoom(b),f=this.getSizeZoom(b),g=this.getAttachmentSizeZoom(a),h=c[0];return b instanceof Gb.vector.LinkUI?[{x:d.x+(h.x-d.x)*f,y:d.y+(h.y-d.y)*f},{x:d.x+(h.x-d.x)*f+(c[1].x-h.x)*g,y:d.y+(h.y-d.y)*f+(c[1].y-h.y)*g},{x:d.x+(h.x-d.x)*f+(c[2].x-h.x)*g,y:d.y+(h.y-d.y)*f+(c[2].y-h.y)*g}]:b instanceof Gb.vector.GroupUI&&b._shapeRect?[{x:d.x+1*(h.x-d.x),y:d.y+1*(h.y-d.y)},{x:d.x+1*(h.x-d.x)+(c[1].x-h.x)*g,y:d.y+1*(h.y-d.y)+(c[1].y-h.y)*g},{x:d.x+1*(h.x-d.x)+(c[2].x-h.x)*g,y:d.y+1*(h.y-d.y)+(c[2].y-h.y)*g}]:[{x:d.x*e+(h.x-d.x)*f,y:d.y*e+(h.y-d.y)*f},{x:d.x*e+(h.x-d.x)*f+(c[1].x-h.x)*g,y:d.y*e+(h.y-d.y)*f+(c[1].y-h.y)*g},{x:d.x*e+(h.x-d.x)*f+(c[2].x-h.x)*g,y:d.y*e+(h.y-d.y)*f+(c[2].y-h.y)*g}]}},_getZoomHotSpot:function(a,b){if(b){var c=this._getZoomPoint(a),d=this.getLocationZoom(a),e=this.getSizeZoom(a);return{x:c.x*d+(b.x-c.x)*e,y:c.y*d+(b.y-c.y)*e}}return null},limitZoom:function(a){return a},_isVisible:function(a){var b,c=this._getZoomVisibilityThresholds(),d=c[a];if(null!=d){var e=c.zoomName;if(b="sizeZoom"==e?this.getSizeZoom():"locationZoom"==e?this.getLocationZoom():"graphicsZoom"==e?this.getGraphicsZoom():this.getZoom(),d>b)return!1}return!0},isElementVisible:function(a){var b=this.getZoom(),c=this._isVisible("element",b);
return c&&a instanceof Gb.Link?this.isLinkVisible(a):c},isLinkVisible:function(a){var b=this.getZoom();return this._isVisible("link",b)},isLabelVisible:function(a){var b=this.getZoom();return this._isVisible("label",b)},isAttachmentVisible:function(a){var b=this.getZoom();return this._isVisible("attachment",b)},isAlarmBalloonVisible:function(a){var b=this.getZoom();return this._isVisible("alarmBallon",b)},_getAttachmentOutLineWidth:function(a){return a.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(a,b){var c=this.getLocationZoom(a.getElementUI()),d=this.getAttachmentSizeZoom(a);if(1==c&&1==d)return b;var e=this._getAttachmentZoomRect(a,b,null),f=a.getElement();return this.isAttachmentVisible(f)?(a instanceof Gb.vector.LabelAttachment||a instanceof Gb.vector.Label2Attachment)&&!this.isLabelVisible(f)?{x:e.x,y:e.x,width:0,height:0}:a instanceof Gb.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(f)?{x:e.x,y:e.x,width:0,height:0}:{x:e.x,y:e.y,width:e.width*d,height:e.height*d}:{x:e.x,y:e.x,width:0,height:0}},_drawText:function(a,b,c,d,e,f,g){var h=this.getLocationZoom(a.getElementUI()),i=this.getAttachmentSizeZoom(a);1!=h&&1!=i?(b.translate(d.x,d.y),b.scale(i,i),Vb.drawText(b,c,{x:0,y:0,width:d.width,height:d.height},e,f,g),b.scale(1/i,1/i),b.translate(-d.x,-d.y)):Vb.drawText(b,c,d,e,f,g)},_getOffset:function(a,b){var c=this.getLocationZoom();return{x:(a.x-b.x)/c,y:(a.y-b.y)/c}}});var Rd={"topleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"top.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"topright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topright.topright":function(a){return{x:a.x,y:a.y+a.height}},topleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},top:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},topright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"topleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topleft.bottomright":function(a){return{x:a.x,y:a.y}},"top.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"topright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topright.bottomright":function(a){return{x:a.x,y:a.y}},"left.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},left:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"left.right":function(a){return{x:a.x,y:a.y+a.height/2}},center:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},right:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.right":function(a){return{x:a.x,y:a.y+a.height/2}},"bottomleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"bottom.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"bottomright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomright.topright":function(a){return{x:a.x,y:a.y+a.height}},bottomleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottom:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottomright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"bottomleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomleft.bottomright":function(a){return{x:a.x,y:a.y}},"bottom.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"bottomright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomright.bottomright":function(a){return{x:a.x,y:a.y}},from:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},to:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},get:function(a,b){if(!b)throw"rect can not be null";var c=Rd[a];if(c)return c(b);throw"Can not resolve '"+a+"' position"}};Gb.vector.PhysicalZoomManager=function(a){Gb.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.vector.PhysicalZoomManager",Gb.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),Gb.vector.LogicalZoomManager=function(a,b){Gb.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=b},Hb.ext("twaver.vector.LogicalZoomManager",Gb.vector.BaseZoomManager,{getLocationZoom:function(a){return this.getZoom()},getSizeZoom:function(a){return this.sizeChange?this.getZoom():1}}),Gb.vector.MixedZoomManager=function(a,b){Gb.vector.MixedZoomManager.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.MixedZoomManager",Gb.vector.LogicalZoomManager,{}),function(){function a(a){d[a]=function(){return this.getZoom()>1?b[a].apply(this,arguments):c[a].apply(this,arguments)}}var b=Gb.vector.LogicalZoomManager.prototype,c=Gb.vector.PhysicalZoomManager.prototype,d=Gb.vector.MixedZoomManager.prototype;for(var e in c)"function"==typeof c[e]&&"constructor"!=e&&(b.hasOwnProperty(e)||c.hasOwnProperty(e))&&a(e);d._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),Gb.vector.interaction.BaseInteraction=function(a){this.network=a},Hb.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(a,b){return this.network.getOffset(a,b)},convertPointFromView:function(a){return this.network.convertPointFromView(a)},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=e.getSizeZoom(this.network.getElementUI(d));return{x:a.x*f*g-this.network.getViewRect().x+b*f*g,y:a.y*f*g-this.network.getViewRect().y+c*f*g,width:a.width*h*g,height:a.height*h*g}},getMarkerPoint:function(a){var b;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY}}return b=Ob.isFirefox?{x:a.layerX,y:a.layerY}:{x:a.offsetX,y:a.offsetY}},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Ub.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Ub.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint2(a),this._startClient=Ub.getClientPoint(a),this._startLogical&&Ub.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Gb.vector.interaction.DefaultInteraction=function(a,b){Gb.vector.interaction.DefaultInteraction.superClass.constructor.call(this,a),this.lazyMode=b},Hb.ext("twaver.vector.interaction.DefaultInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),Ob.isFirefox?Ub.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):Ub.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),Ub.addEventListener("mouseup","handle_mouseup",window,this),Ub.addEventListener("dblclick","handleDoubleClicked",this.network.getView(),this),Ub.addEventListener("blur","handle_blur",this.network.getView(),this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(a){a.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout","keydown"),Ob.isFirefox?Ub.removeEventListener("DOMMouseScroll",this.network.getView(),this):Ub.removeEventListener("mousewheel",this.network.getView(),this),Ub.removeEventListener("mouseup",window,this),Ub.removeEventListener("dblclick",this.network.getView(),this),Ub.removeEventListener("blur",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(null==this._zoomDiv){this._zoomDiv=Mb.createElement("div"),this._zoomLabel=Mb.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var a=Mb.createElement("button");a.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(a);var b=Dd,c=this._zoomDiv.style;c.position="absolute",c.color=b.TOOLTIP_COLOR,c.background=b.TOOLTIP_BACKGROUND,c.fontSize=b.TOOLTIP_FONT_SIZE,c.padding=b.TOOLTIP_PADDING,c.border=b.TOOLTIP_BORDER,c.borderRadius=b.TOOLTIP_BORDER_RADIUS,c.boxShadow=b.TOOLTIP_BOX_SHADOW,c.zIndex=b.TOOLTIP_ZINDEX,c.setProperty&&c.setProperty("-webkit-box-shadow",b.TOOLTIP_BOX_SHADOW,null);var d=this;a.onclick=function(a){d.network.setZoom(1),d._setZoomDivVisible(!1)};var e=this._zoomDiv,f=function(){return e.style.opacity=parseFloat(e.style.opacity)-.05,parseFloat(e.style.opacity)<=.05?(d._setZoomDivVisible(!1),void(e._clearTimeout=null)):void(e._clearTimeout=setTimeout(e._clearFunc,100))};e._clearFunc=f,e.onmouseover=function(a){a||(a=window.event);for(var b=a.relatedTarget?a.relatedTarget:a.fromElement;b&&b!=e;)b=b.parentNode;b!=e&&(e._clearTimeout&&(clearTimeout(e._clearTimeout),e._clearTimeout=null),e.style.opacity=1)},e.onmouseout=function(a){a||(a=window.event);for(var b=a.relatedTarget?a.relatedTarget:a.toElement;b&&b!=e;)b=b.parentNode;b!=e&&(e._clearTimeout=setTimeout(e._clearFunc,10))}}},_isZoomDivVisible:function(){return null!=this._zoomDiv&&null!=this._zoomDiv.parentNode},_getZoomDiv:function(){return this._zoomDiv||this._createZoomDiv(),this._zoomDiv},_setZoomDivVisible:function(a,b,c){var d=this._getZoomDiv();a?(this._zoomLabel.innerHTML=c,d.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(d),d.style.left=Dd.TOOLTIP_XOFFSET+"px",d.style.top=Dd.TOOLTIP_YOFFSET+"px",d._clearTimeout&&(clearTimeout(d._clearTimeout),d._clearTimeout=null),d._clearTimeout=setTimeout(d._clearFunc,250)):d.parentNode&&d.parentNode.removeChild(d)},handleViewRectChange:function(a){("viewRect"==a.property||"canvasSizeChange"==a.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=this.network._unionBounds,g=f.x,h=f.y,i=f.width,j=f.height,k=e.width,l=e.height,m=b,n=a,o=!1,p=!1;(c>g||k>b+c)&&(p=!0),(d>h||l>d+a)&&(o=!0);var q,r,s,t=0,u=0,v=0,w=0,x=m,y=n,z=this.getScrollBarWidth();p&&(o&&(x-=z),w=z,u=n-z,c>g&&c+b>k?(q=c-g,q=q*x/(q+m),t=q,v=x-q):g>c&&k>c+b?(q=k-(c+b),q=x*q/(q+m),t=0,v=x-q):(r=c-g,s=k-(c+b),r=x*r/i,s=x*s/i,t=r,v=m-r-s),this.hThumbRect={x:t,y:u,width:v,height:w}),t=0,u=0,v=0,w=0,x=m,y=n,o&&(p&&(y-=z),v=z,t=m-z,d>h&&d+a>l?(q=d-h,q=y*q/(q+n),u=q,w=y-q):h>d&&l>d+a?(q=l-(d+a),q=y*q/(q+n),u=0,w=y-q):(r=d-h,s=l-(d+a),r=y*r/j,s=y*s/j,u=r,w=y-r-s),this.vThumbRect={x:t,y:u,width:v,height:w}),this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mouseover:function(a){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(a){0!=this.scrollBarVisible&&null==this.vBarDownPoint&&null==this.hBarDownPoint&&(this.scrollBarVisible=!1,this.repaint(),this.end(a))},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup"),Bc.handleKeyDown(this.network,a)},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(a){this.end(a,!0),this.lastPoint=this.network.getLogicalPoint2(a),this.startPoint=this.network.getLogicalPoint2(a),this.lastPanPoint=this.getMarkerPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),Ub.addEventListener("mousemove","handle_mousemove",window,this)},end:function(a,b){if(this.vBarDownPoint=null,this.hBarDownPoint=null,this.network.state.panning&&(this.network.state.panning=!1,this.network.invalidateElementUIs(!0)),b||(this.network.getView().style.cursor=this._oldCursor),this.isMoving){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var c=this,d=function(){c.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),c.network.setMovingElement(!1)},e=this.getOffset(this.dragPoint,this.pressPoint),f=e.x,g=e.y;this.network.moveSelectedElements(f,g,this.network.isLazyMoveAnimate(),d)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var c=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(c.parent)},this.network)}this.parentProcess(a,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var h=Rb.getRect([this.startPoint,this.endPoint]),i=this.network.getElementsAtRect(h,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var j=this.network.getSelectionModel(),k=j.toSelection();i.forEach(function(a){j.contains(a)?k.remove(a):k.add(a)},this),j.setSelection(k)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,Ub.removeEventListener("mousemove",window,this)},_isDragToSelect:function(a){return!this.network._dragToPan},handle_mousedown:function(a){if(!Ob.isTouchable&&0!==a.button&&this.network.isSelectingElement())return void this.end(a);var b=this.network;if(a.target==b.getView()||a.target==b._topCanvas||a.target==b._rootCanvas){if(this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1),!this.network.isValidEvent(a)){var c=this.getMarkerPoint(a);return this.start(a),null!=this.vThumbRect&&Rb.containsPoint(this.vThumbRect,c.x,c.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),void(null!=this.hThumbRect&&Rb.containsPoint(this.hThumbRect,c.x,c.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x))}this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network.getView());var d=this.network.getElementAt(a),e=this.network.getElementsAt(a);if(e&&e instanceof md)for(var f=0;f<e.size();f++){var g=e.get(f),h=this.network.getElementBox().getSelectionModel().isSelectable(g);if(h){d=g;break}}if(this.network.isSelectingElement()||this.network.isEditingElement()||null==d||(this.network.isMovable(d)&&this.network.getElementBox().getSelectionModel().isSelectable(d)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(a)),!this.network.isSelectingElement()&&!this.network.isEditingElement()){var i=this.network.getSelectionModel();null==d||d&&!this.network.getElementBox().getSelectionModel().isSelectable(d)?(Hb.isCtrlDown(a)?this.isSelecting=!0:this._isDragToSelect(a)?(this.isSelecting=!0,i.clearSelection()):this.network.isRectSelectEnabled()&&(i.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(a)):Hb.isCtrlDown(a)?i.contains(d)?i.removeSelection(d):i.appendSelection(d):i.contains(d)||i.setSelection(d)}this.handleClicked(a,d),this.isMouseDown=!0}},handle_mousemove:function(a){this._setZoomDivVisible(!1);var b=this.network.getLogicalPoint2(a);if(b){var c={x:a.screenX,y:a.screenY},d=this.network.getCanvasSize(),e=this.network.getViewRect().height,f=this.network.getViewRect().width,g=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var h=c.x-this.hBarDownPoint.x;return this.hBarDownPoint=c,void this.network.setViewOffSet(h*d.width/(f-g),0)}if(null!=this.vBarDownPoint){var i=c.y-this.vBarDownPoint.y;return this.vBarDownPoint=c,void this.network.setViewOffSet(0,i*d.height/(e-g))}if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.isMoving||!this.isMouseDown||Hb.isCtrlDown(a))if(this.isSelecting&&(Hb.isCtrlDown(a)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:a}:{kind:"selectBetween",event:a}),this.endPoint=b,this.repaint();else if(this.isMoving||this.isSelecting||!this.isMouseDown)this.end(a);else{if(!this.lastPanPoint||!this.network._dragToPan)return;var b=this.getMarkerPoint(a);if(!b)return;var j=b.x-this.lastPanPoint.x,k=b.y-this.lastPanPoint.y;this.network.panByOffset(-j,-k),this.network.fireInteractionEvent({kind:"panning",event:a}),this.network.state.panning=!0,this.lastPanPoint=b}else{var l=this.getOffset(b,this.lastPoint);if(this.xoffset=l.x,this.yoffset=l.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()}}},handleMouseWheel:function(a){if(Mb.activeElement===this.network.getView()){if(!this.network._wheelToZoom)return void this._handleMouseWheelScroll(a);Ub.preventDefault(a);var b={x:a.offsetX||a.layerX,y:a.offsetY||a.layerY},c=this.network.getZoom();a.wheelDelta&&a.wheelDelta>0||a.detail&&a.detail<0?this.network.setZoom(1.1*c,b):this.network.setZoom(c/1.1,b),this._setZoomDivVisible(this.network.isZoomDivVisible(),a,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))}},_handleMouseWheelScroll:function(a){Ub.preventDefault(a);var b=!1,c=this._getVisibleScrollBar();null!=c&&(b=a.wheelDelta?a.wheelDelta>0:a.detail<0,"v"==c?this.scrollYOffset(b):this.scrollXOffset(b))},handle_mouseup:function(a){this.end(a)},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint2(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0)for(var h=g.size(),i=0;h>i;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}else this.parent=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==c||b?null:c},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y},_getVisibleScrollBar:function(){return 0==this.network.isScrollBarVisible()?null:null!=this.vThumbRect?"v":null!=this.hThumbRect?"h":null},paintScroll:function(a){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();null!=this.hThumbRect&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),null!=this.vThumbRect&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,Vb.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(this.paintScroll(a),this.network.isSelectingElement()){if(null==this.startPoint||null==this.endPoint)return;var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}else{if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;a.beginPath();var k=this.getOffset(this.dragPoint,this.pressPoint),l=k.x,m=k.y,n=this.network.getMovableSelectedElements(),o=n.size(),p=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),q=this.network.getLazyMoveOutlineColor();a.strokeStyle=q,a.lineWidth=i,a.fillStyle=p;for(var r=0;o>r;r++){var s=n.get(r),t=this.network.getElementUI(s);if(t){var u=this.convertFromUIToMarkerRect(t.getViewRect(),l,m);Od.rect(a,u.x,u.y,u.width,u.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var p=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),q=this.network.getLazyMoveOutlineColor();a.strokeStyle=q,a.lineWidth=i,a.fillStyle=p;var u=this.parentRect;Od.rect(a,u.x,u.y,u.width,u.height),a.fill(),a.stroke()}}},handleClicked:function(a,b){Bc.handleClicked(this.network,a,b)},handleDoubleClicked:function(a){var b=this.network.getElementAt(a);Bc.handleDoubleClicked(this.network,a,b)},handle_blur:function(a){this.end()}}),Gb.vector.interaction.CreateElementInteraction=function(a,b){b||(b=Gb.Node),this.elementFunction=Gb.Util.isTypeOf(b,Gb.Node)?function(a){var c=new b;return c instanceof Gb.Node&&c.setCenterLocation(a),c}:b,Gb.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.CreateElementInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Gb.vector.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.linkPointsType=null,Gb.vector.interaction.EditInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.EditInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(1==this.lazyMode&&null!=this.resizingRect){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);a.save(),Gb.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),Od.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},isKeyDown:function(a){return Hb.isAltDown(a)},handle_mousedown:function(a){if(0===a.button)if(!this.isKeyDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?this.isKeyDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink?this.isKeyDown(a)?this.pointIndex>=0&&(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint2(a);if(b instanceof Gb.ShapeNode){var d=this.getPointIndex(this.network.getShapeNodeZoomPoints(b),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Gb.ShapeLink){var e=new Gb.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint2(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Gb.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection}),c.clear()});Gb.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):b&&(this.shapeLink||this.linkUI)&&("from"===this.linkPointsType?this._setFromPoint(b):"to"===this.linkPointsType?this._setToPoint(b):"shapeControl"===this.linkPointsType?(this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):"control"===this.linkPointsType&&wc.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint()&&(this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element})))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){var b=this.network.getEditPointSize();if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if((this.shapeLink||this.linkUI)&&this.linkPointsType){if("from"===this.linkPointsType)return void this._handleMovingFromPoint(a);if("to"===this.linkPointsType)return void this._handleMovingToPoint(a);if("shapeControl"===this.linkPointsType)return void this._handleMovingShapeLinkPoint(a);if("control"===this.linkPointsType&&wc.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint())return void this._handleMovingLinkControlPoint(a)}}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var c=this.network.getElementAt(a),d=this.network.getElementUI(c);if(!d||!d.getEditAttachment())return void this.clear();var e=this.network.getLogicalPoint2(a);if(c instanceof Gb.Node){if(this.node=c,this._isEditingShapeNode(e)||this._isResizingNode(e))return void this.network.setEditingElement(!0);if(this._isRotatingElement(e))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(c instanceof Gb.Link){c instanceof Gb.ShapeLink?this.shapeLink=c:d instanceof Gb.vector.LinkUI&&(this.linkUI=d);var f,g=c.getFromAgent();f=g?c.getFromAgent():c.getFromNode();var h,i=c.getStyle("link.from.xoffset"),j=c.getStyle("link.from.yoffset"),k=this.network.getElementUI(f),l=k.getZoomBodyRect(),m={x:l.x+l.width/2,y:l.y+l.height/2},n={x:m.x+i,y:m.y+j},o=c.getToAgent();h=o?c.getToAgent():c.getToNode();var p=c.getStyle("link.to.xoffset"),q=c.getStyle("link.to.yoffset"),r=this.network.getElementUI(h),s=r.getZoomBodyRect(),t={x:s.x+s.width/2,y:s.y+s.height/2},u={x:t.x+p,y:t.y+q};if(n&&this._contains(e,n,b))return this.linkPointsType="from",this._setCrossCursor(),void this.network.setEditingElement(!0);if(u&&this._contains(e,u,b))return this.linkPointsType="to",this._setCrossCursor(),void this.network.setEditingElement(!0);if(c instanceof Gb.ShapeLink){if(this._isEditingShapeLink(e))return this.linkPointsType="shapeControl",void this.network.setEditingElement(!0)}else if(d instanceof Gb.vector.LinkUI){if(wc.isOrthogonalLink(d._element)){var v=this.linkUI.getControlPoint();if(v&&this._contains(e,v,b))return this.linkPointsType="control",this._setCrossCursor(),void this.network.setEditingElement(!0)}return void(this.linkPointsType=null);
}this.linkPointsType=null}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c.getSizeZoom(d),f=c._getElementZoomRect(d,this.node.getOriginalRect()),g=this.node.getAngle();return this._isRotating(a,"crosshair",f,g,e)},_isRotating:function(a,b,c,d,e){var f=this.network.getRotatePointSize()/this.network.getGraphicsZoom(),g={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()/this.network.getGraphicsZoom()-f},h=this._rotatePoint(g,d,c),i={x:h.x-f,y:h.y-f,width:2*f,height:2*f};return Rb.containsPoint(i,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint2(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=this.network.getZoomBodyRect(b),d=Rb.getCenterPoint(c);return Math.round(180*Math.atan2(d.x-a.x,a.y-d.y)/Math.PI+180)},_resetShapeNodePoints:function(a){var b=this.network.getShapeNodeZoomPoints(this.shapeNode);b.set(this.pointIndex,a);var c=this.network.getElementUI(this.shapeNode),d=this.network.zoomManager._getShapeNodeZoomPoints(c,b,!0);this.shapeNode.setPoints(d)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(a){var b=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);b.set(this.pointIndex,a);var c=this.network.zoomManager._getShapeLinkZoomPoints(b,!0);this.shapeLink.setPoints(c)},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(a){var b=this.linkUI.getControlPoint(),c=this.linkUI.getControlPoint(),d=(this.network.zoomManager,{x:a.x-c.x,y:a.y-c.y});b.x+=d.x,b.y+=d.y,this.linkUI.setControlPoint(b)},_handleMovingLinkControlPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_setFromPoint:function(a){var b;if(this.linkUI)b=this.linkUI._element;else{if(!this.shapeLink)return;b=this.shapeLink}var c,d=b.getFromAgent();c=d?b.getFromAgent():b.getFromNode();var e=this.network.getElementUI(c),f=e.getZoomBodyRect(),g={x:f.x+f.width/2,y:f.y+f.height/2},h={x:a.x-g.x,y:a.y-g.y};b.setStyle("link.from.xoffset",h.x),b.setStyle("link.from.yoffset",h.y)},_handleMovingFromPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setFromPoint(b)},_setToPoint:function(a){var b;if(this.linkUI)b=this.linkUI._element;else{if(!this.shapeLink)return;b=this.shapeLink}var c,d=b.getToAgent();c=d?b.getToAgent():b.getToNode();var e=this.network.getElementUI(c),f=e.getZoomBodyRect(),g={x:f.x+f.width/2,y:f.y+f.height/2},h={x:a.x-g.x,y:a.y-g.y};b.setStyle("link.to.xoffset",h.x),b.setStyle("link.to.yoffset",h.y)},_handleMovingToPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setToPoint(b)},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=this.network.getElementUI(d),i=e.getSizeZoom(h),j=a.x+a.width/2,k=a.y+a.height/2,l=j-a.x,m=k-a.y;return{x:j*f*g-this.network.getViewRect().x+b*f*g-l*i*g,y:k*f*g-this.network.getViewRect().y+c*f*g-m*i*g,width:a.width*i*g,height:a.height*i*g}},_getReverseZoomPoint:function(a,b,c){var d=this.network.zoomManager,e=d.getLocationZoom(),f=d.getSizeZoom(this.network.getElementUI(a));return b.x*=e,b.y*=e,{x:b.x/e+(c.x-b.x)/f,y:b.y/e+(c.y-b.y)/f}},_getReverseZoomRect:function(a,b){var c=this.network.zoomManager,d=c.getLocationZoom(),e=c.getSizeZoom(f);if(d==e)return a;var f=this.network.getElementUI(b),g=f.getBodyRect(),h=g.x+g.width/2,i=g.y+g.height/2,j={x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e,width:a.width*e,height:a.height*e};return h=j.x+j.width/2,i=j.y+j.height/2,{x:h/d+(j.x-h)*e,y:i/d+(j.y-i)*e,width:a.width,height:a.height}},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0},o=this._getReverseZoomPoint(this.node,Hb.clone(f),this._endLogical);if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=o.x,g.y=o.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,1)),"north"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),k.y=p.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=o.x,j.y=o.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,2)),"west"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),n.x=p.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),l.x=p.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=o.x,h.y=o.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,4)),"south"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),m.y=p.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=o.x,i.y=o.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,3)),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_revertResizeRect:function(a,b,c){var d=a.getOriginalRect(),e=Math.max(b.width/d.width,b.height/d.height),f=d.width*e,g=d.height*e,h=b.x,i=b.y;1==c?(h+=b.width-f,i+=b.height-g):2==c?i+=b.height-g:3==c||4==c&&(h+=b.width-f),b.x=h,b.y=i,b.width=f,b.height=g},_isEditingShapeNode:function(a){var b=this.network.getEditPointSize();if(this.node instanceof Gb.ShapeNode){this.shapeNode=this.node;for(var c=this.network.getShapeNodeZoomPoints(this.node),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.network.getEditPointSize(),c=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints()),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c._getElementZoomRect(d,this.node.getOriginalRect()),f=this.node.getAngle(),g={x:e.x,y:e.y},h=this._rotatePoint(g,f,e);return this._isResizing(a,h.x,h.y,"northwest","nwse-resize")?!0:(g={x:e.x+e.width/2,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"north","ns-resize")?!0:(g={x:e.x+e.width,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"northeast","nesw-resize")?!0:(g={x:e.x,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"west","ew-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"east","ew-resize")?!0:(g={x:e.x,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southwest","nesw-resize")?!0:(g={x:e.x+e.width/2,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"south","ns-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){var f=this.network.getGraphicsZoom(),g=this.network.getResizePointSize()/f;return this._contains(a,{x:b,y:c},g)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Rb.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(a){var b,c,d,e,f,g=(new Gb.List,this.network.getRotateScaleWidth()),h=this.network.getRotateScaleHeight(),i=this.network.getRotatePointSize(),j=this.node.getAngle(),k=this.network.zoomManager,l=this.network.getElementUI(this.node),m=k._getElementZoomRect(l,this.node.getOriginalRect()),n={x:m.x+m.width/2,y:m.y-this.network.getRotatePointOffset()-i},o=this._rotatePoint(n,j,m),p="13px Arial",q=j+"",r=this.network.getViewRect();1===k.getLocationZoom()&&(a.translate(-r.x,-r.y),a.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(c={x:o.x+i,y:o.y},d={x:c.x+g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(c={x:o.x-i,y:o.y},d={x:c.x-g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y});var s=new Gb.List([c,d,e,f]),b=Hb.math.getRect(s);1!==k.getLocationZoom()&&(b.x-=r.x,b.y-=r.y),a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=p,a.fillText(q,b.x+b.width/2,b.y+b.height/2),1===k.getLocationZoom()&&(a.scale(1/this.network.getZoom(),1/this.network.getZoom()),a.translate(r.x,r.y))},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Gb.vector.interaction.MoveLinkInteraction=function(a,b){Gb.vector.interaction.MoveLinkInteraction.superClass.constructor.call(this,a),this.xoffset=0,this.yoffset=0},Hb.ext("twaver.vector.interaction.MoveLinkInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);b instanceof Gb.Link&&(this.element=b,this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a,element:this.element});else{this.mark=Ub.createCanvas();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Rb.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Ub.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var c=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(c,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a,element:this.element}))}},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a,element:this.element}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))},d=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(d,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a,element:this.element}));this._handle_mouseup(a),delete this.element}}}),Gb.vector.interaction.CreateLinkInteraction=function(a,b){b||(b=Gb.Link),this.linkFunction=Gb.Util.isTypeOf(b,Gb.Link)?function(a,c){var d=new b;return d instanceof Gb.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Gb.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.CreateLinkInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.zoomManager,e=d.getGraphicsZoom();return{x:a.x*e-this.network.getViewRect().x+b*e,y:a.y*e-this.network.getViewRect().y+c*e,width:a.width*e,height:a.height*e}},getZoomNodeRectOrPoint:function(a,b){var c=this.network.getElementUI(a).getZoomBodyRect();return b?{x:c.x+c.width/2,y:c.y+c.height/2}:c},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.network.getElementUI(this.fromNode).getZoomBodyRect(),d=this.convertPointFromView({x:c.x+c.width/2,y:c.y+c.height/2}),e=d.x,f=d.y,g=this.currentPoint.x,h=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(e,f),a.lineTo(g,h),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a,this.fromNode),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a,b){return this.getNode(a,b)},getNode:function(a,b){var c=this.network.getElementAt(a);return c instanceof Ld&&this.network.isLinkable(c,b)&&this.network.getElementBox().getSelectionModel().isSelectable(c)?c:null}}),Gb.vector.interaction.CreateShapeLinkInteraction=function(a,b){Gb.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Gb.ShapeLink),this.linkFunction=Gb.Util.isTypeOf(b,Gb.ShapeLink)?function(a,c,d){var e=new b;if(e instanceof Gb.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d)){var f=this.network.zoomManager;e.setPoints(f._getShapeLinkZoomPoints(d,!0))}return e}:b},Hb.ext("twaver.vector.interaction.CreateShapeLinkInteraction",Gb.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Gb.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint2(a);if(b){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new Gb.List),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(a){if(this.currentPoint){var b,c=new Gb.List;if(b=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),c.add(b,0),this.points&&this.points.size()>0)for(var d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.currentPoint,c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}}}),Gb.vector.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Gb.ShapeNode),this.shapeNodeFunction=Gb.Util.isTypeOf(b,Gb.ShapeNode)?function(a){var c=new b;if(c instanceof Gb.ShapeNode){var d=this.network.zoomManager,e=this.network.createElementUI(c);if(a){var f=d._getShapeNodeZoomPoints(e,a,!0);e.invalidateZoom(),c.setPoints(f)}}return c}:b,Gb.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a),this.timeStamp=-1},Hb.ext("twaver.vector.interaction.CreateShapeNodeInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){for(var b,c=new Gb.List,d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.convertPointFromView(this.currentPoint),c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint2(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Gb.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.timeStamp=a.timeStamp,this.repaint()}}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint2(a),this.repaint())}}),Gb.vector.interaction.MagnifyInteraction=function(a,b,c,d,e){Gb.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.scale=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Ub.createCanvas()},Hb.ext("twaver.vector.interaction.MagnifyInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network.zoomManager,c=b.getLocationZoom(),d=b.getGraphicsZoom(),e=(b.getSizeZoom(),this.network.getZoom(),this.xRadius/this.scale/d),f=this.yRadius/this.scale/d;if("mousewheel"===this.mouseFlag){var g={x:this.zoomPoint.x-e,y:this.zoomPoint.y-f,width:2*e,height:2*f};this.network.toCanvasByRegion(g,this.scale*d,this.markCanvas,"white");var h={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var g={x:this.point.x*c-e,y:this.point.y*c-f,width:2*e,height:2*f};this.network.toCanvasByRegion(g,this.scale*d,this.markCanvas,"white");var h={x:this.point.x*c*d-this.xRadius-this.network.viewRect.x,y:this.point.y*c*d-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}a.save(),a.beginPath(),Vb.drawVector(a,this.shape,null,h.x,h.y,2*g.width*d,2*g.height*d),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(h.x,h.y,h.width,h.height),a.fill(),a.drawImage(this.markCanvas,h.x,h.y),a.restore(),a.beginPath(),a.lineWidth=this.borderWidth,Vb.drawVector(a,this.shape,null,h.x+this.borderWidth/2,h.y+this.borderWidth/2,2*g.width*d-this.borderWidth,2*g.height*d-this.borderWidth),a.strokeStyle=this.borderColor,a.stroke(),this.mouseFlag=null}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a),this.point&&(this.mouseFlag="mousemove",this.repaint())},handle_mousewheel:function(a){var b=this.network.zoomManager,c=b.getLocationZoom();1!==c&&(this.zoomPoint=this.network.getLogicalPoint2(a)),this.zoomPoint&&(this.mouseFlag="mousewheel",this.repaint())},getScale:function(){return this.scale},setScale:function(a){this.scale=a,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.network.repaintTopCanvas()}}),Gb.vector.interaction.TouchInteraction=function(a){Gb.vector.interaction.TouchInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.TouchInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("touchstart","handleTouchstart",a,this),Ub.addEventListener("touchmove","handleTouchmove",a,this),Ub.addEventListener("touchend","handleTouchend",a,this),Ub.addEventListener("touchcancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("touchstart",a,this),Ub.removeEventListener("touchmove",a,this),Ub.removeEventListener("touchend",a,this),Ub.removeEventListener("touchcancel",a,this)},_isDragToSelect:function(a){return!this.network._dragToPan},handleTouchstart:function(a){if(Ub.preventDefault(a),this.isMoving=!1,this.isSelecting=!1,1==a.touches.length){var b=this.network.getLogicalPoint2(a),c=this._element=this.network.getElementAt(b);if(this._startTouchTime=new Date,this._currentTouchPoint=b,this._startTouchClient=this._currentTouchClient=this.getMarkerPoint(a),c)if(this.network.getSelectionModel().contains(c))this.isSelecting=!0;else{this.network.getSelectionModel().setSelection(c);var d=this.network.getSelectionModel();d.contains(c)&&(this.isSelecting=!0)}else this.isSelecting=!1,this.network.getSelectionModel().clearSelection();Bc.handleClicked(this.network,a,c),this._endTouchTime&&this._startTouchTime.getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchClient,this._startTouchClient)<=20?(delete this._endTouchTime,delete this._endTouchClient,Bc.handleDoubleClicked(this.network,a,c)):(this._endTouchTime=this._startTouchTime,this._endTouchClient=this._startTouchClient)}else this._distance=yc.getDistance(a),this._zoom=this.network.getZoom()},handleTouchmove:function(a){if(Ub.preventDefault(a),a.touches.length>1){var b=yc.getDistance(a);if(Math.abs(b-this._distance)<20)return;var c=b/this._distance;this.network.setZoom(this._zoom*c,!1)}else if(null==this._zoom){var d=this.getMarkerPoint(a);if(Rb.getDistance(this._startTouchClient,d)<20)return;if(this._element)if(this.isSelecting||this._isDragToSelect(a)){var e=this.network.getLogicalPoint2(a),f=this.getOffset(e,this._currentTouchPoint),g=f.x,h=f.y;this._currentTouchPoint=e,this.network.moveSelectedElements(g,h),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}else{var g=this._currentTouchClient.x-d.x,h=this._currentTouchClient.y-d.y;this.network.panByOffset(g,h),this._currentTouchClient=d}else{var g=this._currentTouchClient.x-d.x,h=this._currentTouchClient.y-d.y;this.network.panByOffset(g,h),this._currentTouchClient=d}}},handleTouchend:function(a){Ub.preventDefault(a),this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),0===a.touches.length&&(this._distance=null,this._zoom=null,this._element=null,this._startTouchTime=null,this._currentTouchPoint=null,this._startTouchClient=this._currentTouchClient=null)}}),Gb.vector.interaction.MSTouchInteraction=function(a){Gb.vector.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Hb.ext("twaver.vector.interaction.MSTouchInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("MSPointerDown","handleTouchstart",a,this),Ub.addEventListener("MSPointerMove","handleTouchmove",a,this),Ub.addEventListener("MSPointerUp","handleTouchend",a,this),Ub.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("MSPointerDown",a,this),Ub.removeEventListener("MSPointerMove",a,this),Ub.removeEventListener("MSPointerUp",a,this),Ub.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint2(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY};var e=this.network.getSelectionModel();d?Hb.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Hb.isCtrlDown(a)||e.clearSelection(),Bc.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20?(Bc.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Ub.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c)}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint();
}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var f=-1,g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._moveTouchPoint=null},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(!(Rb.getDistance(this._startClientPoint,b)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint2(a);if(!c)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else{var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}this._startClientPoint=b}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}}),Gb.XmlSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new Gb.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Hb.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+Gb.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()];this.xmlString+="<data class='"+a.getClassName()+"' ref='"+c+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+a.getId()+"'"),this.xmlString+=">\n",a.serializeXml(this,b),this.xmlString+="</data>\n"}a.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(a,b,c){var d=this.settings.getPropertyType(b);if(d){var e=Hb.getValue(a,b,d),f=Hb.getValue(c,b,d);e!==f&&this.serializeValue("p",b,e,f,d)}},serializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(b);if(d){var e=a.getStyle(b),f=c.getStyle(b);e!=f&&this.serializeValue("s",b,e,f,d)}},serializeClientXml:function(a,b,c){var d=this.settings.getClientType(b);if(null!=d){var e=a.getClient(b),f=c.getClient(b);e!=f&&this.serializeValue("c",b,e,f,d)}},serializeValue:function(a,b,c,d,e){if(null==c)this.xmlString+="	<"+a+" n='"+b+"' none=''/>\n";else if("cdata"===e)this.xmlString+="	<"+a+" n='"+b+"'><![CDATA["+c+"]]></"+a+">\n";else if("data"===e){var f=this.refMap[c.getId()];null!=f&&(this.xmlString+="	<"+a+" n='"+b+"' ref='"+f+"'/>\n")}else"point"===e?d&&c.x===d.x&&c.y===d.y||(this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"'/>\n"):"list.point"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<p x='"+a.x+"' y='"+a.y+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):"list.string"===e||"list.number"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<s>"+a+"</s>\n"},this),this.xmlString+="	</"+a+">\n"):this.xmlString+="rectangle"===e?"	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"' w='"+c.width+"' h='"+c.height+"'/>\n":"	<"+a+" n='"+b+"'>"+c+"</"+a+">\n"},deserialize:function(a,b){Hb.isDeserializing=!0,this.xmlString=a;var c=Hb.xml(a).documentElement;this.refMap={},this.idMap={};var d,e,f,g=new md,h=new md,i=c.getElementsByTagName("data"),j=i.length;for(f=0;j>f;f++){e=i[f];var k=e.getAttribute("class"),l=this.settings.getPropertyType("id");if(l&&e.hasAttribute("id")){var m=null;if("string"===l)m=e.getAttribute("id");else if("int"===l)m=parseInt(e.getAttribute("id"));else{if("number"!==l)throw"Unsupported id type '"+l+"'";m=parseFloat(e.getAttribute("id"))}if("remove"===e.getAttribute("action")){this.dataBox.removeById(m);continue}d=this.dataBox.getDataById(m),d||(d=Hb.newInstance(k,m))}else d=Hb.newInstance(k);if(e.hasAttribute("ref")){var n=e.getAttribute("ref");this.refMap[n]=d}g.add(d),h.add(e),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),j=g.size(),f=0;j>f;f++)d=g.get(f),e=h.get(f),d.deserializeXml(this,e);for(f=0;j>f;f++)d=g.get(f),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));this.settings.isDataBoxSerializable&&1===c.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,c.getElementsByTagName("dataBox")[0]),Hb.isDeserializing=!1},deserializePropertyXml:function(a,b,c){var d=this.settings.getPropertyType(c);d&&Hb.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientXml:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(a.hasAttribute("@none"))return null;if("string"===b)return a.textContent;if("number"===b)return parseFloat(a.textContent);if("boolean"===b)return"true"===a.textContent;if("int"===b)return parseInt(a.textContent);if("point"===b)return{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y"))};if("data"===b){var c=a.getAttribute("ref"),d=this.refMap[c];return d?d:this.idMap[c]}var e,f,g,h;if("list.point"===b){var i=new md,j=a.getElementsByTagName("p");for(e=j.length,h=0;e>h;h++){var k=j[h];i.add({x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y"))})}return i}if("list.string"===b){var l=new md;for(g=a.getElementsByTagName("s"),e=g.length,h=0;e>h;h++)l.add(g[h].textContent);return l}if("list.number"===b){for(f=new md,g=a.getElementsByTagName("s"),e=g.length,h=0;e>h;h++)f.add(parseFloat(g[h].textContent));return f}if("array.string"===b)return a.textContent.split(",");if("array.number"===b){for(f=a.textContent.split(","),e=f.length,h=0;e>h;h++)f[h]=parseFloat(f[h]);return f}return"rectangle"===b?{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y")),width:parseFloat(a.getAttribute("w")),height:parseFloat(a.getAttribute("h"))}:a.textContent}}),Hb.addMethod(Gb.Data,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b),this.serializePropertyXml(a,"parent",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),Hb.addMethod(Gb.Element,{serializeXml:function(a,b){if(a.settings.isStyleSerializable&&this._styleMap)for(var c in this._styleMap)this.serializeStyleXml(a,c,b);Gb.Element.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"layerId",b),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")&&(a.xmlString+="	<p n='alarmState'>\n",Gb.AlarmSeverity.forEach(function(b){var c=this.getNewAlarmCount(b);c>0&&(a.xmlString+="		<n n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),Gb.AlarmSeverity.forEach(function(b){var c=this.getAcknowledgedAlarmCount(b);c>0&&(a.xmlString+="		<a n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),a.xmlString+="	</p>\n")},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeXml:function(a,b){if(Gb.Element.superClass.deserializeXml.call(this,a,b),a.settings.isStyleSerializable){var c,d,e=b.getElementsByTagName("s"),f=e.length;for(c=0;f>c;c++)d=e[c],d.hasAttribute("n")&&this.deserializeStyleXml(a,d,d.getAttribute("n"))}},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializePropertyXml:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d,e,f,g=b.getElementsByTagName("n");for(e=0;e<g.length;e++)f=g[e],d=Gb.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setNewAlarmCount(d,parseInt(f.getAttribute("c")));for(g=b.getElementsByTagName("a"),e=0;e<g.length;e++)f=g[e],d=Gb.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(d,parseInt(f.getAttribute("c")))}}else Gb.Element.superClass.deserializePropertyXml.call(this,a,b,c)}}),Hb.addMethod(Ld,{serializeXml:function(a,b){Ld.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"image",b),this.serializePropertyXml(a,"location",b),Hb.num(this._width)&&this._width>=0&&this.serializePropertyXml(a,"width",b),Hb.num(this._height)&&this._height>=0&&this.serializePropertyXml(a,"height",b)}}),Hb.addMethod(Gb.Link,{serializeXml:function(a,b){Gb.Link.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"fromNode",b),this.serializePropertyXml(a,"toNode",b)}}),Hb.addMethod(Gb.Follower,{serializeXml:function(a,b){Gb.Follower.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"host",b)}}),Hb.addMethod(Nd,{serializeXml:function(a,b){Nd.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"expanded",b)}}),Hb.addMethod(Gb.ShapeNode,{serializeXml:function(a,b){Gb.ShapeNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b),this.serializePropertyXml(a,"segments",b)}}),Hb.addMethod(Gb.ShapeLink,{serializeXml:function(a,b){Gb.ShapeLink.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b)}}),Hb.addMethod(Gb.RotatableNode,{serializeXml:function(a,b){Gb.RotatableNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"angle",b)}}),Hb.addMethod(Gb.DataBox,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),Hb.addMethod(Gb.ElementBox,{serializeXml:function(a,b){if(a.settings.isLayerBoxSerializable&&(a.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(b){a.xmlString+=this._layerBox.getDefaultLayer()===b?"		<layer ":"		<layer id='"+b.getId()+"' ",b.getName()&&(a.xmlString+="name='"+b.getName()+"' "),a.xmlString+="visible='"+b.isVisible()+"' editable='"+b.isEditable()+"' movable='"+b.isMovable()+"'/>\n"},null,this),a.xmlString+="	</layerBox>\n"),a.settings.isStyleSerializable&&this._styleMap)for(var c in this._styleMap)this.serializeStyleXml(a,c,b);Gb.ElementBox.superClass.serializeXml.call(this,a,b)},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializeXml:function(a,b){if(Gb.ElementBox.superClass.deserializeXml.call(this,a,b),a.settings.isLayerBoxSerializable&&1==b.getElementsByTagName("layerBox").length)for(var c=b.getElementsByTagName("layerBox")[0].getElementsByTagName("layer"),d=0;d<c.length;d++){var e,f=c[d];if(f.hasAttribute("id")){var g=a.settings.getPropertyType("layerId");if("string"===g)e=new Gb.Layer(f.getAttribute("id"));else if("int"===g)e=new Gb.Layer(parseInt(f.getAttribute("id")));else{if("number"!==g)throw"Unsupported layer id type '"+g+"'";e=new Gb.Layer(parseFloat(f.getAttribute("id")))}this._layerBox.getDataById(e.getId())?e=this._layerBox.getDataById(e.getId()):this._layerBox.add(e)}else e=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(e);f.hasAttribute("name")&&e.setName(f.getAttribute("name")),f.hasAttribute("visible")&&e.setVisible("true"===f.getAttribute("visible")),f.hasAttribute("editable")&&e.setEditable("true"===f.getAttribute("editable")),f.hasAttribute("movable")&&e.setMovable("true"===f.getAttribute("movable"))}if(a.settings.isStyleSerializable)for(var h=b.getElementsByTagName("s"),i=h.length,d=0;i>d;d++){var j=h[d];j.hasAttribute("n")&&this.deserializeStyleXml(a,j,j.getAttribute("n"))}}}),Gb.JsonSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new Gb.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Hb.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:Gb.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var a={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=a,this.dataBox.serializeJson(this,this.dataBox.newInstance(),a),Hb.isEmptyObject(a.p)&&delete a.p,Hb.isEmptyObject(a.s)&&delete a.s,Hb.isEmptyObject(a.c)&&delete a.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()],d={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};if(this.settings.getPropertyType("id")&&(this.jsonObject.id=a.getId()),this.jsonObject.datas.push(d),a.serializeJson(this,b,d),Hb.isEmptyObject(d.p)&&delete d.p,Hb.isEmptyObject(d.s)&&delete d.s,Hb.isEmptyObject(d.c)&&delete d.c,this.settings.isImageSerializable&&a.getImage){var e=a.getImage();if("string"==typeof e&&!Qd[e]&&!this.jsonObject.images[e]){var f=Hb.getImageAsset(e),g=f&&f.getImage();g&&!bd(g)&&(this.jsonObject.images[e]=g)}}}a.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(a,b,c,d){var e=this.settings.getPropertyType(b);if(e){var f=Hb.getValue(a,b,e),g=Hb.getValue(c,b,e);f!==g&&this.serializeValue(b,f,g,e,d.p)}},serializeStyleJson:function(a,b,c,d){var e=this.settings.getStyleType(b);if(e){var f=a.getStyle(b),g=c.getStyle(b);f!=g&&this.serializeValue(b,f,g,e,d.s)}},serializeClientJson:function(a,b,c,d){var e=this.settings.getClientType(b);if(null!=e){var f=a.getClient(b),g=c.getClient(b);f!=g&&this.serializeValue(b,f,g,e,d.c)}},serializeValue:function(a,b,c,d,e){if(null==b)e[a]=null;else if(b instanceof md)e[a]=b._as;else if("data"===d){var f=this.refMap[b.getId()];null!=f&&(e[a]=f)}else e[a]=b},deserialize:function(a,b){Hb.isDeserializing=!0,this.jsonObject=JSON.parse(a);var c=this.jsonObject.images;this.settings.isImageSerializable&&c&&Object.keys(c).forEach(function(a){Hb.registerImage(a,c[a])}),this.refMap={},this.idMap={};for(var d,e=new md,f=new md,g=this.jsonObject.datas.length,h=0;g>h;h++){var i=this.jsonObject.datas[h],j=i["class"],k=this.settings.getPropertyType("id");if(k&&null!=i.id){if("remove"===i.action){this.dataBox.removeById(i.id);continue}d=this.dataBox.getDataById(i.id),d||(d=Hb.newInstance(j,i.id))}else d=Hb.newInstance(j);null!=i.ref&&(this.refMap[i.ref]=d),e.add(d),f.add(i),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),g=e.size(),h=0;g>h;h++)d=e.get(h),d.deserializeJson(this,f.get(h));for(h=0;g>h;h++)d=e.get(h),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Hb.isDeserializing=!1},deserializePropertyJson:function(a,b,c){var d=this.settings.getPropertyType(c);d&&Hb.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleJson:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientJson:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if("data"===b){var c=this.refMap[a];return c?c:this.idMap[a]}return"array.number"===b?a:a instanceof Array?new md(a):a}}),Hb.addMethod(Gb.Data,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c),this.serializePropertyJson(a,"parent",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),Hb.addMethod(Gb.Element,{serializeJson:function(a,b,c){if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleJson(a,d,b,c);if(Gb.Element.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"layerId",b,c),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")){var e={n:{},a:{}};c.p.alarmState=e,Gb.AlarmSeverity.forEach(function(a){var b=this.getNewAlarmCount(a);b>0&&(e.n[a.name]=b)},this._alarmState),Gb.AlarmSeverity.forEach(function(a){var b=this.getAcknowledgedAlarmCount(a);b>0&&(e.a[a.name]=b)},this._alarmState),Hb.isEmptyObject(e.n)&&delete e.n,Hb.isEmptyObject(e.a)&&delete e.a,Hb.isEmptyObject(e)&&delete c.p.alarmState}},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeJson:function(a,b){if(Gb.Element.superClass.deserializeJson.call(this,a,b),a.settings.isStyleSerializable)for(var c in b.s)this.deserializeStyleJson(a,b.s[c],c)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializePropertyJson:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d;for(d in b.n)this._alarmState.setNewAlarmCount(Gb.AlarmSeverity.getByName(d),b.n[d]);for(d in b.a)this._alarmState.setAcknowledgedAlarmCount(Gb.AlarmSeverity.getByName(d),b.a[d])}}else Gb.Element.superClass.deserializePropertyJson.call(this,a,b,c)}}),Hb.addMethod(Ld,{serializeJson:function(a,b,c){Ld.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"image",b,c),this.serializePropertyJson(a,"location",b,c),Hb.num(this._width)&&this._width>=0&&this.serializePropertyJson(a,"width",b,c),Hb.num(this._height)&&this._height>=0&&this.serializePropertyJson(a,"height",b,c)}}),Hb.addMethod(Gb.Link,{serializeJson:function(a,b,c){Gb.Link.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"fromNode",b,c),this.serializePropertyJson(a,"toNode",b,c)}}),Hb.addMethod(Gb.Follower,{serializeJson:function(a,b,c){Gb.Follower.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"host",b,c)}}),Hb.addMethod(Nd,{serializeJson:function(a,b,c){Nd.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"expanded",b,c)}}),Hb.addMethod(Gb.ShapeNode,{serializeJson:function(a,b,c){Gb.ShapeNode.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"points",b,c),this.serializePropertyJson(a,"segments",b,c)}}),Hb.addMethod(Gb.ShapeLink,{serializeJson:function(a,b,c){Gb.ShapeLink.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"points",b,c)}}),Hb.addMethod(Gb.RotatableNode,{serializeJson:function(a,b,c){Gb.RotatableNode.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"angle",b,c)}}),Hb.addMethod(Gb.DataBox,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),Hb.addMethod(Gb.ElementBox,{serializeJson:function(a,b,c){if(a.settings.isLayerBoxSerializable&&(c.layers=[],this._layerBox.forEachByDepthFirst(function(a){var b={};c.layers.push(b),this._layerBox.getDefaultLayer()!==a&&(b.id=a.getId()),a.getName()&&(b.name=a.getName()),b.visible=a.isVisible(),b.editable=a.isEditable(),b.movable=a.isMovable()},null,this)),a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleJson(a,d,b,c);Gb.ElementBox.superClass.serializeJson.call(this,a,b,c)},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializeJson:function(a,b){if(Gb.ElementBox.superClass.deserializeJson.call(this,a,b),a.settings.isLayerBoxSerializable&&b.layers&&b.layers)for(var c=b.layers.length,d=0;c>d;d++){var e,f=b.layers[d];null!=f.id?(e=new Gb.Layer(f.id),this._layerBox.getDataById(e.getId())?e=this._layerBox.getDataById(e.getId()):this._layerBox.add(e)):(e=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(e)),f.name&&e.setName(f.name),null!=f.visible&&e.setVisible(f.visible),null!=f.editable&&e.setEditable(f.editable),null!=f.movable&&e.setMovable(f.movable)}if(a.settings.isStyleSerializable)for(var g in b.s)this.deserializeStyleJson(a,b.s[g],g)}}),Gb.layout.SpringLayouter=function(a){this._network=a,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new md,this._slinks=new md,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},Hb.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(!this._timer){var a=this,b=function(){a.relax.call(a)};this._timer=window.setInterval(b,this._interval),this._damper=1}},stop:function(){this._timer&&(window.clearInterval(this._timer),this._timer=null)},relax:function(){if(!(this._damper<.1&&this._maxMotion<this._motionLimit)){this._rebuild();for(var a=this._snodes.size(),b=0;b<this._stepCount;b++){this._slinks.forEach(this._relaxLink,this);for(var c=0;a>c;c++)for(var d=0;a>d;d++){var e=this._snodes.get(c),f=this._snodes.get(d);e!=f&&this._relaxNodePair(e,f)}this._moveNodes()}this._isAdjusting=!0;for(var b=0;a>b;b++){var g=this._snodes.get(b);g.fix||g.element.setLocation(g.x,g.y)}this._isAdjusting=!1}},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(a){return this._network.isVisible(a)},isMovable:function(a){return this._network.isMovable(a)?this._network.getSelectionModel().contains(a)?!1:a instanceof Nd?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(a){.02>a&&(a=.02),this._nodeRepulsionFactor=a,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(a){.02>a&&(a=.02),this._linkRepulsionFactor=a,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(a){this._stepCount=a,this._damper=1},getInterval:function(){return this._interval},setInterval:function(a){if(this._interval!==a&&(this._interval=a,this._timer)){window.clearInterval(this._timer);var b=this,c=function(){b.relax.call(b)};this._timer=window.setInterval(c,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},_handleDataPropertyChange:function(a){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(a){this._damper=0===this._network.getElementBox().size()?0:1},_handleNetworkPropertyChange:function(a){if("elementBox"===a.property){var b=a.oldValue;null!=b&&(b.removeDataBoxChangeListener(this._handleDataBoxChange,this),b.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(a){var b=a.toNode.x-a.fromNode.x,c=a.toNode.y-a.fromNode.y,d=Math.sqrt(b*b+c*c),e=.25*b,f=.25*c;e/=100*a.length;var g=a.length,h=100*g,i=f;f/=h,i/=100*a.length,a.toNode.dx=a.toNode.dx-e*d,a.toNode.dy=a.toNode.dy-f*d,a.fromNode.dx=a.fromNode.dx+e*d,a.fromNode.dy=a.fromNode.dy+f*d},_relaxNodePair:function(a,b){var c=0,d=0,e=a.x-b.x,f=a.y-b.y,g=e*e+f*f;0===g?(c=Gb.Util.random(),d=Gb.Util.random()):36e4>g&&(c=e/g,d=f/g);var h=a.repulsion*b.repulsion/100,i=.25*h;a.dx+=c*i,a.dy+=d*i,b.dx-=c*i,b.dy-=d*i},_moveNodes:function(){for(var a=this._maxMotion,b=0,c=0,d=this._snodes.size();d>c;c++){var e=this._snodes.get(c),f=e.dx,g=e.dy;f*=this._damper,g*=this._damper,e.dx=f/2,e.dy=g/2;var h=Math.sqrt(f*f+g*g);if(!e.fix)if(e.x=e.x+Math.max(-30,Math.min(30,f)),e.y=e.y+Math.max(-30,Math.min(30,g)),this._limitBounds){e.x<this._limitBounds.x&&(e.x=this._limitBounds.x,this._adjustLocation(1,0)),e.y<this._limitBounds.y&&(e.y=this._limitBounds.y,this._adjustLocation(0,1));var i,j=this._network.getElementUI(e.element);i=j?j._viewRect:e.element.getRect(),i&&(e.x+i.width>this._limitBounds.x+this._limitBounds.width&&(e.x=this._limitBounds.x+this._limitBounds.width-i.width,this._adjustLocation(-1,0)),e.y+i.height>this._limitBounds.y+this._limitBounds.height&&(e.y=this._limitBounds.y+this._limitBounds.height-i.height,this._adjustLocation(0,-1)))}else e.x<1&&this._adjustLocation(1,0),e.y<1&&this._adjustLocation(0,1);b=Math.max(h,b)}this._maxMotion=b,this._motionRatio=this._maxMotion>0?a/this._maxMotion-1:0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(a){this.isVisible(a)&&(a instanceof Gb.Link?this._addLink(a):a instanceof Ld&&this._addNode(a))},this)},_addNode:function(a){var b=this._snodeMap[a.getId()];return b?b:(b={},b.element=a,b.repulsion=this._getRepulsion(a),b.x=a.getX(),b.y=a.getY(),b.dx=0,b.dy=0,b.fix=!this.isMovable(a),this._snodeMap[a.getId()]=b,this._snodes.add(b),b)},_addLink:function(a){var b={};b.fromNode=this._addNode(a.getFromNode()),b.toNode=this._addNode(a.getToNode()),b.element=a;var c,d,e=this._network.getElementUI(a.getToNode()),f=this._network.getElementUI(a.getFromNode());e&&e._viewRect&&f&&f._viewRect?(c=e._viewRect.width+f._viewRect.width,d=e._viewRect.height+f._viewRect.height):(c=a.getToNode().getWidth()+a.getFromNode().getWidth(),d=a.getToNode().getHeight()+a.getFromNode().getHeight()),b.length=Math.floor(Math.sqrt(c*c+d*d)*this._linkRepulsionFactor),b.length<=0&&(b.length=100),this._slinks.add(b)},_getRepulsion:function(a){var b,c=this._network.getElementUI(a);if(c&&c._viewRect){var d=c._viewRect;b=Math.floor(Math.sqrt(d.width*d.width+d.height*d.height)*this._nodeRepulsionFactor)}else b=100;return 0>=b&&(b=100),b},_adjustLocation:function(a,b){for(var c=0,d=this._snodes.size();d>c;c++){var e,f=this._snodes.get(c),g=this._network.getElementUI(f.element);if(e=g?g._viewRect:f.element.getRect(),!e)return;a>0?(!this._limitBounds||f.x+e.width+a<this._limitBounds.x+this._limitBounds.width)&&(f.x+=a):(!this._limitBounds||f.x+a>this._limitBounds.x)&&(f.x+=a),b>0?(!this._limitBounds||f.y+e.height+b<this._limitBounds.y+this._limitBounds.height)&&(f.y+=b):(!this._limitBounds||f.y+b>this._limitBounds.y)&&(f.y+=b)}}}),Gb.layout.CloudLayouter=function(a){Gb.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=a,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new md,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.setInteractions("twaver.network.Network"===this._network.getClassName()?[new Gb.network.interaction.SelectInteraction(this._network)]:[new Gb.canvas.interaction.SelectInteraction(this._network)]);
},Hb.ext("twaver.layout.CloudLayouter",Gb.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(a){return this._network.isVisible(a)&&this._network.isMovable(a)},start:function(a){if(0===arguments.length&&(a=!0),!this._timer){this._installListeners(),a&&this.updateLayoutRect(!0);var b=this,c=function(){b._update.call(b)};this._timer=window.setInterval(c,this._interval),this._update()}},stop:function(){this._timer&&(window.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(a){if(this._interval!==a){var b=this._interval;if(this._interval=a,this._timer){window.clearInterval(this._timer);var c=this,d=function(){c._update.call(c)};this._timer=window.setInterval(d,this._interval)}this.firePropertyChange("interval",b,a)}},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(a){var b=this._moveSpeed;this._moveSpeed=a,this.firePropertyChange("moveSpeed",b,a)},getLayoutRect:function(){var a=this._network.getView().offsetWidth/this._network.getZoom(),b=this._network.getView().offsetHeight/this._network.getZoom(),c=a*this._percentPadding,d=b*this._percentPadding;return{x:c,y:d,width:a-2*c,height:b-2*d}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(a){var b=this._radius;if(this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2,a)this.reload();else{this._lasta=1,this._lastb=1;for(var c=this._nodes.size(),d=0;c>d;d++){var e=this._nodes.get(d);e.cx*=this._radius/b,e.cy*=this._radius/b,e.cz*=this._radius/b}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new md,this._box.forEach(function(a){if(a&&this.isLayoutable(a)){var b={};b.node=a,this._nodes.add(b)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;for(var a=0,b=0,c=this._nodes.size(),d=0;c>d;d++){a=Math.acos(-1+(2*(d+1)-1)/c),b=Math.sqrt(c*Math.PI)*a;var e=this._nodes.get(d);e.cx=this._radius*Math.cos(b)*Math.sin(a),e.cy=this._radius*Math.sin(b)*Math.sin(a),e.cz=this._radius*Math.cos(a)}},_sineCosine:function(a,b,c){var d=Math.PI/180;this._sa=Math.sin(a*d),this._ca=Math.cos(a*d),this._sb=Math.sin(b*d),this._cb=Math.cos(b*d),this._sc=Math.sin(c*d),this._cc=Math.cos(c*d)},handleSelectionChange:function(a){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(a){(this._reloadOnDataBoxChanged||"clear"===a.kind)&&this.reload()},handleMouseMove:function(a){this._centering||this._updateLogicalPoint(a),this._active=this._mouseMoveFunction?this._mouseMoveFunction(a):!0},handleMouseOver:function(a){this._centering||this._updateLogicalPoint(a),this._active=this._mouseOverFunction?this._mouseOverFunction(a):!0},_updateLogicalPoint:function(a){this._localPoint=this._network.getLogicalPoint(a)},handleRollOut:function(a){this._active=!1},handleResize:function(a){if("validateEnd"===a.kind){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(a){"elementBox"===a.property&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),"zoom"===a.property&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);for(var a=this._nodes.size(),b=0;a>b;b++){var c=this._nodes.get(b).node,d=this._box.getDatas().indexOf(c);this._box.getDatas().removeAt(d),this._box.getDatas().add(c,b),this._box.fireIndexChange(c,d,b),this.updateNode(c,b,a,this._nodes.get(b).alpha)}},_sortFunction:function(a,b){return b.cz>a.cz?1:b.cz<a.cz?-1:0},updateNode:function(a,b,c,d){this._updateNodeFunction&&this._updateNodeFunction(a,b,c,d)},_update:function(){if(!this._freeze){var a,b;if(this._centering&&this._centeringNode){var c=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(c)return this._freeze=!0,this._centering=!1,void(this._centeringNode=null)}if(!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(a=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,b=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(a=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,b=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(a=this._lasta*this._ceaseRate,b=this._lastb*this._ceaseRate),this._lasta=a,this._lastb=b,Math.abs(a)>this._ceaseLimit||Math.abs(b)>this._ceaseLimit){var d=0;this._sineCosine(a,b,d);for(var e=0,f=this._nodes.size();f>e;e++){var g=this._nodes.get(e),h=g.cx,i=g.cy*this._ca+g.cz*-this._sa,j=g.cy*this._sa+g.cz*this._ca,k=h*this._cb+j*this._sb,l=i,m=h*-this._sb+j*this._cb,n=k*this._cc+l*-this._sc,o=k*this._sc+l*this._cc,p=m;g.cx=n,g.cy=o,g.cz=p;var q=2*this._radius;q/=q+p,g.perspective=q,g.alpha=(this._radius-p)/(2*this._radius);var r=this._horizontalElliptical*n*q-2*this._horizontalElliptical+this._centerX,s=o*q*this._verticalElliptical+this._centerY;g.node.setCenterLocation(r,s)}this._adjustIndex()}}},centerNode:function(a){if(a&&this.isLayoutable(a)){if(this._centeringNode&&a===this._centeringNode.node&&this._freeze)return;for(var b=0,c=this._nodes.size();c>b;b++){var d=this._nodes.get(b);if(d&&a===d.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=d,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(a){var b=a.getCenterLocation(),c=this.getLayoutRect(),d=c.x+c.width/2,e=c.y+c.height/2,f=Math.atan2(b.y-e,b.x-d),g=c.width+c.height;return{x:d+g*Math.cos(f),y:e+g*Math.sin(f)}},isAtCenter:function(a,b,c,d,e){if(this._moveSpeed<=0)return!0;var f=16/this._moveSpeed;return f>20?f=20:2>f&&(f=2),-e/Math.sqrt(c*c+d*d)>f},_updateNodes:function(a,b,c){this._sineCosine(a,b,c);for(var d=0,e=this._nodes.size();e>d;d++){var f=this._nodes.get(d),g=f.cx,h=f.cy*this._ca+f.cz*-this._sa,i=f.cy*this._sa+f.cz*this._ca,j=g*this._cb+i*this._sb,k=h,l=g*-this._sb+i*this._cb,m=j*this._cc+k*-this._sc,n=j*this._sc+k*this._cc,o=l;f.cx=m,f.cy=n,f.cz=o;var p=2*this._radius;p/=p+o,f.perspective=p;var q=this._horizontalElliptical*m*p-2*this._horizontalElliptical+this._centerX,r=n*p*this._verticalElliptical+this._centerY;f.node.setCenterLocation(q,r)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),Ub.addEventListener("mouseout","handleRollOut",this._network.getView(),this),Ub.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),Ub.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),Ub.removeEventListener("mouseout",this._network.getView(),this),Ub.removeEventListener("mousemove",this._network.getView(),this),Ub.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),Gb.layout.AutoLayouter=function(a,b){this._box=a,this._network=b},Hb.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(a){this._expandGroup=a},getRepulsion:function(){return this._repulsion},setRepulsion:function(a){this._repulsion=a},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(a){this._animate=a},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(a){this._explicitXOffset=a},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(a){this._explicitYOffset=a},getNodeRect:function(a){var b=this;if(a instanceof Gb.Group&&a.isExpanded()&&a.getChildrenSize()>0){for(var c=null,d=0,e=a.getChildrenSize();e>d;d++){var f=a.getChildAt(d);f instanceof Gb.Node&&(c=Gb.Util.unionRect(c,b.getNodeRect(f)))}var g=a.s("group.padding"),h=a.s("group.padding.top"),i=a.s("group.padding.bottom"),j=a.s("group.padding.left"),k=a.s("group.padding.right");return g&&Gb.Util.grow(c,g,g),h&&(c.y-=h,c.height+=h),i&&(c.height+=h),j&&(c.x-=j,c.width+=j),k&&(c.width+=k),c}if(this._network){var l=this._network.getElementUI(a);return l.invalidate(),l.validate(),l.getViewRect()}return null},getDimension:function(a){var b=this.getNodeRect(a);return b?{width:b.width,height:b.height}:{width:a.getWidth(),height:a.getHeight()}},isVisible:function(a){return!0},isMovable:function(a){return!0},getGroupLayoutType:function(a){return this._type},getElements:function(){var a,b=this._box,c=b.getSelectionModel().size()>1;c?a=b.getSelectionModel().getSelection():(a=new md,b.forEachByBreadthFirst(a.add,null,a)),this._xOffset=-1,this._yOffset=-1;for(var d=new md,e=0,f=a.size();f>e;e++){var g=a.get(e);this.isVisible(g)&&(g instanceof Gb.Link?d.add(g):this.isMovable(g)&&g instanceof Ld&&(d.add(g),c&&((this._xOffset<0||g.getX()<this._xOffset)&&(this._xOffset=g.getX()),(this._yOffset<0||g.getY()<this._yOffset)&&(this._yOffset=g.getY()))))}return c||(this._xOffset=isNaN(this._explicitXOffset)?50/this._repulsion:this._explicitXOffset,this._yOffset=isNaN(this._explicitYOffset)?50/this._repulsion:this._explicitYOffset),d},getLayoutResult:function(a){var b={};return this.doLayoutImpl(a,null,b),b},doLayout:function(a,b){return this.doLayoutImpl(a,b)},doLayoutImpl:function(a,b,c){var d=this,e=b;b=function(a){d._box._layoutMovingElements=!1,e&&e(a)},this._type=a;var f=null;if("round"===a?f=new df:"symmetry"===a?f=new sf:"hierarchic"===a?f=new Cf:("topbottom"===a||"bottomtop"===a||"rightleft"===a||"leftright"===a)&&(f=new Re),null==f)return!1;d._box._layoutMovingElements=!0;var g={},h=this.getElements(),i=new tf(this,h,!0,null);h=i.process();var j=new nf(this,h,a,!0,null);try{f.i2(j)}catch(k){return i.resetGroup(),null!=b&&b(!1),!1}var l,m;for(l in j._a){m=j._a[l];var n=j.g4(m);g[l]={x:n.x+this._xOffset,y:n.y+this._yOffset}}var o;if("rightleft"===a||"leftright"===a||"bottomtop"===a){var p=tf.createMatrix(a),q=Number.MAX_VALUE,r=Number.MAX_VALUE;for(l in g){m=j._a[l],o=g[l];var s=p.transform(o);o.x=s.x,o.y=s.y;var t;"rightleft"===a||"leftright"===a?(t=s.x-j.g9(m)/2/this._repulsion,q>t&&(q=t),t=s.y-j.gj(m)/2/this._repulsion,r>t&&(r=t)):(t=s.x-j.gj(m)/2/this._repulsion,q>t&&(q=t),t=s.y-j.g9(m)/2/this._repulsion,r>t&&(r=t))}for(l in g)m=j._a[l],o=g[l],o.x=o.x-q+this._xOffset,o.y=o.y-r+this._yOffset}if(null==c&&this._animate){var u=new md,v=new md;for(l in g)u.add(j._a[l].node),v.add(g[l]);Gb.animate.AnimateManager.endAnimate(),d._box._dataBoxChangeDispatcher.fire({kind:"layouting"}),Gb.animate.AnimateManager.start(new Gb.animate.AnimateCenterLocation(u,v,function(){i.resetGroup(),d._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),null!=b&&Hb.callLater(b,null,[!0])}))}else{d._box._dataBoxChangeDispatcher.fire({kind:"layouting"});for(l in g)m=j._a[l],o=g[l],null==c?m.node.setCenterLocation(o.x,o.y):c[m.node.getId()]=o;i.resetGroup(),d._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),null!=b&&Hb.callLater(b,null,[!0])}return!0}});var Sd=function(a,b){this.x=a,this.y=b};Hb.ext(Sd,Object,{equals:function(a){return this===a?!0:a instanceof Sd?a.x==this.x&&a.y==this.y:!1}});var Td=function(a,b){this.width=a,this.height=b};Hb.ext(Td,Object,{});var Ud=function(a,b){this.x=a,this.y=b};Hb.ext(Ud,Object,{});var Vd=function(){2===arguments.length?(Vd.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(Vd.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};Hb.ext(Vd,Td,{});var Wd=function(a,b){if(Wd.a2(a.x,b.x))this._a=1,this._b=0,this._c=-a.x;else{this._b=-1;var c=(b.y-a.y)/(b.x-a.x),d=a.y-a.x*c;this._a=c,this._c=d}};Hb.ext(Wd,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),Wd.a6=function(a,b){if(Wd.a1(a.a3())&&Wd.a1(b.a3()))return null;if(Wd.a1(a.a4())&&Wd.a1(b.a4()))return null;if(Wd.a1(b.a4())){var c=a;a=b,b=c}var d,e,f=a.a3(),g=a.a4(),h=-a.a5();Wd.a1(a.a3())?(d=b.a4(),e=-b.a5()):(d=b.a4()-b.a3()/a.a3()*a.a4(),e=-b.a5()-b.a3()/a.a3()*-a.a5());var i=e/d,j=(h-i*g)/f;return new Sd(j,i)},Wd.a1=function(a){return Wd.a2(a,0)},Wd.a2=function(a,b){return Math.abs(a-b)<1e-5};var Xd=function(a){if(this._a=new qe,a)for(var b=0;b<a.size();b++)this._a.aa(a.get(b))};Hb.ext(Xd,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){for(var a=new md,b=this.c();b.i1();b.i2())a.add(b.i6(),0);return new Xd(a)},b:function(){return this._a.ay()}});var Yd=function(a,b){this.x=a,this.y=b};Hb.ext(Yd,Object,{a:function(a,b){this.x=a,this.y=b}});var Zd=function(a,b){this.x=a||0,this.y=b||0};Hb.ext(Zd,Object,{b:function(){return new Zd(this.x,this.y)},a:function(a){this.z=a},c:function(){return this.x},d:function(){return this.y},f:function(a,b){this.x=a,this.y=b}});var $d=function(a){this._c=new qe,a?(this.ac(a.a8().b()),this.ad(a.a9().b())):(this.ac(new Zd),this.ad(new Zd))};Hb.ext($d,Object,{a6:function(){return this.a5(this)},ac:function(a){a.a(this),this._a=a},ad:function(a){a.a(this),this._b=a},a8:function(){return this._a},a9:function(){return this._b},a1:function(a,b){return this.a4(a,b,this.aa())},a2:function(){return this._c.ay()},a7:function(a){return this._c.ak(a)},aa:function(){return 0===this._c.ay()?null:this._c.as()},a3:function(){this._c.af()},i2:function(a){var b=this.a7(a);return null!=b?new Sd(b.x,b.y):null},i1:function(){return this.a2()},i6:function(){var a=this.a8();return new Sd(a.c(),a.d())},i7:function(){var a=this.a9();return new Sd(a.c(),a.d())},i8:function(a){this.a8().f(a.x,a.y)},i9:function(a){this.a9().f(a.x,a.y)},i3:function(a,b,c){var d=this.a7(a);null!=d&&d.a(b,c)},i4:function(a,b){this.a1(a,b)},i5:function(){this.a3()}});var _d=function(a){_d.superClass.constructor.call(this,a)};Hb.ext(_d,$d,{a5:function(a){return new _d(a)},a4:function(a,b,c){var d=new Yd(a,b);return this.ab(d,c),d},ab:function(a,b){this._c.an(a,this._c.al(b))}});var ae=function(){if(2===arguments.length){var a=arguments[0],b=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=a-this._w/2,this._y=b-this._h/2}else{var c=arguments[0];this._s=c._s,this._w=c._w,this._h=c._h,this._x=c._x,this._y=c._y}};Hb.ext(ae,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(a,b){this._x=a-this._w/2,this._y=b-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(a,b){this._x=a,this._y=b},i3:function(){return this._w},i4:function(){return this._h},i6:function(a,b){var c=(this._w-a)/2,d=(this._h-b)/2;this._x+=c,this._y+=d,this._w=a,this._h=b},m1:function(a){var b,c,d,e;a.width<=0?(b=this._x,c=this._x+this._w,d=this._y,e=this._y+this._h):(b=Math.min(this._x,a.x),c=Math.max(this._x+this._w,a.x+a.width),d=Math.min(this._y,a.y),e=Math.max(this._y+this._h,a.y+a.height)),a.x=b,a.y=d,a.width=c-b,a.height=e-d}});var be=function(a){a?be.superClass.constructor.call(this,a):be.superClass.constructor.call(this,0,0)};Hb.ext(be,ae,{m2:function(a){return new be(a)}});var ce={};ce.a2=function(a){var b=Ne.a2(Hf.a(a.xa()));return ce.a4(a,b,ce.a3(a,b))},ce.a3=function(a,b){for(var c=a.x9();c.i1();c.i2())b.i7(c.i9(),-1);for(var d=0,e=new we(a.xa()),f=a.x9();f.i1();f.i2()){var g=f.i9();-1===b.i2(g)&&ce.a(g,e,b,d++)}return d},ce.a6=function(a){for(var b=new re,c=ce.a2(a),d=0;d<c.length-1;d++){var e=a.xo(c[d].x2(),c[d+1].x3());b.aa(e)}return b},ce.a4=function(a,b,c){for(var d=[],e=0;c>e;e++)d[e]=new Je;for(var f=a.x9();f.i1();f.i2())d[b.i2(f.i9())].ae(f.i9());return d},ce.a=function(a,b,c,d){for(b.c(a),c.i7(a,d);!b.a();){a=b.b();for(var e=a.ag();null!=e;e=e.a8()){var f=e.a3();-1===c.i2(f)&&(c.i7(f,d),b.c(f))}for(var g=a.ae();null!=g;g=g.a7()){var h=g.a2();-1===c.i2(h)&&(c.i7(h,d),b.c(h))}}},ce.a1=function(a,b,c){var d=new le(b,c);return d.a8(a),d._i},ce.a5=function(a,b,c){for(var d=[],e=0;c>e;e++)d[e]=new re;for(var f=a.xf();f.i1();f.i2())d[b.i2(f.i8())].aa(f.i8());return d},ce.a7=function(a){var b=new re,c=Ne.a3(Hf.b(a.xa())),d=Ne.a4(Hf.a(a.xh())),e=ce.a1(a,d,c),f=ce.a5(a,d,e);if(f.length>1){for(var g=new Je,h=0;h<f.length;h++){var i=f[h],j=null;if(1===i.ay()){var k=i.c2();1===k.a2().ad()?j=k.a2():1===k.a3().ad()&&(j=k.a3())}else{for(var l=i.c1();l.i1();l.i2()){var m=l.i8();if(c.i4(m.a2()))if(null==j)j=m.a2();else if(j!==m.a2()){j=null;break}if(c.i4(m.a3()))if(null!=j){if(j!==m.a3()){j=null;break}}else j=m.a3()}if(null!=j){var n=i.c2();j=n.a2()!==j?n.a2():n.a3()}}null!=j&&g.aa(j)}for(var o,p=g.x4();!g.ar();p=o)o=g.x4(),b.ac(a.xo(p,o))}return b};var de=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};Hb.ext(de,Object,{a6:function(a){this._f=a},a7:function(a){this._b=a},a8:function(a){0!==a.x0()&&this.a9(a,a.x9().i9())},a9:function(a,b){if(this._xx=a.xk(),this._c=a.xl(),this._d=0,this._e=0,this.a0(b),this._b)for(var c=a.x9();c.i1();c.i2()){var d=c.i9();null==this._xx.i1(d)&&(this.a1(d),this.a0(d))}a.xi(this._xx),a.xj(this._c)},a0:function(a){var b=++this._d;this._xx.z1(a,de._B),this.a5(a,b);for(var c=this._f?a.ap():a.af();c.i1();c.i2()){var d=c.i8();if(!this._c.i4(d)){this._c.i7(d,!0);var e=d.a1(a);null==this._xx.i1(e)?(this.a3(d,e,!0),this.a0(e),this.a2(d,e)):this.a3(d,e,!1)}}this.a4(a,b,++this._e),this._xx.z1(a,de._C)},a5:function(a,b){},a4:function(a,b,c){},a3:function(a,b,c){},a2:function(a,b){},a1:function(a){}}),de._B={},de._C={};var ee=function(a){this._a=a};Hb.ext(ee,de,{a5:function(a,b){var c=this._a._ah.i2(a);this._a._ad[c].ae(a)}});var fe=function(a){this._a=a};Hb.ext(fe,de,{a2:function(a,b){var c=a.a1(b),d=this._a[c.al()],e=this._a[b.al()];e._a+1>d._a?(d._c=d._a,d._b=d._d,d._a=e._a+1,d._d=a):e._a+1>d._c&&(d._c=e._a+1,d._b=a)}});var ge=function(a){this._a=a};Hb.ext(ge,de,{a3:function(a,b,c){c&&a.a2()===b&&this._a.ac(a)}});var he=function(){this._a=0,this._c=0};Hb.ext(he,Object,{});var ie=function(){this._a=0};Hb.ext(ie,Object,{a1:function(a,b){this._a=0;for(var c=b.length-1;c>=0;c--)b[c]=-1;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();if(0===e.ak()){this.a2(e,e.al(),b);break}}for(var f=a.x9();f.i1();f.i2()){var g=f.i9(),h=g.al();-1===b[h]&&this.a2(g,h,b)}},a2:function(a,b,c){c[b]=-2;for(var d=a.ag();null!=d;){var e=d.a3(),f=e.al();switch(c[f]){case-1:this.a2(e,f,c);case-2:default:d=d.a8()}}c[b]=this._a++}});var je={};je.a1=function(a){var b=new ke;return b.a8(a),b._n},je.a2=function(a){var b=a.x9(),c=null,d=0;for(b.i4();b.i1();b.i2())0===b.i9().ak()&&(c=b.i9(),d++);if(1===d)return c;for(d=0,b.i4();b.i1();b.i2())0===b.i9().ao()&&(c=b.i9(),d++);return 1===d?c:je.a8(a)},je.a8=function(a){var b=Hf.a(a.x0()),c=Ne.a2(b);return je.a6(a,c)},je.a6=function(a,b){var c=a.xd(),d=Hf.d(1),e=Hf.a(a.x0(),-1),f=je.a4(a,c);je.a7(c,b,d,e,-1);for(var g=f.c1();g.i1();g.i2())a.x3(g.i8());return d[0]},je.a7=function(a,b,c,d,e){for(var f=0,g=a.ag();null!=g;g=g.a8()){var h=g.a3(),i=je.a7(h,b,c,d,e);i>e&&(e=i),f+=d[h.al()]}for(var j=f*(a._g.xa()-1-f),k=a.ag();null!=k;k=k.a8())for(var l=k.a3(),m=k.a8();null!=m;m=m.a8()){var n=m.a3();j+=d[l.al()]*d[n.al()]}return b.i7(a,j),d[a.al()]=f+1,j>e&&(e=j,c[0]=a),e},je.a4=function(a,b){var c=new re,d=new ge(c);d.a6(!1),d.a9(a,b);for(var e=c.c1();e.i1();e.i2())a.x3(e.i8());return c},je.a3=function(a){return je.a4(a,je.a2(a))};var ke=function(){this._n=!0,this.a6(!1)};Hb.ext(ke,de,{a3:function(a,b,c){c||(this._n=!1)},a1:function(a){this._n=!1}});var le=function(a,b){this._i=0,this._m=b,this._j=a,this._l=!1};Hb.ext(le,de,{a8:function(a){this._h=Hf.a(a.x0()),this._k=Hf.a(a.x0()),this._g=new we(a.xh()),le.superClass.a8.call(this,a)},a5:function(a,b){this._k[a.al()]=this._h[a.al()]=b},a3:function(a,b,c){if(this._g.c(a),!c){var d=a.a1(b);this._h[d.al()]=Math.min(this._h[d.al()],this._k[b.al()])}},a1:function(a){this._l=!1},a2:function(a,b){var c=a.a1(b);if(this._h[b.al()]>=this._k[c.al()]){for(;this._g.d()!==a;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(c,!0):this._l=!0:this._m.i5(c,!0)}this._h[c.al()]=Math.min(this._h[c.al()],this._h[b.al()])}});var me=function(a,b){this._h=!1,this._i=a,this._g=b};Hb.ext(me,Object,{z1:function(a,b){a._c[this._i]=b},i1:function(a){return a._c[this._i]},i5:function(a,b){a._c[this._i]=b},i4:function(a){return a._c[this._i]},i7:function(a,b){a._c[this._i]=b},i2:function(a){var b=a._c[this._i];return null==b?0:b},i6:function(a,b){a._c[this._i]=b},i3:function(a){var b=a._c[this._i];return null==b?0:b},c:function(){return this._h},d:function(){this._h=!0}});var ne=function(a,b){this._c=!1,this._d=a,this._b=b};Hb.ext(ne,Object,{i8:function(a,b){a._c[this._d]=b},i1:function(a){return a._c[this._d]},i7:function(a,b){a._c[this._d]=b},i4:function(a){var b=a._c[this._d];return null==b?!1:b},i5:function(a,b){a._c[this._d]=b},i2:function(a){var b=a._c[this._d];return null==b?0:b},i6:function(a,b){a._c[this._d]=b},i3:function(a){var b=a._c[this._d];return null==b?0:b},a:function(){return this._c},b:function(){this._c=!0}});var oe=function(a){this._bb=a,this.i4()};Hb.ext(oe,Object,{i1:function(){return null!=this._aa},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var pe=function(a){pe.superClass.constructor.call(this,a)};Hb.ext(pe,oe,{i8:function(){return this.i6()}});var qe=function(a){if(this._id=Hb.id(),this._a=0,a)for(a.i4();a.i1();a.i2())this.ae(a.i6())};Hb.ext(qe,Object,{ac:function(a){var b=this.ag(a);return null==this._b?this._b=this._c=b:(this._b._b=b,b._a=this._b,this._b=b),this._a++,b},ae:function(a){var b=this.ag(a);return null==this._c?this._b=this._c=b:(this._c._a=b,b._b=this._c,this._c=b),this._a++,b},z1:function(a){a._b=null,a._a=null,null==this._c?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++},ad:function(a){a._b=null,a._a=null,null==this._b?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++},aa:function(a){return this.ae(a),!0},ab:function(a){for(;a.i1();a.i2())this.ae(a.i6())},ao:function(a,b){if(b===this._b)return this.ac(a);if(null==b)return this.ae(a);var c=this.ag(a);return this.aq(c,b),c},aq:function(a,b){if(null==b)this.ad(a);else if(b===this._b)this.ad(a);else{if(null==this._c)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._b;b._b=a,a._a=b,c._a=a,a._b=c}this._a++}},ap:function(a,b){if(null==b)this.z1(a);else if(b===this._c)this.z1(a);else{if(null==this._b)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._a;b._a=a,a._a=c,c._b=a,a._b=b}this._a++}},an:function(a,b){if(b===this._c)return this.ae(a);if(null==b)return this.ac(a);var c=this.ag(a);return this.ap(c,b),c},ay:function(){return this._a},ar:function(){return 0===this._a},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var a=this.am();return this.aw(this._b),a},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(a){for(var b=0,c=this._b;null!=c;){if(a===b)return c._c;c=c._a,b++}return null},aj:function(a){return null==a._a?this._b:a._a},ai:function(a){return null==a._b?this._c:a._b},aw:function(a){return a!==this._b?a._b._a=a._a:this._b=a._a,a!==this._c?a._a._b=a._b:this._c=a._b,this._a--,a._c},av:function(a){return this.aw(a._aa)},ah:function(){return new oe(this)},al:function(a){for(var b=this._b;null!=b;){if(null==b._c&&null==a)return b;if(b._c===a)return b;b=b._a}return null},a0:function(){for(var a=Hf.d(this._a),b=0,c=this._b;null!=c;)a[b]=c._c,c=c._a,b++;return a},ax:function(){for(var a=this._b;null!=a;a=a._b){var b=a._a;a._a=a._b,a._b=b}var c=this._b;this._b=this._c,this._c=c},a1:function(a){var b=this.a0();b.sort(a);for(var c=0,d=this._b;null!=d;)d._c=b[c],d=d._a,c++},a2:function(){var a=this.a0();a.sort(Hf.c);for(var b=0,c=this._b;null!=c;)c._c=a[b],c=c._a,b++},az:function(a){null==this._b?(this._b=a._b,this._c=a._c):null!=a._b&&(this._c._a=a._b,a._b._b=this._c,this._c=a._c),this._a+=a._a,a._b=a._c=null,a._a=0},ag:function(a){return new ue(a)}});var re=function(a){re.superClass.constructor.call(this,a)};Hb.ext(re,qe,{c1:function(){return new pe(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var se=function(){this._c=0};Hb.ext(se,Object,{a:function(a){this._c++,a._b=this._b,a._a=null,null!=this._b?(this._b._a=a,this._b=a):this._b=this._a=a},b:function(a,b){if(null==b)return void this.a(a);var c=b._b;null!=c?c._a=a:this._a=a,a._b=c,a._a=b,b._b=a,this._c++},c:function(a){var b=a._a,c=a._b;this._c--,null!=b?b._b=c:this._b=c,null!=c?c._a=b:this._a=b}});var te=function(a,b){this._p=a,this._j=b,this._o=a._o[b]};Hb.ext(te,Object,{i1:function(){return null!=this._o},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var ue=function(a){this._c=a};Hb.ext(ue,Object,{a:function(){return this._a},b:function(){return this._b},c:function(a){this._c=a},d:function(){return this._c}});var ve=function(a,b,c,d){this._r=a,this._s=b,this._q=c,this._p=d};Hb.ext(ve,Object,{i1:function(a){return this._p[a.a5()]},i3:function(a){return this._r[a.a5()]},i2:function(a){return this._s[a.a5()]},i4:function(a){return this._q[a.a5()]},i8:function(a,b){this._p[a.a5()]=b},i6:function(a,b){this._r[a.a5()]=b},i5:function(a,b){this._s[a.a5()]=b},i7:function(a,b){this._q[a.a5()]=b}});var we=function(a){this._a=Hf.d(a),this._b=-1};Hb.ext(we,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(a){this._a[++this._b]=a},a:function(){return this._b<0}});var xe=function(){};Hb.ext(xe,Object,{a0:function(a){this._c=Hf.d(a)}});var ye=function(a,b,c,d,e,f,g){this._g=0,a.xt(this,b,c,d,e,f,g)};Hb.ext(ye,xe,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(a){return this._d!==a?this._d:this._e},a4:function(){for(var a=0;1>=a;a++)this._k[a]=null,this._f[a]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(a,b,c,d){this.a0(d),this._h=a,this._k=Hf.d(2),this._f=Hf.d(2),this._d=b,this._e=c}});var ze=function(a){this._j=0,this._h=a,this.i4()};Hb.ext(ze,Object,{i2:function(){this._k=this._k._k[this._j],null==this._k&&0===this._j&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],null==this._k&&1===this._j&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],null==this._k?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],null==this._k?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return null!=this._k},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var Ae=function(){this._a=ff._A,this._b=ff._A,this._c=new md};Hb.ext(Ae,Object,{i1:function(){return this._c.size()},i2:function(a){return this._c.get(a)},i3:function(a,b,c){this._c.set(a,new Sd(b,c))},i4:function(a,b){this._c.add(new Sd(a,b))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(a){this._a=a},i9:function(a){this._b=a}});var Be=function(){this._x=0,this._y=0,this._w=0,this._h=0};Hb.ext(Be,Object,{i5:function(a,b){this._x=a,this._y=b},i6:function(a,b){this._w=a,this._h=b},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Ce=function(a,b,c,d){this._m=a,this._n=b,this._l=c,this._k=d};Hb.ext(Ce,Object,{i1:function(a){return this._k[a.al()]},i3:function(a){return this._m[a.al()]},i2:function(a){return this._n[a.al()]},i4:function(a){return this._l[a.al()]},z1:function(a,b){this._k[a.al()]=b},i6:function(a,b){this._m[a.al()]=b},i7:function(a,b){this._n[a.al()]=b},i5:function(a,b){this._l[a.al()]=b}});var De=function(a,b){this._b=a,this._r=b,this._a=[];for(var c=this._b-1;c>=0;c--)this._a.push(c);this._c=new md};Hb.ext(De,Object,{a1:function(a){var b;if(0===this._a.length){this.a2(a,this._b,this._b+this._r);for(var c=this._b+this._r-1;c>this._b;c--)this._a.push(c);b=this._b,this._b+=this._r}else b=this._a.pop();return b},b:function(a){var b=this.a1(a),c=new me(b,this);return this._c.add(c),this.a4(a,b),c},c:function(a){var b=this.a1(a),c=new ne(b,this);return this._c.add(c),this.a4(a,b),c},a2:function(a,b,c){for(var d=a._a;null!=d;d=d._a){var e=Hf.d(c);Hf.f(d._c,e,b),d._c=e}},a3:function(a,b,c){var d=Hf.d(c);Hf.f(a._c,d,b),a._c=d},a4:function(a,b){for(var c=a._a;null!=c;c=c._a)c._c[b]=null},a5:function(a,b){if(a instanceof me){var c=a;if(c.c())throw"Error";c.d();var d=a._i;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}},a6:function(a,b){if(a instanceof ne){var c=a;if(c.a())throw"Error";c.b();var d=c._d;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}}});var Ee=function(a){this._id=Hb.id(),this._p=0,a.xs(this)};Hb.ext(Ee,xe,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new ze(this)},am:function(){return new te(this,1)},ap:function(){return new te(this,0)},an:function(){return new Ge(this)},aq:function(){return new Fe(this,1)},aw:function(){return new Fe(this,0)},ah:function(a){for(var b=this._o[0];null!=b;b=b._k[0])if(b.a3()===a)return b;return null},ai:function(a){for(var b=this._o[1];null!=b;b=b._k[1])if(b.a2()===a)return b;return null},aj:function(a){var b=this.ah(a);return null==b&&(b=this.ai(a)),b},au:function(a){this.at(a,1,Hf.d(this.ak()))},av:function(a){this.at(a,0,Hf.d(this.ao()))},as:function(a,b){this.a0(b),this._g=a,this._o=Hf.d(2),this._q=Hf.d(2),this._n=Hf.a(2)},ab:function(a,b,c,d,e){if(null==b)return void this.aa(a,c,d);var f;if(f=b._d===b._e?d:this!==b._d?1:0,0===e){var g=b._k[f];a._f[d]=b,a._k[d]=g,b._k[f]=a,null==g?this._q[c]=a:g._d===g._e?g._f[d]=a:g._f[this!==g._d?1:0]=a;
}else{var h=b._f[f];a._k[d]=b,a._f[d]=h,b._f[f]=a,null==h?this._o[c]=a:h._d===h._e?h._k[d]=a:h._k[this!==h._d?1:0]=a}this._n[c]++},aa:function(a,b,c){var d=this._q[b];a._k[c]=null,null==d?(this._o[b]=a,a._f[c]=null):(a._f[c]=d,d._d===d._e?d._k[c]=a:d._k[this!==d._d?1:0]=a),this._q[b]=a,this._n[b]++},ar:function(a,b,c){var d,e;d=a._k[c],e=a._f[c],null==d?this._q[b]=e:d._f[d._d!==this?1:0]=e,null==e?this._o[b]=d:e._k[e._d!==this?1:0]=d,this._n[b]--},ac:function(){for(var a=0;1>=a;a++)this._o[a]=null,this._q[a]=null,this._n[a]=0},at:function(a,b,c){if(!(this._n[b]<2)){var d,e=this._n[b],f=0;for(d=this._o[b];null!=d;d=d._k[b])c[f]=d,f++;Hf.s(c,e,a);var g=this._o[b]=c[0];g._f[b]=null;for(var h=1;e>h;)d=c[h],d._f[b]=g,g._k[b]=d,h++,g=d;this._q[b]=d,d._k[b]=null}}});var Fe=function(a,b){Fe.superClass.constructor.call(this,a,b),this._h=1!==b?1:0};Hb.ext(Fe,te,{i6:function(){return this.i9()},i9:function(){return 0!==this._h?this._o._e:this._o._d}});var Ge=function(a){Ge.superClass.constructor.call(this,a)};Hb.ext(Ge,ze,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var He=function(a){He.superClass.constructor.call(this,a)};Hb.ext(He,oe,{i9:function(){return this.i6()}});var Ie=function(a){this._o=a,this._c=a._a};Hb.ext(Ie,Object,{i1:function(){return null!=this._c},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var Je=function(a){if(a&&a.length){Je.superClass.constructor.call(this);for(var b=0;b<a.length;b++)this.ae(a[b])}else Je.superClass.constructor.call(this,a)};Hb.ext(Je,qe,{x1:function(){return new He(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var Ke=function(a){this._d=a,Ke.superClass.constructor.call(this)};Hb.ext(Ke,Je,{});var Le=function(a){this._a=a,this._b=new re,this._c=new Je};Hb.ext(Le,Object,{a:function(){for(var a=this._a.x9();a.i1();a.i2())this.e(a.i9())},b:function(){this.c(),this.d()},c:function(){for(;!this._c.ar();){var a=this._c.x4();this._a.xq(a)||this.g(a)}},d:function(){for(;!this._b.ar();){var a=this._b.c3();this._a.xp(a)||this.f(a)}},e:function(a){for(var b=a.af();b.i1();b.i2())this._b.ac(b.i8()),this._a.h1(b.i8());this._c.ac(a),this._a.h2(a)},f:function(a){this._a.u1(a)},g:function(a){this._a.h3(a)}}),Le.h=function(a,b){for(b.i4();b.i1();b.i2()){var c=b.i8();a.xq(c.a2())||a.h3(c.a2()),a.xq(c.a3())||a.h3(c.a3()),a.xp(c)||a.u1(c)}},Le.i=function(a,b){for(b.i4();b.i1();b.i2()){var c=b.i8();a.xp(c)&&a.h1(c),0===c.a2().ad()&&a.h2(c.a2()),0===c.a3().ad()&&a.h2(c.a3())}};var Me=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new qe,this._e=0,1!==arguments.length&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};Hb.ext(Me,Object,{a:function(a,b,c,d){for(var e=Hf.d(c-b+1),f=b;c>=f;f++)e[f]=new Ke(f);for(var g=this._g.x9();g.i1();g.i2()){var h=g.i9();(null==d||d.i4(h))&&(this._f.z1(h,e[a.i2(h)-b].ac(h)),this._e++)}for(var i=0;i<e.length;i++)for(var j=e[i],k=this._d.ae(j),l=j.x1();l.i1();l.i2())this._h.z1(l.i9(),k)},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return 0===this._e},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var a=this._d.am().x4();return this._h.z1(a,null),this._f.z1(a,null),a},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var a=this._d.as().x4();return this._h.z1(a,null),this._f.z1(a,null),a},d:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.a();null!=f?(e=f.d(),this._h.z1(a,f)):(e=new Ke(d._d+1),this._h.z1(a,this._d.ae(e))),d.aw(b),this._f.z1(a,e.ac(a))},b:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.b();null!=f?(e=f.d(),this._h.z1(a,f)):(e=new Ke(d._d-1),this._h.z1(a,this._d.ac(e))),d.aw(b),this._f.z1(a,e.ac(a))}});var Ne={};Ne.a1=function(a){return new Ce(a,null,null,null)},Ne.a2=function(a){return new Ce(null,a,null,null)},Ne.a3=function(a){return new Ce(null,null,a,null)},Ne.a4=function(a){return new ve(null,a,null,null)},Ne.a5=function(a){return new ve(null,null,a,null)},Ne.a6=function(a){return new ve(null,null,null,a)};var Oe=function(){if(2===arguments.length){this._a=new qe,this._b=new qe,this._c=0;var a=arguments[0],b=arguments[1],c=new Pe(a._j2.gj(b)/2,0);this._a.ac(c),c=new Pe(a._j2.gj(b)/2,0),this._b.ac(c)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};Hb.ext(Oe,Object,{});var Pe=function(a,b){this._b=a,this._a=b};Hb.ext(Pe,Object,{});var Qe=function(){this._cx=!0,this._cs=new af,this._ct=new $e,this._cw=new _e};Hb.ext(Qe,Object,{i5:function(a){this._cx=a},k:function(){var a=new bf(this);return this._cx&&(this._cs.w1(a),a=this._cs),this._cw.w1(a),a=this._cw,this._ct.w1(a),a=this._ct},i2:function(a){this.k().i2(a)},i1:function(a){return this.k().i1(a)}});var Re=function(){Re.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(a,b){var c=a.a3(),d=b.a3(),e=c._g;return Math.floor(100*(e.g5(c)-e.g5(d)))}};Hb.ext(Re,Qe,{i4:function(a){return je.a1(a)},i3:function(a){if(!this.i4(a))throw"Error";var b=je.a3(a);if(this._j2=a,this._j3=new Se(a),of.c(a),this._jy=a.xk(),!a.xb()){this.bu();var c=this._j3.c1();this.f(c),this.b(this._j3),this.c(this._j3)}for(var d;!b.ar();a.x3(d))d=b.c3(),of.b(a.g2(d))},bu:function(){if(null!=this._jx)for(var a=this._j2.x9();a.i1();a.i2())a.i9().av(this._jx)},c:function(a){for(var b=this.a2(a),c=Hf.a(b.length),d=0;d<b.length;d++){for(var e=b[d],f=0,g=e.ah();g.i1();g.i2()){var h=g.i6();f=Math.max(f,this._j2.g9(h))}c[d]=f}for(var i=-this._jw,j=0;j<b.length;j++){i+=this._jw+c[j];for(var k=b[j],l=k.ah();l.i1();l.i2()){var m=l.i6();this._j2.s2(m,this._j2.g5(m),i-c[j]/2)}}},a2:function(a){for(var b=Hf.d(a.b()),c=0,d=a.b();d>c;c++)b[c]=new qe;return a.c1(),this.a1(a.c1(),0,b),b},a1:function(a,b,c){c[b].ae(a);for(var d=a.aw();d.i1();d.i2())this.a1(d.i9(),b+1,c)},b:function(a){var b=a.c1();this._j2.s2(b,0,this._j2.g6(b)),this.g(b)},g:function(a){for(var b=a.aw();b.i1();b.i2()){var c=b.i9(),d=this._jy.i1(c);this._j2.s2(c,this._j2.g5(a)+d._c,this._j2.g6(c)),this.g(c)}},f:function(a){if(this._j3.c2(a))return void this._jy.z1(a,new Oe(this,a));var b=a.aw(),c=b.i9();b.i2(),this.f(c);var d=this._jy.i1(c),e=new Oe(this,d._a,d._b,0);if(!b.i1())return e._a.ac(new Pe(this._j2.gj(a)/2,0)),e._b.ac(new Pe(this._j2.gj(a)/2,0)),void this._jy.z1(a,e);for(;b.i1();){c=b.i9(),b.i2(),this.f(c),d=this._jy.i1(c);for(var f=e._b.ah(),g=d._a.ah(),h=2147483647,i=0,j=0;f.i1()&&g.i1();){var k=f.i6();f.i2();var l=g.i6();g.i2(),j+=k._a,i+=l._a,h=Math.min(h,i-j-k._b-l._b)}d._c=this._jv-h,i+=d._c;var m=d._b.am();if(m._a=d._c,f.i1()&&!g.i1())for(var n=j-this.a3(d._b);f.i1();n=0){var o=f.i6();f.i2(),d._b.ae(new Pe(o._b,o._a+n))}else if(!f.i1()&&g.i1()){var p=this.a3(e._a);for(p=i-p;g.i1();p=0){var q=g.i6();g.i2(),e._a.ae(new Pe(q._b,q._a+p))}}e._b=d._b}this._jy.z1(a,e);for(var r=-d._c/2,s=a.aw();s.i1();){var t=s.i9();s.i2();var u=this._jy.i1(t);u._c+=r;var v=u._b.am();v._a+=r,v=u._a.am(),v._a+=r}e._a.ac(new Pe(this._j2.gj(a)/2,0)),e._b.ac(new Pe(this._j2.gj(a)/2,0))},a3:function(a){for(var b=0,c=a.ah();c.i1();c.i2()){var d=c.i6();b+=d._a}return b}});var Se=function(a){this._b=a,this.a()};Hb.ext(Se,Object,{c1:function(){return null==this._a&&this.a(),this._a},b:function(){return null==this._a?-1:this.d(this._a)},d:function(a){for(var b=0,c=a.aw();c.i1();c.i2())b=Math.max(b,this.d(c.i9()));return b+1},c2:function(a){return 0===a.ao()},a:function(){for(var a=this._b.x9();a.i1();a.i2())if(0===a.i9().ak())return void(this._a=a.i9())}});var Te=function(a){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=a,this._c=new qe};Hb.ext(Te,Object,{a:function(){return this._d+this._e+this._f}});var Ue=function(){Ue.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};Hb.ext(Ue,Qe,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(a){if(!je.a1(a))throw"Error";this._a=a;var b=this.i8(),c=je.a4(a,b);of.c(a),this._kn=Hf.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9();e!==b?this.aa(e,new Te(this._kk+this.q(e.aq().i9()))):this.aa(e,new Te(this._kk))}this.s(b),a.s2(b,0,0),this.t(b);for(var f;!c.ar();a.x3(f))f=c.c3()},i4:function(a){return je.a1(a)},i0:function(a){return this._kn[a.al()]},i8:function(){return je.a2(this._a)},i7:function(a){for(var b,c=this.ib(a);b=this.i6(a),!(c>=b);)for(var d=a.aw();d.i1();d.i2()){var e=d.i9();this.i0(e)._g*=1+this._ko}var f=(c-b)/(2*a.ao());b=0;for(var g=a.aw();g.i1();g.i2()){var h=this.i0(g.i9());h._d+=f,h._e+=f,b+=h._d+h._e}this.id(a)},id:function(a){for(var b=Hf.d(a.ao()),c=0,d=a.ap();d.i1();)b[c]=d.i8(),d.i2(),c++;var e=this;b.sort(function(a,b){var c=a.a3(),d=b.a3(),f=e.i0(c).a()-e.i0(d).a();return f>0?1:f>=0?0:-1});for(var f=0;f<b.length;f++)this._a.h1(b[f]);for(var g=0;g<b.length;g+=2)this._a.u1(b[g]);for(c=b.length-1,c%2===0&&c--;c>0;c-=2)this._a.u1(b[c])},ib:function(a){return 0===a.ak()?this._km:2===a.ao()?Math.min(180,this._kl):this._kl},i6:function(a){for(var b=0,c=a.ap();c.i1();c.i2()){for(var d,e=c.i8(),f=e.a3(),g=this.i0(f),h=-g._g,i=g._b,j=g._c,k=0,l=k+1,m=j._b,n=m.d();l>k;l=(d.y-i)/(d.x-h))d=n,m=j.ai(m),n=m.d(),k=(n.y-d.y)/(n.x-d.x);for(g._d=180*-Math.atan(l)/Math.PI,k=0,l=k-1,m=j._b,n=m.d();m.a().d().x===n.x;n=m.d())m=m.a();for(var o;k>l;l=(o.y-i)/(o.x-h))o=n,m=j.aj(m),n=m.d(),k=(n.y-o.y)/(n.x-o.x);g._e=180*Math.atan(l)/Math.PI,b+=g._d+g._e}return b},aa:function(a,b){this._kn[a.al()]=b},p:function(a){var b=this.i0(a),c=new qe,d=2*this.q(a);c.aa(new Sd(0,0)),c.aa(new Sd(0,d)),c.aa(new Sd(d,d)),c.aa(new Sd(d,0)),b._c=c,b._a=d/2,b._b=d/2},r:function(a){if(0===a.ao())this.p(a);else{var b=this.i0(a),c=this.q(a),d=new qe;d.aa(new Sd(-c,-c)),d.aa(new Sd(-c,c)),d.aa(new Sd(c,-c)),d.aa(new Sd(c,c));for(var e=a.aw();e.i1();e.i2()){var f=this.i0(e.i9());d.az(f._c)}for(var g=ff.h(d),h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MIN_VALUE,l=g.ah();l.i1();l.i2()){var m=l.i6();m.x<h&&(h=m.x),m.x>j&&(j=m.x),m.y<i&&(i=m.y),m.y>k&&(k=m.y)}for(var n=new qe,o=g.ah();o.i1();o.i2()){var p=o.i6();n.aa(new Sd(p.x-h,p.y-i))}b._c=n,b._a=-h,b._b=-i}},s:function(a){if(0===a.ao())this.r(a);else{for(var b=a.aw();b.i1();b.i2())this.s(b.i9());this.i7(a);for(var c=0,d=a.aw();d.i1();d.i2()){var e=d.i9(),f=this.i0(e),g=180-(360-this.ib(a))/2-c-(f._e+f._f);c+=f.a(),g=g/180*Math.PI;for(var h=Math.sin(g),i=Math.cos(g),j=f._c._b;null!=j;j=j.a()){var k=j.d(),l=k.x+f._g,m=k.y-f._b,n=new Sd(l*i-h*m,l*h+i*m);j.c(n)}var o=f._a+f._g;f._a=o*i,f._b=o*h}this.r(a)}},t:function(a){var b=this._a.g4(a),c=0;if(a.ak()>0){var d=a.aq().i9(),e=this._a.g4(d);c=Math.PI+Math.atan2(e.y-b.y,e.x-b.x)}for(var f=a.aw();f.i1();f.i2()){var g=f.i9(),h=this.i0(g);if(0!==c){var i=Math.cos(c),j=Math.sin(c),k=h._a*i-j*h._b,l=h._a*j+i*h._b;h._a=k,h._b=l}this._a.s2(g,b.x+h._a,b.y+h._b),this.t(g)}},q:function(a){return 1.41*(Math.max(this._a.gj(a),this._a.g9(a))/2)}});var Ve=function(){};Hb.ext(Ve,Object,{i2:function(a){return a.ad()},i1:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var We=function(a){this._a=a};Hb.ext(We,Object,{i2:function(a){for(var b=0,c=a.an();c.i1();c.i2())null!=this._a.i1(c.i9())&&b++;return b},i4:function(a){return null==this._a.i1(a)},i1:function(a){throw"Error"},i3:function(a){throw"Error"}});var Xe=function(){Xe.superClass.constructor.call(this),this._kq=!1,this._kp=90};Hb.ext(Xe,Ue,{a:function(a,b){this._kr=b,this._ks=a,this._kq=!0},i7:function(a){if(!this.u(a))return void Xe.superClass.i7.call(this,a);for(var b=this.i9(),c=this.ib(a),d=(360-c)/2+c,e=new re(a.ap());;){var f=this.i6(a);f=(360-c)/2;for(var g=null,h=null,i=e._b;null!=i;i=i.a()){var j=i.d(),k=j.a3(),l=this.i0(k),m=this._ks.i3(j),n=m-(f+l._e);if(n>=0&&m+l._d>=d&&(n=f+l.a()<=d?d-f-l.a():2*(d-(m+l._d))),l._f=0,n>=0)l._f=n,g=i,h=l;else{for(-n>l._d+l._e?n=(l._d+l._e)/2:n/=-2,f-=n,d>=f&&f+l.a()>d&&(f+=n,n=f+l.a()-d,f-=n);null!=g&&n>h._f;h=this.i0(g.d().a3()))if(n-=h._f,h._f=0,g=g.b(),null==g){h=null;break}null!=g?h._f-=n:f+=n}f+=l.a()}if(d>=f){for(var o=0,p=(360-c)/2,q=a.ap();q.i1();q.i2()){var r=q.i8(),s=r.a3(),t=this._ks.i3(r),u=this.i0(s),v=p+u._f+u._e;o<Math.abs(v-t)&&(o=Math.abs(v-t)),p+=u.a()}if(o<=this._kp)break}for(var w=a.aw();w.i1();w.i2()){var x=w.i9();this.i0(x)._g*=1+b}}},ib:function(a){return this.u(a)?0===a.ak()?this.ic():this.ia():Xe.superClass.ib.call(this,a)},u:function(a){return this._kq&&0!==a.ao()?null!=this._ks.i1(a.ag()):!1}});var Ye=function(a){this._a=a};Hb.ext(Ye,Object,{i1:function(a){return this._a.i1(a)},i2:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var Ze=function(){};Hb.ext(Ze,Object,{w1:function(a){this._bb=a},w2:function(){return this._bb},w4:function(a){null!=this._bb&&this._bb.i2(a)},w3:function(a){return null!=this._bb?this._bb.i1(a):!0}});var $e=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};Hb.ext($e,Ze,{i1:function(a){if(null!=this.w2()){for(var b=!0,c=a.xk(),d=ce.a3(a,c),e=Hf.d(d),f=Hf.d(d),g=0;d>g;g++)e[g]=new Je,f[g]=new re;for(var h=a.xf();h.i1();h.i2()){var i=h.i8();f[c.i2(i.a2())].aa(i),a.h1(i)}for(var j=a.x9();j.i1();j.i2()){var k=j.i9();e[c.i2(k)].aa(k),a.h2(j.i9())}for(var l=0;d>l;l++){for(var m=e[l].x1();m.i1();m.i2())a.h3(m.i9());for(var n=f[l].c1();n.i1();n.i2())a.u1(n.i8());b=this.w3(a);for(var o=f[l].c1();o.i1();o.i2())a.h1(o.i8());for(var p=e[l].x1();p.i1();p.i2())a.h2(p.i9());if(!b)break}for(var q=0;d>q;q++)for(var r=e[q].x1();r.i1();r.i2())a.h3(r.i9());for(var s=0;d>s;s++)for(var t=f[s].c1();t.i1();t.i2())a.u1(t.i8());return a.xi(c),b}return!0},i2:function(a){if(!a.xb()){for(var b=a.xk(),c=ce.a3(a,b),d=Hf.d(c),e=Hf.d(c),f=Hf.d(c),g=Hf.d(c),h=0;c>h;h++)d[h]=new Je,e[h]=new re;for(var i=a.xf();i.i1();i.i2()){var j=i.i8();e[b.i2(j.a2())].aa(j),a.h1(j)}for(var k=a.x9();k.i1();k.i2()){var l=k.i9();d[b.i2(l)].aa(l),a.h2(k.i9())}for(var m=0;c>m;m++){for(var n=d[m].x1();n.i1();n.i2())a.h3(n.i9());for(var o=e[m].c1();o.i1();o.i2())a.u1(o.i8());this.w4(a);var p=a.g3();f[m]=new Vd(p.x,p.y,p.width,p.height);var q={};if(g[m]=q,this._cf>0){var r=this._cg+Math.ceil((p.width+1)/this._cf)*this._cf,s=this._cg+Math.ceil((p.height+1)/this._cf)*this._cf;q.x=p.x,q.y=p.y,q.width=r,q.height=s}else q.x=p.x,q.y=p.y,q.width=p.width+this._cg,q.height=p.height+this._cg;for(var t=e[m].c1();t.i1();t.i2())a.h1(t.i8());for(var u=d[m].x1();u.i1();u.i2())a.h2(u.i9())}for(var v=0;c>v;v++)for(var w=d[v].x1();w.i1();w.i2())a.h3(w.i9());for(var x=0;c>x;x++)for(var y=e[x].c1();y.i1();y.i2())a.u1(y.i8());if(of.a(g,null,this._ce/this._ch),this._cf<=0)for(var z=0;z<g.length;z++)this.w5(a,d[z],e[z],new Sd(g[z].x,g[z].y),f[z]);else for(var A=0;A<g.length;A++){var B=Math.floor((g[A].x-f[A].x)/this._cf)*this._cf,C=Math.floor((g[A].y-f[A].y)/this._cf)*this._cf,D=f[A].x+B,E=f[A].y+C;this.w5(a,d[A],e[A],new Sd(D,E),f[A])}a.xi(b)}},w5:function(a,b,c,d,e){for(var f=-e.x+d.x,g=-e.y+d.y,h=b.x1();h.i1();h.i2()){var i=a.ga(h.i9());a.s4(h.i9(),new Sd(i.x+f,i.y+g))}for(var j=c.c1();j.i1();j.i2()){for(var k=j.i8(),l=new md,m=a.gp(k).c();m.i1();m.i2()){var n=m.i6();l.add(new Sd(n.x+f,n.y+g))}a.s5(k,new Xd(l))}}});var _e=function(){};Hb.ext(_e,Ze,{i1:function(a){return this.w3(a)},i2:function(a){this.w7(a),null!=this.w2()&&this.w4(a),this.w6(a)},w7:function(a){this.e(a),this.k(a),this.i(a)},e:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},w6:function(a){this.l(a),this.j(a),this.f(a)},l:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},j:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},k:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},f:function(a){null!=this._ca&&(a.x1("A",this._ca),this._ca=null,this._b6=null),null!=this._b8&&(a.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(a){this._ca=a.xc("A"),null!=this._ca&&(this._b6=new Ye(this._ca),a.x1("A",this._b6)),this._b8=a.xc("B"),null!=this._b8&&(this._b9=new Ye(this._b8),a.x1("B",this._b9))}});var af=function(){this._a=new re,this._c=10};Hb.ext(af,Ze,{i2:function(a){this._b=a.xl(),this.w9(a),this.w4(a),this.c(a),this.w8(a,this._b),a.xj(this._b)},i1:function(a){if(null==this.w2())return!0;this._b=a.xl(),this.w9(a);var b=this.w3(a);return this.c(a),a.xj(this._b),b},w8:function(a,b){for(var c=a.xf();c.i1();c.i2()){var d=c.i8();if(null!=b.i1(d)){var e=b.i1(d);of.g(a,d,e,this._c)}}},w9:function(a){for(var b=a.xk(),c=a.x9();c.i1();c.i2()){for(var d=c.i9(),e=d.af();e.i1();e.i2()){var f=e.i8(),g=f.a1(d),h=b.i1(g);if(h!==f)if(null==h)b.z1(g,f);else{null==this._b.i1(h)&&this._b.i8(h,new re);var i=this._b.i1(h);i.aa(f),this._a.ac(f),a.h1(f)}}for(var j=d.af();j.i1();j.i2()){var k=j.i8(),l=k.a1(d);b.z1(l,null)}}a.xi(b)},c:function(a){for(;!this._a.ar();a.u1(this._a.c3()));}});var bf=function(a){this._a=a};Hb.ext(bf,Object,{i2:function(a){this._a.i3(a)},i1:function(a){return this._a.i4(a)}});var cf=function(){cf.superClass.constructor.call(this),this._jo=30,this._jp=new gf,this._jt=5};Hb.ext(cf,Qe,{i4:function(a){return!0},i3:function(a){this._ju=a,of.c(a);for(var b=this._jp.i1(a),c=0,d=a.x9();d.i1();d.i2())c=Math.max(c,this.e(d.i9()));c<this._jt&&(c=this._jt),this.a(b,c)},a:function(a,b){var c=a.i7(),d=2*Math.PI/c,e=0,f=Hf.a(c);a.i4();for(var g=0;c>g;)f[g]=this.e(a.i9())+this._jo,e+=f[g],g++,a.i2();var h=e/c,i=e/(2*Math.PI);b>i&&(i=b),a.i4();for(var j=0,k=0;c>k;){var l=d/h*f[k];j+=l/2;var m=Math.cos(j)*i,n=Math.sin(j)*i;j+=l/2,this._ju.s2(a.i9(),m,n),k++,a.i2()}return i},e:function(a){var b=this._ju.gj(a),c=this._ju.g9(a);return c>=b?c:b}});var df=function(){df.superClass.constructor.call(this),this._jm=new cf,this._jk=new Xe};Hb.ext(df,Qe,{i4:function(a){return!0},i3:function(a){if(!(a.x0()<2)){this._jn=a,of.c(this._jn),of.e(this._jn);var b=new mf(this._jn);b.a1(),b.h();var c=new Le(this._jn);c.a();for(var d=b.x9();d.i1();d.i2()){var e=d.i9(),f=b.c2(e);if(f.ay()>1){var g=b.d1(e);Le.h(this._jn,g.c1()),this._jm.i3(this._jn);var h=this._jn.g3();b.s7(e,h.width,h.height)}else if(1===f.ay()){var i=f.x2();b.s8(e,this._jn.gm(i)),this._jn.s2(i,0,0)}else b.s7(e,1,1);Le.i(this._jn,this._jn.xf())}c.b();var j=this.a7(b);je.a4(b,j);var k=b.xk(),l=b.xl();this.a2(b,l,k),this.a1(b,l),this.a3(b,j,l),this._jk.a(l,k),this._jk.i3(b),this.a5(b,j,k);for(var m=b.x9();m.i1();m.i2())for(var n=m.i9(),o=b.g4(n),p=b.c2(n).x1();p.i1();p.i2()){var q=p.i9();this._jn.s2(q,o.x+this._jn.g5(q),o.y+this._jn.g6(q))}}},a7:function(a){for(var b=-1,c=null,d=a.x9();d.i1();d.i2()){var e=d.i9();a.c2(e).ay()>b&&(c=e,b=a.c2(e).ay())}return c},a1:function(a,b){for(var c=function(a,c){var d=b.i3(a)-b.i3(c);return d>0?1:d>=0?0:-1},d=a.x9();d.i1();d.i2())d.i9().av(c)},a2:function(a,b,c){for(var d=Hf.a(this._jn.x0()),e=a.x9();e.i1();e.i2())for(var f=e.i9(),g=a.c2(f),h=g.x1();h.i1();h.i2()){var i=h.i9();d[i.al()]=f.al()}var j=je.a2(a);this.a4(a,j,d,b,c)},a3:function(a,b,c){if(a.c2(b).ay()>1){for(var d=0,e=0,f=0,g=b.ap();g.i1();g.i2()){var h=g.i8(),i=c.i3(h);i-d>e&&(e=i-d,f=(d+i)/2),d=i}360-d>e&&(f=(360+d)/2),this.a6(a,b,f);for(var j=b.ap();j.i1();j.i2()){var k=j.i8(),l=c.i3(k);for(l-=f;0>l;l+=360);c.i6(k,l)}b.av(function(a,b){var d=c.i3(a)-c.i3(b);return d>0?1:d>=0?0:-1})}},a4:function(a,b,c,d,e){for(var f=b.al(),g=e.i3(b),h=b.ap();h.i1();h.i2()){for(var i=h.i8(),j=a.b(i),k=0,l=0,m=0,n=0,o=j.c1();o.i1();o.i2()){var p=o.i8(),q=null,r=null;c[p.a2().al()]===f?(q=p.a2(),r=p.a3()):(q=p.a3(),r=p.a2()),m-=this._jn.g5(q),n+=this._jn.g6(q),k-=this._jn.g5(r),l+=this._jn.g6(r)}if(0!==m||0!==n){var s;for(s=180*Math.atan2(n,m)/Math.PI-g;0>s;s+=360);d.i6(i,s)}if(0!==k&&0!==l){var t=180*Math.atan2(l,k)/Math.PI;0>t&&(t+=360),e.i6(i.a3(),t)}this.a4(a,i.a3(),c,d,e)}},a5:function(a,b,c){for(var d=a.g4(b),e=b.ap();e.i1();e.i2()){var f=e.i8(),g=f.a3(),h=a.g4(g),i=h.x-d.x,j=h.y-d.y,k=180*Math.atan2(j,i)/Math.PI;if(null!=c.i1(g)){var l=c.i3(g);k+=l}this.a6(a,g,k),this.a5(a,g,c)}},a6:function(a,b,c){c=c/180*Math.PI;var d=a.c2(b);if(!(d.ay()<=1))for(var e=d.x1();e.i1();e.i2()){var f=e.i9(),g=this._jn.g5(f),h=this._jn.g6(f),i=Math.cos(c),j=Math.sin(c),k=g*i-j*h,l=g*j+i*h;this._jn.s2(f,k,l)}}});var ef=function(){this._a=(new Date).getTime()};Hb.ext(ef,Object,{b:function(){return(new Date).getTime()-this._a}});var ff={};ff._A=new Sd(0,0),ff.b=function(a,b,c){return ff.c(a.x,a.y,b.x,b.y,c.x,c.y)},ff.c=function(a,b,c,d,e,f){c-=a,d-=b,e-=a,f-=b;var g=e*d-f*c;return Math.abs(g)<1e-5?0:g>=0?0>=g?0:-1:1},ff.d=function(a,b,c){return ff.b(a,b,c)>0},ff.f=function(a,b,c){return ff.b(a,b,c)<0},ff.g=function(a,b,c){return 0===ff.b(a,b,c)},ff.h=function(a){return ff.i(a)},ff.i=function(a){var b=new qe(a.ah()),c=new qe;if(b.a2(),b.ar())return c;var d=b.at();for(c.ae(d);!b.ar()&&d.equals(b.am());b.at());if(b.ar())return c;d=b.at();for(var e=c.ae(d),f=b.ah();f.i1();f.i2()){var g=f.i6();if(!g.equals(d))if(d=g,2===c.ay()&&ff.g(c.am(),c.as(),g))e.c(g);else{var h;for(h=e;!ff.f(c.ai(h).d(),h.d(),g);h=c.ai(h));var i;for(i=e;!ff.d(c.aj(i).d(),i.d(),g);i=c.aj(i));for(;i!==c.aj(h);c.aw(c.aj(h)));e=c.an(g,h)}}return c},ff.j=function(){return ff.k(Number.MAX_VALUE)},ff.k=function(a){return Math.floor(Gb.Util.random()*a)},ff.l=function(a,b){return Gb.Util.random()*(b-a)+a};var gf=function(){};Hb.ext(gf,Object,{i1:function(a){this._b=a;var b=new re;b=ce.a6(a),b.az(ce.a7(a));for(var c=this.a1();!b.ar();a.x5(b.c3()));return c.x1()},a1:function(){if(this._b.x0()<3)return new Je(this._b.x9());for(var a=this._b.xk(),b=this._b.xk(),c=this._b.xl(),d=new Me(this._b,new Ve,0,this.a3(this._b)),e=this._b.x0(),f=new re,g=new re,h=new Le(this._b);e>3;e--){for(var i=d.g(),j=i.an();j.i1();j.i2())a.z1(j.i9(),e),b.i5(j.i9(),!1);for(var k=i.an();k.i1();k.i2())for(var l=k.i9(),m=l.ap();m.i1();m.i2()){var n=m.i8();a.i2(n.a3())===e&&(g.aa(n),b.i5(n.a2(),!0),b.i5(n.a3(),!0))}if(g.ay()<i.ad()-1){for(var o=null,p=i.an();p.i1();p.i2()){var q=p.i9();if(a.i2(q)===e&&!b.i4(q))if(null==o)o=q;else{var r=this._b.xo(o,q);c.i7(r,!0),g.aa(r),o=null}}if(null!=o)for(var s=i.an();s.i1();s.i2()){var t=s.i9();if(t!==o&&null==t.aj(o)){var u=this._b.xo(o,t);c.i7(u,!0),g.aa(u);break}}if(g.ay()<i.ad()-1){for(var v=2147483647,w=null,x=i.an();x.i1();x.i2()){var y=x.i9();y.ad()<v&&(w=y,v=y.ad())}for(var z=i.an();z.i1();z.i2()){var A=z.i9();if(null==w.aj(A)&&w!==A){var B=this._b.xo(w,A);if(c.i7(B,!0),g.aa(B),g.ay()>=i.ad()-1)break}}}}for(var C=i.an();C.i1();C.i2())d.b(C.i9());for(var D=g.c1();D.i1();D.i2()){var E=D.i8();c.i4(E)&&(d.d(E.a2()),d.d(E.a3()))}f.az(g),h.e(i)}h.b(),d.c();for(var F=f.c1();F.i1();F.i2()){var G=F.i8();null!=G._h&&(c.i4(G)?this._b.x5(G):this._b.h1(G))}var H=this.a4(this._b),I=new Je,J=H.ak(0),K=H.ak(1),L=null;L=J.a2()===K.a2()||J.a2()===K.a3()?J.a3():J.a2(),I.aa(L);for(var M=H.c1();M.i1();M.i2()){var N=M.i8();L=N.a1(L),I.aa(L)}for(var O=f.c1();O.i1();O.i2()){var P=O.i8();c.i4(P)||null!=P._h||this._b.u1(P)}return this._b.xi(b),this._b.xj(c),this._b.xi(a),this.a2(I),I},a2:function(a){if(a.ay()<this._b.x0()){for(var b=this._b.xk(),c=a._b;null!=c;c=c.a()){var d=c.d();b.z1(d,c)}var e;for(e=new Me(this._b,new We(b),0,a.ay(),new We(b));!e.e();){for(var f=e.f(),g=f.an();g.i1();g.i2()){var h=g.i9();if(null!=b.i1(h)){var i=b.i1(h),j=a.ai(i).d(),k=null;k=null!=f.aj(j)?a.ao(f,i):a.an(f,i),b.z1(f,k);break}}for(var l=f.an();l.i1();l.i2()){var m=l.i9();null==b.i1(m)&&e.d(m)}}this._b.xi(b),e.c()}},a3:function(a){for(var b=0,c=a.x9();c.i1();c.i2())b=Math.max(b,c.i9().ad());return b},a4:function(a){for(var b=[],c=0,d=a.x0();d>c;c++)b[c]=new he;var e=new fe(b);e.a6(!1),e.a8(a);for(var f=-1,g=null,h=a.x9();h.i1();h.i2()){var i=h.i9(),j=b[i.al()];j._a+j._c>f&&(f=j._a+j._c,g=i)}for(var k=new re,l=g,m=b[l.al()]._d;null!=m;m=b[l.al()]._d)k.ac(m),l=m.a1(l);l=g;for(var n=b[l.al()]._b;null!=n;n=b[l.al()]._d)k.ae(n),l=n.a1(l);return k}});var hf=function(){this._v=new se,this._x=new se,this._z=new De(3,5),this._w=new De(3,5),this._y=!1,this._u=!1,this._t={}};Hb.ext(hf,Object,{xm:function(){var a=new Ee(this);return a},xo:function(a,b){return this.xn(a,null,b,null,0,0)},xn:function(a,b,c,d,e,f){return new ye(this,a,b,c,d,e,f)},x4:function(a){this.b3(a)},b3:function(a){for(var b;null!=(b=a._o[0]);)this.x5(b);for(;null!=(b=a._o[1]);)this.x5(b);this._v.c(a),a._g=null,this._y=!0},x5:function(a){this.a11(a)},a11:function(a){if(a._h!==this)throw"Error";var b=a.a2(),c=a.a3();this.a12(a,b,c),this._x.c(a),a._h=null,this._u=!0},x7:function(a){a._p=this._v._c,a._g=this,a.ac(),a._c.length<this._z._b&&this._z.a3(a,a._c.length,this._z._b),this._v.a(a),this._y=!0},x8:function(a){if(null!=a._h)throw"Error";a._c.length<this._w._b&&this._w.a3(a,a._c.length,this._w._b),null==a._a||a._a._h!==this?this._x.a(a):this._x.b(a,a._a),a._h=this,a.a4(),this.b2(a,a.a2(),null,a.a3(),null,0,0),this._u=!0},xr:function(a,b,c){var d=a.a2(),e=a.a3();null==a._h?(a._d=b,a._e=c):(d!==b&&(d.ar(a,0,0),a._d=b,b.ab(a,null,0,0,0)),e!==c&&(e.ar(a,1,1),a._e=c,c.ab(a,null,1,1,0)))},x3:function(a){this.xr(a,a.a3(),a.a2())},h1:function(a){this.a11(a)},u1:function(a){this.x8(a)},h2:function(a){this.x4(a)},h3:function(a){this.x7(a)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return 0===this._v._c},xq:function(a){return a._g===this},xp:function(a){return a._h===this},xd:function(){return this._v._a},x9:function(){return new Ie(this._v)},xf:function(){return new Ie(this._x)},x2:function(a,b){var c=Hf.d(this.xh());if(null!=a&&null!=b)for(var d=this.x9();d.i1();d.i2())d.i9().at(a,1,c),d.i9().at(b,0,c);else if(null==b&&null!=a)for(var e=this.x9();e.i1();e.i2())e.i9().at(a,1,c);else if(null!=b&&null==a)for(var f=this.x9();f.i1();f.i2())f.i9().at(b,0,c)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(a){this._z.a5(a,this._v)},xj:function(a){this._w.a6(a,this._x)},xc:function(a){return this._t[a]},x1:function(a,b){this._t[a]=b},x6:function(a){delete this._t[a]},b2:function(a,b,c,d,e,f,g){b.ab(a,c,0,0,f),d.ab(a,e,1,1,g)},a12:function(a,b,c){b.ar(a,0,0),c.ar(a,1,1)},c:function(){for(var a=0,b=this.x9();b.i1();b.i2())b.i9()._p=a++;this._y=!1},b1:function(){for(var a=0,b=this.xf();b.i1();b.i2())b.i8()._g=a++;this._u=!1},xs:function(a){a.as(this,this._z._b),a._p=this._v._c,this._v.a(a)},xt:function(a,b,c,d,e,f,g){a.a6(this,b,d,this._w._b),a._g=this._x._c,this._x.a(a),this.b2(a,a.a2(),c,a.a3(),e,f,g)}});var jf=function(){jf.superClass.constructor.call(this)};Hb.ext(jf,hf,{gb:function(a){return this.g1(a)},g7:function(a){return this.g2(a)},g5:function(a){var b=this.g1(a);return b.i1()+b.i3()/2},g6:function(a){var b=this.g1(a);return b.i2()+b.i4()/2},g4:function(a){return new Sd(this.g5(a),this.g6(a))},gi:function(a){return this.g1(a).i1()},gh:function(a){return this.g1(a).i2()},ga:function(a){var b=this.g1(a);return new Sd(b.i1(),b.i2())},gj:function(a){return this.g1(a).i3()},g9:function(a){return this.g1(a).i4()},gm:function(a){return new Td(this.gj(a),this.g9(a))},s1:function(a,b){this.s2(a,b.x,b.y)},s2:function(a,b,c){var d=this.g1(a);d.i5(b-d.i3()/2,c-d.i4()/2)},s7:function(a,b,c){this.g1(a).i6(b,c)},s8:function(a,b){this.s7(a,b.width,b.height)},s3:function(a,b,c){this.g1(a).i5(b,c)},s4:function(a,b){this.s3(a,b.x,b.y)},gp:function(a){for(var b=this.g2(a),c=new md,d=0;d<b.i1();d++)c.add(b.i2(d));return new Xd(c)},gf:function(a){for(var b=this.g2(a),c=new qe,d=0;d<b.i1();d++)c.aa(b.i2(d));return c},gc:function(a){var b=new md;b.add(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.add(c.i6());return b.add(this.gl(a)),new Xd(b)},gd:function(a){var b=new qe;b.aa(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.aa(c.i6());return b.aa(this.gl(a)),b},m1:function(a,b){var c=this.g2(a);c.i5();var d=b.ah(),e=d.i6();this.gx(a,e);var f=b.as();for(d.i2();d.i6()!==f;d.i2()){var g=d.i6();c.i4(g.x,g.y)}this.gy(a,f)},s5:function(a,b){var c=this.g2(a);c.i5();for(var d=b.d();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},s6:function(a,b){var c=this.g2(a);c.i5();for(var d=b.ah();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},m2:function(a,b,c){this.gx(a,b),this.gy(a,c)},gn:function(a){return this.g2(a).i6()},gk:function(a){return this.g2(a).i7()},gt:function(a,b){this.g2(a).i8(b)},gz:function(a,b){this.g2(a).i9(b)},gs:function(a){var b=this.g2(a).i6();if(null==b)return this.g4(a.a2());var c=new Sd(this.g5(a.a2())+b.x,this.g6(a.a2())+b.y);return c},gl:function(a){var b=this.g2(a).i7();if(null==b)return this.g4(a.a3());var c=new Sd(this.g5(a.a3())+b.x,this.g6(a.a3())+b.y);return c},gx:function(a,b){var c=new Sd(b.x-this.g5(a.a2()),b.y-this.g6(a.a2()));this.g2(a).i8(c)},gy:function(a,b){var c=new Sd(b.x-this.g5(a.a3()),b.y-this.g6(a.a3()));this.g2(a).i9(c)},g8:function(){for(var a=new re,b=this.xf();b.i1();b.i2())a.aa(b.i8());return a},g3:function(){for(var a,b,c=a=Number.MAX_VALUE,d=b=Number.MIN_VALUE,e=this.x9();e.i1();e.i2()){var f=this.ga(e.i9()),g=this.gm(e.i9());c=Math.min(f.x,c),a=Math.min(f.y,a),d=Math.max(f.x+g.width,d),b=Math.max(f.y+g.height,b)}for(var h=this.xf();h.i1();h.i2())for(var i=this.gp(h.i8()).c();i.i1();i.i2()){var j=i.i6();c=Math.min(j.x,c),a=Math.min(j.y,a),d=Math.max(j.x,d),b=Math.max(j.y,b)}return{x:Math.floor(c),y:Math.floor(a),width:Math.floor(d-c),height:Math.floor(b-a)}}});var kf=function(){kf.superClass.constructor.call(this),this.a(new be,new _d)};Hb.ext(kf,jf,{a:function(a,b){this._a3=a,this._a4=b},xo:function(a,b){return this.l2(a,b,this._a4.a6())},l2:function(a,b,c){return this.l1(a,null,b,null,0,0,c)},xn:function(a,b,c,d,e,f){return this.l1(a,b,c,d,e,f,this._a4.a6())},l1:function(a,b,c,d,e,f,g){var h=new ye(this,a,b,c,d,e,f);return h._l=g,h},xm:function(){var a=new Ee(this);return a._r=this._a3.m3(),a},g3:function(){for(var a={x:0,y:0,width:-1,height:-1},b=this.x9();b.i1();b.i2())b.i9()._r.m1(a);return a},g1:function(a){return a._r},g2:function(a){return a._l},g5:function(a){return a._r.m4()},g6:function(a){return a._r.m5()},gi:function(a){return a._r.i1()},gh:function(a){return a._r.i2()},gj:function(a){return a._r.i3()},g9:function(a){return a._r.i4()},s2:function(a,b,c){a._r.m6(b,c)},s7:function(a,b,c){a._r.i6(b,c)},s3:function(a,b,c){a._r.i5(b,c)}});var lf=function(){lf.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};Hb.ext(lf,jf,{g1:function(a){var b=this._ap.i1(a);return null==b&&(b=new Be,this._ap.z1(a,b)),b},g2:function(a){var b=this._as.i1(a);return null==b&&(b=new Ae,this._as.i8(a,b)),b}});var mf=function(a){mf.superClass.constructor.call(this),this._ay=a,this._a0=this.xk(),this._au=this.xl()};Hb.ext(mf,lf,{c2:function(a){var b=this._a0.i1(a);return b},a2:function(a,b){this._a0.z1(a,b)},h:function(){null==this._az&&(this._az=this.xk());for(var a=Hf.a(this._ay.x0()+1),b=1,c=this.x9();c.i1();){for(var d=this.c2(c.i9()),e=d.x1();e.i1();e.i2()){var f=e.i9();a[f.al()]=b}for(var g=new re,h=d.x1();h.i1();h.i2())for(var i=h.i9(),j=a[i.al()],k=i.ap();k.i1();k.i2()){var l=k.i8(),m=l.a3(),n=a[m.al()];n===j&&g.ac(l)}this._az.z1(c.i9(),g),c.i2(),b++}},d1:function(a){return this._az.i1(a)},b:function(a){return this._au.i1(a)},a3:function(a,b){this._au.i8(a,b)},a1:function(){var a=this._ay.xk(),b=Ne.a4(Hf.a(this._ay.xh())),c=ce.a1(this._ay,b,a),d=ce.a5(this._ay,b,c);this.d2(a,d),this._ay.xi(a)},c1:function(a){for(var b=null,c=-1,d=0,e=a.length;e>d;d++){var f=a[d];f.ay()>c&&(b=f,c=f.ay())}return b},d2:function(a,b){for(var c=this._ay.xl(),d=this._ay.xk(),e=b.length,f=0;e>f;f++)for(var g=b[f],h=g.c1();h.i1();h.i2())c.i8(h.i8(),g);var i=this.c1(b);this.a4(i,a,c,new md,d);var j={};e=b.length;for(var k=0;e>k;k++){var l=b[k];if(l.ay()>1){var m=this.xm();j[l._id]=m}}for(var n=this._ay.x9();n.i1();n.i2()){var o=n.i9();if(a.i4(o)&&null==d.i1(o)){var p=this.xm();j[o._id]=p;var q=new Je;q.aa(o),this.a2(p,q)}}var r=Hf.d(2);e=b.length;for(var s=0;e>s;s++){
var t=b[s];if(1===t.ay()){var u=t.c2();r[0]=u.a2(),r[1]=u.a3();for(var v=0;2>v;v++){var w=r[v];if(1===w.ad()){var x=this.xm();j[w._id]=x;var y=new Je;y.aa(w),this.a2(x,y)}}}}for(var z=this._ay.x9();z.i1();z.i2()){var A=z.i9();if(null!=d.i1(A))for(var B=d.i1(A),C=j[B._id],D=A.af();D.i1();D.i2()){var E=D.i8();if(c.i1(E)!==B){var F=j[c.i1(E)._id];if(null==F){var G=E.a1(A),H=d.i1(G);F=null!=H?j[H._id]:j[G._id]}var I=C.aj(F),J=null;null==I?(I=this.xo(C,F),J=new re):J=this.b(I),J.aa(E),this.a3(I,J)}}else if(a.i4(A))for(var K=j[A._id],L=A.af();L.i1();L.i2()){var M=L.i8(),N=M.a1(A),O=j[N._id];if(null!=O){var P=K.aj(O);if(null==P){var Q=this.xo(K,O),R=new re;R.aa(M),this.a3(Q,R)}}}}if(2===this._ay.x0()&&1===this._ay.xg()){var S=this._ay.xf().i8(),T=j[S.a2()._id],U=j[S.a3()._id];if(null!=U&&null!=T&&null==U.aj(T)){var V=this.xo(T,U),W=new re;W.aa(S),this.a3(V,W)}}var X=Hf.a(this._ay.x0()),Y=1;e=b.length;for(var Z=0;e>Z;Z++){var $=b[Z],_=j[$._id];if(null!=_){var aa=this.c2(_);null==aa&&(aa=new Je,this.a2(_,aa));for(var ba=$.c1();ba.i1();ba.i2()){var ca=ba.i8(),da=ca.a2();X[da.al()]===Y||a.i4(da)&&d.i1(da)!==$||(X[da.al()]=Y,aa.aa(da)),da=ca.a3(),X[da.al()]===Y||a.i4(da)&&d.i1(da)!==$||(X[da.al()]=Y,aa.aa(da))}}}this._ay.xj(c),this._ay.xi(d)},a4:function(a,b,c,d,e){if(!d.contains(a)){d.add(a);for(var f=[],g=a.c1();g.i1();g.i2()){var h=g.i8();f[0]=h.a2(),f[1]=h.a3();for(var i=0;2>i;i++){var j=f[i];if(b.i4(j)&&null==e.i1(j)){a.ay()>1&&e.z1(j,a);for(var k=j.af();k.i1();k.i2()){var l=c.i1(k.i8());this.a4(l,b,c,d,e)}}}}}}});var nf=function(a,b,c,d,e){this._a={},nf.superClass.constructor.call(this);var f,g,h=new md;for(f=0,g=b.size();g>f;f++){var i=b.get(f);if(i instanceof Gb.Link)h.add(i);else{var j=d&&null==e&&i instanceof Nd;j&&i.setExpanded(!0);var k=a.getDimension(i);if(j&&i.setExpanded(!1),null==k)continue;var l=this.xm(),m=a._repulsion;"rightleft"===c||"leftright"===c?this.s7(l,k.height*m,k.width*m):this.s7(l,k.width*m,k.height*m),l.node=i,this._a[i.getId()]=l}}for(f=0,g=h.size();g>f;f++){var n=h.get(f),o=n.getFromAgent(),p=n.getToAgent(),q=this._a[o.getId()],r=this._a[p.getId()];null!=q&&null!=r&&q!==r&&this.xo(q,r)}};Hb.ext(nf,kf,{});var of={};of._D=new Xd,of._E=new Sd(0,0),of.b=function(a){if(a.i1()>0){for(var b=new md,c=a.i1()-1;c>=0;c--)b.add(a.i2(c));a.i5();for(var d=0,e=b.size();e>d;d++){var f=b.get(d);a.i4(f.x,f.y)}}var g=a.i6();a.i8(a.i7()),a.i9(g)},of.c=function(a){of.d(a,!0)},of.d=function(a,b){if(b)for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,of._E),a.gz(d,of._E),a.s5(d,of._D)}else for(var e=a.xf();e.i1();e.i2())a.s5(e.i8(),of._D)},of.e=function(a){for(var b=new Sd(0,0),c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,b),a.gz(d,b)}},of.f=function(a,b,c,d){for(var e=a.gc(b).b(),f=Hf.d(e),g=0,h=a.gc(b).c();h.i1();h.i2()){var i=h.i6();(0>=g||!i.equals(f[g-1]))&&(f[g]=new Sd(i.x,i.y),g++)}if(e=g,!(2>e)){var j=new md,k=new Ud(f[1].x-f[0].x,f[1].y-f[0].y),l=of.i(k);l.x*=d,l.y*=d;for(var m=of.h(f[0],l),n=of.h(f[1],l),o=new Wd(m,n),p=1;e-1>p;p++){var q=o,r=of.i(new Ud(f[p+1].x-f[p].x,f[p+1].y-f[p].y));r.x*=d,r.y*=d;var s=of.h(f[p],r),t=of.h(f[p+1],r);o=new Wd(s,t);var u=Wd.a6(q,o);null!=u&&j.add(new Sd(u.x,u.y))}var v=new Ud(f[e-1].x-f[e-2].x,f[e-1].y-f[e-2].y);v=of.i(v),v.x*=d,v.y*=d;var w=of.h(f[e-1],v),x=new Xd(j);b.a2()===c.a2()?(a.s5(c,x),a.m2(c,m,w)):(a.s5(c,x.a()),a.m2(c,w,m))}},of.g=function(a,b,c,d){for(var e=d,f=c.c1();f.i1();f.i2()){var g=f.i8();of.f(a,b,g,e),0>e&&(e-=d),e=-e}},of.a=function(a,b,c){return of.j(a,b,c,1)},of.l=function(a,b,c){if(null==a||a.length<1)return null!=b&&(b.x=0,b.y=0,b.width=0,b.height=0),{width:0,height:0};for(var d=0,e=0,f=0;f<a.length;f++){var g=a[f];d=Math.max(d,g.width),e=Math.max(e,g.height)}var h,i,j=d*e*a.length,k=Math.sqrt(j/c),l=j/k,m=Math.floor(l/d),n=Math.ceil(l/d),o=Math.ceil(a.length/m),p=Math.ceil(a.length/n);n*p>m*o?(h=m,i=o):(h=n,i=p);var q,r=0,s=0,t=0,u=0;if(d>e)for(var v=0;v<a.length;v++)q=a[v],q.x=s*d,q.y=r*e,t=Math.max(t,q.x+q.width),u=Math.max(u,q.y+q.height),++s>=h&&(r++,s=0);else for(var w=0;w<a.length;w++)q=a[w],q.x=s*d,q.y=r*e,t=Math.max(t,q.x+q.width),u=Math.max(u,q.y+q.height),++r>=i&&(s++,r=0);return null!=b&&(b.x=0,b.y=0,b.width=t,b.height=u),{width:i,height:h}},of.j=function(a,b,c,d){if(null==a||a.length<1)return null!=b&&(b.x=0,b.y=0,b.width=0,b.height=0),0;for(var e,f,g=e=a[0].width,h=f=a[0].height,i=a.length,j=1;i>j;j++){var k=a[j].width;g=Math.min(g,k),e=Math.max(e,k);var l=a[j].height;h=Math.min(h,l),f=Math.max(f,l)}if(h/f>.95&&g/e>.95)return of.l(a,b,c).width;for(var m=new qe,n=0,o=0;i>o;o++){var p=a[o];m.aa(a[o]),n=Math.floor(n+p.width*p.height)}m.a1(function(a,b){var c=Math.floor(b.height)-Math.floor(a.height);return 0===c?Math.floor(b.width)-Math.floor(a.width):c});var q=0,r=0,s=Math.floor(c*Math.sqrt(n/c)),t=s,u=0,v=new qe;do{var w=new qe;v.aa(w);for(var x,y,z=x=y=0,A=m.ah();A.i1();A.i2()){var B=A.i6();z+B.width>t&&w.ay()>0?(y=Math.max(y,z),w=new qe,w.aa(B),v.aa(w),z=Math.floor(B.width)):(w.aa(B),z=Math.floor(z+B.width)),1===w.ay()&&(x=Math.floor(x+w.am().height))}y=Math.max(y,z),c*x>y&&u!==y&&(v.af(),t=Math.floor(1.1*t),u=y)}while(v.ar());for(var C=0,D=v.ah();D.i1();D.i2()){for(var E=0,F=D.i6(),G=F.ah();G.i1();G.i2()){var H=G.i6();H.x=E,H.y=C,E+=H.width}q=Math.max(q,E),C+=of.k(F),r=Math.max(r,C)}return null!=b&&(b.x=0,b.y=0,b.width=q,b.height=r),v.ay()},of.k=function(a){for(var b=0,c=a.ah();c.i1();c.i2())b=Math.max(c.i6().height,b);return b},of.h=function(a,b){return new Sd(a.x+b.x,a.y+b.y)},of.i=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);return new Ud(-a.y/b,a.x/b)};var pf=function(a){this._a=a,this._b=!1};Hb.ext(pf,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return 1===this._a},d:function(){return 2===this._a},e:function(){return 4===this._a},f:function(){return 8===this._a},g:function(){return 0===this._a}}),pf.h=function(a,b){var c=a.xc("A");return null==c?null:c.i1(b)},pf.i=function(a,b){var c=a.xc("B");return null==c?null:c.i1(b)},pf.j=function(a){switch(a){case 1:return pf.k;case 2:return pf.l}return null},pf.k=new pf(1),pf.l=new pf(2);var qf=function(a,b,c,d,e){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=a,this._a=1e-4,this._r=b,this._p=1,this._e=(e.gj(a)+e.g9(a))/4;var f=.45*c*Math.sqrt(d);this._k=ff.l(-f,f),this._h=ff.l(-f,f),this._g=ff.l(-f,f)};Hb.ext(qf,Object,{});var rf=function(){this._a=0,this._c=0,this._b=0};Hb.ext(rf,Object,{});var sf=function(){sf.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};Hb.ext(sf,Qe,{i4:function(a){return!0},i3:function(a){if(null!=a&&(this._d5=a,this.s(a))){var b=new rf,c=0,d=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);d=Math.max(d,1e4);var e=this._ea*this._ea*this._dz.length,f=this._df;try{for(;this._dj>e&&d>c;c++){var g=this.b(2147483647&c);0===f--&&(this._dy.b()>this._eb&&(c=d),f=this._df),this.h(g,b),this.d(g,b),this.i(g,b),this._d8?(this.g(g,b),this.j(g,b)):(this.f(g,b),this.c(g,b));var h=Math.sqrt(b._a*b._a+b._c*b._c+b._b*b._b);this.ac(g,b,h),this.aa(g,b,h)}}catch(i){}finally{this.r()}}},s:function(a){if(null==a||a.xa()<1)return!1;this._d5=a,this._dp=1,this._dy=new ef,this._dt=a.x0(),this._d2=Hf.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(.05*this._dl),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new rf,this._dq=Math.max(20*this._dl,10);var b=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),c=this._dt;of.c(a),this._dz=Hf.d(c);for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=new qf(e,b,this._dl,this._dt,a);this._dz[--c]=f,this._dj+=f._r,this._dh+=f._r*f._r,this._du._a+=f._k,this._du._c+=f._h,this._du._b+=f._g,this._d2[e.al()]=f}return this._d8=!1,this._dz.length>0},b:function(a){var b=this._dz.length,c=b-a%b-1,d=ff.k(c+1),e=this._dz[d];return this._dz[d]=this._dz[c],this._dz[c]=e,e},f:function(a,b){for(var c,d,e=c=d=0,f=a._b.ae();null!=f;f=f.a7()){var g,h=this._d2[f.a2().al()],i=h._k-a._k,j=h._h-a._h,k=h._g-a._g,l=i*i+j*j+k*k,m=Math.sqrt(l),n=m-(h._e+a._e);0>=n||(g=n*n*this._d3/m,e+=i*g,c+=j*g,d+=k*g)}for(var o=a._b.ag();null!=o;o=o.a8()){var p,q=this._d2[o.a3().al()],r=q._k-a._k,s=q._h-a._h,t=q._g-a._g,u=r*r+s*s+t*t,v=Math.sqrt(u),w=v-(q._e+a._e);0>=w||(p=w*w*this._d3/v,e+=r*p,c+=s*p,d+=t*p)}b._a+=e,b._c+=c,b._b+=d},g:function(a,b){var c,d,e=c=d=0;this._dp++,a._f=this._dp;for(var f=a._b.ae();null!=f;f=f.a7()){var g=this._d2[f.a2().al()];g._f=this._dp;var h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l=Math.sqrt(k);if(0!==l){var m=Math.max(1e-6,l-(a._e+g._e)),n=-this._ef[f.a5()]/(m*m);n+=m*m*this._d1[f.a5()],n/=l,e+=h*n,c+=i*n,d+=j*n}}for(var o=a._b.ag();null!=o;o=o.a8()){var p=this._d2[o.a3().al()];p._f=this._dp;var q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u=Math.sqrt(t);if(0!==u){var v=Math.max(1e-6,u-(a._e+p._e)),w=-this._ef[o.a5()]/(v*v);w+=v*v*this._d1[o.a5()],w/=u,e+=q*w,c+=r*w,d+=s*w}}b._a+=e,b._c+=c,b._b+=d},j:function(a,b){for(var c,d,e=c=d=0,f=this._dt-1;f>=0;f--){var g=this._d2[f];if(g._f!==a._f){var h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(0!==k){var l=Math.sqrt(k),m=Math.max(1e-6,l-(a._e+g._e)),n=this._dr/(m*m*l);e+=h*n,c+=i*n,d+=j*n}}}b._a+=e,b._c+=c,b._b+=d},c:function(a,b){for(var c,d,e=c=d=0,f=this._dt-1;f>=0;f--){var g=this._d2[f],h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(0!==k){var l,m=Math.sqrt(k),n=m-(a._e+g._e);l=0>=n?this._dr/(1e-8*m):this._dr/(n*n*m),e+=h*l,c+=i*l,d+=j*l}}b._a+=e,b._c+=c,b._b+=d},i:function(a,b){var c=this._du._b/this._dt-a._g;b._b+=c*this._dl*this._dt/this._dh},d:function(a,b){if(0!==this._de){var c=this._du._a/this._dt-a._k,d=this._du._c/this._dt-a._h,e=this._du._b/this._dt-a._g;b._a+=c*this._de,b._c+=d*this._de,b._b+=e*this._de}},h:function(a,b){var c=.05*(a._r+2);c>0&&(b._a=ff.l(-c,c),b._c=ff.l(-c,c),b._b=ff.l(-c,c))},ac:function(a,b,c){if(0!==c&&0!==a._a){var d=b._a*a._o+b._c*a._l+b._b*a._i,e=d/(c*a._a);this._dh-=a._r*a._r,this._dj-=a._r,a._r+=a._p*e>0?.45*e:.15*e,a._r>this._dq?a._r=this._dq:a._r<.1&&(a._r=.1),this._dj+=a._r,this._dh+=a._r*a._r,a._p=e}},aa:function(a,b,c){if(c>0){var d=a._r/c,e=b._a*d,f=b._c*d,g=b._b*d;a._k+=e,a._h+=f,a._g+=g,this._du._a+=e,this._du._c+=f,this._du._b+=g,a._a=c,a._o=b._a,a._l=b._c,a._i=b._b}},r:function(){for(var a=this._d2.length-1;a>=0;a--){var b=this._d2[a];this._d5.s2(b._b,b._k,b._h)}}});var tf=function(a,b,c,d){this._e=a,this._f=b,this._a=c,this._b=d,this._c={}};Hb.ext(tf,Object,{resetGroup:function(){if(this._a&&null==this._b)for(var a in this._c){var b=this._c[a];b.group.setExpanded(this._e.isExpandGroup()?!0:b.b)}},process:function(){for(var a=new md,b=0,c=this._f.size();c>b;b++){var d=this._f.get(b);if(d instanceof Gb.Link)d.isLooped()||a.add(d);else{if(null==this._b&&d.getParent()instanceof Nd)continue;(null==this._b||null!=this._b&&this._b!==d)&&a.add(d),null==this._b&&d instanceof Nd&&this.layoutGroup(d)}}return a},layoutGroup:function(a){if(this._a&&null==this._c[a.getId()]&&null==this._b){this._c[a.getId()]={group:a,b:a.isExpanded()};var b=this._e.getGroupLayoutType(a);if(b){a.setExpanded(!0);for(var c,d=new md,e=a.getChildren(),f=0,g=e.size();g>f;f++)if(c=e.get(f),c instanceof Nd&&(this.layoutGroup(c),c.setExpanded(!1)),c instanceof Gb.Link||d.contains(c)||d.add(c),c instanceof Ld){var h=c.getLinks();if(null!=h)for(var i=0,j=h.size();j>i;i++){var k=h.get(i);d.contains(k)||d.add(k)}}var l=new nf(this._e,d,b,this._a,this._b);try{var m=null;if("round"===b?m=new df:"symmetry"===b?m=new sf:"hierarchic"===b?m=new Cf:("topbottom"===b||"bottomtop"===b||"rightleft"===b||"leftright"===b)&&(m=new Re),null!=m){m.i2(l);var n=tf.createMatrix(b),o={},p={};for(var q in l._a){var r=l._a[q],s=r.node,t=l.g4(r);if(o[q]=s.getCenterLocation(),null!=n){var u=n.transform(t);s.setCenterLocation(u.x,u.y)}else s.setCenterLocation(t.x,t.y);p[q]=s.getCenterLocation()}}}catch(v){}for(e=a.getChildren(),f=0,g=e.size();g>f;f++)c=e.get(f),c instanceof Nd&&c.setExpanded(!0)}}}}),tf.createMatrix=function(a){return"rightleft"===a?Rb.createMatrix(Math.PI/2,0,0):"leftright"===a?Rb.createMatrix(-Math.PI/2,0,0):"bottomtop"===a?Rb.createMatrix(Math.PI,0,0):null};var uf=function(){};Hb.ext(uf,Object,{i1:function(a,b,c){var d=this.a1(a,b);return this.a2(a,b,c),d},a1:function(a,b){var c=uf.i4(a);c.ax();for(var d=0,e=c.x1();e.i1();e.i2())b.i7(e.i9(),-1);for(var f=c.x1();f.i1();f.i2()){for(var g=f.i9(),h=-1,i=g.aq();i.i1();i.i2())h=Math.max(h,b.i2(i.i9()));b.i7(g,h+1),d=Math.max(d,h+1)}return d+1},a2:function(a,b,c){c.az(uf.i3(a,b))}}),uf.i3=function(a,b){for(var c=new re,d=a.xf();d.i1();d.i2()){var e=d.i8();b.i2(e.a2())>b.i2(e.a3())&&(a.x3(e),c.ac(e))}return c},uf.i4=function(a){var b=Hf.a(a.xa());return(new ie).a1(a,b),uf.i2(a,b)},uf.i2=function(a,b){for(var c=Hf.d(a.x0()),d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[b[f]]=e}return new Je(c)};var vf=function(){vf.superClass.constructor.call(this),this.c0()};Hb.ext(vf,re,{c0:function(){this._bc=1,this._bd=0}});var wf=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};Hb.ext(wf,Object,{i4:function(a){this._m3=a},i5:function(a){this._m4=a},i3:function(a){this._m1=a},i6:function(a){this._m2=a},i2:function(a){this._m5=a},t1:function(){return this._m2},a1:function(a,b){for(var c=Hf.d(b.length),d=0;d<b.length;d++)c[d]=b[d].x1();this.a2(a,c)},a2:function(a,b){for(var c=Hf.a(b.length),d=0,e=0;e<b.length;e++){var f=0,g=b[e];for(g.i4();g.i1();g.i2())f=Math.max(f,a.g9(g.i9()));for(c[e]=f,g.i4();g.i1();g.i2()){var h=(c[e]-a.g9(g.i9()))/2;a.s4(g.i9(),new Sd(a.gi(g.i9()),d+h))}var i=this.t1();d+=c[e]+i,g.i4()}},i1:function(a,b,c){this._m6=a,this.t2(b,c)}});var xf=function(a,b){xf.superClass.constructor.call(this)};Hb.ext(xf,wf,{t2:function(a,b){var c=this._m6;this._a=c.xc("D"),this._h=c.xc("C"),this.a1(c,a),this.tg(c,a),this.tf(a,Ne.a5(this._e),this._m5,this._l),this.tb(c,this._f[0]),this.ta(a),this.th(c,this._f[0],a),this.b(a),this.tb(c,this._f[1]),this.ta(a),this.th(c,this._f[1],a),this.b(a),this.a11(this._f[1]),this.a12(a),this.tb(c,this._f[2]),this.ta(a),this.th(c,this._f[2],a),this.b(a),this.tb(c,this._f[3]),this.ta(a),this.th(c,this._f[3],a),this.b(a),this.a11(this._f[3]),this.a12(a),this.tc(c),this.tj()},a11:function(a){for(var b=0;b<a.length;b++)a[b]=-a[b]},b:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.ax()}for(var d=0;d<a.length;d++)for(var e=0,f=null,g=a[d].x1();g.i1();g.i2()){var h=g.i9(),i=h.al();this._l[i]=e++,this._b[i]=f,this._k[i]=null,null!=f&&(this._k[f.al()]=h),f=h}var j=this._a;this._a=this._h,this._h=j;for(var k=this._m6.xf();k.i1();k.i2()){var l=k.i8(),m=this._m6.gn(l);this._m6.gt(l,new Sd(-m.x,m.y));var n=this._m6.gk(l);this._m6.gz(l,new Sd(-n.x,n.y))}var o=this._l,p=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:o[a.a2().al()]-o[b.a2().al()]},q=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:o[a.a3().al()]-o[b.a3().al()]};this._m6.x2(p,q)},a12:function(a){for(var b=this._m6.xf();b.i1();b.i2()){var c=b.i8();this._m6.x3(c);var d=this._m6.gn(c),e=this._m6.gk(c);this._m6.gz(c,d),this._m6.gt(c,e)}for(var f=new qe,g=0;g<a.length;g++)f.ae(a[g]);for(var h=0;h<a.length;h++)a[h]=f.au();var i=this._l,j=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:i[a.a2().al()]-i[b.a2().al()]},k=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:i[a.a3().al()]-i[b.a3().al()]};this._m6.x2(j,k)},tg:function(a,b){var c=a.x0(),d=a.xg();this._l=Hf.a(c),this._b=Hf.d(c),this._k=Hf.d(c),this._m=Hf.d(c),this._i=Hf.d(c),this._o=Hf.d(c),this._f=Hf.e(4,c),this._c=Hf.a(c),this._g=Hf.a(c),this._j=Hf.a(c),this._d=Hf.b(c),this._e=Hf.b(d);for(var e=0;e<b.length;e++)for(var f=0,g=null,h=b[e].x1();h.i1();h.i2()){var i=h.i9(),j=i.al();this._l[j]=f++,this._b[j]=g,this._k[j]=null,null!=g&&(this._k[g.al()]=i),g=i}var k=this._l,l=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:k[a.a2().al()]-k[b.a2().al()]},m=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:k[a.a3().al()]-k[b.a3().al()]};a.x2(l,m)},tb:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=d.al();this._m[e]=d,this._i[e]=d,b[e]=Number.MAX_VALUE,this._o[e]=d,this._c[e]=Number.MAX_VALUE,this._d[e]=!1,this._j[e]=this._g[e]=0}},ta:function(a){for(var b=1;b<a.length;b++)for(var c=-1,d=a[b]._b;null!=d;d=d.a()){var e=d.d(),f=e.al(),g=e.ak();if(0!==g){var h,i=Math.floor((g+1)/2),j=Math.ceil((g+1)/2),k=1;for(h=e.ae();i>k;h=h.a7())k++;for(var l=!1;j>=k&&!l;k++){var m=this._m6.g2(h),n=h.a2(),o=n.al();this._i[f]===e&&!this._e[h.a5()]&&c<this._l[o]&&(c=this._l[o],this._i[o]=e,this._m[f]=this._m[o],this._i[f]=this._m[f],l=!0,this._j[o]=m.i6().x,this._g[f]=m.i7().x),h=h.a7()}}}},th:function(a,b,c){for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();this._m[f]===e&&this.td(a,e,b)}for(var g=0;g<c.length;g++){var h=c[g].x1();if(h.i1()){var i=c[g].x1().i9(),j=i.al();this._o[this._m[j].al()]===i&&this.tk(a,i,b)}}for(var k=a.x9();k.i1();k.i2()){var l=k.i9(),m=l.al(),n=this._c[this._o[this._m[m].al()].al()];n<Number.MAX_VALUE&&(b[m]+=n)}},td:function(a,b,c){var d=b.al();if(c[d]===Number.MAX_VALUE){c[d]=0;var e=b,f=0;do{var g=e.al();if(g!==d&&(f-=this._g[g]),this._l[g]>0){var h=this._b[g],i=this._m[this._b[g].al()],j=i.al();this.td(a,i,c),this._o[d]===b&&(this._o[d]=this._o[j]),this._o[d]===this._o[j]&&(c[d]=Math.max(c[d],c[h.al()]+this.ti(a,h,e)-f))}f+=this._j[g],e=this._i[g]}while(e!==b);f=0,e=b;do{var k=e.al();k!==d&&(f-=this._g[k]),c[k]=c[d]+f,f+=this._j[k],e=this._i[k]}while(e!==b)}},tk:function(a,b,c){var d=b.al();if(!this._d[d]){this._d[d]=!0;var e=b;do{var f=e.al(),g=this._k[f];if(null!=g){var h=g.al(),i=this._o[this._m[h].al()];if(i!==this._o[d]){var j=c[h]-c[d]-this.ti(a,e,g);this._c[i.al()]!==Number.MAX_VALUE&&(j+=this._c[i.al()]),this._c[this._o[d].al()]=Math.min(this._c[this._o[d].al()],j)}else this.tk(a,this._m[h],c)}e=this._i[f]}while(e!==b)}},tc:function(a){for(var b=Hf.a(4),c=Hf.a(4),d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[0]+=this._f[0][f],c[1]+=this._f[1][f],c[2]+=this._f[2][f],c[3]+=this._f[3][f]}c[0]/=a.xa(),c[1]/=a.xa(),c[2]/=a.xa(),c[3]/=a.xa();for(var g=a.x9();g.i1();g.i2()){var h=g.i9(),i=h.al(),j=a.g4(h);b[0]=this._f[0][i]-c[0],b[1]=this._f[1][i]-c[1],b[2]=this._f[2][i]-c[2],b[3]=this._f[3][i]-c[3],b.sort(Hf.n);var k=(b[1]+b[2])/2;a.s1(h,new Sd(k,j.y))}},ti:function(a,b,c){var d,e=a.gj(b),f=a.gj(c);return d=e>1&&f>1?this._m1+(e+f)/2:this._m3+(e+f)/2,this._l[b.al()]<this._l[c.al()]?(null!=this._a&&(d+=this._a.i3(c)),null!=this._h&&(d+=this._h.i3(b))):(null!=this._a&&(d+=this._a.i3(b)),null!=this._h&&(d+=this._h.i3(c))),d},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(a,b,c,d){for(var e=a.length,f=2;e-1>f;f++)for(var g=-1,h=0,i=0,j=a[f].x1(),k=a[f].x1();k.i1();k.i2()){var l=k.i9(),m=null,n=!1;if(1===l.ak()&&(m=l.ae().a2(),null!=c.i1(m)&&null!=c.i1(l)&&(n=!0)),i===a[f].ay()-1||n){for(var o=n?d[m.al()]:a[f-1].ay();i>=h;h++){for(var p=j.i9(),q=p.am();q.i1();q.i2()){var r=q.i8(),s=d[r.a2().al()];(g>s||s>o)&&b.i7(q.i8(),!0)}j.i2()}g=o}i++}}});var yf=function(a,b){this._b=20,this._a=b,this._d=a,this._f={}};Hb.ext(yf,Object,{a3:function(a){this._b=a},a4:function(a,b,c,d,e){if(this.a2(a)){var f=this.b2(a);f._o=b,f._m=e,f._n=d,f._f=c}},b2:function(a){var b=this._f[a._id];return null==b&&(b=new zf,this._f[a._id]=b),b},a2:function(a){return null!=this._f[a._id]},c:function(){for(var a=Ne.a1(Hf.a(this._d.xa())),b=Ne.a1(Hf.a(this._d.xa())),c=this._d.x9();c.i1();c.i2()){var d=c.i9();if(this.a2(d)){var e=this.b2(d);a.i6(d,this._b*(e.c()-1)),b.i6(d,this._b*(e.b()-1))}}this._d.x1("D",a),this._d.x1("C",b)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var a=this._d.x9();a.i1();a.i2()){var b=a.i9();if(this.a2(b)){var c=this._d.gi(b),d=this._d.gh(b),e=this._d.gj(b),f=this._d.g9(b),g=this.b2(b),h=g._q.ay()+g._b.ay()+g._f,i=g._d.ay()+g._g.ay()+g._o,j=g._i.ay()+g._l.ay()+g._n,k=g._h.ay()+g._k.ay()+g._m,l=this._a.a7(e,h),m=this._a.a7(e,i),n=this._a.a7(f,k),o=this._a.a7(f,j);g.a2(this._a.a8(e,h,l),this._a.a8(e,i,m),this._a.a8(f,k,n),this._a.a8(f,j,o));for(var p=g._j.c1();p.i1();p.i2()){var q=p.i8(),r=this.a1(q),s=this.b1(q),t=new qe;r.b()===s.b()?(r.c()?(t.aa(new Sd(c+g._g._bd*m+g._c,d)),t.aa(new Sd(c+g._g._bd*m+g._c,d-this._b)),g._g._bd++,t.aa(new Sd(c+g._g._bd*m+g._c,d-this._b)),t.aa(new Sd(c+g._g._bd*m+g._c,d)),g._g._bd++,g._g._bc=Math.max(g._g._bc,2)):r.d()?(t.aa(new Sd(c+g._b._bd*l+g._p,d+f)),t.aa(new Sd(c+g._b._bd*l+g._p,d+f+this._b)),g._b._bd++,t.aa(new Sd(c+g._b._bd*l+g._p,d+f+this._b)),t.aa(new Sd(c+g._b._bd*l+g._p,d+f)),g._b._bd++,g._b._bc=Math.max(g._b._bc,2)):r.f()?(t.aa(new Sd(c,d+g._i._bd*o+g._a)),t.aa(new Sd(c-this._b,d+g._i._bd*o+g._a)),g._i._bd++,t.aa(new Sd(c-this._b,d+g._i._bd*o+g._a)),t.aa(new Sd(c,d+g._i._bd*o+g._a)),g._i._bd++,g._i._bc=Math.max(g._i._bc,2)):r.e()&&(t.aa(new Sd(c+e,d+g._h._bd*n+g._e)),t.aa(new Sd(c+e+this._b,d+g._h._bd*n+g._e)),g._h._bd++,t.aa(new Sd(c+e+this._b,d+g._h._bd*n+g._e)),t.aa(new Sd(c+e,d+g._h._bd*n+g._e)),g._h._bd++,g._h._bc=Math.max(g._h._bc,2)),this._d.m1(q,t)):r.c()||s.c()?r.e()||s.e()?(t.aa(new Sd(c+e-g._d._bd*m-g._c,d)),t.aa(new Sd(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g._h._bc,d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g._h._bc,d+g._h._bd*n+g._e)),t.aa(new Sd(c+e,d+g._h._bd*n+g._e)),g._d._bd++,g._d._bc++,g._h._bd++,g._h._bc++,s.c()&&t.ax(),this._d.m1(q,t)):r.f()||s.f()?(t.aa(new Sd(c+g._g._bd*m+g._c,d)),t.aa(new Sd(c+g._g._bd*m+g._c,d-this._b*g._g._bc)),t.aa(new Sd(c-this._b*g._i._bc,d-this._b*g._g._bc)),t.aa(new Sd(c-this._b*g._i._bc,d+g._i._bd*o+g._a)),t.aa(new Sd(c,d+g._i._bd*o+g._a)),g._g._bd++,g._g._bc++,g._i._bd++,g._i._bc++,s.c()&&t.ax(),this._d.m1(q,t)):(r.d()||s.d())&&(t.aa(new Sd(c+e-g._d._bd*m-g._c,d)),t.aa(new Sd(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g.b(),d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g.b(),d+f+this._b*g._q._bc)),t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f)),g._d._bd++,g._d._bc++,g._k._bc++,g._h._bc++,g._q._bc++,g._q._bd++,s.c()&&t.ax(),this._d.m1(q,t)):r.d()||s.d()?r.e()||s.e()?(t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f)),t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new Sd(c+e+this._b*g._k._bc,d+f+this._b*g._q._bc)),t.aa(new Sd(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new Sd(c+e,d+f-g._k._bd*n-g._e)),g._q._bd++,g._q._bc++,g._k._bd++,g._k._bc++,s.d()&&t.ax(),this._d.m1(q,t)):(r.f()||s.f())&&(t.aa(new Sd(c+g._b._bd*l+g._p,d+f)),t.aa(new Sd(c+g._b._bd*l+g._p,d+f+this._b*g._b._bc)),t.aa(new Sd(c-this._b*g._l._bc,d+f+this._b*g._b._bc)),t.aa(new Sd(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new Sd(c,d+f-g._l._bd*o-g._a)),g._b._bd++,g._b._bc++,g._l._bd++,g._l._bc++,s.d()&&t.ax(),this._d.m1(q,t)):(t.aa(new Sd(c,d+f-g._l._bd*o-g._a)),t.aa(new Sd(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new Sd(c-this._b*g._l._bc,d+f+this._b*g.a1())),t.aa(new Sd(c+e+this._b*g._k._bc,d+f+this._b*g.a1())),t.aa(new Sd(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new Sd(c+e,d+f-g._k._bd*n-g._e)),g._l._bd++,g._l._bc++,g._b._bc++,g._q._bc++,g._k._bc++,g._k._bd++,s.f()&&t.ax(),this._d.m1(q,t))}}}},a5:function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=b[c],f=d.x1();f.i1();f.i2()){var g=f.i9();if(this.a2(g)){var h=this.b2(g);e._g=Math.max(e._g,this._b*(h.d()-1)),e._j=Math.max(e._j,this._b*(h.a1()-1))}}},a1:function(a){var b=this._d.xc("A"),c=null;if(null!=b&&(c=b.i1(a)),null==c||c.g()){var d=this._d.xc("B");if(null==d)return pf.j(1);var e=d.i1(a);if(null==e||e.g())return pf.j(1);if(e.c())return pf.j(8);if(e.f())return pf.j(1);if(e.d())return pf.j(4);if(e.e())return pf.j(2)}return c},b1:function(a){var b=this._d.xc("B"),c=null;if(null!=b&&(c=b.i1(a)),null==c||c.g()){var d=this._d.xc("A");if(null==d)return pf.j(8);var e=d.i1(a);if(null==e||e.g())return pf.j(8);if(e.c())return pf.j(8);if(e.f())return pf.j(1);if(e.d())return pf.j(4);if(e.e())return pf.j(2)}return c}});var zf=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new re,this._g=new vf,this._d=new vf,this._b=new vf,this._q=new vf,this._h=new vf,this._k=new vf,this._i=new vf,this._l=new vf};Hb.ext(zf,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(a,b,c,d){this._c=b,this._a=d,this._p=a,this._e=c,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var Af=function(a,b,c,d){this._k=20,this._r=.5,this._d=a,this._c=b,this._j=c,this._m=d,this._i=null!=a.xc("A")||null!=a.xc("B"),this._t=new Df(a,b,c,d),this._b=new yf(a,this)};Hb.ext(Af,Object,{a6:function(a){this._k=a,this._t.a1(a),this._b.a3(a)},g1:function(){return this._k},a9:function(a){return this.c1(),a},a5:function(a){return this.a1(),a},b3:function(a){return this.c1(),a=this.c4(a),this._b.c(),a},g2:function(a){return this._b.g(),a},e2:function(a){a=this.f(a),this._b.f()},e1:function(){this._t.d(),null!=this._n&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){this._i&&(null!=this._q&&(this._d.x1("A",this._q),this._q=null),null!=this._p&&(this._d.x1("B",this._p),this._p=null),null!=this._h&&(this._d.xj(this._h),this._h=null),null!=this._l&&(this._d.xj(this._l),this._l=null))},c1:function(){if(this._i){null==this._h&&(this._h=this._d.xl()),null==this._l&&(this._l=this._d.xl());for(var a=this._d.xf();a.i1();a.i2()){var b=a.i8(),c=null!=this._j.i1(b.a2()),d=null!=this._j.i1(b.a3());if(c&&!d){var e=this._j.i1(b.a2());this._m.i4(e)?this._l.i8(b,pf.h(this._d,e)):this._l.i8(b,pf.i(this._d,e))}else if(!c&&d){var f=this._j.i1(b.a3());this._m.i4(f)?this._h.i8(b,pf.i(this._d,f)):this._h.i8(b,pf.h(this._d,f))}else c||d||(this._m.i4(b)?(this._h.i8(b,pf.i(this._d,b)),this._l.i8(b,pf.h(this._d,b))):(this._h.i8(b,pf.h(this._d,b)),this._l.i8(b,pf.i(this._d,b))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)}},c4:function(a){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();for(var b=new re,c=new re,d=new re,e=new re,f=new re,g=new re,h=new re,i=new re,j=new re,k=this._d.xk(),l=0;l<a.length;l++)for(var m=0,n=a[l].x1();n.i1();)k.i6(n.i9(),m),n.i2(),m++;for(var o=function(a,b){var c=k.i3(a.a3())-k.i3(b.a3());return 0>=c?c>=0?0:-1:1},p=function(a,b){var c=k.i3(a.a2())-k.i3(b.a2());return 0>=c?c>=0?0:-1:1},q=0;q<a.length;q++)for(var r=a[q],s=r._b;null!=s;s=s.a()){var t=s.d();t.av(o),t.au(p);var u=0;b.af(),c.af(),d.af(),e.af(),f.af(),g.af(),h.af(),i.af(),j.af();for(var v=t.ap();v.i1();){var w=v.i8(),x=this.b1(w);null==x||x.d()||x.g()?d.aa(w):x.e()?b.aa(w):x.f()?(c.aa(w),j.aa(w)):x.c()&&(i.aa(w),j.aa(w)),v.i2(),u++}u=0;for(var y=t.am();y.i1();){var z=y.i8(),A=this.a2(z);null==A||A.c()||A.g()?e.aa(z):A.e()?b.aa(z):A.f()?(c.aa(z),j.aa(z)):A.d()&&(g.aa(z),j.aa(z)),y.i2(),u++}var B=k.i3(t);if(!j.ar())for(var C=.1/j.ay(),D=B-.4;!j.ar();D+=C){var E=j.c3();if(E.a2()===t){var F=this._d.xm();this._n.z1(F,E.a2()),this._d.s7(F,1,1),this._c.z1(F,this._c.i1(t)),k.i6(F,D),this._a.i8(E,this._d.gn(E)),this._d.gt(E,ff._A),this._d.xr(E,F,E.a3()),r.ao(F,s)}else{var G=this._d.xm();this._n.z1(G,E.a3()),this._d.s7(G,1,1),this._c.z1(G,this._c.i1(t)),k.i6(G,D),this._g.i8(E,this._d.gk(E)),this._d.gz(E,ff._A),this._d.xr(E,E.a2(),G),r.ao(G,s)}}if(!b.ar())for(var H=.1/b.ay(),I=B+.1;!b.ar();I+=H){var J=b.c3();if(J.a2()===t){var K=this._d.xm();this._n.z1(K,J.a2()),this._d.s7(K,1,1),this._c.z1(K,this._c.i1(t)),k.i6(K,I),this._a.i8(J,this._d.gn(J)),this._d.gt(J,ff._A),this._d.xr(J,K,J.a3()),s=r.an(K,s)}else{var L=this._d.xm();this._n.z1(L,J.a3()),this._d.s7(L,1,1),this._c.z1(L,this._c.i1(t)),k.i6(L,I),this._g.i8(J,this._d.gk(J)),this._d.gz(J,ff._A),this._d.xr(J,J.a2(),L),s=r.an(L,s)}}var M=Af._z;this._b.a2(t)&&(M=this._b.b2(t));var N=M._b.ay()+g.ay()+t.ao()+f.ay()+M._q.ay();if(N>0)for(var O=this._d.g9(t)/2,P=this._d.gj(t),Q=this.a7(P,N),R=-.5*P+this.a8(this._d.gj(t),N,Q)+Q*(M._b.ay()+g.ay()),S=t.ap();S.i1();S.i2()){var T=S.i8();this.c2(T)||null!=this._j.i1(T.a2())||(this._d.g2(T).i8(new Sd(R,O)),R+=Q)}var U=this._t.a3(t),V=0,W=0,X=0,Y=0;if(null!=U&&(V=U._e.ay(),W=U._c.ay(),X=U._b.ay(),Y=U._d.ay()),N=M._g.ay()+V+i.ay()+t.ak()+h.ay()+W+M._d.ay(),N>0){for(var Z=this._d.gj(t),$=this.a7(Z,N),_=this.a8(Z,N,$),aa=-.5*Z+_+$*(M._g.ay()+V+i.ay()),ba=-this._d.g9(t)/2,ca=t.am();ca.i1();ca.i2()){var da=ca.i8();this.d1(da)||null!=this._j.i1(da.a3())||(this._d.g2(da).i9(new Sd(aa,ba)),aa+=$)}if(null!=U){for(var ea=-.5*Z+_+$*(M._g.ay()+i.ay()+U._e.ay()-1),fa=U._e.c1();fa.i1();fa.i2()){var ga=fa.i8();this._d.u1(ga),ga.a2()!==t||this.c2(ga)?this.d1(ga)||(this._d.g2(fa.i8()).i9(new Sd(ea,ba)),ea-=$):(this._d.g2(fa.i8()).i8(new Sd(ea,ba)),ea-=$),this._d.h1(ga)}ea=.5*Z-_-$*(M._d.ay()+h.ay());for(var ha=U._c.c1();ha.i1();ha.i2()){var ia=ha.i8();this._d.u1(ia),ia.a2()!==t||this.c2(ia)?this.d1(ia)||(this._d.g2(ha.i8()).i9(new Sd(ea,ba)),ea-=$):(this._d.g2(ha.i8()).i8(new Sd(ea,ba)),ea-=$),this._d.h1(ia)}}}this._b.a2(t)&&this._b.a4(t,V+i.ay()+t.ak()+h.ay()+W,g.ay()+t.ao()+f.ay(),X+c.ay(),Y+b.ay())}return this._d.xi(k),a},a7:function(a,b){return 1>=b?0:a/(b-1+2*this._r)},a8:function(a,b,c){return 1>=b?.5*a:.5*(a-c*(b-1))},f:function(a){var b=this.g1();this._f=this._d.xk();for(var c=0;c<a.length;c++)for(var d=a[c],e=d._b;null!=e;){var f=e.d(),g=this._n.i1(f);if(null!=g||this._t.b2(f))e=e.a();else{var h=new Je,i=new Je,j=new Je,k=new Je,l=new Je,m=new Je,n=new re,o=new re,p=new Gf(h,i,j,k,l,m,n,o);this._f.z1(f,p),n.ab(f.am()),o.ab(f.ap());for(var q=e.b();null!=q&&this._n.i1(q.d())===f;q=q.b()){var r=q.d(),s=this.c3(r);s.f()?i.ac(r):s.c()?k.ac(r):s.d()&&m.ac(r)}var t;for(t=e.a();null!=t&&this._n.i1(t.d())===f;t=t.a()){var u=t.d(),v=this.c3(u);v.e()?h.aa(u):v.c()?j.aa(u):v.d()&&l.aa(u)}e=t}}for(var w=this.d2(a),x=0,y=0;y<a.length;y++){var z=w[y];y>0&&(x+=w[y-1]._j+w[y-1]._h+w[y-1]._b),x+=z._g+z._f+z._a+z._d;for(var A=a[y].x1();A.i1();A.i2()){var B=A.i9();this._d.s3(B,this._d.gi(B),this._d.gh(B)+x)}z._c+=x,z._i+=x}for(var C=0;C<a.length;C++)for(var D=a[C],E=D.x1();E.i1();E.i2()){var F=E.i9();null!=this._n.i1(F)&&D.av(E)}for(var G=this,H=function(a,b){return G.a3(a)?G.a3(b)&&G._d.gi(a)>=G._d.gi(b)?-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?1:-1},I=function(a,b){return G.a3(a)?G.a3(b)?G._d.gi(a)>=G._d.gi(b)?1:-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?-1:1},J=0;J<a.length;J++)for(var K=w[J],L=a[J].x1();L.i1();L.i2()){var M=L.i9();if(!this._t.b2(M)){var N=this._f.i1(M),O=N._d,P=N._a,Q=N._b,R=N._h,S=N._f,T=N._c,U=N._g,V=N._e,W=0,X=0,Y=0,Z=0,$=M.ao(),_=M.ak(),aa=this._d.gi(M),ba=this._d.gh(M),ca=this._d.gj(M),da=this._d.g9(M),ea=this._t.a3(M),fa=Af._z;if(this._b.a2(M)&&(fa=this._b.b2(M)),null!=ea){if(W=ea._d.ay(),X=ea._b.ay(),Y=ea._e.ay(),Z=ea._c.ay(),W>0)for(var ga=fa._h.ay()+O.ay()+W+fa._k.ay(),ha=this.a7(da,ga),ia=this.a8(da,ga,ha),ja=ba+ia+ha*(fa._h.ay()+this.a4(O)),ka=ea._d.c1();ka.i1();ka.i2()){var la=ka.i8();this._d.u1(la),la.a2()===M?this.c2(la)||this._d.gx(la,new Sd(aa+ca,ja)):(this.d1(la),this._d.gy(la,new Sd(aa+ca,ja))),ja+=ha,this._d.h1(la)}if(X>0)for(var ma=fa._i.ay()+P.ay()+X+fa._l.ay(),na=this.a7(da,ma),oa=this.a8(da,ma,na),pa=ba+oa+na*(fa._i.ay()+this.a4(P)),qa=ea._b.c1();qa.i1();qa.i2()){var ra=qa.i8();this._d.u1(ra),ra.a2()===M?this.c2(ra)||this._d.gx(ra,new Sd(aa,pa)):this.d1(ra)||this._d.gy(ra,new Sd(aa,pa)),pa+=na,this._d.h1(ra)}}if(O.ay()>0){O.a1(H);for(var sa=fa._h.ay()+O.ay()+W+fa._k.ay(),ta=this.a7(da,sa),ua=this.a8(da,sa,ta),va=ba+ua+ta*fa._h.ay(),wa=!0;!O.ar();){var xa=O.x4();if(this.a3(xa)){wa&&(wa=!1,va+=ta*W);var ya=xa.ag(),za=this._d.gd(ya),Aa=za.at();if(za.ac(new Sd(Aa.x,K.b())),this.c2(ya)){var Ba=this._a.i1(ya);za.ac(new Sd(Aa.x,Ba.y+this._d.g6(M))),
za.ac(new Sd(Ba.x+this._d.g5(M),Ba.y+this._d.g6(M)))}else za.ac(new Sd(Aa.x,va)),za.ac(new Sd(aa+ca,va));this._d.xr(ya,M,ya.a3()),this._d.m1(ya,za)}else{var Ca=xa.ae(),Da=this._d.gd(Ca),Ea=Da.au();if(Da.ae(new Sd(Ea.x,K.a())),this.d1(Ca)){var Fa=this._g.i1(Ca);Da.ae(new Sd(Ea.x,Fa.y+this._d.g6(M))),Da.ae(new Sd(Fa.x+this._d.g5(M),Fa.y+this._d.g6(M)))}else Da.ae(new Sd(Ea.x,va)),Da.ae(new Sd(aa+ca,va));this._d.xr(Ca,Ca.a2(),M),this._d.m1(Ca,Da)}this._d.x4(xa),va+=ta}}if(P.ay()>0){P.a1(I);for(var Ga=fa._i.ay()+P.ay()+X+fa._l.ay(),Ha=this.a7(da,Ga),Ia=this.a8(da,Ga,Ha),Ja=ba+Ia+Ha*fa._i.ay(),Ka=!0;!P.ar();){var La=P.x4();if(this.a3(La)){Ka&&(Ka=!1,Ja+=Ha*X);var Ma=La.ag(),Na=this._d.gd(Ma),Oa=Na.at();if(Na.ac(new Sd(Oa.x,K.b())),this.c2(Ma)){var Pa=this._a.i1(Ma);Na.ac(new Sd(Oa.x,Pa.y+this._d.g6(M))),Na.ac(new Sd(Pa.x+this._d.g5(M),Pa.y+this._d.g6(M)))}else Na.ac(new Sd(Oa.x,Ja)),Na.ac(new Sd(aa,Ja));this._d.xr(Ma,M,Ma.a3()),this._d.m1(Ma,Na)}else{var Qa=La.ae(),Ra=this._d.gd(Qa),Sa=Ra.au();if(Ra.ae(new Sd(Sa.x,K.a())),this.d1(Qa)){var Ta=this._g.i1(Qa);Ra.ae(new Sd(Sa.x,Ta.y+this._d.g6(M))),Ra.ae(new Sd(Ta.x+this._d.g5(M),Ta.y+this._d.g6(M)))}else Ra.ae(new Sd(Sa.x,Ja)),Ra.ae(new Sd(aa,Ja));this._d.xr(Qa,Qa.a2(),M),this._d.m1(Qa,Ra)}this._d.x4(La),Ja+=Ha}}var Ua=fa._g.ay()+fa._d.ay()+_+R.ay()+Q.ay()+Y+Z;ca=this._d.gj(M);var Va=this.a7(ca,Ua),Wa=this.a8(ca,Ua,Va);Ua=fa._b.ay()+fa._q.ay()+$+T.ay()+S.ay();var Xa=this.a7(ca,Ua),Ya=this.a8(ca,Ua,Xa);if(R.ay()>0)for(var Za,$a=Va,_a=b,ab=this._d.gi(M)+Wa+$a*(fa._g.ay()+R.ay()-1),bb=this._d.gh(M),cb=K._c-K._g-R.ay()*_a;!R.ar();this._d.x4(Za)){Za=R.x4();var db=Za.ag(),eb=this._d.gd(db),fb=eb.at();if(eb.ac(new Sd(fb.x,K.b())),eb.ac(new Sd(fb.x,cb)),this.c2(db)){var gb=this._a.i1(db);eb.ac(new Sd(gb.x+this._d.g5(M),cb)),eb.ac(new Sd(gb.x+this._d.g5(M),gb.y+this._d.g6(M)))}else eb.ac(new Sd(ab,cb)),eb.ac(new Sd(ab,bb)),ab-=$a;cb+=_a,this._d.xr(db,M,db.a3()),this._d.m1(db,eb)}if(Q.ay()>0)for(var hb,ib=Va,jb=b,kb=this._d.gi(M)+this._d.gj(M)-Wa-ib*fa._d.ay(),lb=this._d.gh(M),mb=K._c-K._g-jb;!Q.ar();this._d.x4(hb)){hb=Q.x4();var nb=hb.ag(),ob=this._d.gd(nb),pb=ob.at();if(ob.ac(new Sd(pb.x,K.b())),ob.ac(new Sd(pb.x,mb)),this.c2(nb)){var qb=this._a.i1(nb);ob.ac(new Sd(qb.x+this._d.g5(M),mb)),ob.ac(new Sd(qb.x+this._d.g5(M),qb.y+this._d.g6(M)))}else ob.ac(new Sd(kb,mb)),ob.ac(new Sd(kb,lb)),kb-=ib;mb-=jb,this._d.xr(nb,M,nb.a3()),this._d.m1(nb,ob)}if(T.ay()>0)for(var rb,sb=Xa,tb=b,ub=this._d.gi(M)+Ya+sb*(fa._b.ay()+T.ay()-1),vb=this._d.gh(M)+this._d.g9(M),wb=vb+T.ay()*tb;!T.ar();this._d.x4(rb)){rb=T.x4();var xb=rb.ae(),yb=this._d.gd(xb),zb=yb.au();if(yb.ae(new Sd(zb.x,K.a())),yb.ae(new Sd(zb.x,wb)),this.d1(xb)){var Ab=this._g.i1(xb);yb.ae(new Sd(Ab.x+this._d.g5(M),wb)),yb.ae(new Sd(Ab.x+this._d.g5(M),Ab.y+this._d.g6(M)))}else yb.ae(new Sd(ub,wb)),yb.ae(new Sd(ub,vb)),ub-=sb;wb-=tb,this._d.xr(xb,xb.a2(),M),this._d.m1(xb,yb)}if(S.ay()>0)for(var Bb,Cb=Xa,Db=b,Eb=this._d.gi(M)+this._d.gj(M)-Ya-Xa*fa._q.ay(),Fb=this._d.gh(M)+this._d.g9(M),Gb=Fb+Db;!S.ar();this._d.x4(Bb)){Bb=S.x4();var Hb=Bb.ae(),Ib=this._d.gd(Hb),Jb=Ib.au();if(Ib.ae(new Sd(Jb.x,K.a())),Ib.ae(new Sd(Jb.x,Gb)),this.d1(Hb)){var Kb=this._g.i1(Hb);Ib.ae(new Sd(Kb.x+this._d.g5(M),Gb)),Ib.ae(new Sd(Kb.x+this._d.g5(M),Kb.y+this._d.g6(M)))}else Ib.ae(new Sd(Eb,Gb)),Ib.ae(new Sd(Eb,Fb)),Eb-=Cb;Gb+=Db,this._d.xr(Hb,Hb.a2(),M),this._d.m1(Hb,Ib)}for(;!V.ar();){var Lb=V.c3(),Mb=this._d.gl(Lb);K.a()+12<Mb.y&&this._d.g7(Lb).i4(Mb.x,K.a())}for(;!U.ar();){var Nb=U.c3(),Ob=this._d.gs(Nb);if(K.b()-12>Ob.y){var Pb=this._d.gf(Nb);Pb.ac(new Sd(Ob.x,K.b())),this._d.s6(Nb,Pb)}}}}for(var Qb=0;Qb<a.length;Qb++)for(var Rb=a[Qb],Sb=Rb._b;null!=Sb;Sb=Sb.a()){var Tb=Sb.d(),Ub=this._t.a3(Tb);null!=Ub&&null!=Ub._a&&(this._d.x4(Ub._a),Rb.aw(Sb.b()))}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),a},c3:function(a){return this.a3(a)?this.b1(a.ag()):this.a2(a.ae())},b1:function(a){return null==this._h?Af.s:this._h.i1(a)},a2:function(a){return null==this._l?Af.u:this._l.i1(a)},c2:function(a){if(null==a)return!1;var b=this.b1(a);return null!=b&&b.a()},d1:function(a){if(null==a)return!1;var b=this.a2(a);return null!=b&&b.a()},a3:function(a){return 1===a.ao()},b2:function(a){return 1===a.ak()},a4:function(a){for(var b=0,c=a._b;null!=c;c=c.a())this.b2(c.d())&&b++;return b},d2:function(a){for(var b=this._k,c=Hf.d(a.length+1),d=0;d<a.length;d++){var e=a[d],f=new Ef;c[d]=f,f._c=Number.MAX_VALUE,f._i=Number.MIN_VALUE;for(var g=e.x1();g.i1();g.i2()){var h=g.i9(),i=this._d.gb(h);f._c=Math.min(f._c,i.i2()),f._i=Math.max(f._i,i.i2()+i.i4())}}this._b.a5(a,c);for(var j=0;j<a.length;j++)for(var k=c[j],l=a[j].x1();l.i1();l.i2()){var m=l.i9(),n=this._f.i1(m);null!=n&&(k._h=Math.max(k._h,Math.max(n._f.ay()*b,n._c.ay()*b)),k._f=Math.max(k._f,Math.max(n._b.ay()*b,n._h.ay()*b)))}return c}}),Af.s=pf.j(2),Af.u=pf.j(1),Af._z=new zf;var Bf=function(){this._af=0,this._b=0};Hb.ext(Bf,Object,{ib:function(a){this._af=a},ia:function(a,b,c){this.a6(a,b,c),this.b2(!1);var d=this.g();if(this.o()&&d>0){for(var e=this.r(),f=0;20>f&&d>0&&this.o();f++){this.b2(!0);var g=this.g();d>g&&(this.a7(e),d=g)}this.b3(e),this.b1()}return this.c()},a6:function(a,b,c){this._b=(new Date).getTime(),this._ac=a,this._ah=b;var d=this;this._p=function(a,b){var c=d._n[a.al()]-d._n[b.al()];return c>0?1:c>=0?0:-1},this._ad=Hf.d(c);for(var e=0;e<this._ad.length;e++)this._ad[e]=new Je;this._ab=Hf.a(this._ac.x0()),this._f=Hf.d(this._ac.x0()),this._n=Hf.a(this._ac.x0()+1);var f=this._ab;this._o=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,g=c.a2(),h=d.a2(),i=f[g.al()]-f[h.al()];if(0===i){var j=Bf.b(pf.h(e,c),e.gn(c)),k=Bf.b(pf.h(e,d),e.gn(d)),l=j-k;if(0===l){var m=f[c.a3().al()]-f[d.a3().al()];if(0===m){var n=Bf.a(pf.i(e,c),e.gk(c)),o=Bf.a(pf.i(e,d),e.gk(d));return n-o}return m}return l}return i},this._l=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,g=c.a3(),h=d.a3(),i=f[g.al()]-f[h.al()];if(0===i){var j=Bf.a(pf.i(e,c),e.gk(c)),k=Bf.a(pf.i(e,d),e.gk(d)),l=j-k;if(0===l){var m=f[c.a2().al()]-f[d.a2().al()];if(0===m){var n=Bf.b(pf.h(e,c),e.gn(c)),o=Bf.b(pf.h(e,d),e.gn(d));return n-o}return m}return l}return i},this._z=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,f=Bf.b(pf.h(e,c),e.gn(c)),g=Bf.b(pf.h(e,d),e.gn(d));return f-g},this._e=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,f=Bf.a(pf.i(e,c),e.gk(c)),g=Bf.a(pf.i(e,d),e.gk(d));return f-g},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var a=this._ad;return this._ad=null,a},o:function(){var a=(new Date).getTime()-this._b;return a<=this._af},m:function(){for(var a=this,b=function(b,c){return Math.ceil(a._n[b.a3().al()])-Math.ceil(a._n[c.a3().al()])},c=this._ac.x9();c.i1();c.i2()){for(var d=c.i9().aw();d.i1();d.i2())this._n[d.i9().al()]=ff.j();c.i9().av(b)}},b2:function(a){for(var b=0;b<this._ad.length;b++)this._ad[b].af();if(a){this.m();for(var c=0,d=this._ab.length;d>c;c++)this._ab[c]=0;this._ac.x2(null,this._z)}var e=this._ac.xm();this._ah.i7(e,0);for(var f=this._ac.x9();f.i1();f.i2())0===f.i9().ak()&&f.i9()!==e&&this._ac.xo(e,f.i9());var g=new ee(this);g.a6(!0),g.a9(this._ac,e),this._ad[0].at(),this._ac.x4(e),this.d()},a1:function(){this._ac.x2(this._o,this._l);for(var a=0,b=1;b<this._ad.length;b++){var c=this.a2(this._ad[b-1],this._ad[b]);a+=c}var d=0;return a+=d},a2:function(a,b){var c=a.ah(),d=b.ah(),e=new qe,f=new qe;this._aa=Hf.d(this._ac.x0());for(var g=0;c.i1()&&d.i1();d.i2())g+=this.a8(c.i6(),e,f,!0),g+=this.a8(d.i6(),f,e,!1),c.i2();for(;c.i1();c.i2())g+=this.a8(c.i6(),e,f,!0);for(;d.i1();d.i2())g+=this.a8(d.i6(),f,e,!1);return g},a8:function(a,b,c,d){var e=0,f=0,g=0;if(null!=this._aa[a.al()])for(var h=this._aa[a.al()].a(),i=b._b;i!==h;i=i.a()){var j=i._c;j===a?(e++,g+=f,b.aw(i)):f++}var k=e*c.ay()+g;if(d)for(var l=a.ag();null!=l;l=l.a8()){var m=l.a3();this._ab[m.al()]>=this._ab[a.al()]&&(this._aa[m.al()]=c.ae(m))}else for(var n=a.ae();null!=n;n=n.a7()){var o=n.a2();this._ab[o.al()]>this._ab[a.al()]&&(this._aa[o.al()]=c.ae(o))}return k},g:function(){for(var a=this.r(),b=this.a1(),c=!0,d=0;3>d&&this.o()&&b>0;){var e=this.k();b>e?(this.a7(a),b=e):d++,c=!c}if(this.b3(a),this.b1(),b>0){for(var f=1,g=0;1===f&&b>0;g++){this.e(),this.i();var h=this.a1();b>h?(f=1,this.a7(a)):f=-1,b=h}this.b3(a),this.b1()}return b},e:function(){for(var a=this.l(),b=this.r(),c=Hf.d(this._ac.x0()),d=this._ad.length-1;d>=0;d--)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(1===f.ak()&&1===f.ao()){var g=a.i1(f.ag());if(null!=g&&null==c[g.al()])for(var h=this.a4(f,g),i=g.al(),j=c[i]=Hf.d(h+1),k=j.length-1;k>=0;k--)j[k]=new qe}}for(var l=0;l<this._ad.length;l++)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(1===n.ak()&&1===n.ao()){var o=a.i1(n.ag());if(null!=o){var p=o.al(),q=this.a4(n,o)-1;c[p][q].ae(n.ae())}}else for(var r=n.ae();null!=r;r=r.a7()){var s=a.i1(r);if(null!=s){var t=s.al(),u=this.a4(n,s)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(null!=c[w.al()])for(var x=w.ag();null!=x;x=x.a8()){var y=a.i1(x);if(null!=y)for(var z=c[y.al()];z[0].ay()>0;){for(var A,B=0;;){A=z[B].am();var C=A.a3();if(1!==C.ak()||1!==C.ao())break;B++}var D=z[B].at().a3();B--,D=A.a2(),A=z[B].at();for(var E=A.a3();B>=0;)if(b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ae().a2(),--B>=0){var F=z[B].at();E=F.a3()}}}}this.b1(),this._ac.xj(a)},i:function(){for(var a=this.f(),b=this.r(),c=Hf.d(this._ac.x0()),d=0;d<this._ad.length;d++)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(1===f.ak()&&1===f.ao()){var g=a.i1(f.ae());if(null!=g&&null==c[g.al()])for(var h=this.a4(g,f),i=g.al(),j=c[i]=Hf.d(h+1),k=j.length-1;k>=0;k--)j[k]=new qe}}for(var l=this._ad.length-1;l>=0;l--)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(1===n.ak()&&1===n.ao()){var o=a.i1(n.ae());if(null!=o){var p=o.al(),q=this.a4(o,n)-1;c[p][q].ae(n.ag())}}else for(var r=n.ag();null!=r;r=r.a8()){var s=a.i1(r);if(null!=s){var t=s.al(),u=this.a4(s,n)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(null!=c[w.al()])for(var x=w.ae();null!=x;x=x.a7()){var y=a.i1(x);if(null!=y)for(var z=c[y.al()];z[0].ay()>0;){for(var A,B=0;;){A=z[B].am();var C=A.a2();if(1!==C.ak()||1!==C.ao())break;B++}var D=z[B].at().a2();B--,D=A.a3(),A=z[B].at();for(var E=A.a2();B>=0;)if(b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ag().a3(),--B>=0){var F=z[B].at();E=F.a2()}}}}this.b1(),this._ac.xj(a)},a4:function(a,b){return this._ah.i2(a)-this._ah.i2(b)},l:function(){for(var a=Ne.a6(Hf.d(this._ac.xg())),b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ao()>1){for(var d=0,e=c.ag();null!=e;e=e.a8()){var f=e.a3();1===f.ak()&&1===f.ao()&&d++}if(d>1)for(var g=c.ag();null!=g;g=g.a8()){var h=g,i=h.a3();if(1===i.ak()&&1===i.ao()){for(;1===i.ak()&&1===i.ao();i=h.a3())a.i8(h,c),h=i.ag();a.i8(h,c)}}}}return a},f:function(){for(var a=Ne.a6(Hf.d(this._ac.xg())),b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ak()>1){for(var d=0,e=c.ae();null!=e;e=e.a7()){var f=e.a2();1===f.ak()&&1===f.ao()&&d++}if(d>1)for(var g=c.ae();null!=g;g=g.a7()){var h=g,i=h.a2();if(1===i.ak()&&1===i.ao()){for(;1===i.ak()&&1===i.ao();i=h.a2())a.i8(h,c),h=i.ae();a.i8(h,c)}}}}return a},k:function(){for(var a=1;a<this._ad.length;a++){for(var b=this._ad[a],c=b.ah();c.i1();c.i2()){var d=c.i6();this._n[d.al()]=this.a5(d,b.ay(),d.am(),this._ad[a-1].ay()),this._n[d.al()]+=this._ab[d.al()]/(3*this._ad[a-1].ay())}this.a3(b,this._p)}return this.a1()},a5:function(a,b,c,d){var e=0;if(0===c.i7())e=d*this._ab[a.al()]/b;else{for(;c.i1();c.i2()){var f=c.i8();e+=f.a2()===a?this._ab[f.a3().al()]:this._ab[f.a2().al()]}e/=c.i7()}return e},a7:function(a){Hf.f(this._ab,a,a.length)},b3:function(a){Hf.f(a,this._ab,a.length)},r:function(){var a=Hf.a(this._ab.length);return this.a7(a),a},d:function(){for(var a=0;a<this._ad.length;a++)for(var b=0,c=this._ad[a].ah();c.i1();)this._ab[c.i6().al()]=b,c.i2(),b++},b1:function(){for(var a=0;a<this._ad.length;a++){for(var b=this._ad[a],c=b._b;null!=c;c=c.a()){var d=c.d();this._f[this._ab[d.al()]]=d}for(var e=0,f=b._b;null!=f;)f.c(this._f[e]),f=f.a(),e++}},a3:function(a,b){for(var c=a.ah(),d=0;d<a.ay();c.i2())this._f[d]=c.i6(),d++;Hf.s(this._f,a.ay(),b);for(var e=0,f=a._b;null!=f;)f.c(this._f[e]),this._ab[this._f[e].al()]=e,f=f.a(),e++}}),Bf.b=function(a,b){if(null==a)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4-d:a.f()?-1e4+d:a.c()?-2e4-c:c},Bf.a=function(a,b){if(null==a)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4+d:a.f()?-1e4-d:a.d()?-2e4-c:c};var Cf=function(){Cf.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new uf,this._i1=new Bf,this._i8=new xf};Hb.ext(Cf,Qe,{j2:function(){return this._i2},i4:function(a){return!0},i3:function(a){this._i6=(new Date).getTime(),of.d(a,!1);var b=a.xk(),c=a.xk(),d=a.xl(),e=new re,f=new Af(a,b,c,d);f.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(c);for(var g=this._i7.i1(a,b,e),h=e.c1();h.i1();h.i2()){var i=h.i8();d.i7(i,!0);var j=a.gn(i);a.gt(i,a.gk(i)),a.gz(i,j)}this.a2(a,b,c),g=f.a9(g);var k=this.j1(a,b,g);k=f.a5(k),k=f.b3(k),this._i8.i1(a,k,b),k=f.g2(k),f.e2(k),this.b(a,c),this.w(a),this.a1(a,e),f.e1(),a.xj(d),a.xi(c),a.xi(b)},j1:function(a,b,c){if(this._i1 instanceof Bf){var d=this._i1,e=(new Date).getTime()-this._i6;d.ib(this._i3-e)}var f=this._i1.ia(a,b,c);return f},a1:function(a,b){for(var c=b.c1();c.i1();c.i2()){var d=c.i8(),e=a.gs(d),f=a.gl(d);a.x3(d);var g=a.gp(d);a.s5(d,g.a()),a.gy(d,e),a.gx(d,f)}},b:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=b.i1(d);if(null!=e&&!a.xp(e)){for(var f=d.am().i8().a2();null!=b.i1(f);f=d.am().i8().a2())d=f;a.u1(e);for(var g=d.ae(),h=new qe;null!=b.i1(g.a3());g=g.a3().ag()){var i=a.gs(g);h.aa(i),h.az(a.gf(g));var j=a.gl(g);j.equals(i)||h.aa(j)}var k=a.gs(g);h.aa(k),h.az(a.gf(g));var l=a.gl(g);l.equals(k)||h.aa(l),a.m1(e,h)}}for(var m=a.x9();m.i1();m.i2())null!=b.i1(m.i9())&&a.x4(m.i9())},w:function(a){for(var b=a.xf();b.i1();b.i2()){var c=b.i8(),d=a.g2(c);if(d.i1()>0){var e=new md,f=a.gc(c),g=f.c(),h=g.i6();g.i2();var i=h.x,j=h.y;if(g.i1()){var k=g.i6(),l=k.x,m=k.y;for(g.i2();g.i1();g.i2()){var n=g.i6(),o=n.x,p=n.y,q=(i-o)*(m-p)/(j-p)+o;Math.abs(q-l)>=1&&(e.add(k),i=l,j=m),k=n,l=o,m=p}}e.size()<d.i1()&&a.s5(c,new Xd(e))}}},a2:function(a,b,c){var d=a.g8().c1();for(d.i5();d.i1();d.i3()){var e=d.i8().a2(),f=d.i8().a3(),g=b.i2(f)-b.i2(e);if(g>1){for(var h=null,i=null,j=e;g>1;g--)h=a.xm(),a.s7(h,1,1),a.s4(h,ff._A),i=a.xo(j,h),j===e&&a.gt(i,a.gn(d.i8())),b.i7(h,b.i2(j)+1),c.z1(h,d.i8()),j=h;i=a.xo(h,f),a.gz(i,a.gk(d.i8())),a.h1(d.i8())}}}});var Df=function(a,b,c,d){this._i=20,this._j=a,this._g=b,this._a=c,this._h=d};Hb.ext(Df,Object,{a1:function(a){this._i=a},b2:function(a){return null==this._e?!1:this._e.i4(a)},a3:function(a){return null==this._f?null:this._f.i1(a)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Ef=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};Hb.ext(Ef,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Ff=function(){this._d=new re,this._b=new re,this._c=new re,this._e=new re};Hb.ext(Ff,Object,{});var Gf=function(a,b,c,d,e,f,g,h){this._d=a,this._a=b,this._b=c,this._h=d,this._f=e,this._c=f,this._e=g,this._g=h};Hb.ext(Gf,Object,{});var Hf={};if(Hf.a=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=b||0;return c},Hf.b=function(a){for(var b=[],c=0;a>c;c++)b[c]=!1;return b},Hf.c=function(a,b){if(a instanceof Sd)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y<=b.y?0:1;if(a instanceof Td)return b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;if(a instanceof Vd)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y>b.y?1:b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;throw"Unkown Type: "+a},Hf.d=function(a){for(var b=[],c=0;a>c;c++)b[c]=null;return b},Hf.e=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=Hf.a(b);return c},Hf.f=function(a,b,c){for(var d=0;c>d;d++)b[d]=a[d]},Hf.s=function(a,b,c){var d=[];Hf.f(a,d,b),d.sort(c),Hf.f(d,a,b)},Hf.n=function(a,b){return a-b},window.make)var If=window.make;else{var If=window.make={},Jf={},Kf={},Lf=[],Mf={};If.Default={path:"./",resPath:"",getImagePath:function(a){return this.path+this.resPath+"res/images/"+(a||"")},register:function(a,b,c){c=c||{},c.name=c.name||a,c.modelDefaultParameters=c.modelDefaultParameters||{},c.description=c.description||c.name,Jf[a]&&console.log(a," already exist"),Jf[a]=b;var d=c.category||"",e=Kf[d]||{};e[a]=b,Kf[d]=e,Mf[a]=c,-1==Lf.indexOf(d)&&Lf.push(d),this.checkModelDefaultParameters(c.modelDefaultParameters)},checkModelDefaultParameters:function(a){if(a)for(var b in a){var c=a[b];c instanceof Object||(c={value:c},a[b]=c),c.propertyName=b,c.hidden=!!c.hidden,c.propertyType=c.propertyType||If.Default.PARAMETER_PROPERTY_TYPE_FIELD,c.type=c.type||If.Default.PARAMETER_TYPE_STRING,c.category=c.category||If.Default.PARAMETER_CATEGORY_DETAIL,c.editable=void 0===c.editable?!0:!!c.editable,c.index=void 0===c.index?100:parseInt(c.index)}},remove:function(a){if(Jf[a]){Jf[a]=void 0,delete Jf[a];var b=If.Default.getCategory(a),c=Kf[b];delete c[a];var d=0;for(var e in c)e&&d++;if(0==d)for(var e=0;e<Lf.length;e++){var f=Lf.indexOf(b);f>=0&&Lf.splice(f,1)}delete Mf[a]}else console.log(a," not exist")},getCategories:function(){return Lf},getCreatorsForCategory:function(a){return Kf[a]},getCreator:function(a){return Jf[a]},getIds:function(a){var b=[];for(var c in Jf)(!a||a&&a(this.getParameters(c)))&&b.push(c);return b},getModelDefaultParameters:function(a){var b=this.getParameters(a);return b.modelDefaultParameters},getDescription:function(a){var b=this.getParameters(a);return b.description},getName:function(a){var b=this.getParameters(a);return b.name},getIcon:function(a){var b=this.getParameters(a);return this.path+b.icon},isAsync:function(a){var b=this.getParameters(a);return b.async},isCombo:function(a){var b=this.getParameters(a);return b.combo},getCategory:function(a){var b=this.getParameters(a);return b.category},getOrder:function(a){var b=this.getParameters(a);return b.order||0},getType:function(a){var b=this.getParameters(a);return b.type},getOtherParameter:function(a,b){var c=this.getParameters(a);return c[b]},registerIcon:function(a,b){var c=this.getParameters(a);return c?(c.icon=b,c.icon):void 0},registerDescription:function(a,b){var c=this.getParameters(a);return c.description=b,c.description},registerName:function(a,b){var c=this.getParameters(a);return c.name=b,c.name},registerOther:function(a,b,c){var d=e[b],e=this.getParameters(a);return e[b]=c,"modelDefaultParameters"===b&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",a,d,c),this.checkModelDefaultParameters(c)),d},appendModelDefaultParameter:function(a,b,c,d,e,f,g){},getParameters:function(a){return Mf[a]||{}},load:function(a,b,c){var d,c=c||{},e=c.isRelation;if(b){var f=b;b=function(b){e&&a instanceof Array&&a.length>1&&b instanceof Array&&b.length>1&&this._relation(a,b),f(b)}}if(a instanceof Array){var g={};if(b){var h=function(c,d){var e=a.length;return function(a){c.datas=c.datas||[],c.datas.push(a),c._total===e&&b(c.datas)}(d)};g._total=0;for(var i=0;i<a.length;i++){var j=a[i];this.load(j,function(a){g._total++,h(g,a)})}return null}d=[];for(var i=0;i<a.length;i++){var j=a[i],k=this.load(j);k&&d.push(k)}}else{var l={};"string"==typeof a?l.id=a:l=a,l=this.filterJson(l),b?this._load(l,b):d=this._load(l)}return e&&d instanceof Array&&d.length>1&&this._relation(a,d),d},_relation:function(a,b){var c={};b.forEach(function(a){a.getId&&(c[a.getId()]=a)}),a.forEach(function(a){a.objectId&&a.parentId&&c[a.objectId]&&c[a.parentId]&&c[a.objectId].setParent&&c[a.objectId].setParent(c[a.parentId])})},_load:function(a,b){var c=a.id,d=this.getCreator(c);if(!d)return console.log("unknown id: ",c),null;if(!b){var e=d(a);return If.Default._setObjectClientId(e,c),e}d(a,function(a){If.Default._setObjectClientId(a,c),b&&b(a)})},_setObjectClientId:function(a,b){a&&a.setClient&&a.setClient("id",b)},copyArray:function(a,b,c){if(b=[],a)for(var d,e=0,f=a.length;f>e;e++)d={},this.copyProperties(a[e],d),b.push(d);return b},copyProperties:function(a,b,c){if(a&&b)for(var d in a)c&&c.indexOf(d)>=0||0==d.indexOf("_")||(void 0===b[d]&&(b[d]=a[d]instanceof Array?[]:a[d]instanceof Function?a[d]:a[d]instanceof Object?{}:a[d]),!(a[d]instanceof Function)&&a[d]instanceof Object&&b[d]instanceof Object&&If.Default.copyProperties(a[d],b[d]))},getModelDefaultParametersValues:function(a,b){var c=this.getModelDefaultParameters(a),d={};for(var e in c){var f=c[e];b&&b(f)||(f.propertyType==If.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(d.client=d.client||{},d.client[e]=f.value):f.propertyType==If.Default.PARAMETER_PROPERTY_TYPE_STYLE?(d.style=d.style||{},d.style[e]=f.value):d[e]=f.value)}return d},getModelDefaultParameterProperties:function(a,b){var c=this,d=[],e=this.getModelDefaultParameters(a);if(!e)return d;b&&!e.id&&(e.id={propertyName:"id",name:"ID",category:If.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:If.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:If.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),b&&!e.objectId&&(e.objectId={propertyName:"objectId",name:"ID",category:If.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:If.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:If.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var f in e)d.push(e[f]);return d.sort(function(a,b){return a.index-b.index}),d=d.map(function(a){return c.modelParameterToProperty(a)})},_getNameFromPropertyName:function(a){for(var b=a.split("."),c="",d=0;d<b.length;d++)b[d].length>0&&(c+=b[d].substring(0,1).toUpperCase()+b[d].substring(1,b[d].length)),d<b.length-1&&(c+=" ");return c},modelParameterToProperty:function(a){var b=new Gb.Property;return b.setCategoryName(a.category),a.name||(a.name=this._getNameFromPropertyName(a.propertyName)),b.setName(a.name),b.setEditable(a.editable),b.setPropertyType(a.propertyType),b.setPropertyName(a.propertyName),b.setValueType(a.type),b.setEnumInfo(a.enumInfo),b.isVisible=function(){return!a.hidden},b},filterJson:function(a){var b=this.getModelDefaultParameters(a.id);for(var c in b){var d=b[c].propertyType||"client",e=b[c].value;d==If.Default.PARAMETER_PROPERTY_TYPE_STYLE?a.style&&void 0!==a.style[c]||(a.style=a.style||{},a.style[c]=e):d==If.Default.PARAMETER_PROPERTY_TYPE_CLIENT?a.client&&void 0!==a.client[c]||(a.client=a.client||{},a.client[c]=e):void 0===a[c]&&(a[c]=e)}return a},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(a){return parseInt(a)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*a},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(a){return parseInt(a)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(a)+this.RACK_OFFSET_Y}},If.Default.toJson=function(a,b){if(a&&a.getClient){var c=a.getClient("id"),d=If.Default.getModelDefaultParameters(c),e={},f=null,g=null;for(var h in d)if(d[h].exportable!==!1){var i=d[h].propertyType,g=d[h].value;i==If.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(f=a[Hb.getter(h)](),If.Default.equals(f,g)||(e[h]=f)):i==If.Default.PARAMETER_PROPERTY_TYPE_FIELD?(f=a[h],If.Default.equals(f,g)||(e[h]=f)):i==If.Default.PARAMETER_PROPERTY_TYPE_STYLE?(f=a.getStyle(h),If.Default.equals(f,g)||(e.style=e.style||{},e.style[h]=f)):i==If.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(f=a.getClient(h),If.Default.equals(f,g)||(e.client=e.client||{},e.client[h]=f))}return e.id=c,If.Default.EXPORT_OBJECT_ID&&(e.objectId=a.getId()),b&&(e=b(e)),e}return b&&(a=b(a)),a},If.Default.copy=function(a,b,c,d,e){var f=function(a,b,c,d,e){e=e||{};var f={},g={},h=If.Default.getParameters(b);if(h=If.Default.clone(h),If.Default.copyProperties(h,g),d instanceof Function?f=d(g)||{}:If.Default.copyProperties(d,f),e.copyDefaultParamCoverage&&delete g.modelDefaultParameters,e.copyParamCoverage||If.Default.copyProperties(g,f),e.defaultValue&&f.modelDefaultParameters)for(var i in e.defaultValue)void 0!==f.modelDefaultParameters[i]&&(f.modelDefaultParameters[i]instanceof Object?f.modelDefaultParameters[i].value=e.defaultValue[i]:f.modelDefaultParameters[i]=e.defaultValue[i]);If.Default.register(a,function(a,d){var e={id:b};c instanceof Function?c(a):If.Default.copyProperties(c,e),If.Default.copyProperties(a,e);var f=If.Default.load(e,d);return f},f)};f(a,b,c,d,e)},If.Default.PARAMETER_CATEGORY_BASIC="BASIC",If.Default.PARAMETER_CATEGORY_DETAIL="Detail",If.Default.PARAMETER_TYPE_STRING="string",If.Default.PARAMETER_TYPE_BOOLEAN="boolean",If.Default.PARAMETER_TYPE_COLOR="color",If.Default.PARAMETER_TYPE_INT="int",If.Default.PARAMETER_TYPE_NUMBER="number",If.Default.PARAMETER_TYPE_IMAGE="image",If.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",If.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",If.Default.PARAMETER_TYPE_ARRAY_INT="array.int",If.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",If.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",If.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",If.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(a,b,c){return RegExp.prototype.isPrototypeOf(a)?this.replace(a,b):this.replace(new RegExp(a,c?"gi":"g"),b)},String.prototype.format=function(a){var b=this;if(arguments.length>1){for(var c=[],d=0;d<arguments.length;d++)c.push(arguments[d]);a=c}if(a)if(a instanceof Array)a.forEach(function(a,c){a instanceof Object&&(a=JSON.stringify(a)),b=b.replaceAll("{"+c+"}",a)});else{if(!(a instanceof Object))return b.replaceAll("{}",a);for(var e in a){var f=a[e];f instanceof Object&&(f=JSON.stringify(f)),b=b.replaceAll("{"+e+"}",f)}}return b},If.Default.getId=function(a){return a.getClient("id")},If.Default.objectWrapper=function(a,b,c,d){Object.defineProperty(a,b,{get:function(){var d=a["___"+b];return c&&(d=c.call(a,d,a,b)),d},set:function(c){var e=a[b];d&&(c=d.call(a,c,a,b)),e!==c&&(a["___"+b]=c,this.firePropertyChange&&this.firePropertyChange(b,e,c))}})},If.Default.equals=function(a,b){return a instanceof Object&&b instanceof Object?JSON.stringify(a)==JSON.stringify(b):a==b},If.Default.clone=function(a){try{return JSON.parse(JSON.stringify(a))}catch(b){throw console.error(b,a),b}},If.Default.EXPORT_OBJECT_ID=!0}If.Utils2D={create2dShapeNode:function(a){var b=a.position||[0,0,0],c=a.data,d=a.image,e=(a.objType,a.objectId),f=a.closed,g=new If.Default.WallShapeNode(e);"innerWall"==a.objType?g=new If.Default.InnerWallShapeNode(e):"floor"==a.objType?g=new If.Default.FloorShapeNode(e):"cable"==a.objType&&(g=new If.Default.LineWidthShapeNode(e));var h=If.Default.create2dShapePath(c,b);return If.Default.objectWrapper(g,"id",function(){return this.getClient("id")}),If.Default.objectWrapper(g,"objectId",function(){return this.getId()}),g.setSegments(h.segments),g.setPoints(h.points),f&&g.setClient("closed",!0),d&&g.setClient("imageSrc",d),If.Default.setObject2dCSProps(g,a),g},create2dShapePath:function(a,b){var c=new Gb.List,d=new Gb.List;if(a.length>0)if(c.add("moveto"),a[0]instanceof Array){d.add({x:parseFloat(a[0][0])+parseFloat(b[0]),y:parseFloat(a[0][1])+parseFloat(b[2])});for(var e=1;e<a.length;e++){var f=a[e];"c"==f[0]?(c.add("quadto"),d.add({x:parseFloat(f[1])+parseFloat(b[0]),y:parseFloat(f[2])+parseFloat(b[2])}),d.add({x:parseFloat(f[3])+parseFloat(b[0]),y:parseFloat(f[4])+parseFloat(b[2])})):(c.add("lineto"),d.add({x:parseFloat(f[0])+parseFloat(b[0]),y:parseFloat(f[1])+parseFloat(b[2])}))}}else{d.add({x:parseFloat(a[0])+parseFloat(b[0]),y:parseFloat(a[1])+parseFloat(b[2])});for(var e=2;e<a.length;e+=2)c.add("lineto"),d.add({x:parseFloat(a[e])+parseFloat(b[0]),y:parseFloat(a[e+1])+parseFloat(b[2])})}return{segments:c,points:d}},setObject2dCSProps:function(a,b){var c=b.style,d=b.client;if(c)for(var e in c)a.setStyle(e,c[e]);if(d)for(var e in d)a.setClient(e,d[e])},createBlockObject:function(a,b){var c=a.objectId,d=new If.Default.Block(c);"door"==b?d=new If.Default.Door(c):"window"==b&&(d=new If.Default.Window(c)),a.width&&d.setClient("length",a.width);var e=a.client||{};return d.setClient("edgeIndex",e.edgeIndex||1),d.setClient("offset",e.offset||0),If.Default.setObject2dCSProps(d,a),d},createNode:function(a){var b=a.position||[0,0,0],c=a.rotation||[0,0,0],d=a.width||50,e=a.depth||50,f=a.image,g=a.objectId,h=new Gb.Follower(g),i=a.color||"#CCCCFF";return If.Default.objectWrapper(h,"id",function(){return this.getClient("id")}),If.Default.objectWrapper(h,"objectId",function(){return this.getId()}),h.setSize(parseFloat(d),parseFloat(e)),h.setCenterLocation({x:parseFloat(b[0]),y:parseFloat(b[2])}),h.setAngle(c[1]),h.setClient("positionY",b[1]),"string"==typeof f?h.setImageUrl(f):"object"==typeof f?h.setImage(f):(h.setStyle("body.type","vector"),h.setStyle("vector.shape","rectangle"),h.setStyle("vector.fill.color",i)),h.setStyle("select.style","border"),h.setStyle("select.color","#F07819"),h.setStyle("select.width",.7),h.setStyle("vector.outline.width",1),h.setStyle("vector.outline.color","#BEC9BE"),h.getWidth()>20&&h.setStyle("label.maxlength",Math.min(h.getWidth(),h.getHeight())),h.setStyle("label.position","center"),If.Default.setObject2dCSProps(h,a),h},createFollower:function(a){var b=a,a={};If.Default.copyProperties(b,a),a.id=a.objectId||Hb.id(),a.scale=a.scale||1,a.depth=a.depth||5,a.position=a.position||[0,0,0],a.rotation=a.rotation||[0,0,0];var c=new Gb.Follower(a);return If.Default.objectWrapper(c,"id",function(){return c.getClient("id")}),If.Default.objectWrapper(c,"objectId",function(){return c.getId()}),If.Default.objectWrapper(c,"depth"),If.Default.objectWrapper(c,"position",null,function(a){return this.setLocation({x:a[0],y:a[1]}),a}),If.Default.objectWrapper(c,"rotation",null,function(a){return this.setAngle(a[2]),a}),If.Default.objectWrapper(c,"scale",null,function(a){var b=this.getSize();b.width=b.width*a,b.height=b.height*a,this.setSize(b);var d=this.getLocation();return d.x=d.x*a,d.y=d.y*a,c.setLocation(d),a}),c.depth=a.depth,c.position=a.position,c.rotation=a.rotation,c.scale=a.scale,c.addPropertyChangeListener(function(a){var b=a.property,c=a.source;"location"==b?(c.position[0]=a.newValue.x,c.position[1]=a.newValue.y):"angle"==b&&(c.rotation[2]=a.newValue)},c),a.x&&c.setX(a.x),a.y&&c.setY(a.y),c.z=a.z,a.location&&c.setLocation(a.location instanceof Array?{x:a.location[0],y:a.location[1]}:a.location),a.centerLocation&&c.setCenterLocation(a.centerLocation instanceof Array?{x:a.centerLocation[0],y:a.centerLocation[1]}:a.centerLocation),a.size&&c.setSize(a.size),a.angle&&c.setAngle(a.angle),c.setStyle("select.style","border"),c.setStyle("select.color","#F07819"),c.setStyle("select.width",.7),c.setStyle("vector.outline.color","#BEC9BE"),If.Default.setObject2dCSProps(c,a),c},align:function(a,b){if(b&&a&&!(a.size()<2)){var c=this["_align_"+b];c&&c.call(this,a)}},_align_up:function(a){for(var b=a.get(0).getLocation().y,c=1;c<a.size();c++)b=Math.min(b,a.get(c).getLocation().y);a.forEach(function(a){a.setY(b)})},_align_down:function(a){for(var b=a.get(0).getLocation().y+a.get(0).getSize().height,c=1;c<a.size();c++)b=Math.max(b,a.get(c).getLocation().y+a.get(c).getSize().height);a.forEach(function(a){a.setY(b-a.getSize().height)})},_align_left:function(a){for(var b=a.get(0).getLocation().x,c=1;c<a.size();c++)b=Math.min(b,a.get(c).getLocation().x);
a.forEach(function(a){a.setX(b)})},_align_right:function(a){for(var b=a.get(0).getLocation().x+a.get(0).getSize().width,c=1;c<a.size();c++)b=Math.max(b,a.get(c).getLocation().x+a.get(c).getSize().width);a.forEach(function(a){a.setX(b-a.getSize().width)})},_align_center:function(a){for(var b=0,c=0;c<a.size();c++)b+=a.get(c).getCenterLocation().y;var d=b/a.size();a.forEach(function(a){a.setY(d-a.getSize().height/2)})},_align_middle:function(a){for(var b=0,c=0;c<a.size();c++)b+=a.get(c).getCenterLocation().x;var d=b/a.size();a.forEach(function(a){a.setX(d-a.getSize().width/2)})},flow:function(a,b,c){if(b&&a&&!(a.size()<2)){var d=this["_flow_"+b];d&&d.call(this,a,c)}},_flow_hor:function(a,b){this.sort(a,function(a,b){return a.getLocation().y-b.getLocation().y}),this.sort(a,function(a,b){return a.getLocation().x-b.getLocation().x});for(var c=a.get(0),d=1;d<a.size();d++){var e=a.get(d),f=c.getLocation().x;e.setX(f+b),c=e}},_flow_ver:function(a,b){this.sort(a,function(a,b){return a.getLocation().x-b.getLocation().x}),this.sort(a,function(a,b){return a.getLocation().y-b.getLocation().y});for(var c=a.get(0),d=1;d<a.size();d++){var e=a.get(d),f=c.getLocation().y;e.setY(f+b),c=e}},sort:function(a,b){for(var c,d,e,f,g=a.size(),h=0;g>h;h++){c=a.get(h);for(var i=h+1;g>i;i++)d=a.get(i),e=b?b(c,d):0,e>0&&(f=d,d=c,c=f,a.set(h,c),a.set(i,d))}},wrapper:function(a,b){If.Default.objectWrapper(a,"id",function(){return this.getClient("id")}),If.Default.objectWrapper(a,"objectId",function(){return this.getId()}),If.Default.objectWrapper(a,"width"),If.Default.objectWrapper(a,"height"),If.Default.objectWrapper(a,"depth"),If.Default.objectWrapper(a,"px"),If.Default.objectWrapper(a,"py"),If.Default.objectWrapper(a,"pz"),If.Default.objectWrapper(a,"rx"),If.Default.objectWrapper(a,"ry"),If.Default.objectWrapper(a,"rz"),If.Default.objectWrapper(a,"position"),If.Default.objectWrapper(a,"rotation"),b&&b.forEach(function(b){If.Default.objectWrapper(a,b)})}},If.Default.register("twaver.cube.top",function(a,b){var c=If.Utils2D.createNode(a);return b&&b(c),c});for(var pc in If.Utils2D)If.Default[pc]=If.Utils2D[pc]}(),function(d,e){function f(a,b,c,d,e,f){var g=e.realSize?e.realSize:e;b=b||"",b=String(b),a.font=c,a.fillStyle=d,a.strokeStyle="gray",a.textBaseline="middle",a.textAlign="center";for(var h=b.split("\n"),i=h.length,j=g.height/i,k=(e.height-g.height)/2,l=0;i>l;l++){var m=hc.getTextSize(c,h[l]).width,n=(e.height,m/2);"right"==f?(n=e.width-m/2,a.textAlign="center"):"left"==f?(n=m/2,a.textAlign="center",a.textBaseline="middle"):"center"==f&&(n=e.width/2),a.strokeText(h[l],n,j/2+l*j+k),a.fillText(h[l],n,j/2+l*j+k)}}function g(a,b){var c=0;if(a.shadowMatrix)for(var d=0,e=b.size();e>d;d++){var f=b.get(d);f.refreshShadowUniforms(a,c)&&c++}}function h(a,b){var c=0;if(a.pShadowMap)for(var d=0,e=b.size();e>d;d++){var f=b.get(d);f.refreshUniformsPointShadow(a,c)&&c++}}function k(a,b,c,d){if(b._modelViewMatrix||(b._modelViewMatrix=new cc),c.uniformMatrix4fv(a.modelViewMatrix,!1,b._modelViewMatrix.elements),a.normalMatrix&&c.uniformMatrix3fv(a.normalMatrix,!1,b._normalMatrix.elements),a.modelViewProjectionMatrix){b._modelViewProjectionMatrix=new cc;var e=d._currentCamera,f=e.projectionMatrix;b._modelViewProjectionMatrix.multiply(f,b._modelViewMatrix),c.uniformMatrix4fv(a.modelViewProjectionMatrix,!1,b._modelViewProjectionMatrix.elements)}}function l(a,b,c){var d;return"fragment"===a?d=c.createShader(c.FRAGMENT_SHADER):"vertex"===a&&(d=c.createShader(c.VERTEX_SHADER)),c.shaderSource(d,b),c.compileShader(d),c.getShaderParameter(d,c.COMPILE_STATUS)||c.isContextLost()?d:(console.log(c.getShaderInfoLog(d)),console.error(b),null)}function m(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function n(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function o(a,b,c,d){a[b]=c.r*c.r*d,a[b+1]=c.g*c.g*d,a[b+2]=c.b*c.b*d}function p(a){var b=a,c=b._canvas;uc.isNaN(b._renderInterval)&&(b._renderInterval=10),b.__timeOutFunc||(b.__timeOutFunc=function(){var a=b._vrDisplay;if(b._animateId=(a&&a.isPresenting?a:d).requestAnimationFrame(b.__timeOutFunc),b._isPresenting){var e=b._camera;e.updateProjectionMatrix(),e.worldMatrix=e.leftVm,e.worldMatrixInverse=e.leftVmInverse,e.projectionMatrix=e.leftPm,b._gl.viewport(0,0,.5*c.width,c.height),b._dirty=!0,xc.clear(!0,b.autoClearDepth,b.autoClearStencil,b),b.render(),e.worldMatrix=e.rightVm,e.worldMatrixInverse=e.rightVmInverse,e.projectionMatrix=e.rightPm,b._gl.viewport(.5*c.width,0,.5*c.width,c.height),xc.clear(!1,b.autoClearDepth,b.autoClearStencil,b),b.innerRender(e,!0),b.extendRender(e),a.submitFrame()}else b.render()}),setTimeout(b.__timeOutFunc,b._renderInterval)}function q(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function r(){return new q(null)}function t(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function v(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function w(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function x(a){return Ic.charAt(a)}function y(a,b){var c=Jc[a.charCodeAt(b)];return null==c?-1:c}function z(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function A(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+DV:this.t=0}function B(a){var b=r();return b.fromInt(a),b}function C(a,b){var c;if(16==b)c=4;else if(8==b)c=3;else if(256==b)c=8;else if(2==b)c=1;else if(32==b)c=5;else{if(4!=b)return void this.fromRadix(a,b);c=2}this.t=0,this.s=0;for(var d=a.length,e=!1,f=0;--d>=0;){var g=8==c?255&a[d]:y(a,d);0>g?"-"==a.charAt(d)&&(e=!0):(e=!1,0==f?this[this.t++]=g:f+c>this.DB?(this[this.t-1]|=(g&(1<<this.DB-f)-1)<<f,this[this.t++]=g>>this.DB-f):this[this.t-1]|=g<<f,f+=c,f>=this.DB&&(f-=this.DB))}8==c&&0!=(128&a[0])&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),e&&q.ZERO.subTo(this,this)}function D(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function E(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,f="",g=this.t,h=this.DB-g*this.DB%b;if(g-->0)for(h<this.DB&&(c=this[g]>>h)>0&&(e=!0,f=x(c));g>=0;)b>h?(c=(this[g]&(1<<h)-1)<<b-h,c|=this[--g]>>(h+=this.DB-b)):(c=this[g]>>(h-=b)&d,0>=h&&(h+=this.DB,--g)),c>0&&(e=!0),e&&(f+=x(c));return e?f:"0"}function F(){var a=r();return q.ZERO.subTo(this,a),a}function G(){return this.s<0?this.negate():this}function H(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function I(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function J(){return this.t<=0?0:this.DB*(this.t-1)+I(this[this.t-1]^this.s&this.DM)}function K(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function L(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function M(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function N(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function O(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function P(a,b){var c=this.abs(),d=a.abs(),e=c.t;for(b.t=e+d.t;--e>=0;)b[e]=0;for(e=0;e<d.t;++e)b[e+c.t]=c.am(0,d[e],b,e,0,c.t);b.s=0,b.clamp(),this.s!=a.s&&q.ZERO.subTo(b,b)}function Q(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function R(a,b,c){var d=a.abs();if(!(d.t<=0)){var e=this.abs();if(e.t<d.t)return null!=b&&b.fromInt(0),void(null!=c&&this.copyTo(c));null==c&&(c=r());var f=r(),g=this.s,h=a.s,i=this.DB-I(d[d.t-1]);i>0?(d.lShiftTo(i,f),e.lShiftTo(i,c)):(d.copyTo(f),e.copyTo(c));var j=f.t,k=f[j-1];if(0!=k){var l=k*(1<<this.F1)+(j>1?f[j-2]>>this.F2:0),m=this.FV/l,n=(1<<this.F1)/l,o=1<<this.F2,p=c.t,s=p-j,t=null==b?r():b;for(f.dlShiftTo(s,t),c.compareTo(t)>=0&&(c[c.t++]=1,c.subTo(t,c)),q.ONE.dlShiftTo(j,t),t.subTo(f,f);f.t<j;)f[f.t++]=0;for(;--s>=0;){var u=c[--p]==k?this.DM:Math.floor(c[p]*m+(c[p-1]+o)*n);if((c[p]+=f.am(0,u,c,s,0,j))<u)for(f.dlShiftTo(s,t),c.subTo(t,c);c[p]<--u;)c.subTo(t,c)}null!=b&&(c.drShiftTo(j,b),g!=h&&q.ZERO.subTo(b,b)),c.t=j,c.clamp(),i>0&&c.rShiftTo(i,c),0>g&&q.ZERO.subTo(c,c)}}}function S(a){var b=r();return this.abs().divRemTo(a,null,b),this.s<0&&b.compareTo(q.ZERO)>0&&a.subTo(b,b),b}function T(a){this.m=a}function U(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function V(a){return a}function W(a){a.divRemTo(this.m,null,a)}function X(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function Y(a,b){a.squareTo(b),this.reduce(b)}function Z(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function $(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function _(a){var b=r();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&b.compareTo(q.ZERO)>0&&this.m.subTo(b,b),b}function aa(a){var b=r();return a.copyTo(b),this.reduce(b),b}function ba(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function ca(a,b){a.squareTo(b),this.reduce(b)}function da(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function ea(){return 0==(this.t>0?1&this[0]:this.s)}function fa(a,b){if(a>4294967295||1>a)return q.ONE;var c=r(),d=r(),e=b.convert(this),f=I(a)-1;for(e.copyTo(c);--f>=0;)if(b.sqrTo(c,d),(a&1<<f)>0)b.mulTo(d,e,c);else{var g=c;c=d,d=g}return b.revert(c)}function ga(a,b){var c;return c=256>a||b.isEven()?new T(b):new $(b),this.exp(a,c)}function ha(){var a=r();return this.copyTo(a),a}function ia(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function ja(){return 0==this.t?this.s:this[0]<<24>>24}function ka(){return 0==this.t?this.s:this[0]<<16>>16}function la(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function ma(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function na(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var b=this.chunkSize(a),c=Math.pow(a,b),d=B(c),e=r(),f=r(),g="";for(this.divRemTo(d,e,f);e.signum()>0;)g=(c+f.intValue()).toString(a).substr(1)+g,e.divRemTo(d,e,f);return f.intValue().toString(a)+g}function oa(a,b){this.fromInt(0),null==b&&(b=10);for(var c=this.chunkSize(b),d=Math.pow(b,c),e=!1,f=0,g=0,h=0;h<a.length;++h){var i=y(a,h);0>i?"-"==a.charAt(h)&&0==this.signum()&&(e=!0):(g=b*g+i,++f>=c&&(this.dMultiply(d),this.dAddOffset(g,0),f=0,g=0))}f>0&&(this.dMultiply(Math.pow(b,f)),this.dAddOffset(g,0)),e&&q.ZERO.subTo(this,this)}function pa(a,b,c){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(q.ONE.shiftLeft(a-1),xa,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(q.ONE.shiftLeft(a-1),this);else{var d=new Array,e=7&a;d.length=(a>>3)+1,b.nextBytes(d),e>0?d[0]&=(1<<e)-1:d[0]=0,this.fromString(d,256)}}function qa(){var a=this.t,b=new Array;b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-->0)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b}function ra(a){return 0==this.compareTo(a)}function sa(a){return this.compareTo(a)<0?this:a}function ta(a){return this.compareTo(a)>0?this:a}function ua(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function va(a,b){return a&b}function wa(a){var b=r();return this.bitwiseTo(a,va,b),b}function xa(a,b){return a|b}function ya(a){var b=r();return this.bitwiseTo(a,xa,b),b}function za(a,b){return a^b}function Aa(a){var b=r();return this.bitwiseTo(a,za,b),b}function Ba(a,b){return a&~b}function Ca(a){var b=r();return this.bitwiseTo(a,Ba,b),b}function Da(){for(var a=r(),b=0;b<this.t;++b)a[b]=this.DM&~this[b];return a.t=this.t,a.s=~this.s,a}function Ea(a){var b=r();return 0>a?this.rShiftTo(-a,b):this.lShiftTo(a,b),b}function Fa(a){var b=r();return 0>a?this.lShiftTo(-a,b):this.rShiftTo(a,b),b}function Ga(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function Ha(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+Ga(this[a]);return this.s<0?this.t*this.DB:-1}function Ia(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function Ja(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=Ia(this[c]^b);return a}function Ka(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)}function La(a,b){var c=q.ONE.shiftLeft(a);return this.bitwiseTo(c,b,c),c}function Ma(a){return this.changeBit(a,xa)}function Na(a){return this.changeBit(a,Ba)}function Oa(a){return this.changeBit(a,za)}function Pa(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b[c++]=d:-1>d&&(b[c++]=this.DV+d),b.t=c,b.clamp()}function Qa(a){var b=r();return this.addTo(a,b),b}function Ra(a){var b=r();return this.subTo(a,b),b}function Sa(a){var b=r();return this.multiplyTo(a,b),b}function Ta(){var a=r();return this.squareTo(a),a}function Ua(a){var b=r();return this.divRemTo(a,b,null),b}function Va(a){var b=r();return this.divRemTo(a,null,b),b}function Wa(a){var b=r(),c=r();return this.divRemTo(a,b,c),new Array(b,c)}function Xa(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Ya(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}}function Za(){}function $a(a){return a}function _a(a,b,c){a.multiplyTo(b,c)}function ab(a,b){a.squareTo(b)}function bb(a){return this.exp(a,new Za)}function cb(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()}function db(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function eb(a){this.r2=r(),this.q3=r(),q.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function fb(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var b=r();return a.copyTo(b),this.reduce(b),b}function gb(a){return a}function hb(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function ib(a,b){a.squareTo(b),this.reduce(b)}function jb(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function kb(a,b){var c,d,e=a.bitLength(),f=B(1);if(0>=e)return f;c=18>e?1:48>e?3:144>e?4:768>e?5:6,d=8>e?new T(b):b.isEven()?new eb(b):new $(b);var g=new Array,h=3,i=c-1,j=(1<<c)-1;if(g[1]=d.convert(this),c>1){var k=r();for(d.sqrTo(g[1],k);j>=h;)g[h]=r(),d.mulTo(k,g[h-2],g[h]),h+=2}var l,m,n=a.t-1,o=!0,p=r();for(e=I(a[n])-1;n>=0;){for(e>=i?l=a[n]>>e-i&j:(l=(a[n]&(1<<e+1)-1)<<i-e,n>0&&(l|=a[n-1]>>this.DB+e-i)),h=c;0==(1&l);)l>>=1,--h;if((e-=h)<0&&(e+=this.DB,--n),o)g[l].copyTo(f),o=!1;else{for(;h>1;)d.sqrTo(f,p),d.sqrTo(p,f),h-=2;h>0?d.sqrTo(f,p):(m=f,f=p,p=m),d.mulTo(p,g[l],f)}for(;n>=0&&0==(a[n]&1<<e);)d.sqrTo(f,p),m=f,f=p,p=m,--e<0&&(e=this.DB-1,--n)}return d.revert(f)}function lb(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return b;for(f>e&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function mb(a){if(0>=a)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c}function nb(a){var b=a.isEven();if(this.isEven()&&b||0==a.signum())return q.ZERO;for(var c=a.clone(),d=this.clone(),e=B(1),f=B(0),g=B(0),h=B(1);0!=c.signum();){for(;c.isEven();)c.rShiftTo(1,c),b?(e.isEven()&&f.isEven()||(e.addTo(this,e),f.subTo(a,f)),e.rShiftTo(1,e)):f.isEven()||f.subTo(a,f),f.rShiftTo(1,f);for(;d.isEven();)d.rShiftTo(1,d),b?(g.isEven()&&h.isEven()||(g.addTo(this,g),h.subTo(a,h)),g.rShiftTo(1,g)):h.isEven()||h.subTo(a,h),h.rShiftTo(1,h);c.compareTo(d)>=0?(c.subTo(d,c),b&&e.subTo(g,e),f.subTo(h,f)):(d.subTo(c,d),b&&g.subTo(e,g),h.subTo(f,h))}return 0!=d.compareTo(q.ONE)?q.ZERO:h.compareTo(a)>=0?h.subtract(a):h.signum()<0?(h.addTo(a,h),h.signum()<0?h.add(a):h):h}function ob(a){var b,c=this.abs();if(1==c.t&&c[0]<=Kc[Kc.length-1]){for(b=0;b<Kc.length;++b)if(c[0]==Kc[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<Kc.length;){for(var d=Kc[b],e=b+1;e<Kc.length&&Lc>d;)d*=Kc[e++];for(d=c.modInt(d);e>b;)if(d%Kc[b++]==0)return!1}return c.millerRabin(a)}function pb(a){var b=this.subtract(q.ONE),c=b.getLowestSetBit();if(0>=c)return!1;var d=b.shiftRight(c);a=a+1>>1,a>Kc.length&&(a=Kc.length);for(var e=r(),f=0;a>f;++f){e.fromInt(Kc[Math.floor(Math.random()*Kc.length)]);var g=e.modPow(d,this);if(0!=g.compareTo(q.ONE)&&0!=g.compareTo(b)){for(var h=1;h++<c&&0!=g.compareTo(b);)if(g=g.modPowInt(2,this),0==g.compareTo(q.ONE))return!1;if(0!=g.compareTo(b))return!1}}return!0}function qb(){this.i=0,this.j=0,this.S=new Array}function rb(a){var b,c,d;for(b=0;256>b;++b)this.S[b]=b;for(c=0,b=0;256>b;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function sb(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function tb(){return new qb}function ub(a){Nc[Oc++]^=255&a,Nc[Oc++]^=a>>8&255,Nc[Oc++]^=a>>16&255,Nc[Oc++]^=a>>24&255,Oc>=Pc&&(Oc-=Pc)}function vb(){ub((new Date).getTime())}function wb(){if(null==Mc){for(vb(),Mc=tb(),Mc.init(Nc),Oc=0;Oc<Nc.length;++Oc)Nc[Oc]=0;Oc=0}return Mc.next()}function xb(a){var b;for(b=0;b<a.length;++b)a[b]=wb()}function yb(){}function zb(a,b){return new q(a,b)}function Ab(a,b){if(b<a.length+11)return null;for(var c=new Array,d=a.length-1;d>=0&&b>0;){var e=a.charCodeAt(d--);128>e?c[--b]=e:e>127&&2048>e?(c[--b]=63&e|128,c[--b]=e>>6|192):(c[--b]=63&e|128,c[--b]=e>>6&63|128,c[--b]=e>>12|224)}c[--b]=0;for(var f=new yb,g=new Array;b>2;){for(g[0]=0;0==g[0];)f.nextBytes(g);c[--b]=g[0]}return c[--b]=2,c[--b]=0,new q(c)}function Bb(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Cb(a,b){this.n=zb(a,16),this.e=parseInt(b,16)}function Db(a){return a.modPowInt(this.e,this.n)}function Eb(a){var b=Ab(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPrivate(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function Fb(a,b){for(var c=a.toByteArray(),d=0;d<c.length&&0==c[d];)++d;if(c.length-d!=b-1||2!=c[d])return null;for(++d;0!=c[d];)if(++d>=c.length)return null;for(var e="";++d<c.length;){var f=255&c[d];128>f?e+=String.fromCharCode(f):f>191&&224>f?(e+=String.fromCharCode((31&f)<<6|63&c[d+1]),++d):(e+=String.fromCharCode((15&f)<<12|(63&c[d+1])<<6|63&c[d+2]),d+=2)}return e}function Gb(a,b,c){this.n=zb(a,16),this.e=parseInt(b,16),this.d=zb(c,16)}function Hb(a,b,c,d,e,f,g,h){this.n=zb(a,16),this.e=parseInt(b,16),this.d=zb(c,16),this.p=zb(d,16),this.q=zb(e,16),this.dmp1=zb(f,16),this.dmq1=zb(g,16),this.coeff=zb(h,16)}function Ib(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);for(var b=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);b.compareTo(c)<0;)b=b.add(this.p);return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)}function Jb(a){var b=zb(a,16),c=this.doPublic(b);return null==c?null:Fb(c,this.n.bitLength()+7>>3)}function Kb(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity,a.skyY.value=b.skyY,a.horizonY.value=b.horizonY,a.earthY.value=b.earthY,a.skyColor.value=b.skyColor,a.horizonColor.value=b.horizonColor,a.earthColor.value=b.earthColor}function Lb(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function Mb(a,b){a&&a.skyY&&(a.skyY.value=b.skyY,a.horizonY.value=b.horizonY,a.earthY.value=b.earthY,a.skyColor.value=b.skyColor,a.horizonColor.value=b.horizonColor,a.earthColor.value=b.earthColor)}function Nb(a,b){a.psColor.value=b.color,a.opacity.value=b.opacity,a.size.value=b.size,a.scale.value=b.scale||1,a.map.value=b.map}function Ob(a,b){return a.distance-b.distance}function Pb(a,b,c,d,e){(a instanceof $b.Node||a instanceof $b.Billboard)&&Rb(a,b,c,d,e)}function Qb(a,b,c,d,f){if(a!==e)for(var g=a.getDescendants(),h=0,i=g.length;i>h;h++)Pb(g[h],b,c,d,f)}function Rb(a,b,c,d,f){if(d||0!=f.isVisible(a)){if(a instanceof $b.Billboard){var g=b.matrixPosition;g.setFromMatrixPosition(a.worldMatrix);var h=b.ray.distanceToPoint(g),i=a.material.alignment,j=new $b.Plane(1,1);(i.x||i.y)&&(j.setPosition(i.x,i.y,0),j=$b.Utils.transformElement(j,!0)),j.setPosition(g);var k=(new ac).getScaleFromMatrix(a.worldMatrix);j.setScale(k.x,k.y,1);var l=b.direction.clone(),m=j.getPosition().clone(),n=a.material;n&&n.vertical&&(l.y=0),m.sub(l),j.lookAt(m),j.updateWorldMatrix(!0);var o=[];return Rb(j,b,o,!0,f),0===o.length?c:(c.push({distance:o[0].distance,point:a._position,face:null,object:a,element:a}),c)}if(a instanceof $b.Line){var p=1;p-=1;var q=Math.sqrt(b.linePrecision+p),r=q*q,s=a;if(null==s.boundingSphere&&s.computeBoundingSphere(),gd.copy(s.boundingSphere),gd.applyMatrix4(a.worldMatrix),b.ray.isIntersectionSphere(gd)===!1)return c;dd.getInverse(a.worldMatrix),cd.copy(b.ray).transform(dd);for(var t=s.vertices,u=t.length,v=new ac,w=new ac,x=a.type===$b.LineStrip?1:2,y=0;u-1>y;y+=x){var z=cd.distanceSqToSegment(t[y],t[y+1],w,v);if(!(z>r)){var h=cd.origin.distanceTo(w);h<b.near||h>b.far||c.push({distance:h,point:v.clone().applyMatrix4(a.worldMatrix),face:null,faceIndex:null,element:a,object:a})}}return c}if(null===a.boundingSphere&&a.computeBoundingSphere(),gd.set(a.worldMatrix.getPosition(),a.boundingSphere.radius*a.worldMatrix.getMaxScaleOnAxis()),!b.ray.isIntersectionSphere(gd))return c;var A,B,C,D,s=a,t=s.vertices,E=a.material instanceof $b.ArrayMaterial,F=E===!0?a.material.materials:null,G=a.material.side,q=b.precision;a.rotationWorldMatrix.extractRotation(a.worldMatrix),dd.getInverse(a.worldMatrix),cd.copy(b.ray).transform(dd);for(var H=0,I=s.faces.length;I>H;H++){var J=s.faces[H],K=E===!0?F[J.materialIndex]:a.material,L=f.getOverLoadMaterial(a,K);if(L&&(K=L),!(K===e||K.visible===!1||s.visible===!1&&!d||K.transparent&&0==K.opacity)){ed.setFromNormalAndCoplanarPoint(J.normal,t[J.a]);var M=cd.distanceToPlane(ed);if(!(Math.abs(M)<q||0>M)){G=K.side;var N=cd.direction.dot(ed.normal);if((G===$b.DoubleSide||(G===$b.FrontSide?0>N:N>0))&&!(M<b.near||M>b.far)){fd=cd.at(M,fd);var O,P=new ac,Q=(J.materialIndex,!1);if(f&&f._selectTransparencyThreshold>0&&(Q=1==K.transparent||K.alphaTest>0),J instanceof $b.Face3){if(A=t[J.a],B=t[J.b],C=t[J.c],!$b.Triangle.containsPoint(fd,A,B,C))continue;P=$b.Triangle.barycoordFromPoint(fd,A,B,C)}else{if(!(J instanceof $b.Face4))throw Error("face type not supported");A=t[J.a],B=t[J.b],C=t[J.c],D=t[J.d];var R=$b.Triangle.containsPoint(fd,A,B,D),S=$b.Triangle.containsPoint(fd,B,C,D);if(!R&&!S)continue;R?P=$b.Triangle.barycoordFromPoint(fd,A,B,D):(P=$b.Triangle.barycoordFromPoint(fd,B,C,D),O=!0)}var T=new _b,U=P.z,V=P.x,W=P.y;if(s.uvs&&s.uvs[H]){var X=s.uvs[H];J instanceof $b.Face3?(T.x=X[0].x*V+X[1].x*W+X[2].x*U,T.y=X[0].y*V+X[1].y*W+X[2].y*U):O?(T.x=X[1].x*V+X[2].x*W+X[3].x*U,T.y=X[1].y*V+X[2].y*W+X[3].y*U):(T.x=X[0].x*V+X[1].x*W+X[3].x*U,T.y=X[0].y*V+X[1].y*W+X[3].y*U)}var Y,Z=1;if(T=f.debugUV||T,Q){if(K.opacity<f._selectTransparencyThreshold)continue;if(null==K.map)Z=K.opacity;else if(f._pickingTexturePixel){Y=K.map._image;var $=uc.getPixelFromImage(Y,T.x,T.y);Z=$[3]/255*(null==K.opacity?1:K.opacity)}Z<K.alphaTest?Z=0:0==K.transparent&&(Z=1)}Z<f._selectTransparencyThreshold||c.push({distance:M,point:b.ray.at(M),face:J,uv:T,faceIndex:H,element:a,object:a,side:N>0?1:-1})}}}}}}function Sb(a){if(!rd[a.id]){if(td=!0,rd[a.id]=a,a.finish=null==a.finish?a.delay+a.dur+a.interval:a.finish,null==a.from&&a.attr&&a.source){var b;(b=a.attr.match(/^S[:@](.*)/i))?a.from=a.source.getStyle(b[1]):(b=a.attr.match(/^C[:@](.*)/i))?a.from=a.source.getClient(b[1]):a.from=mono.getValue(a.source,a.attr)}Tb(a),Ub(a)}return a}function Tb(a){var b=a.type,c=a.from,d=a.to;"number"===b?(a.from=c||0,a.to=d||0):"point"===b?(c?c.length&&(a.from={x:c[0],y:c[1]}):a.from="scale"===a.attr?{x:1,y:1}:{x:0,y:0},d?d.length&&(a.to={x:d[0],y:d[1]}):a.to="scale"===a.attr?{x:1,y:1}:{x:0,y:0}):"rect"===b?(c?c.length&&(a.from={x:c[0],y:c[1],w:c[2],h:c[3]}):a.from={x:0,y:0,w:0,h:0},d?d.length&&(a.to={x:d[0],y:d[1],w:d[2],h:d[3]}):a.to={x:0,y:0,w:0,h:0}):"color"===b?(a.from=getColorValue(c),a.to=getColorValue(d)):"set"!==b&&"group_set"===b,a.current=a.from}function Ub(a){var b=a.type,c=a.from,d=a.to;"number"===b?a.delta=d-c:"point"===b?a.delta={x:d.x-c.x,y:d.y-c.y}:"rect"===b?a.delta={x:d.x-c.x,y:d.y-c.y,w:d.w-c.w,h:d.h-c.h}:"color"===b?a.delta={r:d.r-c.r,g:d.g-c.g,b:d.b-c.b,a:d.a-c.a}:"set"!==b&&"group_set"===b}function Vb(a,b){return rd[a.id]&&(null==b&&(b=!0),b&&Zb(a,a.to),a.onStop&&a.onStop(),a.time=0,a.total=0,a.start=null,a.count=0,a.started=!1,a.stopped=!1,delete rd[a.id]),a}function Wb(a){null==a&&(a=!0),Object.keys(rd).forEach(function(b){var c=rd[b];a&&Zb(c,c.to),c.onStop&&c.onStop()}),rd={}}function Xb(a){Object.keys(rd).forEach(function(b){var c=rd[b];if(c){if(null==c.start&&(c.start=a),c.total=a-c.start,c.total>c.delay){c.time=c.total-c.delay;var d=!1;if(c.time>=c.dur&&(c.time=c.dur,d=!0),!c.stopped&&Zb(c,Yb(c)),c.stopped=d,c.total>=c.finish)if(c.count++,c.count>=c.repeat)Vb(c,!1),c.onDone&&c.onDone();else if(c.time=0,c.total=0,c.start=null,c.stopped=!1,c.reverse){var e=c.from;c.from=c.to,c.to=e,Ub(c)}}!td&&(td=!0)}})}function Yb(a,b){var c=a.type,d=a.delta,e=a.from,f=a.time,g=a.dur,h=lc[a.easing||"easeNone"];return h||(h=lc.easeNone),"number"===c?b=h(f,e,d,g):"point"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g)}:"rect"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g),w:h(f,e.w,d.w,g),h:h(f,e.h,d.h,g)}:"color"===c?b="rgba("+Math.floor(h(f,e.r,d.r,g))+","+Math.floor(h(f,e.g,d.g,g))+","+Math.floor(h(f,e.b,d.b,g))+","+Math.floor(h(f,e.a,d.a,g))+")":"set"===c?a.time&&(b=a.to):"group_set"===c&&(b=a.to[a.groupIndex]),a.current=b,b}function Zb(a,b){if(a.started||(a.started=!0,a.onPlay&&a.onPlay()),a.filter&&(b=a.filter(b)),a.attr&&a.source){var c;(c=a.attr.match(/^S[:@](.*)/i))?a.source.setStyle(c[1],b):(c=a.attr.match(/^C[:@](.*)/i))?a.source.setClient(c[1],b):mono.setValue(a.source,a.attr,b)}a.onUpdate&&a.onUpdate(b)}self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,Number.isNaN||(Number.isNaN=function(a){return"number"==typeof a&&isNaN(a)}),Object.create=Object.create||function(a){var b=function(){};return b.prototype=a,new b};var $b={version:"2.6.2",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(a){a=null==a?"":a;for(var b=[],c=0;32>c;c++)b[c]=this._id[Math.floor(16*Math.random())];return b[12]="4",b[16]=this._id[3&b[16]|8],a+b.join("")},ip:function(a,b,c,d){var e=c+b;a[$b.getter(b,d)]=function(){return this[e]},a[$b.setter(b)]=function(a){var c=this[e];c!==a&&(this.setPropertyValue?this.setPropertyValue(e,a)&&(this.onPropertyChange(b,c,a),this.firePropertyChange(b,c,a)):(this[e]=a,this.onPropertyChange(b,c,a),this.firePropertyChange(b,c,a)))}},getter:function(a,b){var c=a.charAt(0).toUpperCase()+a.slice(1),d=/ble$/.test(a)||/ed$/.test(a)?"is":"get";return b&&-1!=b.indexOf(a)&&(d="is"),d+c},setter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"set"+b},getValue:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.slice(1),e="get"+d,f="is"+d;return c?"boolean"===c?a[f]():(null==a[e]&&console.log("get Function "+e+" not exist"),a[e]()):a[e]?a[e]():a[f]?a[f]():a[b]},setValue:function(a,b,c){a["set"+b.charAt(0).toUpperCase()+b.slice(1)](c)},clone:function(a){if(!a)return null;var b={};for(var c in a)b[c]=a[c];return b},addMethod:function(a,b){var c=a.prototype;for(var d in b)c[d]=b[d]},classCache:{},getClass:function(a){var b=$b.classCache[a];if(!b){var c=a.split("."),e=c.length;b=d;for(var f=0;e>f;f++)b=b[c[f]];$b.classCache[a]=b}return b},newInstance:function(a){"string"==typeof a&&(a=$b.getClass(a),a=a.prototype);var b=a.constructor;if(!b)return null;var c=arguments.length,d=arguments;if(1===c)return new b;if(2===c)return new b(d[1]);if(3===c)return new b(d[1],d[2]);if(4===c)return new b(d[1],d[2],d[3]);if(5===c)return new b(d[1],d[2],d[3],d[4]);if(6===c)return new b(d[1],d[2],d[3],d[4],d[5]);if(7===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6]);if(8===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6],d[7]);throw"don't support args more than 7"},xml:function(a){if(d.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");var b=new ActiveXObject("Microsoft.XmlDOM");return b.async=!1,b.loadXml(a),b}};"function"==typeof define?define(function(){return $b}):"object"==typeof exports&&(module.exports=$b),
d&&(d.TGL=d.mono=$b);$b.extend=function(a,b,c){if(b){var d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}var e=a.prototype;if(c){e.getClassName=function(){return c.className};for(var f in c){if("__accessor"===f)for(var g=c.__accessor,h=c.__bool,i=0;i<g.length;i++){var j=g[i];$b.ip(e,j,"",h)}else if("___accessor"===f)for(var g=c.___accessor,i=0;i<g.length;i++){var j=g[i];$b.ip(e,j,"_",h)}e[f]=c[f]}c.constructor&&(e.newInstance=function(){return $b.newInstance(this)})}},$b.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(a){return this.slice(0,a.length)===a},String.prototype.endsWith=String.prototype.endsWith||function(a){var b=String(a),c=this.lastIndexOf(b);return(c>-1&&c)===this.length-b.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!d.requestAnimationFrame;++c)d.requestAnimationFrame=d[b[c]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[b[c]+"CancelAnimationFrame"]||d[b[c]+"CancelRequestAnimationFrame"];d.requestAnimationFrame===e&&(d.requestAnimationFrame=function(b,c){var e=Date.now(),f=Math.max(0,16-(e-a)),g=d.setTimeout(function(){b(e+f)},f);return a=e+f,g}),d.cancelAnimationFrame=d.cancelAnimationFrame||function(a){d.clearTimeout(a)}}(),$b.CullFaceNone=0,$b.CullFaceBack=1,$b.CullFaceFront=2,$b.CullFaceFrontBack=3,$b.FrontFaceDirectionCW=0,$b.FrontFaceDirectionCCW=1,$b.BasicShadowMap=0,$b.PCFShadowMap=1,$b.PCFSoftShadowMap=2,$b.FrontSide="front",$b.BackSide="back",$b.DoubleSide="both",$b.BothSide="both",$b.NoShading=0,$b.FlatShading=1,$b.SmoothShading=2,$b.NormalTypeFlat="flat",$b.NormalTypeSmooth="smooth",$b.NoColors=0,$b.FaceColors=1,$b.VertexColors=2,$b.GradientColors=3,$b.NoBlending=0,$b.NormalBlending=1,$b.AdditiveBlending=2,$b.SubtractiveBlending=3,$b.MultiplyBlending=4,$b.CustomBlending=5,$b.AddEquation=100,$b.SubtractEquation=101,$b.ReverseSubtractEquation=102,$b.ZeroFactor=200,$b.OneFactor=201,$b.SrcColorFactor=202,$b.OneMinusSrcColorFactor=203,$b.SrcAlphaFactor=204,$b.OneMinusSrcAlphaFactor=205,$b.DstAlphaFactor=206,$b.OneMinusDstAlphaFactor=207,$b.DstColorFactor=208,$b.OneMinusDstColorFactor=209,$b.SrcAlphaSaturateFactor=210,$b.MultiplyOperation=0,$b.MixOperation=1,$b.AddOperation=2,$b.UVMapping=function(){},$b.CubeReflectionMapping=function(){},$b.CubeRefractionMapping=function(){},$b.SphericalReflectionMapping=function(){},$b.SphericalRefractionMapping=function(){},$b.RepeatWrapping="repeat",$b.ClampToEdgeWrapping="clamp",$b.MirroredRepeatWrapping="mirrored",$b.NearestFilter=1003,$b.NearestMipMapNearestFilter=1004,$b.NearestMipMapLinearFilter=1005,$b.LinearFilter=1006,$b.LinearMipMapNearestFilter=1007,$b.LinearMipMapLinearFilter=1008,$b.UnsignedByteType=1009,$b.ByteType=1010,$b.ShortType=1011,$b.UnsignedShortType=1012,$b.IntType=1013,$b.UnsignedIntType=1014,$b.FloatType=1015,$b.UnsignedShort4444Type=1016,$b.UnsignedShort5551Type=1017,$b.UnsignedShort565Type=1018,$b.AlphaFormat=1019,$b.RGBFormat=1020,$b.RGBAFormat=1021,$b.LuminanceFormat=1022,$b.LuminanceAlphaFormat=1023,$b.RGB_S3TC_DXT1_Format=2001,$b.RGBA_S3TC_DXT1_Format=2002,$b.RGBA_S3TC_DXT3_Format=2003,$b.RGBA_S3TC_DXT5_Format=2004,$b.Gradient_Linear_U=1,$b.Gradient_Linear_V=2,$b.Gradient_Linear_UV=3,$b.Gradient_Linear_NUV=4,$b.Gradient_Radial=5,$b.Gradient_Sweep=6,$b.Math={clamp:function(a,b,c){return b>a?b:a>c?c:a},isConcave:function(a,b,c){var d=c?1:-1;return(a.x*b.y-b.x*a.y)*d<0?!0:!1},area:function(a,b,c,d){var f=d?1:-1;if(!a||!b||!c)return e;var g=-a.x*b.y-b.x*c.y-c.x*a.y+c.x*b.y+b.x*a.y+a.x*c.y;return g*f},isClockwise:function(a,b,c){b=b||"x",c=c||"y";for(var d=0,e=a.length,f=0;e>f;f++){var g=a[f],h=a[f+1===e?0:f+1];d+=(h[b]-g[b])*(h[c]+g[c])}return 0>d},isClockwise3:function(a,b,c){(new mono.Vec3).crossVectors(a,b),(new mono.Vec3).subVectors(b,a),(new mono.Vec3).subVectors(b,a)},clampBottom:function(a,b){return b>a?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return 0>a?-1:a>0?1:0},degToRad:function(a){return a*$b.Math.__d2r},radToDeg:function(a){return a*$b.Math.__r2d},smoothstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*(3-2*a))},smootherstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*a*(a*(6*a-15)+10))},PI2:2*Math.PI,generateUUID:function(){var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),d=0;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?c[e]="-":14==e?c[e]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19==e?3&a|8:a]);return c.join("")}}()},$b.Math.__d2r=Math.PI/180,$b.Math.__r2d=180/Math.PI,$b.Quat=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d!==e?d:1},$b.Quat.prototype={constructor:$b.Quat,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},setFromEuler:function(a,b){var c=Math.cos(a.x/2),d=Math.cos(a.y/2),f=Math.cos(a.z/2),g=Math.sin(a.x/2),h=Math.sin(a.y/2),i=Math.sin(a.z/2);return b===e||"XYZ"===b?(this.x=g*d*f+c*h*i,this.y=c*h*f-g*d*i,this.z=c*d*i+g*h*f,this.w=c*d*f-g*h*i):"YXZ"===b?(this.x=g*d*f+c*h*i,this.y=c*h*f-g*d*i,this.z=c*d*i-g*h*f,this.w=c*d*f+g*h*i):"ZXY"===b?(this.x=g*d*f-c*h*i,this.y=c*h*f+g*d*i,this.z=c*d*i+g*h*f,this.w=c*d*f-g*h*i):"ZYX"===b?(this.x=g*d*f-c*h*i,this.y=c*h*f+g*d*i,this.z=c*d*i-g*h*f,this.w=c*d*f+g*h*i):"YZX"===b?(this.x=g*d*f+c*h*i,this.y=c*h*f+g*d*i,this.z=c*d*i-g*h*f,this.w=c*d*f-g*h*i):"XZY"===b&&(this.x=g*d*f-c*h*i,this.y=c*h*f-g*d*i,this.z=c*d*i+g*h*f,this.w=c*d*f+g*h*i),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=this.length();return 0===a?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x=this.x*a,this.y=this.y*a,this.z=this.z*a,this.w=this.w*a),this},multiply:function(a){return this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+f*g+d*i-e*h,this.y=d*j+f*h+e*g-c*i,this.z=e*j+f*i+c*h-d*g,this.w=f*j-c*g-d*h-e*i,this},multiplyVector3:function(a){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),a.applyQuaternion(this)},slerp:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.w,g=f*a.w+c*a.x+d*a.y+e*a.z;if(0>g?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,g=-g):this.copy(a),g>=1)return this.w=f,this.x=c,this.y=d,this.z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this.w=.5*(f+this.w),this.x=.5*(c+this.x),this.y=.5*(d+this.y),this.z=.5*(e+this.z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this.w=f*j+this.w*k,this.x=c*j+this.x*k,this.y=d*j+this.y*k,this.z=e*j+this.z*k,this},toEuler:function(){var a=this.w*this.w,b=this.x*this.x,c=this.y*this.y,d=this.z*this.z,e=180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-b-c+d+a),f=180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),g=180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),b-c-d+a);return[e,f,g]},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},clone:function(){return new $b.Quat(this.x,this.y,this.z,this.w)}},$b.Quat.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};var _b=function(a,b){this.x=a||0,this.y=b||0};_b.prototype={constructor:_b,set:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a){return this.x+=a.x,this.y+=a.y,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(a){return this.x+=a,this.y+=a,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a):this.set(0,0),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},equals:function(a){return null==a?!1:a.x===this.x&&a.y===this.y},clone:function(){return new _b(this.x,this.y)}},$b.Vec2=_b;var ac=function(a,b,c){this.x=parseFloat(a)||0,this.y=parseFloat(b)||0,this.z=parseFloat(c)||0};$b.Vec3=ac,ac.prototype={set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},center:function(a,b){return this.x=(a.x+b.x)/2,this.y=(a.y+b.y)/2,this.z=(a.z+b.z)/2,this},copy:function(a){return(null==this||null==a)&&console.log("TGL.Vec3.copy this : "+this+" v : "+a),this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},applyEuler:function(a,b){var c=ac.__q1.setFromEuler(a,b);return this.applyQuaternion(c),this},applyAxisAngle:function(a,b){var c=ac.__q1.setFromAxisAngle(a,b);return this.applyQuaternion(c),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a,this.z/=a):(this.x=0,this.y=0,this.z=0),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this},cross:function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},crossVectors:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},angleTo:function(a){return Math.acos(this.dot(a)/this.length()/a.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},getPositionFromMatrix:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setEulerFromRotationMatrix:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.elements,f=d[0],g=d[4],h=d[8],i=d[1],j=d[5],k=d[9],l=d[2],m=d[6],n=d[10];return b===e||"XYZ"===b?(this.y=Math.asin(c(h)),Math.abs(h)<.99999?(this.x=Math.atan2(-k,n),this.z=Math.atan2(-g,f)):(this.x=Math.atan2(m,j),this.z=0)):"YXZ"===b?(this.x=Math.asin(-c(k)),Math.abs(k)<.99999?(this.y=Math.atan2(h,n),this.z=Math.atan2(i,j)):(this.y=Math.atan2(-l,f),this.z=0)):"ZXY"===b?(this.x=Math.asin(c(m)),Math.abs(m)<.99999?(this.y=Math.atan2(-l,n),this.z=Math.atan2(-g,j)):(this.y=0,this.z=Math.atan2(i,f))):"ZYX"===b?(this.y=Math.asin(-c(l)),Math.abs(l)<.99999?(this.x=Math.atan2(m,n),this.z=Math.atan2(i,f)):(this.x=0,this.z=Math.atan2(-g,j))):"YZX"===b?(this.z=Math.asin(c(i)),Math.abs(i)<.99999?(this.x=Math.atan2(-k,j),this.y=Math.atan2(-l,f)):(this.x=0,this.y=Math.atan2(h,n))):"XZY"===b&&(this.z=Math.asin(-c(g)),Math.abs(g)<.99999?(this.x=Math.atan2(m,j),this.y=Math.atan2(h,f)):(this.x=Math.atan2(-k,n),this.y=0)),this},setEulerFromQuaternion:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;return b===e||"XYZ"===b?(this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-d-f+g),this.y=Math.asin(c(2*(a.x*a.z+a.y*a.w))),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+d-f-g)):"YXZ"===b?(this.x=Math.asin(c(2*(a.x*a.w-a.y*a.z))),this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-d-f+g),this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-d+f-g)):"ZXY"===b?(this.x=Math.asin(c(2*(a.x*a.w+a.y*a.z))),this.y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-d-f+g),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-d+f-g)):"ZYX"===b?(this.x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-d-f+g),this.y=Math.asin(c(2*(a.y*a.w-a.x*a.z))),this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+d-f-g)):"YZX"===b?(this.x=Math.atan2(2*(a.x*a.w-a.z*a.y),h-d+f-g),this.y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+d-f-g),this.z=Math.asin(c(2*(a.x*a.y+a.z*a.w)))):"XZY"===b&&(this.x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-d+f-g),this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+d-f-g),this.z=Math.asin(c(2*(a.z*a.w-a.x*a.y)))),this},getScaleFromMatrix:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(a){return null==a?!1:a.x===this.x&&a.y===this.y&&a.z===this.z},clone:function(){return new ac(this.x,this.y,this.z)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},rotateFromAxisAndCenter:function(a,b,c){var d=(new $b.Mat4).makeRotationAxisAndCenter(a,b,c);return this.applyMatrix4(d),this},rotationTowards:function(a,b){var c=(new $b.Mat4).rotationTowards(a,b);return this.setEulerFromRotationMatrix(c),this},constructor:$b.Vec3},ac.__q1=new $b.Quat,$b.Vec4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d!==e?d:1},$b.Vec4.prototype={constructor:$b.Vec4,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setW:function(a){return this.w=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==e?a.w:1,this},add:function(a,b){return b!==e?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},sub:function(a,b){return b!==e?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this.w>a.w&&(this.w=a.w),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this.w<a.w&&(this.w=a.w),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},clone:function(){return new $b.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return 1e-4>b?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g)return this.set(1,0,0,0),this;b=Math.PI;var r=(i+1)/2,s=(m+1)/2,t=(q+1)/2,u=(j+l)/4,v=(k+o)/4,w=(n+p)/4;return r>s&&r>t?f>r?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(r),d=u/c,e=v/c):s>t?f>s?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(s),c=u/d,e=w/d):f>t?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(t),c=v/e,d=w/e),this.set(c,d,e,b),this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));return Math.abs(x)<.001&&(x=1),this.x=(p-n)/x,this.y=(k-o)/x,this.z=(l-j)/x,this.w=Math.acos((i+m+q-1)/2),this}};var bc=function(a,b,c,d,f,g,h,i,j){this.elements=new Float32Array(9),this.set(a!==e?a:1,b||0,c||0,d||0,f!==e?f:1,g||0,h||0,i||0,j!==e?j:1)};bc.prototype={constructor:bc,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]),this},multiplyVector3:function(a){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},multiplyVector3Array:function(){var a=new ac;return function(b){for(var c=0,d=b.length;d>c;c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){var c=a.elements,d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9],d[1]=-c[10]*c[1]+c[2]*c[9],d[2]=c[6]*c[1]-c[2]*c[5],d[3]=-c[10]*c[4]+c[6]*c[8],d[4]=c[10]*c[0]-c[2]*c[8],d[5]=-c[6]*c[0]+c[2]*c[4],d[6]=c[9]*c[4]-c[5]*c[8],d[7]=-c[9]*c[0]+c[1]*c[8],d[8]=c[5]*c[0]-c[1]*c[4];var e=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(0===e){var f="Mat3.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(f);return console.warn(f),this.identity(),this}return this.multiplyScalar(1/e),this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},getNormalMatrix:function(a){return this.getInverse(a).transpose(),this},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},clone:function(){var a=this.elements;return new bc(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}},$b.Mat3=bc;var cc=function(a,b,c,d,f,g,h,i,j,k,l,m,n,o,p,q){this.elements=new Float32Array(16),this.set(a!==e?a:1,b||0,c||0,d||0,f||0,g!==e?g:1,h||0,i||0,j||0,k||0,l!==e?l:1,m||0,n||0,o||0,p||0,q!==e?q:1)};cc.prototype={constructor:cc,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;if(a.length)for(var r=0;r<a.length;r++)q[r]=a[r];else q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]),this},setRotationFromEuler:function(a,b){var c=this.elements,d=a.x,f=a.y,g=a.z,h=Math.cos(d),i=Math.sin(d),j=Math.cos(f),k=Math.sin(f),l=Math.cos(g),m=Math.sin(g);if(b===e||"XYZ"===b){var n=h*l,o=h*m,p=i*l,q=i*m;c[0]=j*l,c[4]=-j*m,c[8]=k,c[1]=o+p*k,c[5]=n-q*k,c[9]=-i*j,c[2]=q-n*k,c[6]=p+o*k,c[10]=h*j}else if("YXZ"===b){var r=j*l,s=j*m,t=k*l,u=k*m;c[0]=r+u*i,c[4]=t*i-s,c[8]=h*k,c[1]=h*m,c[5]=h*l,c[9]=-i,c[2]=s*i-t,c[6]=u+r*i,c[10]=h*j}else if("ZXY"===b){var r=j*l,s=j*m,t=k*l,u=k*m;c[0]=r-u*i,c[4]=-h*m,c[8]=t+s*i,c[1]=s+t*i,c[5]=h*l,c[9]=u-r*i,c[2]=-h*k,c[6]=i,c[10]=h*j}else if("ZYX"===b){var n=h*l,o=h*m,p=i*l,q=i*m;c[0]=j*l,c[4]=p*k-o,c[8]=n*k+q,c[1]=j*m,c[5]=q*k+n,c[9]=o*k-p,c[2]=-k,c[6]=i*j,c[10]=h*j}else if("YZX"===b){var v=h*j,w=h*k,x=i*j,y=i*k;c[0]=j*l,c[4]=y-v*m,c[8]=x*m+w,c[1]=m,c[5]=h*l,c[9]=-i*l,c[2]=-k*l,c[6]=w*m+x,c[10]=v-y*m}else if("XZY"===b){var v=h*j,w=h*k,x=i*j,y=i*k;c[0]=j*l,c[4]=-m,c[8]=k*l,c[1]=v*m+y,c[5]=h*l,c[9]=w*m-x,c[2]=x*m-w,c[6]=i*l,c[10]=y*m+v}return this},setRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),this},lookAt:function(a,b,c){var d=this.elements,e=cc.__v1,f=cc.__v2,g=cc.__v3;return g.subVectors(a,b).normalize(),0===g.length()&&(g.z=1),e.crossVectors(c,g).normalize(),0===e.length()&&(g.x+=1e-4,e.crossVectors(c,g).normalize()),f.crossVectors(g,e),d[0]=e.x,d[1]=e.y,d[2]=e.z,d[4]=f.x,d[5]=f.y,d[6]=f.z,d[8]=g.x,d[9]=g.y,d[10]=g.z,this},multiply:function(a,b){return b!==e?this.multiplyMatrices(a,b):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},multiplyVector3:function(a){return a.applyProjection(this)},multiplyVector4:function(a){return a.applyMatrix4(this)},multiplyVector3Array:function(a){for(var b=cc.__v1,c=0,d=a.length;d>c;c+=3)b.x=a[c],b.y=a[c+1],b.z=a[c+2],b.applyProjection(this),a[c]=b.x,a[c+1]=b.y,a[c+2]=b.z;return a},rotateAxis:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return a.x=c*b[0]+d*b[4]+e*b[8],a.y=c*b[1]+d*b[5]+e*b[9],a.z=c*b[2]+d*b[6]+e*b[10],a.normalize(),a},crossVector:function(a){var b=this.elements,c=new $b.Vector4;return c.x=b[0]*a.x+b[4]*a.y+b[8]*a.z+b[12]*a.w,c.y=b[1]*a.x+b[5]*a.y+b[9]*a.z+b[13]*a.w,c.z=b[2]*a.x+b[6]*a.y+b[10]*a.z+b[14]*a.w,c.w=a.w?b[3]*a.x+b[7]*a.y+b[11]*a.z+b[15]*a.w:1,c},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var a=this.elements;return(new ac).set(a[12],a[13],a[14])},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getColumnX:function(){var a=this.elements;return cc.__v1.set(a[0],a[1],a[2])},getColumnY:function(){var a=this.elements;return cc.__v1.set(a[4],a[5],a[6])},getColumnZ:function(){var a=this.elements;return cc.__v1.set(a[8],a[9],a[10])},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=d[0]*c[0]+d[1]*c[4]+d[2]*c[8]+d[3]*c[12];if(0==u){var v="Mat4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},compose:function(a,b,c){var d=this.elements,e=cc.__m1,f=cc.__m2;return e.identity(),e.setRotationFromQuaternion(b),f.makeScale(c.x,c.y,c.z),this.multiplyMatrices(e,f),d[12]=a.x,d[13]=a.y,d[14]=a.z,this},decompose:function(a,b,c){var d=this.elements,e=cc.__v1,f=cc.__v2,g=cc.__v3;e.set(d[0],d[1],d[2]),f.set(d[4],d[5],d[6]),g.set(d[8],d[9],d[10]),a=a instanceof ac?a:new ac,b=b instanceof $b.Quat?b:new $b.Quat,c=c instanceof ac?c:new ac,c.x=e.length(),c.y=f.length(),c.z=g.length(),a.x=d[12],a.y=d[13],a.z=d[14];var h=cc.__m1;return h.copy(this),h.elements[0]/=c.x,h.elements[1]/=c.x,h.elements[2]/=c.x,h.elements[4]/=c.y,h.elements[5]/=c.y,h.elements[6]/=c.y,h.elements[8]/=c.z,h.elements[9]/=c.z,h.elements[10]/=c.z,b.setFromRotationMatrix(h),[a,b,c]},extractPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractRotation:function(a){var b=this.elements,c=a.elements,d=cc.__v1,e=1/d.set(c[0],c[1],c[2]).length(),f=1/d.set(c[4],c[5],c[6]).length(),g=1/d.set(c[8],c[9],c[10]).length();return b[0]=c[0]*e,b[1]=c[1]*e,b[2]=c[2]*e,b[4]=c[4]*f,b[5]=c[5]*f,b[6]=c[6]*f,b[8]=c[8]*g,b[9]=c[9]*g,b[10]=c[10]*g,this},translate:function(a){var b,c,d,e=this.elements;return a.length?(b=a[0],
c=a[1],d=a[2]):(b=a.x,c=a.y,d=a.z),e[12]=e[0]*b+e[4]*c+e[8]*d+e[12],e[13]=e[1]*b+e[5]*c+e[9]*d+e[13],e[14]=e[2]*b+e[6]*c+e[10]*d+e[14],e[15]=e[3]*b+e[7]*c+e[11]*d+e[15],this},rotateX:function(a){var b=this.elements,c=b[4],d=b[5],e=b[6],f=b[7],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),l=Math.sin(a);return b[4]=k*c+l*g,b[5]=k*d+l*h,b[6]=k*e+l*i,b[7]=k*f+l*j,b[8]=k*g-l*c,b[9]=k*h-l*d,b[10]=k*i-l*e,b[11]=k*j-l*f,this},rotateY:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),l=Math.sin(a);return b[0]=k*c-l*g,b[1]=k*d-l*h,b[2]=k*e-l*i,b[3]=k*f-l*j,b[8]=k*g+l*c,b[9]=k*h+l*d,b[10]=k*i+l*e,b[11]=k*j+l*f,this},rotateZ:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=Math.cos(a),l=Math.sin(a);return b[0]=k*c+l*g,b[1]=k*d+l*h,b[2]=k*e+l*i,b[3]=k*f+l*j,b[4]=k*g-l*c,b[5]=k*h-l*d,b[6]=k*i-l*e,b[7]=k*j-l*f,this},rotateByAxis:function(a,b){var c=this.elements;if(1===a.x&&0===a.y&&0===a.z)return this.rotateX(b);if(0===a.x&&1===a.y&&0===a.z)return this.rotateY(b);if(0===a.x&&0===a.y&&1===a.z)return this.rotateZ(b);var d=a.x,e=a.y,f=a.z,g=Math.sqrt(d*d+e*e+f*f);d/=g,e/=g,f/=g;var h=d*d,i=e*e,j=f*f,k=Math.cos(b),l=Math.sin(b),m=1-k,n=d*e*m,o=d*f*m,p=e*f*m,q=d*l,r=e*l,s=f*l,t=h+(1-h)*k,u=n+s,v=o-r,w=n-s,x=i+(1-i)*k,y=p+q,z=o+r,A=p-q,B=j+(1-j)*k,C=c[0],D=c[1],E=c[2],F=c[3],G=c[4],H=c[5],I=c[6],J=c[7],K=c[8],L=c[9],M=c[10],N=c[11];c[12],c[13],c[14],c[15];return c[0]=t*C+u*G+v*K,c[1]=t*D+u*H+v*L,c[2]=t*E+u*I+v*M,c[3]=t*F+u*J+v*N,c[4]=w*C+x*G+y*K,c[5]=w*D+x*H+y*L,c[6]=w*E+x*I+y*M,c[7]=w*F+x*J+y*N,c[8]=z*C+A*G+B*K,c[9]=z*D+A*H+B*L,c[10]=z*E+A*I+B*M,c[11]=z*F+A*J+B*N,this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,d){var e=c*Math.tan($b.Math.degToRad(.5*a)),f=-e,g=f*b,h=e*b;return this.makeFrustum(g,h,f,e,c,d)},perspectiveFromFieldOfView:function(a,b,c){var d=this,e=d.elements,f=Math.tan(a.upDegrees*Math.PI/180),g=Math.tan(a.downDegrees*Math.PI/180),h=Math.tan(a.leftDegrees*Math.PI/180),i=Math.tan(a.rightDegrees*Math.PI/180),j=2/(h+i),k=2/(f+g);return e[0]=j,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=k,e[6]=0,e[7]=0,e[8]=-((h-i)*j*.5),e[9]=(f-g)*k*.5,e[10]=c/(b-c),e[11]=-1,e[12]=0,e[13]=0,e[14]=c*b/(b-c),e[15]=0,d},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e,k=(b+a)/h,l=(c+d)/i,m=(f+e)/j;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2/i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},clone:function(){var a=this.elements;return new cc(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},getEulerAngles:function(){var a=(new cc).extractRotation(this).elements,b=a[0],c=a[1],d=a[2],e=a[5],f=a[6],g=a[10],h=Math.atan2(f,g),i=Math.atan2(-d,Math.sqrt(b*b+c*c)),j=Math.sin(h),k=Math.cos(h),l=Math.atan2(j*a[8]-k*a[4],k*e-j*a[9]);return new ac(h,i,l)},makeRotationAxisAndCenter:function(a,b,c){var d=Math.cos(b),e=Math.sin(b),f=1-d,g=a.x,h=a.y,i=a.z,j=f*g,k=f*h,l=c.x,m=c.y,n=c.z,o=this,p=new Float32Array(16);return p[0]=j*g+d,p[4]=j*h-e*i,p[8]=j*i+e*h,p[12]=l-l*(j*g+d)-m*(j*h-e*i)-n*(j*i+e*h),p[1]=j*h+e*i,p[5]=k*h+d,p[9]=k*i-e*g,p[13]=m-l*(j*h+e*i)-m*(k*h+d)-n*(k*i-e*g),p[2]=j*i-e*h,p[6]=k*i+e*g,p[10]=f*i*i+d,p[14]=n-l*(j*i-e*h)-m*(k*i+e*g)-n*(f*i*i+d),p[3]=0,p[7]=0,p[11]=0,p[15]=1,o.elements=p,o},rotationTowards:function(a,b){var c=Math.acos(b.dot(a)/b.length()/a.length()),d=(new $b.Vec3).crossVectors(b,a).normalize();return this.makeRotationAxis(d,-c),this},equals:function(a){if(a instanceof cc){for(var b=0;b<this.elements.length;b++)if(Math.abs(this.elements[b]-a.elements[b])>1e-4)return!1;return!0}},fromRotationTranslation:function(a,b){var c=this,d=c.elements,e=a[0],f=a[1],g=a[2],h=a[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k;return d[0]=1-(o+q),d[1]=m+t,d[2]=n-s,d[3]=0,d[4]=m-t,d[5]=1-(l+q),d[6]=p+r,d[7]=0,d[8]=n+s,d[9]=p-r,d[10]=1-(l+o),d[11]=0,d[12]=b[0],d[13]=b[1],d[14]=b[2],d[15]=1,c}},cc.__v1=new ac,cc.__v2=new ac,cc.__v3=new ac,cc.__m1=new cc,cc.__m2=new cc,$b.Mat4=cc,$b.Euler=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._order=d||$b.Euler.DefaultOrder},$b.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],$b.Euler.DefaultOrder="XYZ",$b.Euler.prototype={constructor:$b.Euler,_x:0,_y:0,_z:0,_order:$b.Euler.DefaultOrder,_quaternion:e,_updateQuaternion:function(){this._quaternion!==e&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(a){this._x=a,this._updateQuaternion()},get y(){return this._y},set y(a){this._y=a,this._updateQuaternion()},get z(){return this._z},set z(a){this._z=a,this._updateQuaternion()},get order(){return this._order},set order(a){this._order=a,this._updateQuaternion()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this._updateQuaternion(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._updateQuaternion(),this},setFromRotationMatrix:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];return b=b||this._order,"XYZ"===b?(this._y=Math.asin(c(g)),Math.abs(g)<.99999?(this._x=Math.atan2(-j,m),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0)):"YXZ"===b?(this._x=Math.asin(-c(j)),Math.abs(j)<.99999?(this._y=Math.atan2(g,m),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0)):"ZXY"===b?(this._x=Math.asin(c(l)),Math.abs(l)<.99999?(this._y=Math.atan2(-k,m),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===b?(this._y=Math.asin(-c(k)),Math.abs(k)<.99999?(this._x=Math.atan2(l,m),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i))):"YZX"===b?(this._z=Math.asin(c(h)),Math.abs(h)<.99999?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,m))):"XZY"===b?(this._z=Math.asin(-c(f)),Math.abs(f)<.99999?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,m),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+b),this._order=b,this._updateQuaternion(),this},setFromQuaternion:function(a,b,c){function d(a){return Math.min(Math.max(a,-1),1)}var e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;return b=b||this._order,"XYZ"===b?(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w))),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h+e-f-g)):"YXZ"===b?(this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z))),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g)):"ZXY"===b?(this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z))),this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-e-f+g),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g)):"ZYX"===b?(this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g),this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z))),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g)):"YZX"===b?(this._x=Math.atan2(2*(a.x*a.w-a.z*a.y),h-e+f-g),this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g),this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w)))):"XZY"===b?(this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g),this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+b),this._order=b,c!==!1&&this._updateQuaternion(),this},reorder:function(){var a=new $b.Quat;return function(b){a.setFromEuler(this),this.setFromQuaternion(a,b)}}(),fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==e&&(this._order=a[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},clone:function(){return new $b.Euler(this._x,this._y,this._z,this._order)}},$b.math={},$b.math.Plane=function(a,b){this.normal=a!==e?a:new ac(1,0,0),this.constant=b!==e?b:0},$b.math.Plane.prototype={constructor:$b.math.Plane,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(a,b,c){var d=$b.math.Plane.__v1.subVectors(c,b).cross($b.math.Plane.__v2.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(d,a),this},copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a),d=b||new ac;return d.copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a,b){var c=this.distanceToPoint(a),d=this.distanceToPoint(b);return 0>c&&d>0||0>d&&c>0},isIntersectionFace:function(a,b){var c=[];c.push(b[a.a]),c.push(b[a.b]),c.push(b[a.c]),null!=a.d&&c.push(b[a.d]);var d,e,f,g=[];for(d=0;d<c.length;d++)g.push(this.distanceToPoint(c[d]));for(d=0;d<g.length;d++)if(0==d)e=f=g[d];else{if(f=g[d],0>e&&f>0||0>f&&e>0)return"intersect";e=f}return f>0?"in":"out"},intersectLine:function(a,b,c){var d=c||new ac,f=$b.math.Plane.__v1.subVectors(b,a),g=this.normal.dot(f);if(0==g)return 0==this.distanceToPoint(a)?d.copy(a):e;var h=-(a.dot(this.normal)+this.constant)/g;return 0>h||h>1?e:d.copy(f).multiplyScalar(h).add(a)},coplanarPoint:function(a){var b=a||new ac;return b.copy(this.normal).multiplyScalar(-this.constant)},transform:function(a,b){b=b||(new $b.Mat3).getInverse(a).transpose();var c=$b.math.Plane.__v1.copy(this.normal).applyMatrix3(b),d=this.coplanarPoint($b.math.Plane.__v2);return d.applyMatrix4(a),this.setFromNormalAndCoplanarPoint(c,d),this},translate:function(a){return this.constant=this.constant-a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new $b.math.Plane).copy(this)}},$b.math.Plane.__vZero=new ac(0,0,0),$b.math.Plane.__v1=new ac,$b.math.Plane.__v2=new ac,$b.Frustum=function(a,b,c,d,f,g){this.planes=[a!==e?a:new $b.math.Plane,b!==e?b:new $b.math.Plane,c!==e?c:new $b.math.Plane,d!==e?d:new $b.math.Plane,f!==e?f:new $b.math.Plane,g!==e?g:new $b.math.Plane]},$b.Frustum.prototype={set:function(a,b,c,d,e,f){var g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this},setPoints:function(a){this.points=a},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15];return b[0].setComponents(g-d,k-h,o-l,s-p).normalize(),b[1].setComponents(g+d,k+h,o+l,s+p).normalize(),b[2].setComponents(g+e,k+i,o+m,s+q).normalize(),b[3].setComponents(g-e,k-i,o-m,s-q).normalize(),b[4].setComponents(g-f,k-j,o-n,s-r).normalize(),b[5].setComponents(g+f,k+j,o+n,s+r).normalize(),this},intersectsObjectAccurate:function(a,b){if(0==b)return this.intersectsObject(a);var c,d,e=a.worldMatrix,f=(this.planes,a.vertices),g=[],h=f.length;for(d=0;h>d;d++)if(c=f[d].clone(),c.applyMatrix4(e),g.push(c),this.containsPoint(c))return!0;if(2==b)if(a instanceof $b.Line)for(d=0,h=g.length;h-1>d;d++){var i=g[d],j=g[d+1];if(this.containsLine(i,j))return!0}else{var k,l=a.faces;for(d=0,h=l.length;h>d;d++){if(k=l[d],this.containsLine(g[k.a],g[k.b]))return!0;if(this.containsLine(g[k.b],g[k.c]))return!0;if(null!=k.d){if(this.containsLine(g[k.c],g[k.d]))return!0;if(this.containsLine(g[k.d],g[k.a]))return!0}else if(this.containsLine(g[k.a],g[k.c]))return!0}}return!1},intersectsObject:function(a){var b=a.worldMatrix,c=this.planes,d=b.getPosition();if(!a.computeBoundingSphere)return!1;a.boundingSphere||a.computeBoundingSphere();for(var e=-a.boundingSphere.radius*b.getMaxScaleOnAxis(),f=0;6>f;f++){var g=c[f].distanceToPoint(d);if(e>g)return!1}return!0},intersectsSphere:function(a){for(var b=this.planes,c=a.center,d=-a.radius,e=0;6>e;e++){var f=b[e].distanceToPoint(c);if(d>f)return!1}return!0},intersectsBox:function(a){for(var b=new ac,c=new ac,d=this.planes,e=0;6>e;e++){var f=d[e];b.x=f.normal.x>0?a.min.x:a.max.x,c.x=f.normal.x>0?a.max.x:a.min.x,b.y=f.normal.y>0?a.min.y:a.max.y,c.y=f.normal.y>0?a.max.y:a.min.y,b.z=f.normal.z>0?a.min.z:a.max.z,c.z=f.normal.z>0?a.max.z:a.min.z;var g=f.distanceToPoint(b),h=f.distanceToPoint(c);if(0>g&&0>h)return!1}return!0},containsLine:function(a,b){for(var c=this.planes,d=new ac,e=0;6>e;e++)if(d=c[e].intersectLine(a,b,d),d&&this.containsPoint(d))return!0;return!1},containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(b[c].distanceToPoint(a)<0)return!1;return!0},clone:function(){return(new $b.Frustum).copy(this)}},$b.Ray=function(a,b){this.origin=a!==e?a:new ac,this.direction=b!==e?b:new ac},$b.Ray.prototype={constructor:$b.Ray,set:function(a,b){return this.origin.copy(a),this.direction.copy(b),this},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this},at:function(a,b){var c=b||new ac;return c.copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(a){return this.origin.copy(this.at(a,$b.Ray.__v1)),this},closestPointToPoint:function(a,b){var c=b||new ac;c.subVectors(a,this.origin);var d=c.dot(this.direction);return c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){var b=$b.Ray.__v1.subVectors(a,this.origin).dot(this.direction);return $b.Ray.__v1.copy(this.direction).multiplyScalar(b).add(this.origin),$b.Ray.__v1.distanceTo(a)},isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},isIntersectionPlane:function(a){var b=a.normal.dot(this.direction);return 0!=b?!0:0==a.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:e;var c=-(this.origin.dot(a.normal)+a.constant)/b;return c},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return c===e?e:this.at(c,b)},transform:function(a){return this.direction.add(this.origin).applyMatrix4(a),this.origin.applyMatrix4(a),this.direction.sub(this.origin),this},distanceSqToSegment:function(a,b,c,d){var e,f,g,h,i=a.clone().add(b).multiplyScalar(.5),j=b.clone().sub(a).normalize(),k=.5*a.distanceTo(b),l=this.origin.clone().sub(i),m=-this.direction.dot(j),n=l.dot(this.direction),o=-l.dot(j),p=l.lengthSq(),q=Math.abs(1-m*m);if(q>=0)if(e=m*o-n,f=m*n-o,h=k*q,e>=0)if(f>=-h)if(h>=f){var r=1/q;e*=r,f*=r,g=e*(e+m*f+2*n)+f*(m*e+f+2*o)+p}else f=k,e=Math.max(0,-(m*f+n)),g=-e*e+f*(f+2*o)+p;else f=-k,e=Math.max(0,-(m*f+n)),g=-e*e+f*(f+2*o)+p;else-h>=f?(e=Math.max(0,-(-m*k+n)),f=e>0?-k:Math.min(Math.max(-k,-o),k),g=-e*e+f*(f+2*o)+p):h>=f?(e=0,f=Math.min(Math.max(-k,-o),k),g=f*(f+2*o)+p):(e=Math.max(0,-(m*k+n)),f=e>0?k:Math.min(Math.max(-k,-o),k),g=-e*e+f*(f+2*o)+p);else f=m>0?-k:k,e=Math.max(0,-(m*f+n)),g=-e*e+f*(f+2*o)+p;return c&&c.copy(this.direction.clone().multiplyScalar(e).add(this.origin)),d&&d.copy(j.clone().multiplyScalar(f).add(i)),g},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new $b.Ray).copy(this)}},$b.Ray.__v1=new ac,$b.Ray.__v2=new ac,$b.Triangle=function(a,b,c){this.a=a!==e?a:new ac,this.b=b!==e?b:new ac,this.c=c!==e?c:new ac},$b.Triangle.normal=function(a,b,c,d){var e=d||new ac;e.subVectors(c,b),$b.Triangle.__v0.subVectors(a,b),e.cross($b.Triangle.__v0);var f=e.lengthSq();return f>0?e.multiplyScalar(1/Math.sqrt(f)):e.set(0,0,0)},$b.Triangle.barycoordFromPoint=function(a,b,c,d,e){$b.Triangle.__v0.subVectors(d,b),$b.Triangle.__v1.subVectors(c,b),$b.Triangle.__v2.subVectors(a,b);var f=$b.Triangle.__v0.dot($b.Triangle.__v0),g=$b.Triangle.__v0.dot($b.Triangle.__v1),h=$b.Triangle.__v0.dot($b.Triangle.__v2),i=$b.Triangle.__v1.dot($b.Triangle.__v1),j=$b.Triangle.__v1.dot($b.Triangle.__v2),k=f*i-g*g,l=e||new ac;if(0==k)return l.set(-2,-1,-1);var m=1/k,n=(i*h-g*j)*m,o=(f*j-g*h)*m;return l.set(1-n-o,o,n)},$b.Triangle.containsPoint=function(a,b,c,d){var e=$b.Triangle.barycoordFromPoint(a,b,c,d,$b.Triangle.__v3);return e.x>=0&&e.y>=0&&e.x+e.y<=1},$b.Triangle.prototype={constructor:$b.Triangle,set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this},copy:function(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this},area:function(){return $b.Triangle.__v0.subVectors(this.c,this.b),$b.Triangle.__v1.subVectors(this.a,this.b),.5*$b.Triangle.__v0.cross($b.Triangle.__v1).length()},midpoint:function(a){var b=a||new ac;return b.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return $b.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){var b=a||new $b.math.Plane;return b.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return $b.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return $b.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new $b.Triangle).copy(this)},intersectLine:function(a,b){var c=this.plane(),d=c.intersectLine(a,b);return null!=d&&this.containsPoint(d)}},$b.Triangle.__v0=new ac,$b.Triangle.__v1=new ac,$b.Triangle.__v2=new ac,$b.Triangle.__v3=new ac,$b.Box2=function(a,b){this.min=a!==e?a:new _b(+(1/0),+(1/0)),this.max=b!==e?b:new _b(-(1/0),-(1/0))},$b.Box2.prototype={constructor:$b.Box2,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;c>b;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new _b;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=+(1/0),this.max.x=this.max.y=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){var b=a||new _b;return this.isEmpty()?b.set(0,0):b.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){var b=a||new _b;return this.isEmpty()?b.set(0,0):b.subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){var c=b||new _b;return c.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){var c=b||new _b;return c.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new _b;return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};var dc={getLogicalPoint:function(a,b){var c,d=a.getBoundingClientRect();if(ec.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var e=b.changedTouches[0],f=ec.isAndroid?0:$touch.scrollLeft(),g=ec.isAndroid?0:$touch.scrollTop();c={x:e.clientX+a.scrollLeft-d.left-f,y:e.clientY+a.scrollTop-d.top-g}}else{if(!dc.isValidEvent(a,b))return null;c={x:b.clientX-d.left+a.scrollLeft,y:b.clientY-d.top+a.scrollTop}}return c},isValidEvent:function(a,b){if(!b)return!1;if(b.target===a)if(ec.isFirefox){if(a.clientHeight<a.scrollHeight&&b.layerX<25)return!1;if(a.clientWidth<a.scrollWidth&&b.layerY<25)return!1}else if(b.offsetX>a.clientWidth||b.offsetY>a.clientHeight)return!1;return!0},isImage:function(a){return a&&a.nodeName&&"img"===a.nodeName.toLowerCase()},isCanvas:function(a){return a&&a.nodeName&&"canvas"===a.nodeName.toLowerCase()},createView:function(a,b){var c=document.createElement("div");return c.style.position=tc.VIEW_POSITION,c.style.fontSize=tc.VIEW_FONT_SIZE,c.style.fontFamily=tc.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.style.msTouchAction="none",c.tabIndex=0,b||(c.onmousedown=dc.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null),c.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),a&&(c.style.overflow=a),c},preventDefault:function(a){tc.KEEP_DEFAULT_FUNCTION(a)||(a.preventDefault?a.preventDefault():a.preventManipulation?a.preventManipulation():a.returnValue=!1)},createCanvas:function(a){var b=document.createElement("canvas"),c=a.getView();return b.width=c.width,b.height=c.height,b.style.msTouchAction="none",b.style.position="absolute",b},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},getScrollTop:function(a){if(!a)return 0;var b=a.scrollTop,c=a.parentElement;return b+this.getScrollTop(c)},getScrollLeft:function(a){if(!a)return 0;var b=a.scrollLeft,c=a.parentElement;return b+this.getScrollLeft(c)},debug:function(a,b){try{a.call(b)}catch(c){alert(c)}},setFocus:function(a){if(document.activeElement!==a){var b,c,d,e=document.documentElement;document.body;e&&(ec.isIE||ec.isOpera||e.scrollLeft||e.scrollTop)&&(b=e.scrollLeft,c=e.scrollTop,d=e),a.focus(),d&&(d.scrollLeft=b,d.scrollTop=c)}},isRightClick:function(a){var b;if(!a)var a=d.event;return a.which?b=3==a.which:a.button&&(b=2==a.button),b}};$b.html=dc;var ec=function(){var a={},b=navigator.userAgent.toLowerCase();return a.isOpera=/opera/.test(b),a.isIE=/msie/.test(b)||/trident/.test(b),a.isFirefox=/firefox/i.test(b),a.isChrome=/chrome/i.test(b),a.isSafari=!a.isChrome&&/safari/i.test(b),a.isIPhone=/iphone/.test(b),a.isIPod=/ipod/.test(b),a.isIPad=/ipad/.test(b),a.isAndroid=/android/i.test(b),a.isWebOS=/webos/i.test(b),a.isMSToucheable=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,a.isTouchable="ontouchend"in document||a.isMSToucheable,a.isIOS=a.isIPhone||a.isIPod||a.isIPad,a}();$b.ua=ec,function(){function a(a){var b,d,e,f,g,h;for(e=a.length,d=0,b="";e>d;){if(f=255&a.charCodeAt(d++),d==e){b+=c.charAt(f>>2),b+=c.charAt((3&f)<<4),b+="==";break}if(g=a.charCodeAt(d++),d==e){b+=c.charAt(f>>2),b+=c.charAt((3&f)<<4|(240&g)>>4),b+=c.charAt((15&g)<<2),b+="=";break}h=a.charCodeAt(d++),b+=c.charAt(f>>2),b+=c.charAt((3&f)<<4|(240&g)>>4),b+=c.charAt((15&g)<<2|(192&h)>>6),b+=c.charAt(63&h)}return b}function b(a){var b,c,d,f,g,h,i;for(h=a.length,g=0,i="";h>g;){do b=e[255&a.charCodeAt(g++)];while(h>g&&-1==b);if(-1==b)break;do c=e[255&a.charCodeAt(g++)];while(h>g&&-1==c);if(-1==c)break;i+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(g++),61==d)return i;d=e[d]}while(h>g&&-1==d);if(-1==d)break;i+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(f=255&a.charCodeAt(g++),61==f)return i;f=e[f]}while(h>g&&-1==f);if(-1==f)break;i+=String.fromCharCode((3&d)<<6|f)}return i}var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);d.btoa||(d.btoa=a),d.atob||(d.atob=b)}();var fc=function(){var a=!1,b=document.createElement("canvas");if(b.getContext("2d")&&(a=!0),!a)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var c=!!b.getContext("2d").getImageData,e=!!b.toDataURL,f=!!d.btoa,g=function(a){var b=parseInt(a.width),c=parseInt(a.height);return a.getContext("2d").getImageData(0,0,b,c)},h=function(a){var b="";if("string"==typeof a)b=a;else for(var c=a,d=0;d<c.length;d++)b+=String.fromCharCode(c[d]);return btoa(b)},i=function(a){var b=[],c=a.width,d=a.height;b.push(66),b.push(77);var e=c*d*3+54;b.push(e%256),e=Math.floor(e/256),b.push(e%256),e=Math.floor(e/256),b.push(e%256),e=Math.floor(e/256),b.push(e%256),b.push(0),b.push(0),b.push(0),b.push(0),b.push(54),b.push(0),b.push(0),b.push(0);var f=[];f.push(40),f.push(0),f.push(0),f.push(0);var g=c;f.push(g%256),g=Math.floor(g/256),f.push(g%256),g=Math.floor(g/256),f.push(g%256),g=Math.floor(g/256),f.push(g%256);var i=d;f.push(i%256),i=Math.floor(i/256),f.push(i%256),i=Math.floor(i/256),f.push(i%256),i=Math.floor(i/256),f.push(i%256),f.push(1),f.push(0),f.push(24),f.push(0),f.push(0),f.push(0),f.push(0),f.push(0);var j=c*d*3;f.push(j%256),j=Math.floor(j/256),f.push(j%256),j=Math.floor(j/256),f.push(j%256),j=Math.floor(j/256),f.push(j%256);for(var k=0;16>k;k++)f.push(0);var l=(4-3*c%4)%4,m=a.data,n="",o=d;do{for(var p=c*(o-1)*4,q="",r=0;c>r;r++){var s=4*r;q+=String.fromCharCode(m[p+s+2]),q+=String.fromCharCode(m[p+s+1]),q+=String.fromCharCode(m[p+s])}for(var t=0;l>t;t++)q+=String.fromCharCode(0);n+=q}while(--o);var u=h(b.concat(f))+h(n);return u},j=function(a,b){return"data:"+b+";base64,"+a},k=function(a){var b=document.createElement("img");return b.src=a,b},l=function(a,b,c,d,e){c=c||(b?b.w:a.width),d=d||(b?b.h:a.height);var f=document.createElement("canvas");f.width=c,f.height=d,f.style.width=c+"px",f.style.height=d+"px";var g=f.getContext("2d"),g=f.getContext("2d"),h=a.style.backgroundColor;return h||(h="PNG"===e?"rgba(255,255,255,0.0)":"BMP"===e?"rgba(255,255,255,0.01)":"#FFFFFF"),g.fillStyle=h,g.fillRect(0,0,c,d),b=b?b:{x:0,y:0,w:a.width,h:a.height},g.drawImage(a,b.x,b.y,b.w,b.h,0,0,c,d),f};return{saveAsPNG:function(a,b,c,d,f){if(!e)return!1;var g=l(a,b,d,f,"PNG"),h=g.toDataURL("image/png");return c?k(h):h},saveAsJPEG:function(a,b,c,d,f){if(!e)return!1;var g=l(a,b,d,f,"JPEG"),h="image/jpeg",i=g.toDataURL(h);return 5!=i.indexOf(h)?!1:c?k(i):i},saveAsBMP:function(a,b,d,e,h){if(!c||!f)return!1;var m=l(a,b,e,h,"BMP"),n=g(m),o=i(n);return d?k(j(o,"image/bmp")):j(o,"image/bmp")}}}(),gc={},hc={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(a,b){hc.g.font=a?a:tc.FONT;var c=hc.cache[hc.g.font];return c||(c=2*hc.g.measureText("e").width+4,hc.cache[hc.g.font]=c),{width:hc.g.measureText(b).width+4,height:c}}};gc.g=hc,$b.g=hc;var ic={};setTimeout;ic.bcld=function(a,b,c,d,e,f,g,h,i){var j,k,l=a/2,m=[],n=[],o={vertices:[],faces:[],uvs:[],uv2s:[]};for(k=0;b>=k;k++){var p=[],q=[],r=k/b,s=r*(c-d)+d;for(j=0;e>=j;j++){var t=j/e,u=new ac;u.x=s*Math.sin(t*h+i),u.y=-r*a+l,u.z=s*Math.cos(t*h+i),o.vertices.push(u),p.push(o.vertices.length-1),q.push(new _b(t,1-r))}m.push(p),n.push(q)}var v,w,x=(c-d)/a;for(j=0;e>j;j++)for(0!==d?(v=o.vertices[m[0][j]].clone(),w=o.vertices[m[0][j+1]].clone()):(v=o.vertices[m[1][j]].clone(),w=o.vertices[m[1][j+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*x).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*x).normalize(),k=0;b>k;k++){var y=m[k][j],z=m[k+1][j],A=m[k+1][j+1],B=m[k][j+1],C=v.clone(),D=v.clone(),E=w.clone(),F=w.clone(),G=n[k][j].clone(),H=n[k+1][j].clone(),I=n[k+1][j+1].clone(),J=n[k][j+1].clone();o.faces.push(new qc(y,z,B,[C,D,F],null,0)),o.uvs.push([G,H,J]),o.uv2s.push([G.clone(),H.clone(),J.clone()]),o.faces.push(new qc(z,A,B,[D,E,F],null,0)),o.uvs.push([H,I,J]),o.uv2s.push([H.clone(),I.clone(),J.clone()])}var K=!1;if(f===!1&&d>0)for(o.vertices.push(new ac(0,l,0)),K=!0,j=0;e>j;j++){var y=m[0][j],z=m[0][j+1],A=o.vertices.length-1,C=new ac(0,1,0),D=new ac(0,1,0),E=new ac(0,1,0),L=o.vertices[y],M=o.vertices[z],G=new _b((L.x/d+1)/2,1-(L.z/d+1)/2),H=new _b((M.x/d+1)/2,1-(M.z/d+1)/2),I=new _b(.5,.5);o.faces.push(new qc(y,z,A,[C,D,E],null,1)),o.uvs.push([G,H,I]),o.uv2s.push([G.clone(),H.clone(),I.clone()])}var N=!1;if(g===!1&&c>0)for(o.vertices.push(new ac(0,-l,0)),N=!0,j=0;e>j;j++){var y=m[k][j+1],z=m[k][j],A=o.vertices.length-1,C=new ac(0,-1,0),D=new ac(0,-1,0),E=new ac(0,-1,0),L=o.vertices[y],M=o.vertices[z],G=new _b((L.x/c+1)/2,(L.z/c+1)/2),H=new _b((M.x/c+1)/2,(M.z/c+1)/2),I=new _b(.5,.5);o.faces.push(new qc(y,z,A,[C,D,E],null,2)),o.uvs.push([G,H,I]),o.uv2s.push([G.clone(),H.clone(),I.clone()])}if(h!==2*Math.PI){!K&&o.vertices.push(new ac(0,l,0)),!N&&o.vertices.push(new ac(0,-l,0));var y=m[0][0],z=m[b][0],A=o.vertices.length-1,B=o.vertices.length-2,G=new _b(0,0),H=new _b(0,1),I=new _b(1,1),J=new _b(1,0);o.faces.push(new qc(y,A,z)),o.uvs.push([G,I,H]),o.uv2s.push([G.clone(),I.clone(),H.clone()]),o.faces.push(new qc(B,A,y)),o.uvs.push([J,I,G]),o.uv2s.push([J.clone(),I.clone(),G.clone()]),y=m[0][e],z=m[b][e];var G=new _b(0,0),H=new _b(0,1),I=new _b(1,1),J=new _b(1,0);o.faces.push(new qc(y,z,B)),o.uvs.push([G,H,J]),o.uv2s.push([G.clone(),H.clone(),J.clone()]),o.faces.push(new qc(z,A,B)),o.uvs.push([H,I,J]),o.uv2s.push([H.clone(),I.clone(),J.clone()])}return o},ic.buildCubeData=function(a,b,c,d,e,f,g,h){function i(i){var o,p,q,r,s,t,u,v,w,x;j=k.length;var y,z="six-each"==g||"front-other"==g||"back-other"==g||"left-other"==g||"right-other"==g||"top-other"==g||"bottom-other"==g,A=new _b(0,0),B=z?new _b(1/3,.5):new _b(1,1),C=g.split("-")[0];"six"==C?C=null:B=new _b(.5,1),"right"==i?(o="z",p="y",q="x",r=-1,s=-1,t=a/2,u=c,v=b,w=f,x=e,y=0,A=new _b(2/3,0)):"left"==i?(o="z",p="y",q="x",r=1,s=-1,t=-a/2,u=c,v=b,w=f,x=e,y=1):"top"==i?(o="x",p="z",q="y",r=1,s=1,t=b/2,u=a,v=c,w=d,x=f,y=2,A=new _b(1/3,.5)):"bottom"==i?(o="x",p="z",q="y",r=1,s=-1,t=-b/2,u=a,v=c,w=d,x=f,y=3,A=new _b(0,.5)):"front"==i?(o="x",p="y",q="z",r=1,s=-1,t=c/2,u=a,v=b,w=d,x=e,y=4,A=new _b(1/3,0)):"back"==i&&(o="x",
p="y",q="z",r=-1,s=-1,t=-c/2,u=a,v=b,w=d,x=e,y=5,A=new _b(2/3,.5)),C&&(A=C==i?new _b(0,0):new _b(.5,0));var D,E,F=w+1,G=x+1;for(E=0;G>E;E++)for(D=0;F>D;D++){var H=new ac;H[o]=(D/w*u-u/2)*r+h[o],H[p]=(E/x*v-v/2)*s+h[p],H[q]=t+h[q],k.push(H)}z&&(y=0);var I=new ac;for(I[q]=t>0?1:-1,E=0;x>E;E++)for(D=0;w>D;D++){var J=D+F*E,K=D+F*(E+1),L=D+1+F*(E+1),M=D+1+F*E,N=[new _b(D/w,1-E/x),new _b(D/w,1-(E+1)/x),new _b((D+1)/w,1-(E+1)/x),new _b((D+1)/w,1-E/x)];if(z)for(var O=0;O<N.length;O++)N[O].multiply(B).add(A);var P=new rc(J+j,K+j,L+j,M+j);P.normal.copy(I),P.vertexNormals.push(I.clone(),I.clone(),I.clone(),I.clone()),P.materialIndex=y,l.push(P),m.push([N[0],N[1],N[2],N[3]]),n.push([N[0].clone(),N[1].clone(),N[2].clone(),N[3].clone()])}}var j,k=[],l=[],m=[],n=[];i("right"),i("left"),i("top"),i("bottom"),i("front"),i("back");var o={vertices:k,faces:l,uvs:m,uv2s:n};return o},ic.bsd=function(a,b,c,d,e,f,g){var h,i,j=[],k=[],l=[],m=[],n=[],o=[];for(i=0;c>=i;i++){var p=[],q=[];for(h=0;b>=h;h++){var r=h/b,s=i/c,t=new ac;t.x=-a*Math.cos(d+r*e)*Math.sin(f+s*g),t.y=a*Math.cos(f+s*g),t.z=a*Math.sin(d+r*e)*Math.sin(f+s*g),j.push(t),p.push(j.length-1),q.push(new _b(r,1-s))}n.push(p),o.push(q)}for(i=0;c>i;i++)for(h=0;b>h;h++){var u=n[i][h+1],v=n[i][h],w=n[i+1][h],x=n[i+1][h+1],y=j[u].clone().normalize(),z=j[v].clone().normalize(),A=j[w].clone().normalize(),B=j[x].clone().normalize(),C=o[i][h+1].clone(),D=o[i][h].clone(),E=o[i+1][h].clone(),F=o[i+1][h+1].clone();Math.abs(j[u].y)===a?(l.push(new qc(u,w,x,[y,A,B])),k.push([C,E,F]),m.push([C.clone(),E.clone(),F.clone()])):Math.abs(j[w].y)===a?(l.push(new qc(u,v,w,[y,z,A])),k.push([C,D,E]),m.push([C.clone(),D.clone(),E.clone()])):(l.push(new qc(u,v,x,[y,z,B])),k.push([C,D,F]),m.push([C.clone(),D.clone(),F.clone()]),l.push(new qc(v,w,x,[z.clone(),A,B.clone()])),k.push([D.clone(),E,F.clone()]),m.push([D.clone(),E.clone(),F.clone()]))}return{vertices:j,faces:l,uvs:k,uv2s:m}};var jc=function(a){var b,c,d,f,g,h,i,j={},k=a.primitive;if(k.groups)return a.groups=k.groups,void(a.groupList=k.groupList);k.groups={};var l=a.material,m=a.getMaterialMapping();for(b=0,c=k.faces.length;c>b;b++)d=k.faces[b],f=l instanceof $b.ArrayMaterial?d.materialIndex:0,f=m[f],h=f!==e?f:-1,j[h]===e&&(j[h]={hash:h,counter:0}),i=j[h].hash+"_"+j[h].counter,k.groups[i]===e&&(k.groups[i]={faces3:[],faces4:[],materialIndex:f,vertices:0}),g=d instanceof qc?3:4,k.groups[i].vertices+g>65535&&(j[h].counter+=1,i=j[h].hash+"_"+j[h].counter,k.groups[i]===e&&(k.groups[i]={faces3:[],faces4:[],materialIndex:f,vertices:0})),d instanceof qc?k.groups[i].faces3.push(b):k.groups[i].faces4.push(b),k.groups[i].vertices+=g;k.groupsList=[];for(var n in a.groups)k.groupsList.push(a.groups[n]);a.groups=k.groups,a.groupList=k.groupsList},kc=function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a,u=t,v=u.vertices,w=v.length,x=u.colors,y=x.length,z=u.sizes,A=z.length,B=d.__vertexArray,C=d.__colorArray,D=d.__normalArray,E=d.__sortArray,F=u.verticesNeedUpdate,G=(u.elementsNeedUpdate,u.normalsNeedUpdate),H=u.colorsNeedUpdate,I=u.__webglCustomAttributesList;if(w>A&&(A=w),t.sortParticles){for(_projScreenMatrixPS.copy(_projScreenMatrix),_projScreenMatrixPS.multiply(t.matrixWorld),f=0;w>f;f++)i=v[f],_vector3.copy(i),_vector3.applyProjection(_projScreenMatrixPS),E[f]=[_vector3.z,f];for(E.sort(numericalSort),f=0;w>f;f++)i=v[E[f][1]],j=3*f,B[j]=i.x,B[j+1]=i.y,B[j+2]=i.z;for(g=0;y>g;g++)j=3*g,l=x[E[g][1]],C[j]=l.r,C[j+1]=l.g,C[j+2]=l.b;for(h=0;A>h;h++)j=3*h,m=z[E[h][1]],m=null==m?1:m,D[j]=null==m.x?m||1:m.x,D[j+1]=0,D[j+2]=0;if(I)for(n=0,o=I.length;o>n;n++)if(s=I[n],s.boundTo===e||"vertices"===s.boundTo)if(j=0,q=s.value.length,1===s.size)for(p=0;q>p;p++)k=E[p][1],s.array[p]=s.value[k];else if(2===s.size)for(p=0;q>p;p++)k=E[p][1],r=s.value[k],s.array[j]=r.x,s.array[j+1]=r.y,j+=2;else if(3===s.size)if("c"===s.type)for(p=0;q>p;p++)k=E[p][1],r=s.value[k],s.array[j]=r.r,s.array[j+1]=r.g,s.array[j+2]=r.b,j+=3;else for(p=0;q>p;p++)k=E[p][1],r=s.value[k],s.array[j]=r.x,s.array[j+1]=r.y,s.array[j+2]=r.z,j+=3;else if(4===s.size)for(p=0;q>p;p++)k=E[p][1],r=s.value[k],s.array[j]=r.x,s.array[j+1]=r.y,s.array[j+2]=r.z,s.array[j+3]=r.w,j+=4}else{if(F)for(f=0;w>f;f++)i=v[f],j=3*f,B[j]=i.x,B[j+1]=i.y,B[j+2]=i.z;if(H)for(g=0;y>g;g++)l=x[g],j=3*g,C[j]=l.r,C[j+1]=l.g,C[j+2]=l.b;if(G)for(h=0;A>h;h++)m=null==z[h]?1:z[h],j=3*h,D[j]=null==m.x?m||1:m.x,D[j+1]=0,D[j+2]=0;if(I)for(n=0,o=I.length;o>n;n++)if(s=I[n],s.needsUpdate&&(s.boundTo===e||"vertices"===s.boundTo))if(q=s.value.length,j=0,1===s.size)for(p=0;q>p;p++)s.array[p]=s.value[p];else if(2===s.size)for(p=0;q>p;p++)r=s.value[p],s.array[j]=r.x,s.array[j+1]=r.y,j+=2;else if(3===s.size)if("c"===s.type)for(p=0;q>p;p++)r=s.value[p],s.array[j]=r.r,s.array[j+1]=r.g,s.array[j+2]=r.b,j+=3;else for(p=0;q>p;p++)r=s.value[p],s.array[j]=r.x,s.array[j+1]=r.y,s.array[j+2]=r.z,j+=3;else if(4===s.size)for(p=0;q>p;p++)r=s.value[p],s.array[j]=r.x,s.array[j+1]=r.y,s.array[j+2]=r.z,s.array[j+3]=r.w,j+=4}if((F||t.sortParticles)&&(c.bindBuffer(c.ARRAY_BUFFER,d.__webglVertexBuffer),c.bufferData(c.ARRAY_BUFFER,B,b)),(H||t.sortParticles)&&(c.bindBuffer(c.ARRAY_BUFFER,d.__webglColorBuffer),c.bufferData(c.ARRAY_BUFFER,C,b)),(G||t.sortParticles)&&(c.bindBuffer(c.ARRAY_BUFFER,d.__webglNormalBuffer),c.bufferData(c.ARRAY_BUFFER,D,b)),I)for(n=0,o=I.length;o>n;n++)s=I[n],(s.needsUpdate||t.sortParticles)&&(c.bindBuffer(c.ARRAY_BUFFER,s.buffer),c.bufferData(c.ARRAY_BUFFER,s.array,b))};ic.buildGroupBufferData=function(a,b,c,d,f,g,h,i){var j="basic"==f._type?!1:!0,k=f.isVertexColor(),l=f.needUV();j=!0;var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=i.needSmoothNormal(b,f),M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=h.__vertexArray,X=h.__uvArray,Y=h.__uv2Array,Z=h.__normalArray,$=h.__colorArray,_=h.__webglCustomAttributesList,aa=h.__faceArray,ba=h.__lineArray,ca=b,da=ca.verticesNeedUpdate,ea=ca.elementsNeedUpdate,fa=ca.uvsNeedUpdate,ga=ca.normalsNeedUpdate,ha=ca.colorsNeedUpdate,ia=ca.vertices,ja=a.faces3,ka=a.faces4,la=ca.faces,ma=ca.colors,na=ca.uvs,oa=ca.uv2s;ca.colors;if(null!=h.__vao&&(h.__vao.dirty=!0),da){for(m=0,n=ja.length;n>m;m++)p=la[ja[m]],w=ia[p.a],x=ia[p.b],y=ia[p.c],W[N]=w.x,W[N+1]=w.y,W[N+2]=w.z,W[N+3]=x.x,W[N+4]=x.y,W[N+5]=x.z,W[N+6]=y.x,W[N+7]=y.y,W[N+8]=y.z,N+=9;for(m=0,n=ka.length;n>m;m++)p=la[ka[m]],w=ia[p.a],x=ia[p.b],y=ia[p.c],z=ia[p.d],W[N]=w.x,W[N+1]=w.y,W[N+2]=w.z,W[N+3]=x.x,W[N+4]=x.y,W[N+5]=x.z,W[N+6]=y.x,W[N+7]=y.y,W[N+8]=y.z,W[N+9]=z.x,W[N+10]=z.y,W[N+11]=z.z,N+=12;g.bindBuffer(g.ARRAY_BUFFER,h.__webglVertexBuffer),g.bufferData(g.ARRAY_BUFFER,W,c),h.__vertexArray=W}if(ha&&k){for(m=0,n=ja.length;n>m;m++)p=la[ja[m]],s=p.vertexColors,ma&&ma.length>0&&(s[0]=ma[p.a],s[1]=ma[p.b],s[2]=ma[p.c]),t=p.color,3===s.length&&k===$b.VertexColors?(A=s[0],B=s[1],C=s[2]):(A=t,B=t,C=t),$[T]=A.r,$[T+1]=A.g,$[T+2]=A.b,$[T+3]=B.r,$[T+4]=B.g,$[T+5]=B.b,$[T+6]=C.r,$[T+7]=C.g,$[T+8]=C.b,T+=9;for(m=0,n=ka.length;n>m;m++)p=la[ka[m]],s=p.vertexColors,t=p.color,4===s.length&&k===$b.VertexColors?(A=s[0],B=s[1],C=s[2],D=s[3]):(A=t,B=t,C=t,D=t),$[T]=A.r,$[T+1]=A.g,$[T+2]=A.b,$[T+3]=B.r,$[T+4]=B.g,$[T+5]=B.b,$[T+6]=C.r,$[T+7]=C.g,$[T+8]=C.b,$[T+9]=D.r,$[T+10]=D.g,$[T+11]=D.b,T+=12;T>0&&(g.bindBuffer(g.ARRAY_BUFFER,h.__webglColorBuffer),g.bufferData(g.ARRAY_BUFFER,$,c))}if(ga&&j){for(m=0,n=ja.length;n>m;m++)if(p=la[ja[m]],q=p.vertexNormals,r=p.normal,3===q.length&&L)for(E=0;3>E;E++)G=q[E],Z[R]=G.x,Z[R+1]=G.y,Z[R+2]=G.z,R+=3;else for(E=0;3>E;E++)Z[R]=r.x,Z[R+1]=r.y,Z[R+2]=r.z,R+=3;for(m=0,n=ka.length;n>m;m++)if(p=la[ka[m]],q=p.vertexNormals,r=p.normal,4===q.length&&L)for(E=0;4>E;E++)G=q[E],null==Z&&console.log("normal array is null"),Z[R]=G.x,Z[R+1]=G.y,Z[R+2]=G.z,R+=3;else for(E=0;4>E;E++)Z[R]=r.x,Z[R+1]=r.y,Z[R+2]=r.z,R+=3;g.bindBuffer(g.ARRAY_BUFFER,h.__webglNormalBuffer),g.bufferData(g.ARRAY_BUFFER,Z,c),h.__normalArray=Z}if(fa&&na&&l){for(m=0,n=ja.length;n>m;m++)if(o=ja[m],u=na[o],u!==e)for(E=0;3>E;E++)H=u[E],X[O]=H.x,X[O+1]=H.y,O+=2;for(m=0,n=ka.length;n>m;m++)if(o=ka[m],u=na[o],u!==e)for(E=0;4>E;E++)H=u[E],X[O]=H.x,X[O+1]=H.y,O+=2;O>0&&(g.bindBuffer(g.ARRAY_BUFFER,h.__webglUVBuffer),g.bufferData(g.ARRAY_BUFFER,X,c),h.uvArray=X)}if(fa&&oa&&l){for(m=0,n=ja.length;n>m;m++)if(o=ja[m],v=oa[o],v!==e)for(E=0;3>E;E++)I=v[E],Y[P]=I.x,Y[P+1]=I.y,P+=2;for(m=0,n=ka.length;n>m;m++)if(o=ka[m],v=oa[o],v!==e)for(E=0;4>E;E++)I=v[E],Y[P]=I.x,Y[P+1]=I.y,P+=2;P>0&&(g.bindBuffer(g.ARRAY_BUFFER,h.__webglUV2Buffer),g.bufferData(g.ARRAY_BUFFER,Y,c))}if(ea){for(m=0,n=ja.length;n>m;m++)aa[Q]=M,aa[Q+1]=M+1,aa[Q+2]=M+2,Q+=3,ba[S]=M,ba[S+1]=M+1,ba[S+2]=M,ba[S+3]=M+2,ba[S+4]=M+1,ba[S+5]=M+2,S+=6,M+=3;for(m=0,n=ka.length;n>m;m++)aa[Q]=M,aa[Q+1]=M+1,aa[Q+2]=M+3,aa[Q+3]=M+1,aa[Q+4]=M+2,aa[Q+5]=M+3,Q+=6,ba[S]=M,ba[S+1]=M+1,ba[S+2]=M,ba[S+3]=M+3,ba[S+4]=M+1,ba[S+5]=M+2,ba[S+6]=M+2,ba[S+7]=M+3,S+=8,M+=4;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h.__webglFaceBuffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,aa,c),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h.__webglLineBuffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,ba,c),h.__lineArray=ba}if(_)for(E=0,F=_.length;F>E;E++)if(K=_[E],K.__original.needsUpdate){if(U=0,V=0,1===K.size){if(K.boundTo===e||"vertices"===K.boundTo){for(m=0,n=ja.length;n>m;m++)p=la[ja[m]],K.array[U]=K.value[p.a],K.array[U+1]=K.value[p.b],K.array[U+2]=K.value[p.c],U+=3;for(m=0,n=ka.length;n>m;m++)p=la[ka[m]],K.array[U]=K.value[p.a],K.array[U+1]=K.value[p.b],K.array[U+2]=K.value[p.c],K.array[U+3]=K.value[p.d],U+=4}else if("faces"===K.boundTo){for(m=0,n=ja.length;n>m;m++)J=K.value[ja[m]],K.array[U]=J,K.array[U+1]=J,K.array[U+2]=J,U+=3;for(m=0,n=ka.length;n>m;m++)J=K.value[ka[m]],K.array[U]=J,K.array[U+1]=J,K.array[U+2]=J,K.array[U+3]=J,U+=4}}else if(2===K.size){if(K.boundTo===e||"vertices"===K.boundTo){for(m=0,n=ja.length;n>m;m++)p=la[ja[m]],w=K.value[p.a],x=K.value[p.b],y=K.value[p.c],K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=x.x,K.array[U+3]=x.y,K.array[U+4]=y.x,K.array[U+5]=y.y,U+=6;for(m=0,n=ka.length;n>m;m++)p=la[ka[m]],w=K.value[p.a],x=K.value[p.b],y=K.value[p.c],z=K.value[p.d],K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=x.x,K.array[U+3]=x.y,K.array[U+4]=y.x,K.array[U+5]=y.y,K.array[U+6]=z.x,K.array[U+7]=z.y,U+=8}else if("faces"===K.boundTo){for(m=0,n=ja.length;n>m;m++)J=K.value[ja[m]],w=J,x=J,y=J,K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=x.x,K.array[U+3]=x.y,K.array[U+4]=y.x,K.array[U+5]=y.y,U+=6;for(m=0,n=ka.length;n>m;m++)J=K.value[ka[m]],w=J,x=J,y=J,z=J,K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=x.x,K.array[U+3]=x.y,K.array[U+4]=y.x,K.array[U+5]=y.y,K.array[U+6]=z.x,K.array[U+7]=z.y,U+=8}}else if(3===K.size){var pa;if(pa="c"===K.type?["r","g","b"]:["x","y","z"],K.boundTo===e||"vertices"===K.boundTo){for(m=0,n=ja.length;n>m;m++)p=la[ja[m]],w=K.value[p.a],x=K.value[p.b],y=K.value[p.c],K.array[U]=w[pa[0]],K.array[U+1]=w[pa[1]],K.array[U+2]=w[pa[2]],K.array[U+3]=x[pa[0]],K.array[U+4]=x[pa[1]],K.array[U+5]=x[pa[2]],K.array[U+6]=y[pa[0]],K.array[U+7]=y[pa[1]],K.array[U+8]=y[pa[2]],U+=9;for(m=0,n=ka.length;n>m;m++)p=la[ka[m]],w=K.value[p.a],x=K.value[p.b],y=K.value[p.c],z=K.value[p.d],K.array[U]=w[pa[0]],K.array[U+1]=w[pa[1]],K.array[U+2]=w[pa[2]],K.array[U+3]=x[pa[0]],K.array[U+4]=x[pa[1]],K.array[U+5]=x[pa[2]],K.array[U+6]=y[pa[0]],K.array[U+7]=y[pa[1]],K.array[U+8]=y[pa[2]],K.array[U+9]=z[pa[0]],K.array[U+10]=z[pa[1]],K.array[U+11]=z[pa[2]],U+=12}else if("faces"===K.boundTo){for(m=0,n=ja.length;n>m;m++)J=K.value[ja[m]],w=J,x=J,y=J,K.array[U]=w[pa[0]],K.array[U+1]=w[pa[1]],K.array[U+2]=w[pa[2]],K.array[U+3]=x[pa[0]],K.array[U+4]=x[pa[1]],K.array[U+5]=x[pa[2]],K.array[U+6]=y[pa[0]],K.array[U+7]=y[pa[1]],K.array[U+8]=y[pa[2]],U+=9;for(m=0,n=ka.length;n>m;m++)J=K.value[ka[m]],w=J,x=J,y=J,z=J,K.array[U]=w[pa[0]],K.array[U+1]=w[pa[1]],K.array[U+2]=w[pa[2]],K.array[U+3]=x[pa[0]],K.array[U+4]=x[pa[1]],K.array[U+5]=x[pa[2]],K.array[U+6]=y[pa[0]],K.array[U+7]=y[pa[1]],K.array[U+8]=y[pa[2]],K.array[U+9]=z[pa[0]],K.array[U+10]=z[pa[1]],K.array[U+11]=z[pa[2]],U+=12}else if("faceVertices"===K.boundTo){for(m=0,n=ja.length;n>m;m++)J=K.value[ja[m]],w=J[0],x=J[1],y=J[2],K.array[U]=w[pa[0]],K.array[U+1]=w[pa[1]],K.array[U+2]=w[pa[2]],K.array[U+3]=x[pa[0]],K.array[U+4]=x[pa[1]],K.array[U+5]=x[pa[2]],K.array[U+6]=y[pa[0]],K.array[U+7]=y[pa[1]],K.array[U+8]=y[pa[2]],U+=9;for(m=0,n=ka.length;n>m;m++)J=K.value[ka[m]],w=J[0],x=J[1],y=J[2],z=J[3],K.array[U]=w[pa[0]],K.array[U+1]=w[pa[1]],K.array[U+2]=w[pa[2]],K.array[U+3]=x[pa[0]],K.array[U+4]=x[pa[1]],K.array[U+5]=x[pa[2]],K.array[U+6]=y[pa[0]],K.array[U+7]=y[pa[1]],K.array[U+8]=y[pa[2]],K.array[U+9]=z[pa[0]],K.array[U+10]=z[pa[1]],K.array[U+11]=z[pa[2]],U+=12}}else if(4===K.size)if(K.boundTo===e||"vertices"===K.boundTo){for(m=0,n=ja.length;n>m;m++)p=la[ja[m]],w=K.value[p.a],x=K.value[p.b],y=K.value[p.c],K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=w.z,K.array[U+3]=w.w,K.array[U+4]=x.x,K.array[U+5]=x.y,K.array[U+6]=x.z,K.array[U+7]=x.w,K.array[U+8]=y.x,K.array[U+9]=y.y,K.array[U+10]=y.z,K.array[U+11]=y.w,U+=12;for(m=0,n=ka.length;n>m;m++)p=la[ka[m]],w=K.value[p.a],x=K.value[p.b],y=K.value[p.c],z=K.value[p.d],K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=w.z,K.array[U+3]=w.w,K.array[U+4]=x.x,K.array[U+5]=x.y,K.array[U+6]=x.z,K.array[U+7]=x.w,K.array[U+8]=y.x,K.array[U+9]=y.y,K.array[U+10]=y.z,K.array[U+11]=y.w,K.array[U+12]=z.x,K.array[U+13]=z.y,K.array[U+14]=z.z,K.array[U+15]=z.w,U+=16}else if("faces"===K.boundTo){for(m=0,n=ja.length;n>m;m++)J=K.value[ja[m]],w=J,x=J,y=J,K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=w.z,K.array[U+3]=w.w,K.array[U+4]=x.x,K.array[U+5]=x.y,K.array[U+6]=x.z,K.array[U+7]=x.w,K.array[U+8]=y.x,K.array[U+9]=y.y,K.array[U+10]=y.z,K.array[U+11]=y.w,U+=12;for(m=0,n=ka.length;n>m;m++)J=K.value[ka[m]],w=J,x=J,y=J,z=J,K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=w.z,K.array[U+3]=w.w,K.array[U+4]=x.x,K.array[U+5]=x.y,K.array[U+6]=x.z,K.array[U+7]=x.w,K.array[U+8]=y.x,K.array[U+9]=y.y,K.array[U+10]=y.z,K.array[U+11]=y.w,K.array[U+12]=z.x,K.array[U+13]=z.y,K.array[U+14]=z.z,K.array[U+15]=z.w,U+=16}else if("faceVertices"===K.boundTo){for(m=0,n=ja.length;n>m;m++)J=K.value[ja[m]],w=J[0],x=J[1],y=J[2],K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=w.z,K.array[U+3]=w.w,K.array[U+4]=x.x,K.array[U+5]=x.y,K.array[U+6]=x.z,K.array[U+7]=x.w,K.array[U+8]=y.x,K.array[U+9]=y.y,K.array[U+10]=y.z,K.array[U+11]=y.w,U+=12;for(m=0,n=ka.length;n>m;m++)J=K.value[ka[m]],w=J[0],x=J[1],y=J[2],z=J[3],K.array[U]=w.x,K.array[U+1]=w.y,K.array[U+2]=w.z,K.array[U+3]=w.w,K.array[U+4]=x.x,K.array[U+5]=x.y,K.array[U+6]=x.z,K.array[U+7]=x.w,K.array[U+8]=y.x,K.array[U+9]=y.y,K.array[U+10]=y.z,K.array[U+11]=y.w,K.array[U+12]=z.x,K.array[U+13]=z.y,K.array[U+14]=z.z,K.array[U+15]=z.w,U+=16}g.bindBuffer(g.ARRAY_BUFFER,K.buffer),g.bufferData(g.ARRAY_BUFFER,K.array,c)}d&&ic.deleteGroupBufferData(a)},ic.buildLineBufferData=function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r=a,s=r.vertices,t=r.colors,u=r.lineDistances,v=s.length,w=t.length,x=u.length,y=d.__vertexArray,z=d.__colorArray,A=d.__lineDistanceArray,B=r.verticesNeedUpdate,C=r.colorsNeedUpdate,D=r.lineDistancesNeedUpdate,E=r.__webglCustomAttributesList;if(B){for(f=0;v>f;f++)i=s[f],j=3*f,y[j]=i.x,y[j+1]=i.y,y[j+2]=i.z;c.bindBuffer(c.ARRAY_BUFFER,d.__webglVertexBuffer),c.bufferData(c.ARRAY_BUFFER,y,b)}if(C){for(g=0;w>g;g++)k=t[g],j=3*g,z[j]=k.r,z[j+1]=k.g,z[j+2]=k.b;c.bindBuffer(c.ARRAY_BUFFER,d.__webglColorBuffer),c.bufferData(c.ARRAY_BUFFER,z,b)}if(D){for(h=0;x>h;h++)A[h]=u[h];c.bindBuffer(c.ARRAY_BUFFER,d.__webglLineDistanceBuffer),c.bufferData(c.ARRAY_BUFFER,A,b)}if(E)for(l=0,m=E.length;m>l;l++)if(q=E[l],q.needsUpdate&&(q.boundTo===e||"vertices"===q.boundTo)){if(j=0,o=q.value.length,1===q.size)for(n=0;o>n;n++)q.array[n]=q.value[n];else if(2===q.size)for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.x,q.array[j+1]=p.y,j+=2;else if(3===q.size)if("c"===q.type)for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.r,q.array[j+1]=p.g,q.array[j+2]=p.b,j+=3;else for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.x,q.array[j+1]=p.y,q.array[j+2]=p.z,j+=3;else if(4===q.size)for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.x,q.array[j+1]=p.y,q.array[j+2]=p.z,q.array[j+3]=p.w,j+=4;c.bindBuffer(c.ARRAY_BUFFER,q.buffer),c.bufferData(c.ARRAY_BUFFER,q.array,b)}},ic.buildLineBufferData=function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r=a,s=r.vertices,t=r.colors,u=r.lineDistances,v=s.length,w=t.length,x=u.length,y=d.__vertexArray,z=d.__colorArray,A=d.__lineDistanceArray,B=r.verticesNeedUpdate,C=r.colorsNeedUpdate,D=r.lineDistancesNeedUpdate,E=r.__webglCustomAttributesList;if(B){for(f=0;v>f;f++)i=s[f],j=3*f,y[j]=i.x,y[j+1]=i.y,y[j+2]=i.z;c.bindBuffer(c.ARRAY_BUFFER,d.__webglVertexBuffer),c.bufferData(c.ARRAY_BUFFER,y,b)}if(C){for(g=0;w>g;g++)k=t[g],j=3*g,z[j]=k.r,z[j+1]=k.g,z[j+2]=k.b;c.bindBuffer(c.ARRAY_BUFFER,d.__webglColorBuffer),c.bufferData(c.ARRAY_BUFFER,z,b)}if(D){for(h=0;x>h;h++)A[h]=u[h];c.bindBuffer(c.ARRAY_BUFFER,d.__webglLineDistanceBuffer),c.bufferData(c.ARRAY_BUFFER,A,b)}if(E)for(l=0,m=E.length;m>l;l++)if(q=E[l],q.needsUpdate&&(q.boundTo===e||"vertices"===q.boundTo)){if(j=0,o=q.value.length,1===q.size)for(n=0;o>n;n++)q.array[n]=q.value[n];else if(2===q.size)for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.x,q.array[j+1]=p.y,j+=2;else if(3===q.size)if("c"===q.type)for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.r,q.array[j+1]=p.g,q.array[j+2]=p.b,j+=3;else for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.x,q.array[j+1]=p.y,q.array[j+2]=p.z,j+=3;else if(4===q.size)for(n=0;o>n;n++)p=q.value[n],q.array[j]=p.x,q.array[j+1]=p.y,q.array[j+2]=p.z,q.array[j+3]=p.w,j+=4;c.bindBuffer(c.ARRAY_BUFFER,q.buffer),c.bufferData(c.ARRAY_BUFFER,q.array,b)}},ic.deleteGroupBufferData=function(a){delete a.__inittedArrays,delete a.__colorArray,delete a.__normalArray,delete a.__uvArray,delete a.__uv2Array,delete a.__faceArray,delete a.__vertexArray,delete a.__lineArray},ic.getMaterial=function(a,b){var c=a.material;return c instanceof $b.ArrayMaterial?(b>c.materials.length-1&&(b=c.materials.length-1),c.materials[b]):c},$b.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase(),c=this;c.faces[b]=c.faces[b]||{},c.faces[b][a.cssFontWeight]=c.faces[b][a.cssFontWeight]||{},c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return a},drawText:function(a){var b,c=this.getFace(),d=this.size/c.resolution,e=0,f=String(a).split(""),g=f.length,h=[];for(b=0;g>b;b++){var i=new $b.Path,j=this.extractGlyphPoints(f[b],c,d,e,i);e+=j.offset,h.push(j.path)}var k,l,m,n=e/2;for(b=0;g>b;b++){var i=h[b];for(m=0;m<i.actions.length;m++){var k=i.actions[m].args;for(l=0;l<k.length;l++)l%3===0&&(k[l]-=n)}}return{paths:h,offset:n}},extractGlyphPoints:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=[],A=b.glyphs[a]||b.glyphs["?"],B=0;if(A){if(A.o)for(j=A._cachedOutline||(A._cachedOutline=A.o.split(" ")),l=j.length,m=c,n=c,g=0;l>g;)switch(k=j[g++]){case"m":o=j[g++]*m+d,p=j[g++]*n-B,e.moveTo(o,p,0);break;case"l":o=j[g++]*m+d,p=j[g++]*n-B,e.lineTo(o,p,0);break;case"q":if(q=j[g++]*m+d,r=j[g++]*n-B,u=j[g++]*m+d,v=j[g++]*n-B,e.quadraticCurveTo(u,v,0,q,r,0),y=z[z.length-1],y)for(s=y.x,t=y.y,h=1,i=this.divisions;i>=h;h++){var C=h/i;$b.Shape.Utils.b2(C,s,u,q),$b.Shape.Utils.b2(C,t,v,r)}break;case"b":if(q=j[g++]*m+d,r=j[g++]*n-B,u=j[g++]*m+d,v=j[g++]*-n-B,w=j[g++]*m+d,x=j[g++]*-n-B,e.bezierCurveTo(q,r,0,u,v,0,w,x,0),y=z[z.length-1],y)for(s=y.x,t=y.y,h=1,i=this.divisions;i>=h;h++){var C=h/i;$b.Shape.Utils.b3(C,s,u,w,q),$b.Shape.Utils.b3(C,t,v,x,r)}}return{offset:A.ha*c,path:e}}}},$b.FontUtils.generateShapes=function(a,b){b=b||{};var c=b.size!==e?b.size:100,d=b.curveSegments!==e?b.curveSegments:4,f=b.font!==e?b.font:"helvetiker",g=b.weight!==e?b.weight:"normal",h=b.style!==e?b.style:"normal";$b.FontUtils.size=c,$b.FontUtils.divisions=d,$b.FontUtils.face=f,$b.FontUtils.weight=g,$b.FontUtils.style=h;for(var i=$b.FontUtils.drawText(a),j=i.paths,k=[],l=0,m=j.length;m>l;l++)Array.prototype.push.apply(k,j[l].toShapes());return k},function(a){var b=1e-10,c=function(a,b){var c=a.length;if(3>c)return null;var f,g,h,i=[],j=[],k=[];if(d(a)>0)for(g=0;c>g;g++)j[g]=g;else for(g=0;c>g;g++)j[g]=c-1-g;var l=c,m=2*l;for(g=l-1;l>2;){if(m--<=0)return console.log("Warning, unable to triangulate polygon!"),b?k:i;if(f=g,f>=l&&(f=0),g=f+1,g>=l&&(g=0),h=g+1,h>=l&&(h=0),e(a,f,g,h,l,j)){var n,o,p,q,r;for(n=j[f],o=j[g],p=j[h],i.push([a[n],a[o],a[p]]),k.push([j[f],j[g],j[h]]),q=g,r=g+1;l>r;q++,r++)j[q]=j[r];l--,m=2*l}}return b?k:i},d=function(a){for(var b=a.length,c=0,d=b-1,e=0;b>e;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},e=function(a,c,d,e,f,g){var h,i,j,k,l,m,n,o,p;if(i=a[g[c]].x,j=a[g[c]].y,k=a[g[d]].x,l=a[g[d]].y,m=a[g[e]].x,n=a[g[e]].y,b>(k-i)*(n-j)-(l-j)*(m-i))return!1;var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(q=m-k,r=n-l,s=i-m,t=j-n,u=k-i,v=l-j,h=0;f>h;h++)if(h!==c&&h!==d&&h!==e&&(o=a[g[h]].x,p=a[g[h]].y,w=o-i,x=p-j,y=o-k,z=p-l,A=o-m,B=p-n,E=q*z-r*y,C=u*x-v*w,D=s*B-t*A,E>=-b&&D>=-b&&C>=-b))return!1;return!0};return a.Triangulate=c,a.Triangulate.area=d,a}($b.FontUtils),self._typeface_js={faces:$b.FontUtils.faces,loadFace:$b.FontUtils.loadFace},$b.typeface_js=self._typeface_js;var lc={easeNone:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},elasticOut:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},elasticBoth:function(a,b,c,d,e,f){var g;return 0===a?b:2===(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},backIn:function(a,b,c,d,f){return f===e&&(f=1.70158),a===d&&(a-=.001),c*(a/=d)*a*((f+1)*a-f)+b},backOut:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return"undefined"==typeof e&&(e=5.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-lc.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return d/2>a?.5*lc.bounceIn(2*a,0,c,d)+b:.5*lc.bounceOut(2*a-d,0,c,d)+.5*c+b}},mc=function(){if(this._as=[],1===arguments.length){var a=arguments[0];if(a instanceof mc&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this._as.push(a[c]);else null!=a&&this._as.push(a)}else if(arguments.length>1)for(b=arguments.length,c=0;b>c;c++)this._as.push(arguments[c])};$b.List=mc,$b.extend($b.List,Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(a,b){return b===e?this._as.push(a):this._as.splice(b,0,a)},addAll:function(a){if(a instanceof mc&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this._as.push(a[c]);else this._as.push(a)},get:function(a){return this._as[a]},remove:function(a){var b=this._as.indexOf(a);return b>=0&&b<this._as.length&&this.removeAt(b),b},removeAt:function(a){return this._as.splice(a,1)[0]},set:function(a,b){return this._as[a]=b},clear:function(){return this._as.splice(0,this._as.length)},contains:function(a){return this.indexOf(a)>=0},indexOf:function(a){return this._as.indexOf(a)},forEach:function(a,b){for(var c=this._as.length,d=0;c>d;d++){var e=this._as[d];b?a.call(b,e):a(e)}},forEachReverse:function(a,b){for(var c=this._as.length,d=c-1;d>=0;d--){var e=this._as[d];b?a.call(b,e):a(e)}},toArray:function(a,b){if(a){for(var c=[],d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.push(f):a(f)&&c.push(f)}return c}return this._as.concat()},toList:function(a,b){if(a){for(var c=new mc,d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.add(f):a(f)&&c.add(f)}return c}return new mc(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}}),$b.ImageCache=function(){};var nc=$b.ImageCache;nc.AlarmBillboardImage=new Image,nc.AlarmBillboardImage.src="data:image/png;base64,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",
nc.Logo=new Image,nc.Logo.src="data:image/png;base64,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",
$b.ImageUtils={},$b.ImageUtils.registerDefaultImage=function(a){null!=a.src?nc.Logo.src=a.src:nc.Logo.src=a},$b.ImageUtils.registerAlarmImage=function(a){null!=a.src?nc.AlarmBillboardImage.src=a.src:nc.AlarmBillboardImage.src=a},nc.ssaoNormalImage=new Image,nc.ssaoNormalImage.src="data:image/png;base64,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",nc.ssaoNormalImage.loaded=!0,$b.EventDispatcher=function(){this.listeners={}},$b.extend($b.EventDispatcher,null,{constructor:$b.EventDispatcher,addEventListener:function(a,b){this.listeners[a]===e&&(this.listeners[a]=[]),-1===this.listeners[a].indexOf(b)&&this.listeners[a].push(b)},removeEventListener:function(a,b){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)},dispatchEvent:function(a){var b=this.listenters[a.type];if(b!=e){a.target=this;for(var c=0;c<b.length;c++){var d=b[c];d.call(this,a)}}},contains:function(a,b){if(this._ls)for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),a===c.l&&b===c.s)return!0;return!1},add:function(a,b,c){if(null==a)return void console.error("TGL.EventDispatcher#add:listener is null");var d={l:a,s:b,a:c};this._ls||(this._ls=new mc),this._f?(this._addPendings||(this._addPendings=new mc),this._addPendings.add(d)):d.a?this._ls.add(d,0):this._ls.add(d)},remove:function(a,b){this._ls&&(this._f?(this._removePendings||(this._removePendings=new mc),this._removePendings.add({l:a,s:b})):this._remove(a,b))},_remove:function(a,b){for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),c.l===a&&c.s===b)return void this._ls.removeAt(d)},fire:function(a){if(this._ls){var b,c,d=this._ls.size();for(this._f=!0,b=0;d>b;b++)c=this._ls.get(b),c.s?c.l.call(c.s,a):c.l(a);if(this._f=!1,this._removePendings){for(d=this._removePendings.size(),b=0;d>b;b++)c=this._removePendings.get(b),this._remove(c.l,c.s);delete this._removePendings}if(this._addPendings){for(d=this._addPendings.size(),b=0;d>b;b++)c=this._addPendings.get(b),c.a?this._ls.add(c,0):this._ls.add(c);delete this._addPendings}}}}),$b.PropertyChangeDispatcher=function(){this._dispatcher=new $b.EventDispatcher},$b.extend($b.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(a,b,c){this._dispatcher.add(a,b,c)},removePropertyChangeListener:function(a,b){this._dispatcher.remove(a,b)},firePropertyChange:function(a,b,c){if(b==c)return!1;var d={property:a,oldValue:b,newValue:c,source:this};return this._dispatcher.fire(d),this.onPropertyChanged(d),!0},onPropertyChanged:function(a){}}),$b.Texture=function(a,b,c,d,f,g,h,i,j){$b.PropertyChangeDispatcher.call(this),this.id=$b.TextureIdCount++,this.name="",null!=a&&this.setImage(a),this.mipmaps=[],this.mapping=b!==e?b:new $b.UVMapping,this.wrapS=c!==e?c:$b.RepeatWrapping,this.wrapT=d!==e?d:$b.RepeatWrapping,this.magFilter=f!==e?f:$b.LinearFilter,this.minFilter=g!==e?g:$b.LinearMipMapLinearFilter,this.anisotropy=j!==e?j:1,this.format=h!==e?h:$b.RGBAFormat,this.type=i!==e?i:$b.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},$b.extend($b.Texture,$b.PropertyChangeDispatcher,{getUniqueCode:function(){if(dc.isImage(this._image)||"string"==typeof this._image||uc.isArray(this._image))return this._imageSrc+" "+this.format+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(dc.isCanvas(this._image)){var a=this._image;return a.__uniqueCode||(a.__uniqueCode=$b.id("texture")),a.__uniqueCode+" "+this.format+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new $b.UVMapping,this.wrapS=$b.RepeatWrapping,this.wrapT=$b.RepeatWrapping,this.magFilter=$b.LinearFilter,this.minFilter=$b.LinearMipMapLinearFilter,this.anisotropy=1,this.format=$b.RGBAFormat,this.type=$b.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},clone:function(a,b){return a===e&&(a=new $b.Texture),null==b||b?a.setImage(this._image):a._image=this._image,a._imageSrc=this._imageSrc,a.mipmaps=this.mipmaps.slice(0),a.mapping=this.mapping,a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.format=this.format,a.type=this.type,a.generateMipmaps=this.generateMipmaps,a.premultiplyAlpha=this.premultiplyAlpha,a.flipY=this.flipY,a.flipX=this.flipX,a.unpackAlignment=this.unpackAlignment,a},onloadTexture:function(){},setImageSrc:function(a){if("string"==typeof a)this._imageSrc=a;else if(uc.isArray(a)){for(var b="",c=0;c<a.length;c++)b+="string"==typeof a[c]?a:a[c].src;this._imageSrc=b}else this._imageSrc=a.src},loadAllImages:function(a,b){function c(c){c.onload=function(){c.loaded=!0,c.onload=null,e++,e==d&&(f.onloadTexture(),f.firePropertyChange("image",b,f._image),a.loaded=!0)}}for(var d=a.length,e=0,f=this,g=0;d>g;g++)c(a[g])},setImage:function(a){var b=this._image;if(uc.isArray(a)){for(var c,d="",e=[],f=0;f<a.length;f++)"string"==typeof a[f]?(d+=a,c=new Image,a[f].startsWith("data:image")||(c.crossOrigin="use-credentials"),c.src=a[f],e.push(c)):(d+=a[f].src,e.push(a[f]));this._imageSrc=d,this.loadAllImages(e,b),this._image=e}else if("string"==typeof a){if(this._image&&this._image.src===a)return;this._imageSrc=a;var g=new Image;a.startsWith("data:image")||(g.crossOrigin="use-credentials"),g.src=a;var h=this;h._image=g,g.onload=function(a){g.loaded=!0,g.onload=null,h.onloadTexture(),h.firePropertyChange("image",b,g)}}else{if(this._image===a)return;this._imageSrc=a.src;var b=this._image;if(dc.isCanvas(a)&&(a.loaded=!0),a&&!a.loaded){var h=this;h._image=a;var i=a.onload;a.onload=function(c){i&&i.call(null,c),a.loaded=!0,a.onload=null,h.onloadTexture(),h.firePropertyChange("image",b,a)}}else this._image=a,this.firePropertyChange("image",b,a)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),$b.TextureIdCount=0,$b.PixelsTexture=function(a,b,c,d,e,f,g,h,i,j,k){$b.Texture.call(this,null,f,g,h,i,j,d,e,k),this.image={data:a,width:b,height:c}},$b.PixelsTexture.prototype=Object.create($b.Texture.prototype),$b.PixelsTexture.prototype.clone=function(){var a=new $b.PixelsTexture;return $b.Texture.prototype.clone.call(this,a),a},$b.CompressedTexture=function(a,b,c,d,e,f,g,h,i,j,k){$b.Texture.call(this,null,f,g,h,i,j,d,e,k),this.image={width:b,height:c},this.mipmaps=a,this.generateMipmaps=!1},$b.CompressedTexture.prototype=Object.create($b.Texture.prototype),$b.CompressedTexture.prototype.clone=function(){var a=new $b.CompressedTexture;return $b.Texture.prototype.clone.call(this,a),a};var oc={pools:{},useTimes:{},size:0,setTexture:function(a,b){oc.size++,oc.pools[a]=b},getTexture:function(a){return oc.pools[a]},useTexture:function(a){if(a){var b=a.id,c=oc.useTimes[b]||0;c++,oc.useTimes[b]=c}},unUseTexture:function(a){if(a){var b=a.id,c=oc.useTimes[b]||0;if(c--,oc.useTimes[b]=c,0>=c){var d=a.getUniqueCode();delete oc.pools[d],oc.size--,a.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};$b.TexturePool=oc,$b.TexturePool.TestTexture=new $b.Texture,$b.SerializationSettings=function(){var a=$b.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this.encodeURI=a.encodeURI,this._pm=$b.clone(a._pm),this._sm=$b.clone(a._sm),this._cm=$b.clone(a._cm)},function(){var a=$b.SerializationSettings;a.isDataBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a.encodeURI=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),$b.extend($b.SerializationSettings,Object,{setPropertyType:function(a,b){this._pm[a]=b},getPropertyType:function(a){return this._pm[a]},setStyleType:function(a,b){this._sm[a]=b},getStyleType:function(a){return this._sm[a]},setClientType:function(a,b){this._cm[a]=b},getClientType:function(a){return this._cm[a]}}),$b.Styles={_m:{},setStyle:function(a,b){return null==b?delete $b.Styles._m[a]:$b.Styles._m[a]=b,$b.Styles},getStyle:function(a){return $b.Styles._m[a]}},$b.Styles.MaterailType="S:m.type",$b.Styles.NormalType="S:m.normalType",$b.Styles.PREFIX_STYLE="S:",function(){var a=function(a,b){$b.SerializationSettings.setPropertyType(a,b)};a("combos","data.list"),a("name","cdata"),a("toolTip","cdata"),a("parent","data"),a("fromNode","data"),a("toNode","data"),a("alarmState","alarmstate"),a("vertices","list.vec3"),a("faces","serializeabe.list"),a("uvs","list.vec2"),a("position","vec3"),a("rotation","vec3"),a("scale","vec3"),a("location","point"),a("materialSize","number"),a("color","color"),a("ambient","color"),a("diffuse","color"),a("specular","color"),a("intensity","number"),a("distance","number"),a("type","number"),a("startClosed","boolean"),a("endClosed","boolean"),a("curveSegments","number"),a("amount","number"),a("vertical","boolean"),a("repeat","number"),a("centralized","boolean"),a("visible","boolean"),a=function(a,b,c){null==c&&(c=null!=b?b instanceof $b.Vec2?"vec2":b instanceof $b.Vec3?"vec3":typeof b:"string"),$b.Styles.setStyle(a,b),$b.SerializationSettings.setStyleType(a,c)},a("select.style","border"),a("select.width",1),a("select.color",65280),a("select.offset",0),a("outer.width",1),a("outer.offset",0),a("outer.color",null,"color"),a("m.type","basic"),a("m.color",16777215,"color"),a("m.side","front"),a("m.alphaTest",0),a("m.polygonOffset",!1),a("m.polygonOffsetFactor",0),a("m.polygonOffsetUnits",0),a("m.wireframe",!1),a("m.wireframeLinewidth",1),a("m.wireframeLinecolor",16777215,"color"),a("m.wireframeLineopacity",1),a("m.gradient",{}),a("m.gradientType",1),a("m.transparent",!1),a("m.opacity",1),a("m.visible",!0),a("m.depthTest",!0),a("m.depthMask",!0),a("m.alignment",new $b.Vec2(0,0)),a("m.linewidth",1),a("m.texture.image",null),a("m.texture.offset",new $b.Vec2(0,0)),a("m.texture.repeat",new $b.Vec2(1,1)),a("m.texture.wrapS",$b.RepeatWrapping),a("m.texture.wrapT",$b.RepeatWrapping),a("m.texture.flipX",!1),a("m.texture.flipY",!1),a("m.normalmap.image",null),a("m.envmap.image",null),a("m.specularmap.image",null),a("right.m.type","basic"),a("left.m.type","basic"),a("top.m.type","basic"),a("bottom.m.type","basic"),a("front.m.type","basic"),a("back.m.type","basic"),a("side.m.type","basic"),a("alarm.billboard.scale",null),a("alarm.billboard.position","top"),a("alarm.billboard.vertical",!1),a("annotation.class","tgl_annotation")}(),$b.extend($b.Styles,Object,{}),$b.BoundingBox=function(a,b){this.min=a!==e?a:new ac(1/0,1/0,1/0),this.max=b!==e?b:new ac(-(1/0),-(1/0),-(1/0))},$b.BoundingBox.prototype={constructor:$b.BoundingBox,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b),this.max.copy(b);for(var c=1,d=a.length;d>c;c++)b=a[c],b.x<this.min.x?this.min.x=b.x:b.x>this.max.x&&(this.max.x=b.x),b.y<this.min.y?this.min.y=b.y:b.y>this.max.y&&(this.max.y=b.y),b.z<this.min.z?this.min.z=b.z:b.z>this.max.z&&(this.max.z=b.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(a,b){var c=$b.BoundingBox.__v1.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=0,this.max.x=this.max.y=this.max.z=0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){var b=a||new ac;return b.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){var b=a||new ac;return b.subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a){return new ac((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){b||new ac;return(new ac).copy(a).clamp(this.min,this.max)},distanceToPoint:function(a){var b=$b.BoundingBox.__v1.copy(a).clamp(this.min,this.max);return b.sub(a).length()},getBoundingSphere:function(a){var b=a||new $b.Sphere;return b.center=this.center(),b.radius=.5*this.size($b.BoundingBox.__v0).length(),b},intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},transform:function(a){var b=[$b.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),$b.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),$b.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),$b.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),$b.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),$b.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),$b.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),$b.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),$b.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(a)];return this.makeEmpty(),this.setFromPoints(b),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new $b.BoundingBox).copy(this)}},$b.BoundingBox.__v0=new ac,$b.BoundingBox.__v1=new ac,$b.BoundingBox.__v2=new ac,$b.BoundingBox.__v3=new ac,$b.BoundingBox.__v4=new ac,$b.BoundingBox.__v5=new ac,$b.BoundingBox.__v6=new ac,$b.BoundingBox.__v7=new ac,$b.BoundingSphere=function(a,b){this.center=a!==e?a:new ac,this.radius=b!==e?b:0},$b.BoundingSphere.prototype={constructor:$b.BoundingSphere,set:function(a,b){return this.center.copy(a),this.radius=b,this},setFromCenterAndPoints:function(a,b){for(var c=0,d=0,e=b.length;e>d;d++){var f=a.distanceToSquared(b[d]);c=Math.max(c,f)}return this.center=a,this.radius=Math.sqrt(c),this},copy:function(a){return this.center.copy(a.center),this.radius=a.radius,this},empty:function(){return this.radius<=0},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new ac;return d.copy(a),c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d},getBoundingBox:function(a){var b=a||new $b.Box3;return b.set(this.center,this.center),b.expandByScalar(this.radius),b},transform:function(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this},applyMatrix4:function(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this},translate:function(a){return this.center.add(a),this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new $b.BoundingSphere).copy(this)}},$b.Primitive=function(a,b){a=a||{},this.data=a,this.vertices=a.vertices,this.faces=a.faces,this.uvs=a.uvs,this.uv2s=a.uv2s,this.colors=a.colors||[],this.uniqueCode=b},$b.extend($b.Primitive,Object,{clone:function(a){if(a){var b,c={};for(c.vertices=[],b=0;b<this.vertices.length;b++)c.vertices.push(this.vertices[b].clone());for(c.faces=[],b=0;b<this.faces.length;b++)c.faces.push(this.faces[b].clone());for(c.uvs=[],b=0;b<this.uvs.length;b++){for(var d=this.uvs[b],e=[],f=0;f<d.length;f++)e.push(d[f].clone);c.uvs.push(e)}for(c.uv2s=[],b=0;b<this.uv2s.length;b++)c.uv2s.push(this.uv2s[b].clone());return new $b.Primitive(c)}return new $b.Primitvie(this.data)}}),$b.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(a){return a?$b.PrimitiveCache._cache[a]:null},setPrimitive:function(a,b){a&&($b.PrimitiveCache._cache[a]=b)},usePrimitive:function(a){var b=$b.PrimitiveCache._useCount[a]||0;b++,$b.PrimitiveCache._useCount[a]=b},unUsePrimitive:function(a){var b=$b.PrimitiveCache._useCount[a]||0;b--,0>=b&&delete $b.PrimitiveCache._useCount[a]}},$b.PrimitiveGroupCache={},$b.Color=function(a){return a!==e&&this.set(a),this},$b.extend($b.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(a){switch(typeof a){case"number":this.setHex(a);break;case"string":this.setStyle(a)}},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSV:function(a,b,c){var d,e,f,g,h;return 0===c?this.r=this.g=this.b=0:(d=Math.floor(6*a),e=6*a-d,f=c*(1-b),g=c*(1-b*e),h=c*(1-b*(1-e)),0===d?(this.r=c,this.g=h,this.b=f):1===d?(this.r=g,this.g=c,this.b=f):2===d?(this.r=f,this.g=c,this.b=h):3===d?(this.r=f,this.g=g,this.b=c):4===d?(this.r=h,this.g=f,this.b=c):5===d&&(this.r=c,this.g=f,this.b=g)),this},setStyle:function(a){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(a)){var b=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(a);return this.r=Math.min(255,parseInt(b[1],10))/255,this.g=Math.min(255,parseInt(b[2],10))/255,this.b=Math.min(255,parseInt(b[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(a)){var b=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(a);return this.r=Math.min(100,parseInt(b[1],10))/100,this.g=Math.min(100,parseInt(b[2],10))/100,this.b=Math.min(100,parseInt(b[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(a)){var b=/^\#([0-9a-f]{6})$/i.exec(a);return this.setHex(parseInt(b[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)){var b=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);return this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16)),this}return/^(\w+)$/i.test(a)?(this.setHex($b.ColorKeywords[a]),this):void 0},copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a){return this.r=a.r*a.r,this.g=a.g*a.g,this.b=a.b*a.b,this},copyLinearToGamma:function(a){return this.r=Math.sqrt(a.r),this.g=Math.sqrt(a.g),this.b=Math.sqrt(a.b),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(a){var b,c,d=this.r,f=this.g,g=this.b,h=Math.max(Math.max(d,f),g),i=Math.min(Math.min(d,f),g),j=h;if(i===h)b=0,c=0;else{var k=h-i;c=k/h,b=d===h?(f-g)/k:f===h?2+(g-d)/k:4+(d-f)/k,b/=6,0>b&&(b+=1),b>1&&(b-=1)}return a===e&&(a={h:0,s:0,v:0}),a.h=b,a.s=c,a.v=j,a},add:function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this},addColors:function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},addScalar:function(a){return this.r+=a,this.g+=a,this.b+=a,this},multiply:function(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},lerp:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},clone:function(){return(new $b.Color).setRGB(this.r,this.g,this.b)},toString:function(){return this.getStyle()}}),$b.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,
cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$b.Data=function(a){if($b.PropertyChangeDispatcher.call(this),this._childList=new mc,this._childMap={},this._clientMap={},a===e||null===a)this._id=$b.id("E");else if("string"==typeof a||"number"==typeof a||"boolean"==typeof a)this._id=a;else{for(var b in a)if("clients"===b)for(var c in a.clients)this._clientMap[c]=a.clients[c];else"styles"===b?this.s(a.styles):null!=a[b]&&("id"===b?this._id=a[b]:this[$b.setter(b)]&&this[$b.setter(b)](a[b]));null==this._id&&(this._id=$b.id("E"))}},$b.extend($b.Data,$b.PropertyChangeDispatcher,{___accessor:["name"],constructor:$b.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(a,b,c){},setGroupId:function(a){if(this._groupId!==a){var b=this._groupId;this._groupId=a,this.firePropertyChange("groupId",b,a)}},getGroupId:function(){return this._groupId},hasChildren:function(){return this._childList.size()>0},getChildren:function(){return this._childList},isDescendantOf:function(a){if(!a)return!1;if(!a.hasChildren())return!1;for(var b=this._parent;b;){if(a===b)return!0;b=b.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var a=this._parent;return a&&null==a._parent?a:a&&null!=a._parent?a.getRoot(a):arguments[0]},setParent:function(a){if(!(this._isUpdatingParent||this._parent===a||this===a||a&&a.isDescendantOf(this))){var b=this._parent;this._parent=a,this._isUpdatingParent=!0,b&&b.removeChild(this),a&&a.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",b,a),this.onParentChanged(b,a)}},onParentChanged:function(a,b){},addChild:function(a,b){return b===e&&(b=this._childList.size()),a&&a!==this?this._childMap[a.getId()]?!1:this.isDescendantOf(a)?!1:(a.getParent()&&a.getParent().removeChild(a),(0>b||b>this._childList.size())&&(b=this._childList.size()),this._childList.add(a,b),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,b),!0):!1},onChildAdded:function(a,b){},clearChildren:function(){if(null!=this._childList&&this._childList.size()>0){var a=this._childList.toList(),b=this;a.forEach(function(a){b.removeChild(a)})}},removeChild:function(a){if(!a)return!1;if(!this._childMap[a._id])return!1;var b=this._childList.remove(a);return delete this._childMap[a._id],this.firePropertyChange("children",a,null),a.setParent(null),this.onChildRemoved(a,b),!0},onChildRemoved:function(a,b){},c:function(a){if(a)for(var b in a)this.setClient(b,a[b])},setClient:function(a,b){if(null==a)return this;null==this._clientMap&&(this._clientMap=new Object);var c=this._clientMap[a];return c===b?this:(null==b?delete this._clientMap[a]:this._clientMap[a]=b,this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b),this.onClientChanged(a,c,b),this)},getClient:function(a){return this._clientMap[a]},onClientChanged:function(a,b,c){},setPropertyValue:function(a,b){if(this[a]===b)return!1;var c=this[a];return c instanceof $b.Color&&null!=b?(c=c.clone(),b instanceof $b.Color?this[a].copy(b):this[a].set(b)):this[a]=b,!0}}),$b.Element=function(a){this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new ac(0,1,0),this._position=new ac(0,0,0),this._rotation=new ac(0,0,0),this._scale=new ac(1,1,1),this.eulerOrder=$b.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new cc,this.worldMatrix=new cc,this.rotationWorldMatrix=new cc,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new $b.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this._vector=new ac,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new $b.AlarmState(this),$b.Data.call(this,a)},$b.Element.__m1=new cc,$b.ElementIdCount=0,$b.extend($b.Element,$b.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:$b.Element,getAlarmState:function(){return this._alarmState},onAlarmChange:function(a,b){var c=this._alarmState.getHighestNativeAlarmSeverity();c?this.setStyle("m.alarmColor",new $b.Color(c.color)):this.setStyle("m.alarmColor",null)},getDefaultInstance:function(){return this.constructor.defaultInstance===e&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(a,b){this.updateWorldMatrix(!0,!1)},onChildAdded:function(a,b){a.updateWorldMatrix(!0,!1)},onChildRemoved:function(a,b){a.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(a){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(a){return"scale"===a||"position"===a||"rotation"===a},isStyleEquals:function(a,b,c){return null==b&&null==c?!0:b===c},setStyle:function(a,b){if(null==a)return this;null==this.styleMap&&(this.styleMap={});var c=this.styleMap[a];return this.isStyleEquals(a,c,b)?this:(null==b?delete this.styleMap[a]:this.styleMap[a]=b,this.onStyleChanged(a,c,b),this.firePropertyChange($b.Styles.PREFIX_STYLE+a,c,b),this)},c:function(a){if(a)for(var b in a)this.setClient(b,a[b])},s:function(a){if(null==a)return this;null==this.styleMap&&(this.styleMap={});var b,c,d,e={},f={};for(b in a)c=a[b],d=this.styleMap[b],this.isStyleEquals(b,d,c)||(null==c?delete this.styleMap[b]:this.styleMap[b]=c,f[b]=d,this.isMaterialStyle(b)&&(e[b]=[c,d]));this.onMaterialStylesChanged(e);for(b in a)this.firePropertyChange($b.Styles.PREFIX_STYLE+b,f[b],this.styleMap[b]);return this},getStyle:function(a,b,c){null==c&&(c=!0);var d;return null!=this.styleMap&&(d=this.styleMap[a]),b&&(d=this.getCloneObject(d)),null==d&&c&&(d=this.getDefaultStyle(a,b)),d},getCloneObject:function(a){if(null==a)return null;if($b.Utils.isArray(a)){for(var b=[],c=0;c<a.length;c++)b.push(this.getCloneObject(a[c]));return b}return a.clone?a.clone():a},getSideIndexMapping:function(){},setMaterialStyle:function(a,b){},setMaterialStyles:function(a){var b,c,d,e;for(var f in a){if(f.startsWith("m."))b=f.substr(f.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(d)){var g=d.substr(0,d.indexOf(".")),h=this.getSideMaterialIndex(g);if(h!=i)continue;d=d.substr(d.indexOf(".")+1),b=d.substr(f.indexOf(".")+1)}else f.startsWith("alarm.billboard.")&&(e=!0);var j=a[f];c=j[0],null==c?c=$b.Styles.getStyle(f):uc.isArray(c)&&(c=c[i]),this._A97(this.material,b,c)}e&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},onMaterialStylesChanged:function(a){this.setMaterialStyles(a)},isMaterialStyle:function(a){return a.startsWith("m.")?!0:this.getSideIndexMapping()&&this.isSideStyle(a)?!0:!1},onStyleChanged:function(a,b,c){if(a.startsWith("m."))this.setMaterialStyle(a,c);else if(this.getSideIndexMapping()&&this.isSideStyle(a)){var d=a.substr(0,a.indexOf("."));a=a.substr(a.indexOf(".")+1);var e=this.getSideMaterialIndex(d);this.setMaterialStyle(a,c,e)}else a.startsWith("alarm.billboard.")&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(a,b,c){if(b.startsWith("texture.")||b.startsWith("texture1.")||b.startsWith("texture2.")||b.startsWith("textureb.")||b.startsWith("texturen.")||b.startsWith("texturebp.")||b.startsWith("lightmap")||b.startsWith("envmap")||b.startsWith("normalmap")||b.startsWith("specularmap")){var d=b.substr(0,b.indexOf(".")),e=b.substr(b.indexOf(".")+1);if("offset"===e||"repeat"===e)return void a.setPropertyValue(e,this.getCloneObject(c));var f=this.textureMapping[d],g=a[f],h=$b.TexturePool.TestTexture;if("image"===e){var i=c;if(b.startsWith("envmap")&&uc.isArray(i))for(var j=0;j<i.length;j++)if(null==i[j]){i=null;break}if(null==g&&null!=i){h.resetValue(),h._image=i,h.setImageSrc(i);var k=h.getUniqueCode(),l=$b.TexturePool.getTexture(k);null==l&&(l=new $b.Texture(i),$b.TexturePool.setTexture(k,l)),a.setMap(l,f)}else if(null==i)a.setMap(null,f);else{g.clone(h,!1),h._image=i,h.setImageSrc(i);var k=h.getUniqueCode(),l=$b.TexturePool.getTexture(k);l!==g&&(null==l&&(l=new $b.Texture,g.clone(l,!1),l.setImage(i),$b.TexturePool.setTexture(k,l)),a.setMap(l,f))}}else if(null!=g){g.clone(h,!1),h[e]=this.getCloneObject(c);var k=h.getUniqueCode(),l=$b.TexturePool.getTexture(k);l!=g&&(null==l&&(l=new $b.Texture,g.clone(l),l[e]=c),a.setMap(l,f))}}else"type"===b&&a.setType?a.setType(c):a.setPropertyValue(b,this.getCloneObject(c))},getDefaultStyle:function(a,b){if(null==a)return null;if(a.startsWith("m.")){var c=[],d=a.substr(a.indexOf(".")+1);if(this.material.materials){var e=this.material.materials;e=e||[this.material];for(var f=0;f<e.length;f++){var g=e[f];if(d.startsWith("texture.")||d.startsWith("texture1.")||d.startsWith("texture2.")||d.startsWith("textureb.")||d.startsWith("texturen.")||d.startsWith("texturebp.")||d.startsWith("lightmap")||d.startsWith("envmap")||d.startsWith("normalmap")||d.startsWith("specularmap")){var h=d.substr(0,d.indexOf(".")),i=d.substr(d.indexOf(".")+1),j=(d.substr(d.indexOf(".")+1),this.textureMapping[h]),k=g[j];if(k)if("image"===i)if(uc.isArray(k._image)){var l=[];c.push(l);for(var m=0;m<k._image.length;m++)l.push(k._image[m].src)}else c.push(k._image.src);else"offset"===i||"repeat"===i?c.push(g[i]):c.push(g.map[i]);else c.push($b.Styles.getStyle(a))}else{var n=$b.Styles.getStyle(a);c.push(null==n?g[d]:n)}}}b&&(c=this.getCloneObject(c));for(var o=!0,f=0;f<c.length;f++)if(0!=c.indexOf(c[f])){o=!1;break}return o?c[0]:c}if(this.isSideStyle(a)){var p=a.substr(0,a.indexOf("."));a=a.substr(a.indexOf(".")+1);var d=a.substr(a.indexOf(".")+1),q=this.getSideMaterialIndex(p);if(null!=q){var n,g=this.material.materials[q];return d.startsWith("texture.")?g.map&&(n="texture.image"===d?g.map._image.src:g.map[d]):n=g[d],b&&(n=this.getCloneObject(n)),n}}return $b.Styles.getStyle(a)},isSideStyle:function(a){if(-1===a.indexOf("."))return!1;var b=this.getSideIndexMapping();if(!b)return!1;var c=a.substr(0,a.indexOf("."));return b[c]!==e?!0:!1},setUp:function(a,b,c){var d;if(3===arguments.length){if(this.up.x===a&&this.up.y===b&&this.up.z===c)return;d=new ac(a,b,c)}else{if(this.up.x===a.x&&this.up.y===a.y&&this.up.z===a.z)return;d=a}var e=this.up;this.up=d,this.onUpChanged(e,d),this.firePropertyChange("up",e,d)},getUp:function(){return this.up},onUpChanged:function(a,b){},checkNumber:function(a,b,c,d){uc.isNaN(a)&&console.error(d+",x is not a number"),uc.isNaN(b)&&console.error(d+",y is not a number"),uc.isNaN(c)&&console.error(d+",z is not a number")},invalidateTexture:function(a){var b,c,d,e=this.material;if(null!=a&&e instanceof $b.ArrayMaterial){if("string"==typeof a){var f=this.getSideIndexMapping();if(null!=f&&(a=f[a]),null==a)return}if("number"!=typeof a)return;d=e instanceof $b.ArrayMaterial?e.materials[a]:materail,this._dirtyMaterialTexture(d)}else if(e instanceof $b.ArrayMaterial)for(c=e.materials,b=0;b<c.length;b++)d=c[b],this._dirtyMaterialTexture(d);else this._dirtyMaterialTexture(e)},_dirtyMaterialTexture:function(a){null!=a&&(a.map instanceof $b.Texture&&this._dirtyTexture(a.map),a.lightMap instanceof $b.Texture&&this._dirtyTexture(a.lightMap))},_dirtyTexture:function(a){var b=a._image;a.firePropertyChange("image",null,b)},p:function(a,b,c){return 0===arguments.length?this.getPosition():void(3===arguments.length?this.setPosition(a,b,c):this.setPosition(a))},checkPosition:function(a){return!0},setPosition:function(a,b,c){var d;if(3===arguments.length){if(this._position.x===a&&this._position.y===b&&this._position.z===c)return;this.checkNumber(a,b,c,"setPosition"),d=new ac(a,b,c)}else{if(this._position.x===a.x&&this._position.y===a.y&&this._position.z===a.z)return;if(!(a instanceof ac))throw"Element.setPosition : position is not instanceof TGL.Vec3";d=a}if(this.checkPosition(d)){var e=this._position;this._position=d,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",e,d)}},getPosition:function(a){return a==e&&(a=!0),a?this._position.clone():this._position},setPositionX:function(a){if(this._position.x!==a){this.checkNumber(a,0,0,"setPositionX");var b=this._position.x,c=this._position.clone();return c.x=a,this.checkPosition(c)?(this._position.x=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",b,a),void 0):!1}},setX:function(a){this.setPositionX(a)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(a){if(this._position.y!==a){this.checkNumber(0,a,0,"setPositionY");var b=this._position.y,c=this._position.clone();return c.y=a,this.checkPosition(c)?(this._position.y=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",b,a),void 0):!1}},setY:function(a){this.setPositionY(a)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(a){if(this._position.z!==a){this.checkNumber(0,0,a,"setPositionZ");var b=this._position.z,c=this._position.clone();return c.z=a,this.checkPosition(c)?(this._position.z=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",b,a),void 0):!1}},setZ:function(a){this.setPositionZ(a)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(a,b,c){var d;if(3===arguments.length){if(this._scale.x===a&&this._scale.y===b&&this._scale.z===c)return;this.checkNumber(a,b,c,"setScale"),d=new ac(a,b,c)}else{if(this._scale.x===a.x&&this._scale.y===a.y&&this._scale.z===a.z)return;if(!(a instanceof ac))throw"Element.setScale : scale is not instanceof TGL.Vec3";d=a}var e=this._scale;d.x=d.x||1,d.y=d.y||1,d.z=d.z||1,this._scale=d,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",e,d)},getScale:function(a){return a==e&&(a=!0),a?this._scale.clone():this._scale},setScaleX:function(a){if(this._scale.x!==a){this.checkNumber(a,0,0,"setScalX");var b=this._scale.x;this._scale.x=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",b,a)}},getScaleX:function(){return this._scale.x},setScaleY:function(a){if(this._scale.y!==a){this.checkNumber(0,a,0,"setScaleY");var b=this._scale.y;this._scale.y=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",b,a)}},getScaleY:function(){return this._scale.y},setScaleZ:function(a){if(this._scale.z!==a){this.checkNumber(0,0,a,"setScaleZ");var b=this._scale.z;this._scale.z=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",b,a)}},getScaleZ:function(){return this._scale.z},setRotation:function(a,b,c){var d;if(3===arguments.length){if(this._rotation.x===a&&this._rotation.y===b&&this._rotation.z===c)return;this.checkNumber(a,b,c,"setRotation"),d=new ac(a,b,c)}else{if(this._rotation.x===a.x&&this._rotation.y===a.y&&this._rotation.z===a.z)return;if(!(a instanceof ac))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";d=a}var e=this._rotation;this._rotation=d,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",e,d)},getRotation:function(a){return a==e&&(a=!0),a?this._rotation.clone():this._rotation},setRotationX:function(a){if(this._rotation.x!==a){this.checkNumber(a,0,0,"setRotationX");var b=this._rotation.x;this._rotation.x=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",b,a)}},getRotationX:function(){return this._rotation.x},setRotationY:function(a){if(this._rotation.y!==a){this.checkNumber(0,a,0,"setRotationY");var b=this._rotation.y;this._rotation.y=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",b,a)}},getRotationY:function(){return this._rotation.y},setRotationZ:function(a){if(this._rotation.z!==a){this.checkNumber(0,0,a,"setRotationZ");var b=this._rotation.z;this._rotation.z=a,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",b,a)}},getRotationZ:function(){return this._rotation.z},applyMatrix:function(a){var b=this.matrix.clone();this.matrix.multiplyMatrices(a,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var c=(new cc).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(c,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",b,this.matrix)},translate:function(a,b){this.matrix.rotateAxis(b),this.setPosition(this._position.clone().add(b.multiplyScalar(a)))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},rotateFromAxis:function(a,b,c){b=b.clone().applyMatrix4(this.matrix),a=a.clone().normalize().applyMatrix4((new cc).extractRotation(this.matrix));var d=(new cc).makeRotationAxisAndCenter(a,c,b);this.applyMatrix(d)},rotateFromWorldAxis:function(a,b){var c=new cc;c.makeRotationAxis(a.normalize(),b),c.multiply(this.matrix),this.matrix=c;var d=(new cc).extractRotation(this.matrix),e=new ac;e.setEulerFromRotationMatrix(d,this.eulerOrder),this.setRotation(e)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(a){this.rotateFromWorldAxis(new ac(1,0,0),a)},rotateFromWorldYAxis:function(a){this.rotateFromWorldAxis(new ac(0,1,0),a)},rotateFromWorldZAxis:function(a){this.rotateFromWorldAxis(new ac(0,0,1),a)},getRelativeTransform:function(a){if(a instanceof $b.Element){var b=(new cc).getInverse(a.matrix.clone()),c=(new cc).multiplyMatrices(b,this.matrix.clone()),d=(new ac).getPositionFromMatrix(c),e=(new ac).setEulerFromRotationMatrix(c),f=(new ac).getScaleFromMatrix(c),g={position:d,rotation:e,scale:f,matrix:c};return g}return null},localToWorld:function(a){return null==this._parent?a:a.clone().applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(a){return a.clone().applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(a){var b=a.applyMatrix4((new cc).extractRotation(this.worldMatrix));return b.normalize(),b},frontDirection:function(){var a=new ac(0,0,1);return a=a.applyMatrix4((new cc).extractRotation(this.worldMatrix)),a.normalize(),a},worldPosition:function(a,b){b=b>0?b:a.length();var c=this.worldMatrix.getPosition();return c.add(this.direction(a).multiplyScalar(b))},frontWorldPosition:function(a){a=a>0?a:1;var b=this.worldMatrix.getPosition();return b.add(this.frontDirection().multiplyScalar(a))},worldToLocal:function(a){return a.clone().applyMatrix4($b.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(a,b){this.matrix.lookAt(a,this._position,b?b:this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(a){a(this),this._childList&&this._childList.forEach(function(b){b.iterator(a)})},getChildByName:function(a,b){for(var c=0,d=this.children.length;d>c;c++){var f=this.children[c];if(f.name===a)return f;if(b===!0&&(f=f.getChildByName(a,b),f!==e))return f}return e},getDescendants:function(a){a===e&&(a=[]);var b=this.getChildren().toArray();Array.prototype.push.apply(a,b);for(var c=0,d=b.length;d>c;c++)b[c].getDescendants(a);return a},fixSize:function(a){if(this._sizeFixed){this.updateWorldMatrix();var b=new ac,c=new ac;b.getPositionFromMatrix(this.worldMatrix),a.updateWorldMatrix(),c.getPositionFromMatrix(a.worldMatrix),scale=b.distanceTo(c)/this._fixedSize,0===scale&&(scale=1e-5),this.setScale(scale,scale,scale)}},updateMatrix:function(){this.matrix.setPosition(this._position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this._scale.x||1!==this._scale.y||1!==this._scale.z)&&this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(a,b){if(b=b==e?!0:b,this.matrixAutoUpdate===!0&&this.updateMatrix(),this.worldMatrixNeedsUpdate===!0||a===!0){this.matrixAutoUpdate===!1&&this.updateMatrix();var c=this.worldMatrix.clone();this._parent==e?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,a=!0,c.equals(this.worldMatrix)||(b&&this.firePropertyChange("worldMatrix",c,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(b){b.updateWorldMatrix(a)})},cloneCallback:function(a){},clonePrefab:function(a){var b=new mono.Entity;a===e&&(a=!0),b.name=this.name,null==b.up&&(b.up=new ac(0,1,0)),b.up.copy(this.up),b._position.copy(this._position),b._rotation.copy(this._rotation),b.eulerOrder=this.eulerOrder,b._scale.copy(this._scale),b.renderDepth=this.renderDepth,b.rotationAutoUpdate=this.rotationAutoUpdate,b.matrix.copy(this.matrix),b.worldMatrix.copy(this.worldMatrix),b.rotationWorldMatrix.copy(this.rotationWorldMatrix),b.matrixAutoUpdate=this.matrixAutoUpdate,b.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,b.quaternion.copy(this.quaternion),b.useQuaternion=this.useQuaternion,b._visible=this._visible,b.castShadow=this.castShadow,b.receiveShadow=this.receiveShadow,b.frustumCulled=this.frustumCulled,b.styleMap=b.styleMap||{},a&&this._childList&&this._childList.forEach(function(c){b.addChild(c.clonePrefab(a))}),b.vertices=this.vertices,b.faces=this.faces,b.uvs=this.uvs,b.uv2s=this.uv2s,this.primitive&&(b.primitive=this.primitive,b.data=this.primitive.data,b.computed=!0);for(var c in this.styleMap)b.styleMap[c]=this.getCloneObject(this.styleMap[c]);if(null!=this._clientMap)for(var d in this._clientMap)b.setClient(d,this._clientMap[d]);if(b.material=this.material,this.material instanceof $b.ArrayMaterial){b.material=new $b.ArrayMaterial,b.material.materials=[];for(var f=0;f<this.material.materials.length;f++)b.material.materials.push(this.material.materials[f])}return b.materialSize=this.getMaterialSize?this.getMaterialSize():1,b.boundingBox=this.boundingBox,b},createCloneObject:function(){return this.constructor?object=new this.constructor:object=new $b.Element,object},clone:function(a,b,c){if("boolean"==typeof a&&(c=b,b=a,a=e),a==e&&(a=this.createCloneObject()),c===e&&(c=!0),a.name=this.name,null==a.up&&(a.up=new ac(0,1,0)),a.up.copy(this.up),a._position.copy(this._position),a._rotation.copy(this._rotation),a.eulerOrder=this.eulerOrder,a._scale.copy(this._scale),a.renderDepth=this.renderDepth,a.rotationAutoUpdate=this.rotationAutoUpdate,a.matrix.copy(this.matrix),a.worldMatrix.copy(this.worldMatrix),a.rotationWorldMatrix.copy(this.rotationWorldMatrix),a.matrixAutoUpdate=this.matrixAutoUpdate,a.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,a.quaternion.copy(this.quaternion),a.useQuaternion=this.useQuaternion,a._visible=this._visible,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.frustumCulled=this.frustumCulled,a.styleMap=a.styleMap||{},c&&this._childList&&this._childList.forEach(function(d){a.addChild(d.clone(b,c))}),this.constructor){var d=this.constructor.prototype.__accessor,f=this.constructor.prototype.__bool;if(d&&d.length>0)for(var g=0;g<d.length;g++){var h=d[g],i=$b.getter(h,f),j=$b.setter(h);"vertices"===h?a.vertices=this.vertices:"faces"===h?a.faces=this.faces:a[j]&&a[j](this[i]())}}if(b&&this.vertices){var k=a,l=this.vertices;k.vertices=[],k.faces=[],k.uvs=[];for(var g=0,m=l.length;m>g;g++)k.vertices.push(l[g].clone());for(var n=this.faces,g=0,m=n.length;m>g;g++)k.faces.push(n[g].clone());for(var o=this.uvs,g=0,m=o.length;m>g;g++){for(var p=o[g],q=[],r=0,s=p.length;s>r;r++)q.push(new $b.Vec2(p[r].x,p[r].y));k.uvs.push(q)}}for(var t in this.styleMap)a.setStyle(t,this.getCloneObject(this.styleMap[t]));if(null!=this._clientMap)for(var u in this._clientMap)a.setClient(u,this._clientMap[u]);return a.cloneCallback(b),a}}),$b.Annotation=function(a,b,c){$b.Element.call(this,c),this._label=a,this._text=b,this._cameraPosition=null},$b.extend($b.Annotation,$b.Element,{___accessor:["label","text","cameraPosition"]}),$b.Node=function(a){this.name="",this.computed=!1,this.selectionData=null,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=this.colors||[],this.normals=[],this.faces=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),this._alarmBillboard=null,$b.Element.call(this,a)},$b.extend($b.Node,$b.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(a){this.verticesNeedUpdate=a,this.elementsNeedUpdate=a,this.uvsNeedUpdate=a,this.normalsNeedUpdate=a,this.colorsNeedUpdate=a},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._allLinks||(this._allLinks=new mc),this._fromLinks||(this._fromLinks=new mc),this._allLinks.add(a),this._fromLinks.add(a),this._resetLinkSet()},_addToLink:function(a){this._allLinks||(this._allLinks=new mc),this._toLinks||(this._toLinks=new mc),this._allLinks.add(a),this._toLinks.add(a),this._resetLinkSet()},_removeFromLink:function(a){this._allLinks.remove(a),this._fromLinks.remove(a),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(a){this._allLinks.remove(a),this._toLinks.remove(a),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){if(delete this._loopedLinks,!this._allLinks||0===this._allLinks.size())return void delete this._links;var a;this._allLinks.forEach(function(b){b.isLooped()&&(a||(a={}),a[b._id]||(this._loopedLinks||(this._loopedLinks=new mc),this._loopedLinks.add(b),a[b._id]=b))},this),a?(this._links=new mc,this._allLinks.forEach(function(b){a[b._id]?a[b._id]!==!1&&(a[b._id]=!1,this._links.add(b)):this._links.add(b)},this)):this._links=this._allLinks},onAlarmChange:function(a,b){$b.Element.prototype.onAlarmChange.call(this,a,b);var c=this;setTimeout(function(){var a=c._alarmState.getPropagateSeverity();a||(a=c._alarmState.getHighestNativeAlarmSeverity());var b=c._parent,d=!1;if(null!=b&&b._alarmState){var e=b._alarmState.getPropagateSeverity();e||(d=!0)}else d=!0;a&&d?(null==c._alarmBillboard&&c.setAlarmBillboard(new $b.Billboard),c.setAlarmBillboardImageAndColor(c._alarmBillboard,a)):c.setAlarmBillboard(null)},10)},setAlarmBillboardImageAndColor:function(a,b){a.setStyle("m.texture.image",$b.ImageCache.AlarmBillboardImage),a.setStyle("m.color",b.color),a.setStyle("m.alignment",$b.BillboardAlignment.bottomCenter)},_setAlarmBillboardPositionAndSize:function(a){var b=this.getStyle("alarm.billboard.position"),c=this.getBoundingBox(),d=c.min,e=c.max,f=c.center(),g=c.size();"topLeft"===b?a._position.set(d.x,e.y,f.z+1):"topRight"===b?a._position.set(e.x,e.y,f.z+1):"topBack"===b?a._position.set(f.x,e.y,d.z-1):"topFront"===b?a._position.set(f.x,e.y,e.z+1):a._position.set(f.x,e.y,f.z+1);var h=this.getStyle("alarm.billboard.scale");h instanceof ac?a._scale.copy(h):a._scale.set(g.x/2,g.x/2,1);var i=this.getStyle("alarm.billboard.vertical");a.setStyle("m.vertical",i)},getLinkOffset:function(a){return new mono.Vec3(0,0,0)},getLinkExtend:function(a){return new mono.Vec3(0,0,0)},clearLinkOrthogonal:function(a,b){return!1},clearLinkExtend:function(a,b){return!1},setAlarmBillboard:function(a){if(this._alarmBillboard!=a){var b=this._alarmBillboard;a?(this._alarmBillboard=a,a.setParent(this),a.setClient("alarmBillboard",!0),this._setAlarmBillboardPositionAndSize(a)):(this._alarmBillboard.setParent(null),delete this._alarmBillboard),this.firePropertyChange("alarmBillboard",b,a)}},needUpdate:function(){return this.verticesNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(a,b){function c(c){c.applyMatrix4(a),b.push(c)}null==b&&(b=[]),null==a&&(a=new cc);var d;if(this instanceof $b.Node){if(null!=this.vertices&&0!=this.vertices.length){var e=this.getBoundingBox(),f=e.min,g=e.max;c(f.clone()),c(g.clone()),c(new ac(f.x,f.y,g.z)),c(new ac(f.x,g.y,f.z)),c(new ac(g.x,f.y,f.z)),c(new ac(g.x,g.y,f.z)),c(new ac(g.x,f.y,g.z)),c(new ac(f.x,g.y,g.z))}for(var d=0;d<(this._childList?this._childList.size():0);d++){var h=this._childList.get(d),i=new cc;i.multiplyMatrices(a,h.matrix.clone()),h.getVerticesWithChildren&&h.getVerticesWithChildren(i,b)}}return b},getBoundingBoxWithChildren:function(a){var b=this.getVerticesWithChildren();if(a)for(var c=0;c<a.length;c++){var d=a[c];if(d.getParent()===this.getParent()&&d!==this){var e=(new cc).getInverse(this.matrix.clone()),f=(new cc).multiplyMatrices(e,d.matrix.clone());b=b.concat(d.getVerticesWithChildren(f))}}var g=new $b.BoundingBox;return g.setFromPoints(b),g},getWorldBoundingBox:function(){for(var a=[],b=0;b<this.vertices.length;b++){var c=this.vertices[b].clone();c.applyMatrix4(this.worldMatrix),a.push(c)}var d=new $b.BoundingBox;return d.setFromPoints(a),d},getBoundingBox:function(){return null==this.boundingBox&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $b.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new $b.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices);
},createPropagateAlarmCube:function(a){if(null==this.boundingBox&&this.computeBoundingBox(),a._attachId=this._id,null==this.propagateAlarmData){var b=this.getStyle("outer.offset"),c=this.boundingBox.min,d=this.boundingBox.max;a.width=d.x-c.x+b,a.height=d.y-c.y+b,a.depth=d.z-c.z+b,a.computed=!1,a.computeNodeData(),this.propagateAlarmData=a.data,jc(a,!0),this.propagateAlarmData.primitive=a.primitive,this.propagateAlarmData.groups=a.groups;for(var e=(new ac).center(c,d),f=0;f<a.vertices.length;f++){var g=a.vertices[f];g.add(e)}this.propagateAlarmData.vertices=a.vertices}else{var h=this.propagateAlarmData;a.primitive=h.primitive,a.data=h,a.vertices=h.vertices,a.uvs=h.uvs,a.faces=h.faces,a.groups=h.groups}this.updateMatrix(!0),a._position.copy(this._position),a._scale.copy(this._scale),a._rotation.copy(this._rotation),a.useQuaternion=this.useQuaternion,a.quaternion=this.quaternion,a.worldMatrix=this.worldMatrix,a._parent=this.getParent(),a.updateMatrix(!0);var i=a.material;i.wireframeLinewidth=this.getStyle("outer.width");var j=this.getAlarmState().getPropagateSeverity();return i.color.set(j.color),a},createCanvasSelectionCube:function(){return null==this._csc&&(this._csc=new sc,this._csc.material=new $b.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},createSelectionCube:function(a){if(null==this.boundingBox&&this.computeBoundingBox(),a._attachId=this._id+"_selection",null==this.selectionData){var b=this.getStyle("select.offset"),c=this.boundingBox.min,d=this.boundingBox.max,e=(new ac).center(c,d);a.width=d.x-c.x+b,a.height=d.y-c.y+b,a.depth=d.z-c.z+b,a.offset=e,a.computed=!1;a.computeNodeData();this.selectionData=a.data,jc(a,!0),this.selectionData.primitive=a.primitive,this.selectionData.groups=a.groups,this.selectionData.vertices=a.vertices}else{var f=this.selectionData;a.primitive=f.primitive,a.data=f,a.vertices=f.vertices,a.uvs=f.uvs,a.faces=f.faces,a.groups=f.groups}this.updateMatrix(!0),a._position.copy(this._position),a._scale.copy(this._scale),a._rotation.copy(this._rotation),a.useQuaternion=this.useQuaternion,a.quaternion=this.quaternion,a.worldMatrix=this.worldMatrix,a._parent=this.getParent(),a.updateMatrix(!0);var g=a.material;return g.wireframeLinewidth=this.getStyle("select.width"),g.color.set(this.getStyle("select.color")),g.wireframeLinecolor.set(this.getStyle("select.color")),a},mergeVertices:function(){var a,b,c,d,f,g,h,i={},j=[],k=[],l=4,m=Math.pow(10,l);for(this.__tmpVertices=e,null==this.vertices&&console.log("vertices is null"),c=0,d=this.vertices.length;d>c;c++)a=this.vertices[c],b=[Math.round(a.x*m),Math.round(a.y*m),Math.round(a.z*m)].join("_"),i[b]===e?(i[b]=c,j.push(this.vertices[c]),k[c]=j.length-1):k[c]=k[i[b]];var n=[];for(c=0,d=this.faces.length;d>c;c++)if(f=this.faces[c],f instanceof qc){f.a=k[f.a],f.b=k[f.b],f.c=k[f.c],g=[f.a,f.b,f.c];for(var o=-1,p=0;3>p;p++)if(g[p]==g[(p+1)%3]){o=p,n.push(c);break}}else if(f instanceof rc){f.a=k[f.a],f.b=k[f.b],f.c=k[f.c],f.d=k[f.d],g=[f.a,f.b,f.c,f.d];for(var o=-1,p=0;4>p;p++)g[p]==g[(p+1)%4]&&(o>=0&&n.push(c),o=p);if(o>=0){g.splice(o,1);var q=new qc(g[0],g[1],g[2],f.normal,f.color,f.materialIndex);h=this.uvs[c],h&&h.splice(o,1),f.vertexNormals&&f.vertexNormals.length>0&&(q.vertexNormals=f.vertexNormals,q.vertexNormals.splice(o,1)),f.vertexColors&&f.vertexColors.length>0&&(q.vertexColors=f.vertexColors,q.vertexColors.splice(o,1)),this.faces[c]=q}}for(c=n.length-1;c>=0;c--);var r=this.vertices.length-j.length;return this.vertices=j,r},computeVertexNormals:function(a){var b,c,d,f,g,h;if(this.__tmpVertices===e){for(this.__tmpVertices=new Array(this.vertices.length),h=this.__tmpVertices,b=0,c=this.vertices.length;c>b;b++)h[b]=new $b.Vec3;for(d=0,f=this.faces.length;f>d;d++)g=this.faces[d],g.vertexNormals=[new $b.Vec3,new $b.Vec3,new $b.Vec3]}else for(h=this.__tmpVertices,b=0,c=this.vertices.length;c>b;b++)h[b].set(0,0,0);if(a){var i,j,k,l=new $b.Vec3,m=new $b.Vec3;new $b.Vec3,new $b.Vec3,new $b.Vec3;for(d=0,f=this.faces.length;f>d;d++)g=this.faces[d],i=this.vertices[g.a],j=this.vertices[g.b],k=this.vertices[g.c],l.subVectors(k,j),m.subVectors(i,j),l.cross(m),h[g.a].add(l),h[g.b].add(l),h[g.c].add(l),g.d!=e&&h[g.d].add(l)}else for(d=0,f=this.faces.length;f>d;d++)g=this.faces[d],h[g.a].add(g.normal),h[g.b].add(g.normal),h[g.c].add(g.normal);for(b=0,c=this.vertices.length;c>b;b++)h[b].normalize();for(d=0,f=this.faces.length;f>d;d++)g=this.faces[d],g.vertexNormals[0].copy(h[g.a]),g.vertexNormals[1].copy(h[g.b]),g.vertexNormals[2].copy(h[g.c]),g.d!=e&&(g.vertexNormals[3]=h[g.d].clone())},computeCentroids:function(){var a,b,c;for(a=0,b=this.faces.length;b>a;a++)c=this.faces[a],c.centroid=c.centroid||new ac,null==c.centroid&&console.log("fdasfdsa"),c.centroid.set||(c.centroid=new ac),c.centroid.set(0,0,0),c instanceof qc?(c.centroid.add(this.vertices[c.a]),c.centroid.add(this.vertices[c.b]),c.centroid.add(this.vertices[c.c]),c.centroid.divideScalar(3)):c instanceof rc&&(c.centroid.add(this.vertices[c.a]),c.centroid.add(this.vertices[c.b]),c.centroid.add(this.vertices[c.c]),c.centroid.add(this.vertices[c.d]),c.centroid.divideScalar(4))},computeFaceNormals:function(){var a,b,c,d,e,f,g=new ac,h=new ac;for(a=0,b=this.faces.length;b>a;a++)c=this.faces[a],d=this.vertices[c.a],e=this.vertices[c.b],f=this.vertices[c.c],g.subVectors(f,e),h.subVectors(d,e),g.cross(h),g.normalize(),c.normal.copy||(c.normal=new ac),c.normal.copy(g)},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;d>c;c++)c>0&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},getMatetial:function(){return this.material},computeNodeMaterial:function(a){},cacheNodeMaterial:function(a){},needComputeVertexNormal:function(){return!0},needComputeLineDistance:function(){return!1},computeNodeData:function(a){if(this.computed===!1){var b=this.generatePrimitiveKey();this._attachId&&(b+="_"+this._attachId);var c=$b.PrimitiveCache.getPrimitive(b),d=!1;if(c)this.primitive&&$b.PrimitiveCache.unUsePrimitive(c),this.computeNodeMaterial(c);else{var e=this.computeData();if(this.needComputeVertexNormal()&&($b.Node.prototype.mergeVertices.call(e),$b.Node.prototype.computeFaceNormals.call(e),$b.Node.prototype.computeVertexNormals.call(e,!0)),(null==e.uv2s||0==e.uv2s.length)&&(e.uv2s=[],null!=e.uvs&&e.uvs.length>0))for(var f=0;f<e.uvs.length;f++){for(var g=[],h=e.uvs[f],i=0;i<h.length;i++)g.push(h[i].clone());e.uv2s.push(g)}c=new $b.Primitive(e,b),$b.PrimitiveCache.setPrimitive(b,c),this.cacheNodeMaterial(c),d=!0}return $b.PrimitiveCache.usePrimitive(c),this.primitive=c,this.data=c.data,this.vertices=c.vertices,this.faces=c.faces,this.uvs=c.uvs,this.uv2s=c.uv2s,this.colors=c.colors,this.needComputeLineDistance()&&(this.computeLineDistances(),this.data.lineDistances=this.lineDistances),this.computed=!0,d}},computeData:function(){var a={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=a.vertices,this.uvs=a.uvs,this.faces=a.faces,this.data=a,a},setMaterial:function(a,b,c){var d=b.getUniqueCode?b.getUniqueCode():null,e=_c.getMaterial(d);e?(this.material.materials[a]=e,_c.useMaterial(e)):(this.material.materials[a]=b,_c.setMaterial(d,b),_c.useMaterial(b)),_c.unUseMaterial(c)},onMaterialMapping:function(){this.groups=e},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==e&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=e),this.batch=!1},compareAndSetMaterial:function(a,b,c){this.setMaterial(c,b,a)},cloneStyle:function(a){if(this.getClassName()!=a.getClassName())return void console.warn("ApplyStyle fail, the source with not the same class");for(var b=this.getMaterialMapping(),c=0;c<this.getMaterialSize();c++){var d=this.material.materials[c],e=a.material.materials[c];this.compareAndSetMaterial(d,e,c)}var f=this.getMaterialMapping();$b.Utils.isSame(b,f)||(this.batch?this.materialMappingChanges=[b,f]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",b,f)))},_considerArray:function(a,b){if(!a.startsWith("envmap.image"))return uc.isArray(b);var c=!1;if(uc.isArray(b))for(var d=0;d<b.length;d++)if(uc.isArray(b[d])){c=!0;break}return c},setMaterialStyles:function(a){for(var b,c,d,e,f,g,h=this.getMaterialMapping(),h=this.getMaterialMapping(),i=0;i<this.getMaterialSize();i++){c=this.material.materials[i],d=c.clone();var j=!1;for(var k in a){var l=!1;if(k.startsWith("m."))e=k.substr(k.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(k)){var m=k.substr(0,k.indexOf(".")),f=this.getSideMaterialIndex(m);if(f!=i)continue;l=!0,g=k.substr(k.indexOf(".")+1),e=g.substr(g.indexOf(".")+1)}var n=a[k];b=n[0],null==b?b=$b.Styles.getStyle(k):this._considerArray(e,b)&&(b=b[i]),this._A97(d,e,b),j=!0}j&&this.compareAndSetMaterial(c,d,i)}this.changeMapping(h)},setMaterialStyle:function(a,b,c){var b,d,e,f,g,h=a;if(a.startsWith("m.")&&(h=a.substr(a.indexOf(".")+1)),null==c&&!$b.Utils.isArray(b)){var i=[];for(k=0;k<this.getMaterialSize();k++)i.push(b);this.styleMap[a]=i,b=i}var j=!1;if(h.startsWith("envmap.image")&&b&&uc.isArray(b))for(var k=0;k<b.length;k++){if(uc.isArray(b[k])){j=!1;break}j=!0}var l=this.getMaterialMapping();if(null!=c||$b.Utils.isArray(b)&&!j){if($b.Utils.isArray(b)){d=b;for(var k=0;k<this.getMaterialSize();k++)e=d[k],f=this.material.materials[k],g=f.clone(),null==e&&(e=$b.Styles.getStyle(a)),this._A97(g,h,e),this.compareAndSetMaterial(f,g,k)}else if(null!=c){var l=this.getMaterialMapping();f=this.material.materials[c],g=f.clone(),this._A97(g,h,b),this.compareAndSetMaterial(f,g,c),this.synchronizeIndexStyle(a,c,b)}}else for(var m=[],k=0;k<this.getMaterialSize();k++)m[k]!==!0&&(e=b,f=this.material.materials[k],g=f.clone(),null==e&&(e=$b.Styles.getStyle(a)),this._A97(g,h,e),this.compareAndSetMaterial(f,g,k));this.changeMapping(l)},changeMapping:function(a){var b=this.getMaterialMapping();$b.Utils.isSame(a,b)||(this.batch?this.materialMappingChanges=[a,b]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",a,b)))},synchronizeSideStyle:function(a,b,c){var d=this.getMaterialIndexSide(b);d&&null!=this.styleMap[d+"."+a]&&(this.styleMap[d+"."+a]=c)},synchronizeIndexStyle:function(a,b,c){var d=this.styleMap[a];if(null==d&&(d=this.getStyle(a),this.styleMap[a]=d),$b.Utils.isArray(d))d[b]=c;else{var e=[];for(i=0;i<this.getMaterialSize();i++)e.push(d);e[b]=c,this.styleMap[a]=e}},getDefaultMaterial:function(a,b){return a?a instanceof $b.ArrayMaterial?0===a.materials.length?_c.DefaultMaterial:(b>=a.materials.length&&(b=a.materials.length-1),a.materials[b]):a:_c.DefaultMaterial},createMaterial:function(a){var b=new $b.ArrayMaterial;this.material=b;for(var c=this.getMaterialSize(),d=0;c>d;d++)this.setMaterial(d,this.getDefaultMaterial(a,d))},onPropertyChange:function(a,b,c){this.changeProperty=a,this.oldGroups=this.groups;var d=this.isSizeChangedProperty(a);d&&this.onSizeChanged(),d&&this.onMaterialMapping(),d&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(a){return-1!==this.__SizePropeties.indexOf(a)||"vertices"==a||"faces"==a||"uvs"==a},isGroupChangedProperty:function(a){},getMaterialMapping:function(){var a={},b=this.material.materials;for(var c in b)a[c]=b.indexOf(b[c]);return a},getSideMaterialIndex:function(a){var b=this.getSideIndexMapping();return b?b[a]:void 0},getMaterialIndexSide:function(a){var b=this.getIndexSideMapping();return b?b[a]:void 0},getIndexSideMapping:function(){var a=this.getSideIndexMapping();if(a&&!this.IndexSideMapping){this.IndexSideMapping={};var b,c;for(b in a)c=a[b],this.IndexSideMapping[c]=b}return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var pc=function(a,b,c){this.normal=a instanceof $b.Vec3?a:new $b.Vec3,this.vertexNormals=a instanceof Array?a:[],this.color=b instanceof $b.Color?b:new $b.Color,this.vertexColors=b instanceof Array?b:[],this.materialIndex=c?c:0,this.centroid=new $b.Vec3,this.needVertexNormal=!1};$b.Face=pc,pc.prototype={constructor:$b.Face,subClone:function(){},clone:function(){var a=this.subClone();a.normal.copy(this.normal),a.color.copy(this.color),a.centroid.copy(this.centroid),a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;c>b;b++)a.vertexNormals.push(this.vertexNormals[b]);for(b=0,c=this.vertexColors.length;c>b;b++)a.vertexColors.push(this.vertexColors[b]);return a}};var qc=function(a,b,c,d,e,f){$b.Face.call(this,d,e,f),this.a=a,this.b=b,this.c=c};$b.Face3=qc,qc.prototype=Object.create($b.Face.prototype),qc.prototype.constructor=$b.Face3,qc.prototype.subClone=function(){var a=new qc(this.a,this.b,this.c);return a},qc.prototype.vertexCount=3,qc.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var rc=function(a,b,c,d,e,f,g){$b.Face.call(this,e,f,g),this.a=a,this.b=b,this.c=c,this.d=d};$b.Face4=rc,rc.prototype=Object.create($b.Face.prototype),rc.prototype.constructor=$b.Face4,rc.prototype.subClone=function(){var a=new rc(this.a,this.b,this.c,this.d);return a},rc.prototype.splitToFace3s=function(){var a=new qc(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),b=new qc(this.d,this.b,this.c,this.normal,this.color,this.materialIndex);return[a,b]},rc.prototype.vertexCount=4,rc.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},$b.Entity=function(a,b){a instanceof $b.ArrayMaterial?(this.material=a,this.materialSize=this.material.materials.length||1):a instanceof $b.Material?(this.material=a,this.materialSize=1):a&&(this.materialSize=a),this.materialSize=this.materialSize||1,this.createMaterial(this.material),b!=e&&null==this._id&&(this._id=b),$b.Node.call(this,this._id),this.groups=null},$b.extend($b.Entity,$b.Node,{constructor:$b.Entity,className:"TGL.Entity",__accessor:["computeVertexNormal"],__SizePropeties:["computeVertexNormal"],setUpdateFlags:function(a){this.verticesNeedUpdate=a,this.elementsNeedUpdate=a,this.uvsNeedUpdate=a,this.normalsNeedUpdate=a,this.colorsNeedUpdate=a,this.buffersNeedUpdate=a},cloneCallback:function(a){a&&"TGL.Entity"===this.className&&(this.computed=!1,this.computeNodeData())},needComputeVertexNormal:function(){return this.computeVertexNormal},computeData:function(){var a={vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s};return a},createCloneObject:function(){return this.constructor===$b.Entity?new $b.Entity(this.materialSize):$b.Element.prototype.createCloneObject.call(this)},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(a){"number"==typeof a&&(this.materialSize=a,this.createMaterial(this.material))},calculateNormals:function(a,b){for(var c=0,d=1,e=2,f=[],g=0;g<a.length;g+=3)f[g+c]=0,f[g+d]=0,f[g+e]=0;for(var g=0;g<b.length;g+=3){var h=[],i=[],j=[];h[c]=a[3*b[g+2]+c]-a[3*b[g+1]+c],h[d]=a[3*b[g+2]+d]-a[3*b[g+1]+d],h[e]=a[3*b[g+2]+e]-a[3*b[g+1]+e],i[c]=a[3*b[g]+c]-a[3*b[g+1]+c],i[d]=a[3*b[g]+d]-a[3*b[g+1]+d],i[e]=a[3*b[g]+e]-a[3*b[g+1]+e],j[c]=h[d]*i[e]-h[e]*i[d],j[d]=h[e]*i[c]-h[c]*i[e],j[e]=h[c]*i[d]-h[d]*i[c];for(var k=0;3>k;k++)f[3*b[g+k]+c]=f[3*b[g+k]+c]+j[c],f[3*b[g+k]+d]=f[3*b[g+k]+d]+j[d],f[3*b[g+k]+e]=f[3*b[g+k]+e]+j[e]}for(var g=0;g<a.length;g+=3){var l=[];l[c]=f[g+c],l[d]=f[g+d],l[e]=f[g+e];var m=Math.sqrt(l[c]*l[c]+l[d]*l[d]+l[e]*l[e]);0==m&&(m=1),l[c]=l[c]/m,l[d]=l[d]/m,l[e]=l[e]/m,f[g+c]=l[c],f[g+d]=l[d],f[g+e]=l[e]}return new Float32Array(f)}});var sc=function(){var a,b,c,d,e,f,g,h,i;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(g=arguments[0],a=g.width,b=g.height,c=g.depth,d=g.segmentsW,e=g.segmentsH,f=g.segmentsD,i=g.wrapMode,h=g.id):arguments[0]instanceof $b.Material?(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],e=arguments[5],f=arguments[6],i=arguments[7]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4],f=arguments[5],i=arguments[6],h=arguments[7]),this.width=a||1,this.height=b||1,this.depth=c||1,this.segmentsW=d||1,this.segmentsH=e||1,this.segmentsD=f||1,this.wrapMode=(i||"").toLowerCase(),this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,this.offset=new ac(0,0,0),this._id=h,$b.Entity.call(this)};$b.Cube=sc,$b.extend($b.Cube,$b.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(a,b){var c=this[a];if(c===b)return!1;if(this[a]=b,"wrapMode"===a){var d=this.wrapMode,e="six-each"==d||"front-other"==d||"back-other"==d||"left-other"==d||"right-other"==d||"top-other"==d||"bottom-other"==d,f=null==this.wrapMode||""==this.wrapMode?6:1;this.setMaterialSize(f),e||(this[a]="")}return!0},getLinkOffset:function(a){a.length();a.normalize();var b=a.x/this.getWidth(),c=a.y/this.getHeight(),d=a.z/this.getDepth(),e=Math.max(Math.abs(b),Math.abs(c),Math.abs(d));return e==Math.abs(b)?new ac(this.getWidth()/2*(0>b?-1:1),0,0):e==Math.abs(c)?new ac(0,this.getHeight()/2*(0>c?-1:1),0):new ac(0,0,this.getDepth()/2*(0>d?-1:1))},getLinkExtend:function(a){var b=this.worldMatrix.clone();return b=(new mono.Mat4).extractRotation(b),this.getLinkOffset(a.applyMatrix4((new cc).getInverse(b)))},computeData:function(){var a=ic.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new ac(0,0,0));return this.vertices=a.vertices,this.uvs=a.uvs,this.faces=a.faces,this.data=a,a},getSideIndexMapping:function(){return this.wrapMap?null:$b.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof $b.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+$b.Utils.toString(this.getMaterialMapping())},serialize:function(a){var b=a;1!==this.width&&b.serializeSimple("p","width",this.width,"number"),1!==this.height&&b.serializeSimple("p","height",this.height,"number"),1!==this.depth&&b.serializeSimple("p","depth",this.depth,"number"),1!==this.widthSegemtns&&b.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),1!==this.heightSegments&&b.serializeSimple("p","heightSegments",this.heightSegments,"number"),1!==this.depthSegments&&b.serializeSimple("p","depthSegments",this.depthSegments,"number"),$b.Element.serialize.call(this,b)}}),sc.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},$b.Sphere=function(){var a,b,c,d,f,g,h;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];a=i.radius,b=i.segmentsW,c=i.segmentsH,d=i.longitudeStart,f=i.longitudeLength,g=i.latitudeStart,this._id=i.id}else arguments[0]instanceof $b.Material?(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],f=arguments[5],g=arguments[6],h=arguments[7]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],f=arguments[4],g=arguments[5],h=arguments[6]);this.radius=a||50,this.segmentsW=Math.max(3,Math.floor(b)||22),this.segmentsH=Math.max(2,Math.floor(c)||15),this.longitudeStart=d!==e?d:0,this.longitudeLength=f!==e?f:2*Math.PI,this.latitudeStart=g!==e?g:0,this.latitudeLength=h!==e?h:Math.PI,this.materialSize=1,$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.extend($b.Sphere,$b.Entity,{constructor:$b.Sphere,__accessor:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],__SizePropeties:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],className:"TGL.Sphere",computeData:function(){var a=ic.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=a.vertices,this.uvs=a.uvs,this.faces=a.faces,this.data=a,a},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new $b.BoundingSphere(new $b.Vec3,this.radius))},getLinkOffset:function(a){a.length();return a.normalize(),a.multiplyScalar(this.radius)},serialize:function(a){var b=a;50!==this.radius&&b.serializeSimple(Xc,"radius",this.radius,"number"),24!==this.widthSegments&&b.serializeSimple(Xc,"widthSegments",this.widthSegments,"number"),18!==this.heightSegments&&b.serializeSimple(Xc,"heightSegments",this.heightSegments,"number"),0!==this.phiStart&&b.serializeSimple(Xc,"phiStart",this.phiStart,"number"),this.phiLength!==2*Math.PI&&b.serializeSimple(Xc,"phiLength",this.phiLength,"number"),0!==this.thetaStart&&b.serializeSimple(Xc,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&b.serializeSimple(Xc,"thetaLength",this.thetaLength,"number")}}),$b.Plane=function(){var a,b,c,d;arguments[0]instanceof $b.Material?(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]),this.width=a||5,this.height=b||5,this.segmentsW=c||1,this.segmentsH=d||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var a,b,c=this.width/2,d=this.height/2,e=this.segmentsW,f=this.segmentsH,g=e+1,h=f+1,i=this.width/e,j=this.height/f,k=new $b.Vec3(0,0,1),l={vertices:[],faces:[],uvs:[]};for(b=0;h>b;b++)for(a=0;g>a;a++){var m=a*i-c,n=b*j-d;l.vertices.push(new $b.Vec3(m,-n,0))}for(b=0;f>b;b++)for(a=0;e>a;a++){var o=a+g*b,p=a+g*(b+1),q=a+1+g*(b+1),r=a+1+g*b,s=new $b.Vec2(a/e,1-b/f),t=new $b.Vec2(a/e,1-(b+1)/f),u=new $b.Vec2((a+1)/e,1-(b+1)/f),v=new $b.Vec2((a+1)/e,1-b/f),w=new $b.Face4(o,p,q,r);w.normal.copy(k),w.vertexNormals.push(k.clone(),k.clone(),k.clone(),k.clone()),l.faces.push(w),l.uvs.push([s,t,u,v])}return l},$b.Entity.call(this),this.computeCentroids()},$b.extend($b.Plane,$b.Entity,{constructor:$b.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var a=new $b.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,a),a},getSelectStyle:function(){var a=this.getStyle("select.style");return("outline.normal"==a||"outline"==a)&&(a="outline.wireframe"),a}}),$b.Cylinder=function(){var a,b,c,d,f,g,h,i,j;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],a=options.radiusTop,b=options.radiusBottom,c=options.height,d=options.segmentsR,f=options.segmentsH,g=options.openTop,h=options.openBottom,i=options.arcLength,j=options.arcStart,this._id=options.id):arguments[0]instanceof $b.Material?(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],f=arguments[5],g=arguments[6],h=arguments[7],i=arguments[8],j=arguments[9]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],f=arguments[4],g=arguments[5],h=arguments[6],i=arguments[7],j=arguments[8]),this.radiusTop=a=a!==e?a:20,this.radiusBottom=b=b!==e?b:20,this.height=c=c!==e?c:100,this.segmentsR=d=d||20,this.segmentsH=f=f||1,this.openTop=g!==e?g:!1,this.openBottom=h!=e?h:!1,this.arcLength=i!==e?i:2*Math.PI,this.arcStart=j!==e?j:0,this.materialSize=3,$b.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},$b.extend($b.Cylinder,$b.Entity,{constructor:$b.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return ic.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(a){var b=a.length();a.normalize();var c=a.x,d=a.y,e=a.z,f=Math.sqrt(c*c+e*e),g=d>0?this.radiusTop:this.radiusBottom;if(Math.abs(d/f)>this.height/2/g&&b>0){var h=new ac(0,this.height/2*(d>0?1:-1),0);return h}return new ac(c,0,e).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(a){var b=this.worldMatrix.clone();return b=(new mono.Mat4).extractRotation(b),this.getLinkOffset(a.applyMatrix4((new cc).getInverse(b)))},clearLinkOrthogonal:function(a,b,c,d){d=d||0;var e=this.getHeight()/2+d,f=(this.radiusTop+this.radiusBottom)/2+d;return"orthogonal.x"==c||"orthogonal.x.n"==c?!(Math.abs(a.y-b.y)>e||Math.abs(a.z-b.z)>f):"orthogonal.y"==c||"orthogonal.y.n"==c?!(Math.abs(a.x-b.x)>f||Math.abs(a.z-b.z)>f):"orthogonal.z"==c||"orthogonal.z.n"==c?!(Math.abs(a.y-b.y)>e||Math.abs(a.z-b.z)>f):!1},clearLinkExtend:function(a,b){return"extend.x"!==b&&"extend.y"===b&&a>this.getHeight()/2?!0:!1},getSideIndexMapping:function(){return $b.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+$b.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),$b.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},$b.Circle=function(){var a,b,c,d;4===arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]):(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4]),this.radius=a=a||50,this.segments=b=b!==e?Math.max(3,b):8,this.thetaStart=c=c!==e?c:0,this.thetaLength=d=d!==e?d:2*Math.PI,this.materialSize=1,$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new $b.BoundingSphere(new $b.Vec3,a)},$b.extend($b.Circle,$b.Entity,{clone:function(){var a=new $b.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,a),a},computeData:function(){var a,b=this.segments,c=[],d=new $b.Vec3,e=new $b.Vec2(.5,.5),f={vertices:[],faces:[],uvs:[],uv2s:[]};for(f.vertices.push(d),c.push(e),a=0;b>=a;a++){var g=new $b.Vec3,h=this.thetaStart+a/b*this.thetaLength;g.x=this.radius*Math.cos(h),g.y=this.radius*Math.sin(h),f.vertices.push(g),c.push(new $b.Vec2((g.x/this.radius+1)/2,(g.y/this.radius+1)/2))}var i=new $b.Vec3(0,0,1);for(a=1;b>=a;a++){var j=a,k=a+1,l=0;f.faces.push(new $b.Face3(j,k,l,[i,i,i])),f.uvs.push([c[a],c[a+1],e])}return f}}),$b.Torus=function(){var a,b,c,d,e;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],a=options.radius,b=options.tube,c=options.segmentsR,d=options.segmentsT,e=options.arc,this._id=options.id):arguments[0]instanceof $b.Material?(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],e=arguments[5]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4]),this.materialSize=1,this.radius=a||100,this.tube=b||40,this.segmentsR=c||8,this.segmentsT=d||6,this.arc=e||2*Math.PI,$b.Entity.call(this),this.computeNodeData(),this.computeCentroids()},$b.extend($b.Torus,$b.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){for(var a=new $b.Vec3,b=[],c=[],d={vertices:[],faces:[],uvs:[],uv2s:[]},e=0;e<=this.segmentsR;e++)for(var f=0;f<=this.segmentsT;f++){var g=f/this.segmentsT*this.arc,h=e/this.segmentsR*Math.PI*2;a.x=this.radius*Math.cos(g),a.y=this.radius*Math.sin(g);var i=new $b.Vec3;i.x=(this.radius+this.tube*Math.cos(h))*Math.cos(g),i.y=(this.radius+this.tube*Math.cos(h))*Math.sin(g),i.z=this.tube*Math.sin(h),d.vertices.push(i),b.push(new $b.Vec2(f/this.segmentsT,e/this.segmentsR)),c.push(i.clone().sub(a).normalize())}for(var e=1;e<=this.segmentsR;e++)for(var f=1;f<=this.segmentsT;f++){var j=(this.segmentsT+1)*e+f-1,k=(this.segmentsT+1)*(e-1)+f-1,l=(this.segmentsT+1)*(e-1)+f,m=(this.segmentsT+1)*e+f,n=new $b.Face3(j,k,m,[c[j],c[k],c[m]]);n.normal.add(c[j]),n.normal.add(c[k]),n.normal.add(c[m]),n.normal.normalize(),d.faces.push(n),d.uvs.push([b[j].clone(),b[k].clone(),b[m].clone()]),n=new $b.Face3(k,l,m,[c[k],c[l],c[m]]),n.normal.add(c[k]),n.normal.add(c[l]),n.normal.add(c[m]),n.normal.normalize(),d.faces.push(n),d.uvs.push([b[k].clone(),b[l].clone(),b[m].clone()])}return d}}),$b.Arrow=function(){var a,b,c,d,e;arguments[0]instanceof $b.Material?(this.material=arguments[0],a=arguments[1],b=arguments[2],c=arguments[3],d=arguments[4],e=arguments[5]):(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4]),this.materialSize=1,this.tailHeight=a||100,this.tailRadius=b||20,this.headHeight=c||20,this.headRadius=d||30,this.radiusSegments=e||30,$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.extend($b.Arrow,$b.Entity,{constructor:$b.Arrow,className:"TGL.Arrow",computeData:function(){var a=2,b=this.tailHeight,c=this.tailRadius,d=this.headHeight,e=this.headRadius,f=this.radiusSegments;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var g,h,i=b+d,j=i/2,k=[],l=[],m=[],n=[];for(h=0;a>=h;h++){var o=[],p=[],q=h/a,r=q*e;for(g=0;f>=g;g++){var s=g/f,t=new $b.Vec3;t.x=r*Math.sin(s*Math.PI*2),t.y=-q*d+j,t.z=r*Math.cos(s*Math.PI*2),this.vertices.push(t),o.push(this.vertices.length-1),p.push(new $b.Vec2(s,1-q))}k.push(o),m.push(p)}for(this.vertices.push(new $b.Vec3(0,j-d,0)),h=0;a>=h;h++){var o=[],p=[],q=h/a,r=c;for(g=0;f>=g;g++){var s=g/f,t=new $b.Vec3;t.x=r*Math.sin(s*Math.PI*2),t.y=-q*b+j-d,t.z=r*Math.cos(s*Math.PI*2),this.vertices.push(t),o.push(this.vertices.length-1),p.push(new $b.Vec2(s,1-q))}l.push(o),n.push(p)}this.vertices.push(new $b.Vec3(0,-j,0));var u,v,w=this.headRadius/i;for(g=0;f>g;g++)for(u=this.vertices[k[0][g]].clone(),v=this.vertices[k[0][g+1]].clone(),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*w).normalize(),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*w).normalize(),h=0;a>h;h++){var x=k[h][g],y=k[h+1][g],z=k[h+1][g+1],A=k[h][g+1],B=u.clone(),C=u.clone(),D=v.clone(),E=v.clone(),F=m[h][g].clone(),G=m[h+1][g].clone(),H=m[h+1][g+1].clone(),I=m[h][g+1].clone();this.faces.push(new $b.Face3(x,y,A,[B,C,E])),this.uvs.push([F,G,I]),this.faces.push(new $b.Face3(y,z,A,[C,D,E])),this.uvs.push([G,H,I])}for(g=0;f>g;g++){var x=k[h][g+1],y=k[h][g],z=k.length-1,B=new $b.Vec3(0,-1,0),C=new $b.Vec3(0,-1,0),D=new $b.Vec3(0,-1,0),F=m[h][g+1].clone(),G=m[h][g].clone(),H=new $b.Vec2(G.u,1);this.faces.push(new $b.Face3(x,y,z,[B,C,D])),this.uvs.push([F,G,H])}var u,v,w=0;for(g=0;f>g;g++)for(u=this.vertices[l[1][g]].clone(),v=this.vertices[l[1][g+1]].clone(),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*w).normalize(),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*w).normalize(),h=0;a>h;h++){var x=l[h][g],y=l[h+1][g],z=l[h+1][g+1],A=l[h][g+1],B=u.clone(),C=u.clone(),D=v.clone(),E=v.clone(),F=m[h][g].clone(),G=m[h+1][g].clone(),H=m[h+1][g+1].clone(),I=m[h][g+1].clone();this.faces.push(new $b.Face3(x,y,A,[B,C,E])),this.uvs.push([F,G,I]),this.faces.push(new $b.Face3(y,z,A,[C,D,E])),this.uvs.push([G,H,I])}for(g=0;f>g;g++){var x=l[h][g+1],y=l[h][g],z=l.length-1,B=new $b.Vec3(0,-1,0),C=new $b.Vec3(0,-1,0),D=new $b.Vec3(0,-1,0),F=n[h][g+1].clone(),G=n[h][g].clone(),H=new $b.Vec2(G.u,1);this.faces.push(new $b.Face3(x,y,z,[B,C,D])),this.uvs.push([F,G,H])}return this;
}}),$b.BufferNode=function(){this.uuid=$b.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.materialSize=1,this.createMaterial(),$b.Node.call(this)},$b.extend($b.BufferNode,$b.Node,{constructor:$b.BufferNode,compuateBufferData:function(){if(!this.computed){var a=this.attributes.position;a&&a.array&&(a.itemSize=3,a.numItems=a.array.length,this.verticesNeedUpdate=!0);var b=this.attributes.uv;b&&b.array&&(b.itemSize=2,b.numItems=b.array.length,this.uvsNeedUpdate=!0);var c=this.attributes.index;c&&c.array&&(this.offsets=[{index:0,start:0,count:c.array.length}]),this.computed=!0}},applyMatrix:function(a){var b,c;if(this.attributes.position&&(b=this.attributes.position.array),this.attributes.normal&&(c=this.attributes.normal.array),b!==e&&(a.multiplyVec3Array(b),this.verticesNeedUpdate=!0),c!==e){var d=(new $b.Matrix3).getNormalMatrix(a);d.multiplyVec3Array(c),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $b.BoundingBox);var a=this.attributes.position.array;if(a){var b,c,d,f=this.boundingBox;a.length>=3&&(f.min.x=f.max.x=a[0],f.min.y=f.max.y=a[1],f.min.z=f.max.z=a[2]);for(var g=3,h=a.length;h>g;g+=3)b=a[g],c=a[g+1],d=a[g+2],b<f.min.x?f.min.x=b:b>f.max.x&&(f.max.x=b),c<f.min.y?f.min.y=c:c>f.max.y&&(f.max.y=c),d<f.min.z?f.min.z=d:d>f.max.z&&(f.max.z=d)}(a===e||0===a.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var a=new $b.BoundingBox,b=new $b.Vec3;return function(){null===this.boundingSphere&&(this.boundingSphere=new $b.BoundingSphere);var c=this.attributes.position.array;if(c){for(var d=this.boundingSphere.center,e=[],f=0,g=c.length;g>f;f+=3)b.set(c[f],c[f+1],c[f+2]),e.push(b);a.setFromPoints(e),a.center(d);for(var h=0,f=0,g=c.length;g>f;f+=3)b.set(c[f],c[f+1],c[f+2]),h=Math.max(h,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(h)}}}(),computeVertexNormals:function(){if(this.attributes.position){var a,b,c,d,f=this.attributes.position.array.length;if(this.attributes.normal===e)this.attributes.normal={itemSize:3,array:new Float32Array(f)};else for(a=0,b=this.attributes.normal.array.length;b>a;a++)this.attributes.normal.array[a]=0;var g,h,i,j,k,l,m=this.attributes.position.array,n=this.attributes.normal.array,o=new $b.Vec3,p=new $b.Vec3,q=new $b.Vec3,r=new $b.Vec3,s=new $b.Vec3;if(this.attributes.index){var t=this.attributes.index.array,u=this.offsets;for(c=0,d=u.length;d>c;++c){var v=u[c].start,w=u[c].count,x=u[c].index;for(a=v,b=v+w;b>a;a+=3)g=x+t[a],h=x+t[a+1],i=x+t[a+2],j=m[3*g],k=m[3*g+1],l=m[3*g+2],o.set(j,k,l),j=m[3*h],k=m[3*h+1],l=m[3*h+2],p.set(j,k,l),j=m[3*i],k=m[3*i+1],l=m[3*i+2],q.set(j,k,l),r.subVectors(q,p),s.subVectors(o,p),r.cross(s),n[3*g]+=r.x,n[3*g+1]+=r.y,n[3*g+2]+=r.z,n[3*h]+=r.x,n[3*h+1]+=r.y,n[3*h+2]+=r.z,n[3*i]+=r.x,n[3*i+1]+=r.y,n[3*i+2]+=r.z}}else for(a=0,b=m.length;b>a;a+=9)j=m[a],k=m[a+1],l=m[a+2],o.set(j,k,l),j=m[a+3],k=m[a+4],l=m[a+5],p.set(j,k,l),j=m[a+6],k=m[a+7],l=m[a+8],q.set(j,k,l),r.subVectors(q,p),s.subVectors(o,p),r.cross(s),n[a]=r.x,n[a+1]=r.y,n[a+2]=r.z,n[a+3]=r.x,n[a+4]=r.y,n[a+5]=r.z,n[a+6]=r.x,n[a+7]=r.y,n[a+8]=r.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var a,b,c,d,e=this.attributes.normal.array,f=0,g=e.length;g>f;f+=3)a=e[f],b=e[f+1],c=e[f+2],d=1/Math.sqrt(a*a+b*b+c*c),e[f]*=d,e[f+1]*=d,e[f+2]*=d},clone:function(){var a=new $b.BufferNode,b=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var c in this.attributes){for(var d=this.attributes[c],e=d.array,f={itemSize:d.itemSize,numItems:d.numItems,array:null},g=0,h=b.length;h>g;g++){var i=b[g];if(e instanceof i){f.array=new i(e);break}}a.attributes[c]=f}for(var g=0,h=this.offsets.length;h>g;g++){var j=this.offsets[g];a.offsets.push({start:j.start,index:j.index,count:j.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}}),$b.Particle=function(a,b,c){var d;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])&&(d=arguments[0],this._id=d.id),$b.Node.call(this,this._id),this.material=new $b.ParticleMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(d?d.vertices:a)||[],this.colors=(d?d.colors:b)||[],this.sizes=(d?d.sizes:c)||[],this.setUpdateFlags(!0)},$b.extend($b.Particle,$b.Node,{clone:function(a){return a===e&&(a=new $b.Particle(this.material)),a.sortParticles=this.sortParticles,a.frustumCulled=this.frustumCulled,$b.Element.prototype.clone.call(this,a),a},needUpdate:function(){return!1},setUpdateFlags:function(a){this.verticesNeedUpdate=a,this.dirtyColors=a,this.normalsNeedUpdate=a},setMaterialStyle:function(a,b){a=a.substr(a.indexOf(".")+1),this._A97(this.material,a,b)}}),$b.Line=function(a){this.material=new $b.LineMaterial({color:16777215}),$b.Node.call(this,a),this.type=this.type!==e?this.type:$b.LineStrip},$b.LineStrip=0,$b.LinePieces=1,$b.extend($b.Line,$b.Node,{className:"TGL.Line",__accessor:["vertices","type","colors"],__SizePropeties:["vertices","type","colors"],clone:function(a){return a===e&&(a=new $b.Line(this.material,this.type)),$b.Element.prototype.clone.call(this,a,!0),a},onPropertyChange:function(a,b,c){},setMaterialStyle:function(a,b){a=a.substr(a.indexOf(".")+1),this._A97(this.material,a,b)},setMaterialStyles:function(a){$b.Element.prototype.setMaterialStyles.call(this,a)}}),$b.Line.createEllipse=function(a,b,c,d,e,f,g){"number"==typeof a?(g=f,f=e,e=d,d=c,c=b,b=a,a=new $b.Line):null==a&&(a=new $b.Line);for(var h=new $b.EllipseCurve(0,0,b,c,e,f,g),i=[],j=d||50,k=0;j>=k;k++){var l=h.getPoint(k/j);i.push(l)}return a.setVertices(i),a},$b.Line.createHelix=function(a,b,c,d,e,f){"number"==typeof a?(f=e,e=d,d=c,c=b,b=a,a=new $b.Line):null==a&&(a=new $b.Line);var g=[],h=f||50;e=e||1;for(var i,j,k,l,m=0;h>=m;m++)i=(c*m+b*(h-m))/h,k=e*Math.PI*2*m/h,j=d*(.5-m/h),l=new ac(i*Math.sin(k),j,i*Math.cos(k)),g.push(l);return a.setVertices(g),a},$b.Line.createRectangle=function(a,b,c,d){"number"==typeof a?(d=c||1,c=b,b=a,a=new $b.Line):null==a&&(a=new $b.Line);var e=d||50,f=2*(b+c)/e,g=[];if(f>Math.min(b,c))g.push(new ac(-b/2,-c/2,0)),g.push(new ac(-b/2,c/2,0)),g.push(new ac(b/2,c/2,0)),g.push(new ac(b/2,-c/2,0)),g.push(new ac(-b/2,-c/2,0));else for(var h,i=-b/2,j=-c/2,k=0;e>=k;k++)i==-b/2&&c/2>j?c/2>=j+f?j+=f:(g.push(new ac(-b/2,c/2,0)),g.push(new ac(-b/2,c/2,0)),i+=j+f-c/2,j=c/2):j==c/2&&b/2>=i?b/2>=i+f?i+=f:(g.push(new ac(b/2,c/2,0)),g.push(new ac(b/2,c/2,0)),j-=i+f-b/2,i=b/2):i==b/2&&j>-c/2?j-f>=-c/2?j-=f:(g.push(new ac(b/2,-c/2,0)),g.push(new ac(b/2,-c/2,0)),i-=-c/2-j+f,j=-c/2):j==-c/2&&i>=-b/2&&(i-f>=-b/2?i-=f:(j+=-b/2-i+f,i=-b/2)),h=new ac(i,j,0),g.push(h);return a.setVertices(g),a},$b.Line.createNurbs=function(a,b,c,d,e){if("[object Array]"===toString.apply(a)?(e=d,d=c,c=b,b=a,a=new $b.Line):null==a&&(a=new $b.Line),e){var f=a.material;f.skyY=e.skyY||0,f.horizonY=e.horizonY||0,f.earthY=e.earthY||0,f.skyColor=e.skyColor||new mono.Color(16777215),f.horizonColor=e.horizonColor||new mono.Color(16777215),f.earthColor=e.earthColor||new mono.Color(16777215)}c>b.length-1&&(console.log("max degree is :",b.length-1),c=b.length-1);for(var g=[],h=0;c>=h;h++)g.push(0);for(var h=0,i=b.length;i>h;h++){var j=(h+1)/(i-c);g.push(mono.Math.clamp(j,0,1))}var k=new mono.NurbsCurve(c,g,b);return a.setVertices(k.getPoints(b.length*d)),a},$b.Line.createDottedLine=function(a,b,c,d){a instanceof Array?(c=b,b=a,a=new $b.Line):null==a&&(a=new $b.Line);for(var e=[],f=b[0],g=1;g<b.length;g++){var h=b[g],i=h.distanceTo(f),d=i/(c[0]+c[1])||20,j=f.x,k=f.y,l=f.z,m=h.x,n=h.y,o=h.z,p=(m-j)/d,q=(n-k)/d,r=(o-l)/d,s=c[0]/(c[0]+c[1]),t=p*s,u=q*s,v=r*s;e.push(new mono.Vec3(j,k,l));for(var w=0;d>w;w++){var x=j+w*p,y=k+w*q,z=l+w*r;e.push(new mono.Vec3(x,y,z));var x=j+w*p+t,y=k+w*q+u,z=l+w*r+v;e.push(new mono.Vec3(x,y,z))}f=h}return a.setVertices(e),a},$b.LineX=function(){var a,b,c;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var d=arguments[0];a=d.points,b=d.colors,c=d.lineWidth,this._id=d.id||this._id}else a=arguments[0],b=arguments[1],c=arguments[2];this.material=new $b.LineXMaterial({color:16777215}),this.points=a||[],this.colors=b||[],this.lineWidth=c||1,$b.Entity.call(this,this.material,this._id)},$b.extend($b.LineX,$b.Entity,{__accessor:["points","colors","lineWidth"],__SizePropeties:["points","colors","lineWidth"],computeData:function(){var a=this.points,b=this.colors,c={vertices:[],verticesPrev:[],verticesNext:[],offset:[],faces:[]},d=b.length;0!=d&&(c.colors=[]);for(var e=a.length,f=c.vertices,g=c.verticesPrev,h=c.verticesNext,i=c.offset,j=c.faces,k=this.lineWidth,l=0;e>l;l++){var m=a[l],n=new ac(m.x,m.y,m.z);if(f.push(n),f.push(n.clone()),i.push(k/2),i.push(-k/2),c.colors){var o=Math.floor(l*d/e),p=b[o];p instanceof $b.Color||(p=new $b.Color(p)),c.colors.push(p),c.colors.push(p.clone())}}for(l=0;e>l;l++){var q=2*l,r=q>=2?q-2:0,s=e-2>q?q+2:2*e-1,n=f[r];g.push(n.clone()),g.push(n.clone()),n=f[s],h.push(n.clone()),h.push(n.clone())}var t=e-1;for(l=0;t>l;l++){var q=2*l,u=new qc(q,q+1,q+2);u.materialIndex=0,j.push(u),u=new qc(q+2,q+1,q+3),u.materialIndex=0,j.push(u)}return c},needComputeVertexNormal:function(){return!1},needComputeLineDistance:function(){return!0}}),$b.PathLine=function(){var a,b,c;if(1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof $b.Path)){var d=arguments[0];a=d.path,b=d.segments,c=d.type,this._id=d.id||this._id}else a=arguments[0],b=arguments[1],c=arguments[2],this._id=arguments[3];$b.Line.call(this,{vertices:[],colors:[],type:c,id:this._id}),this.segments=b||20,this.setPath(a)},$b.extend($b.PathLine,$b.Line,{constructor:$b.PathLine,className:"TGL.PathLine",__accessor:["path","segments"],__SizePropeties:["path","segments"],onPropertyChange:function(){this.computeNodeData()},computeNodeData:function(){this.computeData()},adjustPath:function(a){return a},computeData:function(){var a=this.path;if(a){a=this.adjustPath(a);var b,c,d,e,f=a.curves.length,g=a.curves,h=[],i=a.getLength(),j=0,k=this.segments;for(p=0;f>p;p++){if(c=g[p],d=c.getLength(),c instanceof $b.LineCurve3){var l=j/i,m=(d+j)/i;h.push(l),h.push(m)}else for(e=p>0?1:0;k>=e;e++){var n=(d*e/k+j)/i;h.push(n)}j+=d}for(var o=[],p=0;p<h.length;p++)b=h[p],pos=a.getPointAt(b),o.push(pos);return this.vertices=o,[]}}}),$b.Polyhedron=function(){function a(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=d(a)/2/Math.PI+.5,f=e(a)/Math.PI+.5;return b.uv=new $b.Vec3(c,1-f),b}function b(a,b,c){var e=new $b.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);e.centroid.add(a).add(b).add(c).divideScalar(3),k.faces.push(e);var g=d(e.centroid);k.uvs.push([f(a.uv,a,g),f(b.uv,b,g),f(c.uv,c,g)])}function c(c,d){for(var e=Math.pow(2,d),f=(Math.pow(4,d),a(k.vertices[c.a])),g=a(k.vertices[c.b]),h=a(k.vertices[c.c]),i=[],j=0;e>=j;j++){i[j]=[];for(var l=a(f.clone().lerp(h,j/e)),m=a(g.clone().lerp(h,j/e)),n=e-j,o=0;n>=o;o++)0==o&&j==e?i[j][o]=l:i[j][o]=a(l.clone().lerp(m,o/n))}for(var j=0;e>j;j++)for(var o=0;2*(e-j)-1>o;o++){var p=Math.floor(o/2);o%2==0?b(i[j][p+1],i[j+1][p],i[j][p]):b(i[j][p+1],i[j+1][p+1],i[j+1][p])}}function d(a){return Math.atan2(a.z,-a.x)}function e(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function f(a,b,c){return 0>c&&1===a.x&&(a=new $b.Vec3(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new $b.Vec3(c/2/Math.PI+.5,a.y)),a.clone()}var g,h,i,j;arguments[0]instanceof $b.Material?(this.material=arguments[0],g=arguments[1],h=arguments[2],i=arguments[3],j=arguments[4]):(g=arguments[0],h=arguments[1],i=arguments[2],j=arguments[3]),this.materialSize=1,$b.Entity.call(this),i=i||1,j=j||0;for(var k=this,l=0,m=g.length;m>l;l++)a(new $b.Vec3(g[l][0],g[l][1],g[l][2]));for(var n=this.vertices,o=[],l=0,m=h.length;m>l;l++){var p=n[h[l][0]],q=n[h[l][1]],r=n[h[l][2]];o[l]=new $b.Face3(p.index,q.index,r.index,[p.clone(),q.clone(),r.clone()])}for(var l=0,m=o.length;m>l;l++)c(o[l],j);for(var l=0,m=this.uvs.length;m>l;l++){var s=this.uvs[l],t=s[0].x,u=s[1].x,v=s[2].x,w=Math.max(t,Math.max(u,v)),x=Math.min(t,Math.min(u,v));w>.9&&.1>x&&(.2>t&&(s[0].x+=1),.2>u&&(s[1].x+=1),.2>v&&(s[2].x+=1))}for(var l=0,m=this.vertices.length;m>l;l++)this.vertices[l].multiplyScalar(i);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new $b.BoundingSphere(new $b.Vec3,i)},$b.extend($b.Polyhedron,$b.Entity,{}),$b.Octahedron=function(a,b,c){var d=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],e=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];$b.Polyhedron.call(this,a,d,e,b,c)},$b.extend($b.Octahedron,$b.Polyhedron,{clone:function(){return new $b.Octahedron(this.material,this.radius,this.detail)}}),$b.Axis=function(a){var b=a&&a.size||1,c=[],d=[];c.push(new $b.Vec3,new $b.Vec3(b,0,0),new $b.Vec3,new $b.Vec3(0,b,0),new $b.Vec3,new $b.Vec3(0,0,b)),d.push(new $b.Color(16711680),new $b.Color(16711680),new $b.Color(65280),new $b.Color(65280),new $b.Color(255),new $b.Color(255));var e=new $b.LineMaterial({vertexColors:$b.VertexColors,depthTest:!1,depthMask:!1});$b.Line.call(this,{vertices:c,colors:d,type:$b.LinePieces,size:b}),this.material=e,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.xAxisText.setPosition(b,0,0),this.yAxisText.setPosition(0,b,0),this.zAxisText.setPosition(0,0,b),this._sizeFixed=!0},$b.extend($b.Axis,$b.Line,{showAxisText:function(a){this.xAxisText._visible=a,this.yAxisText._visible=a,this.zAxisText._visible=a},setSize:function(a){this.vertices[1].x=a,this.vertices[3].y=a,this.vertices[5].z=a},fixSize:function(a){$b.Element.prototype.fixSize.call(this,a);this._scale.x,this._scale.y,this._scale.z;this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(a,b){var c="Arial",d=36,e=$b.BillboardAlignment.topLeft,f=document.createElement("canvas"),g=f.getContext("2d");g.font="Bold "+d+"px "+c,b instanceof $b.Color||(b=new $b.Color(b));var h=g.measureText(a),i=h.width;f.width=uc.nextPowerOfTwo(i),f.height=uc.nextPowerOfTwo(2*g.measureText("e").width+4),g.fillStyle="rgba("+255*b.r+", "+255*b.g+", "+255*b.b+", 1.0)",g.fillText(a,0,10);var j=new $b.Texture(f),k=new $b.BillboardMaterial({map:j,useScreenCoordinates:!1,alignment:e,depthTest:!1,depthMask:!1}),l=new $b.Billboard;return l.material=k,l}}),$b.Curve=function(){},$b.Curve.prototype.getPoint=function(a){return console.log("Warning, getPoint() not implemented!"),null},$b.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)},$b.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;a>=b;b++)c.push(this.getPoint(b/a));return c},$b.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;a>=b;b++)c.push(this.getPointAt(b/a));return c},$b.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]},$b.Curve.prototype.getLengths=function(a){if(a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,c,d=[],e=this.getPoint(0),f=0;for(d.push(0),c=1;a>=c;c++)b=this.getPoint(c/a),f+=b.distanceTo(e),d.push(f),e=b;return this.cacheArcLengths=d,d},$b.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},$b.Curve.prototype.getUtoTmapping=function(a,b){var c,d=this.getLengths(),e=0,f=d.length;c=b?b:a*d[f-1];for(var g,h=0,i=f-1;i>=h;)if(e=Math.floor(h+(i-h)/2),g=d[e]-c,0>g)h=e+1;else{if(!(g>0)){i=e;break}i=e-1}if(e=i,d[e]==c){var j=e/(f-1);return j}var k=d[e],l=d[e+1],m=l-k,n=(c-k)/m,j=(e+n)/(f-1);return j},$b.Curve.prototype.getTangent=function(a){var b=1e-4,c=a-b,d=a+b;0>c&&(c=0),d>1&&(d=1);var e=this.getPoint(c),f=this.getPoint(d),g=f.clone().sub(e);return g.normalize()},$b.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)},$b.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){var f=6*a*a-6*a,g=3*a*a-4*a+1,h=-6*a*a+6*a,i=3*a*a-2*a;return f+g+h+i},interpolate:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}},$b.Curve.create=function(a,b){return a.prototype=Object.create($b.Curve.prototype),a.prototype.getPoint=b,a},$b.LineCurve=function(a,b){this.v1=a,this.v2=b},$b.LineCurve.prototype=Object.create($b.Curve.prototype),$b.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);return b.multiplyScalar(a).add(this.v1),b},$b.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},$b.LineCurve.prototype.getTangent=function(a){var b=this.v2.clone().sub(this.v1);return b.normalize()},$b.LineCurve3=function(a,b){this.v1=a,this.v2=b,this.getPoint=function(a){var b=new $b.Vec3;return b.subVectors(this.v2,this.v1),b.multiplyScalar(a),b.add(this.v1),b}},$b.extend($b.LineCurve3,$b.Curve,{}),$b.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},$b.CurvePath.prototype=Object.create($b.Curve.prototype),$b.CurvePath.prototype.add=function(a){this.curves.push(a)},$b.CurvePath.prototype.checkConnection=function(){},$b.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new $b.LineCurve3(b,a))},$b.CurvePath.prototype.getPoint=function(a){for(var b,c,d=a*this.getLength(),e=this.getCurveLengths(),f=0;f<e.length;){if(e[f]>=d){b=e[f]-d,c=this.curves[f];var g=1-b/c.getLength();return c.getPointAt(g)}f++}return null},$b.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},$b.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a,b=[],c=0,d=this.curves.length;for(a=0;d>a;a++)c+=this.curves[a].getLength(),b.push(c);return this.cacheLengths=b,b},$b.CurvePath.prototype.getBoundingBox=function(){var a,b,c,d,e,f,g=this.getPoints();a=b=Number.NEGATIVE_INFINITY,d=e=Number.POSITIVE_INFINITY;var h,i,j,k,l=g[0]instanceof $b.Vec3;for(k=l?new $b.Vec3:new $b.Vec2,i=0,j=g.length;j>i;i++)h=g[i],h.x>a?a=h.x:h.x<d&&(d=h.x),h.y>b?b=h.y:h.y<e&&(e=h.y),l&&(h.z>c?c=h.z:h.z<f&&(f=h.z)),k.add(h);var m={minX:d,minY:e,maxX:a,maxY:b,centroid:k.divideScalar(j)};return l&&(m.maxZ=c,m.minZ=f),m},$b.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,!0);return this.createGeometry(b)},$b.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,!0);return this.createGeometry(b)},$b.CurvePath.prototype.createGeometry=function(a){for(var b=new $b.Entity,c=0;c<a.length;c++)b.vertices.push(new $b.Vec3(a[c].x,a[c].y,a[c].z||0));return b},$b.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)},$b.CurvePath.prototype.getTransformedPoints=function(a,b){var c,d,e=this.getPoints(a);for(b||(b=this.bends),c=0,d=b.length;d>c;c++)e=this.getWrapPoints(e,b[c]);return e},$b.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c,d,e=this.getSpacedPoints(a);for(b||(b=this.bends),c=0,d=b.length;d>c;c++)e=this.getWrapPoints(e,b[c]);return e},$b.CurvePath.prototype.getWrapPoints=function(a,b){var c,d,e,f,g,h,i=this.getBoundingBox();for(c=0,d=a.length;d>c;c++){e=a[c],f=e.x,g=e.y,h=f/i.maxX,h=b.getUtoTmapping(h,f);var j=b.getPoint(h),k=b.getTangent(h);k.set(-k.y,k.x).multiplyScalar(g),e.x=j.x+k.x,e.y=j.y+k.y}return a},$b.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e||0,this.aEndAngle=f||2*Math.PI,this.aClockwise=g},$b.EllipseCurve.prototype=Object.create($b.Curve.prototype),$b.EllipseCurve.prototype.getPoint=function(a){var b,c=this.aEndAngle-this.aStartAngle;0>c&&(c+=2*Math.PI),c>2*Math.PI&&(c-=2*Math.PI),b=this.aClockwise===!0?this.aEndAngle+(1-a)*(2*Math.PI-c):this.aStartAngle+a*c;var d=this.aX+this.xRadius*Math.cos(b),e=this.aY+this.yRadius*Math.sin(b);return new $b.Vec3(d,e,0)},$b.ArcCurve=function(a,b,c,d,e,f){$b.EllipseCurve.call(this,a,b,c,c,d,e,f)},$b.ArcCurve.prototype=Object.create($b.EllipseCurve.prototype),$b.NurbsCurve=function(a,b,c){this.degree=a||3,this.knots=b||[],this.ctrlPoints=[];for(var d=0;d<c.length;++d){var e=c[d];this.ctrlPoints[d]=new $b.Vec4(e.x,e.y,e.z,e.w)}},$b.NurbsCurve.prototype=Object.create($b.Curve.prototype),$b.NurbsCurve.prototype.constructor=$b.NurbsCurve,$b.NurbsCurve.prototype.getPoint=function(a){var b=this.knots[0]+a*(this.knots[this.knots.length-1]-this.knots[0]),c=$b.NurbsUtils.calcBSplinePoint(this.degree,this.knots,this.ctrlPoints,b);return 1!=c.w&&c.divideScalar(c.w),new $b.Vec3(c.x,c.y,c.z)},$b.NurbsCurve.prototype.getTangent=function(a){var b=this.knots[0]+a*(this.knots[this.knots.length-1]-this.knots[0]),c=$b.NurbsUtils.calcNURBSDerivatives(this.degree,this.knots,this.ctrlPoints,b,1),d=c[1].clone();return d.normalize(),d},$b.NurbsSurface=function(a,b,c){this.degreeU=a,this.degreeV=b,this.knotsU=this.calculateKnots(a,c.length),this.knotsV=this.calculateKnots(b,c[0].length),this.ctlPoints=[];for(var d=c.length,e=c[0].length,f=0;d>f;++f){this.ctlPoints[f]=[];for(var g=0;e>g;++g){var h=c[f][g];this.ctlPoints[f][g]=new $b.Vec4(h.x,h.y,h.z,h.w)}}},$b.NurbsSurface.prototype={constructor:$b.NurbsSurface,calculateKnots:function(a,b){for(var c=[],d=0;a>=d;d++)c.push(0);for(var d=0;b>d;d++){var e=(d+1)/(b-a);c.push(mono.Math.clamp(e,0,1))}return c},getPoint:function(a,b){var c=this.knotsU[0]+a*(this.knotsU[this.knotsU.length-1]-this.knotsU[0]),d=this.knotsV[0]+b*(this.knotsV[this.knotsV.length-1]-this.knotsV[0]);return $b.NurbsUtils.calcSurfacePoint(this.degreeU,this.degreeV,this.knotsU,this.knotsV,this.ctlPoints,c,d)}},$b.Surface=function(a,b,c,d){this.parameters={func:function(b,c){return a.getPoint(b,c)},slices:b,stacks:c},this.ctrlCond=d,this.material=new $b.SurfaceMaterial,$b.Entity.call(this)},$b.extend($b.Surface,$b.Entity,{constructor:$b.Surface,className:"TGL.Surface",createMaterial:function(a){var b=new $b.ArrayMaterial;this.material=b;for(var c=this.ctrlCond,d=this.getMaterialSize(),e=0;d>e;e++){var b=this.getDefaultMaterial(a,e);c&&(b.skyY=c.skyY||0,b.horizonY=c.horizonY||0,b.earthY=c.earthY||0,b.skyColor=c.skyColor||new mono.Color(16777215),b.horizonColor=c.horizonColor||new mono.Color(16777215),b.earthColor=c.earthColor||new mono.Color(16777215)),this.setMaterial(e,b)}},setMaterial:function(a,b,c){var d=b.getUniqueCode?b.getUniqueCode():null,e=_c.getMaterial(d);e?(this.material.materials[a]=e,_c.useMaterial(e)):(this.material.materials[a]=b,_c.setMaterial(d,b),_c.useMaterial(b)),_c.unUseMaterial(c)},computeData:function(){var a={};a.faces=[],a.uvs=[],a.vertices=[];for(var b=this.parameters.stacks,c=this.parameters.slices,d=this.parameters.func,e=c+1,f=[],g=0;b>=g;g++){var h=g/b;for(j=0;j<=c;j++){var i=j/c,k=d(i,h);f.push(new _b(i,h)),a.vertices.push(new ac(k.x,k.y,k.z))}}var l,m,n,o;for(g=0;b>g;g++)for(j=0;j<c;j++){l=g*e+j,m=g*e+j+1,n=(g+1)*e+j+1,o=(g+1)*e+j;var p=new rc(l,m,n,o),q=a.vertices[l].clone().sub(a.vertices[m].clone()),r=a.vertices[o].clone().sub(a.vertices[m].clone()),s=q.cross(r).normalize();p.normal.copy(s),a.faces.push(p),a.uvs.push([f[l],f[m],f[n],f[o]])}return a}}),$b.LensFlare=function(a){var b,c,d,f,g,h;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],b=options.texture,c=options.size,d=options.distance,f=options.blending,g=options.color,h=options.opacity,a=options.id):arguments[0]instanceof $b.Material?(this.material=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],f=arguments[4],g=arguments[5],h=arguments[6]):(b=arguments[0],c=arguments[1],d=arguments[2],f=arguments[3],g=arguments[4],h=arguments[5],a=arguments[6]),this.texture=b||null,this.size=c||-1,this.distance=d||0,this.blending=f||$b.NormalBlending,this.color=g||new $b.Color(16777215),this.opacity=h||1,this.material||(this.material=new $b.Material),this.lensFlares=[],$b.Node.apply(this,arguments),this.positionScreen=new ac,this.customUpdateCallback=e,this.texture&&this.add(this.texture,this.size,this.distance,this.blending,this.color)},$b.extend($b.LensFlare,$b.Node,{isLensFlare:!0,add:function(a,b,c,d,f,g){b===e&&(b=-1),c===e&&(c=0),g===e&&(g=1),f===e&&(f=new $b.Color(16777215)),d===e&&(d=$b.NormalBlending),c=Math.min(c,Math.max(0,c)),this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:g,color:f,blending:d})},updateLensFlares:function(){var a,b,c=this.lensFlares.length,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;c>a;a++)b=this.lensFlares[a],b.x=this.positionScreen.x+d*b.distance,b.y=this.positionScreen.y+e*b.distance,b.wantedRotation=b.x*Math.PI*.25,b.rotation+=.25*(b.wantedRotation-b.rotation)},copy:function(a){Cube.prototype.copy.call(this,a),this.positionScreen.copy(a.positionScreen),this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;c>b;b++)this.lensFlares.push(a.lensFlares[b]);return this}}),$b.Path=function(a){$b.CurvePath.call(this),this.actions=[],this.points=[],a&&this.fromPoints(a)},$b.extend($b.Path,$b.CurvePath,{constructor:$b.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,"class":"TGL.Path"}},deserializeJsonValue:function(a){var b,c,d,e;for(e=0;e<a.actions.length;e++)c=a.actions[e],b=c.action,d=c.args,this[b].apply(this,d)}}),$b.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},$b.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y,a[0].z);for(var b=1,c=a.length;c>b;b++)this.lineTo(a[b].x,a[b].y,a[b].z)},$b.Path.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.lineTo(a.x,a.y,a.z)},$b.Path.prototype.reverse=function(){var a,b,c,d,e,f=new $b.Path,g=this.actions.length;for(a=g-1;a>=0;a--){if(b=this.actions[a].args,c=b.length,a===g-1&&f.moveTo(b[c-3],b[c-2],b[c-1]),null!=d)switch(e){case $b.PathActions.MOVE_TO:f.moveTo(b[c-3],b[c-2],b[c-1]);break;case $b.PathActions.LINE_TO:f.lineTo(b[c-3],b[c-2],b[c-1]);break;case $b.PathActions.QUADRATIC_CURVE_TO:f.quadraticCurveTo(d[0],d[1],d[2],b[c-3],b[c-2],b[c-1]);break;case $b.PathActions.BEZIER_CURVE_TO:f.bezierCurveTo(d[3],d[4],d[5],d[0],d[1],d[2],b[c-3],b[c-2],b[c-1])}d=b,e=this.actions[a].action}return f},$b.Path.prototype.moveTo=function(a,b,c){a=a||0,b=b||0,c=c||0;var d=Array.prototype.slice.call(arguments);this.actions.push({action:$b.PathActions.MOVE_TO,args:d}),this.points.push(new ac(a,b,c))},$b.Path.prototype.lineTo=function(a,b,c){if(a=a||0,b=b||0,c=c||0,this.actions&&1===this.actions.length){var d=this.actions[0].args;d[0]===a&&d[1]===b&&d[2]===c&&(console.log("TGL.Path:lineTo the same point of moveTo"),a+=.01)}var d=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args,f=e[e.length-3],g=e[e.length-2],h=e[e.length-1],i=new $b.LineCurve3(new $b.Vec3(f,g,h),new $b.Vec3(a,b,c));this.curves.push(i),this.actions.push({action:$b.PathActions.LINE_TO,args:d}),this.points.push(new ac(a,b,c))},$b.Path.prototype.quadraticCurveTo=function(a,b,c,d,e,f){if(a=a||0,b=b||0,c=c||0,d=d||0,e=e||0,f=f||0,this.actions&&1===this.actions.length){var g=this.actions[0].args;g[0]===d&&g[1]===e&&g[2]===f&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),d=.01)}var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,i=h[h.length-3],j=h[h.length-2],k=h[h.length-1],l=new $b.QuadraticBezierCurve3(new $b.Vec3(i,j,k),new $b.Vec3(a,b,c),new $b.Vec3(d,e,f));this.curves.push(l),this.actions.push({action:$b.PathActions.QUADRATIC_CURVE_TO,args:g}),this.points.push(new ac(d,e,f))},$b.Path.prototype.curveTo=$b.Path.prototype.quadraticCurveTo,$b.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f,g,h,i){var j=Array.prototype.slice.call(arguments),k=this.actions[this.actions.length-1].args,l=k[k.length-3],m=k[k.length-2],n=k[k.length-1],o=new $b.CubicBezierCurve3(new $b.Vec3(l,m,n),new $b.Vec3(a,b,c),new $b.Vec3(d,e,f),new $b.Vec3(g,h,i));this.curves.push(o),this.actions.push({action:$b.PathActions.BEZIER_CURVE_TO,args:j}),this.points.push(new ac(g,h,i))},$b.Path.prototype.isClockwise=function(){if(this.points.length<2)return e;if(this.points.length<3){var a=this.points[0],b=this.points[1];return b.x>a.x}return $b.Math.isClockwise(this.points)},$b.Path.prototype.bCurveTo=$b.Path.prototype.bezierCurveTo,$b.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,d=c[c.length-2],e=c[c.length-1],f=[new $b.Vec2(d,e)];Array.prototype.push.apply(f,a);var g=new $b.SplineCurve(f);this.curves.push(g),this.actions.push({action:$b.PathActions.CSPLINE_THRU,args:b})},$b.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,h=g[g.length-3],i=g[g.length-2];this.absarc(a+h,b+i,c,d,e,f)},$b.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},$b.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args,i=h[h.length-3],j=h[h.length-2];this.absellipse(a+i,b+j,c,d,e,f,g)},$b.Path.prototype.absellipse=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=new $b.EllipseCurve(a,b,c,d,e,f,g);this.curves.push(i);var j=i.getPoint(1);h.push(j.x),h.push(j.y),this.actions.push({action:$b.PathActions.ELLIPSE,args:h})},$b.Path.prototype.toArray=function(){var a,b=this.actions.length,c=[];for(a=0;b>a;a++){var d=this.actions[a];"moveTo"===d.action?(c.push("m"),c.push(d.args[0]),c.push(d.args[1]),c.push(d.args[2])):"lineTo"===d.action?(c.push("l"),c.push(d.args[0]),c.push(d.args[1]),c.push(d.args[2])):"curveTo"===d.action&&(c.push("c"),c.push(d.args[0]),c.push(d.args[1]),c.push(d.args[2]),c.push(d.args[3]),c.push(d.args[4]),c.push(d.args[5]))}return c},$b.Path.prototype.getSpacedPoints=function(a,b){a||(a=40);for(var c=[],d=0;a>d;d++)c.push(this.getPoint(d/a));return c},$b.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(a,b);a=a||12;var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=[];for(c=0,d=this.actions.length;d>c;c++)switch(e=this.actions[c],f=e.action,g=e.args,f){case $b.PathActions.MOVE_TO:y.push(new $b.Vec3(g[0],g[1],g[2]));break;case $b.PathActions.LINE_TO:y.push(new $b.Vec3(g[0],g[1],g[2]));break;case $b.PathActions.QUADRATIC_CURVE_TO:for(h=g[3],i=g[4],j=g[5],n=g[0],o=g[1],p=g[2],y.length>0?(t=y[y.length-1],q=t.x,r=t.y,s=t.z):(t=this.actions[c-1].args,q=t[t.length-3],r=t[t.length-2],s=t[t.length-1]),u=1;a>=u;u++)v=u/a,w=$b.Shape.Utils.b2(v,q,n,h),x=$b.Shape.Utils.b2(v,r,o,i),tz=$b.Shape.Utils.b2(v,s,p,j),y.push(new $b.Vec3(w,x,tz));break;case $b.PathActions.BEZIER_CURVE_TO:for(h=g[6],i=g[7],j=g[8],n=g[0],o=g[1],p=g[2],k=g[3],l=g[4],m=g[5],y.length>0?(t=y[y.length-1],q=t.x,r=t.y,s=t.z):(t=this.actions[c-1].args,q=t[t.length-3],r=t[t.length-2],s=t[t.length-1]),u=1;a>=u;u++)v=u/a,w=$b.Shape.Utils.b3(v,q,n,k,h),x=$b.Shape.Utils.b3(v,r,o,l,i),tz=$b.Shape.Utils.b3(v,s,p,m,j),y.push(new $b.Vec3(w,x,tz));break;case $b.PathActions.CSPLINE_THRU:t=this.actions[c-1].args;var z=new $b.Vec2(t[t.length-2],t[t.length-1]),A=[z],B=a*g[0].length;A=A.concat(g[0]);var C=new $b.SplineCurve(A);for(u=1;B>=u;u++)y.push(C.getPointAt(u/B));break;case $b.PathActions.ARC:var D,E=g[0],F=g[1],G=g[2],H=g[3],I=g[4],J=!!g[5],K=I-H,L=2*a;for(u=1;L>=u;u++)v=u/L,J||(v=1-v),D=H+v*K,w=E+G*Math.cos(D),x=F+G*Math.sin(D),y.push(new $b.Vec3(w,x));break;case $b.PathActions.ELLIPSE:
var D,E=g[0],F=g[1],M=g[2],N=g[3],H=g[4],I=g[5],J=!!g[6],K=I-H,L=2*a;for(u=1;L>=u;u++)v=u/L,J||(v=1-v),D=H+v*K,w=E+M*Math.cos(D),x=F+N*Math.sin(D),y.push(new $b.Vec3(w,x))}var O=y[y.length-1],P=1e-10;return Math.abs(O.x-y[0].x)<P&&Math.abs(O.y-y[0].y)<P&&y.splice(y.length-1,1),b&&y.push(y[0]),y},$b.Path.prototype.toShapes=function(a){var b,c,d,f,g,h=[],i=new $b.Path;for(b=0,c=this.actions.length;c>b;b++)d=this.actions[b],g=d.args,f=d.action,f==$b.PathActions.MOVE_TO&&0!=i.actions.length&&(h.push(i),i=new $b.Path),i[f].apply(i,g);if(0!=i.actions.length&&h.push(i),0==h.length)return[];var j,k,l,m=[];if(1==h.length)return k=h[0],l=new $b.Shape,l.actions=k.actions,l.curves=k.curves,m.push(l),m;var n=!$b.Shape.Utils.isClockWise(h[0].getPoints());if(n=a?!n:n)for(l=new $b.Shape,b=0,c=h.length;c>b;b++)k=h[b],j=$b.Shape.Utils.isClockWise(k.getPoints()),j=a?!j:j,j?(l.actions=k.actions,l.curves=k.curves,m.push(l),l=new $b.Shape):l.holes.push(k);else{for(l=e,b=0,c=h.length;c>b;b++)k=h[b],j=$b.Shape.Utils.isClockWise(k.getPoints()),j=a?!j:j,j?(l&&m.push(l),l=new $b.Shape,l.actions=k.actions,l.curves=k.curves):l.holes.push(k);m.push(l)}return m},$b.Shape=function(){$b.Path.apply(this,arguments),this.holes=[]},$b.Shape.prototype=Object.create($b.Path.prototype),$b.Shape.prototype.extrude=function(a){var b=new $b.ShapeNode(this,a);return b},$b.Shape.prototype.makeGeometry=function(a){var b=new $b.ShapeGeometry(this,a);return b},$b.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;c>b;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d},$b.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;c>b;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d},$b.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}},$b.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)},$b.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}},$b.Shape.Utils={removeHoles:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=a.concat(),t=s.concat(),u=[];for(g=0;g<b.length;g++){for(i=b[g],Array.prototype.push.apply(t,i),j=Number.POSITIVE_INFINITY,h=0;h<i.length;h++){m=i[h];var v=[];for(l=0;l<s.length;l++)n=s[l],k=m.distanceToSquared(n),v.push(k),j>k&&(j=k,e=h,f=l)}c=f-1>=0?f-1:s.length-1,d=e-1>=0?e-1:i.length-1;var w=[i[e],s[f],s[c]],x=$b.FontUtils.Triangulate.area(w),y=[i[e],i[d],s[f]],z=$b.FontUtils.Triangulate.area(y),A=1,B=-1,C=f,D=e;f+=A,e+=B,0>f&&(f+=s.length),f%=s.length,0>e&&(e+=i.length),e%=i.length,c=f-1>=0?f-1:s.length-1,d=e-1>=0?e-1:i.length-1,w=[i[e],s[f],s[c]];var E=$b.FontUtils.Triangulate.area(w);y=[i[e],i[d],s[f]];var F=$b.FontUtils.Triangulate.area(y);x+z>E+F&&(f=C,e=D,0>f&&(f+=s.length),f%=s.length,0>e&&(e+=i.length),e%=i.length,c=f-1>=0?f-1:s.length-1,d=e-1>=0?e-1:i.length-1),o=s.slice(0,f),p=s.slice(f),q=i.slice(e),r=i.slice(0,e);var G=[i[e],s[f],s[c]],H=[i[e],i[d],s[f]];u.push(G),u.push(H),s=o.concat(q).concat(r).concat(p)}return{shape:s,isolatedPts:u,allpoints:t}},triangulateShape:function(a,b){var c,d,f,g,h,i,j=$b.Shape.Utils.removeHoles(a,b),k=j.shape,l=j.allpoints,m=j.isolatedPts,n=$b.FontUtils.Triangulate(k,!1),o={};for(c=0,d=l.length;d>c;c++)h=l[c].x+":"+l[c].y,o[h]!==e&&console.log("Duplicate point",h),o[h]=c;for(c=0,d=n.length;d>c;c++)for(g=n[c],f=0;3>f;f++)h=g[f].x+":"+g[f].y,i=o[h],i!==e&&(g[f]=i);for(c=0,d=m.length;d>c;c++)for(g=m[c],f=0;3>f;f++)h=g[f].x+":"+g[f].y,i=o[h],i!==e&&(g[f]=i);return n.concat(m)},isClockWise:function(a){return $b.FontUtils.Triangulate.area(a)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){var c=1-a;return 3*c*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}},$b.CubicBezierCurve3=$b.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(a){var b,c,d;return b=$b.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c=$b.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),d=$b.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new $b.Vec3(b,c,d)}),$b.QuadraticBezierCurve3=$b.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(a){var b,c,d;return b=$b.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),c=$b.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),d=$b.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z),new $b.Vec3(b,c,d)}),$b.PathNode=function(a,b,c,d,f,g,h,i,j,k){this.materialSize=1,this.closed=!1;var l;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof $b.Path)?(l=arguments[0],this.path=l.path,this.segments=l.segments||20,this.radius=l.radius||1,this.segmentsR=l.segmentsR||8,this.shape=l.shape,this.startCap=l.startCap||"plain",this.endCap=l.endCap||"plain",this.arc=l.arc!=e?l.arc:2*Math.PI,this.arcStart=l.arcStart!=e?l.arcStart:0,this.cutSurface=l.cutSurface||"none",this.startCapR=l.startCapR,this.endCapR=l.endCapR,this.startCapSize=l.startCapSize,this.endCapSize=l.endCapSize,this.binormal=l.binormal,this.startCapExtend=l.startCapExtend===e?1:l.startCapExtend,this.endCapExtend=l.endCapExtend===e?1:l.endCapExtend,this._id=l.id):(this.path=a,this.segments=b||20,this.radius=c||1,this.segmentsR=d||8,this.shape=h,this.startCap=f||"plain",this.endCap=g||"plain",this.arc=i!=e?i:2*Math.PI,this.arcStart=j!=e?j:0,this.cutSurface=k||"none"),this.shape instanceof Array&&(this.segmentsR=this.shape.length),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===2*Math.PI&&(this.cutSurface="none"),$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.extend($b.PathNode,$b.Entity,{constructor:$b.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],getCrossSectionPoint:function(){},needComputeVertexNormal:function(){return!0},adjustPath:function(a,b,c){b=b||this.radius,c=c||this._adjustTimes||2;var d,e,f,g,h,i,j,k,l,m,n,o,p=new $b.Path,q=new ac,r=new ac,s=new ac,t=new ac,u=a.actions.length;for(o=0;u>o;o++)if(f=a.actions[o],h=o+1===u?null:a.actions[o+1],g=f.args,"moveTo"===f.action)p.moveTo(g[0],g[1],g[2]);else if("lineTo"===f.action)if(h&&"lineTo"===h.action){if(d=a.actions[o-1],e=d.args,i=h.args,j=new ac(e[0],e[1],e[2]),k=new ac(g[0],g[1],g[2]),l=new ac(i[0],i[1],i[2]),q.subVectors(k,j),r.subVectors(k,l),0==r.length()){a.actions.splice(o,1),o-=1,u-=1;continue}m=q.angleTo(r),n=Math.min(q.length()/2,r.length()/2),n=Math.min(b*c,n),s.addVectors(k,q.normalize().multiplyScalar(-n)),t.addVectors(k,r.normalize().multiplyScalar(-n)),p.lineTo(s.x,s.y,s.z),p.curveTo(k.x,k.y,k.z,t.x,t.y,t.z)}else p.lineTo(g[0],g[1],g[2]);else"quadraticCurveTo"===f.action&&p.curveTo(g[0],g[1],g[2],g[3],g[4],g[5]);return p},_resetPath:function(){return this.path},getPointAt:function(a){return this._realPath?this._realPath.getPoint(a):null},getTangentAt:function(a){if(this._realPath){var b=this._realPath.getPoint(a),c=this._realPath.getPoint(a-.001);return b.sub(c).normalize()}return null},computeData:function(){function a(a,b,c,d){return d.vertices.push(new $b.Vec3(a,b,c))-1}this.grid=[],this.startGrid=[],this.endGrid=[];var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=this.segmentsCap,w=new $b.Vec3,x={};if(x.faces=[],x.uvs=[],x.vertices=[],null==this.path)return x;var y=this._resetPath(),z=this.startCap,A=this.endCap,B=this.cutSurface;this._realPath=y,1==this._autoAjust&&(y=this.adjustPath(y));var p,C,k,D=y.curves.length,E=y.curves,F=[],G=y.getLength(),H=0,I=this.segments;for(j=0;D>j;j++){if(p=E[j],C=p.getLength(),p instanceof $b.LineCurve3){var J=(.001*C+H)/G,K=(.999*C+H)/G;F.push(J),F.push(K)}else{var L=.998*C;for(k=0;I>=k;k++){var M=(.001*C+L*k/I+H)/G;F.push(M)}}H+=C}var N=this.frenetFrames(y,F,this.closed,this.binormal),O=N.tangents,P=N.normals,Q=N.binormals;this.tangents=O,this.normals=P,this.binormals=Q;var R,S=0,T=F.length-1,U=T+1,V=0,W=0;for(j=0;U>j;j++){if(this.grid[j]=[],e=F[j],i=y.getPointAt(e),b=O[j],c=P[j],d=Q[j],"none"!==z&&0===j)if("round"===z||"arrow"===z){var X,Y;V+=this.radius*this.startCapSize;for(var Z=i.clone().add(b.clone().multiplyScalar(-this.radius*this.startCapSize)),$=0;v>=$;$++){this.startGrid[$]=[];var _=$/v*Math.PI/2;X="round"===z?Z.clone().add(b.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos(_)))):Z.clone().add(b.clone().multiplyScalar(this.radius*this.startCapSize*$/v));for(var k=0;k<this.segmentsR;k++)f=k/this.segmentsR*this.arc+this.arcStart,"round"===z?(g=-this.radius*Math.cos(f)*Math.sin(_),h=this.radius*Math.sin(f)*Math.sin(_)):(g=-this.radius*Math.cos(f)*$/v,h=this.radius*Math.sin(f)*$/v,g*=this.startCapR||1.3,h*=this.startCapR||1.3),Y=X.clone(),Y.x+=g*c.x+h*d.x,Y.y+=g*c.y+h*d.y,Y.z+=g*c.z+h*d.z,this.startGrid[$][k]=x.vertices.push(Y)-1;"center"===B&&(this.startGrid[$][this.segmentsR]=x.vertices.push(X.clone())-1)}}else S=x.vertices.push(i);for(k=0;k<this.segmentsR;k++){if(R=k/(this.segmentsR-1),this.shape instanceof Array)g=-this.shape[k].x,h=this.shape[k].y;else if(this.shape instanceof $b.Path){var aa=this.shape.getPointAt(R);g=-aa.x,h=-aa.y}else f=k/this.segmentsR*this.arc+this.arcStart,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);w.copy(i),w.x+=g*c.x+h*d.x,w.y+=g*c.y+h*d.y,w.z+=g*c.z+h*d.z,this.grid[j][k]=a(w.x,w.y,w.z,x)}if("center"===B&&(this.grid[j][this.segmentsR]=x.vertices.push(i.clone())-1),"none"!==A&&j===U-1)if("round"===A||"arrow"===A){W+=this.radius*this.endCapSize;for(var X,Y,Z=i.clone().add(b.clone().multiplyScalar(this.radius*this.endCapSize)),$=0;v>=$;$++){this.endGrid[$]=[];var _=(1-$/v)*Math.PI/2;X="round"===A?Z.clone().add(b.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos(_)))):Z.clone().add(b.clone().multiplyScalar(-this.radius*this.endCapSize*(1-$/v)));for(var k=0;k<this.segmentsR;k++)f=k/this.segmentsR*this.arc+this.arcStart,"round"===A?(g=-this.radius*Math.cos(f)*Math.sin(_),h=this.radius*Math.sin(f)*Math.sin(_)):(g=-this.radius*Math.cos(f)*(1-$/v),h=this.radius*Math.sin(f)*(1-$/v),g*=this.endCapR||1.3,h*=this.endCapR||1.3),Y=X.clone(),Y.x+=g*c.x+h*d.x,Y.y+=g*c.y+h*d.y,Y.z+=g*c.z+h*d.z,this.endGrid[$][k]=x.vertices.push(Y)-1;"center"===B&&(this.endGrid[$][this.segmentsR]=x.vertices.push(X)-1)}}else x.vertices.push(i)}var ba=this.segmentsR,ca=this.segmentsR;this.arc!==2*Math.PI&&("center"===B?(ba++,ca++):"none"===B&&ba--);var da=this.arc/Math.PI/2,ea=y.getLength(),fa=ea+V+W,ga=0,ha=V/fa,ia=ha,ja=ea/fa,ka=ha+ja,la=W/fa;if("none"!==z)if("plain"===z)for(n=0,k=0;k<this.segmentsR;k++){m=(k+1)%this.segmentsR,o=this.grid[0][k],p=this.grid[0][m],x.faces.push(new $b.Face3(n,o,p)),f=k/this.segmentsR*2*Math.PI,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);var r=new _b(.5,.5);f=k/this.segmentsR*2*Math.PI,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);var s=new _b((g/this.radius+1)/2,(h/this.radius+1)/2);f=m/this.segmentsR*2*Math.PI,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);var t=new _b((g/this.radius+1)/2,(h/this.radius+1)/2);x.uvs.push([r,s,t])}else for(j=0;v>=j;j++)for(k=0;ba>k;k++){if(l=j+1,m=(k+1)%ca,n=this.startGrid[j][k],l===v+1?(o=this.grid[0][k],p=this.grid[0][m]):(o=this.startGrid[l][k],p=this.startGrid[l][m]),q=this.startGrid[j][m],k>=this.segmentsR-1){var $=this.segmentsR-1,e=$/this.segmentsR*da;ba===this.segmentsR?(r=new $b.Vec2(j/v*ha+ga,e),s=new $b.Vec2((j+1)/v*ha+ga,e),t=new $b.Vec2((j+1)/v*ha+ga,1),u=new $b.Vec2(j/v*ha+ga,1)):k>this.segmentsR-1?(r=new $b.Vec2(j/v*ha+ga,(1+e)/2),s=new $b.Vec2((j+1)/v*ha+ga,(1+e)/2),t=new $b.Vec2((j+1)/v*ha+ga,1),u=new $b.Vec2(j/v*ha+ga,1)):(r=new $b.Vec2(j/v*ha+ga,e),s=new $b.Vec2((j+1)/v*ha+ga,e),t=new $b.Vec2((j+1)/v*ha+ga,(1+e)/2),u=new $b.Vec2(j/v*ha+ga,(1+e)/2))}else r=new $b.Vec2(j/v*ha+ga,k/this.segmentsR*da),s=new $b.Vec2((j+1)/v*ha+ga,k/this.segmentsR*da),t=new $b.Vec2((j+1)/v*ha+ga,(k+1)/this.segmentsR*da),u=new $b.Vec2(j/v*ha+ga,(k+1)/this.segmentsR*da);0!==j&&(x.faces.push(new $b.Face3(n,o,q,S-1)),x.uvs.push([r,s,u])),x.faces.push(new $b.Face3(o,p,q,S-1)),x.uvs.push([s.clone(),t,u.clone()])}for(j=0;T>j;j++)for(k=0;ba>k;k++){if(l=this.closed?(j+1)%T:j+1,m=(k+1)%ca,n=this.grid[j][k],o=this.grid[l][k],p=this.grid[l][m],q=this.grid[j][m],k>=this.segmentsR-1){var $=this.segmentsR-1,e=$/this.segmentsR*da;ba===this.segmentsR?(r=new $b.Vec2(F[j]*ja+ia,e),s=new $b.Vec2(F[j+1]*ja+ia,e),t=new $b.Vec2(F[j+1]*ja+ia,1),u=new $b.Vec2(F[j]*ja+ia,1)):k>this.segmentsR-1?(r=new $b.Vec2(F[j]*ja+ia,(e+1)/2),s=new $b.Vec2(F[j+1]*ja+ia,(e+1)/2),t=new $b.Vec2(F[j+1]*ja+ia,1),u=new $b.Vec2(F[j]*ja+ia,1)):(r=new $b.Vec2(F[j]*ja+ia,e),s=new $b.Vec2(F[j+1]*ja+ia,e),t=new $b.Vec2(F[j+1]*ja+ia,(e+1)/2),u=new $b.Vec2(F[j]*ja+ia,(e+1)/2))}else r=new $b.Vec2(F[j]*ja+ia,k/this.segmentsR*da),s=new $b.Vec2(F[j+1]*ja+ia,k/this.segmentsR*da),t=new $b.Vec2(F[j+1]*ja+ia,(k+1)/this.segmentsR*da),u=new $b.Vec2(F[j]*ja+ia,(k+1)/this.segmentsR*da);x.faces.push(new $b.Face3(n,o,q)),x.uvs.push([r,s,u]),x.faces.push(new $b.Face3(o,p,q)),x.uvs.push([s.clone(),t,u.clone()])}if("none"!==A){n=x.vertices.length-1;var D=this.grid.length;if("plain"===A)for(k=0;k<this.segmentsR;k++){m=(k+1)%this.segmentsR,o=this.grid[D-1][k],p=this.grid[D-1][m],x.faces.push(new $b.Face3(n,p,o)),f=k/this.segmentsR*2*Math.PI,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);var r=new _b(.5,.5);f=k/this.segmentsR*2*Math.PI,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);var s=new _b((g/this.radius+1)/2,(h/this.radius+1)/2);f=m/this.segmentsR*2*Math.PI,g=-this.radius*Math.cos(f),h=this.radius*Math.sin(f);var t=new _b((g/this.radius+1)/2,(h/this.radius+1)/2);x.uvs.push([r,t,s])}else for(j=-1;v>j;j++)for(k=0;ba>k;k++){if(l=j+1,m=(k+1)%ca,-1===j?(n=this.grid[D-1][k],q=this.grid[D-1][m]):(n=this.endGrid[j][k],q=this.endGrid[j][m]),o=this.endGrid[l][k],p=this.endGrid[l][m],k>=this.segmentsR-1){var $=this.segmentsR-1,e=$/this.segmentsR*da;ba===this.segmentsR?(r=new $b.Vec2(j/v*la+ka,e),s=new $b.Vec2((j+1)/v*la+ka,e),t=new $b.Vec2((j+1)/v*la+ka,1),u=new $b.Vec2(j/v*la+ka,1)):k>this.segmentsR-1?(r=new $b.Vec2(j/v*la+ka,(1+e)/2),s=new $b.Vec2((j+1)/v*la+ka,(1+e)/2),t=new $b.Vec2((j+1)/v*la+ka,1),u=new $b.Vec2(j/v*la+ka,1)):(r=new $b.Vec2(j/v*la+ka,e),s=new $b.Vec2((j+1)/v*la+ka,e),t=new $b.Vec2((j+1)/v*la+ka,(1+e)/2),u=new $b.Vec2(j/v*la+ka,(1+e)/2))}else r=new $b.Vec2(j/v*la+ka,k/this.segmentsR*da),s=new $b.Vec2((j+1)/v*la+ka,k/this.segmentsR*da),t=new $b.Vec2((j+1)/v*la+ka,(k+1)/this.segmentsR*da),u=new $b.Vec2(j/v*la+ka,(k+1)/this.segmentsR*da);x.faces.push(new $b.Face3(n,o,q)),x.uvs.push([r,s,u]),x.faces.push(new $b.Face3(o,p,q)),x.uvs.push([s.clone(),t,u.clone()])}}return x},frenetFrames:function(a,b,c,d){function e(){p[0]=new $b.Vec3,q[0]=new $b.Vec3,g=Number.MAX_VALUE,h=Math.abs(o[0].x),i=Math.abs(o[0].y),j=Math.abs(o[0].z),g>=i&&(g=i,n.set(0,1,0)),g>=h&&(g=h,n.set(1,0,0)),g>=j&&n.set(0,0,1),d&&(n=d.clone()),r.crossVectors(o[0],n).normalize(),p[0].crossVectors(o[0],r),q[0].crossVectors(o[0],p[0])}var f,g,h,i,j,k,l,m,n=(new $b.Vec3,new $b.Vec3),o=(new $b.Vec3,[]),p=[],q=[],r=new $b.Vec3,s=new $b.Mat4,t=b.length-1,u=t+1,v=1e-4,w=[];for(w.tangents=o,w.normals=p,w.binormals=q,k=0;u>k;k++){l=b[k];var m=a.getTangentAt(l);o[k]=new $b.Vec3(m.x,m.y,m.z?m.z:0),o[k].normalize()}for(e(),k=1;u>k;k++)p[k]=p[k-1].clone(),q[k]=q[k-1].clone(),r.crossVectors(o[k-1],o[k]),r.length()>v&&(r.normalize(),f=Math.acos($b.Math.clamp(o[k-1].dot(o[k]),-1,1)),p[k].applyMatrix4(s.makeRotationAxis(r,f))),q[k].crossVectors(o[k],p[k]);if(c)for(f=Math.acos($b.Math.clamp(p[0].dot(p[u-1]),-1,1)),f/=u-1,o[0].dot(r.crossVectors(p[0],p[u-1]))>0&&(f=-f),k=1;u>k;k++)p[k].applyMatrix4(s.makeRotationAxis(o[k],f*k)),q[k].crossVectors(o[k],p[k]);return w}}),$b.PathCube=function(a,b,c,d,e){var f;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof $b.Path)?(f=arguments[0],this.path=f.path,this.width=f.width||50,this.height=f.height||100,this.curveSegements=f.curveSegements||32,this.repeat=f.repeat||20,this._id=f.id):(this.path=a,this.width=b||50,this.height=c||100,this.curveSegements=d||32,this.repeat=e||20),this.materialSize=6,$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},$b.extend($b.PathCube,$b.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:$b.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return $b.PathCube.SideIndexMapping},computeData:function(){var a={};if(a.vertices=[],a.faces=[],a.uvs=[],a.uv2s=[],null==this.path)return a;var b,c=this.computePoints(this.path,this.width,this.curveSegements),d=c[0],e=c[1],f=d.length,g=c[2],h=this.height,i=this.repeat,j=[],k=[],l=[],m=[],n=this.path.isClockwise();for(this.innerPoints=this.clonePoints(d),this.outerPoints=this.clonePoints(e),b=0;f>b;b++)this.exchangeYZ(d[b]),this.exchangeYZ(e[b]),j[b]=a.vertices.push(d[b])-1,k[b]=a.vertices.push(e[b])-1,l[b]=a.vertices.push(d[b].clone().setY(h))-1,m[b]=a.vertices.push(e[b].clone().setY(h))-1;var o=g?f:f-1;for(b=0;o>b;b++)this.generateTop(a,b,f,l,m,!0,i),this.generateBottom(a,b,f,j,k,i),this.generateSideWall(a,b,f,m,k,!0,i,n),this.generateSideWall(a,b,f,l,j,!1,i,n);return g||(this.generateEnd(a,l,j,k,m,i,!0),this.generateEnd(a,l,j,k,m,i,!1)),this.clockwise=n,a},clonePoints:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].clone());return b},getInsidePoints:function(){var a=[];return a=this.clockwise?this.innerPoints:this.outerPoints},generateEnd:function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,t,w,x,y,z,A=g?0:c.length-1;h=b[A],i=c[A],j=d[A],k=e[A],w=a.vertices[h],x=a.vertices[i],y=a.vertices[j],z=a.vertices[k],l=w.x,m=w.y,n=w.z,o=x.x,p=x.y,q=x.z,r=y.x,s=y.y,t=y.z,u=z.x,v=z.y,dz=z.z;var B=Math.abs(n-t),C=Math.abs(l-r);g?(a.faces.push(new $b.Face3(h,i,k,null,null,4)),C>B?a.uvs.push([new $b.Vec2(l/f,m/f),new $b.Vec2(o/f,p/f),new $b.Vec2(u/f,v/f)]):a.uvs.push([new $b.Vec2(n/f,m/f),new $b.Vec2(q/f,p/f),new $b.Vec2(dz/f,v/f)]),a.uv2s.push([new _b(0,1),new _b(0,0),new _b(1,1)]),a.faces.push(new $b.Face3(i,j,k,null,null,4)),C>B?a.uvs.push([new $b.Vec2(o/f,p/f),new $b.Vec2(r/f,s/f),new $b.Vec2(u/f,v/f)]):a.uvs.push([new $b.Vec2(q/f,p/f),new $b.Vec2(t/f,s/f),new $b.Vec2(dz/f,v/f)]),a.uv2s.push([new _b(0,0),new _b(1,0),new _b(1,1)])):(a.faces.push(new $b.Face3(i,h,k,null,null,5)),C>B?a.uvs.push([new $b.Vec2(o/f,p/f),new $b.Vec2(l/f,m/f),new $b.Vec2(u/f,v/f)]):a.uvs.push([new $b.Vec2(q/f,p/f),new $b.Vec2(n/f,m/f),new $b.Vec2(dz/f,v/f)]),a.uv2s.push([new _b(0,0),new _b(0,1),new _b(1,1)]),a.faces.push(new $b.Face3(j,i,k,null,null,5)),C>B?a.uvs.push([new $b.Vec2(r/f,s/f),new $b.Vec2(o/f,p/f),new $b.Vec2(u/f,v/f)]):a.uvs.push([new $b.Vec2(t/f,s/f),new $b.Vec2(q/f,p/f),new $b.Vec2(dz/f,v/f)]),a.uv2s.push([new _b(1,0),new _b(0,0),new _b(1,1)]))},generateSideWall:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,u,x,y,z,A,B;x=(b+1)%c,i=d[b],j=e[b],k=e[x],l=d[x],y=a.vertices[i],z=a.vertices[j],A=a.vertices[k],B=a.vertices[l],m=y.x,n=y.y,o=y.z,p=z.x,q=z.y,r=z.z,s=A.x,t=A.y,u=A.z,v=B.x,w=B.y,dz=B.z;var C,D=Math.abs(o-u),E=Math.abs(m-s);f?(C=h?1:2,a.faces.push(new $b.Face3(i,j,l,null,null,C)),E>D?a.uvs.push([new $b.Vec2(m/g,n/g),new $b.Vec2(p/g,q/g),new $b.Vec2(v/g,w/g)]):a.uvs.push([new $b.Vec2(o/g,n/g),new $b.Vec2(r/g,q/g),new $b.Vec2(dz/g,w/g)]),a.uv2s.push([new _b(0,1),new _b(0,0),new _b(1,1)]),a.faces.push(new $b.Face3(j,k,l,null,null,C)),E>D?a.uvs.push([new $b.Vec2(p/g,q/g),new $b.Vec2(s/g,t/g),new $b.Vec2(v/g,w/g)]):a.uvs.push([new $b.Vec2(r/g,q/g),new $b.Vec2(u/g,t/g),new $b.Vec2(dz/g,w/g)]),a.uv2s.push([new _b(0,0),new _b(1,0),new _b(1,1)])):(C=h?2:1,a.faces.push(new $b.Face3(j,i,l,null,null,C)),E>D?a.uvs.push([new $b.Vec2(p/g,q/g),new $b.Vec2(m/g,n/g),new $b.Vec2(v/g,w/g)]):a.uvs.push([new $b.Vec2(r/g,q/g),new $b.Vec2(o/g,n/g),new $b.Vec2(dz/g,w/g)]),a.uv2s.push([new _b(0,0),new _b(0,1),new _b(1,1)]),a.faces.push(new $b.Face3(k,j,l,null,null,C)),E>D?a.uvs.push([new $b.Vec2(s/g,t/g),new $b.Vec2(p/g,q/g),new $b.Vec2(v/g,w/g)]):a.uvs.push([new $b.Vec2(u/g,t/g),new $b.Vec2(r/g,q/g),new $b.Vec2(dz/g,w/g)]),a.uv2s.push([new _b(1,0),new _b(0,0),new _b(1,1)]))},generateBottom:function(a,b,c,d,e,f){this.generateTop(a,b,c,d,e,!1,f)},generateTop:function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,t,w,x,y,z,A;w=(b+1)%c,h=d[b],i=e[b],j=e[w],k=d[w],x=a.vertices[h],y=a.vertices[i],z=a.vertices[j],A=a.vertices[k],l=x.x,m=x.y,n=x.z,o=y.x,p=y.y,q=y.z,r=z.x,s=z.y,t=z.z,u=A.x,v=A.y,dz=A.z,f?(a.faces.push(new $b.Face3(h,i,k,null,null,3)),a.uvs.push([new $b.Vec2(l/g,n/g),new $b.Vec2(o/g,q/g),new $b.Vec2(u/g,dz/g)]),a.uv2s.push([new _b(0,1),new _b(0,0),new _b(1,1)]),a.faces.push(new $b.Face3(i,j,k,null,null,3)),a.uvs.push([new $b.Vec2(o/g,q/g),new $b.Vec2(r/g,t/g),new $b.Vec2(u/g,dz/g)]),a.uv2s.push([new _b(0,0),new _b(1,0),new _b(1,1)])):(a.faces.push(new $b.Face3(i,h,k,null,null,0)),a.uvs.push([new $b.Vec2(o/g,q/g),new $b.Vec2(l/g,n/g),new $b.Vec2(u/g,dz/g)]),a.uv2s.push([new _b(0,0),new _b(0,1),new _b(1,1)]),a.faces.push(new $b.Face3(j,i,k,null,null,0)),a.uvs.push([new $b.Vec2(r/g,t/g),new $b.Vec2(o/g,q/g),new $b.Vec2(u/g,dz/g)]),a.uv2s.push([new _b(1,0),new _b(0,0),new _b(1,1)]))},exchangeYZ:function(a){var b=a.y;a.y=a.z,a.z=-b},addPoints:function(a,b,c,d,e){b.multiplyScalar(.5),c.push((new $b.Vec3).subVectors(a,b)),d.push((new $b.Vec3).addVectors(a,b))},computeCurvePoint:function(a,b,c,d,e,f,g,h,i){var k,l,m,n,o=d?0:1,p=new $b.Vec3,q=h;if(a){l=a.getTangentAt(1),m=b.getTangentAt(0),concave=$b.Math.isConcave(l,m,!1),m.multiplyScalar(-1),angle=l.angleTo(m),n=Math.sin(angle/2),k=b.getPoint(0),n=0==n?.1:n;var r=concave?c/n:-c/n;1==n?p.crossVectors(m,new ac(0,0,1)).normalize().multiplyScalar(r):p.addVectors(l,m).normalize().multiplyScalar(r),this.addPoints(k,p,f,g,i)}else m=b.getTangentAt(o),k=b.getPoint(o),p.crossVectors(m,new $b.Vec3(0,0,1)).normalize().multiplyScalar(c),this.addPoints(k,p,f,g,i);if(!(b instanceof $b.LineCurve3)&&e){var s=q+1;for(j=0;j<s-2;j++)u=j/(s-1),m=b.getTangentAt(u),k=b.getPointAt(u),p.crossVectors(m,new $b.Vec3(0,0,1)).normalize().multiplyScalar(c),j*b.getLength()/q>c/Math.abs(n)&&this.addPoints(k,p,f,g,i)}},computePoints:function(a,b,c){var d,e,f,g=(new $b.Vec3,a.isClockwise()),h=a.curves[0].getPoint(0),i=a.curves[a.curves.length-1].getPoint(1);f=h.equals(i),e=a.curves.length;var j=[],k=[];new $b.Path,a.getLength();for(d=0;e>d;d++){var l=d-1;f&&-1===l&&(l=e-1);var m=a.curves[l],n=a.curves[d];this.computeCurvePoint(m,n,b,!0,!0,j,k,c,g),d===e-1&&!f&&this.computeCurvePoint(null,n,b,!1,!1,j,k,c,g)}return[j,k,f]}}),$b.ShapeNode=function(a,b,c,d,e){if(null==a)return a=[],this.materialSize=3,$b.Entity.call(this),void 0;var f;if(!(1===arguments.length&&arguments[0]instanceof Object)||arguments[0]instanceof $b.Shape||arguments[0]instanceof $b.Path&&!Array.isArray(arguments[0]))this.options={curveSegments:b,amount:c,vertical:d,zMinusHalfAmount:this.zMinusHalfAmount,repeat:e||20};else{if(f=arguments[0],a=f.path,null==a)return a=[],this.materialSize=3,$b.Entity.call(this),void 0;b=f.curveSegments,c=f.amount,d=f.vertical,e=f.repeat,this.options={curveSegments:f.curveSegments,amount:f.amount,vertical:f.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:f.repeat||20},this._id=f.id}var g=[];a instanceof $b.Path?(g=a.toShapes(),this.path=a):g=a,this.curveSegments=b,this.amount=c,this.vertical=d,this.repeat=e||20,g=g instanceof Array?g:[g],this.shapes=g,this.shapebb=g[g.length-1].getBoundingBox(),this.materialSize=3,$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.ShapeNode.SideIndexMapping={bottom:0,side:1,top:2},$b.extend($b.ShapeNode,$b.Entity,{constructor:$b.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},getSideIndexMapping:function(){return $b.ShapeNode.SideIndexMapping},addShapes:function(a,b){var c=[];c=a instanceof $b.Path?a.toShapes():a;var d={};if(d.vertices=[],d.uvs=[],d.uv2s=[],d.faces=[],!c)return d;for(var e=c.length,f=0;e>f;f++){var g=c[f];this.addShape(g,b,d)}var h=new $b.BoundingBox;h.setFromPoints(d.vertices);var i=(h.max.y-h.min.y)/2;if(b.zMinusHalfAmount)for(var j=0;j<d.vertices.length;j++)d.vertices[j].y-=i;if(b.vertical)for(var j=0;j<d.vertices.length;j++){var k=d.vertices[j].y;d.vertices[j].y=d.vertices[j].z,d.vertices[j].z=-k}return d}}),$b.ShapeNode.prototype.addShape=function(a,b,c){function d(a,b,c){return b||console.log("die"),b.clone().multiplyScalar(c).add(a)}function f(a,b,c){return h(a,b,c)}function g(a,b,c){var d=Math.atan2(b.y-a.y,b.x-a.x),e=Math.atan2(c.y-a.y,c.x-a.x);d>e&&(e+=2*Math.PI);var f=(d+e)/2,g=-Math.cos(f),h=-Math.sin(f),i=new $b.Vec2(g,h);return i}function h(a,b,c){var d,e,f,h,i,j,k=$b.ShapeNode.__v1,l=$b.ShapeNode.__v2,m=$b.ShapeNode.__v3,n=$b.ShapeNode.__v4,o=$b.ShapeNode.__v5,p=$b.ShapeNode.__v6;return k.set(a.x-b.x,a.y-b.y),l.set(a.x-c.x,a.y-c.y),d=k.normalize(),e=l.normalize(),m.set(-d.y,d.x),n.set(e.y,-e.x),o.copy(a).add(m),p.copy(a).add(n),o.equals(p)?n.clone():(o.copy(b).add(m),p.copy(c).add(n),f=d.dot(n),h=p.sub(o).dot(n),0===f&&(console.log("Either infinite or no solutions!"),0===h?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),i=h/f,0>i?g(a,b,c):(j=d.multiplyScalar(i).add(o),j.sub(a).clone()))}function i(){var a=c.uvs.length;if(v){var b=0,d=W*b;for(Z=0;X>Z;Z++)V=O[Z],n(V[2]+d,V[1]+d,V[0]+d,!0);for(b=x+2*u,d=W*b,Z=0;X>Z;Z++)V=O[Z],n(V[0]+d,V[1]+d,V[2]+d,!1)}else{for(Z=0;X>Z;Z++)V=O[Z],n(V[2],V[1],V[0],!0);for(Z=0;X>Z;Z++)V=O[Z],n(V[0]+W*x,V[1]+W*x,V[2]+W*x,!1)}k(a)}function j(){var a=c.uvs.length,b=0;for(l(P,b),b+=P.length,H=0,I=M.length;I>H;H++)G=M[H],l(G,b),b+=G.length;k(a)}function k(a){for(var b=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=a;g<c.uvs.length;g++)for(var h=c.uvs[g],i=0;i<h.length;i++){var j=h[i];j.x>e&&(e=j.x),j.y>f&&(f=j.y),j.x<b&&(b=j.x),j.y<d&&(d=j.y)}for(var k=e-b,l=f-d,g=a;g<c.uvs.length;g++){for(var h=c.uvs[g],m=[],i=0;i<h.length;i++){var j=h[i];m.push(new _b((j.x-b)/k,(j.y-d)/l))}c.uv2s.push(m)}}function l(a,b){var c,d;for(Z=a.length;--Z>=0;){c=Z,d=Z-1,0>d&&(d=a.length-1);var e=0,f=x+2*u;for(e=0;f>e;e++){var g=W*e,h=W*(e+1),i=b+c+g,j=b+d+g,k=b+d+h,l=b+c+h;o(i,j,k,l,a,e,f,c,d)}}}function m(a,b,d){c.vertices.push(new $b.Vec3(a,b,d-(r?q/2:0)))}function n(d,e,f,g){d+=J,e+=J,f+=J;var h=g?0:2;if($b.Math.isClockwise([c.vertices[d],c.vertices[e],c.vertices[f]]),"z"){c.faces.push(new $b.Face3(d,e,f,null,null,h));var i=g?B.generateBottomUV(c,a,b,d,e,f):B.generateTopUV(c,a,b,d,e,f);c.uvs.push(i)}else{c.faces.push(new $b.Face3(d,f,e,null,null,h));var i=g?B.generateBottomUV(c,a,b,d,f,e):B.generateTopUV(c,a,b,d,f,e);c.uvs.push(i)}}function o(d,e,f,g,h,i,j,k,l){if(d+=J,e+=J,f+=J,g+=J,$b.Math.isClockwise([c.vertices[d],c.vertices[e],c.vertices[g]]),"z"){c.faces.push(new $b.Face3(d,e,g,null,null,A)),c.faces.push(new $b.Face3(e,f,g,null,null,A));var m=B.generateSideWallUV(c,a,h,b,d,e,f,g,i,j,k,l);c.uvs.push([m[0],m[1],m[3]]),c.uvs.push([m[1],m[2],m[3]])}else{c.faces.push(new $b.Face3(d,g,e,null,null,A)),c.faces.push(new $b.Face3(e,g,f,null,null,A));var m=B.generateSideWallUV(c,a,h,b,d,e,f,g,i,j,k,l);c.uvs.push([m[0],m[3],m[1]]),c.uvs.push([m[1],m[3],m[2]])}}var p,q=b.amount!==e?b.amount:100,r=b.zMinusHalfAmount!==e?b.zMinusHalfAmount:!1,s=b.bevelThickness!==e?b.bevelThickness:6,t=b.bevelSize!==e?b.bevelSize:s-2,u=b.bevelSegments!==e?b.bevelSegments:3,v=b.bevelEnabled!==e?b.bevelEnabled:!1,w=b.curveSegments!==e?b.curveSegments:12,x=b.steps!==e?b.steps:1,y=b.extrudePath,z=!1,A=(b.material||0,b.extrudeMaterial||1),B=b.UVGenerator!==e?b.UVGenerator:$b.ShapeNode.WorldUVGenerator;B.repeat=b.repeat,B.amount=q;var C,D,E,F;this.shapebb;y&&(p=y.getSpacedPoints(x),z=!0,v=!1,C=b.frames!==e?b.frames:$b.PathNode.prototype.frenetFrames(y,x,!1),D=new $b.Vec3,E=new $b.Vec3,F=new $b.Vec3),v||(u=0,s=0,t=0);var G,H,I,J=c.vertices.length,K=a.extractPoints(w),L=K.shape,M=K.holes,N=!$b.Shape.Utils.isClockWise(L);if(N){for(L=L.reverse(),H=0,I=M.length;I>H;H++)G=M[H],$b.Shape.Utils.isClockWise(G)&&(M[H]=G.reverse());N=!1}var O=$b.Shape.Utils.triangulateShape(L,M),P=L;for(H=0,I=M.length;I>H;H++)G=M[H],L=L.concat(G);for(var Q,R,S,T,U,V,W=L.length,X=O.length,Y=(P.length,180/Math.PI,[]),Z=0,$=P.length,_=$-1,aa=Z+1;$>Z;Z++,_++,aa++){_===$&&(_=0),aa===$&&(aa=0);P[Z],P[_],P[aa];Y[Z]=f(P[Z],P[_],P[aa])}var ba,ca=[],da=Y.concat();for(H=0,I=M.length;I>H;H++){for(G=M[H],ba=[],Z=0,$=G.length,_=$-1,aa=Z+1;$>Z;Z++,_++,aa++)_===$&&(_=0),aa===$&&(aa=0),ba[Z]=f(G[Z],G[_],G[aa]);ca.push(ba),da=da.concat(ba)}for(Q=0;u>Q;Q++){for(S=Q/u,T=s*(1-S),R=t*Math.sin(S*Math.PI/2),Z=0,$=P.length;$>Z;Z++)U=d(P[Z],Y[Z],R),m(U.x,U.y,-T);for(H=0,I=M.length;I>H;H++)for(G=M[H],ba=ca[H],Z=0,$=G.length;$>Z;Z++)U=d(G[Z],ba[Z],R),m(U.x,U.y,-T)}for(R=t,Z=0;W>Z;Z++)U=v?d(L[Z],da[Z],R):L[Z],z?(E.copy(C.normals[0]).multiplyScalar(U.x),D.copy(C.binormals[0]).multiplyScalar(U.y),F.copy(p[0]).add(E).add(D),m(F.x,F.y,F.z)):m(U.x,U.y,0);var ea;for(ea=1;x>=ea;ea++)for(Z=0;W>Z;Z++)U=v?d(L[Z],da[Z],R):L[Z],z?(E.copy(C.normals[ea]).multiplyScalar(U.x),D.copy(C.binormals[ea]).multiplyScalar(U.y),F.copy(p[ea]).add(E).add(D),m(F.x,F.y,F.z)):m(U.x,U.y,q/x*ea);for(Q=u-1;Q>=0;Q--){for(S=Q/u,T=s*(1-S),R=t*Math.sin(S*Math.PI/2),Z=0,$=P.length;$>Z;Z++)U=d(P[Z],Y[Z],R),m(U.x,U.y,q+T);for(H=0,I=M.length;I>H;H++)for(G=M[H],ba=ca[H],Z=0,$=G.length;$>Z;Z++)U=d(G[Z],ba[Z],R),z?m(U.x,U.y+p[x-1].y,p[x-1].x+T):m(U.x,U.y,q+T)}i(),j()},$b.ShapeNode.WorldUVGenerator={generateTopUV:function(a,b,c,d,e,f){var g=a.vertices[d].x,h=a.vertices[d].y,i=a.vertices[e].x,j=a.vertices[e].y,k=a.vertices[f].x,l=a.vertices[f].y;return[new $b.Vec2(g/this.repeat,h/this.repeat),new $b.Vec2(i/this.repeat,j/this.repeat),new $b.Vec2(k/this.repeat,l/this.repeat)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},uv:function(a,b,c){return new _b(Math.sqrt(a*a+b*b)/this.repeat,(1-c)/this.repeat)},generateSideWallUV:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a.vertices[e].x,n=a.vertices[e].y,o=a.vertices[e].z,p=a.vertices[f].x,q=a.vertices[f].y,r=a.vertices[f].z,s=a.vertices[g].x,t=a.vertices[g].y,u=a.vertices[g].z,v=a.vertices[h].x,w=a.vertices[h].y,x=a.vertices[h].z,y=Math.abs(n-q),z=Math.abs(m-p);return z>y?[new $b.Vec2(m/this.repeat,(this.amount-o)/this.repeat),new $b.Vec2(p/this.repeat,(this.amount-r)/this.repeat),new $b.Vec2(s/this.repeat,(this.amount-u)/this.repeat),new $b.Vec2(v/this.repeat,(this.amount-x)/this.repeat)]:[new $b.Vec2(n/this.repeat,(this.amount-o)/this.repeat),new $b.Vec2(q/this.repeat,(this.amount-r)/this.repeat),new $b.Vec2(t/this.repeat,(this.amount-u)/this.repeat),new $b.Vec2(w/this.repeat,(this.amount-x)/this.repeat)]}},$b.ShapeNode.__v1=new $b.Vec2,$b.ShapeNode.__v2=new $b.Vec2,$b.ShapeNode.__v3=new $b.Vec2,$b.ShapeNode.__v4=new $b.Vec2,$b.ShapeNode.__v5=new $b.Vec2,$b.ShapeNode.__v6=new $b.Vec2,$b.TextNode=function(a,b,c,d,f,g,h){
var i;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(i=arguments[0],a=i.text,this.font=i.font||"helvetiker",this.size=i.size||150,this.weight=i.weight||"normal",this.fontStyle=i.fontStyle||"normal",this.height=i.height||50,this._id=i.id,this.curveSegments=i.curveSegments):(this.font=d||"helvetiker",this.size=b||150,this.weight=f||"normal",this.fontStyle=g||"normal",this.height=c||50,this.curveSegments=h);var j={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=a;var k=$b.FontUtils.generateShapes(a,j);j.amount=j.height!==e?j.height:50,j.bevelThickness===e&&(j.bevelThickness=10),j.bevelSize===e&&(j.bevelSize=8),j.bevelEnabled===e&&(j.bevelEnabled=!1),$b.ShapeNode.call(this,k,j.curveSegments,this.height,!1,50,!0)},$b.extend($b.TextNode,$b.ShapeNode,{constructor:$b.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var a={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},b={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},c=$b.FontUtils.generateShapes(this.text,a);return $b.ShapeNode.prototype.addShapes.call(this,c,b)}}),$b.LatheNode=function(a,b,c,d,f,g){this.materialSize=3;var h;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof $b.Path)?(h=arguments[0],this.path=h.path,this.segmentsH=h.segmentsH||64,this.segmentsR=h.segmentsR||20,this.arc=h.arc!=e?h.arc:2*Math.PI,this.startClosed=h.startClosed,this.endClosed=h.endClosed,this._id=h.id):(this.path=a,this.segmentsH=b||64,this.segmentsR=c||20,this.arc=d!=e?d:2*Math.PI,this.startClosed=f,this.endClosed=g),$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.extend($b.LatheNode,$b.Entity,{constructor:$b.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function d(a){var b=a.x,c=a.z,d=((0===c?b/Math.abs(b):b/Math.abs(c))+1)/2;d=$b.Math.clamp(d,0,1);var e=((0===b?c/Math.abs(c):c/Math.abs(b))+1)/2;return e=$b.Math.clamp(e,0,1),new $b.Vec2(d,e)}var e={},e={};if(e.faces=[],e.uvs=[],e.vertices=[],null==this.path)return e;var f,g,h,i,j,k,l,m=[],n=this.path,o=this.segmentsH,p=this.segmentsR;for($b.Shape.Utils.isClockWise(n.getPoints())||(n=n.reverse()),g=0;o>=g;g++){for(f=n.getPoint(g/o),m[g]=[],i=Math.abs(f.x),j=f.y,this.startClosed&&0===g&&e.vertices.push(new $b.Vec3(0,j,0)),h=0;p>h;h++)l=h/p*this.arc,k=new $b.Vec3(i*Math.cos(l),j,i*Math.sin(l)),m[g][h]=e.vertices.push(k)-1;this.endClosed&&g===o&&e.vertices.push(new $b.Vec3(0,j,0))}var q=this.arc==2*Math.PI;if(this.startClosed)for(a=0,h=0;(q?p:p-1)>h;h++)jp=(h+1)%p,b=m[0][h],c=m[0][jp],uva=new $b.Vec2(.5,.5),uvb=d(e.vertices[b]),uvc=d(e.vertices[c]),e.faces.push(new $b.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc]);for(g=0;o>g;g++)for(h=0;(q?p:p-1)>h;h++)ip=g+1,jp=(h+1)%p,a=m[g][h],b=m[ip][h],c=m[ip][jp],Wc=m[g][jp],uva=new $b.Vec2(g/o,h/p),uvb=new $b.Vec2((g+1)/o,h/p),uvc=new $b.Vec2((g+1)/o,(h+1)/p),uvd=new $b.Vec2(g/o,(h+1)/p),e.faces.push(new $b.Face3(a,b,Wc)),e.uvs.push([uva,uvb,uvd]),e.faces.push(new $b.Face3(b,c,Wc)),e.uvs.push([uvb.clone(),uvc,uvd.clone()]);if(this.endClosed)for(a=e.vertices.length-1,h=0;(q?p:p-1)>h;h++)jp=(h+1)%p,b=m[m.length-1][h],c=m[m.length-1][jp],uva=new $b.Vec2(0,0),uvb=new $b.Vec2(1,h/p),uvc=new $b.Vec2(1,(h+1)/p),e.faces.push(new $b.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc]);return e}}),$b.CurvePlane=function(a,b,c,d){this.pathH=a,this.pathV=b,this.segmentsH=c||20,this.segmentsV=d||20,$b.Entity.call(this)},$b.extend($b.CurvePlane,$b.Entity,{constructor:$b.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var a={};if(a.faces=[],a.uvs=[],a.vertices=[],null==this.pathV||null==this.pathH)return a;var b,c,d,e,f,g,h,i,j,k=this.pathV,l=this.pathH,m=this.segmentsV,n=this.segmentsH,o=m+1,p=n+1;for(this.grid=[],b=0;p>b;b++){this.grid[b]=[];var q=l.getPointAt(b/p);for(c=0;o>c;c++){var r=k.getPointAt(c/o);this.grid[b][c]=a.vertices.push(new ac(q.x,r.y,q.z+r.z))-1}}for(b=0;n>b;b++)for(c=0;m>c;c++)d=this.grid[b][c],e=this.grid[b][c+1],f=this.grid[b+1][c+1],g=this.grid[b+1][c],h=new _b(b/p,c/o),i=new _b(b/p,(c+1)/o),uvc=new _b((b+1)/p,(c+1)/o),j=new _b((b+1)/p,c/o),a.faces.push(new qc(d,f,e)),a.uvs.push([h,uvc,i]),a.faces.push(new qc(d,g,f)),a.uvs.push([h.clone(),j.clone(),uvc]);return a}}),$b.ComboNode=function(a,b,c,d,e){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var f=a;this.combos=f.combos||[],this.operators=f.operators,this.centralized=c,this.names=e,this._id=f.id}else this.combos=a||[],this.operators=b,this.centralized=c,this._id=d,this.names=e;this.csgs=[],$b.Entity.call(this)},$b.extend($b.ComboNode,$b.Entity,{constructor:$b.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized","names"],__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},getSideIndexMapping:function(){var a,b,c,d,e=this.combos,f=this.names||[],g={},h=0;if(e&&e.length)for(c=0;c<e.length;c++){a=e[c],b=f[c],b||(d=a.getClassName(),d&&d.indexOf(".")>0&&(d=d.substr(d.lastIndexOf(".")+1)),b=d+""+c,b=b.toLowerCase());var i=a.getSideIndexMapping();if(i)for(var j in i)g[b+"-"+j]=h++;else g[b]=h++}return g},computeData:function(){this.csgs=[];var a={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return a;if(null==this.operators||0==this.operators.length){var b=uc.mergeElements(this.combos);if(this.materialSize=b.material.materials.length,this.material=b.material,this.orgMaterial=b.material,a={vertices:b.vertices,faces:b.faces,uvs:b.uvs,uv2s:b.uv2s||[]},this.centralized&&a.vertices){var c=new $b.BoundingBox;c.setFromPoints(a.vertices);var d=c.center();for(g=0;g<a.vertices.length;g++){var f=a.vertices[g];f.sub(d)}this._offsetPosition=d}return a}this.operators=this.operators||[];var g,h,i,j,k=this.combos.length;for(g=0;k>g;g++)this.csgs.push(new $b.CSG(this.combos[g]));for(g=0;k>g;g++)null==h?h=this.csgs[g]:(i=this.operators[g-1],"+"===i||i==e?h=h.union(this.csgs[g]):"-"===i?h=h.substract(this.csgs[g]):"^"===i&&(h=h.intersect(this.csgs[g])));if(!h)return a;if(j=h.toMesh(),("centralized"!=this.changeProperty||null==this.material)&&(this.materialSize=j.material.materials.length,this.material=j.material,this.orgMaterial=j.material),a={vertices:j.vertices,faces:j.faces,uvs:j.uvs,uv2s:j.uv2s},this.centralized&&a.vertices){var c=new $b.BoundingBox;c.setFromPoints(a.vertices);var d=c.center();for(g=0;g<a.vertices.length;g++){var f=a.vertices[g];f.sub(d)}this._offsetPosition=d}return j=e,a},refreshStyleMap:function(){for(var a=this.combos,b=this.styleMap,c=0,d=0;d<a.length;d++){var e=a[d],f=e.getMaterailSize();for(s in e.styleMap)for(var g=b[s]||(b[s]=[]),h=e.styleMap[s],i=0;f>i;i++)g[c+i]=uc.isArray(h)?h[i]:h;c+=f}},computeNodeMaterial:function(a){this.material=a.material,this.materialSize=a.materialSize},cacheNodeMaterial:function(a){a.material=this.material,a.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(a){var b=this.getMaterialMapping();$b.Utils.isSame(a,b)||(this.batch?this.materialMappingChanges=[a,b]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",a,b)))},isStyleEquals:function(a,b,c){return!1},getSelectStyle:function(){var a=this.getStyle("select.style");return("outline.normal"==a||"outline"==a)&&(a="outline.wireframe"),a},onMaterialMapping:function(){this.groups=e,this.primitive.groups=e}}),$b.Terrain=function(a){if(a=a||{},this._id=a.id,this.width=a.width,this.depth=a.depth,this.segmentsW=a.segmentsW||30,this.segmentsD=a.segmentsD||30,this.heightMap=a.heightMap,this.heightUnit=a.heightUnit||1,this.maxHeight=a.maxHeight||255,this.minHeight=a.minHeight||0,this.baseLayerHeight=a.baseLayerHeight||0,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):dc.isCanvas(this.heightMap)?this.canvas=this.heightMap:dc.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var b=this;this.image.onload=function(a){var c=document.createElement("canvas");c.width=b.image.width,c.height=b.image.height;var d=c.getContext("2d");d.drawImage(b.image,0,0),b.canvas=c,b.computed=!1,b.computeNodeData(),b.firePropertyChange("width",0,1)}}this.materialSize=2,$b.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},$b.extend($b.Terrain,$b.Entity,{constructor:$b.Terrain,className:"TGL.Terrain",__accessor:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(a,b,c){var d,e,f=this.width/2,g=this.depth/2,h=c?this.segmentsW:1,i=c?this.segmentsD:1,j=h+1,k=i+1,l=this.width/h,m=this.depth/i,n=new $b.Vec3(0,0,1),o=a.vertices.length;for(e=0;k>e;e++)for(d=0;j>d;d++){var p=d*l-f,q=e*m-g,r=0;r=c?c.call(this,d/j,e/k):this.baseLayerHeight*this.heightUnit,a.vertices.push(new $b.Vec3(p,r,q))}for(e=0;i>e;e++)for(d=0;h>d;d++){var s=d+j*e+o,t=d+j*(e+1)+o,u=d+1+j*(e+1)+o,v=d+1+j*e+o,w=new $b.Vec2(d/h,1-e/i),x=new $b.Vec2(d/h,1-(e+1)/i),y=new $b.Vec2((d+1)/h,1-(e+1)/i),z=new $b.Vec2((d+1)/h,1-e/i);if(c){var A=new $b.Face3(s,t,v);A.materialIndex=b,a.faces.push(A),a.uvs.push([w,x,z]),A=new $b.Face3(t,u,v),A.materialIndex=b,a.faces.push(A),a.uvs.push([x.clone(),y,z.clone()])}else{var A=new $b.Face4(s,t,u,v);A.normal.copy(n),A.vertexNormals.push(n.clone(),n.clone(),n.clone(),n.clone()),A.materialIndex=b,a.faces.push(A),a.uvs.push([w,x,y,z])}}},computeData:function(){var a={};return a.vertices=[],a.faces=[],a.uvs=[],this.computeLayerData(a,0),this.computeLayerData(a,1,this.getHeight),a},getFaceNormal:function(a,b){this.computeFaceNormals();var c=this.segmentsW*a,d=this.segmentsD*b,e=Math.floor(c),f=Math.floor(d),g=f*this.segmentsW+e;g=2*g+1,e!=Math.round(c)&&f!=Math.round(d)&&g++;var h=this.faces[g];this.vertices[h.a],this.vertices[h.b],this.vertices[h.c];return h.normal.clone()},setHeightMap:function(a){if(this.heightMap=a,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):dc.isCanvas(this.heightMap)?this.canvas=this.heightMap:dc.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var b=this;if(this.image.width){var c=document.createElement("canvas");c.width=b.image.width,c.height=b.image.height;var d=c.getContext("2d");d.drawImage(b.image,0,0),b.canvas=c,b.computed=!1,b.computeNodeData(),b.firePropertyChange("width",0,1)}else this.image.onload=function(a){var c=document.createElement("canvas");c.width=b.image.width,c.height=b.image.height;var d=c.getContext("2d");d.drawImage(b.image,0,0),b.canvas=c,b.computed=!1,b.computeNodeData(),b.firePropertyChange("width",0,1)}}},getHeight:function(a,b){if(null==this.canvas)return 0;var c=this.canvas;if(null==this.heightData){for(var d=c.width*c.height,e=new Float32Array(d),f=0;d>f;f++)e[f]=0;for(var g=c.getContext("2d"),h=g.getImageData(0,0,c.width,c.height),i=h.data,j=0,f=0,k=i.length;k>f;f+=4){var l=i[f]+i[f+1]+i[f+2];e[j++]=l/3}this.heightData=e}var m=a*c.width,n=b*c.height,o=Math.floor(m),p=Math.floor(n),q=[],r=[];q.push(o),m!=o&&q.push(o+1),r.push(p),n!=p&&r.push(p+1);var f,j,s,t=q.length*r.length,u=0;for(f=0;f<q.length;f++)for(j=0;j<r.length;j++)s=r[j]*c.width+q[f],u+=this.heightData[s];return u/=t,u=$b.Math.clamp(u,this.minHeight,this.maxHeight),u*=this.heightUnit},getSideIndexMapping:function(){return $b.Terrain.SideIndexMapping},refreshUniforms:function(a){a.heightUnit&&(a.heightUnit.value=this.heightUnit)}}),$b.Terrain.SideIndexMapping={layer0:0,layer1:1},$b.Link=function(a,b,c){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var d=arguments[0];a=d.fromNode,b=d.toNode,this._id=d.id}else this._id=c;$b.Line.call(this),this.setFromNode(a),this.setToNode(b),this._editable=!1},$b.extend($b.Link,$b.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(a){if(this._fromNode!=a){var b=this._fromNode;this._fromNode=a,this.onPropertyChange(),this.firePropertyChange("fromNode",b,a),this._fromNode=a,b&&(b._removeFromLink(this),b.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(a){if(this._toNode!=a){var b=this._toNode;this._toNode=a,this.onPropertyChange(),this.firePropertyChange("toNode",b,a),b&&(b.removePropertyChangeListener(this.handleNodePropertyChange),b._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(a){if(a.property.startsWith("position")||"worldMatrix"==a.property){var b=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",b,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(null!=this._fromNode&&null!=this._toNode){null==this._extend&&(this._extend=0);var a=this._fromNode.worldMatrix.getPosition(),b=this._toNode.worldMatrix.getPosition(),c=[];if(c.push(a.clone()),"orthogonal.x"==this._linkType){var d=Math.max(a.x,b.x),e=new ac(d+this._extend,a.y,a.z);c.push(e),e=new ac(d+this._extend,b.y,b.z),c.push(e)}else if("orthogonal.x.n"==this._linkType){var f=Math.min(a.x,b.x),e=new ac(f-this._extend,a.y,a.z);c.push(e),e=new ac(f-this._extend,b.y,b.z),c.push(e)}else if("orthogonal.y"==this._linkType){var g=Math.max(a.y,b.y),e=new ac(a.x,g+this._extend,a.z);c.push(e),e=new ac(b.x,g+this._extend,b.z),c.push(e)}else if("orthogonal.y.n"==this._linkType){var h=Math.min(a.y,b.y),e=new ac(a.x,h-this._extend,a.z);c.push(e),e=new ac(b.x,h-this._extend,b.z),c.push(e)}else if("orthogonal.z"==this._linkType){var i=Math.max(a.z,b.z),e=new ac(a.x,a.y,i+this._extend);c.push(e),e=new ac(b.x,b.y,i+this._extend),c.push(e)}else if("orthogonal.z.n"==this._linkType){var j=Math.min(a.z,b.z),e=new ac(a.x,a.y,j-this._extend);c.push(e),e=new ac(b.x,b.y,j-this._extend),c.push(e)}else if("control"==this._linkType){var k=this._controls;if(k&&k.length>0)for(var l=0;l<k.length;l++)k[l]instanceof ac&&c.push(k[l].clone())}c.push(b.clone()),this.vertices=c}},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),$b.PathLink=function(a,b,c){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var d=arguments[0];a=d.fromNode,b=d.toNode,this._id=d.id}else this._id=c;$b.PathNode.call(this),this._autoAjust=!0,this.setFromNode(a),this.setToNode(b)},$b.PathLink.allLinkTypes=["extend.x","extend.y","extend.z","extend.x.n","extend.y.n","extend.z.n","orthogonal.x","orthogonal.y","orthogonal.z","orthogonal.x.n","orthogonal.y.n","orthogonal.z.n","flex.x","flex.y","flex.z","flex.yz","flex.xz","flex.xy"],$b.extend($b.PathLink,$b.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls","fromOffset","toOffset"],__SizePropeties:["fromOffset","toOffset","path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(a){if(this._fromNode!=a){var b=this._fromNode;this._fromNode=a,this._dirtyPath=!0,this.onPropertyChange("fromNode",b,a),this.firePropertyChange("fromNode",b,a),this._fromNode=a,b&&(b._removeFromLink(this),b.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(a){if(this._toNode!=a){var b=this._toNode;this._toNode=a,this.onPropertyChange("toNode",b,a),this.firePropertyChange("toNode",b,a),b&&(b.removePropertyChangeListener(this.handleNodePropertyChange),b._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(a){var b=a.source,c=a.property;if(c.startsWith("position")||c.startsWith("rotation")||c.startsWith("scale")||"worldMatrix"==c||"linkAgent"===c||b.isSizeChangedProperty(c)||"parent"===c){this.vertices;this._dirtyPath=!0;var d=this;tc.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){d._computePath()},10):d._computePath()}},_resetPath:function(){if(this.path){var a=!1;if("arrow"!==this.endCap)return this.path;if(this.endCapExtend*this.endCapR>1)return this.path;a=!0;var b,c,d,e=this.path,f=new $b.Path,g=e.actions.length,h=null;for(c=0;g-1>c;c++)b=e.actions[c],d=b.args,h=new $b.Vec3(d[0],d[1],d[2]),"moveTo"===b.action?f.moveTo(d[0],d[1],d[2]):"lineTo"===b.action?f.lineTo(d[0],d[1],d[2]):"quadraticCurveTo"===b.action&&(f.curveTo(d[0],d[1],d[2],d[3],d[4],d[5]),h=new $b.Vec3(d[3],d[4],d[5]));if(c=g-1,b=e.actions[c],d=b.args,"lineTo"===b.action){var i=new $b.Vec3(d[0],d[1],d[2]),j=(new ac).subVectors(i,h).normalize(),g=this.radius*this.endCapSize,k=null;k=(new ac).subVectors(i,h).length()<g?h.add(j.multiplyScalar(.1)):i.clone().sub(j.multiplyScalar(g)),f.lineTo(k.x,k.y,k.z)}return f}},_getNodeOffset:function(a,b,c){b=a.worldToLocal(b.clone()),c=a.worldToLocal(c.clone());var d=(new ac).subVectors(c,b),e=d.length(),f=a.getLinkOffset(d);return f&&f.length()>e&&f.normalize().multiplyScalar(e-.1),f||new ac(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(a,b){},onPropertyChange:function(a,b,c){("fromNode"===a||"toNode"===a||"linkType"===a||"extend"===a||"controls"===a||"fromOffset"===a||"toOffset"===a)&&(this._dirtyPath=!0),$b.Node.prototype.onPropertyChange.call(this,a,b,c)},computeData:function(){return this._computePath(),$b.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(a,b,c){},_flex:function(a,b,c,d,e){a=a.substr(a.indexOf(".")+1);for(var f,g=["x","y","z"],h=new ac,i=new ac,j=0;3>j;j++)f=g[j],h[f]=f===a?d[f]:b[f],i[f]=f===a?d[f]:c[f];e.push(h,i)},_flex2:function(a,b,c,d){a=a.substr(a.indexOf(".")+1);var e=["x","y","z"],f=a[0],g=a[1];if(b[f]!=c[f]){for(var h=new mono.Vec3,i=0;i<e.length;i++)h[e[i]]=e[i]==f?c[e[i]]:b[e[i]];d.push(h)}if(b[g]!=c[g]){for(var j=new mono.Vec3,i=0;i<e.length;i++)j[e[i]]=e[i]==f||e[i]==g?c[e[i]]:b[e[i]];d.push(j)}},_orthogonal:function(a,b,c,d){a=a.substr(a.indexOf(".")+1);var e,f=!1,g=["x","y","z"],h=new ac,i=0;a.endsWith(".n")&&(f=!0,a=a[0]);for(var j=f?b[a]:c[a],k=0;k<g.length;k++)e=g[k],e!==a&&b[e]==c[e]&&i++;if(2!==i){for(var k=0;k<g.length;k++)e=g[k],e!==a?h[e]=j:h[e]=f?c[e]:b[e];d.push(h)}},_removeSamePoint:function(a){},computeLoopPath:function(a){var b=new mono.Path;return b.moveTo(a.x,a.y,a.z),b.lineTo(a.x,a.y+200,a.z),b.lineTo(a.x+200,a.y+200,a.z),b.lineTo(a.x+200,a.y,a.z),b.lineTo(a.x,a.y,a.z),this.setPath(b),b},_computePath:function(){if(this._dirtyPath&&(this._dirtyPath=!1,null!=this._fromNode&&null!=this._toNode)){null==this._extend&&(this._extend=0);var a=this._fromNode.getLinkAgent()||this._fromNode,b=this._toNode.getLinkAgent()||this._toNode,c=a.localToWorld2(new ac(0,0,0)),d=b.localToWorld2(new ac(0,0,0));if(a==b)return this.computeLoopPath(c,d);if(c.equals(d))return void this.setPath(null);var e,f,g=[],h=this.radius*this.endCapSize;if(this._linkType&&this._linkType.startsWith("extend")){var c,d,i,j,k,l,m;if("extend.x"===this._linkType){i=new ac(1,0,0);var c=a.localToWorld2(a.getLinkExtend(i.clone())),d=b.localToWorld2(b.getLinkExtend(i));m=Math.max(c.x,d.x),l=m+this._extend+h+.1,j=new ac(l,c.y,c.z),k=new ac(l,d.y,d.z)}else if("extend.y"===this._linkType){i=new ac(0,1,0);var c=a.localToWorld2(a.getLinkExtend(i.clone())),d=b.localToWorld2(b.getLinkExtend(i));m=Math.max(c.y,d.y),l=m+this._extend+h+.1,j=new ac(c.x,l,c.z),k=new ac(d.x,l,d.z)}else if("extend.z"===this._linkType){i=new ac(0,0,1);var c=a.localToWorld2(a.getLinkExtend(i.clone())),d=b.localToWorld2(b.getLinkExtend(i));m=Math.max(c.z,d.z),l=m+this._extend+h+.1,j=new ac(c.x,c.y,l),k=new ac(d.x,d.y,l)}else if("extend.x.n"===this._linkType){i=new ac(-1,0,0);var c=a.localToWorld2(a.getLinkExtend(i.clone())),d=b.localToWorld2(b.getLinkExtend(i));m=Math.min(c.x,d.x),l=m-this._extend-h-.1,j=new ac(l,c.y,c.z),k=new ac(l,d.y,d.z)}else if("extend.y.n"===this._linkType){i=new ac(0,-1,0);var c=a.localToWorld2(a.getLinkExtend(i.clone())),d=b.localToWorld2(b.getLinkExtend(i));m=Math.min(c.y,d.y),l=m-this._extend-h-.1,j=new ac(c.x,l,c.z),k=new ac(d.x,l,d.z)}else if("extend.z.n"===this._linkType){i=new ac(0,0,-1);var c=a.localToWorld2(a.getLinkExtend(i.clone())),d=b.localToWorld2(b.getLinkExtend(i));m=Math.min(c.z,d.z),l=m-this._extend-h-.1,j=new ac(c.x,c.y,l),k=new ac(d.x,d.y,l)}j?g.push(c,j,k,d):g.push(c,d)}else{if(g.push(c),"orthogonal.x"===this._linkType){if(c.y!=d.y||c.z!=d.z){var n=d.x,o=new ac(n,c.y,c.z);g.push(o)}}else if("orthogonal.x.n"===this._linkType){var n=c.x,o=new ac(n,d.y,d.z);g.push(o)}else if("orthogonal.y"===this._linkType){var p=d.y,o=new ac(c.x,p,c.z);g.push(o)}else if("orthogonal.y.n"===this._linkType){var p=c.y,o=new ac(d.x,p,d.z);g.push(o)}else if("orthogonal.z"===this._linkType){var o=new ac(c.x,c.y,d.z);g.push(o)}else if("orthogonal.z.n"===this._linkType){var o=new ac(d.x,d.y,c.z);g.push(o)}var q=new ac(c.x+d.x,c.y+d.y,c.z+d.z).multiplyScalar(.5);if(("flex.x"===this._linkType||"flex.y"===this._linkType||"flex.z"===this._linkType)&&this._flex(this._linkType,c,d,q,g),("flex.yz"===this._linkType||"flex.zy"===this._linkType||"flex.xy"===this._linkType||"flex.yx"===this._linkType||"flex.xz"===this._linkType||"flex.zx"===this._linkType)&&this._flex2(this._linkType,c,d,g),"control"===this._linkType){var r=this.getControls();uc.isArray(r)&&(g=g.concat(r))}g.push(d),f=g.length;var s=this._getNodeOffset(a,g[0].clone(),g[1].clone()),t=this._getNodeOffset(b,g[f-1].clone(),g[f-2].clone());c=a.localToWorld2(s),d=b.localToWorld2(t),g[0]=c,g[f-1]=d}var f=g.length,u=this.getFromOffset(),v=this.getToOffset();u&&g[0].add(u),v&&g[f-1].add(v);for(var w,e=new $b.Path,x=0;f>x;x++)w=g[x],0===x?e.moveTo(w.x,w.y,w.z):e.lineTo(w.x,w.y,w.z);return this.setPath(e),e}}}),mono.LoadingManager=function(a,b,c){var d=this,f=0,g=0;this.onLoad=a,this.onProgress=b,this.onError=c,this.itemStart=function(a){g++},this.itemEnd=function(a){f++,d.onProgress!==e&&d.onProgress(a,f,g),f===g&&d.onLoad!==e&&d.onLoad()}},mono.DefaultLoadingManager=new mono.LoadingManager,mono.ImageLoader=function(a){this.manager=a!==e?a:mono.DefaultLoadingManager},mono.ImageLoader.prototype={constructor:mono.ImageLoader,load:function(a,b,c,d){var f=this,g=document.createElement("img");return b!==e&&g.addEventListener("load",function(c){f.manager.itemEnd(a),b(this)},!1),c!==e&&g.addEventListener("progress",function(a){c(a)},!1),d!==e&&g.addEventListener("error",function(a){d(a)},!1),this.crossOrigin!==e&&(g.crossOrigin=this.crossOrigin),g.src=a,f.manager.itemStart(a),g},loadFile:function(a,b,c,d){var f=this,g=new FileReader;b!==e&&(g.onload=function(){b(g.result),f.manager.itemEnd(a.name)}),c!==e&&g.addEventListener("progress",function(a){c(a)},!1),d!==e&&g.addEventListener("error",function(a){d(a)},!1),g.readAsDataURL(a),f.manager.itemStart(a.name)},setCrossOrigin:function(a){this.crossOrigin=a}},mono.XHRLoader=function(a){this.manager=a!==e?a:mono.DefaultLoadingManager},mono.XHRLoader.prototype={constructor:mono.XHRLoader,load:function(a,b,c,d){var f=this,g=new XMLHttpRequest;b!==e&&g.addEventListener("load",function(c){b(c.target.responseText),f.manager.itemEnd(a)},!1),c!==e&&g.addEventListener("progress",function(a){c(a)},!1),d!==e&&g.addEventListener("error",function(a){d(a)},!1),this.crossOrigin!==e&&(g.crossOrigin=this.crossOrigin),g.open("GET",a,!0),g.send(null),f.manager.itemStart(a)},loadFile:function(a,b,c,d){if(a){var f=this,g=new FileReader;b!==e&&(g.onload=function(){b(g.result),f.manager.itemEnd(a.name)}),c!==e&&g.addEventListener("progress",function(a){c(a)},!1),d!==e&&g.addEventListener("error",function(a){d(a)},!1),g.readAsText(a),f.manager.itemStart(a.name)}},setCrossOrigin:function(a){this.crossOrigin=a}},mono.MTLLoader=function(a,b,c){this.baseUrl=a,this.options=b,this.crossOrigin=c},mono.extend(mono.MTLLoader,null,{constructor:mono.MTLLoader,load:function(a,b,c,d){var e=this,f=new mono.XHRLoader;f.setCrossOrigin(this.crossOrigin),f.load(a,function(a){b(e.parse(a))})},loadFile:function(a,b,c,d){var e=this,f=new mono.XHRLoader;f.loadFile(a,function(a){b(e.parse(a))})},loadText:function(a,b){b(this.parse(a))},parse:function(a){var b=a.split("\n"),c={},d=/\s+/,e={};this.baseUrl||(this.baseUrl={});for(var f=0;f<b.length;f++){var g=b[f];if(g=g.trim(),0!==g.length&&"#"!==g.charAt(0)){var h=g.indexOf(" "),i=h>=0?g.substring(0,h):g;i=i.toLowerCase();var j=h>=0?g.substring(h+1):"";if(j=j.trim(),"newmtl"===i)c={name:j},e[j]=c;else if(c)if("ka"===i||"kd"===i||"ks"===i){var k=j.split(d,3);c[i]=[parseFloat(k[0]),parseFloat(k[1]),parseFloat(k[2])]}else if("map_kd"===i||"map_ka"===i){var l=j,m=j;if(j.indexOf(".")>0){j=j.substring(0,j.lastIndexOf(".")).toLowerCase();var n={};if(/\-s/.test(j)){var o=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;n=o.exec(j);var p=j.split(n[0]);j=p[p.length-1].trim();var q=l.split(n[0]);m=q[q.length-1].trim()}if(/\-t/.test(j)){var o=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;n=o.exec(j);var p=j.split(n[0]);j=p[p.length-1].trim();var q=l.split(n[0]);m=q[q.length-1].trim()}}this.baseUrl[j]||(this.baseUrl[j]=m),c[i]=l}else c[i]=j}}var r=new mono.MTLLoader.MaterialCreator(this.baseUrl,this.options);return r.setMaterials(e),r}}),mono.MTLLoader.MaterialCreator=function(a,b){this.baseUrl=a,this.options=b,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:mono.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:mono.RepeatWrapping},mono.extend(mono.MTLLoader.MaterialCreator,mono.EventDispatcher,{constructor:mono.MTLLoader.MaterialCreator,setMaterials:function(a){this.materialsInfo=this.convert(a),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(a){if(!this.options)return a;var b={};for(var c in a){var d=a[c],e={};b[c]=e;for(var f in d){var g=!0,h=d[f],i=f.toLowerCase();switch(i){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===h[0]&&0===h[1]&&0===h[1]&&(g=!1);break;case"d":this.options&&this.options.invertTransparency&&(h=1-h)}g&&(e[i]=h)}}return b},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0;for(var b in this.materialsInfo)this.materialsArray[a]=this.create(b),this.nameLookup[b]=a,a++;return this.materialsArray},create:function(a){return this.materials[a]===e&&this.createMaterial_(a),this.materials[a]},createMaterial_:function(a){var b=this,c=this.materialsInfo[a],d={name:a,side:this.side};for(var e in c){var f=c[e];switch(e.toLowerCase()){case"kd":d.diffuse=(new mono.Color).setRGB(f[0],f[1],f[2]);break;case"ka":d.ambient=(new mono.Color).setRGB(f[0],f[1],f[2]);break;case"ks":d.specular=(new mono.Color).setRGB(f[0],f[1],f[2]);break;case"map_kd":if("string"==typeof this.baseUrl)d.map={},d.map.img=this.baseUrl+f,d.map.wrapS=this.wrap,d.map.wrapT=this.wrap;else if("object"==typeof this.baseUrl&&f.indexOf(".")>0){f=f.substring(0,f.lastIndexOf(".")).toLowerCase();var g={};if(/\-s/.test(f)){var h=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;g=h.exec(f);var i=f.split(g[0]);f=i[i.length-1].trim(),g.repeatR=parseInt(g[1]),g.repeatC=parseInt(g[2])}if(/\-t/.test(f)){var h=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;g=h.exec(f);var i=f.split(g[0]);f=i[i.length-1].trim(),g.repeatR=parseInt(g[1]),g.repeatC=parseInt(g[2])}this.baseUrl[f]&&(d.map={},d.map.img=this.baseUrl[f],d.map.wrapS=b.wrap,d.map.wrapT=b.wrap,d.map.repeatR=g.repeatR||1,d.map.repeatC=g.repeatC||1)}break;case"ns":d.shininess=f;break;case"d":1>f&&(d.transparent=!0,d.opacity=f)}}return d.diffuse&&(d.ambient||(d.ambient=d.diffuse),d.color=d.diffuse),this.materials[a]=d,this.materials[a]},loadTexture:function(a,b,c,d){var e=/\.dds$/i.test(a);if(e)var f=mono.ImageUtils.loadCompressedTexture(a,b,c,d);else{var g=new Image,f=new mono.Texture(g,b),h=new mono.ImageLoader;h.crossOrigin=this.crossOrigin,h.load(a,function(a){f.image=mono.MTLLoader.ensurePowerOfTwo_(a),f.needsUpdate=!0,c&&c(f)})}return f}}),mono.MTLLoader.ensurePowerOfTwo_=function(a){if(!mono.MTLLoader.isPowerOfTwo_(a.width)||!mono.MTLLoader.isPowerOfTwo_(a.height)){var b=document.createElement("canvas");b.width=mono.MTLLoader.nextHighestPowerOfTwo_(a.width),b.height=mono.MTLLoader.nextHighestPowerOfTwo_(a.height);var c=b.getContext("2d");return c.drawImage(a,0,0,a.width,a.height,0,0,b.width,b.height),b}return a},mono.MTLLoader.isPowerOfTwo_=function(a){return 0===(a&a-1)},mono.MTLLoader.nextHighestPowerOfTwo_=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},mono.OBJMTLLoader=function(){},mono.extend(mono.OBJMTLLoader,mono.MTLLoader,{constructor:mono.OBJMTLLoader,load:function(a,b,c,d,e,f){var g=this,h=new mono.MTLLoader(c);h.load(b,function(b){var e=b;e.preload();var f=new mono.XHRLoader(g.manager);f.setCrossOrigin(this.crossOrigin),f.load(a,function(b){var f=g.parse(b),h="";!c&&a.lastIndexOf("/")>0&&(h=a.substring(0,a.lastIndexOf("/")+1));for(var i=0;i<f._childList._as.length;i++){var j=f._childList._as[i];if(j.mname){var k=e.create(j.mname);g.setGeometryStyle(j,k,h)}for(var l=0;l<j._childList._as.length;l++){var m=j._childList._as[l];if(m.mname){var n=e.create(m.mname);g.setGeometryStyle(m,n,h)}}}d(f)})})},setGeometryStyle:function(a,b,c){var d={};if(b.map){c?this.loadTexture(a,c+b.map.img):this.loadTexture(a,b.map.img);var e=b.map.repeatR,f=b.map.repeatC;e&&f&&(d["m.texture.repeat"]=new mono.Vec2(e,f),d["m.texture.wrapS"]=$b.RepeatWrapping,d["m.texture.wrapT"]=$b.RepeatWrapping)}d["m.ambient"]=b.ambient,d["m.specular"]=b.specular,d["m.color"]=b.color,b.transparent&&(d["m.transparent"]=!0,d["m.opacity"]=b.opacity),a.s(d)},loadBase64:function(a,b,c,d,e,f){var g=this,h=mono.base64decode(b),i=mono.base64decode(a),j=new mono.MTLLoader(c);j.loadText(h,function(a){var b=a;b.preload();var e=g.parse(i),f="";!c&&url.lastIndexOf("/")>0&&(f=url.substring(0,url.lastIndexOf("/")+1));for(var h=0;h<e._childList._as.length;h++){var j=e._childList._as[h];if(j.mname){var k=b.create(j.mname);g.setGeometryStyle(j,k,f)}for(var l=0;l<j._childList._as.length;l++){var m=j._childList._as[l];if(m.mname){var n=b.create(m.mname);g.setGeometryStyle(m,n,f)}}}d(e)})},loadFiles:function(a,b,c,d,e,f){var g=this,h=new mono.MTLLoader(c);h.loadFile(b,function(b){var c=b;c.preload();var e=new mono.XHRLoader(g.manager);e.loadFile(a,function(a){for(var b=g.parse(a),e=0;e<b._childList._as.length;e++){var f=b._childList._as[e];if(f.mname){var h=c.create(f.mname);g.setGeometryStyle(f,h);
}for(var i=0;i<f._childList._as.length;i++){var j=f._childList._as[i];if(j.mname){var k=c.create(j.mname);g.setGeometryStyle(j,k)}}}d(b)})})},loadTexture:function(a,b){if("string"==typeof b)a.setStyle("m.texture.image",b);else if(a&&b){var c=new mono.ImageLoader;c.loadFile(b,function(b){a.setStyle("m.texture.image",b)})}},parse:function(a,b){function c(a,b,c){return new mono.Vec3(a,b,c)}function d(a,b){return new mono.Vec2(a,b)}function f(a,b,c,d,e){return new mono.Face3(a,b,c,d,null,e)}function g(a,b){if(o.length>0&&(n.vertices=o,s.length>0&&(n.setMaterialSize(s.length),n.setStyle("m.normalType",$b.NormalTypeSmooth)),n.computed=!1,n.computeCentroids(),n.computeFaceNormals(),n.computeBoundingSphere(),n.faces.length>0)){var c=n._name;m.addChild(n),n=new mono.Entity,n._name=c,n.setStyle("m.type","phong"),p=0}a!==e&&(n._name=a),n.setClient("name",a),b!==e&&(n.mname=b)}function h(a,b,c,d,g){d===e?n.faces.push(f(parseInt(a)-(k+1),parseInt(b)-(k+1),parseInt(c)-(k+1))):n.faces.push(f(parseInt(a)-(k+1),parseInt(b)-(k+1),parseInt(c)-(k+1),[q[parseInt(d[0])-1].clone(),q[parseInt(d[1])-1].clone(),q[parseInt(d[2])-1].clone()],g))}function i(a,b,c){n.uvs.push([r[parseInt(a)-1].clone(),r[parseInt(b)-1].clone(),r[parseInt(c)-1].clone()])}function j(a,b,c){var d=s.length>0?s.indexOf(t):0;a[3]===e?(h(a[0],a[1],a[2],c,d),b!==e&&b.length>0&&i(b[0],b[1],b[2])):(c!==e&&c.length>0?(h(a[0],a[1],a[3],[c[0],c[1],c[3]],d),h(a[1],a[2],a[3],[c[1],c[2],c[3]],d)):(h(a[0],a[1],a[3]),h(a[1],a[2],a[3])),b!==e&&b.length>0&&(i(b[0],b[1],b[3]),i(b[1],b[2],b[3])))}var k=0,l=new mono.Entity,m=l,n=new mono.Entity;n.setStyle("m.type","phong");for(var o=[],p=0,q=[],r=[],s=[],t=0,u=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,v=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,x=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,y=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,z=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,A=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,B=/s( +(\d))?/,C=a.split("\n"),D=0;D<C.length;D++){var E=C[D];E=E.trim();var F;if(0!==E.length&&("#"!==E.charAt(0)||"o"==E.charAt(2)))if(null!==(F=u.exec(E)))o.push(c(parseFloat(F[1]),parseFloat(F[2]),parseFloat(F[3])));else if(null!==(F=v.exec(E)))q.push(c(parseFloat(F[1]),parseFloat(F[2]),parseFloat(F[3])));else if(null!==(F=w.exec(E)))r.push(d(parseFloat(F[1]),parseFloat(F[2])));else if(null!==(F=x.exec(E)))j([F[1],F[2],F[3],F[4]]);else if(null!==(F=y.exec(E)))j([F[2],F[5],F[8],F[11]],[F[3],F[6],F[9],F[12]]);else if(null!==(F=z.exec(E)))j([F[2],F[6],F[10],F[14]],[F[3],F[7],F[11],F[15]],[F[4],F[8],F[12],F[16]]);else if(null!==(F=A.exec(E)))j([F[2],F[5],F[8],F[11]],[],[F[3],F[6],F[9],F[12]]);else if("#"===E.charAt(0)&&"o"===E.charAt(2))g(),k+=o.length,o=[],m=new mono.Entity,m._name=E.substring(2).trim(),l.addChild(m);else if(/^g /.test(E))g(E.substring(2).trim(),e);else if(/^usemtl /.test(E))g(e,E.substring(7).trim());else if(/^mtllib /.test(E)){if(b){var G=E.substring(7);G=G.trim(),b(G)}}else/^s /.test(E)&&(F=B.exec(E),s.indexOf(F[2])<0&&s.push(F[2]),t=F[2])}return g(e,e),l}});mono.DaeAdapter=function(){function a(a,c,d){var f=0;if(a!==e){var g=a.split("/");g.pop(),Y=(g.length<1?".":g.join("/"))+"/"}var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==h.readyState){if(0==h.status||200==h.status)if(h.responseXML)b(h.responseXML,c,a);else if(h.responseText){var e=new DOMParser,g=e.parseFromString(h.responseText,"application/xml");b(g,c,a)}else console.error("ColladaLoader: Empty or non-existing file ("+a+")")}else 3==h.readyState&&d&&(0==f&&(f=h.getResponseHeader("Content-Length")),d({total:f,loaded:h.responseText.length}))},h.open("GET",a,!0),h.send(null)}function b(a,b,e){Q=a,C(),V=m(),T=new h,T.parse();var f=O();if(X=E(),W=G(),$=d(),T)for(var g=0;g<T.nodes.length;g++)c(T.nodes[g]);var i={lights:f,visualScenes:T,images:X,materials:$,geometries:V,entityies:Z};b&&b(i)}function c(a,b){if(a){for(var d={},e=0;e<a.geometries.length;e++){var f,g=a.geometries[e],h=g.instance_material,i=V[g.url],j={},k=[],l=0;if(i){if(!i.mesh||!i.mesh.primitives)continue;if(h)for(var m=0;m<h.length;m++){var n=h[m],o=$[n.target],p=o.instance_effect.url,q=W[p].shader,r=q.material;if(i.doubleSided){if(!(n.symbol in d)){var s=r.clone();s.side=mono.DoubleSide,d[n.symbol]=s}r=d[n.symbol]}r.opacity=r.opacity?r.opacity:1,j[n.symbol]=l,k.push(r),f=r,f.name=null==o.name||""===o.name?o.id:o.name,l++}var t=f||new mono.LambertMaterial({color:14540253,shading:mono.FlatShading,side:i.doubleSided?mono.DoubleSide:mono.FrontSide}),u=i.mesh.node3D;if(l>1)for(t=new mono.ArrayMaterial(k),m=0;m<u.faces.length;m++){var v=u.faces[m];v.materialIndex=j[v.daeMaterial]}t instanceof mono.ArrayMaterial&&u.setMaterialSize(t.materials.length),u.createMaterial(t),u.matrix=a.matrix,u.matrix.decompose(u._position,u.quaternion,u.scale);var w=u.quaternion;if(w){var x=w.x*w.x,y=w.y*w.y,z=w.z*w.z,A=w.w*w.w;u._rotation.x=Math.atan2(2*(w.x*w.w-w.y*w.z),A-x-y+z),u._rotation.y=Math.asin(mono.Math.clamp(2*(w.x*w.z+w.y*w.w),-1,1)),u._rotation.z=Math.atan2(2*(w.z*w.w-w.x*w.y),A+x-y-z)}Z.push(u)}}for(var m=0;m<a.nodes.length;m++)c(a.nodes[m],a)}}function d(){var a=Q.querySelectorAll("library_materials material"),b={};if(a&&a.length>0)for(var c=0;c<a.length;c++){var d=a[c];if(d){var e=(new f).parse(d);e&&(b[e.id]=e)}}return b}function f(){this.id="",this.name="",this.instance_effect=null}function g(){this.url=""}function h(){this.nodes=[],this.id="",this.name=""}function i(){this.nodes=[],this.id="",this.name="",this.sid="",this.type="",this.controllers=[],this.geometries=[],this.type="",this.layer="",this.matrix=new mono.Mat4,this.transforms=[]}function j(){this.sid="",this.type="",this.data=[]}function k(){this.url="",this.instance_material=[]}function l(){this.symbol="",this.target=""}function m(){var a={};a.entity=[];var b=Q.querySelectorAll("library_geometries geometry");if(b&&b.length>0)for(var c=0;c<b.length;c++){var d=(new n).parse(b[c]);d&&(a[d.id]=d,a.entity.push(d))}return a}function n(){this.id="",this.mesh=null}function o(){this.sources={},this.primitives=[],this.vertices=null,this.node3D=null}function p(a,b){var c=[a[b],a[b+1],a[b+2]];return q(c,-1),new mono.Vec3(c[0],c[1],c[2])}function q(a,b){if(_.convertUpAxis===!0&&R!==_.upAxis)switch(S){case"XtoY":var c=a[0];a[0]=b*a[1],a[1]=c;break;case"XtoZ":var c=a[2];a[2]=a[1],a[1]=a[0],a[0]=c;break;case"YtoX":var c=a[0];a[0]=a[1],a[1]=b*c;break;case"YtoZ":var c=a[1];a[1]=b*a[2],a[2]=c;break;case"ZtoX":var c=a[0];a[0]=a[1],a[1]=a[2],a[2]=c;break;case"ZtoY":var c=a[1];a[1]=a[2],a[2]=b*c}}function r(){this.id="",this.input={}}function s(){this.semantic="",this.offset=0,this.source="",this.set=0}function t(){this.inputs=[],this.count=0,this.p=[],this.material=""}function u(){t.call(this),this.vcount=3}function v(){this.id,this.dataType,this.technique_common={},this.accessor=null,this.data=[]}function w(){this.source="",this.count=0,this.stride=0,this.params=[]}function x(a){return a?parseInt(a,10):0}function y(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function z(a){var b=[];if(!a)return a;if(a=y(a),a.length>0)for(var c=a.split(/\s+/),d=0;d<c.length;d++){var f=c[d];f!=e&&null!=f&&null!=parseFloat(f)&&b.push(parseFloat(f))}return b}function A(a){var b=[];if(!a)return[];if(a=y(a),a.length>0)for(var c=a.split(/\s+/),d=0;d<c.length;d++){var f=c[d];f!=e&&null!=f&&null!=parseInt(f)&&b.push(parseInt(f))}return b}function B(a){var b=[];if(!a)return[];if(a=y(a),a.length>0)for(var c=a.split(/\s+/),d=0;d<c.length;d++)b.push("true"==c[d]||"1"==c[d]?!0:!1);return b}function C(){if(_.convertUpAxis!==!0||R===_.upAxis)S=null;else switch(R){case"X":S="Y"===_.upAxis?"XtoY":"XtoZ";break;case"Y":S="X"===_.upAxis?"YtoX":"YtoZ";break;case"Z":S="X"===_.upAxis?"ZtoX":"ZtoY"}}function D(a){if(_.convertUpAxis){var b=[a[0],a[4],a[8]];q(b,-1),a[0]=b[0],a[4]=b[1],a[8]=b[2],b=[a[1],a[5],a[9]],q(b,-1),a[1]=b[0],a[5]=b[1],a[9]=b[2],b=[a[2],a[6],a[10]],q(b,-1),a[2]=b[0],a[6]=b[1],a[10]=b[2],b=[a[0],a[1],a[2]],q(b,-1),a[0]=b[0],a[1]=b[1],a[2]=b[2],b=[a[4],a[5],a[6]],q(b,-1),a[4]=b[0],a[5]=b[1],a[6]=b[2],b=[a[8],a[9],a[10]],q(b,-1),a[8]=b[0],a[9]=b[1],a[10]=b[2],b=[a[3],a[7],a[11]],q(b,-1),a[3]=b[0],a[7]=b[1],a[11]=b[2]}return new mono.Mat4(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function E(){var a=Q.querySelectorAll("library_images image"),b={};if(a&&a.length>0)for(var c=0;c<a.length;c++){var d=a[c];if(d){var e=(new F).parse(d);b[e.id]=e}}return b}function F(){this.id="",this.init_from=""}function G(){var a=Q.querySelectorAll("library_effects effect"),b={};if(a&&a.length>0)for(var c=0;c<a.length;c++){var d=a[c];if(d){var e=(new H).parse(d);b[e.id]=e}}return b}function H(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function I(a,b){this.type=a,this.effect=b,this.material=null}function J(){this.color=new mono.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function K(a){this.effect=a,this.init_from=null,this.format=null}function L(a){this.effect=a,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function M(a){for(var b=Q.querySelectorAll("library_nodes node"),c=0;c<b.length;c++){var d=b[c].attributes.getNamedItem("id");if(d&&d.value===a)return b[c]}return e}function N(a,b){a.doubleSided=!1;var c=b.querySelectorAll("extra double_sided")[0];c&&c&&1===parseInt(c.textContent,10)&&(a.doubleSided=!0)}function O(){var a=[],b=Q.querySelectorAll("library_lights light");if(b&&b.length>0)for(var c=0;c<b.length;c++){var d=(b[c],(new P).parse(b));a.push(d)}return a}function P(){this.id="",this.name="",this.technique=""}this.id="",this.name="",this.type="";var Q=null,R="Y",S=null,T=null,U={},V={},W={},X={},Y="",Z=[],$={},_={};return f.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++)if("instance_effect"==a.childNodes[b].nodeName){this.instance_effect=(new g).parse(a.childNodes[b]);break}return this},g.prototype.parse=function(a){return this.url=a.getAttribute("url").replace(/^#/,""),this},h.prototype.parse=function(){var a=Q.querySelectorAll("library_visual_scenes visual_scene");if(!a||a.length<0)return this;this.id="",this.name="";for(var b=0;b<a.length;b++){var c=a[b];if(c&&c.childNodes&&c.childNodes.length>0)for(var d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];if(e&&e.nodeName)switch(e.nodeName){case"node":this.nodes.push((new i).parse(e))}}}return this},i.prototype.parse=function(a){if(!a)return this;if(this.id=a.getAttribute("id"),this.sid=a.getAttribute("sid"),this.name=a.getAttribute("name"),this.type=a.getAttribute("type"),this.layer=a.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",a.childNodes.length>0)for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c&&c.nodeName)switch(c.nodeName){case"node":this.nodes.push((new i).parse(c));break;case"instance_camera":break;case"instance_controller":break;case"instance_geometry":this.geometries.push((new k).parse(c));break;case"instance_light":break;case"instance_node":var d=c.getAttribute("url").replace(/^#/,""),e=M(d);e&&this.nodes.push((new i).parse(e));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new j).parse(c));break;case"extra":break;default:console.log(c.nodeName)}}return this.updateMatrix(),this},i.prototype.updateMatrix=function(){this.matrix.identity();for(var a=0;a<this.transforms.length;a++)this.transforms[a].apply(this.matrix)},j.prototype.parse=function(a){return this.sid=a.getAttribute("sid"),this.type=a.nodeName,this.data=z(a.textContent),this.convert(),this},j.prototype.convert=function(){switch(this.type){case"matrix":this.obj=D(this.data);break;case"rotate":this.angle=mono.Math.degToRad(this.data[3]);case"translate":q(this.data,-1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;case"scale":q(this.data,1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},j.prototype.apply=function(){var a=new mono.Mat4;return function(b){switch(this.type){case"matrix":b.multiply(this.obj);break;case"translate":b.multiply(a.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":b.multiply(a.makeRotationAxis(this.obj,this.angle));break;case"scale":b.scale(this.obj)}}}(),j.prototype.update=function(a,b){var c=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(b)if(1===b.length)switch(b[0]){case 0:this.obj.n11=a[0],this.obj.n21=a[1],this.obj.n31=a[2],this.obj.n41=a[3];break;case 1:this.obj.n12=a[0],this.obj.n22=a[1],this.obj.n32=a[2],this.obj.n42=a[3];break;case 2:this.obj.n13=a[0],this.obj.n23=a[1],this.obj.n33=a[2],this.obj.n43=a[3];break;case 3:this.obj.n14=a[0],this.obj.n24=a[1],this.obj.n34=a[2],this.obj.n44=a[3]}else if(2===b.length){var d="n"+(b[0]+1)+(b[1]+1);this.obj[d]=a}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(a);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case"X":this.obj.x=a;break;case"Y":this.obj.y=a;break;case"Z":this.obj.z=a;break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(b)&&(b=c[b[0]]),b){case"X":this.obj.x=a;break;case"Y":this.obj.y=a;break;case"Z":this.obj.z=a;break;case"ANGLE":this.angle=mono.Math.degToRad(a);break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2],this.angle=mono.Math.degToRad(a[3])}}},k.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType&&"bind_material"==c.nodeName){for(var d=c.querySelectorAll("instance_material"),e=0;e<d.length;e++){var f=d[e];this.instance_material.push((new l).parse(f))}break}}return this},l.prototype.parse=function(a){return this.symbol=a.getAttribute("symbol"),this.target=a.getAttribute("target").replace(/^#/,""),this},n.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c&&"mesh"==c.nodeName){var d=new o,e=d.parse(c);e&&(this.mesh=e)}}return this},o.prototype.parse=function(a){if(a&&a.childNodes&&a.childNodes.length>0)for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"source":var d=c.getAttribute("id");this.sources[d]=(new v).parse(c);break;case"vertices":var e=new r;this.vertices=e.parse(c);break;case"polygons":var f=(new t).parse(c);f&&this.primitives.push(f);break;case"triangles":var g=(new u).parse(c);g&&this.primitives.push(g);break;case"polylist":var h=null;this.primitives.push(h)}}this.node3D=new mono.Entity;var i=null;for(this.vertices&&this.vertices.input&&this.vertices.input.POSITION&&(i=this.sources[this.vertices.input.POSITION.source].data),b=0;b<this.primitives.length;b++){var j=this.primitives[b];j.setVertices(this.vertices),this.handlePrimitive(j,this.node3D)}for(b=0;b<i.length;b+=3)this.node3D.vertices.push(p(i,b).clone());return this.node3D.computeFaceNormals(),this},o.prototype.handlePrimitive=function(a,b){var c,d,f,g,h,i,j,k=a.p,l=a.inputs,m=0,n=3,o=0,q=[];for(c=0;c<l.length;c++){f=l[c];var r=f.offset+1;switch(o=r>o?r:o,f.semantic){case"TEXCOORD":q.push(f.set)}}for(var s=0;s<k.length;++s)for(var t=k[s],u=0;u<t.length;){var v=[],w=[],x=null,y=[];for(n=a.vcount?a.vcount.length?a.vcount[m++]:a.vcount:t.length/o,c=0;n>c;c++)for(d=0;d<l.length;d++)switch(f=l[d],i=this.sources[f.source],g=t[u+c*o+f.offset],j=i.accessor.params.length,h=g*j,f.semantic){case"VERTEX":v.push(g);break;case"NORMAL":w.push(p(i.data,h));break;case"TEXCOORD":x=x||{},x[f.set]===e&&(x[f.set]=[]),x[f.set].push(new mono.Vec2(i.data[h],i.data[h+1]));break;case"COLOR":y.push((new mono.Color).setRGB(i.data[h],i.data[h+1],i.data[h+2]))}if(0==w.length)if(f=this.vertices.input.NORMAL){i=i[f.source],j=i.accessor.params.length;for(var z=0,A=v.length;A>z;z++)w.push(p(i.data,v[z]*j))}else b.calcNormals=!0;if(!x&&(x={},f=this.vertices.input.TEXCOORD)){q.push(f.set),i=sources[f.source],j=i.accessor.params.length;for(var z=0,A=v.length;A>z;z++)h=v[z]*j,x[f.set]===e&&(x[f.set]=[]),x[f.set].push(new mono.Vec2(i.data[h],1-i.data[h+1]))}if(0==y.length&&(f=this.vertices.input.COLOR)){i=sources[f.source],j=i.accessor.params.length;for(var z=0,A=v.length;A>z;z++)h=v[z]*j,y.push((new mono.Color).setRGB(i.data[h],i.data[h+1],i.data[h+2]))}var B,C,D=null,E=[];if(3===n)E.push(new mono.Face3(v[0],v[1],v[2],w,y.length?y:new mono.Color(16711680)));else if(4===n)E.push(new mono.Face3(v[0],v[1],v[3],[w[0],w[1],w[3]],y.length?[y[0],y[1],y[3]]:new mono.Color(16711680))),E.push(new mono.Face3(v[1],v[2],v[3],[w[1],w[2],w[3]],y.length?[y[1],y[2],y[3]]:new mono.Color(16711680)));else if(n>4&&_.subdivideFaces){var F=y.length?y:new mono.Color;for(d=1;n-1>d;)E.push(new mono.Face3(v[0],v[d],v[d+1],[w[0],w[d++],w[d]],F))}if(E.length)for(var z=0,A=E.length;A>z;z++)for(D=E[z],D.daeMaterial=a.material,b.faces.push(D),d=0;d<q.length;d++)B=x[q[d]],C=n>4?[B[0],B[z+1],B[z+2]]:4===n?0===z?[B[0],B[1],B[3]]:[B[1].clone(),B[2],B[3].clone()]:[B[0],B[1],B[2]],b.uvs===e&&(b.uvs=[]),b.uvs.push(C);else console.log("dropped face with vcount "+n+" for geometry with id: "+b.id);u+=o*n}},r.prototype.parse=function(a){if(a&&(this.id=a.getAttribute("id"),a.childNodes.length>0))for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c&&c.nodeName)switch(c.nodeName){case"input":var d=(new s).parse(c);this.input[d.semantic]=d}}return this},s.prototype.parse=function(a){return a&&(this.semantic=a.getAttribute("semantic"),this.offset=x(a.getAttribute("offset")),this.set=x(a.getAttribute("set")),this.source=a.getAttribute("source").replace(/^#/,""),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0)),this},t.prototype.parse=function(a){if(a&&(this.count=a.getAttribute("count"),this.material=a.getAttribute("material"),a.childNodes.length>0))for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c&&c.nodeName)switch(c.nodeName){case"input":var d=(new s).parse(c);d&&this.inputs.push(d);break;case"p":this.p.push(A(c.textContent))}}return this},t.prototype.setVertices=function(a){for(var b=0;b<this.inputs.length;b++)this.inputs[b].source==a.id&&(this.inputs[b].source=a.input.POSITION.source)},u.prototype=Object.create(t.prototype),v.prototype.parse=function(a){if(!a)return this;if(this.id=a.getAttribute("id"),a.childNodes.length>0)for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c&&c.nodeName)switch(c.nodeName){case"float_array":this.dataType=c.nodeName,this.data=z(c.textContent);break;case"bool_array":this.dataType=c.nodeName,this.data=B(c.textContent);break;case"int_array":this.data=A(c.textContent),this.dataType=c.nodeName;break;case"technique_common":if(c.childNodes&&c.childNodes.length>0)for(var d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];if(e&&e.nodeName)switch(e.nodeName){case"accessor":var f=(new w).parse(e);f.source&&(this.technique_common[f.source]=f,this.accessor=f)}}}}return this},v.prototype.read=function(){var a=[],b=this.accessor.params[0];switch(b.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var c=0;c<this.data.length;c+=16){var d=this.data.slice(c,c+16),e=D(d);a.push(e)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+b.type+".")}return a},w.prototype.parse=function(a){if(!a)return this;if(this.source=a.getAttribute("source"),this.count=x(a.getAttribute("count")),this.stride=x(a.getAttribute("stride")),a.childNodes.length>0)for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c&&c.nodeName)switch(c.nodeName){case"param":var d={};d.name=c.getAttribute("name"),d.type=c.getAttribute("type"),this.params.push(d)}}return this},F.prototype.parse=function(a){this.id=a.getAttribute("id");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];"init_from"==c.nodeName&&(this.init_from=c.textContent)}return this},H.prototype.create=function(){return null==this.shader?null:void 0},H.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name"),N(this,a),this.shader=null;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(c))}}return this},H.prototype.parseNewparam=function(a){for(var b=a.getAttribute("sid"),c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"surface":this.surface[b]=new K(this).parse(d);break;case"sampler2D":this.sampler[b]=new L(this).parse(d);break;case"extra":break;default:console.log(d.nodeName)}}},H.prototype.parseProfileCOMMON=function(a){for(var b,c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(1==d.nodeType)switch(d.nodeName){case"profile_COMMON":this.parseProfileCOMMON(d);break;case"technique":b=d;break;case"newparam":this.parseNewparam(d);break;case"image":var e=(new F).parse(d);X[e.id]=e;break;case"extra":break;default:console.log(d.nodeName)}}return b},H.prototype.parseTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new I(c.nodeName,this).parse(c);break;case"extra":this.parseExtra(c)}}},H.prototype.parseExtra=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique":this.parseExtraTechnique(c)}}},H.prototype.parseExtraTechnique=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"bump":this.shader.parse(c)}}},I.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[c.nodeName]=(new J).parse(c);break;case"bump":var d=c.getAttribute("bumptype");d?"heightfield"===d.toLowerCase()?this.bump=(new J).parse(c):"normalmap"===d.toLowerCase()?this.normal=(new J).parse(c):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+d+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new J).parse(c)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new J).parse(c));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var e=c.querySelectorAll("float");e.length>0&&(this[c.nodeName]=parseFloat(e[0].textContent))}}return this.create(),this},I.prototype.create=function(){var a={},b=!1;if(this.transparency!==e&&this.transparent!==e){var c=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);c>0&&(b=!0,a.transparent=!0,a.opacity=1-c)}var d={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var f in this)switch(f){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var g=this[f];if(g instanceof J)if(g.isTexture()){var h=g.texture,i=this.effect.sampler[h],j=null;if(i!==e&&i.source!==e){var k=this.effect.surface[i.source];j=X[k.init_from]}else j=X[h];if(j){var l=Y+j.init_from,m=new Image;m.loaded=!1;var n=new mono.Texture;n._imageSrc=l,n._image=m,n.setImage(l),n.wrapS=g.texOpts.wrapU?mono.RepeatWrapping:mono.ClampToEdgeWrapping,n.wrapT=g.texOpts.wrapV?mono.RepeatWrapping:mono.ClampToEdgeWrapping,n.offsetX=g.texOpts.offsetU,n.offsetY=g.texOpts.offsetV,n.repeatX=g.texOpts.repeatU,n.repeatY=g.texOpts.repeatV,a[d[f]]=n,"emission"===f&&(a.emissive=16777215)}}else"diffuse"!==f&&b||("emission"===f?a.emissive=g.color.getHex():a[f]=g.color.getHex());break;case"shininess":a[f]=this[f];break;case"reflectivity":a[f]=this[f],a[f]>0&&(a.envMap=_.defaultEnvMap),a.combine=mono.MixOperation;break;case"index_of_refraction":a.refractionRatio=this[f],1!==this[f]&&(a.envMap=_.defaultEnvMap);break;case"transparency":}switch(a.shading=mono.SmoothShading,a.side=this.effect.doubleSided?mono.DoubleSide:mono.FrontSide,this.type){case"constant":a.emissive!=e&&(a.color=a.emissive),this.material=new mono.EntityMaterial(a);break;case"phong":case"blinn":a.diffuse!=e&&(a.color=a.diffuse),this.material=new mono.EntityMaterial(a);break;case"lambert":default:a.diffuse!=e&&(a.color=a.diffuse),this.material=new mono.LambertMaterial(a)}return this.material},J.prototype.isColor=function(){return null==this.texture},J.prototype.isTexture=function(){return null!=this.texture},J.prototype.parse=function(a){"transparent"==a.nodeName&&(this.opaque=a.getAttribute("opaque"));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"color":var d=z(c.textContent);this.color=new mono.Color,this.color.setRGB(d[0],d[1],d[2]),this.color.a=d[3];break;case"texture":this.texture=c.getAttribute("texture"),this.texcoord=c.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(c)}}return this},J.prototype.parseTexture=function(a){if(!a.childNodes)return this;a.childNodes[1]&&"extra"===a.childNodes[1].nodeName&&(a=a.childNodes[1],a.childNodes[1]&&"technique"===a.childNodes[1].nodeName&&(a=a.childNodes[1]));for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[c.nodeName]=parseFloat(c.textContent);break;case"wrapU":case"wrapV":"TRUE"===c.textContent.toUpperCase()?this.texOpts[c.nodeName]=1:this.texOpts[c.nodeName]=parseInt(c.textContent);break;default:this.texOpts[c.nodeName]=c.textContent}}return this},K.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"init_from":this.init_from=c.textContent;break;case"format":this.format=c.textContent;break;default:console.log("unhandled Surface prop: "+c.nodeName)}}return this},L.prototype.parse=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"source":this.source=c.textContent;break;case"minfilter":this.minfilter=c.textContent;break;case"magfilter":this.magfilter=c.textContent;break;case"mipfilter":this.mipfilter=c.textContent;break;case"wrap_s":this.wrap_s=c.textContent;break;case"wrap_t":this.wrap_t=c.textContent;break;default:console.log("unhandled Sampler2D prop: "+c.nodeName)}}return this},P.prototype.parse=function(a){this.id=a.getAttribute("id"),this.name=a.getAttribute("name");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(1==c.nodeType)switch(c.nodeName){case"technique_common":this.parseCommon(c);break;case"technique":this.parseTechnique(c)}}return this},P.prototype.parseCommon=function(a){for(var b=0;b<a.childNodes.length;b++)switch(a.childNodes[b].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=a.childNodes[b].nodeName;for(var c=a.childNodes[b],d=0;d<c.childNodes.length;d++){var e=c.childNodes[d];switch(e.nodeName){case"color":var f=z(e.textContent);this.color=new mono.Color(0),this.color.setRGB(f[0],f[1],f[2]),this.color.a=f[3];break;case"falloff_angle":this.falloff_angle=parseFloat(e.textContent);break;case"quadratic_attenuation":var g=parseFloat(e.textContent);this.distance=g?Math.sqrt(1/g):0}}}return this},P.prototype.parseTechnique=function(a){this.profile=a.getAttribute("profile");for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];switch(c.nodeName){case"intensity":this.intensity=parseFloat(c.textContent)}}return this},{load:a,parse:b,geometries:U,options:_}};$b.DataBox=function(a){$b.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=a),this._dataList=new mc,this._dataMap={},this._rootList=new mc,this._rootMap={},this._clientMap={},this._lightList=new mc,this._flareList=new mc,this._billboardList=new mc,this._nodeList=new mc,this._annotationList=new mc,this._particleList=new mc,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new $b.EventDispatcher,this._dataPropertyChangeDispatcher=new $b.EventDispatcher,this._groupLists={},this.selection=new mc,this instanceof $b.AlarmBox||(this._selectionModel=new $b.SelectionModel(this),this._alarmBox=new $b.AlarmBox(this),this._alarmStatePropagator=new $b.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},$b.extend($b.DataBox,$b.PropertyChangeDispatcher,{constructor:$b.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(a,b){if(a){1===arguments.length&&(b=-1);var c=a.getId();if(this._dataMap.hasOwnProperty(c)){if(this._dataMap[c]!==a)throw"Data with ID '"+c+"' already exists"}else this._dataMap[c]=a,this._dataList.add(a),a.getParent()||(this._rootMap[c]=a,b>=0?this._rootList.add(a,b):this._rootList.add(a)),a instanceof $b.Billboard?this._billboardList.add(a):a instanceof $b.LensFlare?this._flareList.add(a):a instanceof $b.Node?this._nodeList.add(a):a instanceof $b.Particle?this._particleList.add(a):a instanceof $b.Annotation?this._annotationList.add(a):a instanceof $b.Light&&this._lightList.add(a),this._dataBoxChangeDispatcher.fire({kind:"add",data:a,source:this}),a.getGroupId()&&this.groupElements(a,null,a.getGroupId()),a.addPropertyChangeListener(this.handleDataPropertyChange,this),a._selected=!1}},onPropertyChange:function(){},firePropertyChange:function(){},addByDescendant:function(a,b){b&&0==b(a)||a&&(this.add(a),a.getChildren().size()>0&&a.getChildren().forEach(function(a){this.addByDescendant(a,b)},this))},getAlarmBox:function(){return this._alarmBox},removeById:function(a,b){var c=this.getDataById(a);this.remove(c,b)},remove:function(a,b){if(a&&this._dataMap.hasOwnProperty(a.getId())){a instanceof $b.Link&&(a.setFromNode(null),a.setToNode(null)),a instanceof $b.Node&&a.getLinks()&&a.getLinks().toList().forEach(function(a){this.remove(a)},this),b&&(a.getChildren().forEach(function(b){a.removeChild(b)},this),a.getParent()&&a.getParent().removeChild(a)),this._dataList.remove(a);var c=a._id;delete this._dataMap[c],this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(a)),a instanceof $b.Billboard?this._billboardList.remove(a):a instanceof $b.Node?this._nodeList.remove(a):a instanceof $b.Particle?this._particleList.remove(a):a instanceof $b.Annotation?this._annotationList.remove(a):a instanceof $b.Light?this._lightList.remove(a):a instanceof $b.LensFlare&&this._flareList.remove(a),a.getGroupId()&&this.groupElements(a,a.getGroupId(),null),a.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:a,source:this}),this._selectionModel&&this._selectionModel.removeSelection(a)}},removeByDescendant:function(a,b,c){if(a){var d=this;a.hasChildren()&&a.getChildren().forEachReverse(function(a){d.removeByDescendant(a,b,c)}),c&&0==c(a)||this.remove(a,b)}},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a._id]===a:!1},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(a){if(this._dataList.size()>0){var b=this._dataList.toList(function(b){return!this._lightList.contains(b)||a},this);if(b.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear(),a)this._lightList.clear(),this._flareList.clear();else{
var c=this;this._lightList.forEach(function(a){c._dataList.add(a);var b=a.getId();c._dataMap[b]=a,null==a.getParent()&&(c._rootList.add(a),c._rootMap[b]=a)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:b}),this.clearSelection()}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){var a=this._selectionModel.toSelection();a.forEach(function(a){this.remove(a)},this)},clearSelection:function(){this._selectionModel&&this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(a){a.editing=!1}),this._billboardList.forEach(function(a){a.editing=!1})},getDataById:function(a){return this._dataMap[a]},groupElements:function(a,b,c){var d;b&&(d=this._groupLists[b],d&&(d.remove(a),d.isEmpty()&&delete this._groupLists[b])),c&&(d=this._groupLists[c],null==d&&(d=new mc,this._groupLists[c]=d),d.contains(a)||d.add(a))},synchronizeGroup:function(a,b,c,d){if(!this.isAdjustingGroup){this.isAdjustingGroup=!0;var e=a.getGroupId(),f=new $b.Vec3;if(e){var g=this._groupLists[e];g&&g.size()>1&&g.forEach(function(e){e!==a&&!e.isDescendantOf(a)&&!a.isDescendantOf(e)&&(f.subVectors(c,b),e[$b.setter(d)](e[$b.getter(d)]().clone().add(f)))})}this.isAdjustingGroup=!1}},handleDataPropertyChange:function(a){var b=a.source;if("parent"===a.property){var c=b.getId();b.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(b)):this._rootMap[c]||(this._rootMap[c]=b,this._rootList.add(b))}else if("groupId"===a.property){var d=a.oldValue,e=a.newValue;this.groupElements(b,d,e)}else"position"===a.property||"scale"===a.property||"rotation"===a.property?this.synchronizeGroup(b,a.oldValue,a.newValue,a.property):"selected"===a.property&&(b._selected?this._selectionModel.appendSelection(b):this._selectionModel.removeSelection(b));this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},allocateLights:function(){var a,b,c,d,e,f,g,c;d=e=f=g=0;var h=this._lightList;for(a=0,b=h.size();b>a;a++)c=h.get(a),c.onlyShadow||(c instanceof $b.DirectionalLight&&d++,c instanceof $b.PointLight&&e++,c instanceof $b.SpotLight&&f++);return{directional:d,point:e,spot:f,hemi:g}},allocateShadows:function(){var a,b,c,d=0,e=this._lightList;for(a=0,b=e.size();b>a;a++)c=e.get(a),c.castShadow&&(c instanceof $b.SpotLight&&d++,c instanceof $b.DirectionalLight&&!c.shadowCascade&&d++);return d},allocatePointShadows:function(){var a,b,c,d=0,e=this._lightList;for(a=0,b=e.size();b>a;a++)c=e.get(a),c.castShadow&&c instanceof $b.PointLight&&d++;return d},getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(a){var b=this._limit;this._limit=a,this.firePropertyChange("limit",b,a),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(a){for(0===arguments.length&&(a=1);a>0&&this._dataList.size()>0;){var b=this._dataList.get(0);this.remove(b),a--}},getSiblings:function(a){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var b=a.getParent();return b?b.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getLensFlares:function(){return this._flareList},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(a,b){return this._dataList.toList(a,b)},forEach:function(a,b){this._dataList.forEach(a,b)},forEachReverse:function(a,b){this._dataList.forEachReverse(a,b)},forEachByDepthFirst:function(a,b,c){if(b)this._depthFirst(a,b,c);else for(var d=this._rootList.size(),e=0;d>e;e++){var f=this._rootList.get(e);if(this._depthFirst(a,f,c)===!1)return}},_depthFirst:function(a,b,c){for(var d=b.getChildrenSize(),e=0;d>e;e++){var f=b.getChildAt(e);if(this._depthFirst(a,f,c)===!1)return!1}if(c){if(a.call(c,b)===!1)return!1}else if(a(b)===!1)return!1},forEachByBreadthFirst:function(a,b,c){var d=new mc;for(b?d.add(b):this._rootList.forEach(d.add,d);d.size()>0;)if(b=d.removeAt(0),b.getChildren().forEach(d.add,d),c){if(a.call(c,b)===!1)return}else if(a(b)===!1)return},getAlarmStatePropagator:function(){return this._alarmStatePropagator},setAlarmStatePropagator:function(a){this._alarmStatePropagator!=a&&(this._alarmStatePropagator&&this._alarmStatePropagator.setEnable(!1),this._alarmStatePropagator=a,this._alarmStatePropagator.setEnable(!0))},setClient:function(a,b){if(null==a)return this;null==this._clientMap&&(this._clientMap=new Object);var c=this._clientMap[a];if(c!==b)return null==b?delete this._clientMap[a]:this._clientMap[a]=b,this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b),this},getClient:function(a){return this._clientMap[a]}}),$b.QuickFinder=function(a,b,c,d,e){if(this._map={},!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=$b.getter(b)),this._valueFunction=d||this.getValue,this._filterFunction=e||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},$b.extend($b.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){"add"===a.kind?this._addData(a.data):"remove"===a.kind?this._removeData(a.data):"clear"===a.kind&&(this._map={})},handleDataPropertyChange:function(a){if(this._filterFunction.call(this,a.source)&&("accessor"===this._propertyType&&this._propertyName===a.property||"style"===this._propertyType&&a.source.IStyle&&"S:"+this._propertyName===a.property||"client"===this._propertyType&&"C:"+this._propertyName===a.property)){var b=this._getMap(a.oldValue);b&&b.remove(a.source),this._addData(a.source)}},_getMap:function(a){return a=null==a?this._NULL_:a,this._map[a]},find:function(a){var b=this._getMap(a);return b?b.toList():new mc},findFirst:function(a){var b=this._getMap(a);return!b||b.isEmpty()?null:b.get(0)},_addData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c||(c=new mc,b=null==b?this._NULL_:b,this._map[b]=c),c.add(a)}},_removeData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c&&(c.remove(a),c.isEmpty()&&(b=null==b?this._NULL_:b,delete this._map[b]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return("style"!==this._propertyType||a.IStyle)&&("accessor"!==this._propertyType||this._valueFunction!==this.getValue||a[this._getter])?!0:!1},getValue:function(a){return"accessor"===this._propertyType?a[this._getter]():"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):null}}),$b.SelectionModel=function(a){$b.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new mc,this._selectionChangeDispatcher=new $b.EventDispatcher,this._selectionMap={},this._setDataBox(a)},$b.extend($b.SelectionModel,$b.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(a){if(this._selectionMode!==a&&("noneSelection"===a||"singleSelection"===a||"multipleSelection"===a)){this.clearSelection();var b=this._selectionMode;this._selectionMode=a,this.firePropertyChange("selectionMode",b,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(a){if(!a)throw"dataBox can not be null";if(this._dataBox!==a){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var b=this._dataBox;this._dataBox=a,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",b,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(a){if("remove"===a.kind){var b=a.data;this.contains(b)&&(this._selectionList.remove(b),delete this._selectionMap[b.getId()],this.fireSelectionChange("remove",new mc(b))),b._selected=!1}else"clear"===a.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(a){if(this._filterFunction!==a){this.clearSelection();var b=this._filterFunction;this._filterFunction=a,this.firePropertyChange("filterFunction",b,this._filterFunction)}},fireSelectionChange:function(a,b,c){c&&(this._selectionList.forEach(function(a){c.contains(a)?c.remove(a):c.add(a)}),b=c.toList()),this._selectionChangeDispatcher.fire({kind:a,datas:new mc(b)})},addSelectionChangeListener:function(a,b,c){this._selectionChangeDispatcher.add(a,b,c)},removeSelectionChangeListener:function(a,b){this._selectionChangeDispatcher.remove(a,b)},_filterList:function(a,b){for(var c=new mc(a),d=0;d<c.size();d++){var e=c.get(d);(this._filterFunction&&!this._filterFunction(e)||b&&this.contains(e)||!b&&!this.contains(e)||!this._dataBox.contains(e))&&(c.removeAt(d),d--)}return c},appendSelection:function(a){if("noneSelection"!==this._selectionMode){var b=this._filterList(a,!0);if(!b.isEmpty()){var c=null;"singleSelection"===this._selectionMode&&(c=new mc(this._selectionList),this._selectionList.forEach(function(a){a._selected=!1}),this._selectionList.clear(),this._selectionMap={},b=new mc(b.get(b.size()-1)));for(var d=0;d<b.size();d++){var e=b.get(d);e._selected=!0,this._selectionList.add(e),this._selectionMap[e._id]=e}this.fireSelectionChange("append",b,c)}}},removeSelection:function(a){var b=this._filterList(a);if(0!==b.size()){for(var c=0;c<b.size();c++){var d=b.get(c);d._selected=!1,this._selectionList.remove(d),delete this._selectionMap[d.getId()]}this.fireSelectionChange("remove",b)}},toSelection:function(a,b){return this._selectionList.toList(a,b)},getSelection:function(){return this._selectionList},setSelection:function(a){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=a)){var b=new mc(this._selectionList);this._selectionList.clear(),this._selectionMap={};var c=this._filterList(a,!0);"singleSelection"===this._selectionMode&&c.size()>1&&(c=new mc(c.get(c.size()-1)));for(var d=0;d<c.size();d++){var e=c.get(d);e._selected=!0,this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("set",null,b)}},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.forEach(function(a){a._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var a=this._dataBox.toDatas(),b=0,c=null;if(this._filterFunction)for(b=0;b<a.size();b++)c=a.get(b),this._filterFunction(c)||(a.removeAt(b),b--);var d=new mc(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&a.size()>1&&(a=new mc(a.get(a.size()-1))),b=0;b<a.size();b++)c=a.get(b),this._selectionList.add(c),this._selectionMap[c.getId()]=c;this.fireSelectionChange("all",null,d)}},size:function(){return this._selectionList.size()},contains:function(a){return a?null!=this._selectionMap[a._id]:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?"noneSelection"===this._selectionMode?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),$b.AlarmSeverity=function(a,b,c,d,e){this.value=a,this.name=b,this.nickName=c,this.color=d,this.displayName=e},$b.extend($b.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=$b.AlarmSeverity;a.severities=new mc,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:0>c?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?0===a.value:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),$b.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},$b.extend($b.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var a=null;for(var b in this._am)b=$b.AlarmSeverity.getByName(b),$b.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getAcknowledgedAlarmCount(b)&&(a=a&&$b.AlarmSeverity.compare(a,b)>0?a:b);this._haa=a},_c2:function(){var a=null;for(var b in this._nm)b=$b.AlarmSeverity.getByName(b),$b.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getNewAlarmCount(b)&&(a=a&&$b.AlarmSeverity.compare(a,b)>0?a:b);this._hna=a},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var a in this._nm)if(a=$b.AlarmSeverity.getByName(a),!$b.AlarmSeverity.isClearedAlarmSeverity(a)&&0!==this.getNewAlarmCount(a)&&$b.AlarmSeverity.compare(this._hna,a)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var a=this._haa,b=this._hna,c=this._ps;this._hoa=a,$b.AlarmSeverity.compare(b,this._hoa)>0&&(this._hoa=b),$b.AlarmSeverity.compare(c,this._hoa)>0&&(this._hoa=c)},_c5:function(){var a=this._haa,b=this._hna;this._hta=a,$b.AlarmSeverity.compare(b,this._hta)>0&&(this._hta=b)},increaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];null==c&&(c=0),c+=b,this._am[a.name]=c,this._f(),this._e.onAlarmChange()}},increaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];null==c&&(c=0),c+=b,this._nm[a.name]=c,this._f(),this._e.onAlarmChange()}},decreaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._am[a.name]=c,this._f(),this._e.onAlarmChange()}},decreaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._nm[a.name]=c,this._f(),this._e.onAlarmChange()}},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(a){if(a){var b=this.getNewAlarmCount(a);this.decreaseNewAlarm(a,b),this.increaseAcknowledgedAlarm(a,b)}else for(var c in this._nm)this.acknowledgeAllAlarms($b.AlarmSeverity.getByName(c))},_c6:function(){this._aac=0;for(var a in this._am)a=$b.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(a){if(a){var b=this._am[a.name];return null==b?0:b}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm)a=$b.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)},getNewAlarmCount:function(a){if(a){var b=this._nm[a.name];return null==b?0:b}return this._nac},setNewAlarmCount:function(a,b){this._nm[a.name]=b,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,b){this._am[a.name]=b,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){if(this._ep||(a=null),this._ps!==a){var b=this._ps;this._ps=a,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",b,a)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(a){var b=this._ep;this._ep=a,this._e.firePropertyChange("enablePropagation",b,a)&&(a||this.setPropagateSeverity(null))}}),$b.Alarm=function(a,b,c,d,e){$b.Data.call(this,a),this._id=null!=a?a:$b.id("A"),this._elementId=b,this._alarmSeverity=c,this._acked=d||!1,this._cleared=e||!1},$b.extend($b.Alarm,$b.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),$b.AlarmBox=function(a){if(!a)throw"elementBox can not be null.";$b.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new $b.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},$b.extend($b.AlarmBox,$b.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(a){var b=this._removeAlarmWhenAlarmIsCleared;if(this._removeAlarmWhenAlarmIsCleared=a,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",b,a),a)for(var c in this.datas){var d=this.datas[c];d.isCleard()&&this.remove(d)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(a){if(!a)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==a){var b=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=a,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",b,a)}},handleElementBoxChange:function(a){"add"===a.kind?this.handleElementAdded(a.data):"remove"===a.kind?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):"clear"===a.kind&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){"add"===a.kind?this._increaseAlarmState(a.data):"remove"===a.kind?this._decreaseAlarmState(a.data):"clear"===a.kind&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(a){var b=a.source;b.isCleared()||("alarmSeverity"===a.property?this.handleAlarmSeverityChange(b,a):"acked"===a.property&&this.handleAckedChange(b,a)),"cleared"===a.property&&(b.isCleared()?(this._decreaseAlarmState(b,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(b)):this._increaseAlarmState(b,!0))},handleAckedChange:function(a,b){if(a.getAlarmSeverity()){var c=this.getCorrespondingElements(a);if(c)for(var d=0;d<c.size();d++){var e=c.get(d);b.oldValue?e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()),b.newValue?e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity())}}},handleAlarmSeverityChange:function(a,b){var c=b.oldValue,d=b.newValue,e=this.getCorrespondingElements(a);if(e)for(var f=0;f<e.size();f++){var g=e.get(f);c&&(a.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(c):g.getAlarmState().decreaseNewAlarm(c)),d&&(a.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(a){var b=this.getCorrespondingAlarms(a);if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(!d.isCleared()){var e=d.getAlarmSeverity();e&&(d.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(e):a.getAlarmState().increaseNewAlarm(e))}}},_increaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().increaseAcknowledgedAlarm(c):f.getAlarmState().increaseNewAlarm(c)}}}},_decreaseAlarmState:function(a,b){if(a.isCleared||console.log(),!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().decreaseAcknowledgedAlarm(c):f.getAlarmState().decreaseNewAlarm(c)}}}},handleElementRemoved:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(function(b){!b.isCleared()&&b.getAlarmSeverity()&&(b.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity()))})},removeAlarmsByElement:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(this.remove,this)},add:function(a,b){if(!a.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&a.isCleared()||$b.AlarmBox.superClass.add.apply(this,arguments)}}),$b.AlarmElementMapping=function(a,b){if(!b)throw"ElementBox can not be null";if(!a)throw"AlarmBox can not be null";this._elementBox=b,this._alarmBox=a,this._alarmsFinder=new $b.QuickFinder(a,"elementId")},$b.extend($b.AlarmElementMapping,Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(a){var b=this._elementBox.getDataById(a.getElementId());return new mc(b)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),$b.PropertyPropagator=function(a,b,c){if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=$b.getter(b),this._setter=$b.setter(b)),this._enable=!1,this._isPropagating=!1},$b.extend($b.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){if(this._enable!==a)if(this._enable=a,this._enable){this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this);for(var b in this._dataBox.datas)this.propagate(this._dataBox.datas[b])}else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(a){if(this.isInterestedProperty(a))this.propagate(a.source);else if("parent"===a.property){var b=a.oldValue;b&&this.propagate(b),this.propagate(a.source)}},isInterestedProperty:function(a){return"accessor"===this._propertyType&&this._propertyName===a.property?!0:"style"===this._propertyType&&a.IElement&&"S:"+this._propertyName===a.property?!0:"client"===this._propertyType&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){a&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1)},propagateToTop:function(a){for(this.propagateToParent(null,a);a&&a.getParent();)this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(a,b){}}),$b.AlarmStatePropagator=function(a){$b.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},$b.extend($b.AlarmStatePropagator,$b.PropertyPropagator,{handleDataPropertyChange:function(a){"enablePropagation"===a.property?this.propagate(a.source):$b.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(a,b){var c=null;b.getChildren().forEach(function(a){var b=a.getAlarmState().getHighestOverallAlarmSeverity();$b.AlarmSeverity.compare(b,c)>0&&(c=b)}),b.getAlarmState&&b.getAlarmState().setPropagateSeverity(c)}});var tc={KEEP_DEFAULT_FUNCTION:function(a){return a.target.keepDefault||a.target.getAttribute("keepDefault")?!0:a.target.parentNode&&(a.target.parentNode.keepDefault||a.target.parentNode.getAttribute("keepDefault"))?!0:a.shiftKey?!0:!1}};tc.paintSortFunction=function(a,b){return a.z!==b.z?a.z-b.z:0},tc.doubleClickToLookAtFunction=function(a){return!0},tc.needSmoothNormalFunction=function(a){var b=a instanceof sc||a instanceof $b.TextNode||a instanceof $b.PathCube||a instanceof $b.ShapeNode||a instanceof $b.ComboNode||"TGL.Entity"==a.getClassName();return!b},tc.PATH_LINK_COMPUTE_DELAY=!1,$b.Defaults=tc,$b.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),
map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX){","vUv.x = uv.x * offsetRepeat.z * (-1.0) + offsetRepeat.x + offsetRepeat.z;","vUv.y = uv.y * offsetRepeat.w  + offsetRepeat.y;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","oUv = uv;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform sampler2D pShadowMap[MAX_POINT_SHADOWS];","uniform vec2 pShadowMapSize[ MAX_POINT_SHADOWS ];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform float pShadowRadius [MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","uniform float shadowCameraNear;","uniform float shadowCameraFar;","varying vec4 pWorldPosition;","vec2 cubeToUV( vec3 v, float texelSizeY ) {","	vec3 absV = abs( v );","	float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );","	absV *= scaleToCube;","	v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );","	vec2 planar = v.xy;","	float almostATexel = 1.5 * texelSizeY;","	float almostOne = 1.0 - almostATexel;","	if ( absV.z >= almostOne ) {","		if ( v.z > 0.0 )","			planar.x = 4.0 - v.x;","		} else if ( absV.x >= almostOne ) {","		 	float signX = sign( v.x );","			planar.x = v.z * signX + 2.0 * signX;","		} else if ( absV.y >= almostOne ) {","			float signY = sign( v.y );","			planar.x = v.x + 2.0 * signY + 2.0;","			planar.y = v.z * signY - 2.0;","		}","	return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );","}","float texture2DCompare( sampler2D depths, vec2 uv, float compare ){","	return step( compare, unpack( texture2D( depths, uv ) ) );","}","float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec3 lightToPosition, float shadowCameraNear, float shadowCameraFar ) {","	vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );","	float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );","	dp += shadowBias;","	vec3 bd3D = normalize( lightToPosition );","	#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )","	vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;","	return (","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +","	texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )","	) * ( 1.0 / 9.0 );","#else","	return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );","#endif","}","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) ;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP"," ","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightToPosition = pWorldPosition.xyz - pPosition[i];","vec2 shadowMapSize = pShadowMapSize[i];","float shadow = getPointShadow(pShadowMap[i],shadowMapSize,0.0015,pShadowRadius[i],lightToPosition,shadowCameraNear,shadowCameraFar);","float darkness = 1.0 - pShadowDarkness[i];","gl_FragColor.xyz *= (darkness + (1.0 - darkness) * shadow);","}","#endif"].join("\n"),
shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},$b.UniformsUtils={merge:function(a){var b,c,d,e={};for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d)e[c]=d[c]}return e},clone:function(a){var b,c,d,e={};for(b in a){e[b]={};for(c in a[b])d=a[b][c],d instanceof $b.Color||d instanceof $b.Vec2||d instanceof $b.Vec3||d instanceof $b.Vec4||d instanceof $b.Mat4||d instanceof $b.Texture?e[b][c]=d.clone():d instanceof Array?e[b][c]=d.slice():e[b][c]=d}return e}},$b.UniformsLib={outline:{diffuse:{type:"c",value:new $b.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new $b.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new _b(1,0)},texelSize:{type:"v2",value:new _b(1/512,1/512)}},common:{diffuse:{type:"c",value:new $b.Color(15658734)},wireframeLinecolor:{type:"c",value:new $b.Color(0)},wireframeLineopacity:{type:"f",value:1},opacity:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new $b.Vec4(0,0,1,1)},flipX:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new $b.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new $b.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new $b.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new $b.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pShadowRadius:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]},shadowCameraNear:{type:"f",value:.1},shadowCameraFar:{type:"f",value:1e4}},gradientramp:{skyColor:{type:"c",value:new $b.Color(16777215)},horizonColor:{type:"c",value:new $b.Color(16777215)},earthColor:{type:"c",value:new $b.Color(16777215)},skyY:{type:"f",value:0},horizonY:{type:"f",value:0},earthY:{type:"f",value:0}}},$b.ShaderLib={outline:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normalize(position)  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},linex:{uniforms:{near:{type:"f",value:.1},opacity:{type:"f",value:1},viewport:{type:"v4",value:new $b.Vec4(0)},lineColor:{type:"c",value:new $b.Color(16777215)},modelViewProjectionMatrix:{type:"m4",value:new cc},useVertexColor:{type:"i",value:0},totalSize:{type:"f",value:0},dashSize:{type:"f",value:0}},vertexShader:["attribute vec3 positionPrev;","attribute vec3 positionNext;","attribute float offset;","attribute float lineDistances;","varying  vec3 vColor;","varying float vLineDistance;","uniform mat4 modelViewProjectionMatrix;","uniform vec4 viewport;","uniform float near;","vec4 clipNear(vec4 p1,vec4 p2){","	float n = (p1.w - near) / (p1.w - p2.w);","	return vec4(mix(p1.xy,p2.xy,n),-near,near);","}","void main(){"," 	vLineDistance = lineDistances;","	vec4 prevProj = modelViewProjectionMatrix * vec4(positionPrev, 1.0);","	vec4 currProj = modelViewProjectionMatrix * vec4(position, 1.0);","	vec4 nextProj = modelViewProjectionMatrix * vec4(positionNext, 1.0);","	if (currProj.w < 0.0) {","		if (prevProj.w < 0.0) {","	 		currProj = clipNear(currProj, nextProj);","		}else {","			currProj = clipNear(currProj, prevProj);","		}","	}","	vec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;","	vec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;","	vec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;","	vec2 dir;","	float len = offset;","	if(position == positionPrev){","		dir = normalize(nextScreen - currScreen);","	}else if(position == positionNext){","		dir = normalize(currScreen - prevScreen);","	}else {","		vec2 dirA = normalize(currScreen - prevScreen);","		vec2 dirB = normalize(nextScreen - currScreen);","		vec2 tanget = normalize(dirA + dirB);","		float miter = 1.0 / max(dot(tanget,dirA),0.5);","		len *= miter;","		dir = tanget;","	}","	dir = vec2(-dir.y,dir.x) * len;","	currScreen += dir;","	currProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);","	gl_Position = currProj;","	vColor = color;","}"].join("\n"),fragmentShader:["uniform vec3 lineColor;","uniform float opacity;","uniform int useVertexColor;","uniform float totalSize;","uniform float dashSize;","varying  vec3 vColor;","varying float vLineDistance;","void main (){","	if(totalSize > dashSize && dashSize > 0.0){","	     if ( mod( vLineDistance, totalSize ) > (totalSize - dashSize) ) {","			discard;","		}","	}","	if(useVertexColor == 0){","		gl_FragColor = vec4(lineColor,opacity);","	}else{","		gl_FragColor = vec4(vColor,opacity);","	}","}"].join("\n")},lensflare:{uniforms:{renderType:{type:"i",value:2},screenPosition:{type:"v3",value:new $b.Vec3(0)},scale:{type:"v2",value:new $b.Vec2(0)},rotation:{type:"f",value:0},occlusionMap:{type:"t",value:null},map:{type:"t",value:null}},vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},deferred:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.common,$b.UniformsLib.gradient,$b.UniformsLib.fog,$b.UniformsLib.gradientramp]),vertexShader:[$b.ShaderChunk.map_pars_vertex,$b.ShaderChunk.lightmap_pars_vertex,$b.ShaderChunk.envmap_pars_vertex,$b.ShaderChunk.color_pars_vertex,$b.ShaderChunk.morphtarget_pars_vertex,$b.ShaderChunk.skinning_pars_vertex,$b.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",$b.ShaderChunk.map_vertex,$b.ShaderChunk.lightmap_vertex,$b.ShaderChunk.color_vertex,$b.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",$b.ShaderChunk.morphnormal_vertex,$b.ShaderChunk.skinnormal_vertex,$b.ShaderChunk.defaultnormal_vertex,"#endif",$b.ShaderChunk.morphtarget_vertex,$b.ShaderChunk.skinning_vertex,$b.ShaderChunk.default_vertex,$b.ShaderChunk.worldpos_vertex,$b.ShaderChunk.envmap_vertex,$b.ShaderChunk.shadowmap_vertex,"vPosition = position;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",$b.ShaderChunk.color_pars_fragment,$b.ShaderChunk.map_pars_fragment,$b.ShaderChunk.gradient_parts_fragment,$b.ShaderChunk.lightmap_pars_fragment,$b.ShaderChunk.envmap_pars_fragment,$b.ShaderChunk.fog_pars_fragment,$b.ShaderChunk.specularmap_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );","}","else{","gl_FragColor = vec4( diffuse, opacity );","}",$b.ShaderChunk.gradient_basic_fragment,$b.ShaderChunk.map_fragment,$b.ShaderChunk.alphatest_fragment,$b.ShaderChunk.lightmap_fragment,"if(skyY <= earthY){",$b.ShaderChunk.color_fragment,"}",$b.ShaderChunk.envmap_fragment,$b.ShaderChunk.linear_to_gamma_fragment,$b.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},lambert:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.common,$b.UniformsLib.fog,$b.UniformsLib.lights,$b.UniformsLib.shadowmap,{ambient:{type:"c",value:new $b.Color(16777215)},emissive:{type:"c",value:new $b.Color(0)},wrapRGB:{type:"v3",value:new $b.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",$b.ShaderChunk.map_pars_vertex,$b.ShaderChunk.lightmap_pars_vertex,$b.ShaderChunk.envmap_pars_vertex,$b.ShaderChunk.lights_lambert_pars_vertex,$b.ShaderChunk.color_pars_vertex,$b.ShaderChunk.morphtarget_pars_vertex,$b.ShaderChunk.skinning_pars_vertex,$b.ShaderChunk.shadowmap_pars_vertex,"void main() {",$b.ShaderChunk.map_vertex,$b.ShaderChunk.lightmap_vertex,$b.ShaderChunk.color_vertex,$b.ShaderChunk.morphnormal_vertex,$b.ShaderChunk.skinbase_vertex,$b.ShaderChunk.skinnormal_vertex,$b.ShaderChunk.defaultnormal_vertex,$b.ShaderChunk.morphtarget_vertex,$b.ShaderChunk.skinning_vertex,$b.ShaderChunk.default_vertex,$b.ShaderChunk.worldpos_vertex,$b.ShaderChunk.envmap_vertex,$b.ShaderChunk.lights_lambert_vertex,$b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",$b.ShaderChunk.color_pars_fragment,$b.ShaderChunk.map_pars_fragment,$b.ShaderChunk.lightmap_pars_fragment,$b.ShaderChunk.envmap_pars_fragment,$b.ShaderChunk.fog_pars_fragment,$b.ShaderChunk.shadowmap_pars_fragment,$b.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",$b.ShaderChunk.map_fragment,$b.ShaderChunk.alphatest_fragment,$b.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",$b.ShaderChunk.lightmap_fragment,$b.ShaderChunk.color_fragment,$b.ShaderChunk.envmap_fragment,$b.ShaderChunk.shadowmap_fragment,$b.ShaderChunk.linear_to_gamma_fragment,$b.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.common,$b.UniformsLib.gradient,$b.UniformsLib.bump,$b.UniformsLib.normalmap,$b.UniformsLib.fog,$b.UniformsLib.lights,$b.UniformsLib.shadowmap,$b.UniformsLib.gradientramp,{ambient:{type:"c",value:new $b.Color(16777215)},emissive:{type:"c",value:new $b.Color(0)},specular:{type:"c",value:new $b.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new $b.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",$b.ShaderChunk.map_pars_vertex,$b.ShaderChunk.lightmap_pars_vertex,$b.ShaderChunk.envmap_pars_vertex,$b.ShaderChunk.lights_phong_pars_vertex,$b.ShaderChunk.color_pars_vertex,$b.ShaderChunk.morphtarget_pars_vertex,$b.ShaderChunk.skinning_pars_vertex,$b.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",$b.ShaderChunk.map_vertex,$b.ShaderChunk.lightmap_vertex,$b.ShaderChunk.color_vertex,$b.ShaderChunk.morphnormal_vertex,$b.ShaderChunk.skinbase_vertex,$b.ShaderChunk.skinnormal_vertex,$b.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",$b.ShaderChunk.morphtarget_vertex,$b.ShaderChunk.skinning_vertex,$b.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",$b.ShaderChunk.worldpos_vertex,$b.ShaderChunk.envmap_vertex,$b.ShaderChunk.lights_phong_vertex,$b.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","vPosition = position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",$b.ShaderChunk.color_pars_fragment,$b.ShaderChunk.gradient_parts_fragment,$b.ShaderChunk.map_pars_fragment,$b.ShaderChunk.lightmap_pars_fragment,$b.ShaderChunk.envmap_pars_fragment,$b.ShaderChunk.fog_pars_fragment,$b.ShaderChunk.lights_phong_pars_fragment,$b.ShaderChunk.shadowmap_pars_fragment,$b.ShaderChunk.bumpmap_pars_fragment,$b.ShaderChunk.normalmap_pars_fragment,$b.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), opacity );","}","else{","gl_FragColor = vec4(  vec3 ( 1.0 ), opacity );","}","vec3 tempDiffuse = diffuse;",$b.ShaderChunk.gradient_phong_fragment,$b.ShaderChunk.map_fragment,$b.ShaderChunk.alphatest_fragment,$b.ShaderChunk.specularmap_fragment,$b.ShaderChunk.lights_phong_fragment,$b.ShaderChunk.lightmap_fragment,$b.ShaderChunk.color_fragment,$b.ShaderChunk.envmap_fragment,$b.ShaderChunk.shadowmap_fragment,$b.ShaderChunk.linear_to_gamma_fragment,$b.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},particle_basic:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.particle,$b.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",$b.ShaderChunk.color_pars_vertex,$b.ShaderChunk.shadowmap_pars_vertex,"void main() {",$b.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","float s = normal.x;","if(s == 0.0){","   s = 1.0;","}","gl_PointSize = size * s;","#endif","gl_Position = projectionMatrix * mvPosition;",$b.ShaderChunk.worldpos_vertex,$b.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",$b.ShaderChunk.color_pars_fragment,$b.ShaderChunk.map_particle_pars_fragment,$b.ShaderChunk.fog_pars_fragment,$b.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",$b.ShaderChunk.map_particle_fragment,$b.ShaderChunk.alphatest_fragment,$b.ShaderChunk.color_fragment,$b.ShaderChunk.shadowmap_fragment,$b.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.common,$b.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}},$b.UniformsLib.gradientramp]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;","varying vec3 vPosition;",$b.ShaderChunk.color_pars_vertex,"void main() {",$b.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vPosition = position;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",$b.ShaderChunk.color_pars_fragment,$b.ShaderChunk.fog_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );",$b.ShaderChunk.fog_fragment,"}","else{","gl_FragColor = vec4( diffuse, opacity );",$b.ShaderChunk.color_fragment,$b.ShaderChunk.fog_fragment,"}","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.fog,$b.UniformsLib.lights,$b.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new $b.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new $b.Color(16777215)},uSpecularColor:{type:"c",value:new $b.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new $b.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new $b.Vec2(0,0)},uRepeat:{type:"v2",value:new $b.Vec2(1,1)},wrapRGB:{type:"v3",value:new $b.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",$b.ShaderChunk.shadowmap_pars_fragment,$b.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",$b.ShaderChunk.shadowmap_fragment,$b.ShaderChunk.linear_to_gamma_fragment,$b.ShaderChunk.fog_fragment,"}"].join("\n"),
vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",$b.ShaderChunk.skinning_pars_vertex,$b.ShaderChunk.shadowmap_pars_vertex,"void main() {",$b.ShaderChunk.skinbase_vertex,$b.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0},nearDistance:{type:"f",value:10},farDistance:{type:"f",value:1e4},referencePosition:{type:"v3",value:new mono.Vec3}},vertexShader:[$b.ShaderChunk.morphtarget_pars_vertex,$b.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",$b.ShaderChunk.skinbase_vertex,$b.ShaderChunk.morphtarget_vertex,$b.ShaderChunk.skinning_vertex,$b.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int isCube;","uniform float nearDistance;","uniform float farDistance;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){"," 	float dist = length( vPosition1.xyz/vPosition1.w);","		dist = ( dist - nearDistance ) / ( farDistance - nearDistance );","		gl_FragData[ 0 ] = pack(dist);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}},$b.ShaderTerrain={terrain:{uniforms:$b.UniformsUtils.merge([$b.UniformsLib.fog,$b.UniformsLib.lights,$b.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new $b.Color(15658734)},uSpecularColor:{type:"c",value:new $b.Color(1118481)},uAmbientColor:{type:"c",value:new $b.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new $b.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new $b.Vec2(1,1)},uOffset:{type:"v2",value:new $b.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",$b.ShaderChunk.shadowmap_pars_fragment,$b.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",$b.ShaderChunk.shadowmap_fragment,$b.ShaderChunk.linear_to_gamma_fragment,$b.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",$b.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",$b.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},$b.ShaderLib.terrain=$b.ShaderTerrain.terrain,$b.Fog=function(a,b,c){this.name="",this.color=new $b.Color(a),this.near=b!==e?b:1,this.far=c!==e?c:1e3},$b.Fog.prototype={constructor:$b.Fog,clone:function(){return new $b.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(a){a.fogNear.value=this.near,a.fogFar.value=this.far,a.fogColor.value=this.color}},$b.FogExp2=function(a,b){this.name="",this.color=new $b.Color(a),this.density=b!==e?b:1},$b.FogExp2.prototype={DensityFactor:25e-5,constructor:$b.FogExp2,clone:function(){return new $b.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(a){a.fogDensity.value=this.density*this.DensityFactor,a.fogColor.value=this.color}};var uc={},vc=uc.RADIANS_TO_DEGREES=180/Math.PI,wc=uc.DEGREES_TO_RADIANS=Math.PI/180;uc.isPowerOfTwo=function(a){return 0===(a&a-1)},uc.clone=function(a,b){b==e&&(b=new a.prototype.constructor);for(var c in a)if("id"!==c){var d=a[c];if(d.copy&&"function"==typeof d.copy)b[c].copy(d);else if(d instanceof Array){var f=d,g=b[c];null==g&&(g=[]);for(var h=0;h<f.length;h++){var i=f[h];g.push(i.clone())}}else cloneObjet[c]=d}},uc.paramToGL=function(a,b){if(!b)return void console.error("No webgl context");switch(a){case $b.RepeatWrapping:return b.REPEAT;case $b.ClampToEdgeWrapping:return b.CLAMP_TO_EDGE;case $b.MirroredRepeatWrapping:return b.MIRRORED_REPEAT;case $b.NearestFilter:return b.NEAREST;case $b.NearestMipMapNearestFilter:return b.NEAREST_MIPMAP_NEAREST;case $b.NearestMipMapLinearFilter:return b.NEAREST_MIPMAP_LINEAR;case $b.LinearFilter:return b.LINEAR;case $b.LinearMipMapNearestFilter:return b.LINEAR_MIPMAP_NEAREST;case $b.LinearMipMapLinearFilter:return b.LINEAR_MIPMAP_LINEAR;case $b.ByteType:return b.BYTE;case $b.UnsignedByteType:return b.UNSIGNED_BYTE;case $b.ShortType:return b.SHORT;case $b.UnsignedShortType:return b.UNSIGNED_SHORT;case $b.IntType:return b.INT;case $b.UnsignedIntType:return b.UNSIGNED_INT;case $b.FloatType:return b.FLOAT;case $b.AlphaFormat:return b.ALPHA;case $b.RGBFormat:return b.RGB;case $b.RGBAFormat:return b.RGBA;case $b.LuminanceFormat:return b.LUMINANCE;case $b.LuminanceAlphaFormat:return b.LUMINANCE_ALPHA;case $b.AddEquation:return b.FUNC_ADD;case $b.SubtractEquation:return b.FUNC_SUBTRACT;case $b.ReverseSubtractEquation:return b.FUNC_REVERSE_SUBTRACT;case $b.ZeroFactor:return b.ZERO;case $b.OneFactor:return b.ONE;case $b.SrcColorFactor:return b.SRC_COLOR;case $b.OneMinusSrcColorFactor:return b.ONE_MINUS_SRC_COLOR;case $b.SrcAlphaFactor:return b.SRC_ALPHA;case $b.OneMinusSrcAlphaFactor:return b.ONE_MINUS_SRC_ALPHA;case $b.DstAlphaFactor:return b.DST_ALPHA;case $b.OneMinusDstAlphaFactor:return b.ONE_MINUS_DST_ALPHA;case $b.DstColorFactor:return b.DST_COLOR;case $b.OneMinusDstColorFactor:return b.ONE_MINUS_DST_COLOR;case $b.SrcAlphaSaturateFactor:return b.SRC_ALPHA_SATURATE}return 0},uc.createElement=function(a,b,c,d){var f,g,h,i,j=a.vertices.length,k=(a.uvs.length,a.vertices),l=b.vertices,m=a.faces,n=b.faces,o=a.uvs,p=b.uvs,q=[],r=[],s=[];d===e&&(d=0),a instanceof $b.Element&&(a.matrixAutoUpdate&&a.updateMatrix(),f=a.matrix,g=(new bc).getNormalMatrix(f)),b instanceof $b.Element&&(b.matrixAutoUpdate&&b.updateMatrix(),h=b.matrix,i=(new bc).getNormalMatrix(h));for(var t=0,u=k.length;u>t;t++){var v=k[t],w=v.clone();f&&w.applyMatrix4(f),r.push(w)}for(var t=0,u=l.length;u>t;t++){var v=l[t],w=v.clone();h&&w.applyMatrix4(h),r.push(w)}for(t=0,u=m.length;u>t;t++){var x,y,z,A=m[t],B=A.vertexNormals,C=A.vertexColors;x=A instanceof qc?new qc(A.a,A.b,A.c):new rc(A.a,A.b,A.c,A.d),x.normal.copy(A.normal),g&&x.normal.applyMatrix3(g).normalize();for(var D=0,E=B.length;E>D;D++)y=B[D].clone(),g&&y.applyMatrix3(g).normalize(),x.vertexNormals.push(y);x.color.copy(A.color);for(var D=0,E=C.length;E>D;D++)z=C[D],x.vertexColors.push(z.clone());x.materialIndex=A.materialIndex,x.centroid.copy(A.centroid),f&&x.centroid.applyMatrix4(f),q.push(x)}for(t=0,u=n.length;u>t;t++){var x,y,z,A=n[t],B=A.vertexNormals,C=A.vertexColors;x=A instanceof qc?new qc(A.a+j,A.b+j,A.c+j):new rc(A.a+j,A.b+j,A.c+j,A.d+j),x.normal.copy(A.normal),i&&x.normal.applyMatrix3(i).normalize();for(var D=0,E=B.length;E>D;D++)y=B[D].clone(),i&&y.applyMatrix3(i).normalize(),x.vertexNormals.push(y);x.color.copy(A.color);for(var D=0,E=C.length;E>D;D++)z=C[D],x.vertexColors.push(z.clone());x.materialIndex=A.materialIndex+d,x.centroid.copy(A.centroid),h&&x.centroid.applyMatrix4(h),q.push(x)}for(t=0,u=o.length;u>t;t++){for(var F=o[t],G=[],D=0,E=F.length;E>D;D++)G.push(new _b(F[D].x,F[D].y));s.push(G)}for(t=0,u=p.length;u>t;t++){for(var F=p[t],G=[],D=0,E=F.length;E>D;D++)G.push(new _b(F[D].x,F[D].y));s.push(G)}var H=new $b.Entity;return H.vertices=r,H.faces=q,H.uvs=s,H.material=c===e?a.material:c,H},uc.transformElement=function(a,b){var c,d,e=a.vertices,f=a.faces,g=a.uvs,h=[],i=[],j=[];a instanceof $b.Element&&(a.matrixAutoUpdate&&a.updateMatrix(),c=a.matrix,d=(new bc).getNormalMatrix(c));for(var k=0,l=e.length;l>k;k++){var m=e[k],n=m.clone();c&&n.applyMatrix4(c),i.push(n)}for(k=0,l=f.length;l>k;k++){var o,p,q,r=f[k],s=r.vertexNormals,t=r.vertexColors;o=r instanceof qc?new qc(r.a,r.b,r.c):new rc(r.a,r.b,r.c,r.d),o.normal.copy(r.normal),d&&o.normal.applyMatrix3(d).normalize();for(var u=0,v=s.length;v>u;u++)p=s[u].clone(),d&&p.applyMatrix3(d).normalize(),o.vertexNormals.push(p);o.color.copy(r.color);for(var u=0,v=t.length;v>u;u++)q=t[u],o.vertexColors.push(q.clone());o.materialIndex=r.materialIndex,o.centroid.copy(r.centroid),c&&o.centroid.applyMatrix4(c),h.push(o)}for(k=0,l=g.length;l>k;k++){for(var w=g[k],x=[],u=0,v=w.length;v>u;u++)x.push(new _b(w[u].x,w[u].y));j.push(x)}if(b){var y=new $b.Entity(a.material);y.vertices=i,y.faces=h,y.uvs=j,y.setPosition(0,0,0),y.setRotation(0,0,0),y.setScale(1,1,1);var z={};return z.vertices=i,z.faces=h,z.uvs=j,y.primitive=new $b.Primitive(z),y}a.vertices=i,a.faces=h,a.uvs=j,a.setPosition(0,0,0),a.setRotation(0,0,0),a.setScale(1,1,1);var z={};z.vertices=i,z.faces=h,z.uvs=j,a.primitive=new $b.Primitive(z);for(var k in c.elements)a._attachId+=c.elements[k];return a},uc.mergeElements=function(a){var b,c,d,e,f,g,h=0,i=0,j=0;for(b=0;b<a.length;b++)d=a[b],h+=d.materialSize;var k=new $b.Entity(h),l={},m={},n=(new ac(0,0,0),[]),o=[],p=[],q=[],r=new $b.ArrayMaterial;for(b=0;b<a.length;b++){for(d=a[b],d.matrixAutoUpdate&&d.updateWorldMatrix(),e=d.worldMatrix.clone(),f=(new bc).getNormalMatrix(e),c=0;c<d.vertices.length;c++)g=d.vertices[c],n.push(g.clone().applyMatrix4(e));for(c=0;c<d.faces.length;c++){var s,t=d.faces[c];t.vertexNormals,t.vertexColors;s=t instanceof qc?new qc(t.a+i,t.b+i,t.c+i):new rc(t.a+i,t.b+i,t.c+i,t.d+i),s.normal.copy(t.normal),f&&s.normal.applyMatrix3(f).normalize(),s.materialIndex=t.materialIndex+j,s.centroid.copy(t.centroid),e&&s.centroid.applyMatrix4(e),o.push(s)}for(c=0,len=d.uvs.length;c<len;c++){for(var u=d.uvs[c],v=[],w=0,x=u.length;x>w;w++)v.push(new _b(u[w].x,u[w].y));p.push(v)}if(d.uv2s&&d.uv2s.length>0)for(c=0,len=d.uv2s.length;c<len;c++){for(var y=d.uv2s[c],z=[],w=0,x=y.length;x>w;w++)z.push(new _b(y[w].x,y[w].y));q.push(z)}r.materials=r.materials.concat(d.material.materials),i+=d.vertices.length,j+=d.materialSize;for(var A in d.styleMap){var B=l[A];null==B&&(B=[]);var C=d.styleMap[A],D=!0;if(uc.isArray(C))for(var w=0;w<C.length;w++)B.push(C[b]),w>0&&C[w]!=C[w-1]&&(D=!1);else for(var w=0;w<d.materialSize;w++)B.push(C);(1==m[A]||null==m[A])&&(m[A]=D),l[A]=B}}for(var A in m)1==m[A]&&(l[A]=l[A][0]);return k.styleMap=l,k.material=r,k.vertices=n,k.faces=o,k.setUvs(p),k.uv2s=q,k.setUpdateFlags(!0),k},uc.mergeElement=function(a,b,c){var d,f,g,h,i=a.vertices.length,j=(a.uvs.length,a.vertices),k=b.vertices,l=a.faces,m=b.faces,n=a.uvs,o=b.uvs,p=[],q=[],r=[];c===e&&(c=0),a instanceof $b.Element&&(a.matrixAutoUpdate&&a.updateMatrix(),d=a.matrix,f=(new bc).getNormalMatrix(d)),b instanceof $b.Element&&(b.matrixAutoUpdate&&b.updateMatrix(),g=b.matrix,h=(new bc).getNormalMatrix(g));for(var s=0,t=j.length;t>s;s++){var u=j[s],v=u.clone();d&&v.applyMatrix4(d),q.push(v)}for(var s=0,t=k.length;t>s;s++){var u=k[s],v=u.clone();g&&v.applyMatrix4(g),q.push(v)}for(s=0,t=l.length;t>s;s++){var w,x,y,z=l[s],A=z.vertexNormals,B=z.vertexColors;w=z instanceof qc?new qc(z.a,z.b,z.c):new rc(z.a,z.b,z.c,z.d),w.normal.copy(z.normal),f&&w.normal.applyMatrix3(f).normalize();for(var C=0,D=A.length;D>C;C++)x=A[C].clone(),f&&x.applyMatrix3(f).normalize(),w.vertexNormals.push(x);w.color.copy(z.color);for(var C=0,D=B.length;D>C;C++)y=B[C],w.vertexColors.push(y.clone());w.materialIndex=z.materialIndex,w.centroid.copy(z.centroid),d&&w.centroid.applyMatrix4(d),p.push(w)}for(s=0,t=m.length;t>s;s++){var w,x,y,z=m[s],A=z.vertexNormals,B=z.vertexColors;w=z instanceof qc?new qc(z.a+i,z.b+i,z.c+i):new rc(z.a+i,z.b+i,z.c+i,z.d+i),w.normal.copy(z.normal),h&&w.normal.applyMatrix3(h).normalize();for(var C=0,D=A.length;D>C;C++)x=A[C].clone(),h&&x.applyMatrix3(h).normalize(),w.vertexNormals.push(x);w.color.copy(z.color);for(var C=0,D=B.length;D>C;C++)y=B[C],w.vertexColors.push(y.clone());w.materialIndex=z.materialIndex+c,w.centroid.copy(z.centroid),g&&w.centroid.applyMatrix4(g),p.push(w)}for(s=0,t=n.length;t>s;s++){for(var E=n[s],F=[],C=0,D=E.length;D>C;C++)F.push(new _b(E[C].x,E[C].y));r.push(F)}for(s=0,t=o.length;t>s;s++){for(var E=o[s],F=[],C=0,D=E.length;D>C;C++)F.push(new _b(E[C].x,E[C].y));r.push(F)}return a.vertices=q,a.faces=p,a.uvs=r,a._position.set(0,0,0),a._rotation.set(0,0,0),a._scale.set(1,1,1),a},uc.autoAdjustNetworkBounds=function(a,b,c,e,f,g){f=f||0,g=g||0,a.adjustBounds(b[c]-f,b[e]-g),!a._resizeFunction&&(a._resizeFunction=function(){a.adjustBounds(b[c]-f,b[e]-g,g,f)}),d.addEventListener("resize",a._resizeFunction,!0)},uc.isEmptyObject=function(a){for(var b in a)return!1;return!0},uc.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},uc.isSame=function(a,b){if(a===b)return!0;if(null==a&&null!=b)return!1;if(null!=a&&null==b)return!1;if(typeof a!=typeof b)return!1;for(var c in a)if(a[c]!=b[c])return!1;for(var c in b)if(a[c]!=b[c])return!1;return!0},uc.toString=function(a){if(a){var b="";for(var c in a)b+=c+":"+a[c];return b}},uc.validateLicense=function(a){Cc=a,Sc()},uc.getLicense=function(){return Cc},uc.getObjectCount=function(a){if(!a)return 0;var b=0;for(var c in a)b++;return b},uc.isNaN=function(a){return""===a||null===a||isNaN(a)},uc.getTransformVertices=function(a,b,c){null==c&&(c=[]);var d,e;if(a instanceof $b.Node||a instanceof $b.Billboard){for(d=0;d<a.vertices.length;d++)e=a.vertices[d].clone(),a instanceof $b.Billboard?(e.x*=a.rotation3d.x,e.y*=a.rotation3d.y,e.add(a.getPosition())):e.applyMatrix4(a.worldMatrix),c.push(e);for(var d=0;d<(a._childList?a._childList.size():0);d++){var f=a._childList.get(d);uc.getTransformVertices(f,b,c)}}return c},uc.getBoundingBox=function(a,b){var c,d,e;if(null==a)return null;c=a instanceof mc?a._as:uc.isArray(a)?a:[a];var f=[];for(d=0;d<c.length;d++)e=c[d],uc.getTransformVertices(e,b,f);var g=new $b.BoundingBox;return g.setFromPoints(f),g},uc.mergeWrapMap=function(a){if(a instanceof sc&&!a.getWrapMap()){for(var b,c=[],d=(a.getMaterialMapping(),a.material.materials),e=0;e<d.length;e++)b=d[e],b.map&&-1==c.indexOf(b.map._image)&&c.push(b.map._image);a.setWrapMap(!0)}},uc.setWrapMap=function(a,b,c,d){uc.loadImages(b,function(e){var f=mono.Utils.createWrapMapFromImages(e,c,d);f.__uniqueCode="";for(var g=0;g<b.length;g++)f.__uniqueCode+=b[g].src;for(var g in c)f.__uniqueCode+=g+":"+c[g];if(uc.isArray(a))for(var g=0;g<a.length;g++)a[g].setStyle("m.texture.image",f),a[g].setClient("_originalImage",b),a[g].setClient("_wrapMapping",c);else a.setStyle("m.texture.image",f),a.setClient("_wrapMapping",c)})},uc.loadImages=function(a,b){function c(a){a.onload=function(){a.loaded=!0,d(),a.onload=null}}function d(){for(var c=0;c<a.length;c++)if(!a[c].loaded)return;b(a)}if(null!=a&&0!=a.length&&null!=b)for(var e=0;e<a.length;e++){var f=a[e];"string"==typeof f&&(a[e]=new Image,a[e].crossOrigin="",a[e].src=f),f=a[e],c(f)}},uc.createWrapMapFromImages=function(a,b,c,d,e){if(null==a||0==a.length)return null;c=(c||"six-each").toLowerCase();var f="six-each"==c||"front-other"==c||"back-other"==c||"left-other"==c||"right-other"==c||"top-other"==c||"bottom-other"==c;if(f){null==b&&(b={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var g=document.createElement("canvas"),h=g.getContext("2d"),i=0,j=0;if("six-each"==c){var k={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(null==d||null==e)for(var l=0;l<a.length;l++)i=Math.max(a[l].width,i),j=Math.max(a[l].height,j);i*=3,j*=2,i>1024&&(i=1024),j>1024&&(j=1024);var m,n=["front","back","right","left","top","bottom"],o=[];for(var l in b){var p=b[l];"other"!==p?(o.push(p),n.splice(n.indexOf(p),1)):m=l}null!=m&&(b[m]=n),d=d||i,e=e||j,g.setAttribute("width",d),g.setAttribute("height",e);for(var l=(Math.min(a.length,6),0);6>l;l++){var q=b[l];if(q){var r=q;r=uc.isArray(q)?q:-1!=q.indexOf(",")?q.split(","):[q];for(var s=0;s<r.length;s++){var p=r[s],t=k[p][0],u=k[p][1];h.drawImage(a[l],t*d,u*e,d/3,e/2)}}}}else{var v=c.split("-")[0];if(null==d||null==e)for(var l=0;l<a.length;l++)i+=a[l].width,j=Math.max(a[l].height,j);d=d||i,e=e||j,g.setAttribute("width",d),g.setAttribute("height",e);for(var l=(b[v],Math.min(a.length,2),0);2>l;l++){var q=b[l];q&&(q==v?h.drawImage(a[l],0,0,d/2,e):h.drawImage(a[l],d/2,0,d/2,e))}}return g}},uc.getVectorAngles=function(a,b){var c=a;b&&(c=b.clone().sub(a)),c=c.normalize();var d=Math.asin(c.y)*vc,e=Math.atan2(c.x,c.z)*vc;return[e,d]},uc.getPixelFromImage=function(a,b,c){var d;dc.isCanvas(a)?d=a:(d=document.createElement("canvas"),d.width=a.width,d.height=a.height,d.getContext("2d").drawImage(a,0,0,a.width,a.height)),b-=Math.floor(b),c-=Math.floor(c),c=1-c;var e=d.getContext("2d").getImageData(a.width*b,a.height*c,1,1).data;return e},uc.nextPowerOfTwo=function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a},uc.createTextBillboard=function(a,b){var c=new mono.Billboard;a=a||"",b=b||{};var d=uc.createTextImage(a,b);return c.setStyle("m.texture.image",d),c.setScale(d.width,d.height,1),c},uc.createTextImage=function(a,b){a=a||"";var c=b.font,d=b.color,f=b.background,g=b.powerOfTwo,h=b.canvas,i=b.drawFunction;h=h||document.createElement("canvas"),c=c||'20px "Dialog"',d=d||"white",f=f===e?"#0F90C4":f,g=g||!1;var j,k=b.textAlign||"center";j=uc.isArray(a)?a:a.split("\n");var l=mono.Utils.getMaxTextSize(j,c),m=b.ratio||l.width/l.height,n=h.realSize={width:l.width,height:l.height};g&&(l.width=mono.Utils.nextPowerOfTwo(l.width),l.height=mono.Utils.nextPowerOfTwo(l.height));var o=h.drawRect={width:n.width/n.height>m?n.width:n.height*m,height:n.width/n.height>m?n.width/m:n.height};Number.isNaN(o.width)&&console.log("debug -- b",n.width,n.height,m),o.width=Math.min(o.width,l.width),o.height=Math.min(o.height,l.height),h.width=l.width,h.height=l.height,Number.isNaN(o.width)&&console.log("debug -- a");var p=h.getContext("2d");if(f&&(p.fillStyle=f),i)i(p,h.width,h.height);else{f&&p.fillRect(0,0,h.width,h.height),p.font=c,p.fillStyle=d,p.strokeStyle="gray",p.textBaseline="middle",p.textAlign=k;for(var q,r=j.length,s=n.height/r,t=0;r>t;t++){uc.isArray(d)&&(q=d[t],q&&(p.fillStyle=q));var u=mono.Utils.getTextSize(c,j[t]),v=(u.width,u.height,h.height,(o.width-n.width)/2);"center"===k?v=o.width/2:"right"===k&&(v=o.width);var w=(o.height-n.height)/2+s/2+t*s+(h.height-o.height);p.strokeText(j[t],v,w),p.fillText(j[t],v,w)}}return h},uc.createTextImage2=function(a,b){a=a||"",a=String(a);var c=b.font,d=b.color,g=b.background,h=b.powerOfTwo,i=b.canvas,j=b.drawFunction;i=i||document.createElement("canvas"),c=c||'20px "Dialog"',d=d||"white",g=g===e?"#0F90C4":g,h=h||!1;var k=(b.align||"center",b.sizeScale||1),l=uc.getMaxTextSize(a.split("\n"),c);i.realSize={width:l.width,height:l.height},l.width*=k,l.height*=k,h&&(l.width=uc.nextPowerOfTwo(l.width),l.height=uc.nextPowerOfTwo(l.height)),i.width=l.width,i.height=l.height;var m=i.getContext("2d");return g&&(m.fillStyle=g),j?j(m,i.width,i.height):(g&&m.fillRect(0,0,i.width,i.height),f(m,a,c,d,i,"center")),i},uc.getMaxTextSize=function(a,b){if(a&&a.length>0){for(var c=a.length,d=hc.getTextSize(b,a[0]),e=d.width,f=d.height*c,g=0;c>g;g++){var h=hc.getTextSize(b,a[g]).width;h>e&&(e=h)}return{width:e,height:f}}return null},uc.getTextSize=function(a,b){return hc.getTextSize(a,b)},uc.playCameraAnimation=function(a,b,c,d,e){if(uc.activeAnimates&&uc.activeAnimates instanceof Array)for(var f=0;f<uc.activeAnimates.length;f++)uc.activeAnimates[f].stop();if(b=b||a.p(),c=c||a.getTarget(),b.equals(a.getPosition())&&c.equals(a.target))return e&&e(),null;var g=a.getPosition().sub(a.getTarget()),h=(new mono.Vec3).addVectors(g,c);d=d||3e3;var i=mono.Utils.getVectorAngles(c,h),j=mono.Utils.getVectorAngles(c,b),k=j[0]-i[0];k>180?k-=360:-180>k&&(k+=360);var l=j[1]-i[1];l>180?l-=360:-180>l&&(l+=360);var m=a.getTarget(),n=c,o=a.getDistance(),p=(new mono.Vec3).subVectors(b,c).length(),q=i[0],r=i[1],s=j[0],t=j[1],u=new mono.Animate({from:0,to:1,repeat:1,dur:d/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(b){var c=s,d=r>t?r+l*b:t,e=n,f=o+(p-o)*b,g=new mono.Vec3;g.x=e.x+f*Math.sin(c*wc)*Math.cos(d*wc),g.z=e.z+f*Math.cos(c*wc)*Math.cos(d*wc),g.y=e.y+f*Math.sin(d*wc),a.p(g),a.lookAt(e)},onDone:function(){e&&e()},onStop:function(){}}),v=new mono.Animate({from:0,to:1,repeat:1,dur:d/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(b){var c=q+k*b,d=r>t?r:t,e=n,f=o>p?o:p;if(t>=r)var f=p;var g=new mono.Vec3;g.x=e.x+f*Math.sin(c*wc)*Math.cos(d*wc),g.z=e.z+f*Math.cos(c*wc)*Math.cos(d*wc),g.y=e.y+f*Math.sin(d*wc),a.p(g),a.lookAt(e)},onDone:function(){o=a.getDistance(),m=a.getTarget()},onStop:function(){this.isPlaying&&(delete this.isPlaying,t>=r?e&&e():u.play())}}),w=new mono.Animate({from:0,to:1,dur:d/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(b){var c=q,d=r>t?r:r+l*b,e=(new mono.Vec3).lerpVectors(m,n,b),f=o+(p-o)*b;
o>p&&(0!=k||r>t)&&(f=o);var g=new mono.Vec3;g.x=e.x+f*Math.sin(c*wc)*Math.cos(d*wc),g.z=e.z+f*Math.cos(c*wc)*Math.cos(d*wc),g.y=e.y+f*Math.sin(d*wc),a.p(g),a.lookAt(e)},onDone:function(){},onStop:function(){this.isPlaying&&(delete this.isPlaying,0==k&&t>=r?e&&e():0!=k?v.play():u.play())}});return 0==k&&t>=r?(w.dur=d,w.finish=d):0==k?(u.dur=2*d/3,u.finish=2*d/3):r>t&&(v.dur=2*d/3,v.finish=2*d/3),w.play(),uc.activeAnimates=[w,v,u],[w,v,u]},uc.stopAnimate=function(a,b){Vb(a,b)},uc.stopAllAnimates=function(a){Wb(a)},$b.Utils=uc,$b.NurbsUtils={findSpan:function(a,b,c){var d=c.length-a-1;if(b>=c[d])return d-1;if(b<=c[a])return a;for(var e=a,f=d,g=Math.floor((e+f)/2);b<c[g]||b>=c[g+1];)b<c[g]?f=g:e=g,g=Math.floor((e+f)/2);return g},calcBasisFunctions:function(a,b,c,d){var e=[],f=[],g=[];e[0]=1;for(var h=1;c>=h;++h){f[h]=b-d[a+1-h],g[h]=d[a+h]-b;for(var i=0,j=0;h>j;++j){var k=g[j+1],l=f[h-j],m=e[j]/(k+l);e[j]=i+k*m,i=l*m}e[h]=i}return e},calcBSplinePoint:function(a,b,c,d){for(var e=this.findSpan(a,d,b),f=this.calcBasisFunctions(e,d,a,b),g=new $b.Vec4(0,0,0,0),h=0;a>=h;++h){var i=c[e-a+h],j=f[h],k=i.w*j;g.x+=i.x*k,g.y+=i.y*k,g.z+=i.z*k,g.w+=i.w*j}return g},calcBasisFunctionDerivatives:function(a,b,c,d,e){for(var f=[],g=0;c>=g;++g)f[g]=0;for(var h=[],g=0;d>=g;++g)h[g]=f.slice(0);for(var i=[],g=0;c>=g;++g)i[g]=f.slice(0);i[0][0]=1;for(var j=f.slice(0),k=f.slice(0),l=1;c>=l;++l){j[l]=b-e[a+1-l],k[l]=e[a+l]-b;for(var m=0,n=0;l>n;++n){var o=k[n+1],p=j[l-n];i[l][n]=o+p;var q=i[n][l-1]/i[l][n];i[n][l]=m+o*q,m=p*q}i[l][l]=m}for(var l=0;c>=l;++l)h[0][l]=i[l][c];for(var n=0;c>=n;++n){for(var r=0,s=1,t=[],g=0;c>=g;++g)t[g]=f.slice(0);t[0][0]=1;for(var u=1;d>=u;++u){var v=0,w=n-u,x=c-u;n>=u&&(t[s][0]=t[r][0]/i[x+1][w],v=t[s][0]*i[w][x]);for(var y=w>=-1?1:-w,z=x>=n-1?u-1:c-n,l=y;z>=l;++l)t[s][l]=(t[r][l]-t[r][l-1])/i[x+1][w+l],v+=t[s][l]*i[w+l][x];x>=n&&(t[s][u]=-t[r][u-1]/i[x+1][n],v+=t[s][u]*i[n][x]),h[u][n]=v;var l=r;r=s,s=l}}for(var n=c,u=1;d>=u;++u){for(var l=0;c>=l;++l)h[u][l]*=n;n*=c-u}return h},calcBSplineDerivatives:function(a,b,c,d,e){for(var f=a>e?e:a,g=[],h=this.findSpan(a,d,b),i=this.calcBasisFunctionDerivatives(h,d,a,f,b),j=[],k=0;k<c.length;++k){var l=c[k].clone(),m=l.w;l.x*=m,l.y*=m,l.z*=m,j[k]=l}for(var n=0;f>=n;++n){for(var l=j[h-a].clone().multiplyScalar(i[n][0]),o=1;a>=o;++o)l.add(j[h-a+o].clone().multiplyScalar(i[n][o]));g[n]=l}for(var n=f+1;e+1>=n;++n)g[n]=new $b.Vec4(0,0,0);return g},calcKoverI:function(a,b){for(var c=1,d=2;a>=d;++d)c*=d;for(var e=1,d=2;b>=d;++d)e*=d;for(var d=2;a-b>=d;++d)e*=d;return c/e},calcRationalCurveDerivatives:function(a){for(var b=a.length,c=[],d=[],e=0;b>e;++e){var f=a[e];c[e]=new $b.Vec3(f.x,f.y,f.z),d[e]=f.w}for(var g=[],h=0;b>h;++h){for(var i=c[h].clone(),e=1;h>=e;++e)i.sub(g[h-e].clone().multiplyScalar(this.calcKoverI(h,e)*d[e]));g[h]=i.divideScalar(d[0])}return g},calcNURBSDerivatives:function(a,b,c,d,e){var f=this.calcBSplineDerivatives(a,b,c,d,e);return this.calcRationalCurveDerivatives(f)},calcSurfacePoint:function(a,b,c,d,e,f,g){for(var h=this.findSpan(a,f,c),i=this.findSpan(b,g,d),j=this.calcBasisFunctions(h,f,a,c),k=this.calcBasisFunctions(i,g,b,d),l=[],m=0;b>=m;++m){l[m]=new $b.Vec4(0,0,0,0);for(var n=0;a>=n;++n){var o=e[h-a+n][i-b+m].clone(),p=o.w;o.x*=p,o.y*=p,o.z*=p,l[m].add(o.multiplyScalar(j[n]))}}for(var q=new $b.Vec4(0,0,0,0),m=0;b>=m;++m)q.add(l[m].multiplyScalar(k[m]));return q.divideScalar(q.w),new $b.Vec3(q.x,q.y,q.z)}},$b.GLParameters=function(a,b,c){this.material=a,this.network=b,this.precision=b._precision,this.map=!!a.map,this.mapLoaded=!0,this.envMap=!!a.envMap,this.lightMap=!!a.lightMap,this.bumpMap=!!a.bumpMap&&"phong"===a._type,this.normalMap=!!a.normalMap&&"phong"===a._type,this.specularMap=!!a.specularMap,this.vertexColors=a.vertexColors,this.wireframe=a.wireframe,this.fog=b._fog,this.useFog=a.fog,this.fogExp=this.fog instanceof $b.FogExp2,this.sizeAttenuation=a.sizeAttenuation,this.skinning=a.skinning,this.maxBones=b.maxBones,this.useVertexTexture=b._supportsBoneTextures&&c&&c.useVertexTexture,this.boneTextureWidth=c&&c.boneTextureWidth,this.boneTextureHeight=c&&c.boneTextureHeight,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.maxMorphTargets=b.maxMorphTargets,this.maxMorphNormals=b.maxMorphNormals,this.maxDirLights=b.maxLightCount.directional,this.maxPointLights=b.maxLightCount.point,this.maxSpotLights=b.maxLightCount.spot,this.maxHemiLights=b.maxLightCount.hemi,this.maxShadows=b.maxShadows,this.maxPointShadows=b.maxPointShadows,this.shadowMapEnable=b._shadowMapEnable&&c.receiveShadow&&this.maxShadows>0,this.pointShadowMapEnable=b._shadowMapEnable&&c.receiveShadow&&this.maxPointShadows>0,this.shadowMapType=b.shadowMapType,this.shadowMapDebug=b.shadowMapDebug,this.shadowMapCascade=b.shadowMapCascade,this.alphaTest=a.alphaTest,this.metal=a.metal,this.perPixel=a.perPixel,this.wrapAround=a.wrapAround,this.doubleSided=a.side===$b.DoubleSide&&!ec.isIE,this.flipSided=a.side===$b.BackSide,this.useSSAO=b.isSSAOEnable()&&b.pm.isLightMaterial(a),this.gammaInput=b.gammaInput,this.gammaOutput=b.gammaOutput,this.physicallyBasedShading=b.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===$b.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===$b.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=uc.getObjectCount(a.gradient)},$b.GLParameters.prototype.getShaders=function(a){a=a===e?"":a;var b=this,c=["precision "+b.precision+" float;",a,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"",b.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+b.maxDirLights,"#define MAX_POINT_LIGHTS "+b.maxPointLights,"#define MAX_SPOT_LIGHTS "+b.maxSpotLights,"#define MAX_HEMI_LIGHTS "+b.maxHemiLights,"#define MAX_SHADOWS "+b.maxShadows,"#define MAX_POINT_SHADOWS "+b.maxPointShadows,"#define MAX_BONES "+b.maxBones,b.map?"#define USE_MAP":"",b.envMap?"#define USE_ENVMAP":"",b.lightMap?"#define USE_LIGHTMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.vertexColors?"#define USE_COLOR":"",b.maxGrandient>0?"#define MAX_GRADIENT "+b.maxGrandient:"",b.skinning?"#define USE_SKINNING":"",b.useVertexTexture?"#define BONE_TEXTURE":"",b.boneTextureWidth?"#define N_BONE_PIXEL_X "+b.boneTextureWidth.toFixed(1):"",b.boneTextureHeight?"#define N_BONE_PIXEL_Y "+b.boneTextureHeight.toFixed(1):"",b.morphTargets?"#define USE_MORPHTARGETS":"",b.morphNormals?"#define USE_MORPHNORMALS":"",b.perPixel?"#define PHONG_PER_PIXEL":"",b.wrapAround?"#define WRAP_AROUND":"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"",b.shadowMapEnable?"#define USE_SHADOWMAP":"",b.shadowMapEnable||b.pointShadowMapEnable?"#define "+b.shadowMapTypeDefine:"",b.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",b.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",b.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",b.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),d=["precision "+this.precision+" float;",b.bumpMap||b.normalMap?"#extension GL_OES_standard_derivatives : enable":"",a,"#define MAX_DIR_LIGHTS "+b.maxDirLights,"#define MAX_POINT_LIGHTS "+b.maxPointLights,"#define MAX_SPOT_LIGHTS "+b.maxSpotLights,"#define MAX_HEMI_LIGHTS "+b.maxHemiLights,"#define MAX_SHADOWS "+b.maxShadows,"#define MAX_POINT_SHADOWS "+b.maxPointShadows,b.useSSAO?"#define USE_SSAO":"",b.wireframe?"#define USE_WIREFRAME":"",b.alphaTest?"#define ALPHATEST "+b.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",b.useFog&&b.fog?"#define USE_FOG":"",b.useFog&&b.fogExp?"#define FOG_EXP2":"",b.map?"#define USE_MAP":"",b.envMap?"#define USE_ENVMAP":"",b.lightMap?"#define USE_LIGHTMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.maxGrandient>0?"#define MAX_GRADIENT "+b.maxGrandient:"",b.vertexColors?"#define USE_COLOR":"",b.metal?"#define METAL":"",b.perPixel?"#define PHONG_PER_PIXEL":"",b.wrapAround?"#define WRAP_AROUND":"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"",b.shadowMapEnable?"#define USE_SHADOWMAP":"",b.shadowMapEnable||b.pointShadowMapEnable?"#define "+b.shadowMapTypeDefine:"",b.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",b.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",b.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");return[c,d]};var xc={};xc.setDepthTest=function(a,b){var c=b._gl;b._oldDepthTest!==a&&(a?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),b._oldDepthTest=a)},xc.setSmapleAlphaToCoverage=function(a,b){var c=b._gl;b._oldSmapleAlphaToCoverage!==a&&(a?c.enable(c.SAMPLE_ALPHA_TO_COVERAGE):c.disable(c.SAMPLE_ALPHA_TO_COVERAGE),b._oldSmapleAlphaToCoverage=a)},xc.setDepthWrite=function(a,b){var c=b._gl;b._oldDepthWrite!==a&&(c.depthMask(a),b._oldDepthWrite=a)},xc.clear=function(a,b,c,d){var f=d._gl,g=0;(a===e||a)&&(g|=f.COLOR_BUFFER_BIT),(b===e||b)&&(g|=f.DEPTH_BUFFER_BIT),(c===e||c)&&(g|=f.STENCIL_BUFFER_BIT),d._gl.clear(g)},xc.setPolygonOffset=function(a,b,c,d){var e=d._gl;d._oldPolygonOffset!==a&&(a?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),d._oldPolygonOffset=a),a&&(d._oldPolygonOffsetFactor!==b||d._oldPolygonOffsetUnits!==c)&&(e.polygonOffset(b,c),d._oldPolygonOffsetFactor=b,d._oldPolygonOffsetUnits=c)},xc.setBlending=function(a,b,c,d,e){var f=e._gl;a!==e._oldBlending&&(a===$b.NoBlending?f.disable(f.BLEND):a===$b.AdditiveBlending?(f.enable(f.BLEND),f.blendEquation(f.FUNC_ADD),f.blendFunc(f.SRC_ALPHA,f.ONE)):a===$b.SubtractiveBlending?(f.enable(f.BLEND),f.blendEquation(f.FUNC_ADD),f.blendFunc(f.ZERO,f.ONE_MINUS_SRC_COLOR)):a===$b.MultiplyBlending?(f.enable(f.BLEND),f.blendEquation(f.FUNC_ADD),f.blendFunc(f.ZERO,f.SRC_COLOR)):a===$b.CustomBlending?f.enable(f.BLEND):(f.enable(f.BLEND),f.blendEquationSeparate(f.FUNC_ADD,f.FUNC_ADD),f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA)),e._oldBlending=a),a===$b.CustomBlending?(b!==this._oldBlendEquation&&(f.blendEquation(uc.paramToGL(b)),e._oldBlendEquation=b),(c!==_oldBlendSrc||d!==_oldBlendDst)&&(f.blendFunc(uc.paramToGL(c),uc.paramToGL(d)),e._oldBlendSrc=c,e._oldBlendDst=d)):(e._oldBlendEquation=null,e._oldBlendSrc=null,e._oldBlendDst=null)},xc.enableStencil=function(a){a.enable(a.STENCIL_TEST),a.stencilFunc(a.ALWAYS,1,1),a.stencilOp(a.KEEP,a.REPLACE,a.REPLACE),a.stencilMask(1),a.clearStencil(0),a.clear(a.STENCIL_BUFFER_BIT)},xc.stencilTest=function(a){a.enable(a.STENCIL_TEST),a.stencilFunc(a.EQUAL,0,1),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.stencilMask(0)},xc.disableStencil=function(a){a.disable(a.STENCIL_TEST)},xc.r=function(a,b,c,d,e,f,g){a._AK47(b,c,d,e,f,g)},xc.g=function(a,b,c,d,e,f){a.renderGroup(b,c,d,e,f)},$b.GLUtils=xc,$b.GPU=function(a){var b=a._gl,c=a.webglVersion;this._glExtensionTextureFloat=c>1||b.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=c>1||b.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE),this._maxCubemapSize=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?b.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=this._maxVertexTextures>0,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?b.getParameter(b.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_INT),this._vertexShaderPrecisionMediumpInt=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.LOW_INT),this._fragmentShaderPrecisionHighpInt=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_INT);var d=this._vertexShaderPrecisionHighpFloat&&this._vertexShaderPrecisionHighpFloat.precision>0&&this._fragmentShaderPrecisionHighpFloat&&this._fragmentShaderPrecisionHighpFloat.precision>0,e=this._vertexShaderPrecisionMediumpFloat&&this._vertexShaderPrecisionMediumpFloat.precision>0&&this._fragmentShaderPrecisionMediumpFloat&&this._fragmentShaderPrecisionMediumpFloat.precision>0,f=a._precision;"highp"===f&&!d&&(e?(f="mediump",console.log("highp not supported, using mediump")):(f="lowp",console.log("highp and mediump not supported, using lowp"))),"mediump"===f&&!e&&(f="lowp",console.log("mediump not supported, using lowp")),a._precision=f},$b.Program=function(a,b,c,d){this.entity=a,this.group=b,this.material=c,this.network=d},$b.Program.prototype.setEntity=function(){this.entity},$b.Program.prototype.buildGLProgram=function(){},$b.Uniform=function(a,b,c){this.id=a,this.type=b,this.value=c,this.location=e},$b.Uniform.prototype={constructor:$b.Uniform,setValue:function(a){this.value=a},getUniformLocation:function(a,b){return a.getUniformLocation(this.id)}},$b.Uniform.loadUniform=function(a,b,c){if(type=b.type,value=b.value,"i"===type)c.uniform1i(a,value);else if("f"===type)c.uniform1f(a,value);else if("v2"===type)c.uniform2f(a,value.x,value.y);else if("v3"===type)c.uniform3f(a,value.x,value.y,value.z);else if("v4"===type)c.uniform4f(a,value.x,value.y,value.z,value.w);else if("c"===type)c.uniform3f(a,value.r,value.g,value.b);else if("iv1"===type)c.uniform1iv(a,value);else if("iv"===type)c.uniform3iv(a,value);else if("fv1"===type)c.uniform1fv(a,value);else if("fv"===type)c.uniform3fv(a,value);else if("v2v"===type){for(b._array===e&&(b._array=new Float32Array(2*value.length)),i=0,il=value.length;i<il;i++)offset=2*i,b._array[offset]=value[i].x,b._array[offset+1]=value[i].y;c.uniform2fv(a,b._array)}else if("v3v"===type){for(b._array===e&&(b._array=new Float32Array(3*value.length)),i=0,il=value.length;i<il;i++)offset=3*i,b._array[offset]=value[i].x,b._array[offset+1]=value[i].y,b._array[offset+2]=value[i].z;c.uniform3fv(a,b._array)}else if("v4v"===type){for(b._array===e&&(b._array=new Float32Array(4*value.length)),i=0,il=value.length;i<il;i++)offset=4*i,b._array[offset]=value[i].x,b._array[offset+1]=value[i].y,b._array[offset+2]=value[i].z,b._array[offset+3]=value[i].w;c.uniform4fv(a,b._array)}else if("m4"===type)b._array===e&&(b._array=new Float32Array(16)),value.flattenToArray(b._array),c.uniformMatrix4fv(a,!1,b._array);else if("m4v"===type){for(b._array===e&&(b._array=new Float32Array(16*value.length)),i=0,il=value.length;i<il;i++)value[i].flattenToArrayOffset(b._array,16*i);c.uniformMatrix4fv(a,!1,b._array)}else if("t"===type)texture=value,textureUnit=getTextureUnit(),c.uniform1i(a,textureUnit),!texture||(texture.image instanceof Array&&6===texture.image.length?setCubeTexture(texture,textureUnit):texture instanceof $CubeRenderTargetCube?setCubeTextureDynamic(texture,textureUnit):_this.setTexture(texture,textureUnit));else if("tv"===type){for(b._array===e&&(b._array=[]),i=0,il=b.value.length;i<il;i++)b._array[i]=getTextureUnit();for(c.uniform1iv(a,b._array),i=0,il=b.value.length;i<il;i++)texture=b.value[i],textureUnit=b._array[i],texture&&_this.setTexture(texture,textureUnit)}},$b.Uniform.loadGeneralUniforms=function(a,b,c){var d,e,f,g;for(f=0,g=b.length;g>f;f++)e=a.uniforms[b[f][1]],e&&(d=b[f][0],$b.Uniform.loadUniform(d,c))},$b.ProgramManager=function(a){this.id=$b.ProgramManagerId++,this.network=a,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.currentEntity=null,this.currentGroup=null,this.currentMaterial=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(a){if("image"===a.property||"loaded"===a.property){var b=a.source;this.changeTextureUpdateFlags(b,!0),delete this.unLoadedImage[b._image]}else if("disposed"===a.property){var b=a.source;this.deallocateTexture(b),b.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[b.id],delete this.textureMap[b.id]}uc.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(a){if("map"==a.property||a.property.endsWith("Map")||"needsUpdate"===a.property){var b=a.source;this.materialUpdateFlags[b.id]=!0}else if("disposed"===a.property){var b=a.source;this.deallocateMaterial(b),b.removePropertyChangeListener(this.handleMaterialChange),delete this.materialUpdateFlags[b.id],delete this.materialMap[b.id],delete this.programMap[b.id]}uc.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},$b.ProgramManager.prototype.addMaterial=function(a){null==this.materialMap[a.id]&&(this.materialMap[a.id]=a,a.addPropertyChangeListener(this.handleMaterialChange,this))},$b.ProgramManager.prototype.dispose=function(){for(var a in this.materialMap){var b=this.materialMap[a];b.removePropertyChangeListener(this.handleMaterialChange,this)}this.materialMap={};for(var a in this.textureMap){var c=this.textureMap[a];c.removePropertyChangeListener(this.handleTextureChange,this)}this.textureMap={}},$b.ProgramManager.prototype.needsUpdateMaterial=function(a){return this.materialUpdateFlags[a.id]===e||this.materialUpdateFlags[a.id]===!0?!0:a.map instanceof yc||a.map instanceof zc?!0:!1},$b.ProgramManager.prototype.changeMaterialUpdateFlags=function(a,b){this.materialUpdateFlags[a.id]=b},$b.ProgramManager.prototype.isLightMaterial=function(a){return a instanceof $b.LambertMaterial||a instanceof $b.PhongMaterial||a.lights||"lambert"===a._type||"phong"===a._type||"terrain"===a._type},$b.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(a,b,c){for(var d in this.materialMap){var e=this.materialMap[d];(null==b||b.call(c,e))&&(this.materialUpdateFlags[e.id]=a)}},$b.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(a){this.changeAllMaterialUpdateFlags(a,this.isLightMaterial,this)},$b.ProgramManager.prototype.addTexture=function(a){null!=a.id&&this.textureMap[a.id]===e&&(this.textureMap[a.id]=a,a.addPropertyChangeListener(this.handleTextureChange,this),a._image.loaded||(this.unLoadedImage[a._image]=1))},$b.ProgramManager.prototype.needsUpdateTexture=function(a){return this.textureUpdateFlags[a.id]===e||this.textureUpdateFlags[a.id]===!0?!0:!1},$b.ProgramManager.prototype.changeTextureUpdateFlags=function(a,b){this.textureUpdateFlags[a.id]=b;for(var c in this.materialMap){var d=this.materialMap[c];(d.map===a||d.lightMap===a||d.envMap===a||d.normalMap===a||d.specularMap===a)&&this.changeMaterialUpdateFlags(d,!0)}},$b.ProgramManager.prototype.buildProgram=function(a,b,c){this.currentEntity=a,this.currentGroup=b,this.currentMaterial=c,c.shaderID||c.setupMaterialShader();var d,e,f,g,h=new $b.GLParameters(this.currentMaterial,this.network,a),i=[];if(c.shaderID?i.push(c.shaderID):(i.push(c.vertexShader),i.push(c.fragmentShader)),!(c instanceof $b.ShaderMaterial))for(Xc in h)"material"!==Xc&&"network"!==Xc&&"node"!==Xc&&(i.push(Xc),i.push(h[Xc]));for(g=i.join(),d=0,e=this.programs.length;e>d;d++)if(this.programs[d].code===g){c.program=this.programs[d].program,c.uniformsList=[];for(o in c.uniforms)c.uniformsList.push([c.uniforms[o],o]);return this.programs[d].usedTimes++,this.programs[d].program}f=this.gl.createProgram();var j=h.getShaders(),k=j[1],m=j[0];if(this.gl.attachShader(f,l("fragment",k+c.fragmentShader,this.gl)),this.gl.attachShader(f,l("vertex",m+c.vertexShader,this.gl)),this.gl.linkProgram(f),!this.gl.getProgramParameter(f,this.gl.LINK_STATUS)&&!this.gl.isContextLost()&&console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(f,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),!f)return f;f.uniforms={},f.attributes={};var n,o,p,d;n=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(o in c.uniforms)n.push(o);for(this.attachGLLocations(f,n,"uniform"),n=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],d=0;d<h.maxMorphTargets;d++)n.push("morphTarget"+d);for(d=0;d<h.maxMorphNormals;d++)n.push("morphNormal"+d);for(p in c.attributes)n.push(p);this.attachGLLocations(f,n,"attribute"),f.id=this.programs.length,this.programs.push({program:f,code:g,usedTimes:1}),this.info.memory.programCount=this.programs.length,c.program=f,c.uniformsList=[];for(o in c.uniforms)c.uniformsList.push([c.uniforms[o],o]);return f},$b.ProgramManager.prototype.enableAttribute=function(b,c){var d=c.program.attributes;if(d.position>=0&&_gl.enableVertexAttribArray(d.position),d.color>=0&&_gl.enableVertexAttribArray(d.color),d.normal>=0&&_gl.enableVertexAttribArray(d.normal),c.attributes)for(a in c.attributes)d[a]!==e&&d[a]>=0&&_gl.enableVertexAttribArray(d[a])},$b.ProgramManager.prototype.attachGLLocations=function(a,b,c){var d,e,f,g=this.gl;if("uniform"===c)for(d=0,e=b.length;e>d;d++)f=b[d],a.uniforms[f]=g.getUniformLocation(a,f);else if("attribute"===c)for(d=0,e=b.length;e>d;d++)f=b[d],a.attributes[f]=g.getAttribLocation(a,f)},$b.ProgramManager.prototype.setProgram=function(a,b,c,d,e,f){if(this.textureCount=0,this.addMaterial(d),this.needsUpdateMaterial(d)){d.setupMaterialShader(),this.programMap[d.id]&&this.deallocateMaterial(d);var i=this.buildProgram(f,e,d);this.programMap[d.id]=i,this.changeMaterialUpdateFlags(d,!1)}var j=!1,l=this.programMap[d.id];if(!l)return l;var n=l.uniforms,o=d.uniforms;return l!=this.currentProgram&&(this.gl.useProgram(l),this.currentProgram=l,j=!0),d.id!==this.currentMaterialId&&(this.currentMaterialId=d.id,j=!0),(j||a!==this.network._currentCamera)&&(this.gl.uniformMatrix4fv(n.projectionMatrix,!1,a.projectionMatrix.elements),a!==this.network._currentCamera&&(this.network._currentCamera=a)),c&&d.fog&&c.refreshUniforms(o),(d.lights||"phong"===d._type||"lambert"===d._type||"terrain"===d._type)&&(this._lightNeedsUpdate&&(this.setupLights(l,b),this._lightNeedsUpdate=!1),m(o,this._lights)),j&&d.refreshUniforms(!1,{camera:this.network._camera,network:this.network}),f.receiveShadow&&!d._shadowPass&&this.network.isShadowable()&&(g(o,b),h(o,b)),j&&this.loadUniformsGeneric(l,d.uniformsList,d),d.loadCameraPosition(n,a,this.gl),(d.skinning||"phong"===d._type||"lambert"===d._type||"terrain"===d._type||d instanceof $b.ShaderMaterial)&&null!==n.viewMatrix&&this.gl.uniformMatrix4fv(n.viewMatrix,!1,a.worldMatrixInverse.elements),k(n,f,this.gl,this.network),null!=n.modelMatrix&&this.gl.uniformMatrix4fv(n.modelMatrix,!1,f.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(n,d,j),l},$b.ProgramManager.prototype.loadSSAOUniforms=function(a,b,c){if(null!=a.mapSSAO&&this.network._sSAOEnable){var d=a.mapSSAO,e=c?this.getTextureUnit():b._ssaoSlot;this.gl.uniform1i(d,e),this.setTexture(this.network.finalSSAOTarget,e),b._ssaoSlot=e}},$b.ProgramManager.prototype.onTextureDispose=function(a){var b=a.target;b.removeEventListener("dispose",onTextureDispose),deallocateTexture(b),this.info.memory.textures--},$b.ProgramManager.prototype.deallocateTexture=function(a){var b=this.gl;if(a._image&&a._image.__webglTextureCube)b.deleteTexture(a._image.__webglTextureCube);else{if(!a.__webglInit)return;a.__webglInit=!1,b.deleteTexture(a.__webglTexture)}},$b.ProgramManager.prototype.setTextureParameters=function(a,b,c,d){var e=this.gl,f=this.gpu,g=$b.Utils.paramToGL;c&&!d?(e.texParameteri(a,e.TEXTURE_WRAP_S,g(b.wrapS,e)),e.texParameteri(a,e.TEXTURE_WRAP_T,g(b.wrapT,e)),e.texParameteri(a,e.TEXTURE_MAG_FILTER,g(b.magFilter,e)),e.texParameteri(a,e.TEXTURE_MIN_FILTER,g(b.minFilter,e))):(e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,this.filterFallback(b.magFilter)),e.texParameteri(a,e.TEXTURE_MIN_FILTER,this.filterFallback(b.minFilter))),f._glExtensionTextureFilterAnisotropic&&b.type!==$b.FloatType&&(b.anisotropy>1||b.__oldAnisotropy)&&(e.texParameterf(a,f._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,f._maxAnisotropy)),b.__oldAnisotropy=b.anisotropy)},$b.ProgramManager.prototype.setCubeTexture=function(a,b){var c=this.gl;this.addTexture(a);var d=a.id;if(6===a._image.length){if(!a._image.loaded)return;var f=$b.Utils.isPowerOfTwo,g=$b.Utils.paramToGL;if(this.needsUpdateTexture(a)){this.glTextureMap[d]===e&&(this.glTextureMap[d]=c.createTexture(),this.info.memory.texture++),this.changeTextureUpdateFlags(a,!1),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_CUBE_MAP,this.glTextureMap[d]),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var h=a instanceof $b.CompressedTexture,i=[],j=0;6>j;j++)this.autoScaleCubemaps&&!h?i[j]=clampToMaxSize(a._image[j],_maxCubemapSize):i[j]=a._image[j];var k=i[0],l=f(k.width)&&f(k.height),m=g(a.format,c),n=g(a.type,c);this.setTextureParameters(c.TEXTURE_CUBE_MAP,a,l);for(var j=0;6>j;j++)if(h)for(var o,p=i[j].mipmaps,q=0,r=p.length;r>q;q++)o=p[q],c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+j,q,m,o.width,o.height,0,o.data);else c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,m,m,n,i[j]);a.generateMipmaps&&l&&c.generateMipmap(c.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_CUBE_MAP,this.glTextureMap[d])}},$b.ProgramManager.prototype.setCubeTextureDynamic=function(a,b){var c=this.gl;c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_CUBE_MAP,a.__webglTexture)},$b.ProgramManager.prototype.loadUniformsGeneric=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p=this.gl;for(m=0,n=b.length;n>m;m++)if(h=a.uniforms[b[m][1]])if(d=b[m][0],g=d.type,f=d.value,"i"===g)p.uniform1i(h,f);else if("f"===g)p.uniform1f(h,f);else if("v2"===g)p.uniform2f(h,f.x,f.y);else if("v3"===g)p.uniform3f(h,f.x,f.y,f.z);else if("v4"===g)p.uniform4f(h,f.x,f.y,f.z,f.w);else if("c"===g)p.uniform3f(h,f.r,f.g,f.b);else if("iv1"===g)p.uniform1iv(h,f);else if("iv"===g)p.uniform3iv(h,f);else if("fv1"===g)p.uniform1fv(h,f);else if("fv"===g)p.uniform3fv(h,f);else if("v2v"===g){for(d._array===e&&(d._array=new Float32Array(2*f.length)),k=0,l=f.length;l>k;k++)o=2*k,d._array[o]=f[k].x,d._array[o+1]=f[k].y;p.uniform2fv(h,d._array)}else if("v3v"===g){for(d._array===e&&(d._array=new Float32Array(3*f.length)),k=0,l=f.length;l>k;k++)o=3*k,f[k]instanceof $b.Color?(d._array[o]=f[k].r,d._array[o+1]=f[k].g,d._array[o+2]=f[k].b):(d._array[o]=f[k].x,d._array[o+1]=f[k].y,d._array[o+2]=f[k].z);p.uniform3fv(h,d._array)}else if("v4v"===g){for(d._array===e&&(d._array=new Float32Array(4*f.length)),k=0,l=f.length;l>k;k++)o=4*k,d._array[o]=f[k].x,d._array[o+1]=f[k].y,d._array[o+2]=f[k].z,d._array[o+3]=f[k].w;p.uniform4fv(h,d._array)}else if("m4"===g)d._array===e&&(d._array=new Float32Array(16)),f.flattenToArray(d._array),p.uniformMatrix4fv(h,!1,d._array);else if("m4v"===g){for(d._array===e&&(d._array=new Float32Array(16*f.length)),k=0,l=f.length;l>k;k++)f[k].flattenToArrayOffset(d._array,16*k);p.uniformMatrix4fv(h,!1,d._array)}else if("t"===g){if(i=f,j=this.getTextureUnit(),p.uniform1i(h,j),!i)continue;if(i._image instanceof Array&&6===i._image.length)this.setCubeTexture(i,j);else{var q=i._image;this.setTexture(i,j,q?!q.loaded:!0)}}else if("tv"===g){for(d._array===e&&(d._array=[]),k=0,l=d.value.length;l>k;k++)d._array[k]=this.getTextureUnit();if(0==d._array.length)return;for(p.uniform1iv(h,d._array),k=0,l=d.value.length;l>k;k++)if(i=d.value[k],j=d._array[k],i){var q=i._image;i instanceof zc?this.setCubeTextureDynamic(i,j):this.setTexture(i,j,q?!q.loaded:!0)}}},$b.ProgramManager.prototype.setTexture=function(a,b,c){var d=this.gl,f=$b.Utils.isPowerOfTwo,g=a.id;if(this.addTexture(a),!this.needsUpdateTexture(a)||a instanceof yc)d.activeTexture(d.TEXTURE0+b),a instanceof yc?d.bindTexture(d.TEXTURE_2D,a.__webglTexture):d.bindTexture(d.TEXTURE_2D,this.glTextureMap[g]);else{if(!a._image)return;this.glTextureMap[g]===e&&(this.glTextureMap[g]=d.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(a,!1),d.activeTexture(d.TEXTURE0+b),d.bindTexture(d.TEXTURE_2D,this.glTextureMap[g]),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!a.flipY),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),d.pixelStorei(d.UNPACK_ALIGNMENT,a.unpackAlignment);var h=$b.Utils.paramToGL,i=c?$b.ImageCache.Logo:a._image,j=f(i.width)&&f(i.height),k=h(a.format,d),l=h(a.type,d);this.setTextureParameters(d.TEXTURE_2D,a,j,c);var m,n=a.mipmaps;if(a instanceof $b.PixelsTexture)if(n.length>0&&j){for(var o=0,p=n.length;p>o;o++)m=n[o],d.texImage2D(d.TEXTURE_2D,o,k,m.width,m.height,0,k,l,m.data);a.generateMipmaps=!1;
}else d.texImage2D(d.TEXTURE_2D,0,k,i.width,i.height,0,k,l,i.data);else if(a instanceof $b.CompressedTexture)for(var o=0,p=n.length;p>o;o++)m=n[o],d.compressedTexImage2D(d.TEXTURE_2D,o,k,m.width,m.height,0,m.data);else if(n.length>0&&j){for(var o=0,p=n.length;p>o;o++)m=n[o],d.texImage2D(d.TEXTURE_2D,o,k,k,l,m);a.generateMipmaps=!1}else try{d.texImage2D(d.TEXTURE_2D,0,k,k,l,i)}catch(q){console.log(q)}a.generateMipmaps&&j&&d.generateMipmap(d.TEXTURE_2D),a.onUpdate&&a.onUpdate()}},$b.ProgramManager.prototype.getTextureUnit=function(){var a=this.textureCount;return a>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+a+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,a},$b.ProgramManager.prototype.deallocateMaterial=function(a){var b=a.program;if(b!==e){a.program=e;var c,d,f,g=!1;for(c=0,d=this.programs.length;d>c;c++)if(f=this.programs[c],f.program===b){f.usedTimes--,0===f.usedTimes&&(g=!0);break}if(g===!0){var h=[];for(c=0,d=this.programs.length;d>c;c++)f=this.programs[c],f.program!==b&&h.push(f);this.programs=h,this.gl.deleteProgram(b),this.info.memory.programs--}}},$b.ProgramManager.prototype.filterFallback=function(a){return a===$b.NearestFilter||a===$b.NearestMipMapNearestFilter||a===$b.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},$b.ProgramManager.prototype.setupLights=function(a,b){var c,d,e,f,g,h,i,j,k,l,m=0,p=0,q=0,r=this._lights,s=r.directional.colors,t=r.directional.positions,u=r.point.colors,v=r.point.positions,w=r.point.distances,x=r.spot.colors,y=r.spot.positions,z=r.spot.distances,A=r.spot.directions,B=r.spot.anglesCos,C=r.spot.exponents,D=r.hemi.skyColors,E=r.hemi.groundColors,F=r.hemi.positions,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=new $b.Vec3;for(c=0,d=b.size();d>c;c++)if(e=b.get(c),!e.onlyShadow)if(f=e.color,i=e.intensity*this.network.lightIntensityRatio,l=e.distance,e.updateWorldMatrix(!0),e instanceof $b.AmbientLight){if(!e._visible)continue;this.gammaInput?(m+=f.r*f.r,p+=f.g*f.g,q+=f.b*f.b):(m+=f.r,p+=f.g,q+=f.b)}else if(e instanceof $b.DirectionalLight){if(K+=1,!e._visible)continue;if(e.direction?S.copy(e.direction):(S.copy(e.worldMatrix.getPosition()),S.sub(e.target.worldMatrix.getPosition())),S.normalize(),0===S.x&&0===S.y&&0===S.z)continue;O=3*G,t[O]=S.x,t[O+1]=S.y,t[O+2]=S.z,this.gammaInput?o(s,O,f,i*i):n(s,O,f,i),G+=1}else if(e instanceof $b.PointLight){if(L+=1,!e._visible)continue;P=3*H,this.gammaInput?o(u,P,f,i*i):n(u,P,f,i),k=e.worldMatrix.getPosition(),v[P]=k.x,v[P+1]=k.y,v[P+2]=k.z,w[H]=l,H+=1}else if(e instanceof $b.SpotLight){if(M+=1,!e._visible)continue;Q=3*I,this.gammaInput?o(x,Q,f,i*i):n(x,Q,f,i),k=e.worldMatrix.getPosition(),y[Q]=k.x,y[Q+1]=k.y,y[Q+2]=k.z,z[I]=l,S.copy(k),S.sub(e.target.worldMatrix.getPosition()),S.normalize(),A[Q]=S.x,A[Q+1]=S.y,A[Q+2]=S.z,B[I]=Math.cos(e.angle),C[I]=e.exponent,I+=1}else if(e instanceof $b.HemisphereLight){if(N+=1,!e._visible)continue;if(S.copy(e.worldMatrix.getPosition()),S.normalize(),0===S.x&&0===S.y&&0===S.z)continue;R=3*J,F[R]=S.x,F[R+1]=S.y,F[R+2]=S.z,g=e.color,h=e.groundColor,this.gammaInput?(j=i*i,o(D,R,g,j),o(E,R,h,j)):(n(D,R,g,i),n(E,R,h,i)),J+=1}for(c=3*G,d=Math.max(s.length,3*K);d>c;c++)s[c]=0;for(c=3*H,d=Math.max(u.length,3*L);d>c;c++)u[c]=0;for(c=3*I,d=Math.max(x.length,3*M);d>c;c++)x[c]=0;for(c=3*J,d=Math.max(D.length,3*N);d>c;c++)D[c]=0;for(c=3*J,d=Math.max(E.length,3*N);d>c;c++)E[c]=0;r.directional.length=G,r.point.length=H,r.spot.length=I,r.hemi.length=J,r.ambient[0]=m,r.ambient[1]=p,r.ambient[2]=q},$b.ProgramManagerId=0;var yc=function(a,b,c){this.width=a,this.height=b,c=c||{},this.wrapS=c.wrapS!==e?c.wrapS:$b.ClampToEdgeWrapping,this.wrapT=c.wrapT!==e?c.wrapT:$b.ClampToEdgeWrapping,this.magFilter=c.magFilter!==e?c.magFilter:$b.LinearFilter,this.minFilter=c.minFilter!==e?c.minFilter:$b.LinearMipMapLinearFilter,this.anisotropy=c.anisotropy!==e?c.anisotropy:1,this.offset=new $b.Vec2(0,0),this.repeat=new $b.Vec2(1,1),this.format=c.format!==e?c.format:$b.RGBAFormat,this.type=c.type!==e?c.type:$b.UnsignedByteType,this.depthBuffer=c.depthBuffer!==e?c.depthBuffer:!0,this.stencilBuffer=c.stencilBuffer!==e?c.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null,this.flipY=!0};yc.prototype={constructor:yc,clone:function(){var a=new yc(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.format=this.format,a.type=this.type,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a.generateMipmaps=this.generateMipmaps,a.shareDepthFrom=this.shareDepthFrom,a},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var zc=function(a,b,c){yc.call(this,a,b,c),this.activeCubeFace=0};$b.extend(zc,yc,{}),$b.Network3D=function(a,b,c,f){$b.Element.call(this);var g=this;this.id=$b.Network3DId++,this._interactionDispatcher=new $b.EventDispatcher,f=f||{},this.helperBox=new $b.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=dc.createView("hidden"),this._canvas=c=this.initCanvas(c),this._topCanvas=dc.createCanvas(this),this._bottomCanvas=dc.createCanvas(this);var h=this._canvas.parentNode;h&&(h.removeChild(this._canvas),h.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=b||new $b.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=f.clearColor!==e?f.clearColor:new $b.Color(16777215),this._clearAlpha=f.clearAlpha!=e?f.clearAlpha:1,this._precision=f.precision!==e?f.precision:"mediump",this.__fog=new $b.FogExp2,this.devicePixelRatio=f.devicePixelRatio!==e?f.devicePixelRatio:d.devicePixelRatio!==e?d.devicePixelRatio:1,this._premultipliedAlpha=null==f.premultipliedAlpha?!0:f.premultipliedAlpha,this.lightIntensityRatio=1,ec.isIOS||ec.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1,this.lightIntensityRatio=.1):(this._preserveDrawingBuffer=null==f.preserveDrawingBuffer?!0:f.preserveDrawingBuffer,this._antialias=f.antialias==e?!0:f.antialias),this._useWebgl2=f.useWebgl2||!1,c.addEventListener("webglcontextlost",function(a){console.log("webgl context lost"),a.preventDefault(),g._animateId&&((g._vrDisplay&&g._vrDisplay.isPresenting?g._vrDisplay:d).cancelAnimationFrame(g._animateId),g._animateId=null)}),c.addEventListener("webglcontextrestored",function(a){console.log("webgl context restored"),g._currentProgram=null,g.billboardRenderer=null,g.pm.dispose(),_c.clear(),g._enabledAttributes={},g._currentGroupHash=null,g._oldLineWidth=null,g.gpu=new $b.GPU(g),g.pm=new $b.ProgramManager(g),g.setDefaultGLState(),g.dirtyNetwork(),g._clearNodeCache(),p(g)}),this._gl=this.initGL(),this._currentProgram=null,this.overrideMaterial=null,this._maxLights=f.maxLights!==e?f.maxLights:4,this._projScreenMatrix=new cc,this._projScreenMatrixPS=new cc,this._frustum=new $b.Frustum,this._vector3=new ac,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new $b.GPU(this),this.pm=new $b.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=$b.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new $b.Projector,this.up=new $b.Vec3(0,1,0),this.position=new $b.Vec3(0,0,0),this.seletionMaterial=new $b.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new $b.Color(65280),this.selectionCube=new sc,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new cc,this.selectionCube._normalMatrix=new bc,this.selectionCube.name="select",this.alarmMaterial=new $b.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new $b.Color(16711680),this.alarmCube=new sc,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new cc,this.alarmCube._normalMatrix=new bc,this.alarmCube.name="alarm";var i=512;this._glowSurface=new $b.Plane(2,2),this._glowSurface2=new $b.Plane(i,i),this._glowSurface.target=new yc(i,i,{type:$b.UnsignedByteType}),this._glowSurface.target1=new yc(i,i,{type:$b.UnsignedByteType}),this._glowSurface.target2=new yc(i,i,{type:$b.UnsignedByteType}),this._glowSurfaceMaterial=new $b.BlurMaterial,this._blurMaterialH=new $b.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new $b.BlurMaterial,this.deferredPostionMaterial=new $b.DeferredMaterial,this.deferredNormalMaterial=new $b.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new $b.SSAOMaterial,this.ssaoMaterial.map2=new $b.Texture(nc.ssaoNormalImage);var j=1024;this.deferredPostionTarget=new yc(j,j,{type:$b.FloatType,magFilter:$b.NearestFilter,minFilter:$b.NearestFilter}),this.deferredNormalTarget=new yc(j,j,{type:$b.FloatType,magFilter:$b.NearestFilter,minFilter:$b.NearestFilter,format:$b.RGBFormat}),this.ssaoTarget=new yc(j,j,{type:$b.FloatType,magFilter:$b.NearestFilter,minFilter:$b.NearestFilter}),this.ssaoTarget1=new yc(i,i,{type:$b.UnsignedByteType}),this.ssaoTarget2=new yc(i,i,{type:$b.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this.flareRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.normalNodeMap={},this.showAxis=!1,this.axisSize=20,this.axisPosition=new $b.Vec3(0,0,0),this.axis=new $b.Axis({size:this.axisSize}),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(a===e?new $b.DataBox:a),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=$b.PCFSoftShadowMap,this.shadowMapCullFace=$b.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0),this.getRootView().addEventListener("mousedown",function(a){g.handleMouseDown(a)}),this.getRootView().addEventListener("mouseup",function(a){g.handleClick(a)}),this.setInteractions([new $b.DefaultInteraction(this),new $b.SelectionInteraction(this)]),this.doubleClickToLookAtFunction=tc.doubleClickToLookAtFunction,p(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._pickingTexturePixel=!0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=tc.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},$b.extend($b.Network3D,$b.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","pickingTexturePixel","dynamicBatchDraw","showFps"],setUseFog:function(a){this._useFog=a,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(a){this._overloadMaterial=a},setFogColor:function(a){this.__fog.color=a},setFogDensity:function(a){this.__fog.density=a},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this.dataBox!==a){var b=this.dataBox;b&&(this._clearDataBox(b),b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),b.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),b.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=a,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",b,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()}},setRenderCallback:function(a){this.renderCallback=a},setBeforeRenderFunction:function(a){this.beforeRenderFunction=a},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(a){3==arguments.length?(this._clearColor=new $b.Color,this._clearColor.setRGB(arguments[0],arguments[1],arguments[2])):(this._clearColor=a,this._clearColor instanceof $b.Color||(this._clearColor=new $b.Color(a))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(a){this._clearAlpha=a,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(a){this._precesion=a},setSSAOBlur:function(a){this._ssaoBlur=a},setSSAOEnable:function(a){return a&&!this.isFloatTextureSupport()?!1:(this._sSAOEnable=a,this._dirty=!0,!0)},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(a){this._occluderBias=a,this._dirty=!0},setSSAOSamplingRadius:function(a){this._samplingRadius=a,this._dirty=!0},setSSAOAttenuation:function(a){this._attenuation=a,this._dirty=!0},isFloatTextureSupport:function(){return null!=this._glExtensionTextureFloat},getCamera:function(){return this._camera},setCamera:function(a,b){if(this._camera!=a){var c=this._camera;if(c.removePropertyChangeListener(this.dirtyNetwork),this._camera=a,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this.autoUpdateCameraAspect){this._camera.setAspect&&this._camera.setAspect(c.aspect);var d=this.getDefaultInteraction();d&&(d.object=this._camera)}b&&(this._camera.p(c.p()),this._camera.lookAt(c.getTarget())),this.dirtyNetwork()}},isVisible:function(a){if(a){if(a instanceof $b.Link||a instanceof $b.PathLink){if(!a.isVisible())return!1;if(!this.isVisible(a._fromNode))return!1;if(!this.isVisible(a._toNode))return!1}if(!a.isVisible())return!1;if(a._parent)return this.isVisible(a._parent);if(this.visibleFunction)return this.visibleFunction(a)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(a){return a===e?document.createElement("canvas"):("string"==typeof a&&(a=document.getElementById(a)),a)},initGL2:function(a){if(this._useWebgl2){var b=this._canvas.gl;if(!b)try{b=this._canvas.getContext("webgl2",a)||this._canvas.getContext("experimental-webgl2",a)}catch(c){console.log(c)}return b?(this.webglVersion=2,b):void(this.webglVersion=1)}},initGL:function(){var a={preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0},b=this.initGL2(a);if(b)return b;var c=this._canvas.gl;if(!c)try{c=this._canvas.getContext("webgl",a)||this._canvas.getContext("experimental-webgl",a)}catch(d){console.log(d)}return this._initVR(),c||console.error("Can not init webgl context"),this._glExtensionTextureFloat=c.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=c.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported."),c?c:void console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(a,b){var c=null;c=a===this.helperBox?this.helperGLNodeList:this.glNodeList;for(var d=c.length-1;d>=0;d--){c[d];c.splice(d,1)}c=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0);var e=this;b=b||a.getDatas(),b.forEach(function(a){e._clearNodeCache(a)}),this.deleteCloneNode()},handleDataBoxChange:function(a){var b=a.kind,c=a.data,d=a.source,e=null;e=d===this.helperBox?this.helperGLNodeList:this.glNodeList,"add"===b?c instanceof $b.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):c instanceof $b.Annotation?this._createAnnotationDiv(c):(this.addNodeMaterials(c),this.addNode(c,e),c._alarmBillboard&&this.alarmBillboards.push(c._alarmBillboard)):"remove"===b?c instanceof $b.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):c instanceof $b.Annotation?this._removeAnnotationDiv(c):(this.removeNode(c,e),this.deleteCloneNode(c)):"clear"===b&&this._clearDataBox(d,a.datas),this.boundingBox=null,this.shadowMapRenderer&&this.shadowMapRenderer.handleDataBoxChange(a),this.dirtyNetwork()},removeNode:function(a,b){for(var c=b.length-1;c>=0;c--){var d=b[c];d.node===a&&b.splice(c,1)}this._clearNodeCache(a)},_clearNodeCache:function(a){if(a){if(a.oldGroups=a.groups||a.oldGroups,null!=a.oldGroups)for(var b in a.oldGroups){var c=a.oldGroups[b],d=this.groupCountMap[c.id];null!=d&&(d--,0>=d?(delete this.groupCountMap[c.id],delete this.groupMap[c.id]):this.groupCountMap[c.id]=d)}for(var e=0;e<this.alarmBillboards.length;e++){var f=this.alarmBillboards[e];f.getParent()===a&&(this.alarmBillboards.splice(e,1),e--)}a instanceof $b.Annotation&&this._removeAnnotationDiv(a)}else{for(var g in this.groupMap){var h=this.groupMap[g],i=h._nodeId;this.helperBox.containsById(i)||delete this.groupMap[g]}this.alarmBillboards.splice(0),this.glNodeList=[]}for(var g in this._annotationMap)this._removeAnnotationDiv(g)},addNode:function(a,b){for(var c=this.addWebGLNode(b,a),d=0;d<c.length;d++){var e=c[d];this.updateWebGLNode(e)}},addNodeMaterials:function(a){var b,c=a.material;if(c instanceof $b.Material)this.addMaterial(c);else if(c instanceof $b.ArrayMaterial){var d=c.materials,e=d.length;for(b=0;e>b;b++)this.addMaterial(d[b])}},addMaterial:function(a){this.pm.addMaterial(a),a.map&&this.pm.addTexture(a.map)},handleDataPropertyChange:function(a){var b=a.source;if(b instanceof $b.Node){var c=a.property;if(b.isSizeChangedProperty(c)||c===$b.Styles.MaterailType||c===$b.Styles.NormalType){if(b instanceof $b.Line){b.verticesNeedUpdate=!0;var d=this.lineMap[b._id];this.initLineBuffers(b),ic.buildLineBufferData(b,this._gl.DYNAMIC_DRAW,this._gl,d)}else if(b.groups){b.verticesNeedUpdate=!0,(c===$b.Styles.MaterailType||c===$b.Styles.NormalType)&&(b.normalsNeedUpdate=!0);for(var e in b.groups){var f=b.groups[e],d=this.groupMap[f.id],g=ic.getMaterial(b,f.materialIndex);b.normalsNeedUpdate&&this.initGroupBuffer(b,f,d,!0),ic.buildGroupBufferData(f,b,this._gl.DYNAMIC_DRAW,!b.dynamic,g,this._gl,d,this)}}}else if("materialMapping"===c)this._currentGroupHash=null,this.removeNode(b,this.glNodeList),this.addNode(b,this.glNodeList);else if("alarmBillboard"===c){var h=a.oldValue,i=a.newValue;this._addNodeAlarmBillboard(b,h,i)}this.addNodeMaterials(b)}else b instanceof $b.Light&&(this.pm._lightNeedsUpdate=!0);(b.isSizeChangedProperty&&b.isSizeChangedProperty(c)||"parent"==c||b.isSpaceChangedProperty(c))&&(this.deleteCloneNode(b),this.boundingBox=null),this.shadowMapRenderer&&this.shadowMapRenderer.handleDataPropertyChange(a),this.dirtyNetwork()},deleteCloneNode:function(a){if(a){var b=a.getId?a.getId():a,c=this.normalNodeMap[b];if(null!=c){c.setParent(null);for(var d in c.groups){var e=c.groups[d];delete this.groupMap[e.id]}}delete this.normalNodeMap[b]}else for(var b in this.normalNodeMap)this.deleteCloneNode(b)},setBlurAmount:function(a){this._blurAmount=a},setBlurScale:function(a){this._blurScale=a},setBlurStrength:function(a){this._blurStrength=a},setBlurGlobalAlpha:function(a){this._blurGlobalAlpha=a},dirtyNetwork:function(a){this.dataBox.batch||(this._dirty=!0)},dirtyShadowMap:function(a){this.shadowMapRenderer&&this.shadowMapRenderer.dirtyShadowMap()},_addNodeAlarmBillboard:function(a,b,c){if(c===e&&(c=a._alarmBillboard),null!=b&&-1!==this.alarmBillboards.indexOf(b)){var d=this.alarmBillboards.indexOf(b);this.alarmBillboards.splice(d,1),b.removePropertyChangeListener(this.dirtyNetwork,this)}c&&-1===this.alarmBillboards.indexOf(c)&&(this.alarmBillboards.push(c),c.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(a,b){var c,d,e=a.getNodes();for(c=0,d=e.size();d>c;c++){var f=e.get(c);f.renderSelected=!1,this.addWebGLNode(b,f)}for(c=0,d=b.length;d>c;c++)this.updateWebGLNode(b[c])},updateWebGLNode:function(a){var b,c,d=a.node;if(d instanceof $b.Entity){for(var e in d.groups)if(b=d.groups[e],c=ic.getMaterial(d,b.materialIndex),d.buffersNeedUpdate){var f=this.groupMap[b.id];this.initGroupBuffer(d,b,f),ic.buildGroupBufferData(b,d,this._gl.DYNAMIC_DRAW,!d.dynamic,c,this._gl,f,this)}d.setUpdateFlags(!1),d.buffersNeedUpdate=!1}else if(d instanceof $b.BufferNode)this.setBufferNodeData(d,this._gl.DYNAMIC_DRAW,!d.dynamic);else if(d instanceof $b.Line){var f=this.lineMap[d._id];ic.buildLineBufferData(d,this._gl.DYNAMIC_DRAW,this._gl,f)}else if(d instanceof $b.Particle){var f=this.particleMap[d._id];kc(d,this._gl.DYNAMIC_DRAW,this._gl,f)}},addWebGLNode:function(a,b){var c,d,f,g,h=[];if(this._addNodeAlarmBillboard(b),b._modelViewMatrix=new cc,b._normalMatrix=new bc,b instanceof $b.Entity){b.groups==e&&jc(b);for(c in b.groups){d=b.groups[c],d.id=d.id===e?$b.Network3D.GroupCache._groupCounter++:d.id;var i=this.groupCountMap[d.id]||0;i++,this.groupCountMap[d.id]=i,this.groupMap[d.id]===e&&(this.groupMap[d.id]={});var j=this.groupMap[d.id];j._nodeId=b.getId(),j.__webglVertexBuffer||(this.createGroupBuffer(d,j),this.initGroupBuffer(b,d,j),b.setUpdateFlags(!0))}}else if(b instanceof $b.Line){null==this.lineMap[b._id]&&(this.lineMap[b._id]={});var j=this.lineMap[b._id];j._nodeId=b.getId(),j.__webglVertexBuffer||(this.createLineBuffers(b),this.initLineBuffers(b),b.verticesNeedUpdate=!0,b.colorsNeedUpdate=!0,b.lineDistancesNeedUpdate=!0)}else if(b instanceof $b.Particle){null==this.lineMap[b._id]&&(this.lineMap[b._id]={});var j=this.lineMap[b._id];j._nodeId=b.getId(),j.__webglVertexBuffer||(this.createParticleBuffers(b),this.initParticleBuffers(b),b.verticesNeedUpdate=!0,b.colorsNeedUpdate=!0)}else b instanceof $b.BufferNode?this.initBufferNode(b):b instanceof $b.Annotation&&this._createAnnotationDiv(b);if(b instanceof $b.Entity){for(c in b.groups)d=b.groups[c],f=ic.getMaterial(b,d.materialIndex),g={group:d,node:b,opaque:f.transparent?null:f,transparent:f.transparent?f:null},a.push(g),h.push(g);null===b.groups}else b instanceof $b.Line||b instanceof $b.LensFlare?(f=b.material,g={group:b,node:b,opaque:f.transparent?null:f,transparent:f.transparent?f:null},a.push(g),h.push(g)):b instanceof $b.Particle?(f=b.material,g={group:b,node:b,opaque:f.transparent?null:f,transparent:f.transparent?f:null},a.push(g),h.push(g)):b instanceof $b.BufferNode&&(f=b.material instanceof $b.ArrayMaterial?b.material.materials[0]:b.material,g={group:b,node:b,opaque:f.transparent?null:f,transparent:f.transparent?f:null},a.push(g),h.push(g));return b.glActive=!0,h},onElementDispose:function(a){var b=a.target;b.removeEventListener("dispose",this.onElementDispose),deallocateElement(b),this.info.memory.geometries--},deallocateElement:function(a){},_AK47:function(a,b,c,d,f,g){this._fog;a.parent===e&&a.updateWorldMatrix(!0,!1),!this._isPresenting&&a.worldMatrixInverse.getInverse(a.worldMatrix),this._projScreenMatrix.multiply(a.projectionMatrix,a.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),0===c.length&&(this.initWebGLNodes(b,c),this.prepareData());var h,i,j,k;if(!g)for(h=0,i=c.length;i>h;h++)j=c[h],k=j.node,k.renderSelected=!1,j.render=!1,this.isVisible(k)&&(this.unrollBufferMaterial(j),this.setupMatrices(k,a),(k instanceof $b.Entity||k instanceof $b.Particle)&&k.frustumCulled&&!this._frustum.intersectsObject(k)||(j.render=!0,this.sortNodes&&(this._vector3.copy(k.worldMatrix.getPosition()),this._vector3.applyProjection(this._projScreenMatrix),null!=k.renderDepth?j.z=k.renderDepth+this._vector3.z:j.z=this._vector3.z)));var l=new mc;if(l.addAll(d),!f&&!g){for(var m=this.alarmBillboards.length-1;m>=0;m--){var n=this.alarmBillboards[m];null==n.getParent()&&this.alarmBillboards.splice(m,1)}l.addAll(this.alarmBillboards)}var o=this;!g&&l.forEach(function(a){a.renderDepth?a.z=a.renderDepth:(o._vector3.copy(a.worldMatrix.getPosition()),o._vector3.applyProjection(o._projScreenMatrix),a.z=o._vector3.z)}),l.size()>0&&!g&&null==this.billboardRenderer&&(this.billboardRenderer=new $b.BillboardRenderer);var p=b.getLensFlares();p.size()>0&&!g&&null==this.flareRenderer&&(this.flareRenderer=new $b.FlareRenderer);var q=[].concat(c).concat(l._as),r=this.sortNodesFunc(q);this.setBlending($b.NoBlending),this.renderNodes(r,!1,"opaque",a,b.getLights(),!1,null,g,this.sortOpaqueOrderByMaterial),this.renderNodes(r,!0,"transparent",a,b.getLights(),!0,null,g),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(a){var b,c,d,e=a.node,f=a.group;d=e.material,d instanceof $b.ArrayMaterial?(c=f.materialIndex||0,b=d.materials[c],b.transparent?(a.transparent=b,a.opaque=null):(a.opaque=b,a.transparent=null)):(b=d,b&&(b.transparent?(a.transparent=b,a.opaque=null):(a.opaque=b,a.transparent=null)))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(this.maxShadows>0||this.maxPointShadows>0)},render:function(){if(this._dirty&&(this.resetRenderInfo(),this._dirty=!1,null!=this.beforeRenderFunction&&this.beforeRenderFunction.call(this),!this.isShadowable()||(this.shadowMapRender(),this.setRenderTarget(e),!this.debugPointLight))){if(Tc.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas(),this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var a=this._topCanvas.getContext("2d"),b=(1e3/this._tpf).toFixed(0);b>500&&(b="> 500");var c="FPS:"+b+",TPF:"+this._tpf+" ms";a.font="20px Arial sans-serif",a.fontWeight="bold",a.lineWith=2,a.fillStyle="rgba(0, 0, 0, 1)",a.fillText(c,10,25)}if(this._xyz!=e){var d,f=this._xyz,g=f.markText,h=f.type,c=(f.expired,f.innerHTML),i=0,j=0,a=(this._topCanvas.getBoundingClientRect(),this._topCanvas.getContext("2d"));g!=e&&null!=g&&""!=g||"2"==h?(a.font="24px Arial sans-serif",d=hc.getTextSize(a.font,c),a.fillStyle="red",i=this._canvas.width-d.width-20,j=this._canvas.height-d.height-10):(a.font="15px Arial sans-serif",a.fillStyle="rgba(240, 120, 25, 0.6)",d=hc.getTextSize(a.font,c),i=this._canvas.width-d.width-20,j=this._canvas.height-d.height-10),a.fillText(c,i,j)}null!=this.renderCallback&&this.renderCallback.call(this)}},getTextSize:function(a,b){return hc.getTextSize(a,b)},shadowMapRender:function(){null==this.shadowMapRenderer&&(this.shadowMapRenderer=new bd,this.shadowMapRenderer.init(this)),0===this.glNodeList.length&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(a){var b=a.target;this.lastX=a.clientX,this.lastY=a.clientY,"tgl_annotation"==b.getAttribute("class")&&"1"==b.style.opacity&&(a.stop=!0,a.stopPropagation())},handleClick:function(a){var b=a.clientX-this.lastX,c=a.clientY-this.lastY;if(Math.abs(b)<.1&&Math.abs(c)<.1){var d=a.target;if("tgl_annotation"!=d.getAttribute("clazz"))this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if("1"==d.style.opacity){var e=d.getAttribute("id"),f=this.getDataBox().getDataById(e),g=this._annotationMap[e];this.handleDefaultAnnotationClick(f,g),this.handleAnnotationClick(f,g),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(a,b){this._activeAnnotation!=a&&(this._activeAnnotation=a)},handleAnnotationClick:function(a,b){},renderAnnotations:function(a){var b=this.dataBox.getAnnotations(),c=this;if(b&&(b.forEach(function(b){c.renderAnnotation(a,b)}),this._createAnnotationStyle()),this._activeAnnotation){this._createAnnotationToolTipDiv();var d=this._annotationToolTipDiv;d.innerHTML=this._activeAnnotation.getText();var e=this._annotationMap[this._activeAnnotation.getId()];d.parentNode!=e&&e.appendChild(d),d.style.opacity=e.style.opacity}},getAnnotationDiv:function(a){return this._annotationMap[a.getId()]},renderAnnotation:function(a,b){var c=this._annotationMap[b.getId()];null==c&&(c=this._createAnnotationDiv(b)),c.innerHTML=b._label,b.updateWorldMatrix();var d=b.worldMatrix.getPosition(),e=b.getStyle("annotation.class");c.setAttribute("class",e);var f=this.getViewPosition(d);this._annotationToolTipDiv;c.style.left=f.x+"px",c.style.top=f.y+"px",c.style.opacity="1";var g=d.distanceTo(a.getPosition()),h=this.getElementByScreenPoint(f,!1);if(h&&h.length>0){var i=h[0];i.distance<g&&(c.style.opacity="0.03")}},_addCSSRule:function(a,b,c,d){d=d||(a.cssRules||a.rules).length,a.insertRule?a.insertRule(b+"{"+c+"}",d):a.addRule&&a.addRule(b,c,d)},_createAnnotationStyle:function(){if(!this._annotationStyle){var a=document.createElement("style");a.appendChild(document.createTextNode("")),document.head.appendChild(a);var b=a.sheet;this._addCSSRule(b,".tgl_annotation","position:absolute;width:16px;height:16px;border-radius:10px;text-align:center;border : 2px solid gray;"),this._addCSSRule(b,".tgl_annotation:hover","border : 2px solid black;"),this._annotationStyle=a}},_removeAnnotationDiv:function(a){var b=a.getId?a.getId():a,c=this._annotationMap[b];null!=c&&this.getRootView().removeChild(c)},_createAnnotationDiv:function(a){var b=document.createElement("div"),c=a.getStyle("annotation.class");return b.setAttribute("id",a.getId()),b.setAttribute("class",c),b.setAttribute("clazz","tgl_annotation"),this._annotationMap[a.getId()]=b,this.getRootView().appendChild(b),b},_createAnnotationToolTipDiv:function(){if(null==this._annotationToolTipDiv){var a=document.createElement("div");a.setAttribute("class","tgl_annotation_tooltip");var b=document.createElement("style");b.appendChild(document.createTextNode("")),document.head.appendChild(b);var c=b.sheet,d="position: absolute;border: 3px solid #333; background-color: #ccd; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(c,".tgl_annotation_tooltip",d),d="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(c,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",d),d="border-color: #333 transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(c,".tgl_annotation_tooltip:before",d),d="border-color: #ccd transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(c,".tgl_annotation_tooltip:after",d),this._annotationToolTipDiv=a}},extendRender:function(a){},innerRender:function(a,b){if(a===e&&(a=this._camera),null===a)return void console.log(" no camera");if(this.debug&&console.log("inner Render"),(!this._vrDisplay||!this._vrDisplay.isPresenting)&&this.autoClear){
var c=this._clearColor;this._gl.clearColor(c.r,c.g,c.b,this._clearAlpha),xc.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(b)for(var d=0;d<this._interactions.length;d++){var f=this._interactions[d];f.update&&f.update()}if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),this._vrDisplay||this._gl.viewport(0,0,this._canvas.width,this._canvas.height),this._sSAOEnable){this.linearDepth=a.far-a.near,this.ssaoing=!0,this._renderDeferredTarget(a,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(a,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(a,this.ssaoTarget,this.ssaoMaterial);var g=this._canvas.width/this._canvas.height;this._ssaoBlur?(this._renderBlurTarget(a,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,g),this._renderBlurTarget(a,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,g),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(e),this.ssaoing=!1}if(this.renderOutline=!1,this.renderOutlineGlow=!1,xc.enableStencil(this._gl),this._baseRender=!0,xc.r(this,a,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,xc.stencilTest(this._gl),this.renderOutline&&xc.r(this,a,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil"),this.renderOutlineGlow){var h=this._glowSurface.target,i=this._glowSurface.target1,j=this._glowSurface.target2;xc.disableStencil(this._gl),this.setRenderTarget(h),h._id=h._id||(new Date).getTime()+"0",i._id=i._id||(new Date).getTime()+"1",j._id=j._id||(new Date).getTime()+"2",this._gl.viewport(0,0,h.width,h.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),xc.r(this,a,this.dataBox,this.glNodeList,[],!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),xc.r(this,a,this.dataBox,this.glNodeList,[],!1,"glow.select");var k,l;this.setRenderTarget(i),this._gl.viewport(0,0,i.width,i.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(h);var g=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new _b(h.width,h.height/g),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1;for(k in this._glowSurface.groups)l=this._glowSurface.groups[k],this.renderGroup(a,[],this._blurMaterialH,l,this._glowSurface2);this.setRenderTarget(j),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(i),this._blurMaterialV.texelSize=new _b(i.width,i.height/g),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0;for(k in this._glowSurface.groups)l=this._glowSurface.groups[k],this.renderGroup(a,[],this._blurMaterialV,l,this._glowSurface2);this.setRenderTarget(e),this._glowSurface._modelViewMatrix=new cc,this._glowSurface._normalMatrix=new bc,this.setupMatrices(this._glowSurface,a),this._glowSurfaceMaterial.setMap(j),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,xc.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(k in this._glowSurface.groups)l=this._glowSurface.groups[k],this.renderGroup(a,[],this._glowSurfaceMaterial,l,this._glowSurface);this.setRenderTarget(i),this._gl.viewport(0,0,i.width,i.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(h);var g=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new _b(h.width,h.height/g),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0;for(k in this._glowSurface.groups)l=this._glowSurface.groups[k],this.renderGroup(a,[],this._blurMaterialH,l,this._glowSurface2);this.setRenderTarget(j),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(i),this._blurMaterialV.texelSize=new _b(i.width,i.height/g),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1;for(k in this._glowSurface.groups)l=this._glowSurface.groups[k],this.renderGroup(a,[],this._blurMaterialV,l,this._glowSurface2);this.setRenderTarget(e),this._glowSurface._modelViewMatrix=new cc,this._glowSurface._normalMatrix=new bc,this.setupMatrices(this._glowSurface,a),this._glowSurfaceMaterial.setMap(j),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,xc.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(k in this._glowSurface.groups)l=this._glowSurface.groups[k],this.renderGroup(a,[],this._glowSurfaceMaterial,l,this._glowSurface);this._gl.clearColor(0,0,0,0)}xc.disableStencil(this._gl),this.renderHelper(a)},_renderDeferredTarget:function(a,b,c,d){d=d||new $b.Vec4(0,0,0,0,0),b.linearDepth=this.linearDepth,this.setRenderTarget(c),this._overloadMaterial=b,this._gl.clearColor(d.x,d.y,d.z,d.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),xc.r(this,a,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(a,b,c,d,e){clearColor=clearColor||new $b.Vec4(0,0,0,0,0),this.setRenderTarget(d),this._gl.viewport(0,0,d.width,d.height),this._gl.clearColor(clearColor.x,clearColor.y,clearColor.z,clearColor.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),b.setMap(c),b.texelSize=new _b(c.width,c.height/e),b.blurAmount=this._blurAmount||5,b.blurScale=this._blurScale||1,b.blurStrength=this._blurStrength||1;var f,g;for(f in this._glowSurface.groups)g=this._glowSurface.groups[f],this.renderGroup(a,[],b,g,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new _b(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new _b(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(a,b,c,d){d=d||new $b.Vec4(1,1,1,1),this.setRenderTarget(b),this._gl.clearColor(d.x,d.y,d.z,d.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new cc,this._glowSurface._normalMatrix=new bc,this.setupMatrices(this._glowSurface,a);var e,f;for(f in this._glowSurface.groups)e=this._glowSurface.groups[f],this.renderGroup(a,[],c,e,this._glowSurface)},renderHelper:function(a){xc.r(this,a,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){this._glowSurface.setUpdateFlags(!0),jc(this._glowSurface);for(var a in this._glowSurface.groups){var b=this._glowSurface.groups[a];b.id=b.id===e?$b.Network3D.GroupCache._groupCounter++:b.id,this.groupMap[b.id]===e&&(this.groupMap[b.id]={});var c=this.groupMap[b.id];this.createGroupBuffer(b,c),this.initGroupBuffer(this._glowSurface,b,c),ic.buildGroupBufferData(b,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,c,this)}this._glowSurface2.setUpdateFlags(!0),jc(this._glowSurface2);for(var a in this._glowSurface2.groups){var b=this._glowSurface2.groups[a];b.id=b.id===e?$b.Network3D.GroupCache._groupCounter++:b.id,this.groupMap[b.id]===e&&(this.groupMap[b.id]={});var c=this.groupMap[b.id];this.createGroupBuffer(b,c),this.initGroupBuffer(this._glowSurface2,b,c),ic.buildGroupBufferData(b,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,c,this)}},getOutlineMaterial:function(a,b){var c=(b.getStyle("select.width")||1)+1+" "+new $b.Color(b.getStyle("select.color")).getUniqueCode()+a,d=this.outlineMaterialMap[c];return null==d&&(d=new $b.EntityMaterial,"outline.normal"==a?(d._type="outline",d.outline=b.getStyle("select.width")||1):"outline.glow"==a?d._type="basic":(d.wireframe=!0,d.wireframeLinewidth=(b.getStyle("select.width")||1)+1),d.color=new $b.Color(b.getStyle("select.color")),this.outlineMaterialMap[c]=d),d},renderNodes:function(a,b,c,d,e,f,g,h,i){if("glow.unselect"!==h||!f){var j,k,l,m,n,o,p;b?(n=a.length-1,o=-1,p=-1):(n=0,o=a.length,p=1);for(var q=n;q!==o;q+=p)if(j=a[q],m=j.node?j.transparent||j.opaque:j.material){this._overloadMaterial&&(m=this._overloadMaterial);var r=this.getOverLoadMaterial(j.node?j.node:j,m);if(r){var s=r.getUniqueCode(),t=_c.getMaterial(s);t?m=t:(_c.setMaterial(s,r),m=r)}if(!("opaque"==c&&1==m.transparent||"transparent"==c&&0==m.transparent)){if(f?(xc.setBlending(m.blendMode,m.blendEquation,m.blendSrc,m.blendDst,this),xc.setDepthWrite(!1,this)):xc.setDepthWrite(m.depthMask,this),j instanceof $b.Billboard){var u=j.material.transparent?"transparent":"opaque";c==u&&this.billboardRenderer.render(this,[j],d,2*this._canvas.width,2*this._canvas.height,r)}else if(j.render){if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),k=j.node,l=j.group,xc.setDepthTest(m.depthTest,this),xc.setPolygonOffset(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits,this),this.setGLFaces(m),k instanceof $b.Particle){if(k.verticesNeedUpdate||k.colorsNeedUpdate||k.sortParticles){var v=this.particleMap[k._id];kc(k,this._gl.DYNAMIC_DRAW,this._gl,v)}k.verticesNeedUpdate=!1,k.colorsNeedUpdate=!1}var w=this.getSelectStyle(k);if("outline"==w&&(w="outline.normal"),h?"glow.unselect"===h&&(k.isSelected()||(k instanceof $b.BufferNode?this.renderBufferNode(d,e,m,l,k):xc.g(this,d,e,m,l,k))):(!k.isSelected()||"outline.normal"!==w&&"outline.wireframe"!==w&&"outline.glow"!==w?this.setStencilTest(!1):(this.setStencilTest(!0),"outline.glow"===w?this.renderOutlineGlow=!0:this.renderOutline=!0),k instanceof $b.BufferNode?this.renderBufferNode(d,e,m,l,k):(this._gl.stencilMask(this._oldStencilTest?1:0),xc.g(this,d,e,m,l,k))),k.isSelected()&&this.renderSelect(k))if("outline.normal"===w||"outline.wireframe"===w||"outline.glow"===w){if(null!=h&&"glow.unselect"!=h)if("outline.normal"===w){if(k.renderSelected===!1){var x=this.getOutlineMaterial(w,k),y=this.normalNodeMap[k.getId()];if(null==y){var y=this.cloneNode(k,x);this.normalNodeMap[k.getId()]=y}this.setupMatrices(y,d);for(var z in y.groups)xc.g(this,d,e,x,y.groups[z],y);k.renderSelected=!0}}else if("outline.normal"!==w){var x=this.getOutlineMaterial(w,k);xc.g(this,d,e,x,l,k)}}else k.renderSelected===!1&&(this.renderNodeSelection(d,e,k),k.renderSelected=!0);k instanceof $b.LensFlare&&this.flareRenderer&&this.flareRenderer.render(this,[j],d,2*this._canvas.width,2*this._canvas.height),k.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(k)&&this.renderNodeAlarm(d,e,k)}k&&k.setUpdateFlags(!1)}}}},cloneNode:function(a,b){var c,d,e=new $b.Entity,f={vertices:[],uvs:[],faces:[]};for(c=0,d=a.vertices.length;d>c;c++)f.vertices.push(a.vertices[c].clone());for(c=0,d=a.faces.length;d>c;c++)f.faces.push(a.faces[c].clone());for(c=0,d=a.uvs.lenght;d>c;c++){for(var g=uvs[c],h=[],i=0;g>i;i++)h.push(g[i].clone());f.uvs.push(h)}return $b.Node.prototype.mergeVertices.call(f),$b.Node.prototype.computeFaceNormals.call(f),$b.Node.prototype.computeVertexNormals.call(f,!0),e.setPosition(a.getPosition()),e.setScale(a.getScale()),e.setRotation(a.getRotation()),e.setParent(a.getParent()),e._modelViewMatrix=new cc,e._normalMatrix=new bc,e.data=f,e.vertices=f.vertices,e.uvs=f.uvs,e.faces=f.faces,e.material=b,e.primitive=new $b.Primitive(f),e.setUpdateFlags(!0),jc(e),this.buildNodeBufferData(e),e},buildNodeBufferData:function(a){for(var b in a.groups){var c=a.groups[b];c.id=c.id===e?$b.Network3D.GroupCache._groupCounter++:c.id,this.groupMap[c.id]===e&&(this.groupMap[c.id]={});var d=this.groupMap[c.id];this.createGroupBuffer(c,d),this.initGroupBuffer(a,c,d),ic.buildGroupBufferData(c,a,this._gl.DYNAMIC_DRAW,!1,a.material,this._gl,d,this)}},needSmoothNormal:function(a,b){var c=b.normalType;return c!=e?c===$b.NormalTypeSmooth:this.needSmoothNormalFunction?this.needSmoothNormalFunction(a):!1},renderNodeSelection:function(a,b,c){c.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,a);var d=this.selectionCube.groups;this.selectionCube.material.needsUpdate=!0;for(var f in d){var g=d[f];g.id=g.id===e?$b.Network3D.GroupCache._groupCounter++:g.id,this.groupMap[g.id]===e&&(this.groupMap[g.id]={});var h=this.groupMap[g.id];h.__webglVertexBuffer||(this.createGroupBuffer(g,h),this.initGroupBuffer(c,g,h)),this.selectionCube.setUpdateFlags(!0),ic.buildGroupBufferData(g,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,h,this),this.renderGroup(a,[],this.selectionCube.material,g,this.selectionCube)}},renderNodeAlarm:function(a,b,c){c.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,a);var d=this.alarmCube.groups;this.alarmCube.material.needsUpdate=!0;for(var f in d){var g=d[f];g.id=g.id===e?$b.Network3D.GroupCache._groupCounter++:g.id,this.groupMap[g.id]===e&&(this.groupMap[g.id]={});var h=this.groupMap[g.id];h.__webglVertexBuffer||(this.createGroupBuffer(g,h),this.initGroupBuffer(c,g,h)),this.alarmCube.setUpdateFlags(!0),ic.buildGroupBufferData(g,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,h,this),this.renderGroup(a,[],this.alarmCube.material,g,this.alarmCube)}},renderBufferNode:function(a,b,c,d,e,f){if(c.visible!==!1){var g,h;g=this.pm.setProgram(a,b,this._fog,c,d,e),h=g.attributes;var i=e,j=!1,k=c.wireframe?1:0,l=16777215*d._id+2*g.id+k;(l!==this._currentGroupHash||f)&&(this._currentGroupHash=l,j=!0),j&&this.disableAttributes();var m=this._gl,n=i.attributes.index,o=this.bufferNodeMap[e._id];if(n){var p=i.offsets;p.length>1&&(j=!0);for(var q=0,r=p.length;r>q;q++){var s=p[q].index;if(j){var t=i.attributes.position,u=t.itemSize;m.bindBuffer(m.ARRAY_BUFFER,o.position),this.enableAttribute(h.position),m.vertexAttribPointer(h.position,u,m.FLOAT,!1,0,s*u*4);var v=i.attributes.normal;if(h.normal>=0&&v){var w=v.itemSize;m.bindBuffer(m.ARRAY_BUFFER,o.normal),this.enableAttribute(h.normal),m.vertexAttribPointer(h.normal,w,m.FLOAT,!1,0,s*w*4)}var x=i.attributes.uv;if(h.uv>=0&&x){var y=x.itemSize;m.bindBuffer(m.ARRAY_BUFFER,o.uv),this.enableAttribute(h.uv),m.vertexAttribPointer(h.uv,y,m.FLOAT,!1,0,s*y*4)}var z=i.attributes.color;if(h.color>=0&&z){var A=z.itemSize;m.bindBuffer(m.ARRAY_BUFFER,o.color),this.enableAttribute(h.color),m.vertexAttribPointer(h.color,A,m.FLOAT,!1,0,s*A*4)}m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,o.index)}m.drawElements(m.TRIANGLES,p[q].count,m.UNSIGNED_SHORT,2*p[q].start),this.info.render.calls++,this.info.render.vertices+=p[q].count,this.info.render.faces+=p[q].count/3}}else{if(j){var t=i.attributes.position,u=t.itemSize;m.bindBuffer(m.ARRAY_BUFFER,t.buffer),this.enableAttribute(h.position),m.vertexAttribPointer(h.position,u,m.FLOAT,!1,0,0);var v=i.attributes.normal;if(h.normal>=0&&v){var w=v.itemSize;m.bindBuffer(m.ARRAY_BUFFER,v.buffer),this.enableAttribute(h.normal),m.vertexAttribPointer(h.normal,w,m.FLOAT,!1,0,0)}var x=i.attributes.uv;if(h.uv>=0&&x){var y=x.itemSize;m.bindBuffer(m.ARRAY_BUFFER,x.buffer),this.enableAttribute(h.uv),m.vertexAttribPointer(h.uv,y,m.FLOAT,!1,0,0)}var z=i.attributes.color;if(h.color>=0&&z){var A=z.itemSize;m.bindBuffer(m.ARRAY_BUFFER,z.buffer),this.enableAttribute(h.color),m.vertexAttribPointer(h.color,A,m.FLOAT,!1,0,0)}}var t=i.attributes.position;m.drawArrays(m.TRIANGLES,0,t.numItems/3),this.info.render.calls++,this.info.render.vertices+=t.numItems/3,this.info.render.faces+=t.numItems/3/3}}},getOverLoadMaterial:function(a,b){return null},renderGroup:function(a,b,c,d,e){if(null==c&&console.log("material is null"),c.visible!==!1){var f,g=this._gl;if(e instanceof $b.Entity?f=this.groupMap[d.id]:e instanceof $b.Line?f=this.lineMap[d._id]:e instanceof $b.Particle&&(f=this.particleMap[d._id]),null==f)return void(this.debug&&console.error("tempGroup for id:"+(d.id||d._id)+" is null,please check"));var h,i,j,k,l,m;if(h=this.pm.setProgram(a,b,this._fog,c,d,e)){i=h.attributes;var n,o=!1,p=c.wireframe?1:0;if(n=null!=d.id?16777215*d.id+2*h.id+p:d._id+""+(2*h.id+p),n!==this._currentGroupHash&&(this._currentGroupHash=n,o=!0),o&&this.disableAttributes(),o&&(f.__vao&&g.bindVertexArray(f.__vao),!f.__vao||f.__vao.dirty)){if(i.position>=0&&o&&(g.bindBuffer(g.ARRAY_BUFFER,f.__webglVertexBuffer),this.enableAttribute(i.position),g.vertexAttribPointer(i.position,3,g.FLOAT,!1,0,0)),f.__webglCustomAttributesList)for(l=0,m=f.__webglCustomAttributesList.length;m>l;l++)k=f.__webglCustomAttributesList[l],i[k.buffer.belongsToAttribute]>=0&&(g.bindBuffer(g.ARRAY_BUFFER,k.buffer),this.enableAttribute(i[k.buffer.belongsToAttribute]),g.vertexAttribPointer(i[k.buffer.belongsToAttribute],k.size,g.FLOAT,!1,0,0));i.color>=0&&(g.bindBuffer(g.ARRAY_BUFFER,f.__webglColorBuffer),this.enableAttribute(i.color),g.vertexAttribPointer(i.color,3,g.FLOAT,!1,0,0)),i.normal>=0&&(g.bindBuffer(g.ARRAY_BUFFER,f.__webglNormalBuffer),this.enableAttribute(i.normal),g.vertexAttribPointer(i.normal,3,g.FLOAT,!1,0,0)),i.uv>=0&&(g.bindBuffer(g.ARRAY_BUFFER,f.__webglUVBuffer),this.enableAttribute(i.uv),g.vertexAttribPointer(i.uv,2,g.FLOAT,!1,0,0)),i.uv2>=0&&(g.bindBuffer(g.ARRAY_BUFFER,f.__webglUV2Buffer),this.enableAttribute(i.uv2),g.vertexAttribPointer(i.uv2,2,g.FLOAT,!1,0,0)),i.lineDistance>=0&&(g.bindBuffer(g.ARRAY_BUFFER,f.__webglLineDistanceBuffer),this.enableAttribute(i.lineDistance),g.vertexAttribPointer(i.lineDistance,1,g.FLOAT,!1,0,0)),f.__vao&&(f.__vao.dirty=!1)}e instanceof $b.Entity?(c.wireframe?(this.setLineWidth(c.wireframeLinewidth),this._gl.lineJoin="round",o&&g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),g.drawElements(g.LINES,f.__webglLineCount,g.UNSIGNED_SHORT,0)):(o&&g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),g.drawElements(g.TRIANGLES,f.__webglFaceCount,g.UNSIGNED_SHORT,0)),this.info.render.calls++,this.info.render.vertices+=f.__webglFaceCount,this.info.render.faces+=f.__webglFaceCount/3):e instanceof $b.Line?(j=e.type===$b.LineStrip?g.LINE_STRIP:g.LINES,this.setLineWidth(c.linewidth),g.drawArrays(j,0,f.__webglLineCount),this.info.render.calls++):e instanceof $b.Particle?(g.drawArrays(g.POINTS,0,f.__webglParticleCount),this.info.render.calls++,this.info.render.points+=f.__webglParticleCount):e instanceof $b.Ribbon&&(g.drawArrays(g.TRIANGLE_STRIP,0,d.__webglVertexCount),this.info.render.calls++),f.__vao&&g.bindVertexArray(null)}}},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(a){a instanceof $b.Billboard&&a.material&&(a.opaque=a.material.transparent?null:a.material,a.transparent=a.material.transparent?a.material:null)},sortNodesFunc:function(a){if(this.sortNodes&&(null!==this.paintSortFunction||this.sortOpaqueOrderByMaterial)){var b=this;this.sortOpaqueOrderByMaterial?null==this.__st&&(this.__st=function(a,c){b.wrapBillboardMaterial(a),b.wrapBillboardMaterial(a);var d="opaque";if(a[d]&&c[d])return a[d].id-c[d].id;if(!a[d]&&c[d])return-1;if(a[d]&&!c[d])return 1;if(a.transparent&&c.transparent)return a.transparent.id-c.transparent.id;var e=a.node?a.node:a,f=c.node?c.node:c;return e.z=a.z,f.z=c.z,b.paintSortFunction?b.paintSortFunction(e,f):void 0}):null==this.__st&&(this.__st=function(a,c){if(a.transparent||c.transparent)return a.transparent&&c.transparent?a.transparent.id-c.transparent.id:a.transparent?-1:1;var d=a.node?a.node:a,e=c.node?c.node:c;return d.z=a.z,e.z=c.z,b.paintSortFunction?b.paintSortFunction(d,e):void 0}),a.sort(this.__st)}return a},renderNode:function(a,b){this.setupMatrices(a),a instanceof $b.Entity&&renderEntity(a)},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var b=this.areaPickingRect;b&&(a.beginPath(),a.lineStyle="#FFffff",a.rect(b.x,b.y,b.w,b.h),a.stroke()),this.renderLicense()},setBackgroundImage:function(a){if("string"==typeof a){var b=new Image;a.startsWith("data:image")||(b.crossOrigin="use-credentials"),b.src=a,this._backgroundImage=b;var c=this;b.onload=function(){c.dirtyNetwork()}}else this._backgroundImage=a,this.dirtyNetwork()},paintBottom:function(a){var b=a.getContext("2d");b.clearRect(0,0,a.width,a.height);var c=this._backgroundImage;c instanceof Image&&c.height&&b.drawImage(c,0,0,a.width,a.height)},initBufferNode:function(a){if(!this.bufferNodeMap[a._id]){var b={};this.bufferNodeMap[a._id]=b;var c,d,e,f=this._gl;for(c in a.attributes)e="index"===c?f.ELEMENT_ARRAY_BUFFER:f.ARRAY_BUFFER,d=a.attributes[c],b[c]=f.createBuffer(),f.bindBuffer(e,b[c]),f.bufferData(e,d.array,f.STATIC_DRAW)}},setBufferNodeData:function(a,b,c){var d=this.bufferNodeMap[a._id],f=a.attributes,g=f.index,h=f.position,i=f.normal,j=f.uv,k=f.color,l=(f.tangent,this._gl);if(a.elementsNeedUpdate&&g!==e&&(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,d.index),l.bufferData(l.ELEMENT_ARRAY_BUFFER,g.array,b)),a.verticesNeedUpdate&&h!==e&&(l.bindBuffer(l.ARRAY_BUFFER,d.position),l.bufferData(l.ARRAY_BUFFER,h.array,b)),a.normalsNeedUpdate&&i!==e&&(l.bindBuffer(l.ARRAY_BUFFER,d.normal),l.bufferData(l.ARRAY_BUFFER,i.array,b)),a.uvsNeedUpdate&&j!==e&&(l.bindBuffer(l.ARRAY_BUFFER,d.uv),l.bufferData(l.ARRAY_BUFFER,j.array,b)),a.colorsNeedUpdate&&k!==e&&(l.bindBuffer(l.ARRAY_BUFFER,d.color),l.bufferData(l.ARRAY_BUFFER,k.array,b)),c)for(var m in a.attributes);},initGroupBuffer:function(a,b,c,d){var e=this._gl,f=b.faces3,g=b.faces4,h=3*f.length+4*g.length,i=1*f.length+2*g.length,j=3*f.length+4*g.length,k=ic.getMaterial(a,b.materialIndex?b.materialIndex:0),l=k.needUV(),m=k.getNormalType(),n=k.isVertexColor(),o=k.isGradientColor();if(c.__vertexArray=new Float32Array(3*h),m&&(c.__normalArray=new Float32Array(3*h)),!d){n&&(c.__colorArray=new Float32Array(3*h)),o&&(c.__color2Array=new Float32Array(6)),l&&(c.__uvArray=new Float32Array(2*h),a.uv2s&&(c.__uv2Array=new Float32Array(2*h))),c.__faceArray=new Uint16Array(3*i),c.__lineArray=new Uint16Array(2*j);var p,q;if(b.numMorphTargets)for(c.__morphTargetsArrays=[],p=0,q=b.numMorphTargets;q>p;p++)c.__morphTargetsArrays.push(new Float32Array(3*h));if(b.numMorphNormals)for(c.__morphNormalsArrays=[],p=0,q=b.numMorphNormals;q>p;p++)c.__morphNormalsArrays.push(new Float32Array(3*h));if(c.__webglFaceCount=3*i,c.__webglLineCount=2*j,k.attributes){c.__webglCustomAttributesList=[];for(var r in k.attributes){var s=k.attributes[r],t={};for(var u in s)t[u]=s[u];if(!t.__webglInitialized||t.createUniqueBuffers){t.__webglInitialized=!0;var v=1;"v2"===t.type?v=2:"v3"===t.type?v=3:"v4"===t.type?v=4:"c"===t.type&&(v=3),t.size=v,t.array=new Float32Array(h*v),t.buffer=e.createBuffer(),t.buffer.belongsToAttribute=r,s.needsUpdate=!0,t.__original=s,t.value=a.data[t.ref]}c.__webglCustomAttributesList.push(t)}}c.__inittedArrays=!0}},createLineBuffers:function(a){null==this.lineMap[a._id]&&(this.lineMap[a._id]={});var b=this.lineMap[a._id],c=this._gl;b.__webglVertexBuffer=c.createBuffer(),b.__webglColorBuffer=c.createBuffer(),b.__webglLineDistanceBuffer=c.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(a){null==this.lineMap[a._id]&&(this.lineMap[a._id]={});var b=this.lineMap[a._id],c=a.vertices.length;b.__vertexArray=new Float32Array(3*c),b.__colorArray=new Float32Array(3*c),b.__color2Array=new Float32Array(6),b.__lineDistanceArray=new Float32Array(1*c),b.__webglLineCount=c},createParticleBuffers:function(a){null==this.particleMap[a._id]&&(this.particleMap[a._id]={});var b=this.particleMap[a._id],c=this._gl;b.__webglVertexBuffer=c.createBuffer(),b.__webglColorBuffer=c.createBuffer(),b.__webglNormalBuffer=c.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(a){null==this.particleMap[a._id]&&(this.particleMap[a._id]={});var b=this.particleMap[a._id],c=a.vertices.length;b.__vertexArray=new Float32Array(3*c),b.__colorArray=new Float32Array(3*c),b.__normalArray=new Float32Array(3*c),b.__sortArray=[],b.__webglParticleCount=c},createGroupBuffer:function(a,b){var c=this._gl;b.__webglVertexBuffer=c.createBuffer(),b.__webglNormalBuffer=c.createBuffer(),b.__webglColorBuffer=c.createBuffer(),b.__webglColor2Buffer=c.createBuffer(),b.__webglUVBuffer=c.createBuffer(),b.__webglUV2Buffer=c.createBuffer(),b.__webglFaceBuffer=c.createBuffer(),b.__webglLineBuffer=c.createBuffer(),this.webglVersion>1&&(b.__vao=c.createVertexArray()),this.info.memory.geometries++},setRenderTarget:function(a){var b=a instanceof zc,c=this._gl;if(a&&!a.__webglFramebuffer){a.depthBuffer===e&&(a.depthBuffer=!0),a.stencilBuffer===e&&(a.stencilBuffer=!0),a.__webglTexture=c.createTexture(),this.info.memory.textures++;var d=uc.isPowerOfTwo,f=d(a.width)&&d(a.height),g=uc.paramToGL(a.format,c),h=uc.paramToGL(a.type,c);a.type==$b.FloatType;var i=g;if(b){a.__webglFramebuffer=[],a.__webglRenderbuffer=[],c.bindTexture(c.TEXTURE_CUBE_MAP,a.__webglTexture),this.pm.setTextureParameters(c.TEXTURE_CUBE_MAP,a,f);for(var j=0;6>j;j++)a.__webglFramebuffer[j]=c.createFramebuffer(),a.__webglRenderbuffer[j]=c.createRenderbuffer(),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,i,a.width,a.height,0,g,h,null),this.setupFrameBuffer(a.__webglFramebuffer[j],a,c.TEXTURE_CUBE_MAP_POSITIVE_X+j),this.setupRenderBuffer(a.__webglRenderbuffer[j],a);f&&c.generateMipmap(c.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=c.createFramebuffer(),a.shareDepthFrom?a.__webglRenderbuffer=a.shareDepthFrom.__webglRenderbuffer:a.__webglRenderbuffer=c.createRenderbuffer(),c.bindTexture(c.TEXTURE_2D,a.__webglTexture),this.pm.setTextureParameters(c.TEXTURE_2D,a,f),c.texImage2D(c.TEXTURE_2D,0,i,a.width,a.height,0,g,h,null),this.setupFrameBuffer(a.__webglFramebuffer,a,c.TEXTURE_2D),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,a.__webglRenderbuffer):this.setupRenderBuffer(a.__webglRenderbuffer,a),f&&c.generateMipmap(c.TEXTURE_2D);b?c.bindTexture(c.TEXTURE_CUBE_MAP,null):c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null)}var k,l,m,n,o;a?(k=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,l=a.width,m=a.height,n=0,o=0):(k=null,l=this._viewportWidth,m=this._viewportHeight,n=this._viewportX,o=this._viewportY),k!==this._currentFramebuffer&&(c.bindFramebuffer(c.FRAMEBUFFER,k),c.viewport(n,o,l,m),this._currentFramebuffer=k),this._currentWidth=l,this._currentHeight=m},setupFrameBuffer:function(a,b,c){var d=this._gl;d.bindFramebuffer(d.FRAMEBUFFER,a),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,c,b.__webglTexture,0)},setupRenderBuffer:function(a,b){var c=this._gl;c.bindRenderbuffer(c.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,b.width,b.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,b.width,b.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,a)):c.renderbufferStorage(c.RENDERBUFFER,c.RGBA4,b.width,b.height)},setLineWidth:function(a){if(a!==this._oldLineWidth){try{this._gl.lineWidth&&this._gl.lineWidth(a)}catch(b){}this._oldLineWidth=a}},setupMatrices:function(a,b){a.fixSize(b),a.updateWorldMatrix(),a._modelViewMatrix.multiplyMatrices(b.worldMatrixInverse,a.worldMatrix),a._normalMatrix.getNormalMatrix(a._modelViewMatrix)},setDefaultGLState:function(){var a=this._gl,b=new $b.Color(this._clearColor);a.clearColor(b.r,b.g,b.b,this._clearAlpha),a.clearDepth(1),ec.isIE||a.clearStencil(0),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.frontFace(a.CCW),a.cullFace(a.BACK),a.enable(a.CULL_FACE),a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)},clear:function(a,b,c){var d=this._gl,f=0;(a===e||a)&&(f|=d.COLOR_BUFFER_BIT),(b===e||b)&&(f|=d.DEPTH_BUFFER_BIT),(c===e||c)&&(f|=d.STENCIL_BUFFER_BIT),d.clear(f)},setGLFaces:function(a){var b=this._gl,c=a.side===$b.DoubleSide,d=a.side===$b.BackSide;this._oldDoubleSided!==c&&(c?b.disable(b.CULL_FACE):b.enable(b.CULL_FACE),this._oldDoubleSided=c),this._oldFlipSided!==d&&(d?b.frontFace(b.CW):b.frontFace(b.CCW),this._oldFlipSided=d)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(a,b,c,d){xc.setBlending(a,b,c,d,this)},setDepthTest:function(a){xc.setDepthTest(a,this)},setStencilTest:function(a){this._oldStencilTest!=a&&(a?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._oldStencilTest=a)},setDepthWrite:function(a){xc.setDepthWrite(a,this)},getLineWidthRange:function(){var a=this._gl;return a.getParameter(a.ALIASED_LINE_WIDTH_RANGE)},setTexture:function(a,b){this.pm.setTexture(a,b)},disableAttributes:function(){for(var a in this._enabledAttributes)this._enabledAttributes[a]&&(this._gl.disableVertexAttribArray(a),this._enabledAttributes[a]=!1)},enableAttribute:function(a){this._enabledAttributes[a]||(this._gl.enableVertexAttribArray(a),this._enabledAttributes[a]=!0)},adjustRootViewBounds:function(a,b){var c=this._rootView;c.style.width=a+"px",c.style.height=b+"px"},adjustCanvasBounds:function(a,b,c,d,e){a.width=b*this.devicePixelRatio,a.height=c*this.devicePixelRatio,a.style.margin="0px",a.style.padding="0px",a.style.width=b+"px",a.style.height=c+"px"},adjustBounds:function(a,b,c,d){var e=this.getView();if(this.adjustRootViewBounds(a,b,c,d),this.adjustCanvasBounds(e,a,b,c,d),this.adjustCanvasBounds(this._topCanvas,a,b,c,d),this.adjustCanvasBounds(this._bottomCanvas,a,b,c,d),this.adjustCallback(a,b,c,d),this.setViewport(0,0,e.width,e.height),this.autoUpdateCameraAspect&&0!==b){var f=this._camera;f.aspect=a/b,f.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(a,b,c,d){var f=this.getView();this._viewportX=a!==e?a:0,this._viewportY=b!==e?b:0,this._viewportWidth=c!==e?c:f.width,this._viewportHeight=d!==e?d:f.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(a){this.showAxis!==a&&(this.showAxis=a,this.showAxis&&(this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis)),this.axis._visible=a,this.dirtyNetwork())},setShowAxisText:function(a){this.axis.showAxisText(a),this.dirtyNetwork()},setAxisSize:function(a){this.axis.setSize(a)},onSelect:function(a){null!=this.onSelectFunction&&this.onSelectFunction(a)},setOnSelectFunction:function(a){this.onSelectFunction=a},isSelectable:function(a){return a.isSelectable()?this.selectableFunction?this.selectableFunction(a):!0:!1},setSelectableFunction:function(a){this.selectableFunction=a},setRenderSelectFunction:function(a){this.renderSelectFunction=a},renderSelect:function(a){return this.renderSelectFunction?this.renderSelectFunction(a):!0},renderAlarmBorder:function(a){return this.renderAlarmBorderFunction?this.renderAlarmBorderFunction(a):!0},selectable:function(a){return this.isVisible(a.element)&&this.isSelectable(a.element)&&this.getDataBox().getSelectionModel().isSelectable(a.element);
},editable:function(a){var b=this.selectable(a);return b&&null!=this.editableFunction?this.editableFunction(a.element):b},getFirstSelectElement:function(a){if(null==a)return null;for(var b,c=0;c<a.length;){var d=a[c];if(this.selectable(d)){b=d.element;break}c++}return b},getFirstEditElement:function(a){if(null==a)return null;for(var b,c=0;c<a.length;){var d=a[c];if(this.editable(d)){b=d.element;break}c++}return b},toImageData:function(a,b,c,d){return this.dirtyNetwork(),this.render(),a=a||"PNG",a.toUpperCase(),"PNG"===a?fc.saveAsPNG(this.getView(),b,!1,c,d):"JPEG"===a?fc.saveAsJPEG(this.getView(),b,!1,c,d):"BMP"===a?fc.saveAsBMP(this.getView(),b,!1,c,d):void console.log("Not surport type "+a)},getPickingByEvent:function(a){var b=this._camera,c={},d=this.getView(),e=d.getBoundingClientRect(),f=a.clientX,g=a.clientY;a.touches&&a.touches.length&&(f=a.touches[0].pageX,g=a.touches[0].pageY);var h=(f-e.left)/e.width,i=(g-e.top)/e.height;c.x=2*h-1,c.y=2*-i+1;var j=new $b.Vec3(c.x,c.y,.5);this.projector.unprojectVector(j,b);var k=null;if(b instanceof $b.PerspectiveCamera)k=new $b.Picking(b._position,j.sub(b._position).normalize(),b.up,null,null,this);else{var l=j.clone().sub(b._position),m=b.getTarget().clone().sub(b.p()).normalize(),n=m.multiplyScalar(l.clone().dot(m)),o=l.sub(n),p=(new ac).addVectors(b._position,o);k=new $b.Picking(p,j.sub(p).normalize(),b.up,null,null,this)}return k},getElementsByMouseEvent:function(a,b,c){var d=this.getPickingByEvent(a),e=new mc;e.addAll(this.dataBox.getNodes()),e.addAll(this.dataBox.getBillboards()),c&&e.addAll(new mc(this.alarmBillboards));var f=d.intersectObjects(e.toArray(),!1,b);return f},getElementByScreenPoint:function(a,b,c){var d={},e=this.getView(),f=this._camera,g=e.getBoundingClientRect();a.x&&(c=b,b=a.y,a=a.x),a/=g.width,b/=g.height,d.x=2*a-1,d.y=2*-b+1;var h=new $b.Vec3(d.x,d.y,.5);this.projector.unprojectVector(h,f);var i=new $b.Picking(f._position,h.sub(f._position).normalize(),f.up,null,null,this),j=new mc;j.addAll(this.dataBox.getNodes()),j.addAll(this.dataBox.getBillboards());var k=i.intersectObjects(j.toArray(),!1,c);return k},getFirstElementByMouseEvent:function(a,b,c,d){var e=this.getElementsByMouseEvent(a,b,d);if(e.length)for(var f=0;f<e.length;f++){var g=e[f],h=g.element;if(null==c||c.call(null,h))return g}return null},getUnProjectVector:function(a){var b={},c=this.getView().getBoundingClientRect(),d=a.x/c.width,e=a.y/c.height;b.x=2*d-1,b.y=2*-e+1;var f=new $b.Vec3(b.x,b.y,.5);return this.projector.unprojectVector(f,this._camera),f},getFrustumByBounding:function(a){var b=a,c=this.getUnProjectVector(new _b(b.x,b.y)),d=this.getUnProjectVector(new _b(b.x+b.w,b.y)),e=this.getUnProjectVector(new _b(b.x,b.y+b.h)),f=this.getUnProjectVector(new _b(b.x+b.w,b.y+b.h)),g=this.getNearFarPoints(c),h=this.getNearFarPoints(d),i=this.getNearFarPoints(e),j=this.getNearFarPoints(f),k=new $b.math.Plane,l=new $b.math.Plane,m=new $b.math.Plane,n=new $b.math.Plane,o=new $b.math.Plane,p=new $b.math.Plane;k.setFromCoplanarPoints(g[0],h[0],i[0]),l.setFromCoplanarPoints(g[0],g[1],h[0]),m.setFromCoplanarPoints(g[0],i[0],g[1]),n.setFromCoplanarPoints(h[0],h[1],j[0]),o.setFromCoplanarPoints(i[0],j[0],i[1]),p.setFromCoplanarPoints(g[1],i[1],h[1]);var q=new $b.Frustum(k,l,m,n,o,p);return q.setPoints([g[0],h[0],i[0],j[0],g[1],h[1],i[1],j[1]]),q},getNearFarPoints:function(a){var b=this._camera,c=a.sub(b._position).normalize(),d=b.target.clone().sub(b._position),e=c.angleTo(d),f=b.getNear()/Math.acos(e),g=b.getFar()/Math.acos(e),h=b._position.clone().add(c.clone().multiplyScalar(f)),i=b._position.clone().add(c.clone().multiplyScalar(g));return[h,i]},getSpacePointOnPlane:function(a,b){var c={},d=this.getView(),e=this._camera,f=d.getBoundingClientRect(),g=a.clientX,h=a.clientY;a.touches&&a.touches.length&&(g=a.touches[0].pageX,h=a.touches[0].pageY);var i=(g-f.left)/f.width,j=(h-f.top)/f.height;c.x=2*i-1,c.y=2*-j+1;var k=new $b.Vec3(c.x,c.y,.5);this.projector.unprojectVector(k,e);var l=e._position;if(e instanceof mono.OrthoCamera){var m=new $b.Vec3(0,0,.5);this.projector.unprojectVector(m,e),l=l.clone().sub(m.sub(k))}var n=k.sub(l).normalize(),o=new $b.Ray(l,n),p=o.distanceToPlane(b);if(0>p||Math.abs(p)<$b.Picking.prototype.precision)return null;var q=o.at(p);return q},getElementsByBounding:function(a,b,c){var d=new mc;d.addAll(this.dataBox.getNodes()),d.addAll(this.dataBox.getBillboards());var e,f=this.getFrustumByBounding(a),g=[],h=new ac,i=this._camera;return d.forEach(function(a){if(a instanceof $b.Billboard){h.setFromMatrixPosition(a.worldMatrix);var b=a.material,d=b.alignment;e=new $b.Plane(1,1),(d.x||d.y)&&(e.setPosition(d.x,d.y,0),e=$b.Utils.transformElement(e,!0)),e.setPosition(h);var j=(new ac).getScaleFromMatrix(a.worldMatrix);e.setScale(j.x,j.y,1);var k=i.getTarget().clone(),l=i.getPosition();k.sub(l);var m=e.getPosition().clone();b&&b.vertical&&(k.y=0),m.sub(k),e.lookAt(m),e.updateWorldMatrix(!0),f.intersectsObjectAccurate(e,c)&&g.push({element:a})}else a instanceof $b.Line?f.intersectsObjectAccurate(a,c)&&g.push({element:a}):f.intersectsObjectAccurate(a,c)&&g.push({element:a})}),g},getViewPosition:function(a){var b=new ac;b=this.projector.projectVector(a,this._camera,b),b.x=b.x/2+.5,b.y=-b.y/2+.5;var c={x:this._canvas.width*b.x/this.devicePixelRatio,y:this._canvas.height*b.y/this.devicePixelRatio,h:this._canvas.height};return c},setInteractions:function(a){var b,c,d=this._interactions;if(d)for(b=0;b<d.length;b++)c=d[b],c.tearDown();if(this._interactions=a,a)for(b=0;b<a.length;b++)c=a[b],c.setUp()},getDefaultInteraction:function(){if(this._interactions&&this._interactions.length>0)for(var a=0;a<this._interactions.length;a++){var b=this._interactions[a];if(b instanceof $b.DefaultInteraction)return b}return null},getInteractions:function(){return this._interactions},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},addInteractionListener:function(a,b,c){this._interactionDispatcher.add(a,b,c)},removeInteractionListener:function(a,b){this._interactionDispatcher.remove(a,b)},dispose:function(){this._animateId&&((this._vrDisplay&&this._vrDisplay.isPresenting?this._vrDisplay:d).cancelAnimationFrame(this._animateId),this._animateId=null),this.setInteractions(null),this.pm.dispose(),this._resizeFunction&&d.removeEventListener("resize",this._resizeFunction)},setRenderInterval:function(a){(uc.isNaN(a)||5>=a)&&(a=5),this._renderInterval=a},_computeNetworkBoundingBox:function(){function a(a,b){a.applyMatrix4(b),h.push(a)}var b,c,d,e,f=this.getDataBox().size(),g=this.getDataBox().getDatas(),h=[];for(b=0;f>b;b++)if(c=g.get(b),c instanceof $b.Node){d=c.getBoundingBox(),e=c.worldMatrix;var i=d.min,j=d.max;a(i.clone(),e),a(j.clone(),e),a(new ac(i.x,i.y,j.z),e),a(new ac(i.x,j.y,i.z),e),a(new ac(j.x,i.y,i.z),e),a(new ac(j.x,j.y,i.z),e),a(new ac(j.x,i.y,j.z),e),a(new ac(i.x,j.y,j.z),e)}if(h.length<=1)return null;var k=new $b.BoundingBox;return k.setFromPoints(h),k},getNetworkBoundingBox:function(){return null==this.boundingBox&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},getSelectStyle:function(a){return a.getSelectStyle()},setZoomStandard:function(a){this._zoomStandard=a},getZoomStandard:function(){return this._zoomStandard},zoom:function(a,b){b=b||this._zoomStandard;var c=this._camera;c.zoom(a,b)},zoomIn:function(a){this.zoom(.9,a)},zoomOut:function(a){this.zoom(1.1,a)},move:function(a,b){var c=(new mono.Vec3(-a,-b,0),this._camera.t()),d=this._camera.p();this._camera.translateX(-a),this._camera.translateY(-b);var e=this._camera.p();c.add(e.clone().sub(d)),this._camera.lookAt(c)},moveLeft:function(a){a=a||50,this.move(-a,0)},moveRight:function(a){a=a||50,this.move(a,0)},moveUp:function(a){a=a||30,this.move(0,a)},moveDown:function(a){a=a||30,this.move(0,-a)},zoomEstimateOverview:function(a){var b=this.getNetworkBoundingBox();if(null!=b){var c=b.center(),d=new ac(0,b.max.y-b.min.y,b.max.z-b.min.z),e=new ac(b.max.x-b.min.x,0,0,0),f=d.clone();f.length()<e.length()&&(f=e.clone());var g;if(a){var h=d.length();d.y=d.z*Math.tan(a/180*Math.PI),d.setLength(h)}g=(new ac).addVectors(c,d.multiplyScalar(.5));var i=this._camera.fov,j=(this._camera.aspect,f.length()/2/Math.tan(i*Math.PI/180));g.add(d.normalize().multiplyScalar(j)),this._camera.setPosition(g),this._camera.lookAt(c),this._overviewDistance=this._camera.getDistance()}},_onVRRequestPresent:function(){var a=this,b=a._canvas,c=a._vrDisplay;if(c){a._oldCamera=a._camera;var d=new mono.VRCamera(a,a._oldCamera.near,a._oldCamera.far);d.setPosition(a._camera.getPosition()),a.setCamera(d),c.requestPresent([{source:b}]).then(function(){a._isPresenting=!0,a.onEnterVR()},function(a){console.log("requestPresent failed.",a)})}},onEnterVR:function(){},_onVRExitPresent:function(){var a=this,b=a._vrDisplay;b&&b.isPresenting&&b.exitPresent().then(function(){a.setCamera(a._oldCamera),a._oldCamera=null,a._isPresenting=!1},function(){console.log("exitPresent failed.")})},enterVR:function(){this._onVRRequestPresent()},_initVR:function(){var a,b=this,c=b._canvas;b._vrDisplay||navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){e&&e.length&&(a=b._vrDisplay=e[0],a.depthNear=b._camera.near,a.depthFar=b._camera.far,b.onVRRequestPresent||(b.onVRRequestPresent=function(a){b._onVRRequestPresent()}),b.onVRExitPresent||(b.onVRExitPresent=function(a){b._onVRExitPresent()}),b.onVRPresentChange||(b.onVRPresentChange=function(d){if(a.isPresenting){var e=a.getEyeParameters("left"),f=a.getEyeParameters("right");c.width=2*Math.max(e.renderWidth,f.renderWidth),c.height=Math.max(e.renderHeight,f.renderHeight)}else b.adjustBounds(b._rootView.clientWidth,b._rootView.clientHeight)}),d.addEventListener("vrdisplaypresentchange",b.onVRPresentChange,!1),d.addEventListener("vrdisplayactivate",b.onVRRequestPresent,!1),d.addEventListener("vrdisplaydeactivate",b.onVRExitPresent,!1))})},exitVR:function(){this._onVRExitPresent()},s:function(a){this.setStyle(a)},setStyle:function(a){var b=this;if(a){if(a.parentDom&&a.parentDom.appendChild(b.getRootView()),a.width&&a.height&&b.adjustBounds(a.width,a.height),a.autoAdjustBounds&&mono.Utils.autoAdjustNetworkBounds(b,document.documentElement,"clientWidth","clientHeight"),a.camera){var c=b.getCamera(),d=a.camera;null!=d.near&&c.setNear(d.near),null!=d.far&&c.setFar(d.far),null!=d.fov&&c.setFov&&c.setFov(d.fov),null!=d.width&&c.setWidth&&c.setWidth(d.width),null!=d.position&&c.setPosition(d.position),null!=d.target&&c.lookAt(d.target)}if(a.lights){var e=b.getDataBox();a.lights.forEach(function(a){var b;"directional"===a.type&&(b=new mono.DirectionalLight(a.color,a.intensity),a.direction&&b.setDirection(a.direction)),"point"===a.type&&(b=new mono.PointLight(a.color,a.intensity,a.distance),a.position&&b.setPosition(a.position)),"ambient"===a.type&&(b=new mono.AmbientLight(a.color)),"spot"===a.type&&(b=new mono.SpotLight(a.color,a.intensity,a.distance,a.angle,a.exponent)),b&&e.add(b)})}if(a.interactions){var f,g,h,i;b.getInteractions().forEach(function(a){a instanceof mono.DefaultInteraction&&(f=a),a instanceof mono.EditInteraction&&(g=a),a instanceof mono.SelectionInteraction&&(h=a)}),a.interactions.forEach(function(a){"default"===a.type&&(f||(f=new mono.DefaultInteraction(b)),i=f),"edit"===a.type&&(g||(g=new mono.EditInteraction(b)),i=g),"selection"===a.type&&(h||(h=new mono.SelectionInteraction(b)),i=h),Object.keys(a).forEach(function(b){"type"!==b&&(i[b]=a[b])})});var j=[];f&&j.push(f),g&&j.push(g),h&&j.push(h),b.setInteractions(j)}}}}),$b.Network3DId=0,$b.Network3D.GroupCache={_groupCounter:0};var Ac=function(){function a(){if(k===w){var a=new $RenderObject;return v.push(a),w++,k++,a}return v[k++]}function b(){if(m===y){var a=new $RenderVertex;return x.push(a),y++,m++,a}return x[m++]}function c(){if(o===A){var a=new $b.RenderFace3;return z.push(a),A++,o++,a}return z[o++]}function d(){if(p===C){var a=new $b.RenderFace4;return B.push(a),C++,p++,a}return B[p++]}function f(){if(r===E){var a=new $b.RenderLine;return D.push(a),E++,r++,a}return D[r++]}function g(){if(t===G){var a=new $b.RenderableParticle;return F.push(a),G++,t++,a}return F[t++]}function h(a,b){return b.z-a.z}function i(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:0>e&&0>f||0>g&&0>h?!1:(0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f))),0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h))),c>d?!1:(a.lerp(b,c),b.lerp(a,1-d),!0))}var j,k,l,m,n,o,p,q,r,s,t,u,v=[],w=0,x=[],y=0,z=[],A=0,B=[],C=0,D=[],E=0,F=[],G=0,H={objects:[],sprites:[],lights:[],elements:[]},I=new $b.Vec3,J=new $b.Vec4,K=new $b.BoundingBox(new $b.Vec3(-1,-1,-1),new $b.Vec3(1,1,1)),L=new $b.BoundingBox,M=new Array(3),N=new Array(4),O=new $b.Mat4,P=new $b.Mat4,Q=new $b.Mat4,R=new $b.Mat3,S=new $b.Mat3,T=new $b.Vec3,U=new $b.Frustum,V=new $b.Vec4,W=new $b.Vec4;this.projectVector=function(a,b,c){return b.worldMatrixInverse.getInverse(b.worldMatrix),P.multiplyMatrices(b.projectionMatrix,b.worldMatrixInverse),c===e?a.applyProjection(P):(c.copy(a),c.applyProjection(P))},this.unprojectVector=function(a,b){return b.projectionMatrixInverse.getInverse(b.projectionMatrix),P.multiplyMatrices(b.worldMatrix,b.projectionMatrixInverse),a.applyProjection(P)},this.pickingRay=function(a,b){a.z=-1;var c=new $b.Vec3(a.x,a.y,1);return this.unprojectVector(a,b),this.unprojectVector(c,b),c.sub(a).normalize(),new $b.Picking(a,c)};var X=function(b,c){k=0,H.objects.length=0,H.sprites.length=0,H.lights.length=0;var d=function(b){var c;c=b instanceof $b.DataBox?b.getRoots():b.getChildren(),c=c.toList();for(var e=0,f=c.size();f>e;e++){var g=c.get(e);g.isSelected()&&g instanceof $b.Node&&(c.add(g.createCanvasSelectionCube(),e),e++)}for(var e=0,f=c.size();f>e;e++){var g=c.get(e);g._visible!==!1&&(g instanceof $b.Light?H.lights.push(g):g instanceof $b.Entity||g instanceof $b.Line?(g.frustumCulled===!1||U.intersectsObject(g)===!0)&&(j=a(),j.object=g,null!==g.renderDepth?j.z=g.renderDepth:(I.copy(g.worldMatrix.getPosition()),I.applyProjection(P),j.z=I.z),H.objects.push(j)):g instanceof $b.Billboard||g instanceof $b.Particle?(j=a(),j.object=g,null!==g.renderDepth?j.z=g.renderDepth:(I.copy(g.worldMatrix.getPosition()),I.applyProjection(P),j.z=I.z),H.sprites.push(j)):(j=a(),j.object=g,null!==g.renderDepth?j.z=g.renderDepth:(I.copy(g.worldMatrix.getPosition()),I.applyProjection(P),j.z=I.z),H.objects.push(j)),d(g))}};return d(b),c===!0&&H.objects.sort(h),H};this.projectDataBox=function(a,j,k,v){var w,y,z,A,B,C,D,E,F,G,I,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia=!1;o=0,p=0,r=0,t=0,H.elements.length=0;for(var ja=0;ja<a.getRoots().size();ja++){var ka=a.getRoots().get(ja);ka.updateWorldMatrix()}for(j.parent===e&&j.updateWorldMatrix(!0,!1),O.copy(j.worldMatrixInverse.getInverse(j.worldMatrix)),P.multiplyMatrices(j.projectionMatrix,O),S.getInverse(O),S.transpose(),U.setFromMatrix(P),H=X(a,k),w=0,y=H.objects.length;y>w;w++)if(I=H.objects[w].object,u=I.worldMatrix,m=0,I instanceof $b.Entity){for(Y=I,Z=Y.vertices,$=Y.faces,ba=Y.uvs,R.getInverse(u),R.transpose(),ga=I.material instanceof $b.ArrayMaterial,ha=ga===!0?I.material:null,z=0,A=Z.length;A>z;z++)l=b(),l.positionWorld.copy(Z[z]).applyMatrix4(u),l.positionScreen.copy(l.positionWorld).applyMatrix4(P),l.positionScreen.x/=l.positionScreen.w,l.positionScreen.y/=l.positionScreen.w,l.positionScreen.z/=l.positionScreen.w,l.visible=!(l.positionScreen.x<-1||l.positionScreen.x>1||l.positionScreen.y<-1||l.positionScreen.y>1||l.positionScreen.z<-1||l.positionScreen.z>1);for(B=0,C=$.length;C>B;B++){_=$[B];var la=ga===!0?ha.materials[_.materialIndex]:I.material;if(la!==e){var ma=la.side;if(_ instanceof $b.Face3){if(ca=x[_.a],da=x[_.b],ea=x[_.c],M[0]=ca.positionScreen,M[1]=da.positionScreen,M[2]=ea.positionScreen,ca.visible!==!0&&da.visible!==!0&&ea.visible!==!0&&!K.isIntersectionBox(L.setFromPoints(M)))continue;if(ia=(ea.positionScreen.x-ca.positionScreen.x)*(da.positionScreen.y-ca.positionScreen.y)-(ea.positionScreen.y-ca.positionScreen.y)*(da.positionScreen.x-ca.positionScreen.x)<0,ma!==$b.DoubleSide&&ia!==(ma===$b.FrontSide))continue;n=c(),n.v1.copy(ca),n.v2.copy(da),n.v3.copy(ea)}else if(_ instanceof $b.Face4){if(ca=x[_.a],da=x[_.b],ea=x[_.c],fa=x[_.d],N[0]=ca.positionScreen,N[1]=da.positionScreen,N[2]=ea.positionScreen,N[3]=fa.positionScreen,ca.visible!==!0&&da.visible!==!0&&ea.visible!==!0&&fa.visible!==!0&&!K.isIntersectionBox(L.setFromPoints(N)))continue;if(ia=(fa.positionScreen.x-ca.positionScreen.x)*(da.positionScreen.y-ca.positionScreen.y)-(fa.positionScreen.y-ca.positionScreen.y)*(da.positionScreen.x-ca.positionScreen.x)<0||(da.positionScreen.x-ea.positionScreen.x)*(fa.positionScreen.y-ea.positionScreen.y)-(da.positionScreen.y-ea.positionScreen.y)*(fa.positionScreen.x-ea.positionScreen.x)<0,ma!==$b.DoubleSide&&ia!==(ma===$b.FrontSide))continue;n=d(),n.v1.copy(ca),n.v2.copy(da),n.v3.copy(ea),n.v4.copy(fa)}for(n.normalModel.copy(_.normal),ia===!1&&(ma===$b.BackSide||ma===$b.DoubleSide)&&n.normalModel.negate(),n.normalModel.applyMatrix3(R).normalize(),n.normalModelView.copy(n.normalModel).applyMatrix3(S),n.centroidModel.copy(_.centroid).applyMatrix4(u),aa=_.vertexNormals,D=0,E=aa.length;E>D;D++){var na=n.vertexNormalsModel[D];na.copy(aa[D]),ia===!1&&(ma===$b.BackSide||ma===$b.DoubleSide)&&na.negate(),na.applyMatrix3(R).normalize();var oa=n.vertexNormalsModelView[D];oa.copy(na).applyMatrix3(S)}n.vertexNormalsLength=aa.length;var pa=ba[B];for(F=0,G=pa.length;G>F;F++)n.uvs[0][F]=pa[F];n.color=_.color,n.material=la,T.copy(n.centroidModel).applyProjection(P),n.z=T.z,H.elements.push(n)}}}else if(I instanceof $b.Line){Q.multiplyMatrices(P,u),Z=I.vertices,ca=b(),ca.positionScreen.copy(Z[0]).applyMatrix4(Q);var qa=I.type===$b.LinePieces?2:1;for(z=1,A=Z.length;A>z;z++)ca=b(),ca.positionScreen.copy(Z[z]).applyMatrix4(Q),(z+1)%qa>0||(da=x[m-2],V.copy(ca.positionScreen),W.copy(da.positionScreen),i(V,W)===!0&&(V.multiplyScalar(1/V.w),W.multiplyScalar(1/W.w),q=f(),q.v1.positionScreen.copy(V),q.v2.positionScreen.copy(W),q.z=Math.max(V.z,W.z),q.material=I.material,H.elements.push(q)))}for(w=0,y=H.sprites.length;y>w;w++)I=H.sprites[w].object,u=I.worldMatrix,I instanceof $b.Particle&&(J.set(u.elements[12],u.elements[13],u.elements[14],1),J.applyMatrix4(P),J.z/=J.w,J.z>0&&J.z<1&&(s=g(),s.object=I,s.x=J.x/J.w,s.y=J.y/J.w,s.z=J.z,s.rotation=I.rotation.z,s.scale.x=I.scale.x*Math.abs(s.x-(J.x+j.projectionMatrix.elements[0])/(J.w+j.projectionMatrix.elements[12])),s.scale.y=I.scale.y*Math.abs(s.y-(J.y+j.projectionMatrix.elements[5])/(J.w+j.projectionMatrix.elements[13])),s.material=I.material,H.elements.push(s)));return v===!0&&H.elements.sort(h),H}};$b.Projector=Ac,$b.Billboard=function(a){null!=a&&null!=a.id?this._id=a.id:this._id=a,$b.Element.call(this,this._id),this.material=new $b.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new ac(-.5,-.5,0),new ac(.5,-.5,0),new ac(.5,.5,0),new ac(-.5,.5,0)]},$b.extend($b.Billboard,$b.Element,{constructor:$b.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation=this._rotation.z,this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this._scale.x||1!==this._scale.y)&&this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},invalidateTexture:function(){var a=this.material;a instanceof $b.BillboardMaterial&&this._dirtyMaterialTexture(a)},clone:function(a){return a===e&&(a=new $b.Billboard(this.material)),$b.Element.prototype.clone.call(this,a),a},setMaterialStyle:function(a,b){var c=this.material.clone();a=a.substr(a.indexOf(".")+1),this._A97(c,a,b);var d=c.getUniqueCode(),e=_c.getMaterial(d);null!=e?(_c.unUseMaterial(this.material),this.material=e,_c.useMaterial(e)):(_c.unUseMaterial(this.material),_c.setMaterial(d,c),this.material=c)}}),$b.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform bool vertical;","uniform float fixedSize;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","vUV = uvOffset + uv * uvScale;","vec2 finalScale;","if(fixedSize != 0.0){","   finalScale = scale  * length(finalPosition.xyz) / fixedSize;","}else{","   finalScale = scale;","}","vec2 alignedPosition = (position + alignment) * finalScale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 upPosition;","vec4 rightPosition = vec4(finalScale.x,0.0,0.0,1.0);","if(vertical){","upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;","normalize(upPosition);","}","if(vertical){","finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / finalScale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);","}else{","finalPosition.xy += rotatedPosition;","}","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform int useMap;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","if(useMap > 0){","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","} else {","gl_FragColor = vec4( color, 1.0);","}","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},$b.BillboardRenderer=function(){function a(a,c){var d=b.createProgram(),e=b.createShader(b.FRAGMENT_SHADER),f=b.createShader(b.VERTEX_SHADER),g="precision "+c+" float;\n";return b.shaderSource(e,g+a.fragmentShader),b.shaderSource(f,g+a.vertexShader),b.compileShader(e),b.compileShader(f),b.attachShader(d,e),b.attachShader(d,f),b.linkProgram(d),d}var b,c,d,e={},f=(new $b.Billboard,new $b.BillboardMaterial({color:255}));this.init=function(f){this.enable=!0,f._currentGroupHash=null,b=f._gl,c=f,d=f.getPrecision(),e.vertices=new Float32Array(16),e.faces=new Uint16Array(6),e.lines=new Uint16Array(8);var g=0;e.vertices[g++]=-.5,e.vertices[g++]=-.5,e.vertices[g++]=0,e.vertices[g++]=0,e.vertices[g++]=.5,e.vertices[g++]=-.5,e.vertices[g++]=1,e.vertices[g++]=0,e.vertices[g++]=.5,e.vertices[g++]=.5,e.vertices[g++]=1,e.vertices[g++]=1,e.vertices[g++]=-.5,e.vertices[g++]=.5,e.vertices[g++]=0,e.vertices[g++]=1,g=0,e.faces[g++]=0,e.faces[g++]=1,e.faces[g++]=2,e.faces[g++]=0,e.faces[g++]=2,e.faces[g++]=3,g=0,e.lines[g++]=0,e.lines[g++]=1,e.lines[g++]=0,e.lines[g++]=3,e.lines[g++]=1,e.lines[g++]=2,e.lines[g++]=2,e.lines[g++]=3,e.vertexBuffer=b.createBuffer(),e.elementBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,e.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,e.vertices,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,e.faces,b.STATIC_DRAW),e.program=a($b.ShaderSprite.sprite,d),e.attributes={},e.uniforms={},e.attributes.position=b.getAttribLocation(e.program,"position"),e.attributes.uv=b.getAttribLocation(e.program,"uv"),e.uniforms.uvOffset=b.getUniformLocation(e.program,"uvOffset"),e.uniforms.uvScale=b.getUniformLocation(e.program,"uvScale"),e.uniforms.rotation=b.getUniformLocation(e.program,"rotation"),e.uniforms.scale=b.getUniformLocation(e.program,"scale"),e.uniforms.alignment=b.getUniformLocation(e.program,"alignment"),e.uniforms.color=b.getUniformLocation(e.program,"color"),e.uniforms.useMap=b.getUniformLocation(e.program,"useMap"),e.uniforms.map=b.getUniformLocation(e.program,"map"),e.uniforms.opacity=b.getUniformLocation(e.program,"opacity"),e.uniforms.vertical=b.getUniformLocation(e.program,"vertical"),e.uniforms.fixedSize=b.getUniformLocation(e.program,"fixedSize"),e.uniforms.useScreenCoordinates=b.getUniformLocation(e.program,"useScreenCoordinates"),e.uniforms.sizeAttenuation=b.getUniformLocation(e.program,"sizeAttenuation"),e.uniforms.screenPosition=b.getUniformLocation(e.program,"screenPosition"),e.uniforms.modelViewMatrix=b.getUniformLocation(e.program,"modelViewMatrix"),e.uniforms.projectionMatrix=b.getUniformLocation(e.program,"projectionMatrix"),e.uniforms.fogType=b.getUniformLocation(e.program,"fogType"),e.uniforms.fogDensity=b.getUniformLocation(e.program,"fogDensity"),e.uniforms.fogNear=b.getUniformLocation(e.program,"fogNear"),e.uniforms.fogFar=b.getUniformLocation(e.program,"fogFar"),e.uniforms.fogColor=b.getUniformLocation(e.program,"fogColor"),e.uniforms.alphaTest=b.getUniformLocation(e.program,"alphaTest"),this.inited=!0},this.render=function(a,d,g,h,i,j){this.inited||this.init(a);var k=new mc(d),l=k.size();if(l){var m=e.attributes,n=e.uniforms,o=!1;a.pm.currentProgram!=e.program&&(b.useProgram(e.program),a.pm.currentProgram=e.program,a._currentGroupHash=null,b.enableVertexAttribArray(m.position),b.enableVertexAttribArray(m.uv),b.disable(b.CULL_FACE),b.bindBuffer(b.ARRAY_BUFFER,e.vertexBuffer),b.vertexAttribPointer(m.position,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(m.uv,2,b.FLOAT,!1,16,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),this.enable=!0,o=!0),b.uniformMatrix4fv(n.projectionMatrix,!1,g.projectionMatrix.elements),o&&b.activeTexture(b.TEXTURE0),o&&b.uniform1i(n.map,0);var p=0,q=0,r=a.fog;r?(b.uniform3f(n.fogColor,r.color.r,r.color.g,r.color.b),r instanceof $b.Fog?(b.uniform1f(n.fogNear,r.near),b.uniform1f(n.fogFar,r.far),b.uniform1i(n.fogType,1),p=1,q=1):r instanceof $b.FogExp2&&(b.uniform1f(n.fogDensity,r.density),b.uniform1i(n.fogType,2),p=2,q=2)):(p=0,q=0);var s,t,u;for(s=0;l>s;s++)t=k.get(s),u=j||t.material,c.isVisible(t)&&0!==u.opacity&&(t.updateWorldMatrix(!0,!1),u.useScreenCoordinates?t.z=-t.position.z:(t._modelViewMatrix=new $b.Mat4,t._modelViewMatrix.multiplyMatrices(g.worldMatrixInverse,t.worldMatrix),t.z=-t._modelViewMatrix.elements[14]));for(s=0;l>s;s++)t=k.get(s),this.renderBillboard(t,n,a,p,q,null,j),t._selected&&(t._scale.x=1.01*t._scale.x,t._scale.y=1.01*t._scale.y,t.material.clone(f),f.map=null,f.color.set(65280),this.renderBillboard(t,n,a,p,q,f),t._scale.x=t._scale.x/1.01,t._scale.y=t._scale.y/1.01)}},this.disable=function(){if(this.enable){var a=e.attributes;e.uniforms;b.disableVertexAttribArray(a.position),b.disableVertexAttribArray(a.uv),c._oldDoubleSided||b.enable(b.CULL_FACE),c._oldBlending===$b.NoBlending&&b.disable(b.BLEND),xc.setDepthWrite(!0,c),this.enable=!1,this.lastMaterialId=null,c.pm.currentProgram=null}},this.renderBillboard=function(a,d,f,g,h,i,j){var k,l,m,n=[],o=new ac;if(k=i?i:j?j:a.material,c.isVisible(a)&&0!==k.opacity){var p=k.id,q=p!=this.lastMaterialId;q&&b.uniform1f(d.alphaTest,k.alphaTest),q&&(k.useScreenCoordinates===!0?(b.uniform1i(d.useScreenCoordinates,1),b.uniform3f(d.screenPosition,(a.position.x*c.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-a.position.y*c.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,a.position.z)))):(b.uniform1i(d.useScreenCoordinates,0),b.uniform1i(d.sizeAttenuation,k.sizeAttenuation?1:0))),k.useScreenCoordinates===!0?(n[0]=c.devicePixelRatio,n[1]=c.devicePixelRatio):(b.uniformMatrix4fv(d.modelViewMatrix,!1,a._modelViewMatrix.elements),n[0]=1,n[1]=1),m=f.fog&&k.fog?h:0,g!==m&&(b.uniform1i(d.fogType,m),g=m),l=1/(k.scaleByViewport?viewportHeight:1),o.getScaleFromMatrix(a.worldMatrix),n[0]*=l*o.x,n[1]*=l*o.y,q&&(b.uniform2f(d.uvScale,k.repeat.x,k.repeat.y),b.uniform2f(d.uvOffset,k.offset.x,k.offset.y),b.uniform2f(d.alignment,k.alignment.x,k.alignment.y),b.uniform1f(d.opacity,k.opacity),b.uniform1i(d.vertical,k.vertical),b.uniform1f(d.fixedSize,k.fixedSize),b.uniform3f(d.color,k.color.r,k.color.g,k.color.b),b.uniform1f(d.rotation,a.rotation)),b.uniform2fv(d.scale,n),q&&(c.setBlending(k.blending,k.blendEquation,k.blendSrc,k.blendDst),c.setDepthTest(k.depthTest),c.setDepthWrite(k.depthMask)),k.map&&k.map._image&&c.pm.addTexture(k.map),q=q||k.map&&c.pm.needsUpdateTexture(k.map),k.map&&k.map._image&&k.map._image.width?(q&&c.setTexture(k.map,0),q&&b.uniform1i(d.useMap,1)):q&&b.uniform1i(d.useMap,0),i?(q&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),q&&b.bufferData(b.ELEMENT_ARRAY_BUFFER,e.lines,b.STATIC_DRAW),q&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),b.drawElements(b.LINES,8,b.UNSIGNED_SHORT,0)):(q&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),q&&b.bufferData(b.ELEMENT_ARRAY_BUFFER,e.faces,b.STATIC_DRAW),q&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0)),this.lastMaterialId=k.id}}},$b.ShaderFlare={flare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},$b.FlareRenderer=function(){var a,b,c,d,e,f,g,h,i,j;this.init=function(k){this.enable=!0,h=k._gl,i=k,j=k.getPrecision();var l=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),m=new Uint16Array([0,1,2,0,2,3]);a=h.createBuffer(),b=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,a),h.bufferData(h.ARRAY_BUFFER,l,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,b),h.bufferData(h.ELEMENT_ARRAY_BUFFER,m,h.STATIC_DRAW),f=h.createTexture(),g=h.createTexture(),h.bindTexture(h.TEXTURE_2D,f),h.texImage2D(h.TEXTURE_2D,0,h.RGB,16,16,0,h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.bindTexture(h.TEXTURE_2D,g),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,16,16,0,h.RGBA,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),
h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),c=this.createProgram($b.ShaderFlare.flare),d={vertex:h.getAttribLocation(c,"position"),uv:h.getAttribLocation(c,"uv")},e={renderType:h.getUniformLocation(c,"renderType"),map:h.getUniformLocation(c,"map"),occlusionMap:h.getUniformLocation(c,"occlusionMap"),opacity:h.getUniformLocation(c,"opacity"),color:h.getUniformLocation(c,"color"),scale:h.getUniformLocation(c,"scale"),rotation:h.getUniformLocation(c,"rotation"),screenPosition:h.getUniformLocation(c,"screenPosition")},this.inited=!0},this.render=function(j,k,l,m,n){if(this.inited||this.init(j),i=j,0!==k.length){var o=new ac,p=n/m,q=.5*m,r=.5*n,s=16/n,t=new _b(s*p,s),u=new ac(1,1,0),v=new _b(1,1),w=new $b.Box2;if(w.min.set(0,0),w.max.set(m-16,n-16),j.pm.currentProgram!=c){h.useProgram(c),j.pm.currentProgram=c,j._currentGroupHash=null,h.enableVertexAttribArray(d.vertex),h.enableVertexAttribArray(d.uv),h.uniform1i(e.occlusionMap,0),h.uniform1i(e.map,1),h.bindBuffer(h.ARRAY_BUFFER,a),h.vertexAttribPointer(d.vertex,2,h.FLOAT,!1,16,0),h.vertexAttribPointer(d.uv,2,h.FLOAT,!1,16,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,b),h.disable(h.CULL_FACE),this.enable=!0;for(var x=0,y=k.length;y>x;x++){s=16/n,t.set(s*p,s);var z=k[x],A=z.node;if(o.set(A.worldMatrix.elements[12],A.worldMatrix.elements[13],A.worldMatrix.elements[14]),o.applyMatrix4(l.worldMatrixInverse),o.applyMatrix4(l.projectionMatrix),u.copy(o),v.x=0+u.x*q+q-8,v.y=0+u.y*r+r-8,w.containsPoint(v)===!0){h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,f),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,f),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGB,v.x/2,v.y/2,16,16,0),h.uniform1i(e.renderType,0),h.uniform2f(e.scale,t.x,t.y),h.uniform3f(e.screenPosition,u.x,u.y,u.z),h.disable(h.BLEND),h.enable(h.DEPTH_TEST),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),h.uniform1i(e.renderType,1),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,g),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,v.x/2,v.y/2,16,16,0),h.uniform1i(e.renderType,1),h.disable(h.DEPTH_TEST),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,f),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),A.positionScreen=u,A.customUpdateCallback?A.customUpdateCallback(A):A.updateLensFlares(),h.uniform1i(e.renderType,2),h.enable(h.BLEND);for(var B=0,C=A.lensFlares.length;C>B;B++){var D=A.lensFlares[B];D.opacity>.001&&D.scale>.001&&(u.x=D.x,u.y=D.y,u.z=D.z,s=D.size*D.scale/n,t.x=s*p,t.y=s,h.uniform3f(e.screenPosition,u.x,u.y,u.z),h.uniform2f(e.scale,t.x,t.y),h.uniform1f(e.rotation,D.rotation),h.uniform1f(e.opacity,D.opacity),h.uniform3f(e.color,D.color.r,D.color.g,D.color.b),i.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,f),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,D.texture),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0))}}}h.enable(h.CULL_FACE),h.enable(h.DEPTH_TEST)}}},this.createProgram=function(a){var b=h.createProgram(),c=h.createShader(h.FRAGMENT_SHADER),d=h.createShader(h.VERTEX_SHADER),e="precision "+j+" float;\n";return h.shaderSource(c,e+a.fragmentShader),h.shaderSource(d,e+a.vertexShader),h.compileShader(c),h.compileShader(d),h.attachShader(b,c),h.attachShader(b,d),h.linkProgram(b),b},this.disable=function(){this.enable&&(h.disableVertexAttribArray(d.vertex),h.disableVertexAttribArray(d.uv),i._oldDoubleSided||h.enable(h.CULL_FACE),i._oldBlending===$b.NoBlending&&h.disable(h.BLEND),xc.setDepthWrite(!0,i),this.enable=!1,this.lastMaterialId=null,i.pm.currentProgram=null)}};var yc=function(a,b,c){this.width=a,this.height=b,c=c||{},this.wrapS=c.wrapS!==e?c.wrapS:$b.ClampToEdgeWrapping,this.wrapT=c.wrapT!==e?c.wrapT:$b.ClampToEdgeWrapping,this.magFilter=c.magFilter!==e?c.magFilter:$b.LinearFilter,this.minFilter=c.minFilter!==e?c.minFilter:$b.LinearMipMapLinearFilter,this.anisotropy=c.anisotropy!==e?c.anisotropy:1,this.offset=new $b.Vec2(0,0),this.repeat=new $b.Vec2(1,1),this.format=c.format!==e?c.format:$b.RGBAFormat,this.type=c.type!==e?c.type:$b.UnsignedByteType,this.depthBuffer=c.depthBuffer!==e?c.depthBuffer:!0,this.stencilBuffer=c.stencilBuffer!==e?c.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null,this.flipY=!0};yc.prototype={constructor:yc,clone:function(){var a=new yc(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.format=this.format,a.type=this.type,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a.generateMipmaps=this.generateMipmaps,a.shareDepthFrom=this.shareDepthFrom,a},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var zc=function(a,b,c){yc.call(this,a,b,c),this.activeCubeFace=0};$b.extend(zc,yc,{});var Bc,Cc="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2017-09-20\nend=2018-01-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=4b5d3387b1c804f09e328970efc02856c399f68a223de3e3912bfb7029f835846b38cac4390349d8cd5782b8df18b2d7199672a05da9044963f6ac80b5ba0d48b89dc3223b280165723d7986f8860921d17308c661ee3e74eea66f33a977c8eb032c8bc5b551cd9c30f54ecc83fbce33f3159691c827bb2a0987556d8e6397582f4bc4801204119e8cdfb4212a980c55360f3cbaed34e6bd63823593add7dea33926b1443cf02e7236f30459bf93721c3c220132bc81b9d49e345c108763370611430e699c3dd24d995d1bfd7c0e6148cf751228c3ff48c6336d040620797bf52df2ed3ab6a54f54116887e6693d50e5d5013e4e94ef9cfd5752f715db00757709eb88fba1f17ba6b5d9580f07ec1e1f55a780db9511f2049ef476fdd3d8dac62f39cf1418b299d1f091bae8738655bbaf228d58386685dff89992ed6ed06061c0c67203d9b687ec1bfa875bf655b73e0409265deee9c213f34bf0a4a9f3b6d2c07b6f317ff6ac1eb623e079d9f248accf031861b1149876dcdd27ebc754af1864b918712cad43e92d0b9b607828c9db6c93e80a243313ef79dee9aa6d0445d55bd21559a8dc99ddaf0c49b69a422f12915f5bf2117e63370c3a870c7e2bea3a5b6c78f6318ea4a6b098e3ec8c16aa72fb08a146093e7203b7a1fdf63f3a99e5bfa5cd8a223b16abc087d9f8d1e1dcd130d563d2d9528ac61717748a9f912a4720e1925805e4eecaa5d0473ab3b25e308c9de18931d63dcebff0e45d535bfaa2b79306569446f8d2a4d946e77aaca343ef27cc98deb4a7873c1319874aefd808533819e424fabd2e34692ee552445790b215dc0b2a40be47f16e29d4a6415c416545c33663bfe08b717272263805b190c1010735dfc926fe08b7f6d1647e37c9",Dc=0xdeadbeefcafe,Ec=15715070==(16777215&Dc);Ec&&"Microsoft Internet Explorer"==navigator.appName?(q.prototype.am=v,Bc=30):Ec&&"Netscape"!=navigator.appName?(q.prototype.am=t,Bc=26):(q.prototype.am=w,Bc=28),q.prototype.DB=Bc,q.prototype.DM=(1<<Bc)-1,q.prototype.DV=1<<Bc;var Fc=52;q.prototype.FV=Math.pow(2,Fc),q.prototype.F1=Fc-Bc,q.prototype.F2=2*Bc-Fc;var Gc,Hc,Ic="0123456789abcdefghijklmnopqrstuvwxyz",Jc=new Array;for(Gc="0".charCodeAt(0),Hc=0;9>=Hc;++Hc)Jc[Gc++]=Hc;for(Gc="a".charCodeAt(0),Hc=10;36>Hc;++Hc)Jc[Gc++]=Hc;for(Gc="A".charCodeAt(0),Hc=10;36>Hc;++Hc)Jc[Gc++]=Hc;T.prototype.convert=U,T.prototype.revert=V,T.prototype.reduce=W,T.prototype.mulTo=X,T.prototype.sqrTo=Y,$.prototype.convert=_,$.prototype.revert=aa,$.prototype.reduce=ba,$.prototype.mulTo=da,$.prototype.sqrTo=ca,q.prototype.copyTo=z,q.prototype.fromInt=A,q.prototype.fromString=C,q.prototype.clamp=D,q.prototype.dlShiftTo=K,q.prototype.drShiftTo=L,q.prototype.lShiftTo=M,q.prototype.rShiftTo=N,q.prototype.subTo=O,q.prototype.multiplyTo=P,q.prototype.squareTo=Q,q.prototype.divRemTo=R,q.prototype.invDigit=Z,q.prototype.isEven=ea,q.prototype.exp=fa,q.prototype.toString=E,q.prototype.negate=F,q.prototype.abs=G,q.prototype.compareTo=H,q.prototype.bitLength=J,q.prototype.mod=S,q.prototype.modPowInt=ga,q.ZERO=B(0),q.ONE=B(1),Za.prototype.convert=$a,Za.prototype.revert=$a,Za.prototype.mulTo=_a,Za.prototype.sqrTo=ab,eb.prototype.convert=fb,eb.prototype.revert=gb,eb.prototype.reduce=hb,eb.prototype.mulTo=jb,eb.prototype.sqrTo=ib;var Kc=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Lc=(1<<26)/Kc[Kc.length-1];q.prototype.chunkSize=la,q.prototype.toRadix=na,q.prototype.fromRadix=oa,q.prototype.fromNumber=pa,q.prototype.bitwiseTo=ua,q.prototype.changeBit=La,q.prototype.addTo=Pa,q.prototype.dMultiply=Xa,q.prototype.dAddOffset=Ya,q.prototype.multiplyLowerTo=cb,q.prototype.multiplyUpperTo=db,q.prototype.modInt=mb,q.prototype.millerRabin=pb,q.prototype.clone=ha,q.prototype.intValue=ia,q.prototype.byteValue=ja,q.prototype.shortValue=ka,q.prototype.signum=ma,q.prototype.toByteArray=qa,q.prototype.equals=ra,q.prototype.min=sa,q.prototype.max=ta,q.prototype.and=wa,q.prototype.or=ya,q.prototype.xor=Aa,q.prototype.andNot=Ca,q.prototype.not=Da,q.prototype.shiftLeft=Ea,q.prototype.shiftRight=Fa,q.prototype.getLowestSetBit=Ha,q.prototype.bitCount=Ja,q.prototype.testBit=Ka,q.prototype.setBit=Ma,q.prototype.clearBit=Na,q.prototype.flipBit=Oa,q.prototype.add=Qa,q.prototype.subtract=Ra,q.prototype.multiply=Sa,q.prototype.divide=Ua,q.prototype.remainder=Va,q.prototype.divideAndRemainder=Wa,q.prototype.modPow=kb,q.prototype.modInverse=nb,q.prototype.pow=bb,q.prototype.gcd=lb,q.prototype.isProbablePrime=ob,q.prototype.square=Ta,qb.prototype.init=rb,qb.prototype.next=sb;var Mc,Nc,Oc,Pc=256;if(null==Nc){Nc=new Array,Oc=0;var Qc;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&d.crypto){var Rc=d.crypto.random(32);for(Qc=0;Qc<Rc.length;++Qc)Nc[Oc++]=255&Rc.charCodeAt(Qc)}for(;Pc>Oc;)Qc=Math.floor(65536*Math.random()),Nc[Oc++]=Qc>>>8,Nc[Oc++]=255&Qc;Oc=0,vb()}yb.prototype.nextBytes=xb;Bb.prototype.doPublic=Db,Bb.prototype.setPublic=Cb,Bb.prototype.encrypt=Eb,Bb.prototype.doPrivate=Ib,Bb.prototype.setPrivate=Gb,Bb.prototype.setPrivateEx=Hb,Bb.prototype.decrypt=Jb;var Sc=function(){Tc.v(Cc)},Tc={},Uc="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",Vc="10001",Wc="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",Xc="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";Tc.cross=function(a){if(a){for(var b="",c=0;c<a.length;)c+1<a.length?(b+=a[c+1],b+=a[c]):b+=a[c],c+=2;return b}return null},Tc.reverse=function(a){if(a){for(var b="",c=a.length;c>0;c--)b+=a[c-1];return b}return null},Tc.v=function(a){if(a){var b=Tc;if(b.start=null,b.beginDate=null,b.end=null,b.endDate=null,b.gis=null,b["3D"]=null,b["3d"]=null,b.l=null,b.__li__=null,a.indexOf("signature=")>0){var c=a.split("signature="),d=c[0],e=c[1],f=new Bb;f.setPublic(Uc,Vc);for(var g=e,h=g.length,i=256,j=0,k="",l="";h>j;)k=g.substr(j,i),l+=f.decrypt(k),j+=i;if(l===d)return b.i(a),!0}}return!1},Tc.i=function(a){var b=Tc;b.__li__=a;var c,d,f,g,h,i=a.split("\n");for(c=0;c<i.length;c++)d=i[c],h=d.split("="),f=h[0],g=h[1],b[f]=g;b.start!=e&&(b.beginDate=new Date(Date.parse(b.start.replace(/-/g,"/")))),b.end!=e&&(b.endDate=new Date(Date.parse(b.end.replace(/-/g,"/"))));var j=b.gis;j!=e&&(j=parseInt(j)),j&&(b._isPermissionGIS=!0);var k=b["3D"]||b["3d"];k!=e&&(k=parseInt(k)),k&&(b._isPermission3D=!0),b.l!=e&&(b.version=b.l)};var Yc=function(a){return a.__li__!==e&&a._isPermission3D},Zc=function(a){if(!Yc(a))return!0;var b=new Date;return null!=a.beginDate&&a.beginDate.getTime()-b.getTime()>=0||null!=a.endDate&&a.endDate.getTime()-b.getTime()<=0};Tc.$z=function(a){var b=new Bb;b.setPublic(Uc,Vc);for(var c=a,d=c.length,e=256,f=0,g="",h="";d>f;)g=c.substr(f,e),h+=b.decrypt(g),f+=e;return h},Tc.twm=function(a){var b=Tc,c=b.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),d=this.type,f=this.markText,g=b.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");a[g]=b.__li__;var h=a;if(h._xyz=null,"3"!==d||Zc(Tc)||f!==e){a.DEBUG&&(console.log("license: "+Tc.__li__),console.log("license Type : "+d),console.log("beginDate: "+Tc.beginDate),console.log("endDate: "+Tc.endDate),console.log("mark: "+f)),a.__liLabel==e&&(a.__liLabel=document.createElement("div")),b.startDate===e&&(b.startDate=new Date);var i=(new Date).getTime()-b.startDate.getTime(),j="2"===d?7200:300;if(!(1e3*j>i)){var k=Zc(b)&&i>1e3*j,l=f;if(k?l=b.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=d||l!==e&&""!=l?"1"==d&&!f&&(l=c):l=b.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),l!==e){var m=h.__liLabel;m.innerHTML=l,m.type=d,m.mark=f,m.expired=k,h._xyz=m,k&&(h.getView().style.opacity=.1)}}}},uc.validateLicense(Cc),$b.Material=function(a){$b.PropertyChangeDispatcher.call(this),this.id=$b.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=e,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=$b.FrontSide,this.fog=!0,this.normalType=e,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecolor=new $b.Color(16777215),this.wireframeLineopacity=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=2,this.gradientColors=3,this.blendMode=$b.NormalBlending,this.blendSrc=$b.SrcAlphaFactor,this.blendDst=$b.OneMinusSrcAlphaFactor,this.blendEquation=$b.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(a),this.useCount=0,this.styleMap={},this.offset=new _b(0,0),this.repeat=new _b(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new _b(.5,.5),this.outline=0},$b.extend($b.Material,$b.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(a,b){if(null==b&&(b="map"),this[b]!==a){var c=this[b];this[b]=a,this.firePropertyChange(b,c,a),this.onMapChanged(c,a)}},handleTextureChange:function(a){if("image"===a.property){this.firePropertyChange("needsUpdate",!1,!0)}else"disposed"===a.property},onPropertyChange:function(a,b,c){},onMapChanged:function(a,b){},setColor:function(a){if(this.color!==a){var b=this.color.clone();a instanceof $b.Color?this.color.copy(a):this.color.set(a),this.firePropertyChange("color",b,a)}},setPropertyValue:function(a,b){if(this[a]!==b){var c=this[a];if(c instanceof $b.Color)null!=b&&(c=c.clone(),b instanceof $b.Color?this[a].copy(b):this[a].set(b));else if("gradient"==a){var d={};for(var e in b)b[e]instanceof $b.Color?d[e]=b[e]:d[e]=new $b.Color(b[e]);this[a]=d}else this[a]=b;this._uniqueCode=null,this.firePropertyChange(a,c,b)}},isTextureStyle:function(a){return"terrain"===this._type?a.startsWith("texture1.")||a.startsWith("texture2.")||a.startsWith("textureb.")||a.startsWith("texturen.")||a.startsWith("texturebp."):a.startsWith("texture.")||a.startsWith("lightmap")||a.startsWith("envmap")||a.startsWith("normalmap")||a.startsWith("specularmap")},setNeedsUpdate:function(a){},getShaderID:function(){return this instanceof $b.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var a=this.getShaderID(),b=$b.ShaderLib[a];b&&(this.uniforms=$b.UniformsUtils.clone(b.uniforms),this.vertexShader=b.vertexShader,this.fragmentShader=b.fragmentShader)},refreshUniforms:function(a,b){this.refreshUniformsCommon(a,b),this.refreshUniformsSpecific(a,b)},loadCameraPosition:function(a,b,c){if((this instanceof $b.ShaderMaterial||this instanceof $b.PhongMaterial||this.envMap||"phong"===this._type)&&null!=a.cameraPosition){var d=b.worldMatrix.getPosition();c.uniform3f(a.cameraPosition,d.x,d.y,d.z)}},loadViewMatrix:function(a,b,c){("lambert"===this.type||"phong"===this.type||material.skinning)&&null!==a.viewMatrix&&c.uniformMatrix4fv(p_uniforms.viewMatrix,!1,b.worldMatrixInverse.elements)},refreshUniformsSpecific:function(a){},refreshUniformsCommon:function(a){var b=this.uniforms,c=this;b.opacity.value=c.opacity,b.wireframeLinecolor.value=c.wireframeLinecolor,b.wireframeLineopacity.value=c.wireframeLineopacity;var d=uc.getObjectCount(this.gradient)>0;if(a?b.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):b.diffuse.value=this.alarmColor?this.alarmColor:this.color,d){var f=[],g=[];for(var h in this.gradient)f.push(h);f.sort();for(var i=0;i<f.length;i++)g.push(this.gradient[f[i]]);b.gradientColor.value=g,b.gradientStop.value=f,b.gradientType.value=this.gradientType}b.map.value=c.map,b.lightMap.value=c.lightMap,b.specularMap.value=c.specularMap,c.bumpMap&&(b.bumpMap.value=c.bumpMap,b.bumpScale.value=c.bumpScale),c.normalMap&&"phong"===c._type&&(b.normalMap.value=c.normalMap,b.normalScale.value.copy(c.normalScale));var j;if(c.map?j=c.map:c.specularMap?j=c.specularMap:c.normalMap&&"phong"===c._type?j=c.normalMap:c.bumpMap&&"phong"===c._type&&(j=c.bumpMap),j!=e){var k=this.offset,l=this.repeat;b.offsetRepeat.value.set(k.x,k.y,l.x,l.y),b.flipX.value=j.flipX?1:0,b.mapLoaded.value=1,j._image&&!j._image.loaded&&b.offsetRepeat.value.set(0,0,1,1)}b.envMap.value=c.envMap,b.flipEnvMap.value=1,a?b.reflectivity.value=c.reflectRatio*c.reflectRatio:b.reflectivity.value=c.reflectRatio,b.refractionRatio.value=c.refractionRatio,b.combine.value=c.combine,b.useRefract.value=c.envMap&&c.envMap.mapping instanceof $b.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){var a=this&&this.normalType!==e&&this.normalType===$b.NormalTypeSmooth;return a?$b.SmoothShading:$b.FlatShading},isVertexColor:function(){return this.vertexColors?this.vertexColors:!1},isGradientColor:function(){return this.gradientColors?this.gradientColors:!1},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap?!0:!0},setValues:function(a){if(a!==e)for(var b in a){var c=a[b];if(c!==e){if(b in this){var d=this[b];d instanceof $b.Color&&c instanceof $b.Color?d.copy(c):d instanceof $b.Color?d.set(c):d instanceof $b.Vec3&&c instanceof $b.Vec3?d.copy(c):this[b]=c}}else console.warn("TGL.Material: '"+b+"' parameter is undefined.")}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var a in this.attributes)if(this.attributes[a].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var a in this.attributes)this.attributes[a].needsUpdate=!1},clone:function(a){return a===e&&(a=new $b.Material),a.name=this.name,a.side=this.side,a.blendMode=this.blendMode,a.blendSrc=this.blendSrc,a.blendDst=this.blendDst,a.blendEquation=this.blendEquation,a.depthTest=this.depthTest,a.depthMask=this.depthMask,a.polygonOffset=this.polygonOffset,a.polygonOffsetFactor=this.polygonOffsetFactor,a.polygonOffsetUnits=this.polygonOffsetUnits,a.alphaTest=this.alphaTest,a.transparent=this.transparent,a.opacity=this.opacity,a.visible=this.visible,a.normalType=this.normalType,a.wireframe=this.wireframe,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecolor=this.wireframeLinecolor.clone(),a.wireframeLineopacity=this.wireframeLineopacity,a.gradient=this.gradient,a.gradientType=this.gradientType,a.outline=this.outline,a},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),$b.MaterialIdCount=0,$b.EntityMaterial=function(a){$b.Material.call(this),this._type="basic",this.color=new $b.Color(16777215),this.map=null,this.ambient=new $b.Color(16777215),this.emissive=new $b.Color(0),this.specular=new $b.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new $b.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new $b.Vec2(1,1),this.envMap=null,this.combine=$b.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=$b.SmoothShading,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new _b(0,1),this.setValues(a),this.bakeLightMap=!1,this.metalness=0,this.roughness=0},$b.extend($b.EntityMaterial,$b.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var a=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.wireframeLinecolor+" "+this.wireframeLineopacity+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;if(this.alphaTest&&(a+=this.alphaTest),a+=" "+this.normalType+" ",a+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,a+=" "+this.blendRange.x+" "+this.blendRange.y,a+=" "+this.normalScale.x+" "+this.normalScale.y,a+=" "+this.reflectRatio,this.map&&(a+=this.map.getUniqueCode()),this.map1&&(a+=this.map1.getUniqueCode()),this.map2&&(a+=this.map2.getUniqueCode()),this.blendMap&&(a+=this.blendMap.getUniqueCode()),this.normalMap&&(a+=this.normalMap.getUniqueCode()),this.lightMap&&(a+=this.lightMap.getUniqueCode()),this.envMap&&(a+=this.envMap.getUniqueCode()),this.specularMap&&(a+=this.specularMap.getUniqueCode()),this.alarmColor&&(a+=" "+this.alarmColor.getUniqueCode()),this.roughness&&(a+=" "+this.roughness),this.metalness&&(a+=" "+this.metalness),this.gradient)for(var b in this.gradient)a+=" "+b+":"+this.gradient[b].getUniqueCode();return a+=" "+this.gradientType,a+=" "+this.outline,a+=this.combine,a+=this.bakeLightMap?" bakeLightMap ":"",this._uniqueCode=a,a},loadViewMatrix:function(a,b,c){("lambert"===this._type||"phong"===this._type||material.skinning)&&null!==a.viewMatrix&&c.uniformMatrix4fv(p_uniforms.viewMatrix,!1,b.worldMatrixInverse.elements)},onMapChanged:function(a,b){if($b.TexturePool.useTexture(b),$b.TexturePool.unUseTexture(a),b){var c=b.getUniqueCode();null==$b.TexturePool.getTexture(c)&&$b.TexturePool.setTexture(c,b)}},setType:function(a){if(this._type!==a){var b=this._type;this._type=a,this.firePropertyChange("type",b,a),this.onTypeChanged(b,a)}},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(a,b){if(null!=a){null==this.styleMap&&(this.styleMap={});var c=this.styleMap[a];return null==b?delete this.styleMap[a]:this.styleMap[a]=b,this.firePropertyChange($b.Styles.PREFIX_STYLE+a,c,b),this.onStyleChanged(a,c,b),this}},getStyle:function(a,b){null==b&&(b=!0);var c;return null!=this.styleMap&&(c=this.styleMap[a]),null==c&&b&&(c=$b.Styles.getStyle(a)),c},clone:function(a){return a=a||new $b.EntityMaterial,$b.Material.prototype.clone.call(this,a),a._type=this._type,a.color.copy(this.color),a.wireframeLinecolor.copy(this.wireframeLinecolor),a.setMap(this.map,"map"),a.setMap(this.map1,"map1"),a.setMap(this.map2,"map2"),a.setMap(this.blendMap,"blendMap"),a.setMap(this.normalMap,"normalMap"),a.setMap(this.specularMap,"specularMap"),a.setMap(this.envMap,"envMap"),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.specular.copy(this.specular),a.shininess=this.shininess,a.metal=this.metal,a.perPixel=this.perPixel,a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.setMap(this.lightMap,"lightMap"),a.bumpMap=this.bumpMap,a.bumpScale=this.bumpScale,a.normalScale.copy(this.normalScale),a.combine=this.combine,a.reflectRatio=this.reflectRatio,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a.specularStrength=this.specularStrength,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.blendRange.copy(this.blendRange),a.metalness=this.metalness,a.roughness=this.roughness,a},refreshUniformsSpecific:function(a){var b=this.uniforms;"lambert"===this._type?(a?(b.ambient.value.copyGammaToLinear(this.ambient),b.emissive.value.copyGammaToLinear(this.emissive)):(b.ambient.value=this.ambient,b.emissive.value=this.emissive),this.wrapAround&&b.wrapRGB.value.copy(this.wrapRGB)):"phong"===this._type?(b.shininess.value=this.shininess,a?(b.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),b.emissive.value.copyGammaToLinear(this.emissive),b.specular.value.copyGammaToLinear(this.specular)):(b.ambient.value=this.alarmColor?this.alarmColor:this.ambient,b.emissive.value=this.emissive,b.specular.value=this.specular),b.uspecularStrength.value=this.specularStrength,this.wrapAround&&b.wrapRGB.value.copy(this.wrapRGB)):"physic"===this._type&&(b.metalness.value=this.metalness,b.roughness.value=this.roughness)},refreshUniformsCommon:function(a){if("terrain"===this._type){var b=this.uniforms;b.enableDiffuse1.value=this.map?1:0,b.tDiffuse1.value=this.map,b.enableDiffuse2.value=this.map1?1:0,b.tDiffuse2.value=this.map1,b.enableDiffuse3.value=this.map2?1:0,b.tDiffuse3.value=this.map2,b.enableDisplacement.value=this.blendMap?1:0,b.tDisplacement.value=this.blendMap,b.uRepeatOverlay.value=this.repeat,null==this.blendRangeArray&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,b.blendRange.value=this.blendRangeArray,b.uOpacity.value=this.opacity}else if("outline"===this._type){var b=this.uniforms;b.diffuse.value=this.color,b.outline_offset.value=this.outline}else $b.Material.prototype.refreshUniformsCommon.call(this,a)}}),$b.BlurMaterial=function(){$b.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new _b(512,512),this.blurGlobalAlpha=1},$b.extend($b.BlurMaterial,$b.Material,{refreshUniformsCommon:function(a){var b=this.uniforms;b.map.value=this.map,b.orientation.value=this.orientation,b.blurAmount.value=this.blurAmount,b.blurScale.value=this.blurScale,b.blurStrength.value=this.blurStrength,b.useBlur.value=this.useBlur,b.texelSize.value=this.texelSize,b.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),$b.DeferredMaterial=function(a){a=a||{},$b.Material.call(this,a),this.linearDepth=30,this.isNormal=a.isNormal!==e?a.isNormal:0},$b.extend($b.DeferredMaterial,$b.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(a){var b=this.uniforms;b.linearDepth.value=this.linearDepth,b.isNormal.value=this.isNormal}}),$b.SSAOMaterial=function(a){$b.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new _b(1,.02),this.texelSize=new _b(1/512,1/512)},$b.extend($b.SSAOMaterial,$b.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(a){var b=this.uniforms;b.map0.value=this.map,b.map1.value=this.map1,b.map2.value=this.map2,b.occluderBias.value=this.occluderBias,b.samplingRadius.value=this.samplingRadius,b.attenuation.value=this.attenuation,b.texelSize.value=this.texelSize}}),$b.BasicMaterial=function(a){$b.Material.call(this),this._type="basic",this.color=new $b.Color(16777215),this.map=null,this.setValues(a),this.offset=new _b(0,0),this.repeat=new _b(1,1)},$b.extend($b.BasicMaterial,$b.Material,{getShaderID:function(){return"basic"},clone:function(){var a=new $b.BasicMaterial;return $b.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a},getUniqueCode:function(){var a=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return a+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(a+=this.map.getUniqueCode()),a}}),$b.LambertMaterial=function(a){$b.Material.call(this),this._type="basic",this.color=new $b.Color(16777215),this.ambient=new $b.Color(16777215),this.emissive=new $b.Color(0),this.wrapAround=!1,this.wrapRGB=new $b.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=$b.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=$b.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=$b.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},$b.extend($b.LambertMaterial,$b.Material,{clone:function(){var a=new $b.LambertMaterial;return $b.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(a){var b=this.uniforms;a?(b.ambient.value.copyGammaToLinear(this.ambient),b.emissive.value.copyGammaToLinear(this.emissive)):(b.ambient.value=this.ambient,b.emissive.value=this.emissive),this.wrapAround&&b.wrapRGB.value.copy(this.wrapRGB);
}}),$b.PhongMaterial=function(a){$b.Material.call(this),this._type="basic",this.color=new $b.Color(16777215),this.ambient=new $b.Color(16777215),this.emissive=new $b.Color(0),this.specular=new $b.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new $b.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new $b.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=$b.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=$b.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=$b.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a),this.offset=new _b(0,0),this.repeat=new _b(1,1)},$b.extend($b.PhongMaterial,$b.Material,{getUniqueCode:function(){var a="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return a+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(a+=this.map.getUniqueCode()),a},clone:function(){var a=new $b.PhongMaterial;return $b.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.specular.copy(this.specular),a.shininess=this.shininess,a.metal=this.metal,a.perPixel=this.perPixel,a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.bumpMap=this.bumpMap,a.bumpScale=this.bumpScale,a.normalMap=this.normalMap,a.normalScale.copy(this.normalScale),a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(a){var b=this.uniforms;b.shininess.value=this.shininess,a?(b.ambient.value.copyGammaToLinear(this.ambient),b.emissive.value.copyGammaToLinear(this.emissive),b.specular.value.copyGammaToLinear(this.specular)):(b.ambient.value=this.ambient,b.emissive.value=this.emissive,b.specular.value=this.specular),this.wrapAround&&b.wrapRGB.value.copy(material.wrapRGB)}}),$b.LineMaterial=function(a){$b.Material.call(this),this.color=new $b.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new $b.Color(16777215),this.horizonColor=new $b.Color(16777215),this.earthColor=new $b.Color(16777215),this.vertexColors=!1,this.gradientColors=!0,this.fog=!0,this.setValues(a)},$b.extend($b.LineMaterial,$b.Material,{getUniqueCode:function(){var a=this.color.getUniqueCode+" "+this.linewidth+" "+this.dashed+" "+this.visible;return a+=this.transparent+" "+this.opacity,a+=this.skyY+" "+this.horizonY+" "+this.earthY,a+=this.skyColor.getUniqueCode(),a+=this.horizonColor.getUniqueCode(),a+=this.earthColor.getUniqueCode()},clone:function(){var a=new $b.LineMaterial;return $b.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.linecap=this.linecap,a.linejoin=this.linejoin,a.dashed=this.dashed,a.scale=this.scale,a.dashSize=this.dashSize,a.gapSize=this.gapSize,a.vertexColors=this.vertexColors,a.fog=this.fog,a},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(a){Kb(this.uniforms,this),this.dashed&&Lb(this.uniforms,this)}}),$b.LineXMaterial=function(a){$b.Material.call(this),this.color=new $b.Color(16777215),this.side=$b.DoubleSide,this.attributes={positionPrev:{type:"v3",ref:"verticesPrev"},positionNext:{type:"v3",ref:"verticesNext"},offset:{type:"f",ref:"offset"},lineDistances:{type:"f",ref:"lineDistances"}},this.useVertexColor=!1,this.totalSize=0,this.dashSize=0},$b.extend($b.LineXMaterial,$b.Material,{getUniqueCode:function(){var a=this.color.getUniqueCode()+this.visible;return a+=this.transparent+" "+this.opacity,a+=this.side,a+=this.useVertexColor,this.totalSize&&(a+=this.totalSize),this.dashSize&&(a+=this.dashSize),a},clone:function(){var a=new $b.LineXMaterial;return $b.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.useVertexColor=this.useVertexColor,a.dashSize=this.dashSize,a.totalSize=this.totalSize,a},getShaderID:function(){return"linex"},refreshUniforms:function(a,b){if(this.uniforms.lineColor.value=this.color,this.uniforms.opacity.value=this.opacity,b.network){var c=b.network.getView();this.uniforms.viewport.value=new $b.Vec4(0,0,c.width,c.height)}b.camera&&(this.uniforms.near.value=b.camera.near||1),this.uniforms.useVertexColor.value=this.useVertexColor?1:0,this.uniforms.dashSize.value=this.dashSize,this.uniforms.totalSize.value=this.totalSize}}),$b.SurfaceMaterial=function(a){$b.EntityMaterial.call(this),this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new $b.Color(16777215),this.horizonColor=new $b.Color(16777215),this.earthColor=new $b.Color(16777215)},$b.extend($b.SurfaceMaterial,$b.EntityMaterial,{getUniqueCode:function(){var a=$b.EntityMaterial.prototype.getUniqueCode.call(this);return this.skyColor&&(a+=" "+this.skyColor.getUniqueCode()),this.horizonColor&&(a+=" "+this.horizonColor.getUniqueCode()),this.earthColor&&(a+=" "+this.earthColor.getUniqueCode()),a+=" "+this.skyY,a+=" "+this.horizonY,a+=" "+this.earthY,this._uniqueCode=a,a},clone:function(){var a=new $b.SurfaceMaterial;return $b.EntityMaterial.prototype.clone.call(this,a),a.skyY=this.skyY,a.horizonY=this.horizonY,a.earthY=this.earthY,a.skyColor=this.skyColor,a.horizonColor=this.horizonColor,a.earthColor=this.earthColor,a},refreshUniforms:function(a){$b.EntityMaterial.prototype.refreshUniforms.call(this,a),Mb(this.uniforms,this)}}),$b.ArrayMaterial=function(a){this.materials=a||[]},$b.extend($b.ArrayMaterial,Object,{clone:function(){for(var a=new $b.ArrayMaterial,b=0;b<this.materials.length;b++){var c=this.materials[b],d=this.materials.indexOf(c);null!=a.materials[d]?a.materials.push(a.materials[d]):a.materials.push(c.clone())}return a}}),$b.BillboardMaterial=function(a){$b.Material.call(this),this.alignment=$b.BillboardAlignment.center.clone(),this.fog=!1,this.color=new $b.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.offset=new $b.Vec2(0,0),this.repeat=new $b.Vec2(1,1),this.transparent=!0,this.setValues(a),this.depthMask=!0,this.vertical=!1,this.fixedSize=0,this.alphaTest=0},$b.extend($b.BillboardMaterial,$b.Material,{clone:function(a){return a=a?a:new $b.BillboardMaterial,$b.Material.prototype.clone.call(this,a),a.alignment.copy(this.alignment),a.color.copy(this.color),a.map=this.map,a.rotation=this.rotation,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.fog=this.fog,a.vertical=this.vertical,a.transparent=this.transparent,a.alphaTest=this.alphaTest,a.blendMode=this.blendMode,a.fixedSize=this.fixedSize,a},getUniqueCode:function(){var a="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return a+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,a+=this.fixedSize,a+=this.repeat.x+" "+this.repeat.y,a+=this.offset.x+" "+this.offset.y,a+=" "+this.blendMode,this.map&&(a+=this.map.getUniqueCode()),a}}),$b.BillboardAlignment={},$b.BillboardAlignment.topLeft=new $b.Vec2(.5,-.5),$b.BillboardAlignment.topCenter=new $b.Vec2(0,-.5),$b.BillboardAlignment.topRight=new $b.Vec2(-.5,-.5),$b.BillboardAlignment.centerLeft=new $b.Vec2(.5,0),$b.BillboardAlignment.center=new $b.Vec2(0,0),$b.BillboardAlignment.centerRight=new $b.Vec2(-.5,0),$b.BillboardAlignment.bottomLeft=new $b.Vec2(.5,.5),$b.BillboardAlignment.bottomCenter=new $b.Vec2(0,.5),$b.BillboardAlignment.bottomRight=new $b.Vec2(-.5,.5);var $c=function(a){$b.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms=a.uniforms||{},this.defines={},this.attributes=null,this.shaderID=a.shaderID||"depth",this._type="shader",this.shading=$b.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=$b.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(a)};$b.ShaderMaterial=$c,$b.extend($b.ShaderMaterial,$b.Material,{clone:function(){var a=new $b.ShaderMaterial;return $b.Material.prototype.clone.call(this,a),a.fragmentShader=this.fragmentShader,a.vertexShader=this.vertexShader,a.uniforms=$b.UniformsUtils.clone(this.uniforms),a.attributes=this.attributes,a.defines=this.defines,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.fog=this.fog,a.lights=this.lights,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},setupMaterialShader:function(){},needUV:function(){return!0},getShaderID:function(){return this.shaderID},refreshUniformsCommon:function(a,b){}}),$b.TransformGizmoMaterial=function(a){$b.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=$b.DoubleSide,this.transparent=!0,this.setValues(a)},$b.extend($b.TransformGizmoMaterial,$b.BasicMaterial,{getUniqueCode:function(){var a=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(a+=this.map.getUniqueCode()),a}});var _c={pools:{},useTimes:{},size:0,getMaterial:function(a){return _c.pools[a]},setMaterial:function(a,b){_c.size++,_c.pools[a]=b},useMaterial:function(a){if(a){var b=a.id,c=_c.useTimes[b]||0;c++,_c.useTimes[b]=c}},unUseMaterial:function(a){if(a){var b=a.id,c=_c.useTimes[b]||0;if(c--,_c.useTimes[b]=c,0>=c){var d=a.getUniqueCode();delete _c.pools[d],_c.size--,a.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};$b.MaterialPool=_c,_c.DefaultMaterial=new $b.EntityMaterial,_c.TestMaterial=new $b.EntityMaterial,_c.DefaultBillBoardMaterial=new $b.BillboardMaterial,_c.DefaultLineMaterial=new $b.LineMaterial,$b.ParticleMaterial=function(a){$b.Material.call(this),this.color=new $b.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(a)},$b.extend($b.ParticleMaterial,$b.Material,{clone:function(){var a=new $b.ParticleMaterial;return $b.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.size=this.size,a.sizeAttenuation=this.sizeAttenuation,a.vertexColors=this.vertexColors,a.fog=this.fog,a},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},getUniqueCode:function(){var a=this.color.getUniqueCode();return a+=map?map.getUniqueCode():"",a+=" "+this.size,a+=" "+this.fog,a+=" "+this.sizeAttenuation,a+=" "+this.transparent,a+=" "+this.opacity,a+=" "+this.depthTest,a+=" "+this.alphaTest},refreshUniforms:function(a){Nb(this.uniforms,this)}}),$b.Light=function(a,b){$b.Element.call(this,b),this.color=new $b.Color(a),this.ambient=new $b.Color,this.diffuse=new $b.Color,this.specular=new $b.Color,this.castShadow=!1,this.onlyShadow=!1},$b.extend($b.Light,$b.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:$b.Light,className:"TGL.Light",setCastShadow:function(a){this.castShadow=a},setOnlyShadow:function(a){this.onlyShadow=a},refreshShadowUniforms:function(a,b){var c=this;return a.shadowMatrix&&c.castShadow&&(c instanceof $b.SpotLight||c instanceof $b.DirectionalLight&&!c.shadowCascade)?(a.shadowMap.value[b]=c.shadowMap,a.shadowMapSize.value[b]=c.shadowMapSize,a.shadowMatrix.value[b]=c.shadowMatrix,a.shadowDarkness.value[b]=c.shadowDarkness,a.shadowBias.value[b]=c.shadowBias,!0):void 0},refreshUniformsPointShadow:function(a,b){var c=this;return a.pShadowMap&&c.castShadow&&c instanceof $b.PointLight?(a.pShadowMap.value[b]=c.shadowMap,a.pShadowMapSize.value[b]=c.shadowMapSize,a.pShadowDarkness.value[b]=c.shadowDarkness||.5,a.pPosition.value[b]=c.getPosition(),a.pShadowRadius.value[b]=c.shadowRadius||1,a.shadowCameraNear.value=c.shadowCameraNear,a.shadowCameraFar.value=c.shadowCameraFar,!0):void 0}}),$b.PointLight=function(a,b,c,d){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var f=arguments[0];a=f.hex,b=f.intensity,c=f.distance,d=f.id}$b.Light.call(this,a,d),this.position=new $b.Vec3(0,0,0),this.intensity=b!==e?b:1,this.distance=c!==e?c:0,this.shadowCameraNear=10,this.shadowCameraFar=1e3,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowDarkness=.5},$b.extend($b.PointLight,$b.Light,{constructor:$b.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),$b.SpotLight=function(a,b,c,d,f){$b.Light.call(this,a),this._position=new $b.Vec3(0,1,0),this.target=new $b.Element,this.intensity=b!==e?b:1,this.distance=c!==e?c:0,this.angle=d!==e?d:Math.PI/2,this.exponent=f!==e?f:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},$b.extend($b.SpotLight,$b.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:$b.SpotLight,className:"TGL.SpotLight"}),$b.DirectionalLight=function(a,b,c){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var d=arguments[0];a=d.hex,b=d.intensity,c=d.id}$b.Light.call(this,a,c),this.direction=new $b.Vec3(0,1,0),this.position=new $b.Vec3(0,1,0),this.target=new $b.Element,this.intensity=b!==e?b:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new $b.Vec3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},$b.extend($b.DirectionalLight,$b.Light,{className:"TGL.DirectionalLight",__accessor:["direction"]}),$b.AmbientLight=function(a,b){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var c=arguments[0];a=c.hex,b=c.id}$b.Light.call(this,a,b)},$b.extend($b.AmbientLight,$b.Light,{constructor:$b.AmbientLight,className:"TGL.AmbientLight",clone:function(){var a=new $b.AmbientLight;return $b.Light.prototype.clone.call(this,a),a}}),$b.Camera=function(){$b.Element.call(this),this.projectionMatrix=new $b.Mat4,this.projectionMatrixInverse=new $b.Mat4,this.worldMatrixInverse=new $b.Mat4,this.target=new $b.Vec3,this.setPosition(0,0,500),this.lookat=this.lookAt},$b.extend($b.Camera,$b.Element,{constructor:$b.Camera,updateCameraMatrix:function(a){var b=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!b.equals(this.matrix)&&a&&this.firePropertyChange("matrix",b,this.matrix)},lookAt:function(a,b){3===arguments.length&&a.x===e?(a=new mono.Vec3(arguments[0],arguments[1],arguments[2]),b=e):4===arguments.length&&a.x===e&&(a=new mono.Vec3(arguments[0],arguments[1],arguments[2]),b=arguments[4]),b===e&&(b=!0),this.target=a,this.updateCameraMatrix(b)},look:function(a){3===arguments.length&&a.x===e&&(a=new mono.Vec3(arguments[0],arguments[1],arguments[2])),this.lookAt(a,!0)},onUpChanged:function(a,b){this.updateCameraMatrix()},getTarget:function(){return this.target},t:function(){return this.getTarget()},getDistance:function(){return(new ac).subVectors(this._position,this.target).length()},setDistance:function(a){var b=this.getDistance();this.zoom(a/b)},lookAtElement:function(a,b,c){b instanceof ac?(c=b,b=this.getDistance()):c=c||new ac(0,0,1),a instanceof $b.Element&&(b=b?b:this.getDistance(),this.setPosition(a.worldPosition(c,b)),this.look(a.getWorldPosition()))},zoomOut:function(a){this.zoom(1.1,a)},zoomIn:function(a){this.zoom(.9,a)},zoom:function(a,b){if(a>0){var c=b||this.getDistance();c*=a;var d=(new ac).addVectors(this.target,(new ac).subVectors(this._position,this.target).setLength(c));this.setPosition(d)}}}),$b.OrthoCamera=function(a,b,c,d){$b.Camera.call(this),this.width=a||1,this.aspect=b||1,this.near=c||.1,this.far=d||1e4,this.updateProjectionMatrix()},$b.extend($b.OrthoCamera,$b.Camera,{constructor:$b.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["width","aspect","near","far"],updateProjectionMatrix:function(){var a=this.getDistance(),b=a*this.width/2,c=-b,d=a/this.aspect*this.width/2,e=-d;this.projectionMatrix.makeOrthographic(c,b,d,e,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()},updateCameraMatrix:function(a){$b.Camera.prototype.updateCameraMatrix.call(this,a),this.updateProjectionMatrix()}}),$b.PerspectiveCamera=function(a,b,c,d){$b.Camera.call(this),this.fov=a!==e?a:50,this.aspect=b!==e?b:1,this.near=c!==e?c:1,this.far=d!==e?d:5e4,this.updateProjectionMatrix()},$b.extend($b.PerspectiveCamera,$b.Camera,{constructor:$b.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),$b.VRCamera=function(a,b,c){$b.Camera.call(this),this.network=a,this.vrDisplay=a._vrDisplay,this.near=b!==e?b:.01,this.far=c!==e?c:1e4,this.orientation=[0,0,0,1],this.leftPm=new cc,this.rightPm=new cc,this.leftVm=new cc,this.leftVmInverse=new cc,this.rightVm=new cc,this.rightVmInverse=new cc,this.speed=.01,this.lockY=!1,this.updateProjectionMatrix()},$b.extend($b.VRCamera,$b.Camera,{constructor:$b.VRCamera,className:"TGL.VRCamera",__accessor:["near","far","lockY","speed"],updateCameraMatrix:function(a){},updateMatrix:function(){},updateWorldMatrix:function(a,b){},updateProjectionMatrix:function(){function a(){b=null,c=null,d=null;for(var a=navigator.getGamepads(),e=0;e<a.length;e++){var f=a[e];f&&f.pose&&("right"===f.hand?c=f:b=f,f.buttons.some(function(a,b){return a.pressed?(d=f,!0):void 0}))}}var b,c,d,e=new cc,f=new cc,g=new cc,h=new ac,i=new cc,j=new mono.Quat,k=new mono.Quat;return function(){var l=this,m=l.leftVm,n=l.rightVm,o=l.leftVmInverse,p=l.rightVmInverse,q=l.leftPm,r=l.rightPm,s=l._frameData,t=l.vrDisplay;if(t){if(s||(s=l._frameData=new VRFrameData),t.getFrameData(s),a(),i.set(t.stageParameters.sittingToStandingTransform),d){var u;if(d.buttons.some(function(a,b){return a.pressed?(u=b,!0):void 0}),2===u){h.set(0,0,-l.speed),k.setFromRotationMatrix(i);var v=d.pose.orientation;j.set(v[0],v[1],v[2],v[3]),j.multiplyQuaternions(k,j),h.applyQuaternion(j),l.lockY&&h.setY(0),l.getPosition(!1).add(h)}}l.network.onGamepadChanged&&l.network.onGamepadChanged(b,c,d),e.identity(),e.setPosition(l.getPosition()),e.multiplyMatrices(e,i),f.getInverse(e),g.set(s.leftViewMatrix),o.multiplyMatrices(g,f),m.getInverse(o),g.set(s.rightViewMatrix),p.multiplyMatrices(g,f),n.getInverse(p),q.set(s.leftProjectionMatrix),r.set(s.rightProjectionMatrix)}}}(),onPropertyChange:function(){this.updateProjectionMatrix()}}),$b.CameraHelper=function(a){function b(a,b,d){c(a,d),c(b,d)}function c(a,b){d.vertices.push(new $b.Vec3),d.colors.push(new $b.Color(b)),g[a]===e&&(g[a]=[]),g[a].push(d.vertices.length-1)}var d=new $b.Entity,f=new $b.LineMaterial({color:16777215,vertexColors:$b.FaceColors}),g={},h=16755200,i=16711680,j=43775,k=16777215,l=3355443;b("n1","n2",h),b("n2","n4",h),b("n4","n3",h),b("n3","n1",h),b("f1","f2",h),b("f2","f4",h),b("f4","f3",h),b("f3","f1",h),b("n1","f1",h),b("n2","f2",h),b("n3","f3",h),b("n4","f4",h),b("p","n1",i),b("p","n2",i),b("p","n3",i),b("p","n4",i),b("u1","u2",j),b("u2","u3",j),b("u3","u1",j),b("c","t",k),b("p","c",l),b("cn1","cn2",l),b("cn3","cn4",l),b("cf1","cf2",l),b("cf3","cf4",l),$b.Line.call(this,d.vertices,d.colors,f,$b.LinePieces),this.camera=a,this.worldMatrix=a.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=g,this.update()},$b.CameraHelper.prototype=Object.create($b.Line.prototype),$b.CameraHelper.prototype.update=function(){var a=new $b.Vec3,b=new $b.Camera,c=new $b.Projector;return function(){function d(d,g,h,i){a.set(g,h,i),c.unprojectVector(a,b);var j=f.pointMap[d];if(j!==e)for(var k=0,l=j.length;l>k;k++)f.vertices[j[k]].copy(a)}var f=this,g=1,h=1;b.projectionMatrix.copy(this.camera.projectionMatrix),d("c",0,0,-1),d("t",0,0,1),d("n1",-g,-h,-1),d("n2",g,-h,-1),d("n3",-g,h,-1),d("n4",g,h,-1),d("f1",-g,-h,1),d("f2",g,-h,1),d("f3",-g,h,1),d("f4",g,h,1),d("u1",.7*g,1.1*h,-1),d("u2",.7*-g,1.1*h,-1),d("u3",0,2*h,-1),d("cf1",-g,0,1),d("cf2",g,0,1),d("cf3",0,-h,1),d("cf4",0,h,1),d("cn1",-g,0,-1),d("cn2",g,0,-1),d("cn3",0,-h,-1),d("cn4",0,h,-1),this.verticesNeedUpdate=!0}}();var ad=function(){$b.Element.call(this)};ad.prototype=Object.create($b.Element.prototype),ad.prototype.updateworldMatrix=function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||a)&&(this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),this.worldMatrixNeedsUpdate=!1,a=!0);for(var b=0,c=this.getChildren().size();c>b;b++)this.getChildren().get(b).updateworldMatrix(a)},ad.prototype.translationWorld=new $b.Vec3,ad.prototype.translationObject=new $b.Vec3,ad.prototype.QuatWorld=new $b.Quat,ad.prototype.QuatObject=new $b.Quat,ad.prototype.scaleWorld=new $b.Vec3,ad.prototype.scaleObject=new $b.Vec3;var bd=function(){function a(a,b){var c=new $b.DirectionalLight;c.isVirtual=!0,c.onlyShadow=!0,c.castShadow=!0,c.shadowCameraNear=a.shadowCameraNear,c.shadowCameraFar=a.shadowCameraFar,c.shadowCameraLeft=a.shadowCameraLeft,c.shadowCameraRight=a.shadowCameraRight,c.shadowCameraBottom=a.shadowCameraBottom,c.shadowCameraTop=a.shadowCameraTop,c.shadowCameraVisible=a.shadowCameraVisible,c.shadowDarkness=a.shadowDarkness,c.shadowBias=a.shadowCascadeBias[b],c.shadowMapWidth=a.shadowCascadeWidth[b],c.shadowMapHeight=a.shadowCascadeHeight[b],c.pointsWorld=[],c.pointsFrustum=[];for(var d=c.pointsWorld,e=c.pointsFrustum,f=0;8>f;f++)d[f]=new $b.Vec3,e[f]=new $b.Vec3;var g=a.shadowCascadeNearZ[b],h=a.shadowCascadeFarZ[b];return e[0].set(-1,-1,g),e[1].set(1,-1,g),e[2].set(-1,1,g),e[3].set(1,1,g),e[4].set(-1,-1,h),e[5].set(1,-1,h),e[6].set(-1,1,h),e[7].set(1,1,h),c}function b(a,b){var c=a.shadowCascadeArray[b];c.position.copy(a.position),c.target.position.copy(a.target.position),c.lookAt(c.target),c.shadowCameraVisible=a.shadowCameraVisible,c.shadowDarkness=a.shadowDarkness,c.shadowBias=a.shadowCascadeBias[b];var d=a.shadowCascadeNearZ[b],e=a.shadowCascadeFarZ[b],f=c.pointsFrustum;f[0].z=d,f[1].z=d,f[2].z=d,f[3].z=d,f[4].z=e,f[5].z=e,f[6].z=e,f[7].z=e}function c(a,b){var c=b.shadowCamera,d=b.pointsFrustum,e=b.pointsWorld;n.set(1/0,1/0,1/0),o.set(-(1/0),-(1/0),-(1/0));for(var f=0;8>f;f++){var g=e[f];g.copy(d[f]),bd.__projector.unprojectVector(g,a),g.applyMatrix4(c.worldMatrixInverse),g.x<n.x&&(n.x=g.x),g.x>o.x&&(o.x=g.x),g.y<n.y&&(n.y=g.y),g.y>o.y&&(o.y=g.y),g.z<n.z&&(n.z=g.z),g.z>o.z&&(o.z=g.z)}c.left=n.x,c.right=o.x,c.top=o.y,c.bottom=n.y,c.updateProjectionMatrix()}function d(a){return a.material instanceof $b.ArrayMaterial?a.material.materials[0]:a.material}var f,g,h,i,j,k,l=new $b.Frustum,m=new $b.Mat4,n=new $b.Vec3,o=new $b.Vec3,p=new $b.Vec3;this.init=function(a){f=a._gl,g=a;var b=$b.ShaderLib.depthRGBA,c=$b.UniformsUtils.clone(b.uniforms);h=new $c({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c}),_depthCubeMaterial=new $c({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,refreshUniformsCommon:function(a){this.uniforms.isCube.value=1,this.uniforms.nearDistance.value=this.nearDistance,this.uniforms.farDistance.value=this.farDistance,this.uniforms.referencePosition.value=this.referencePosition}}),i=new $c({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,morphTargets:!0}),j=new $c({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,skinning:!0}),k=new $c({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,morphTargets:!0,skinning:!0}),h._shadowPass=!0,i._shadowPass=!0,j._shadowPass=!0,k._shadowPass=!0};var q=[new mono.Vec3(1,0,0),new mono.Vec3(-1,0,0),new mono.Vec3(0,0,1),new mono.Vec3(0,0,-1),new mono.Vec3(0,1,0),new mono.Vec3(0,-1,0)],r=[new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,0,1),new mono.Vec3(0,0,-1)],s=[new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4];this.dirty=!0,this.dirtyShadowMap=function(){this.dirty=!0},this.render=function(a,b){g._shadowMapEnable&&this.update(a,b)},this.handleDataPropertyChange=function(a){var b=a.source,c=a.property;(b.isSizeChangedProperty&&b.isSizeChangedProperty(c)||"parent"==c||b.isSpaceChangedProperty(c))&&this.dirtyShadowMap()},this.handleDataBoxChange=function(a){this.dirtyShadowMap()},this.update=function(n,o){if(this.dirty){this.dirty=!1;var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=[],I=0;f.clearColor(1,1,1,1),f.disable(f.BLEND),f.enable(f.CULL_FACE),f.frontFace(f.CCW),g.shadowMapCullFace===$b.CullFaceFront?f.cullFace(f.FRONT):f.cullFace(f.BACK),g.setDepthTest(!0);var J=n.getLights();for(t=0,u=J.size();u>t;t++)if(F=J.get(t),F.castShadow)if(F instanceof $b.DirectionalLight&&F.shadowCascade)for(x=0;x<F.shadowCascadeCount;x++){var K;if(F.shadowCascadeArray[x])K=F.shadowCascadeArray[x];else{K=a(F,x),K.originalCamera=o;var L=new ad;L.position=F.shadowCascadeOffset,L.add(K),L.add(K.target),o.add(L),F.shadowCascadeArray[x]=K}b(F,x),H[I]=K,I++}else H[I]=F,I++;for(t=0,u=H.length;u>t;t++){F=H[t];var M=F instanceof $b.PointLight,N=M?6:1;if(!F.shadowMap){var O=$b.NearestFilter;g.shadowMapType===$b.PCFSoftShadowMap&&(O=$b.NearestFilter);var P={minFilter:O,magFilter:O,format:$b.RGBAFormat},Q=new mono.Vec2(F.shadowMapWidth,F.shadowMapHeight);if(M){var R=Q.x,S=Q.y;s[0].set(2*R,S,R,S),s[1].set(0,S,R,S),s[2].set(3*R,S,R,S),s[3].set(R,S,R,S),s[4].set(3*R,0,R,S),s[5].set(R,0,R,S),Q.x*=4,Q.y*=2,F.shadowMap=new yc(Q.x,Q.y,P),F.shadowMapSize=new _b(Q.x,Q.y),F.shadowMatrix=new $b.Mat4}else F.shadowMap=new yc(F.shadowMapWidth,F.shadowMapHeight,P),F.shadowMapSize=new _b(F.shadowMapWidth,F.shadowMapHeight),F.shadowMatrix=new $b.Mat4}if(!F.shadowCamera){if(F instanceof $b.SpotLight)F.shadowCamera=new $b.PerspectiveCamera(F.shadowCameraFov,F.shadowMapWidth/F.shadowMapHeight,F.shadowCameraNear,F.shadowCameraFar);else if(F instanceof $b.DirectionalLight)F.shadowCamera=new $b.OrthoCamera(F.shadowCameraLeft,F.shadowMapWidth/F.shadowMapHeight,F.shadowCameraNear,F.shadowCameraFar);else{if(!(F instanceof $b.PointLight)){console.error("Unsupported light type for shadow");continue}F.shadowCamera=new $b.PerspectiveCamera(90,1,F.shadowCameraNear,F.shadowCameraFar)}F.shadowCamera.updateWorldMatrix();for(var T,U=n.getRoots(),V=U.size(),W=0;V>W;W++)T=U.get(W),T.updateWorldMatrix()}F.shadowCameraVisible&&!F.cameraHelper&&(F.cameraHelper=new $b.CameraHelper(F.shadowCamera),F.shadowCamera.addChild(F.cameraHelper),F.shadowCamera.updateWorldMatrix(!0),g.helperBox.add(F.shadowCamera),g.helperBox.add(F.cameraHelper)),F.isVirtual&&K.originalCamera==o&&c(o,F);[new ac(1,0,0),new ac(-1,0,0),new ac(0,1,0),new ac(0,-1,0),new ac(0,0,1),new ac(0,0,-1)];y=F.shadowMap,z=F.shadowMatrix,A=F.shadowCamera,g.debugPointLight==e&&g.setRenderTarget(y),g.clear();for(var I=0;N>I;I++)if(null==F.debugFace||I==F.debugFace){if(A._position.setFromMatrixPosition(F.worldMatrix),F.target?(p.setFromMatrixPosition(F.target.worldMatrix),A.lookAt(p),A.updateWorldMatrix(!0)):p=A.p().clone().add(q[I]),A.worldMatrixInverse.getInverse(A.worldMatrix),F.cameraHelper&&(F.cameraHelper.visible=F.shadowCameraVisible),F.shadowCameraVisible&&F.cameraHelper.update(),M){z.translate(A._position.clone().negate()),A.setUp(r[I]),A.lookAt(p),A.updateWorldMatrix(!0),A.setNear(F.shadowCameraNear),A.setFar(F.shadowCameraFar),_depthCubeMaterial.nearDistance=F.shadowCameraNear,_depthCubeMaterial.farDistance=F.shadowCameraFar,_depthCubeMaterial.referencePosition=A._position.clone();var X=s[I];A.worldMatrixInverse.getInverse(A.worldMatrix),g.setViewport(X.x,X.y,X.z,X.w)}else z.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),z.multiply(A.projectionMatrix),z.multiply(A.worldMatrixInverse);for(m.multiplyMatrices(A.projectionMatrix,A.worldMatrixInverse),l.setFromMatrix(m),G=g.glNodeList,v=0,w=G.length;w>v;v++)D=G[v],E=D.node,D.render=!1,E._visible&&E.castShadow&&(!(E instanceof $b.Node||E instanceof $b.Particle)||!E.frustumCulled||l.intersectsObject(E))&&(E._modelViewMatrix.multiplyMatrices(A.worldMatrixInverse,E.worldMatrix),D.render=!0);var Y,Z,$;for(v=0,w=G.length;w>v;v++)D=G[v],D.render&&(E=D.node,B=D.group,Y=d(E),Z=!1,$=!1,C=E.customDepthMaterial?E.customDepthMaterial:$?Z?k:j:Z?i:1==N?h:_depthCubeMaterial,E instanceof $b.BufferNode||g.renderGroup(A,n.getLights(),C,B,E))}}var _=g.getClearColor(),aa=g.getClearAlpha();f.clearColor(_.r,_.g,_.b,aa),f.enable(f.BLEND),g.shadowMapCullFace===$b.CullFaceFront&&f.cullFace(f.BACK)}}};bd.__projector=new $b.Projector,$b.Picking=function(a,b,c,d,e,f){this.network=f,this.origin=a,this.cameraUp=c,this.direction=b,this.near=d||0,this.far=e||1/0,this.ray=new $b.Ray(a,b),this.ray.direction.length>0&&this.ray.direction.normalize()},$b.Picking.testPlane=new $b.Plane(1,1),$b.Picking.prototype={constructor:$b.Picking,precision:1e-4,linePrecision:2,matrixPosition:new $b.Vec3,set:function(a,b){this.origin=a,this.direction=b,this.ray.set(a,b),this.ray.direction.length>0&&this.ray.direction.normalize()},intersectObject:function(a,b,c){var d=[];return b===!0&&Qb(a,this,d,c),Pb(a,this,d,c),d.sort(Ob),d},intersectObjects:function(a,b,c){a._as&&(a=a._as);for(var d=[],e=0,f=a.length;f>e;e++)Pb(a[e],this,d,c,this.network),b===!0&&Qb(a[e],this,d,c,this.network);return d.sort(Ob),d}};var cd=new $b.Ray,dd=new $b.Mat4,ed=new $b.math.Plane,fd=new $b.Vec3,gd=new $b.BoundingSphere,hd=function(a){arguments.length>0&&this.init(a)};hd.prototype.init=function(a){this.status=a,this.points=new Array},hd.prototype.appendPoint=function(a){this.points.push(a)},hd.prototype.appendPoints=function(a){this.points=this.points.concat(a)},hd.intersectShapes=function(a,b){var c,d=a.getIntersectionParams(),e=b.getIntersectionParams();if(null!=d&&null!=e)if("Path"==d.name)c=hd.intersectPathShape(a,b);else if("Path"==e.name)c=hd.intersectPathShape(b,a);else{var f,g;if(d.name<e.name?(f="intersect"+d.name+e.name,g=d.params.concat(e.params)):(f="intersect"+e.name+d.name,g=e.params.concat(d.params)),!(f in hd))throw new Error("Intersection not available: "+f);c=hd[f].apply(null,g)}else c=new hd("No Intersection");return c},hd.intersectPathShape=function(a,b){return a.intersectShape(b)},hd.intersectBezier2Bezier2=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p=new hd("No Intersection");if(g=b.multiply(-2),i=a.add(g.add(c)),
g=a.multiply(-2),h=b.multiply(2),j=g.add(h),k=new _b(a.x,a.y),g=e.multiply(-2),l=d.add(g.add(f)),g=d.multiply(-2),h=e.multiply(2),m=g.add(h),n=new _b(d.x,d.y),0==i.y){var q=i.x*(k.y-n.y),r=q-j.x*j.y,s=q+r,t=j.y*j.y;o=new Polynomial(i.x*l.y*l.y,2*i.x*m.y*l.y,i.x*m.y*m.y-l.x*t-l.y*q-l.y*r,-m.x*t-m.y*q-m.y*r,(k.x-n.x)*t+(k.y-n.y)*r)}else{var q=i.x*l.y-i.y*l.x,r=i.x*m.y-m.x*i.y,s=j.x*i.y-j.y*i.x,t=k.y-n.y,u=i.y*(k.x-n.x)-i.x*t,v=-j.y*s+i.y*u,w=s*s;o=new Polynomial(q*q,2*q*r,(-l.y*w+i.y*r*r+i.y*q*u+q*v)/i.y,(-m.y*w+i.y*r*u+r*v)/i.y,(t*w+u*v)/i.y)}for(var x=o.getRoots(),y=0;y<x.length;y++){var z=x[y];if(z>=0&&1>=z){var A=new Polynomial(i.x,j.x,k.x-n.x-z*m.x-z*z*l.x).getRoots(),B=new Polynomial(i.y,j.y,k.y-n.y-z*m.y-z*z*l.y).getRoots();if(A.length>0&&B.length>0){var C=1e-4;a:for(var D=0;D<A.length;D++){var E=A[D];if(E>=0&&1>=E)for(var F=0;F<B.length;F++)if(Math.abs(E-B[F])<C){p.points.push(l.multiply(z*z).add(m.multiply(z).add(n)));break a}}}}}return p.points.length>0&&(p.status="$Intersection"),p},hd.intersectBezier2Bezier3=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=new hd("No Intersection");h=b.multiply(-2),l=a.add(h.add(c)),h=a.multiply(-2),i=b.multiply(2),m=h.add(i),n=new _b(a.x,a.y),h=d.multiply(-1),i=e.multiply(3),j=f.multiply(-3),k=h.add(i.add(j.add(g))),o=new Vector2D(k.x,k.y),h=d.multiply(3),i=e.multiply(-6),j=f.multiply(3),k=h.add(i.add(j)),p=new Vector2D(k.x,k.y),h=d.multiply(-3),i=e.multiply(3),j=h.add(i),q=new Vector2D(j.x,j.y),r=new Vector2D(d.x,d.y);for(var t=n.x*n.x,u=n.y*n.y,v=m.x*m.x,w=m.y*m.y,x=l.x*l.x,y=l.y*l.y,z=r.x*r.x,A=r.y*r.y,B=q.x*q.x,C=q.y*q.y,D=p.x*p.x,E=p.y*p.y,F=o.x*o.x,G=o.y*o.y,H=new Polynomial(-2*l.x*l.y*o.x*o.y+x*G+y*F,-2*l.x*l.y*p.x*o.y-2*l.x*l.y*p.y*o.x+2*y*p.x*o.x+2*x*p.y*o.y,-2*l.x*q.x*l.y*o.y-2*l.x*l.y*q.y*o.x-2*l.x*l.y*p.x*p.y+2*q.x*y*o.x+y*D+x*(2*q.y*o.y+E),2*n.x*l.x*l.y*o.y+2*n.y*l.x*l.y*o.x+m.x*m.y*l.x*o.y+m.x*m.y*l.y*o.x-2*r.x*l.x*l.y*o.y-2*l.x*r.y*l.y*o.x-2*l.x*q.x*l.y*p.y-2*l.x*l.y*q.y*p.x-2*n.x*y*o.x-2*n.y*x*o.y+2*r.x*y*o.x+2*q.x*y*p.x-w*l.x*o.x-v*l.y*o.y+x*(2*r.y*o.y+2*q.y*p.y),2*n.x*l.x*l.y*p.y+2*n.y*l.x*l.y*p.x+m.x*m.y*l.x*p.y+m.x*m.y*l.y*p.x-2*r.x*l.x*l.y*p.y-2*l.x*r.y*l.y*p.x-2*l.x*q.x*l.y*q.y-2*n.x*y*p.x-2*n.y*x*p.y+2*r.x*y*p.x-w*l.x*p.x-v*l.y*p.y+B*y+x*(2*r.y*p.y+C),2*n.x*l.x*l.y*q.y+2*n.y*l.x*q.x*l.y+m.x*m.y*l.x*q.y+m.x*m.y*q.x*l.y-2*r.x*l.x*l.y*q.y-2*l.x*r.y*q.x*l.y-2*n.x*q.x*y-2*n.y*x*q.y+2*r.x*q.x*y-w*l.x*q.x-v*l.y*q.y+2*x*r.y*q.y,-2*n.x*n.y*l.x*l.y-n.x*m.x*m.y*l.y-n.y*m.x*m.y*l.x+2*n.x*l.x*r.y*l.y+2*n.y*r.x*l.x*l.y+m.x*r.x*m.y*l.y+m.x*m.y*l.x*r.y-2*r.x*l.x*r.y*l.y-2*n.x*r.x*y+n.x*w*l.x+n.y*v*l.y-2*n.y*x*r.y-r.x*w*l.x-v*r.y*l.y+t*y+u*x+z*y+x*A),I=H.getRootsInInterval(0,1),J=0;J<I.length;J++){var K=I[J],L=new Polynomial(l.x,m.x,n.x-r.x-K*q.x-K*K*p.x-K*K*K*o.x).getRoots(),M=new Polynomial(l.y,m.y,n.y-r.y-K*q.y-K*K*p.y-K*K*K*o.y).getRoots();if(L.length>0&&M.length>0){var N=1e-4;a:for(var O=0;O<L.length;O++){var P=L[O];if(P>=0&&1>=P)for(var Q=0;Q<M.length;Q++)if(Math.abs(P-M[Q])<N){s.points.push(o.multiply(K*K*K).add(p.multiply(K*K).add(q.multiply(K).add(r))));break a}}}}return s.points.length>0&&(s.status="Intersection"),s},hd.intersectBezier2Circle=function(a,b,c,d,e){return hd.intersectBezier2Ellipse(a,b,c,d,e,e)},hd.intersectBezier2Ellipse=function(a,b,c,d,e,f){var g,h,i,j,k,l=new hd("No Intersection");g=b.multiply(-2),i=a.add(g.add(c)),g=a.multiply(-2),h=b.multiply(2),j=g.add(h),k=new _b(a.x,a.y);for(var m=e*e,n=f*f,o=new Polynomial(n*i.x*i.x+m*i.y*i.y,2*(n*i.x*j.x+m*i.y*j.y),n*(2*i.x*k.x+j.x*j.x)+m*(2*i.y*k.y+j.y*j.y)-2*(n*d.x*i.x+m*d.y*i.y),2*(n*j.x*(k.x-d.x)+m*j.y*(k.y-d.y)),n*(k.x*k.x+d.x*d.x)+m*(k.y*k.y+d.y*d.y)-2*(n*d.x*k.x+m*d.y*k.y)-m*n).getRoots(),p=0;p<o.length;p++){var q=o[p];q>=0&&1>=q&&l.points.push(i.multiply(q*q).add(j.multiply(q).add(k)))}return l.points.length>0&&(l.status="Intersection"),l},hd.intersectBezier2Line=function(a,b,c,d,e){var f,g,h,i,j,k,l,m=d.min(e),n=d.max(e),o=new hd("No Intersection");f=b.multiply(-2),h=a.add(f.add(c)),f=a.multiply(-2),g=b.multiply(2),i=f.add(g),j=new _b(a.x,a.y),l=new Vector2D(d.y-e.y,e.x-d.x),k=d.x*e.y-e.x*d.y,roots=new Polynomial(l.dot(h),l.dot(i),l.dot(j)+k).getRoots();for(var p=0;p<roots.length;p++){var q=roots[p];if(q>=0&&1>=q){var r=a.lerp(b,q),s=b.lerp(c,q),t=r.lerp(s,q);d.x==e.x?m.y<=t.y&&t.y<=n.y&&(o.status="Intersection",o.appendPoint(t)):d.y==e.y?m.x<=t.x&&t.x<=n.x&&(o.status="Intersection",o.appendPoint(t)):t.gte(m)&&t.lte(n)&&(o.status="Intersection",o.appendPoint(t))}}return o},hd.intersectBezier2Polygon=function(a,b,c,d){for(var e=new hd("No Intersection"),f=d.length,g=0;f>g;g++){var h=d[g],i=d[(g+1)%f],j=hd.intersectBezier2Line(a,b,c,h,i);e.appendPoints(j.points)}return e.points.length>0&&(e.status="Intersection"),e},hd.intersectBezier2Rectangle=function(a,b,c,d,e){var f=d.min(e),g=d.max(e),h=new _b(g.x,f.y),i=new _b(f.x,g.y),j=hd.intersectBezier2Line(a,b,c,f,h),k=hd.intersectBezier2Line(a,b,c,h,g),l=hd.intersectBezier2Line(a,b,c,g,i),m=hd.intersectBezier2Line(a,b,c,i,f),n=new hd("No Intersection");return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n},hd.intersectBezier3Bezier3=function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u=new hd("No Intersection");i=a.multiply(-1),j=b.multiply(3),k=c.multiply(-3),l=i.add(j.add(k.add(d))),m=new Vector2D(l.x,l.y),i=a.multiply(3),j=b.multiply(-6),k=c.multiply(3),l=i.add(j.add(k)),n=new Vector2D(l.x,l.y),i=a.multiply(-3),j=b.multiply(3),k=i.add(j),o=new Vector2D(k.x,k.y),p=new Vector2D(a.x,a.y),i=e.multiply(-1),j=f.multiply(3),k=g.multiply(-3),l=i.add(j.add(k.add(h))),q=new Vector2D(l.x,l.y),i=e.multiply(3),j=f.multiply(-6),k=g.multiply(3),l=i.add(j.add(k)),r=new Vector2D(l.x,l.y),i=e.multiply(-3),j=f.multiply(3),k=i.add(j),s=new Vector2D(k.x,k.y),t=new Vector2D(e.x,e.y);for(var v=p.x*p.x,w=p.x*p.x*p.x,x=p.y*p.y,y=p.y*p.y*p.y,z=o.x*o.x,A=o.x*o.x*o.x,B=o.y*o.y,C=o.y*o.y*o.y,D=n.x*n.x,E=n.x*n.x*n.x,F=n.y*n.y,G=n.y*n.y*n.y,H=m.x*m.x,I=m.x*m.x*m.x,J=m.y*m.y,K=m.y*m.y*m.y,L=t.x*t.x,M=t.x*t.x*t.x,N=t.y*t.y,O=t.y*t.y*t.y,P=s.x*s.x,Q=s.x*s.x*s.x,R=s.y*s.y,S=r.x*r.x,T=r.x*r.x*r.x,U=r.y*r.y,V=q.x*q.x,W=q.x*q.x*q.x,X=q.y*q.y,Y=q.y*q.y*q.y,Z=new Polynomial(-I*Y+K*W-3*m.x*J*V*q.y+3*H*m.y*q.x*X,-6*m.x*r.x*J*q.x*q.y+6*H*m.y*r.y*q.x*q.y+3*r.x*K*V-3*I*r.y*X-3*m.x*J*r.y*V+3*H*r.x*m.y*X,-6*s.x*m.x*J*q.x*q.y-6*m.x*r.x*J*r.y*q.x+6*H*r.x*m.y*r.y*q.y+3*s.x*K*V+3*S*K*q.x+3*s.x*H*m.y*X-3*m.x*s.y*J*V-3*m.x*S*J*q.y+H*m.y*q.x*(6*s.y*q.y+3*U)+I*(-s.y*X-2*U*q.y-q.y*(2*s.y*q.y+U)),o.x*n.y*m.x*m.y*q.x*q.y-o.y*n.x*m.x*m.y*q.x*q.y+6*s.x*r.x*K*q.x+3*o.x*n.x*m.x*m.y*X+6*p.x*m.x*J*q.x*q.y-3*o.x*n.x*J*q.x*q.y-3*o.y*n.y*m.x*m.y*V-6*p.y*H*m.y*q.x*q.y-6*t.x*m.x*J*q.x*q.y+3*o.y*n.y*H*q.x*q.y-2*n.x*F*m.x*q.x*q.y-6*s.x*m.x*r.x*J*q.y-6*s.x*m.x*J*r.y*q.x-6*m.x*s.y*r.x*J*q.x+6*s.x*H*m.y*r.y*q.y+2*D*n.y*m.y*q.x*q.y+T*K-3*p.x*K*V+3*p.y*I*X+3*t.x*K*V+G*m.x*V-E*m.y*X-3*p.x*H*m.y*X+3*p.y*m.x*J*V-2*o.x*n.y*H*X+o.x*n.y*J*V-o.y*n.x*H*X+2*o.y*n.x*J*V+3*t.x*H*m.y*X-n.x*F*m.y*V-3*t.y*m.x*J*V+D*n.y*m.x*X-3*m.x*S*J*r.y+H*m.y*q.x*(6*t.y*q.y+6*s.y*r.y)+H*r.x*m.y*(6*s.y*q.y+3*U)+I*(-2*s.y*r.y*q.y-t.y*X-r.y*(2*s.y*q.y+U)-q.y*(2*t.y*q.y+2*s.y*r.y)),6*o.x*n.x*m.x*m.y*r.y*q.y+o.x*n.y*m.x*r.x*m.y*q.y+o.x*n.y*m.x*m.y*r.y*q.x-o.y*n.x*m.x*r.x*m.y*q.y-o.y*n.x*m.x*m.y*r.y*q.x-6*o.y*n.y*m.x*r.x*m.y*q.x-6*p.x*r.x*K*q.x+6*t.x*r.x*K*q.x+6*p.y*I*r.y*q.y+2*G*m.x*r.x*q.x-2*E*m.y*r.y*q.y+6*p.x*m.x*r.x*J*q.y+6*p.x*m.x*J*r.y*q.x+6*p.y*m.x*r.x*J*q.x-3*o.x*n.x*r.x*J*q.y-3*o.x*n.x*J*r.y*q.x+2*o.x*n.y*r.x*J*q.x+4*o.y*n.x*r.x*J*q.x-6*p.x*H*m.y*r.y*q.y-6*p.y*H*r.x*m.y*q.y-6*p.y*H*m.y*r.y*q.x-4*o.x*n.y*H*r.y*q.y-6*t.x*m.x*r.x*J*q.y-6*t.x*m.x*J*r.y*q.x-2*o.y*n.x*H*r.y*q.y+3*o.y*n.y*H*r.x*q.y+3*o.y*n.y*H*r.y*q.x-2*n.x*F*m.x*r.x*q.y-2*n.x*F*m.x*r.y*q.x-2*n.x*F*r.x*m.y*q.x-6*t.y*m.x*r.x*J*q.x-6*s.x*m.x*s.y*J*q.x-6*s.x*m.x*r.x*J*r.y+6*t.x*H*m.y*r.y*q.y+2*D*n.y*m.x*r.y*q.y+2*D*n.y*r.x*m.y*q.y+2*D*n.y*m.y*r.y*q.x+3*s.x*S*K+3*P*K*q.x-3*m.x*s.y*S*J-3*P*m.x*J*q.y+H*r.x*m.y*(6*t.y*q.y+6*s.y*r.y)+H*m.y*q.x*(6*t.y*r.y+3*R)+s.x*H*m.y*(6*s.y*q.y+3*U)+I*(-2*t.y*r.y*q.y-q.y*(2*t.y*r.y+R)-s.y*(2*s.y*q.y+U)-r.y*(2*t.y*q.y+2*s.y*r.y)),o.x*s.x*n.y*m.x*m.y*q.y+o.x*n.y*m.x*s.y*m.y*q.x+o.x*n.y*m.x*r.x*m.y*r.y-o.y*n.x*s.x*m.x*m.y*q.y-o.y*n.x*m.x*s.y*m.y*q.x-o.y*n.x*m.x*r.x*m.y*r.y-6*o.y*s.x*n.y*m.x*m.y*q.x-6*p.x*s.x*K*q.x+6*t.x*s.x*K*q.x+2*s.x*G*m.x*q.x+6*p.x*s.x*m.x*J*q.y+6*p.x*m.x*s.y*J*q.x+6*p.x*m.x*r.x*J*r.y+6*p.y*s.x*m.x*J*q.x-3*o.x*n.x*s.x*J*q.y-3*o.x*n.x*s.y*J*q.x-3*o.x*n.x*r.x*J*r.y+2*o.x*s.x*n.y*J*q.x+4*o.y*n.x*s.x*J*q.x-6*p.y*s.x*H*m.y*q.y-6*p.y*H*s.y*m.y*q.x-6*p.y*H*r.x*m.y*r.y-6*t.x*s.x*m.x*J*q.y-6*t.x*m.x*s.y*J*q.x-6*t.x*m.x*r.x*J*r.y+3*o.y*s.x*n.y*H*q.y-3*o.y*n.y*m.x*S*m.y+3*o.y*n.y*H*s.y*q.x+3*o.y*n.y*H*r.x*r.y-2*n.x*s.x*F*m.x*q.y-2*n.x*s.x*F*m.y*q.x-2*n.x*F*m.x*s.y*q.x-2*n.x*F*m.x*r.x*r.y-6*t.y*s.x*m.x*J*q.x-6*s.x*m.x*s.y*r.x*J+6*t.y*H*s.y*m.y*q.x+2*D*s.x*n.y*m.y*q.y+2*D*n.y*s.y*m.y*q.x+2*D*n.y*r.x*m.y*r.y-3*p.x*S*K+3*t.x*S*K+3*P*r.x*K+G*m.x*S+3*p.y*m.x*S*J+o.x*n.y*S*J+2*o.y*n.x*S*J-n.x*F*S*m.y-3*t.y*m.x*S*J-3*P*m.x*J*r.y+D*n.y*m.x*(2*s.y*q.y+U)+o.x*n.x*m.x*m.y*(6*s.y*q.y+3*U)+s.x*H*m.y*(6*t.y*q.y+6*s.y*r.y)+E*m.y*(-2*s.y*q.y-U)+p.y*I*(6*s.y*q.y+3*U)+o.y*n.x*H*(-2*s.y*q.y-U)+o.x*n.y*H*(-4*s.y*q.y-2*U)+p.x*H*m.y*(-6*s.y*q.y-3*U)+H*r.x*m.y*(6*t.y*r.y+3*R)+t.x*H*m.y*(6*s.y*q.y+3*U)+I*(-2*t.y*s.y*q.y-r.y*(2*t.y*r.y+R)-t.y*(2*s.y*q.y+U)-s.y*(2*t.y*q.y+2*s.y*r.y)),-p.x*o.x*n.y*m.x*m.y*q.y+p.x*o.y*n.x*m.x*m.y*q.y+6*p.x*o.y*n.y*m.x*m.y*q.x-6*p.y*o.x*n.x*m.x*m.y*q.y-p.y*o.x*n.y*m.x*m.y*q.x+p.y*o.y*n.x*m.x*m.y*q.x+o.x*o.y*n.x*n.y*m.x*q.y-o.x*o.y*n.x*n.y*m.y*q.x+o.x*t.x*n.y*m.x*m.y*q.y+o.x*t.y*n.y*m.x*m.y*q.x+o.x*s.x*n.y*m.x*m.y*r.y+o.x*n.y*m.x*s.y*r.x*m.y-t.x*o.y*n.x*m.x*m.y*q.y-6*t.x*o.y*n.y*m.x*m.y*q.x-o.y*n.x*t.y*m.x*m.y*q.x-o.y*n.x*s.x*m.x*m.y*r.y-o.y*n.x*m.x*s.y*r.x*m.y-6*o.y*s.x*n.y*m.x*r.x*m.y-6*p.x*t.x*K*q.x-6*p.x*s.x*r.x*K-2*p.x*G*m.x*q.x+6*t.x*s.x*r.x*K+2*t.x*G*m.x*q.x+2*s.x*G*m.x*r.x+2*p.y*E*m.y*q.y-6*p.x*p.y*m.x*J*q.x+3*p.x*o.x*n.x*J*q.y-2*p.x*o.x*n.y*J*q.x-4*p.x*o.y*n.x*J*q.x+3*p.y*o.x*n.x*J*q.x+6*p.x*p.y*H*m.y*q.y+6*p.x*t.x*m.x*J*q.y-3*p.x*o.y*n.y*H*q.y+2*p.x*n.x*F*m.x*q.y+2*p.x*n.x*F*m.y*q.x+6*p.x*t.y*m.x*J*q.x+6*p.x*s.x*m.x*J*r.y+6*p.x*m.x*s.y*r.x*J+4*p.y*o.x*n.y*H*q.y+6*p.y*t.x*m.x*J*q.x+2*p.y*o.y*n.x*H*q.y-3*p.y*o.y*n.y*H*q.x+2*p.y*n.x*F*m.x*q.x+6*p.y*s.x*m.x*r.x*J-3*o.x*t.x*n.x*J*q.y+2*o.x*t.x*n.y*J*q.x+o.x*o.y*F*m.x*q.x-3*o.x*n.x*t.y*J*q.x-3*o.x*n.x*s.x*J*r.y-3*o.x*n.x*s.y*r.x*J+2*o.x*s.x*n.y*r.x*J+4*t.x*o.y*n.x*J*q.x+4*o.y*n.x*s.x*r.x*J-2*p.x*D*n.y*m.y*q.y-6*p.y*t.x*H*m.y*q.y-6*p.y*t.y*H*m.y*q.x-6*p.y*s.x*H*m.y*r.y-2*p.y*D*n.y*m.x*q.y-2*p.y*D*n.y*m.y*q.x-6*p.y*H*s.y*r.x*m.y-o.x*o.y*D*m.y*q.y-2*o.x*B*m.x*m.y*q.x+3*t.x*o.y*n.y*H*q.y-2*t.x*n.x*F*m.x*q.y-2*t.x*n.x*F*m.y*q.x-6*t.x*t.y*m.x*J*q.x-6*t.x*s.x*m.x*J*r.y-6*t.x*m.x*s.y*r.x*J+3*o.y*t.y*n.y*H*q.x+3*o.y*s.x*n.y*H*r.y+3*o.y*n.y*H*s.y*r.x-2*n.x*t.y*F*m.x*q.x-2*n.x*s.x*F*m.x*r.y-2*n.x*s.x*F*r.x*m.y-2*n.x*F*m.x*s.y*r.x-6*t.y*s.x*m.x*r.x*J-B*n.x*n.y*m.x*q.x+2*t.x*D*n.y*m.y*q.y+6*t.y*H*s.y*r.x*m.y+2*z*o.y*m.x*m.y*q.y+z*n.x*n.y*m.y*q.y+2*D*t.y*n.y*m.y*q.x+2*D*s.x*n.y*m.y*r.y+2*D*n.y*s.y*r.x*m.y+Q*K+3*v*K*q.x-3*x*I*q.y+3*L*K*q.x+C*H*q.x-A*J*q.y-o.x*B*H*q.y+z*o.y*J*q.x-3*v*m.x*J*q.y+3*x*H*m.y*q.x-z*F*m.x*q.y+B*D*m.y*q.x-3*P*m.x*s.y*J-3*L*m.x*J*q.y+3*N*H*m.y*q.x+o.x*n.x*m.x*m.y*(6*t.y*q.y+6*s.y*r.y)+E*m.y*(-2*t.y*q.y-2*s.y*r.y)+p.y*I*(6*t.y*q.y+6*s.y*r.y)+o.y*n.x*H*(-2*t.y*q.y-2*s.y*r.y)+D*n.y*m.x*(2*t.y*q.y+2*s.y*r.y)+o.x*n.y*H*(-4*t.y*q.y-4*s.y*r.y)+p.x*H*m.y*(-6*t.y*q.y-6*s.y*r.y)+t.x*H*m.y*(6*t.y*q.y+6*s.y*r.y)+s.x*H*m.y*(6*t.y*r.y+3*R)+I*(-2*t.y*s.y*r.y-N*q.y-s.y*(2*t.y*r.y+R)-t.y*(2*t.y*q.y+2*s.y*r.y)),-p.x*o.x*n.y*m.x*m.y*r.y+p.x*o.y*n.x*m.x*m.y*r.y+6*p.x*o.y*n.y*m.x*r.x*m.y-6*p.y*o.x*n.x*m.x*m.y*r.y-p.y*o.x*n.y*m.x*r.x*m.y+p.y*o.y*n.x*m.x*r.x*m.y+o.x*o.y*n.x*n.y*m.x*r.y-o.x*o.y*n.x*n.y*r.x*m.y+o.x*t.x*n.y*m.x*m.y*r.y+o.x*t.y*n.y*m.x*r.x*m.y+o.x*s.x*n.y*m.x*s.y*m.y-t.x*o.y*n.x*m.x*m.y*r.y-6*t.x*o.y*n.y*m.x*r.x*m.y-o.y*n.x*t.y*m.x*r.x*m.y-o.y*n.x*s.x*m.x*s.y*m.y-6*p.x*t.x*r.x*K-2*p.x*G*m.x*r.x+2*t.x*G*m.x*r.x+2*p.y*E*m.y*r.y-6*p.x*p.y*m.x*r.x*J+3*p.x*o.x*n.x*J*r.y-2*p.x*o.x*n.y*r.x*J-4*p.x*o.y*n.x*r.x*J+3*p.y*o.x*n.x*r.x*J+6*p.x*p.y*H*m.y*r.y+6*p.x*t.x*m.x*J*r.y-3*p.x*o.y*n.y*H*r.y+2*p.x*n.x*F*m.x*r.y+2*p.x*n.x*F*r.x*m.y+6*p.x*t.y*m.x*r.x*J+6*p.x*s.x*m.x*s.y*J+4*p.y*o.x*n.y*H*r.y+6*p.y*t.x*m.x*r.x*J+2*p.y*o.y*n.x*H*r.y-3*p.y*o.y*n.y*H*r.x+2*p.y*n.x*F*m.x*r.x-3*o.x*t.x*n.x*J*r.y+2*o.x*t.x*n.y*r.x*J+o.x*o.y*F*m.x*r.x-3*o.x*n.x*t.y*r.x*J-3*o.x*n.x*s.x*s.y*J+4*t.x*o.y*n.x*r.x*J-2*p.x*D*n.y*m.y*r.y-6*p.y*t.x*H*m.y*r.y-6*p.y*t.y*H*r.x*m.y-6*p.y*s.x*H*s.y*m.y-2*p.y*D*n.y*m.x*r.y-2*p.y*D*n.y*r.x*m.y-o.x*o.y*D*m.y*r.y-2*o.x*B*m.x*r.x*m.y+3*t.x*o.y*n.y*H*r.y-2*t.x*n.x*F*m.x*r.y-2*t.x*n.x*F*r.x*m.y-6*t.x*t.y*m.x*r.x*J-6*t.x*s.x*m.x*s.y*J+3*o.y*t.y*n.y*H*r.x+3*o.y*s.x*n.y*H*s.y-2*n.x*t.y*F*m.x*r.x-2*n.x*s.x*F*m.x*s.y-B*n.x*n.y*m.x*r.x+2*t.x*D*n.y*m.y*r.y-3*o.y*P*n.y*m.x*m.y+6*t.y*s.x*H*s.y*m.y+2*z*o.y*m.x*m.y*r.y+z*n.x*n.y*m.y*r.y+2*D*t.y*n.y*r.x*m.y+2*D*s.x*n.y*s.y*m.y-3*p.x*P*K+3*t.x*P*K+3*v*r.x*K-3*x*I*r.y+3*L*r.x*K+P*G*m.x+C*H*r.x-A*J*r.y+3*p.y*P*m.x*J-o.x*B*H*r.y+o.x*P*n.y*J+2*o.y*n.x*P*J+z*o.y*r.x*J-n.x*P*F*m.y-3*t.y*P*m.x*J-3*v*m.x*J*r.y+3*x*H*r.x*m.y-z*F*m.x*r.y+B*D*r.x*m.y-3*L*m.x*J*r.y+3*N*H*r.x*m.y+D*n.y*m.x*(2*t.y*r.y+R)+o.x*n.x*m.x*m.y*(6*t.y*r.y+3*R)+E*m.y*(-2*t.y*r.y-R)+p.y*I*(6*t.y*r.y+3*R)+o.y*n.x*H*(-2*t.y*r.y-R)+o.x*n.y*H*(-4*t.y*r.y-2*R)+p.x*H*m.y*(-6*t.y*r.y-3*R)+t.x*H*m.y*(6*t.y*r.y+3*R)+I*(-2*t.y*R-N*r.y-t.y*(2*t.y*r.y+R)),-p.x*o.x*n.y*m.x*s.y*m.y+p.x*o.y*n.x*m.x*s.y*m.y+6*p.x*o.y*s.x*n.y*m.x*m.y-6*p.y*o.x*n.x*m.x*s.y*m.y-p.y*o.x*s.x*n.y*m.x*m.y+p.y*o.y*n.x*s.x*m.x*m.y-o.x*o.y*n.x*s.x*n.y*m.y+o.x*o.y*n.x*n.y*m.x*s.y+o.x*t.x*n.y*m.x*s.y*m.y+6*o.x*n.x*t.y*m.x*s.y*m.y+o.x*t.y*s.x*n.y*m.x*m.y-t.x*o.y*n.x*m.x*s.y*m.y-6*t.x*o.y*s.x*n.y*m.x*m.y-o.y*n.x*t.y*s.x*m.x*m.y-6*p.x*t.x*s.x*K-2*p.x*s.x*G*m.x+6*p.y*t.y*I*s.y+2*t.x*s.x*G*m.x+2*p.y*E*s.y*m.y-2*E*t.y*s.y*m.y-6*p.x*p.y*s.x*m.x*J+3*p.x*o.x*n.x*s.y*J-2*p.x*o.x*s.x*n.y*J-4*p.x*o.y*n.x*s.x*J+3*p.y*o.x*n.x*s.x*J+6*p.x*p.y*H*s.y*m.y+6*p.x*t.x*m.x*s.y*J-3*p.x*o.y*n.y*H*s.y+2*p.x*n.x*s.x*F*m.y+2*p.x*n.x*F*m.x*s.y+6*p.x*t.y*s.x*m.x*J+4*p.y*o.x*n.y*H*s.y+6*p.y*t.x*s.x*m.x*J+2*p.y*o.y*n.x*H*s.y-3*p.y*o.y*s.x*n.y*H+2*p.y*n.x*s.x*F*m.x-3*o.x*t.x*n.x*s.y*J+2*o.x*t.x*s.x*n.y*J+o.x*o.y*s.x*F*m.x-3*o.x*n.x*t.y*s.x*J+4*t.x*o.y*n.x*s.x*J-6*p.x*t.y*H*s.y*m.y-2*p.x*D*n.y*s.y*m.y-6*p.y*t.x*H*s.y*m.y-6*p.y*t.y*s.x*H*m.y-2*p.y*D*s.x*n.y*m.y-2*p.y*D*n.y*m.x*s.y-o.x*o.y*D*s.y*m.y-4*o.x*t.y*n.y*H*s.y-2*o.x*B*s.x*m.x*m.y+3*t.x*o.y*n.y*H*s.y-2*t.x*n.x*s.x*F*m.y-2*t.x*n.x*F*m.x*s.y-6*t.x*t.y*s.x*m.x*J-2*o.y*n.x*t.y*H*s.y+3*o.y*t.y*s.x*n.y*H-2*n.x*t.y*s.x*F*m.x-B*n.x*s.x*n.y*m.x+6*t.x*t.y*H*s.y*m.y+2*t.x*D*n.y*s.y*m.y+2*z*o.y*m.x*s.y*m.y+z*n.x*n.y*s.y*m.y+2*D*t.y*s.x*n.y*m.y+2*D*t.y*n.y*m.x*s.y+3*v*s.x*K-3*x*I*s.y+3*L*s.x*K+C*s.x*H-A*s.y*J-3*N*I*s.y-o.x*B*H*s.y+z*o.y*s.x*J-3*v*m.x*s.y*J+3*x*s.x*H*m.y-z*F*m.x*s.y+B*D*s.x*m.y-3*L*m.x*s.y*J+3*N*s.x*H*m.y,p.x*p.y*o.x*n.y*m.x*m.y-p.x*p.y*o.y*n.x*m.x*m.y+p.x*o.x*o.y*n.x*n.y*m.y-p.y*o.x*o.y*n.x*n.y*m.x-p.x*o.x*t.y*n.y*m.x*m.y+6*p.x*t.x*o.y*n.y*m.x*m.y+p.x*o.y*n.x*t.y*m.x*m.y-p.y*o.x*t.x*n.y*m.x*m.y-6*p.y*o.x*n.x*t.y*m.x*m.y+p.y*t.x*o.y*n.x*m.x*m.y-o.x*t.x*o.y*n.x*n.y*m.y+o.x*o.y*n.x*t.y*n.y*m.x+o.x*t.x*t.y*n.y*m.x*m.y-t.x*o.y*n.x*t.y*m.x*m.y-2*p.x*t.x*G*m.x+2*p.y*E*t.y*m.y-3*p.x*p.y*o.x*n.x*J-6*p.x*p.y*t.x*m.x*J+3*p.x*p.y*o.y*n.y*H-2*p.x*p.y*n.x*F*m.x-2*p.x*o.x*t.x*n.y*J-p.x*o.x*o.y*F*m.x+3*p.x*o.x*n.x*t.y*J-4*p.x*t.x*o.y*n.x*J+3*p.y*o.x*t.x*n.x*J+6*p.x*p.y*t.y*H*m.y+2*p.x*p.y*D*n.y*m.y+2*p.x*o.x*B*m.x*m.y+2*p.x*t.x*n.x*F*m.y+6*p.x*t.x*t.y*m.x*J-3*p.x*o.y*t.y*n.y*H+2*p.x*n.x*t.y*F*m.x+p.x*B*n.x*n.y*m.x+p.y*o.x*o.y*D*m.y+4*p.y*o.x*t.y*n.y*H-3*p.y*t.x*o.y*n.y*H+2*p.y*t.x*n.x*F*m.x+2*p.y*o.y*n.x*t.y*H+o.x*t.x*o.y*F*m.x-3*o.x*t.x*n.x*t.y*J-2*p.x*D*t.y*n.y*m.y-6*p.y*t.x*t.y*H*m.y-2*p.y*t.x*D*n.y*m.y-2*p.y*z*o.y*m.x*m.y-p.y*z*n.x*n.y*m.y-2*p.y*D*t.y*n.y*m.x-2*o.x*t.x*B*m.x*m.y-o.x*o.y*D*t.y*m.y+3*t.x*o.y*t.y*n.y*H-2*t.x*n.x*t.y*F*m.x-t.x*B*n.x*n.y*m.x+3*x*o.x*n.x*m.x*m.y+3*o.x*n.x*N*m.x*m.y+2*t.x*D*t.y*n.y*m.y-3*v*o.y*n.y*m.x*m.y+2*z*o.y*t.y*m.x*m.y+z*n.x*t.y*n.y*m.y-3*L*o.y*n.y*m.x*m.y-w*K+y*I+M*K-O*I-3*p.x*L*K-p.x*C*H+3*v*t.x*K+p.y*A*J+3*p.y*N*I+t.x*C*H+v*G*m.x-3*x*t.y*I-x*E*m.y+L*G*m.x-A*t.y*J-E*N*m.y-p.x*z*o.y*J+p.y*o.x*B*H-3*p.x*x*H*m.y-p.x*B*D*m.y+p.y*z*F*m.x-o.x*B*t.y*H+3*v*p.y*m.x*J+v*o.x*n.y*J+2*v*o.y*n.x*J-2*x*o.x*n.y*H-x*o.y*n.x*H+z*t.x*o.y*J-3*p.x*N*H*m.y+3*p.y*L*m.x*J+o.x*L*n.y*J-2*o.x*N*n.y*H+t.x*B*D*m.y-o.y*n.x*N*H-v*n.x*F*m.y-3*v*t.y*m.x*J+3*x*t.x*H*m.y+x*D*n.y*m.x-z*t.y*F*m.x+2*L*o.y*n.x*J+3*t.x*N*H*m.y-L*n.x*F*m.y-3*L*t.y*m.x*J+D*N*n.y*m.x),$=Z.getRootsInInterval(0,1),_=0;_<$.length;_++){var aa=$[_],ba=new Polynomial(m.x,n.x,o.x,p.x-t.x-aa*s.x-aa*aa*r.x-aa*aa*aa*q.x).getRoots(),ca=new Polynomial(m.y,n.y,o.y,p.y-t.y-aa*s.y-aa*aa*r.y-aa*aa*aa*q.y).getRoots();if(ba.length>0&&ca.length>0){var da=1e-4;a:for(var ea=0;ea<ba.length;ea++){var fa=ba[ea];if(fa>=0&&1>=fa)for(var ga=0;ga<ca.length;ga++)if(Math.abs(fa-ca[ga])<da){u.points.push(q.multiply(aa*aa*aa).add(r.multiply(aa*aa).add(s.multiply(aa).add(t))));break a}}}}return u.points.length>0&&(u.status="Intersection"),u},hd.intersectBezier3Circle=function(a,b,c,d,e,f){return hd.intersectBezier3Ellipse(a,b,c,d,e,f,f)},hd.intersectBezier3Ellipse=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p=new hd("No Intersection");h=a.multiply(-1),i=b.multiply(3),j=c.multiply(-3),k=h.add(i.add(j.add(d))),l=new Vector2D(k.x,k.y),h=a.multiply(3),i=b.multiply(-6),j=c.multiply(3),k=h.add(i.add(j)),m=new Vector2D(k.x,k.y),h=a.multiply(-3),i=b.multiply(3),j=h.add(i),n=new Vector2D(j.x,j.y),o=new Vector2D(a.x,a.y);for(var q=f*f,r=g*g,s=new Polynomial(l.x*l.x*r+l.y*l.y*q,2*(l.x*m.x*r+l.y*m.y*q),2*(l.x*n.x*r+l.y*n.y*q)+m.x*m.x*r+m.y*m.y*q,2*l.x*r*(o.x-e.x)+2*l.y*q*(o.y-e.y)+2*(m.x*n.x*r+m.y*n.y*q),2*m.x*r*(o.x-e.x)+2*m.y*q*(o.y-e.y)+n.x*n.x*r+n.y*n.y*q,2*n.x*r*(o.x-e.x)+2*n.y*q*(o.y-e.y),o.x*o.x*r-2*o.y*e.y*q-2*o.x*e.x*r+o.y*o.y*q+e.x*e.x*r+e.y*e.y*q-q*r),t=s.getRootsInInterval(0,1),u=0;u<t.length;u++){var v=t[u];p.points.push(l.multiply(v*v*v).add(m.multiply(v*v).add(n.multiply(v).add(o))))}return p.points.length>0&&(p.status="Intersection"),p},hd.intersectBezier3Line=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q=e.min(f),r=e.max(f),s=new hd("No Intersection");g=a.multiply(-1),h=b.multiply(3),i=c.multiply(-3),j=g.add(h.add(i.add(d))),k=new Vector2D(j.x,j.y),g=a.multiply(3),h=b.multiply(-6),i=c.multiply(3),j=g.add(h.add(i)),l=new Vector2D(j.x,j.y),g=a.multiply(-3),h=b.multiply(3),i=g.add(h),m=new Vector2D(i.x,i.y),n=new Vector2D(a.x,a.y),p=new Vector2D(e.y-f.y,f.x-e.x),o=e.x*f.y-f.x*e.y,roots=new Polynomial(p.dot(k),p.dot(l),p.dot(m),p.dot(n)+o).getRoots();for(var t=0;t<roots.length;t++){var u=roots[t];if(u>=0&&1>=u){var v=a.lerp(b,u),w=b.lerp(c,u),x=c.lerp(d,u),y=v.lerp(w,u),z=w.lerp(x,u),A=y.lerp(z,u);e.x==f.x?q.y<=A.y&&A.y<=r.y&&(s.status="Intersection",s.appendPoint(A)):e.y==f.y?q.x<=A.x&&A.x<=r.x&&(s.status="Intersection",s.appendPoint(A)):A.gte(q)&&A.lte(r)&&(s.status="Intersection",s.appendPoint(A))}}return s},hd.intersectBezier3Polygon=function(a,b,c,d,e){for(var f=new hd("No Intersection"),g=e.length,h=0;g>h;h++){var i=e[h],j=e[(h+1)%g],k=hd.intersectBezier3Line(a,b,c,d,i,j);f.appendPoints(k.points)}return f.points.length>0&&(f.status="Intersection"),f},hd.intersectBezier3Rectangle=function(a,b,c,d,e,f){var g=e.min(f),h=e.max(f),i=new _b(h.x,g.y),j=new _b(g.x,h.y),k=hd.intersectBezier3Line(a,b,c,d,g,i),l=hd.intersectBezier3Line(a,b,c,d,i,h),m=hd.intersectBezier3Line(a,b,c,d,h,j),n=hd.intersectBezier3Line(a,b,c,d,j,g),o=new hd("No Intersection");return o.appendPoints(k.points),o.appendPoints(l.points),o.appendPoints(m.points),o.appendPoints(n.points),o.points.length>0&&(o.status="Intersection"),o},hd.intersectCircleCircle=function(a,b,c,d){var e,f=b+d,g=Math.abs(b-d),h=a.distanceFrom(c);if(h>f)e=new hd("Outside");else if(g>h)e=new hd("Inside");else{e=new hd("Intersection");var i=(b*b-d*d+h*h)/(2*h),j=Math.sqrt(b*b-i*i),k=a.lerp(c,i/h),l=j/h;e.points.push(new _b(k.x-l*(c.y-a.y),k.y+l*(c.x-a.x))),e.points.push(new _b(k.x+l*(c.y-a.y),k.y-l*(c.x-a.x)))}return e},hd.intersectCircleEllipse=function(a,b,c,d,e){return hd.intersectEllipseEllipse(a,b,b,c,d,e)},hd.intersectCircleLine=function(a,b,c,d){var e,f=(d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y),g=2*((d.x-c.x)*(c.x-a.x)+(d.y-c.y)*(c.y-a.y)),h=a.x*a.x+a.y*a.y+c.x*c.x+c.y*c.y-2*(a.x*c.x+a.y*c.y)-b*b,i=g*g-4*f*h;if(0>i)e=new hd("Outside");else if(0==i)e=new hd("Tangent");else{var j=Math.sqrt(i),k=(-g+j)/(2*f),l=(-g-j)/(2*f);(0>k||k>1)&&(0>l||l>1)?e=new hd(0>k&&0>l||k>1&&l>1?"Outside":"Inside"):(e=new hd("Intersection"),k>=0&&1>=k&&e.points.push(c.lerp(d,k)),l>=0&&1>=l&&e.points.push(c.lerp(d,l)))}return e},hd.intersectCirclePolygon=function(a,b,c){for(var d,e=new hd("No Intersection"),f=c.length,g=0;f>g;g++){var h=c[g],i=c[(g+1)%f];d=hd.intersectCircleLine(a,b,h,i),e.appendPoints(d.points)}return e.points.length>0?e.status="Intersection":e.status=d.status,e},hd.intersectCircleRectangle=function(a,b,c,d){var e=c.min(d),f=c.max(d),g=new _b(f.x,e.y),h=new _b(e.x,f.y),i=hd.intersectCircleLine(a,b,e,g),j=hd.intersectCircleLine(a,b,g,f),k=hd.intersectCircleLine(a,b,f,h),l=hd.intersectCircleLine(a,b,h,e),m=new hd("No Intersection");return m.appendPoints(i.points),m.appendPoints(j.points),m.appendPoints(k.points),m.appendPoints(l.points),m.points.length>0?m.status="Intersection":m.status=i.status,m},hd.intersectEllipseEllipse=function(a,b,c,d,e,f){for(var g=[c*c,0,b*b,-2*c*c*a.x,-2*b*b*a.y,c*c*a.x*a.x+b*b*a.y*a.y-b*b*c*c],h=[f*f,0,e*e,-2*f*f*d.x,-2*e*e*d.y,f*f*d.x*d.x+e*e*d.y*d.y-e*e*f*f],i=hd.bezout(g,h),j=i.getRoots(),k=.001,l=(g[0]*g[0]+2*g[1]*g[1]+g[2]*g[2])*k,m=(h[0]*h[0]+2*h[1]*h[1]+h[2]*h[2])*k,n=new hd("No Intersection"),o=0;o<j.length;o++)for(var p=new Polynomial(g[0],g[3]+j[o]*g[1],g[5]+j[o]*(g[4]+j[o]*g[2])),q=p.getRoots(),r=0;r<q.length;r++){var s=(g[0]*q[r]+g[1]*j[o]+g[3])*q[r]+(g[2]*j[o]+g[4])*j[o]+g[5];Math.abs(s)<l&&(s=(h[0]*q[r]+h[1]*j[o]+h[3])*q[r]+(h[2]*j[o]+h[4])*j[o]+h[5],Math.abs(s)<m&&n.appendPoint(new _b(q[r],j[o])))}return n.points.length>0&&(n.status="Intersection"),n},hd.intersectEllipseLine=function(a,b,c,d,e){var f,g=new Vector2D(d.x,d.y),h=Vector2D.fromPoints(d,e),i=new Vector2D(a.x,a.y),j=g.subtract(i),k=new Vector2D(h.x/(b*b),h.y/(c*c)),l=new Vector2D(j.x/(b*b),j.y/(c*c)),m=h.dot(k),n=h.dot(l),a=j.dot(l)-1,o=n*n-m*a;if(0>o)f=new hd("Outside");else if(o>0){var p=Math.sqrt(o),q=(-n-p)/m,r=(-n+p)/m;(0>q||q>1)&&(0>r||r>1)?f=new hd(0>q&&0>r||q>1&&r>1?"Outside":"Inside"):(f=new hd("Intersection"),q>=0&&1>=q&&f.appendPoint(d.lerp(e,q)),r>=0&&1>=r&&f.appendPoint(d.lerp(e,r)))}else{var s=-n/m;s>=0&&1>=s?(f=new hd("Intersection"),f.appendPoint(d.lerp(e,s))):f=new hd("Outside")}return f},hd.intersectEllipsePolygon=function(a,b,c,d){for(var e=new hd("No Intersection"),f=d.length,g=0;f>g;g++){var h=d[g],i=d[(g+1)%f],j=hd.intersectEllipseLine(a,b,c,h,i);e.appendPoints(j.points)}return e.points.length>0&&(e.status="Intersection"),e},hd.intersectEllipseRectangle=function(a,b,c,d,e){var f=d.min(e),g=d.max(e),h=new _b(g.x,f.y),i=new _b(f.x,g.y),j=hd.intersectEllipseLine(a,b,c,f,h),k=hd.intersectEllipseLine(a,b,c,h,g),l=hd.intersectEllipseLine(a,b,c,g,i),m=hd.intersectEllipseLine(a,b,c,i,f),n=new hd("No Intersection");return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n},hd.intersectLineLine=function(a,b,c,d){var e,f=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),g=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),h=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!=h){var i=f/h,j=g/h;i>=0&&1>=i&&j>=0&&1>=j?(e=new hd("Intersection"),e.points.push(new _b(a.x+i*(b.x-a.x),a.y+i*(b.y-a.y)))):e=new hd("No Intersection")}else e=new hd(0==f||0==g?"Coincident":"Parallel");return e},hd.intersectLinePolygon=function(a,b,c){for(var d=new hd("No Intersection"),e=c.length,f=0;e>f;f++){var g=c[f],h=c[(f+1)%e],i=hd.intersectLineLine(a,b,g,h);d.appendPoints(i.points)}return d.points.length>0&&(d.status="Intersection"),d},hd.intersectLineRectangle=function(a,b,c,d){var e=c.min(d),f=c.max(d),g=new _b(f.x,e.y),h=new _b(e.x,f.y),i=hd.intersectLineLine(e,g,a,b),j=hd.intersectLineLine(g,f,a,b),k=hd.intersectLineLine(f,h,a,b),l=hd.intersectLineLine(h,e,a,b),m=new hd("No Intersection");return m.appendPoints(i.points),m.appendPoints(j.points),m.appendPoints(k.points),m.appendPoints(l.points),m.points.length>0&&(m.status="Intersection"),m},hd.intersectPolygonPolygon=function(a,b){for(var c=new hd("No Intersection"),d=a.length,e=0;d>e;e++){var f=a[e],g=a[(e+1)%d],h=hd.intersectLinePolygon(f,g,b);c.appendPoints(h.points)}return c.points.length>0&&(c.status="Intersection"),c},hd.intersectPolygonRectangle=function(a,b,c){var d=b.min(c),e=b.max(c),f=new _b(e.x,d.y),g=new _b(d.x,e.y),h=hd.intersectLinePolygon(d,f,a),i=hd.intersectLinePolygon(f,e,a),j=hd.intersectLinePolygon(e,g,a),k=hd.intersectLinePolygon(g,d,a),l=new hd("No Intersection");return l.appendPoints(h.points),l.appendPoints(i.points),l.appendPoints(j.points),l.appendPoints(k.points),l.points.length>0&&(l.status="Intersection"),l},hd.intersectRayRay=function(a,b,c,d){var e,f=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),g=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),h=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!=h){var i=f/h;e=new hd("Intersection"),e.points.push(new _b(a.x+i*(b.x-a.x),a.y+i*(b.y-a.y)))}else e=new hd(0==f||0==g?"Coincident":"Parallel");return e},hd.intersectRectangleRectangle=function(a,b,c,d){var e=a.min(b),f=a.max(b),g=new _b(f.x,e.y),h=new _b(e.x,f.y),i=hd.intersectLineRectangle(e,g,c,d),j=hd.intersectLineRectangle(g,f,c,d),k=hd.intersectLineRectangle(f,h,c,d),l=hd.intersectLineRectangle(h,e,c,d),m=new hd("No Intersection");return m.appendPoints(i.points),m.appendPoints(j.points),m.appendPoints(k.points),m.appendPoints(l.points),m.points.length>0&&(m.status="Intersection"),m},hd.bezout=function(a,b){var c=a[0]*b[1]-b[0]*a[1],d=a[0]*b[2]-b[0]*a[2],e=a[0]*b[3]-b[0]*a[3],f=a[0]*b[4]-b[0]*a[4],g=a[0]*b[5]-b[0]*a[5],h=a[1]*b[2]-b[1]*a[2],i=a[1]*b[4]-b[1]*a[4],j=a[1]*b[5]-b[1]*a[5],k=a[2]*b[3]-b[2]*a[3],l=a[3]*b[4]-b[3]*a[4],m=a[3]*b[5]-b[3]*a[5],n=j+l,o=i-k;return new Polynomial(c*h-d*d,c*o+e*h-2*d*f,c*n+e*o-f*f-2*d*g,c*m+e*n-2*f*g,e*m-g*g)},$b.Intersection=hd,$b.AreaPicking=function(a,b){this.network=a,this.bounding=b,this.cache={}},$b.extend($b.AreaPicking,Object,{intersectObjects:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];this.intersectObject(d,b)}return b},getViewPoint:function(a,b){var c=b.vertices[a].clone(),d=this.cache[b.getId()][c.x+" "+c.y+" "+c.z];return d?d:(c.applyMatrix4(b.worldMatrix),d=this.network.getViewPosition(c),d.y=d.h-d.y,d)},intersectObject:function(a,b){if(a instanceof $b.Entity){this.cache[a.getId()]={};for(var c=0;c<a.vertices.length;c++){var d=a.vertices[c].clone();d.applyMatrix4(a.worldMatrix);var e=this.network.getViewPosition(d);if(e.y=e.h-e.y,this.cache[a.getId()][d.x+" "+d.y+" "+d.z]=e,e.x>this.bounding.x&&e.y>this.bounding.y&&e.x<this.bounding.x+this.bounding.w&&e.y<this.bounding.y+this.bounding.h){var f={element:a};return void b.push(f)}}}}}),$b.BaseInteraction=function(a){this.network=a,this.view=a.getView()||document},$b.addEventListener=function(a,b,c,d){var e="_"+a+"_";if(!d[e]){var f=function(a){d[b](a)};d[e]=f,c.addEventListener(a,f,!1)}},$b.removeEventListener=function(a,b,c){var d="_"+a+"_",e=c[d];e&&(b.removeEventListener(a,e,!1),delete c[d])},$b.extend($b.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];$b.addEventListener(b,"handle_"+b,this.network.getRootView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++){arguments[a];$b.removeEventListener(arguments[a],this.network.getRootView(),this)}},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},isFinished:function(){return!0}}),$b.DefaultInteraction=function(a){$b.BaseInteraction.call(this,a),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=10,this.panSpeed=3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.lastPosition=new $b.Vec3;var b,c,e=this.STATE.NONE,f=(this.STATE.NONE,new $b.Vec3),g=new $b.Vec3,h=new $b.Vec3,i=new $b.Vec2,j=new $b.Vec2,k=0,l=0,m=new $b.Vec2,n=new $b.Vec2;this.object=this.network._camera,this.object.target||(this.object.target=new $b.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.verticalLookRatio=.1,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalFixed=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.touchSeq=[1,2,3],this.fpsMinDistance=100,this.network.getRootView().addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var o=null;this.handleResize=function(){this.screen.width=d.innerWidth,this.screen.height=d.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(a){if(!dc.isCtrlDown(a)){if(a.preventDefault(),this.fpsMode){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=a.pageX,this.lastY=a.pageY,this.mouseDragOn=!0}else e===this.STATE.NONE&&(e=a.button),e!==this.STATE.ROTATE||this.noRotate?this.state!==this.STATE.ZOOM||this.noZoom?e===this.STATE.PAN&&!this.noPan&&(m=n=this.getMouseOnScreen(a.clientX,a.clientY)):i=j=this.getMouseOnScreen(a.clientX,a.clientY):(g=h=this.getMouseProjectionOnBall(a.clientX,a.clientY),b=c=this.getRotateY(a.clientX,a.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")}},this.handle_mousemove=function(a){if(!a.stop){a.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=300*(a.pageX-this.lastX),this.mouseY=300*(a.pageY-this.lastY),this.lastX=a.pageX,this.lastY=a.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,this.mouseY=a.pageY-this.viewHalfY):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY):e!==this.STATE.ROTATE||this.noRotate?e!==this.STATE.ZOOM||this.noZoom?e===this.STATE.PAN&&!this.noPan&&(n=this.getMouseOnScreen(a.clientX,a.clientY)):j=this.getMouseOnScreen(a.clientX,a.clientY):(h=this.getMouseProjectionOnBall(a.clientX,a.clientY),c=this.getRotateY(a.clientX,a.clientY));var b=(new Date).getTime();if(null==this._lt)this.update();else{if(b-this._lt<this.updateIntervalTime)return;this.update()}this._lt=b}},this.handle_mouseup=function(a){if(a.preventDefault(),this.fpsMode){if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else e=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update(),this.afterHandleMouseup()},this.afterHandleMouseup=function(){},this.handle_touchstart=function(a){if(this.enabled!==!1){switch(a.touches.length){case this.touchSeq[0]:e=this.STATE.TOUCH_ROTATE,g=this.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY),
b=c=this.getRotateY(a.touches[0].pageX,a.touches[0].pageY),h.copy(g);break;case this.touchSeq[1]:e=this.STATE.TOUCH_ZOOM;var d=a.touches[0].pageX-a.touches[1].pageX,f=a.touches[0].pageY-a.touches[1].pageY;l=k=Math.sqrt(d*d+f*f);break;case this.touchSeq[2]:e=this.STATE.TOUCH_PAN,m.copy(this.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY)),n.copy(m);break;default:e=this.STATE.NONE}this.update()}},this.handle_touchmove=function(a){if(this.enabled!==!1){switch(a.preventDefault(),a.touches.length){case this.touchSeq[0]:h=this.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,h),c=this.getRotateY(a.touches[0].pageX,a.touches[0].pageY);break;case this.touchSeq[1]:var b=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY;l=Math.sqrt(b*b+d*d);break;case this.touchSeq[2]:n=this.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,n);break;default:e=this.STATE.NONE}this.update()}},this.handle_touchend=function(a){if(this.enabled!==!1){switch(a.touches.length){case this.touchSeq[0]:g.copy(this.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,h));break;case this.touchSeq[1]:k=l=0;break;case this.touchSeq[2]:n.copy(this.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY)),m.copy(n)}e=this.STATE.NONE,this.update()}},this.handle_DOMMouseScroll=function(a){this.handle_mousewheel(a)},this.handle_mousewheel=function(a){a.preventDefault();var b=0;a.wheelDelta?b=a.wheelDelta%120===0?a.wheelDelta/40:Math.abs(a.wheelDelta)>=100?a.wheelDelta/40:a.wheelDelta:a.detail&&(b=-a.detail/3),b&&(i.y+=1/b*.01),this.mouseMoving=!0,this.update()},this.handle_dblclick=function(a){if(this.isCtrlDown(a)){var b=this.network.getElementsByMouseEvent(a);b.length>0&&(o=b[0]),this.update()}},this.getMouseOnScreen=function(a,b){return new $b.Vec2((a-this.screen.offsetLeft)/this.radius*.5,(b-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(a,b){if(this.yRistrict){var c=(.5*this.screen.height+this.screen.offsetTop-b)/this.screen.height*2;return c}},this.handle_keydown=function(a){if(this.keyboardEnable){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()}},this.handle_keyup=function(a){if(this.keyboardEnable){switch(a.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()}},this.getMouseProjectionOnBall=function(a,b){if(this.yRistrict){var c=new $b.Vec3((a-.5*this.screen.width-this.screen.offsetLeft)/(.5*this.screen.width),0,0),d=c.length();return d>1?c.normalize():c.z=Math.sqrt(1-d*d),c.normalize()}var c=new $b.Vec3((a-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-b)/this.radius,0),d=c.length();d>1?c.normalize():c.z=Math.sqrt(1-d*d),f.copy(this.object._position).sub(this.object.target);var e=this.object.up.clone().setLength(c.y);return e.add(this.object.up.clone().cross(f).setLength(c.x)),e.add(f.setLength(c.z)),e},this.rotateSpeedFunction=function(){return this.rotateSpeed},this.rotateCamera=function(){var a=g.dot(h)/g.length()/h.length(),d=Math.acos(a),e=!this.easing||Math.abs(d)<1e-4,i=!1,j=this.rotateSpeedFunction();if(d){var k=(new $b.Vec3).crossVectors(g,h).normalize(),l=new $b.Quat;l.setFromAxisAngle(k,-d*this.dynamicDampingFactor*j),e?(l.setFromAxisAngle(k,-d*j),f.applyQuaternion(l),this.object.up.applyQuaternion(l),g.copy(h)):(l.setFromAxisAngle(k,-d*this.dynamicDampingFactor*j),f.applyQuaternion(l),this.object.up.applyQuaternion(l),l.setFromAxisAngle(k,d*this.dynamicDampingFactor),g.applyQuaternion(l),i=!0)}var e=!this.easing||Math.abs(c-b)<1e-4,m=(c-b)*f.length();if(!uc.isNaN(m))if(e)m&&this.yRistrict&&this.limitY(m),b=c;else{var m=m*this.dynamicDampingFactor;m&&this.yRistrict&&this.limitY(m),b+=(c-b)*this.dynamicDampingFactor,i=!0}i&&this.network.dirtyNetwork()},this.limitY=function(a){var b=f.length();Math.abs(f.x)<=.1*b&&Math.abs(f.z)<=.1*b&&(f.x=.1*b);var c=f.x,d=f.z,e=Math.sqrt(c*c+d*d),g=Math.tan(this.yLowerLimitAngle)*e,h=Math.tan(this.yUpLimitAngle)*e;f.y-=a,f.y>h?f.y=h:f.y<g&&(f.y=g)},this.getValueByTime=function(a,b){var c=(new Date).getTime(),d=c-this._timeStart;return d>this.timeInterval?b:a+(b-a)*d/this.timeInterval},this.zoomCamera=function(){if(e===this.STATE.TOUCH_ZOOM){var a=k/l;k=l,f.multiplyScalar(a)}else{var b=this.zoomSpeed;this.easing||(b*=5);var a;a=1+(j.y-i.y)*b,1!==a&&a>0&&(f.multiplyScalar(a),!this.easing||Math.abs(j.y-i.y)<.001?i.copy(j):(i.y+=(j.y-i.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var a=n.clone().sub(m);if(a.lengthSq()){a.multiplyScalar(f.length()*this.panSpeed);var b=f.clone().cross(this.object.up).setLength(a.x),c=(new cc).extractRotation(this.object.matrix),d=this.object.up.clone().applyMatrix4(c);b.add(d.setLength(a.y));var e=this.object.p().add(b);this.object.checkPosition(e)&&(this.object.p(e),this.object.target.add(b)),m=n,this.network.dirtyNetwork()}},this.checkAngles=function(){},this.checkDistances=function(){this.noZoom&&this.noPan||(f.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.addVectors(this.object.target,f.setLength(this.maxDistance)),f.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,f.setLength(this.minDistance)))},this.updateFPS=function(){var a=2;if(!this.freeze){if(this.heightSpeed){var b=$b.Math.clamp(this.object._position.y,this.heightMin,this.heightMax),c=b-this.heightMin;this.autoSpeedFactor=a*c*this.heightCoef}else this.autoSpeedFactor=0;var d=a*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){var e=this.object._position.clone();this.object.translateZ(-(d+this.autoSpeedFactor));var g=this.object.target;this.verticalFixed&&this.object.setY(e.y);var h=this.object._position,i=new ac,j=new ac;i.subVectors(h,g),j.subVectors(e,g),i.z*j.z<=this.minDistance*this.minDistance&&this.object.target.subVectors(this.object._position,f)}if(this.moveBackward){var e=this.object._position.clone();this.object.translateZ(d),this.verticalFixed&&this.object.setY(e.y)}this.moveLeft&&(this.object.translateX(this.fpsMode?d:-d),this.object.target.subVectors(this.object._position,f)),this.moveRight&&(this.object.translateX(this.fpsMode?-d:d),this.object.target.subVectors(this.object._position,f)),this.moveUp&&(this.object.translateY(d),this.object.target.subVectors(this.object._position,f)),this.moveDown&&(this.object.translateY(-d),this.object.target.subVectors(this.object._position,f));var k=a*this.lookSpeed;!this.activeLook&&!this.dragMode&&(k=0);var l=this.verticalLookRatio;if(this.constrainVertical&&(l=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*k,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*k*l),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=$b.Math.degToRad(90-this.lat),this.theta=$b.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=$b.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),this.fpsMode){var m=this.object.target,h=this.object._position;length=length<this.fpsMinDistance?this.fpsMinDistance:length,m.x=h.x+length*Math.sin(this.phi)*Math.sin(this.theta),m.y=h.y+length*Math.cos(this.phi),m.z=h.z-length*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(m)}}},this.setCameraTarget=function(a){var b=this.Object;b.p()},this.update=function(){if(f.subVectors(this.object._position,this.object.target),!this.noRotate&&!this.fpsMode&&this.rotateCamera(),this.noZoom||this.zoomCamera(),!this.noPan&&!this.fpsMode&&this.panCamera(),o&&o.element&&this.network.doubleClickToLookAtFunction(o.element)){this.object.target=o.point;var a=this.object._position.distanceTo(this.object.target),b=o.face.normal.clone();b=b.applyMatrix4((new $b.Mat4).extractRotation(o.element.worldMatrix)),b.normalize(),f=b.multiplyScalar(a),o=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,f)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),this.lastPosition.distanceToSquared(this.object._position)>0&&this.lastPosition.copy(this.object._position)},this.handleCameraChange=function(a){var b=this.object;if(b){var c=b.p(),d=b.target;if(this.fpsMode){var e=uc.getVectorAngles(d,c);this.lat=-e[1],this.lon=-e[0]}}}},$b.extend($b.DefaultInteraction,$b.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing","touchSeq"],__bool:["noRotate","noPan","noZoom","fpsMode","yRistrict","keyboardEnable"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.addPropertyChangeListener(this.handleCameraChange,this)},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.removePropertyChangeListener(this.handleCameraChange,this)},beforeUpdate:function(){},setUpdateIntervalTime:function(a){this.updateIntervalTime=a}}),$b.SelectionInteraction=function(a){$b.BaseInteraction.call(this,a),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},$b.extend($b.SelectionInteraction,$b.BaseInteraction,{constructor:$b.SelectionInteraction,setAreaPickingLevel:function(a){this._areaPickingLevel=a},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(a){if(document.activeElement!==a){var b,c,d,e=document.documentElement;document.body;e&&(ec.isIE||ec.isOpera||e.scrollLeft||e.scrollTop)&&(b=e.scrollLeft,c=e.scrollTop,d=e),a.focus(),d&&(d.scrollLeft=b,d.scrollTop=c)}},handle_mousedown:function(a){if(1!=a.stop&&!dc.isRightClick(a)){this.setFocus(this.network.getView()),this.isCtrlDown(a)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=a):this.network.getDataBox().clearSelection();var b=this.network.getElementsByMouseEvent(a),c=this.network.getFirstSelectElement(b);this.network.getDataBox().getSelectionModel().appendSelection(c),this.network.onSelect(c)}},handle_mousemove:function(a){var b=this.getBoundingByMouseEvent(a,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=b,this.network.paintTopCanvas()},handle_mouseup:function(a){this.network.areaPickingRect=null,this.network.paintTopCanvas();var b=this.getBoundingByMouseEvent(a,this.ctrlDownEvent);if(this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null,b&&this.mousemoved){var c=this.network.getElementsByBounding(b,!0,this._areaPickingLevel),d=new mc;if(c.length>0)for(var e=0;e<c.length;e++){var f=c[e].element;this.network.selectable(c[e])&&d.add(f)}d.size()>0&&this.network.getDataBox().getSelectionModel().appendSelection(d)}},getBoundingByMouseEvent:function(a,b,c){if(a&&b){var d=this.network.getView().getBoundingClientRect(),e=a.clientX-d.left,f=a.clientY-d.top,g=b.clientX-d.left,h=b.clientY-d.top,i=c||1,j=Math.min(e,g)*i,k=Math.min(f,h)*i,l=Math.abs(e-g)*i,m=Math.abs(f-h)*i;return 0===l&&0===m?null:{x:j,y:k,w:l,h:m}}}}),$b.TransformGizmo=function(){var a=new $b.TransformGizmoMaterial({color:16711680}),b=new $b.TransformGizmoMaterial({color:65280}),c=new $b.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new $b.Cylinder(a,.005,.005,1,4,1,!1,!1),new ac(.5,0,0),new ac(0,0,-Math.PI/2)],Y:[new $b.Cylinder(b,.005,.005,1,4,1,!1,!1),new ac(0,.5,0)],Z:[new $b.Cylinder(c,.005,.005,1,4,1,!1,!1),new ac(0,0,.5),new ac(Math.PI/2,0,0)]};var d=!1,f=!1;this.showHelpers=!0,this.showable=!0,this.init=function(){$b.Element.call(this),this.handles=new $b.Element,this.pickers=new $b.Element,this.planes=new $b.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var a=new $b.BasicMaterial({wireframe:!1,color:65535,side:$b.DoubleSide}),b=(new $b.Plane(a,5e4,5e4,2,2),{XY:new $b.Plane(a,5e4,5e4,2,2),YZ:new $b.Plane(a,5e4,5e4,2,2),XZ:new $b.Plane(a,5e4,5e4,2,2),XYZE:new $b.Plane(a,5e4,5e4,2,2)});b.YZ._rotation.set(0,Math.PI/2,0),b.XZ._rotation.set(-Math.PI/2,0,0);for(var c in b)b[c].name=c,this.planes.addChild(b[c]),this.planes[c]=b[c],b[c]._visible=!0;for(var c in this.handleGizmos){var d=this.handleGizmos[c][0];if(d.name=c,this.handleGizmos[c][1]&&d._position.set(this.handleGizmos[c][1].x,this.handleGizmos[c][1].y,this.handleGizmos[c][1].z),this.handleGizmos[c][2]&&d._rotation.set(this.handleGizmos[c][2].x,this.handleGizmos[c][2].y,this.handleGizmos[c][2].z),d.mode=this.mode,this.handles.addChild(d),this.pickerGizmos&&this.pickerGizmos[c]){var e=this.pickerGizmos[c][0];this.pickerGizmos[c][1]&&e._position.set(this.pickerGizmos[c][1].x,this.pickerGizmos[c][1].y,this.pickerGizmos[c][1].z),this.pickerGizmos[c][2]&&e._rotation.set(this.pickerGizmos[c][2].x,this.pickerGizmos[c][2].y,this.pickerGizmos[c][2].z)}else var e=d.clone();e.mode=this.mode,e.name=c,this.pickers.addChild(e)}this.iterator(function(a){a instanceof $b.Entity&&$b.Utils.transformElement(a)})},this.hide=function(){this.handles.getChildren().forEach(function(a){a._visible=!1}),this.pickers.getChildren().forEach(function(a){a._visible=!1}),this.planes.getChildren().forEach(function(a){a._visible=!1})},this.show=function(){var a=this;this.handles.getChildren().forEach(function(b){b._visible=a.showHelpers&&a.showable}),this.pickers.getChildren().forEach(function(a){a._visible=d}),this.activePlane&&(this.activePlane._visible=f)},this.highlight=function(a){var b;for(var c in this.handleGizmos)b=this.handleGizmos[c][0],b.oldColor&&(b.material instanceof $b.ArrayMaterial?(b.material.materials[0].color.copy(b.oldColor),b.material.materials[0].opacity=b.oldOpacity):(b.material.color.copy(b.oldColor),b.material.opacity=b.oldOpacity),b.oldColor=null);this.handleGizmos[a]&&(b=this.handleGizmos[a][0],b.material instanceof $b.ArrayMaterial?(b.oldColor=b.oldColor||b.material.materials[0].color.clone(),b.oldOpacity=b.oldOpacit!==e?b.oldOpacity:b.material.materials[0].opacity,b.material.materials[0].opacity=1):(b.oldColor=b.oldColor||b.material.color.clone(),b.oldOpacity=b.material.opacity,b.setStyle("material.opacity",1)))},this.init()},$b.TransformGizmo.prototype=Object.create($b.Element.prototype),$b.TransformGizmo.prototype.update=function(a,b){for(var c=new ac(0,0,0),d=new ac(0,1,0),e=new cc,f=0;f<this.getChildren().size();f++)for(var g=0;g<this.getChildren().get(f).getChildren().size();g++){var h=this.getChildren().get(f).getChildren().get(g);-1!=h.name.search("E")?(h.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)),h._rotation.setEulerFromQuaternion(h.quaternion)):(h.quaternion.setFromEuler(a),h._rotation.setEulerFromQuaternion(h.quaternion))}},$b.TransformGizmoTranslate=function(){$b.TransformGizmo.call(this);var a=new $b.TransformGizmoMaterial({color:16711680,opacity:.2}),b=new $b.TransformGizmoMaterial({color:65280,opacity:.2}),c=new $b.TransformGizmoMaterial({color:255,opacity:.2}),d=new $b.Arrow(a,1,.03,.2,.05,30),e=new $b.Arrow(b,1,.03,.2,.05,30),f=new $b.Arrow(c,1,.03,.2,.05,30),g=new $b.TransformGizmoMaterial({color:255,opacity:.5}),h=new $b.TransformGizmoMaterial({color:16711680,opacity:.5}),i=new $b.TransformGizmoMaterial({color:65280,opacity:.5}),j=new $b.TransformGizmoMaterial({color:16777215,opacity:.5}),k=new $b.Circle(g,.5,10,0,Math.PI/2),l=new $b.Circle(h,.5,10,0,Math.PI/2),m=new $b.Circle(i,.5,10,0,Math.PI/2),n=new $b.Octahedron(j,1e-4,0);this.handleGizmos={X:[d,new ac(1.6,0,0),new ac(0,0,-Math.PI/2)],Y:[e,new ac(0,1.6,0)],Z:[f,new ac(0,0,1.6),new ac(Math.PI/2,0,0)],XYZ:[n],XY:[k,new ac(0,0,0)],YZ:[l,new ac(0,0,0),new ac(Math.PI/2,Math.PI/2,0)],XZ:[m,new ac(0,0,0),new ac(Math.PI/2,0,0)]};var j=new $b.TransformGizmoMaterial({color:16711680,opacity:.25}),o=new $b.TransformGizmoMaterial({color:65280,opacity:.25}),p=new $b.TransformGizmoMaterial({color:255,opacity:.25}),q=new $b.Cylinder(j,.075,0,1.2,4,1,!1),r=new $b.Cylinder(o,.075,0,1.2,4,1,!1),s=new $b.Cylinder(p,.075,0,1.2,4,1,!1),n=new $b.Octahedron(j,1e-4,0);this.pickerGizmos={X:[q,new ac(1.6,0,0),new ac(0,0,-Math.PI/2)],Y:[r,new ac(0,1.6,0)],Z:[s,new ac(0,0,1.6),new ac(Math.PI/2,0,0)],XYZ:[n]},this.setActivePlane=function(a,b){var c=new cc;b.applyProjection(c.getInverse(c.extractRotation(this.planes.XY.worldMatrix))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),"XY"==a&&(this.activePlane=this.planes.XY),"YZ"==a&&(this.activePlane=this.planes.YZ),"XZ"==a&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},$b.TransformGizmoTranslate.prototype=Object.create($b.TransformGizmo.prototype),$b.TransformGizmoTranslate.prototype.mode="translate",$b.TransformGizmoRotate=function(){$b.TransformGizmo.call(this);var a=new $b.TransformGizmoMaterial({color:16711680,opacity:.2}),b=new $b.TransformGizmoMaterial({color:65280,opacity:.2}),c=new $b.TransformGizmoMaterial({color:255,opacity:.2}),d=new $b.TransformGizmoMaterial({color:16776960}),e=new $b.TransformGizmoMaterial({color:7895160,opacity:.25}),e=new $b.TransformGizmoMaterial({color:16711680}),f=new $b.Torus(a,1,.02,4,32,Math.PI),g=new $b.Torus(b,1,.02,4,32,Math.PI),h=new $b.Torus(c,1,.02,4,32,Math.PI);new $b.Torus(d,1.25,.01,4,64),new $b.Torus(e,1,.01,4,64);this.handleGizmos={X:[f,new ac(0,0,0),new ac(0,-Math.PI/2,-Math.PI/2)],Y:[g,new ac(0,0,0),new ac(Math.PI/2,0,0)],Z:[h,new ac(0,0,0),new ac(0,0,-Math.PI/2)]};var i=new $b.TransformGizmoMaterial({color:16711680,opacity:.25}),j=new $b.TransformGizmoMaterial({color:65280,opacity:.25}),k=new $b.TransformGizmoMaterial({color:255,opacity:.25}),l=new $b.TransformGizmoMaterial({color:983040,opacity:.25}),m=new $b.Torus(i,1,.05,4,12,Math.PI),n=new $b.Torus(j,1,.05,4,12,Math.PI),o=new $b.Torus(k,1,.05,4,12,Math.PI);new $b.Torus(l,1,.05,2,24);this.pickerGizmos={X:[m,new ac(0,0,0),new ac(0,-Math.PI/2,-Math.PI/2)],Y:[n,new ac(0,0,0),new ac(Math.PI/2,0,0)],Z:[o,new ac(0,0,0),new ac(0,0,-Math.PI/2)]},this.setActivePlane=function(a){"E"==a&&(this.activePlane=this.planes.XYZE),"X"==a&&(this.activePlane=this.planes.YZ),"Y"==a&&(this.activePlane=this.planes.XZ),"Z"==a&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(a,b){$b.TransformGizmo.prototype.update.apply(this,arguments);var c={handles:this.handles,pickers:this.pickers},d=new cc,e=new $b.Euler(0,0,1),f=new $b.Quat,g=new ac(1,0,0),h=new ac(0,1,0),i=new ac(0,0,1),j=new $b.Quat,k=new $b.Quat,l=new $b.Quat,m=b.clone();e.copy(this.planes.XY._rotation),f.setFromEuler(e),d.makeRotationFromQuaternion(f).getInverse(d),m.applyProjection(d);for(var n in c)for(var o=0;o<c[n].getChildren().size;o++){var p=c[n].getChildren().get(o);f.setFromEuler(e),"X"==p.name&&(j.setFromAxisAngle(g,Math.atan2(-m.y,m.z)),f.multiplyQuaternions(f,j),p.quaternion.copy(f)),"Y"==p.name&&(k.setFromAxisAngle(h,Math.atan2(m.x,m.z)),f.multiplyQuaternions(f,k),p.quaternion.copy(f)),"Z"==p.name&&(l.setFromAxisAngle(i,Math.atan2(m.y,m.x)),f.multiplyQuaternions(f,l),p.quaternion.copy(f))}},this.init()},$b.TransformGizmoRotate.prototype=Object.create($b.TransformGizmo.prototype),$b.TransformGizmoRotate.prototype.mode="rotate",$b.TransformGizmoScale=function(){$b.TransformGizmo.call(this);var a=new $b.TransformGizmoMaterial({color:11184810,opacity:1}),b=new $b.TransformGizmoMaterial({color:16711680,opacity:.2}),c=new $b.TransformGizmoMaterial({color:65280,opacity:.2}),d=new $b.TransformGizmoMaterial({color:255,opacity:.2}),e=new $b.Cube(a,.25,.25,.25),f=new $b.Cylinder(null,.1,.1,1,4,1,!1),g=new $b.Cube(a,.225,.225,.225),h=new $b.Cylinder(null,.1,0,1,20,1,!0);h._position.y=.05;var h=$b.Utils.createElement(f,h,b),i=($b.Utils.createElement(f,h,c),$b.Utils.createElement(f,h,d),new $b.Cylinder(b,.08,0,1,4,1,!1)),j=new $b.Cylinder(c,.08,0,1,4,1,!1),k=new $b.Cylinder(d,.08,0,1,4,1,!1),l=new $b.Element;l.material=new $b.BasicMaterial;var m=new $b.Element;m.material=new $b.BasicMaterial;var n=new $b.Element;n.material=new $b.BasicMaterial,this.handleGizmos={X:[i,new ac(.5,0,0),new ac(0,0,-Math.PI/2)],Y:[j,new ac(0,.5,0)],Z:[k,new ac(0,0,.5),new ac(Math.PI/2,0,0)],XY:[l],YZ:[m],XZ:[n],XYZ:[e]};var o=new $b.TransformGizmoMaterial({color:16711680,opacity:.25}),p=new $b.TransformGizmoMaterial({color:65280,opacity:.25}),q=new $b.TransformGizmoMaterial({color:255,opacity:.25}),r=new $b.Cylinder(o,.125,0,1,4,1,!1),s=new $b.Cylinder(p,.125,0,1,4,1,!1),t=new $b.Cylinder(q,.125,0,1,4,1,!1);this.pickerGizmos={X:[r,new ac(.6,0,0),new ac(Math.PI/4,0,-Math.PI/2)],Y:[s,new ac(0,.6,0),new ac(0,Math.PI/4,0)],Z:[t,new ac(0,0,.6),new ac(Math.PI/2,Math.PI/4,0)],XYZ:[g]},this.setActivePlane=function(a,b){var c=new cc;b.applyProjection(c.getInverse(c.extractRotation(this.planes.XY.worldMatrix))),"X"==a?(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)):"Y"==a?(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)):"Z"==a?(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)):"XYZ"==a?this.activePlane=this.planes.XYZE:this.activePlane=this.planes[a],this.hide(),this.show()},this.init()},$b.TransformGizmoScale.prototype=Object.create($b.TransformGizmo.prototype),$b.TransformGizmoScale.prototype.mode="scale",$b.EditInteraction=function(a){function b(b){if(r.network._keyboardRemoveEnabled&&46==b.keyCode&&a.getDataBox().getSelectionModel().size()>0){var c="Delete?";d.confirm(c)&&a.getDataBox().removeSelection()}}function c(a){1===a.touches.length&&(r.deleteTimeoutId=setTimeout(function(){var b=r.network.getElementsByMouseEvent(a,r.selectUnVisible);if(b.length>0){var c=b[0],e="Delete?";d.confirm(e)&&r.network.getDataBox().remove(c.element)}},1e3))}function f(a){clearTimeout(r.deleteTimeoutId)}function g(a){clearTimeout(r.deleteTimeoutId)}function h(a){r.update()}function i(a){if(r.object&&!s){a.preventDefault(),a.stopPropagation();var b=a.touches?a.touches[0]:a,c=n(b,r.filterIntersectPicker(r.pickers));if(c)r.axis=c.object.name,r.setMode(c.object.mode);else{var d=l(a);d===r.object||null!=d&&d.editTransformToParent&&d.isDescendantOf(r.object)?(r.axis=r.getAxis(),r.setMode(r.getMode())):r.axis=!1}r.update(!0)}}function j(b){if(!b.stop){if(X.set(b.clientX,b.clientY),r.showHelpers&&r.axis||(m(b),i(b)),!r.object||s)return void r.network.dirtyNetwork();b.preventDefault(),b.stopPropagation();var c=b.touches?b.touches[0]:b;if(0===c.button||c.button==e){var d=r.filterIntersectPicker(r.pickers),f=n(c,d),g=l(b);if(f||(g===r.object||null!=g&&g.editTransformToParent&&g.isDescendantOf(r.object))&&r.getDefaultPickers()&&(f={object:r.getDefaultPickers()}),f){r.axis=f.object.name,A.copy(U).sub(R).normalize(),r.gizmo[t].setActivePlane(r.axis,A);var h=n(c,[r.gizmo[t].activePlane]);if(!h&&g&&(h=n(c,[g])),h){M.copy(r.object._position),N.copy(r.object._scale),O.extractRotation(r.object.matrix),T.extractRotation(r.object.worldMatrix);var j=r.object.getParent();j==e&&(j=a),P.extractRotation(j.worldMatrix),Q.getScaleFromMatrix(B.getInverse(j.worldMatrix)),v.copy(h.point)}}}r.update(!0),s=!0}}function k(b){if(r.object&&r.axis&&s){b.preventDefault(),b.stopPropagation(),b.stop=!0;var c=b.touches?b.touches[0]:b,d=n(c,[r.gizmo[t].activePlane]);if(d||(d=n(c,[r.object])),d){if(r.moving?a.fireInteractionEvent({kind:"liveMoveBetween",event:Vc}):(a.fireInteractionEvent({kind:"liveMoveStart",event:Vc}),r.moving=!0),u.copy(d.point),"translate"==t&&r.translateable){if(u.sub(v),u.multiply(Q),"local"==r.space&&(u.applyMatrix4(B.getInverse(T)),-1==r.axis.search("X")&&(u.x=0),-1==r.axis.search("Y")&&(u.y=0),-1==r.axis.search("Z")&&(u.z=0),u.applyMatrix4(O),r.object.setPosition(M.clone().add(u))),"world"==r.space||-1!=r.axis.search("XYZ")){-1==r.axis.search("X")&&(u.x=0),-1==r.axis.search("Y")&&(u.y=0),-1==r.axis.search("Z")&&(u.z=0),u.applyMatrix4(B.getInverse(P)),r.object._position.copy(M);var e=r.object._position.clone().add(u);r.snap&&(-1!=r.axis.search("X")&&(e.x=Math.round(r.object._position.x/r.snap)*r.snap),-1!=r.axis.search("Y")&&(e.y=Math.round(r.object._position.y/r.snap)*r.snap),-1!=r.axis.search("Z")&&(e.z=Math.round(r.object._position.z/r.snap)*r.snap)),r.object.setPosition(e)}}else if("scale"==t&&r.scaleable){u.sub(v),u.multiply(Q);var f=r.object._scale.clone(),g=(r.scaleRate||1)/10;if("XYZ"==r.axis)j=1+u.y*g,f.x=N.x*j,f.y=N.y*j,f.z=N.z*j;else if("XY"===r.axis){var h=1+u.x*g,i=1+u.y*g;if(r.forceSameScale){var j=Math.max(h,i);f.x=N.x*j,f.y=N.y*j}else f.x=N.x*h,f.y=N.y*i}else if("YZ"===r.axis){var k=1+u.z*g,i=1+u.y*g;if(r.forceSameScale){var j=Math.max(k,i);f.z=N.z*j,f.y=N.y*j}else f.z=N.z*k,f.y=N.y*i}else if("XZ"===r.axis){var h=1+u.x*g,k=1+u.z*g;if(r.forceSameScale){var j=Math.max(h,i);f.x=N.x*j,f.z=N.z*j}else f.x=N.x*h,f.z=N.z*k}else u.applyMatrix4(B.getInverse(T)),"X"==r.axis&&(f.x=N.x*(1+u.x*g)),"Y"==r.axis&&(f.y=N.y*(1+u.y*g)),"Z"==r.axis&&(f.z=N.z*(1+u.z*g));r.object.setScale(f)}else if("rotate"==t&&r.rotateable)if(u.sub(R),u.multiply(Q),C.copy(v).sub(R),C.multiply(Q),"E"==r.axis)u.applyMatrix4(B.getInverse(z)),C.applyMatrix4(B.getInverse(z)),w.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),x.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),D.setFromRotationMatrix(B.getInverse(P)),L.setFromAxisAngle(A,w.z-x.z),H.setFromRotationMatrix(T),D.multiplyQuaternions(D,L),D.multiplyQuaternions(D,H),r.object.quaternion.copy(D);else if("XYZE"==r.axis)L.setFromEuler(u.clone().cross(C).normalize()),D.setFromRotationMatrix(B.getInverse(P)),I.setFromAxisAngle(L,-u.clone().angleTo(C)),H.setFromRotationMatrix(T),D.multiplyQuaternions(D,I),D.multiplyQuaternions(D,H),r.object.quaternion.copy(D);else if("local"==r.space){u.applyMatrix4(B.getInverse(T)),C.applyMatrix4(B.getInverse(T)),w.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),x.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),H.setFromRotationMatrix(O),I.setFromAxisAngle(E,w.x-x.x),J.setFromAxisAngle(F,w.y-x.y),K.setFromAxisAngle(G,w.z-x.z),"X"==r.axis&&H.multiplyQuaternions(H,I),"Y"==r.axis&&H.multiplyQuaternions(H,J),"Z"==r.axis&&H.multiplyQuaternions(H,K),r.object.quaternion.copy(H);var l=r.object._rotation.clone();l.setEulerFromQuaternion(H),r.object.setRotation(l)}else if("world"==r.space){w.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),x.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),D.setFromRotationMatrix(B.getInverse(P)),I.setFromAxisAngle(E,w.x-x.x),J.setFromAxisAngle(F,w.y-x.y),K.setFromAxisAngle(G,w.z-x.z),H.setFromRotationMatrix(T),"X"==r.axis&&D.multiplyQuaternions(D,I),"Y"==r.axis&&D.multiplyQuaternions(D,J),"Z"==r.axis&&D.multiplyQuaternions(D,K),D.multiplyQuaternions(D,H),r.object.quaternion.copy(D);var l=r.object._rotation.clone();l.setEulerFromQuaternion(D),r.object.setRotation(l)}r.changed=!0}r.update(!0),r.updateTextNote(b,r.object)}}function l(b){var c=r.network.getElementsByMouseEvent(b);return a.getFirstEditElement(c)}function m(b){if(null===W&&(W=new _b),W.set(b.clientX,b.clientY),a.getDataBox().clearEditing(),0===W.distanceTo(X)){var c=r.network.getElementsByMouseEvent(b),d=a.getFirstEditElement(c);d&&(d!==r.object,r.object=d,r.translateable&&r.gizmo.translate.show(),r.rotateable&&r.gizmo.rotate.show(),r.scaleable&&r.gizmo.scale.show()),d||(r.gizmo[t].hide(),r.gizmo.translate.hide(),r.gizmo.rotate.hide(),r.gizmo.scale.hide(),r.object=null)}else r.changed&&r.onElementPropertyChanged&&(r.changed=!1,r.moving=!1,r.onElementPropertyChanged(b,r.object),a.fireInteractionEvent({kind:"liveMoveEnd",event:{e:b,source:r.object,time:(new Date).getTime()}}));r.axis=!1,s=!1,r.update(!0),r.hideTextNote()}function n(a,b){if(!b)return null;var c=r.network.getPickingByEvent(a),d=c.intersectObjects(b,!0,!0);return d[0]?d[0]:!1}$b.BaseInteraction.call(this,a);var o=new $b.Element,p=a.getCamera(),q=a.getRootView();q=q!==e?q:document,this.domElement=q,this.gizmo={},this.gizmo.translate=new $b.TransformGizmoTranslate,this.gizmo.rotate=new $b.TransformGizmoRotate,this.gizmo.scale=new $b.TransformGizmoScale,o.addChild(this.gizmo.translate),o.addChild(this.gizmo.rotate),o.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var r=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var s=!1,t="translate",u=(new $b.Picking,new $b.Projector,new ac,new ac),v=new ac,w=new ac,x=new ac,y=1,z=new cc,A=new ac,B=new cc,C=new ac,D=new $b.Quat,E=new ac(1,0,0),F=new ac(0,1,0),G=new ac(0,0,1),H=new $b.Quat,I=new $b.Quat,J=new $b.Quat,K=new $b.Quat,L=new $b.Quat,M=new ac,N=new ac,O=new cc,P=new cc,Q=new ac,R=new ac,S=new $b.Euler,T=new cc,U=new ac,V=new $b.Euler;this.showNote=!0,this.handleDataBoxChange=function(a){"remove"==a.kind?a.data==r.object&&(r.gizmo.translate.hide(),r.gizmo.rotate.hide(),r.gizmo.scale.hide()):"clear"==a.kind&&(r.gizmo.translate.hide(),r.gizmo.rotate.hide(),r.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(a){if("dataBox"==a.property){var b=a.oldValue,c=a.value;b.removeDataBoxChangeListener(this.handleDataBoxChange),c.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(a){r.pickers.push(a)}),this.gizmo.rotate.pickers.getChildren().forEach(function(a){r.pickers.push(a)}),this.gizmo.scale.pickers.getChildren().forEach(function(a){r.pickers.push(a)}),this.attach=function(a){r.object=a,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[t].show(),r.update()},this.detach=function(a){r.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(a){t=a?a:t,this.update()},this.setUp=function(){q.addEventListener("mousedown",j,!1),q.addEventListener("touchstart",j,!1),q.addEventListener("mousemove",i,!1),q.addEventListener("touchmove",i,!1),q.addEventListener("mousemove",k,!1),q.addEventListener("touchmove",k,!1),q.addEventListener("mouseup",m,!1),q.addEventListener("mouseout",m,!1),q.addEventListener("touchend",m,!1),q.addEventListener("touchcancel",m,!1),q.addEventListener("touchleave",m,!1),q.addEventListener("keydown",b,!1),q.addEventListener("touchstart",c,!1),q.addEventListener("touchmove",f,!1),q.addEventListener("touchend",g,!1),q.addEventListener("mousewheel",h,!1),r.network.helperBox.addByDescendant(o)},this.tearDown=function(){q.removeEventListener("mousedown",j,!1),q.removeEventListener("touchstart",j,!1),q.removeEventListener("mousemove",i,!1),q.removeEventListener("touchmove",i,!1),q.removeEventListener("mousemove",k,!1),q.removeEventListener("touchmove",k,!1),q.removeEventListener("mouseup",m,!1),q.removeEventListener("mouseout",m,!1),q.removeEventListener("touchend",m,!1),q.removeEventListener("touchcancel",m,!1),q.removeEventListener("touchleave",m,!1),q.removeEventListener("keydown",b,!1),q.removeEventListener("touchstart",c,!1),q.removeEventListener("touchmove",f,!1),q.removeEventListener("touchend",g,!1),q.removeEventListener("mousewheel",h,!1),r.gizmo.translate.hide(),r.gizmo.rotate.hide(),r.gizmo.scale.hide(),r.network.helperBox.removeByDescendant(o);
},this.setSnap=function(a){r.snap=a},this.setSize=function(a){r.size=a,this.update()},this.setSpace=function(a){r.space=a,this.update()},this.update=function(a){r.object&&(r.object.updateWorldMatrix(),R.getPositionFromMatrix(r.object.worldMatrix),S.setFromRotationMatrix(B.extractRotation(r.object.worldMatrix)),p.updateWorldMatrix(),U.getPositionFromMatrix(p.worldMatrix),V.setFromRotationMatrix(B.extractRotation(p.worldMatrix)),y=R.distanceTo(U)/12*r.size,o.setPosition(R),o.setScale(y,y,y),A.copy(U).sub(R).normalize(),this.gizmo.scale.update(S,A),"local"==r.space?(this.gizmo.translate.update(S,A),this.gizmo.rotate.update(S,A)):(this.gizmo.translate.update(new $b.Euler,A),this.gizmo.rotate.update(new $b.Euler,A)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[t].highlight(r.axis),o.updateWorldMatrix(!0),a&&r.network.dirtyNetwork())},this.getDefaultPickers=function(){return"TranslateX"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(0):"TranslateY"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(1):"TranslateZ"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(2):"TranslateXY"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(4):"TranslateYZ"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(5):"TranslateXZ"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(6):"TranslateXYZ"===this.defaultMode?r.gizmo.translate.pickers.getChildren().get(3):"RotateX"===this.defaultMode?r.gizmo.rotate.pickers.getChildren().get(0):"RotateY"===this.defaultMode?r.gizmo.rotate.pickers.getChildren().get(1):"RotateZ"===this.defaultMode?r.gizmo.rotate.pickers.getChildren().get(2):"ScaleX"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(0):"ScaleY"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(1):"ScaleZ"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(2):"ScaleXYZ"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(6):"ScaleXY"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(3):"ScaleYZ"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(4):"ScaleXZ"===this.defaultMode?r.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var a=this.defaultMode;return a.startsWith("Translate")?"translate":a.startsWith("Rotate")?"rotate":a.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var a=this.defaultMode;return a.endsWith("XYZ")?"XYZ":a.endsWith("XY")?"XY":a.endsWith("YZ")?"YZ":a.endsWith("XZ")?"XZ":a.endsWith("Y")?"X":a.endsWith("Y")?"Y":a.endsWith("Z")?"Z":""};var W=null,X=new _b;this.filterIntersectPicker=function(a){var b=[];if(!this.showHelpers)return b;for(var c=0;c<a.length;c++){var d=a[c];d.getParent()===this.gizmo.translate.pickers&&this.translateable&&b.push(d),d.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&b.push(d),d.getParent()===this.gizmo.scale.pickers&&this.scaleable&&b.push(d)}return b}},$b.extend($b.EditInteraction,$b.BaseInteraction,{setShowHelpers:function(a){this.showHelpers=a,this.gizmo.translate.showHelpers=a,this.gizmo.rotate.showHelpers=a,this.gizmo.scale.showHelpers=a,this.resetHelpers()},onElementPropertyChanged:function(a,b){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(a){this.showNote=a},setScaleable:function(a){this.scaleable=a,this.gizmo.scale.showable=a,this.resetHelpers()},setRotateable:function(a){this.rotateable=a,this.gizmo.rotate.showable=a,this.resetHelpers()},setTranslateable:function(a){this.translateable=a,this.gizmo.translate.showable=a,this.resetHelpers()},setDefaultMode:function(a){this.defaultMode=a},setScaleRate:function(a){this.scaleRate=a||1},setForceSameScale:function(a){this.forceSameScale=a},setSpaceMode:function(a){"world"==a?this.space="world":this.space="local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var a=document.createElement("table");this.noteTable=a,this.textNote.appendChild(this.noteTable);a.createTHead();a.style.borderLeft="1px solid #ffa500",a.style.borderTop="1px solid #ffa500",a.style.fontSize="14px",a.style.backgroundColor="rgba(255, 170, 13, 0.5)",a.setAttribute("border",0),a.setAttribute("cellspacing",0),a.setAttribute("cellpadding",0);for(var b=0;4>b;b++){for(var c=document.createElement("tr"),d=0;4>d;d++){var e=document.createElement("td");e.style.borderRight="1px solid #ffa500",e.style.borderBottom="1px solid #ffa500",e.style.paddingLeft="5px",e.style.paddingRight="5px",e.style.paddingTop="2px",e.style.paddingBottom="2px",0==b&&d>0||b>0&&0==d?(e.style.textAlign="center",e.style.fontWeight="bold"):e.style.textAlign="right",c.appendChild(e)}a.appendChild(c)}},showTextNote:function(){this.showNote&&(null==this.textNote&&this.createTextNote(),this.textNote.style.display="")},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(a,b){if(null!=b&&this.showNote){var c=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=a.clientY-c.top+20+"px",this.textNote.style.left=a.clientX-c.left+20+"px";for(var d=b.getRotation(),e=b.getPosition(),f=b.getScale(),g=[[" ","x","y","z"],["p",e.x,e.y,e.z],["r",d.x,d.y,d.z],["s",f.x,f.y,f.z]],h=this.noteTable,i=0;4>i;i++)for(var j=0;4>j;j++){var k=g[i][j];i>0&&j>0&&(k=2==i?(180*k/Math.PI).toFixed(0)+"&deg;":k.toFixed(2)),h.rows[i].cells[j].innerHTML=""+k}}}});var id=1e-5,jd=0,kd=1,ld=2,md=3;$b.CSG=function(a){var b,c,d,e,f,g,h,i=[];if(!(a instanceof $b.Element)){if(a instanceof pd)return this.tree=a,this.matrix=new cc,this;throw"TGL.CSG: Given geometry is unsupported"}for(a.computeNodeData&&a.computeNodeData(),a.updateWorldMatrix(!0),this.matrix=a.worldMatrix.clone(),b=0,c=a.faces.length;c>b;b++){if(d=a.faces[b],f=a.uvs[b],g=a.uv2s[b],h=new nd,d instanceof qc)e=a.vertices[d.a],e=new od(e.x,e.y,e.z,d.vertexNormals[0],new _b(f[0].x,f[0].y),g[0].clone()),e.materialIndex=d.materialIndex,e.applyMatrix4(this.matrix),h.vertices.push(e),e=a.vertices[d.b],e=new od(e.x,e.y,e.z,d.vertexNormals[1],new _b(f[1].x,f[1].y),g[1].clone()),e.materialIndex=d.materialIndex,e.applyMatrix4(this.matrix),h.vertices.push(e),e=a.vertices[d.c],e=new od(e.x,e.y,e.z,d.vertexNormals[2],new _b(f[2].x,f[2].y),g[2].clone()),e.applyMatrix4(this.matrix),e.materialIndex=d.materialIndex,h.vertices.push(e);else{if(!(d instanceof rc))throw"Invalid face type at index "+b;e=a.vertices[d.a],e=new od(e.x,e.y,e.z,d.vertexNormals[0],new _b(f[0].x,f[0].y),g[0].clone()),e.materialIndex=d.materialIndex,e.applyMatrix4(this.matrix),h.vertices.push(e),e=a.vertices[d.b],e=new od(e.x,e.y,e.z,d.vertexNormals[1],new _b(f[1].x,f[1].y),g[1].clone()),e.materialIndex=d.materialIndex,e.applyMatrix4(this.matrix),h.vertices.push(e),e=a.vertices[d.c],e=new od(e.x,e.y,e.z,d.vertexNormals[2],new _b(f[2].x,f[2].y),g[2].clone()),e.materialIndex=d.materialIndex,e.applyMatrix4(this.matrix),h.vertices.push(e),e=a.vertices[d.d],e=new od(e.x,e.y,e.z,d.vertexNormals[3],new _b(f[3].x,f[3].y),g[3].clone()),e.applyMatrix4(this.matrix),e.materialIndex=d.materialIndex,h.vertices.push(e)}isNaN(h.calculateProperties().w)?console.log("Not right polygon"):i.push(h)}if(this.tree=new pd(i),this.tree.materialSize=a.getMaterialSize?a.getMaterialSize():0,a.material instanceof $b.ArrayMaterial)this.tree.material=a.material;else{var j=new $b.ArrayMaterial;this.tree.material=j;for(var b=0;b<this.tree.materialSize;b++)j.push(a.material)}},$b.CSG.prototype.substract=function(a){var b=this.tree.clone(),c=a.tree.clone();return b.sumMateriaSize(c),b.invert(),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b.invert(),b=new $b.CSG(b),b.matrix=this.matrix,b},$b.CSG.prototype.union=function(a){var b=this.tree.clone(),c=a.tree.clone();return b.sumMateriaSize(c),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b=new $b.CSG(b),b.matrix=this.matrix,b},$b.CSG.prototype.intersect=function(a){var b=this.tree.clone(),c=a.tree.clone();return b.sumMateriaSize(c),b.invert(),c.clipTo(b),c.invert(),b.clipTo(c),c.clipTo(b),b.build(c.allPolygons()),b.invert(),b=new $b.CSG(b),b.matrix=this.matrix,b},$b.CSG.prototype.inverse=function(){var a=this.tree.clone();return a.polygons.map(function(a){a.flip()}),a=new $b.CSG(a)},$b.CSG.prototype.toGeometry=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=((new cc).getInverse(this.matrix),new $b.Entity(this.tree.material,a)),n=this.tree.allPolygons(),o=n.length,p={};for(b=0;o>b;b++)for(d=n[b],e=d.vertices.length,c=2;e>c;c++){k=[],l=[],i=d.vertices[0],k.push(new _b(i.uv.x,i.uv.y)),l.push(i.uv2.clone());var q=i.materialIndex;i=new ac(i.x,i.y,i.z),"undefined"!=typeof p[i.x+","+i.y+","+i.z]?f=p[i.x+","+i.y+","+i.z]:(m.vertices.push(i),f=p[i.x+","+i.y+","+i.z]=m.vertices.length-1),i=d.vertices[c-1],k.push(new _b(i.uv.x,i.uv.y)),l.push(i.uv2.clone()),i=new ac(i.x,i.y,i.z),"undefined"!=typeof p[i.x+","+i.y+","+i.z]?g=p[i.x+","+i.y+","+i.z]:(m.vertices.push(i),g=p[i.x+","+i.y+","+i.z]=m.vertices.length-1),i=d.vertices[c],k.push(new _b(i.uv.x,i.uv.y)),l.push(i.uv2.clone()),i=new ac(i.x,i.y,i.z),"undefined"!=typeof p[i.x+","+i.y+","+i.z]?h=p[i.x+","+i.y+","+i.z]:(m.vertices.push(i),h=p[i.x+","+i.y+","+i.z]=m.vertices.length-1),j=new qc(f,g,h,new ac(d.normal.x,d.normal.y,d.normal.z)),j.materialIndex=q||0,m.faces.push(j),m.uvs.push(k),m.uv2s.push(l)}return m},$b.CSG.prototype.toMesh=function(a){var b=this.toGeometry(a);return b.computeBoundingBox(),b};var nd=function(a,b,c){a instanceof Array||(a=[]),this.vertices=a,a.length>0?this.calculateProperties():this.normal=this.w=e};nd.prototype.calculateProperties=function(){var a=this.vertices[0],b=this.vertices[1],c=this.vertices[2],d=b.clone().subtract(a),e=c.clone().subtract(a);return this.normal=d.cross(e).normalize(),this.w=this.normal.clone().dot(a),this},nd.prototype.clone=function(){var a,b,c=new nd;for(a=0,b=this.vertices.length;b>a;a++)c.vertices.push(this.vertices[a].clone());return c.calculateProperties(),c},nd.prototype.flip=function(){var a,b=[];for(this.normal.multiplyScalar(-1),this.w*=-1,a=this.vertices.length-1;a>=0;a--)b.push(this.vertices[a]);return this.vertices=b,this},nd.prototype.classifyVertex=function(a){var b=this.normal.dot(a)-this.w;return-id>b?ld:b>id?kd:jd},nd.prototype.classifySide=function(a){var b,c,d,e=0,f=0,g=a.vertices.length;for(b=0;g>b;b++)c=a.vertices[b],d=this.classifyVertex(c),d===kd?e++:d===ld&&f++;return e>0&&0===f?kd:0===e&&f>0?ld:0===e&&0===f?jd:md},nd.prototype.splitPolygon=function(a,b,c,d,e){var f=this.classifySide(a);if(f===jd)(this.normal.dot(a.normal)>0?b:c).push(a);else if(f===kd)d.push(a);else if(f===ld)e.push(a);else{var g,h,i,j,k,l,m,n,o,p=[],q=[];for(h=0,g=a.vertices.length;g>h;h++)i=(h+1)%g,l=a.vertices[h],m=a.vertices[i],j=this.classifyVertex(l),k=this.classifyVertex(m),j!=ld&&p.push(l),j!=kd&&q.push(l),(j|k)===md&&(n=(this.w-this.normal.dot(l))/this.normal.dot(m.clone().subtract(l)),o=l.interpolate(m,n),p.push(o),q.push(o));p.length>=3&&d.push(new nd(p).calculateProperties()),q.length>=3&&e.push(new nd(q).calculateProperties())}},$b.CSG.Polygon=nd;var od=function(a,b,c,d,e,f){this.x=a,this.y=b,this.z=c,this.normal=d||new ac,this.uv=e||new _b,this.uv2=f||new _b};od.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},od.prototype.clone=function(){var a=new od(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return a.materialIndex=this.materialIndex,a},od.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},od.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},od.prototype.multiplyScalar=function(a){return this.x*=a,this.y*=a,this.z*=a,this},od.prototype.cross=function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},od.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=a,this.y/=a,this.z/=a,this},od.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},od.prototype.lerp=function(a,b){return this.add(a.clone().subtract(this).multiplyScalar(b)),this.normal.add(a.normal.clone().sub(this.normal).multiplyScalar(b)),this.uv.add(a.uv.clone().sub(this.uv).multiplyScalar(b)),this.uv2.add(a.uv2.clone().sub(this.uv2).multiplyScalar(b)),this},od.prototype.interpolate=function(a,b){return this.clone().lerp(a,b)},od.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},$b.CSG.Vertex=od;var pd=function(a){var b,c,d=[],f=[];if(this.polygons=[],this.front=this.back=e,a instanceof Array&&0!==a.length){for(this.divider=a[0].clone(),b=0,c=a.length;c>b;b++)this.divider.splitPolygon(a[b],this.polygons,this.polygons,d,f);d.length>0&&(this.front=new pd(d)),f.length>0&&(this.back=new pd(f))}};pd.isConvex=function(a){var b,c;for(b=0;b<a.length;b++)for(c=0;c<a.length;c++)if(b!==c&&a[b].classifySide(a[c])!==ld)return!1;return!0},pd.prototype.build=function(a){var b,c,d=[],e=[];for(this.divider||(this.divider=a[0].clone()),b=0,c=a.length;c>b;b++)this.divider.splitPolygon(a[b],this.polygons,this.polygons,d,e);d.length>0&&(this.front||(this.front=new pd),this.front.build(d)),e.length>0&&(this.back||(this.back=new pd),this.back.build(e))},pd.prototype.allPolygons=function(){var a=this.polygons.slice();return this.front&&(a=a.concat(this.front.allPolygons())),this.back&&(a=a.concat(this.back.allPolygons())),a},pd.prototype.clone=function(){var a=new pd;if(this.divider&&(a.divider=this.divider.clone()),a.polygons=this.polygons.map(function(a){return a.clone()}),a.front=this.front&&this.front.clone(),a.back=this.back&&this.back.clone(),a.materialSize=this.materialSize,a.material=new $b.ArrayMaterial,this.material)for(var b=0;b<this.material.materials.length;b++)a.material.materials.push(this.material.materials[b]);return a},pd.prototype.invert=function(){var a,b,c;for(a=0,b=this.polygons.length;b>a;a++)this.polygons[a].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),c=this.front,this.front=this.back,this.back=c,this},pd.prototype.clipPolygons=function(a){var b,c,d,e;if(!this.divider)return a.slice();for(d=[],e=[],b=0,c=a.length;c>b;b++)this.divider.splitPolygon(a[b],d,e,d,e);return this.front&&(d=this.front.clipPolygons(d)),e=this.back?this.back.clipPolygons(e):[],d.concat(e)},pd.prototype.clipTo=function(a){this.polygons=a.clipPolygons(this.polygons),this.front&&this.front.clipTo(a),this.back&&this.back.clipTo(a)},pd.prototype.sumMateriaSize=function(a){a.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+a.materialSize;for(var b=0;b<a.material.materials.length;b++)this.material.materials.push(a.material.materials[b])},pd.prototype.changeMaterialIndex=function(a){for(var b=0;b<this.polygons.length;b++)for(var c=this.polygons[b],d=0;d<c.vertices.length;d++){var e=c.vertices[d];e.materialIndex=e.materialIndex+a}this.front&&this.front.changeMaterialIndex(a),this.back&&this.back.changeMaterialIndex(a)},$b.CSG.Node=pd,$b.XmlSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new $b.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},$b.extend($b.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+$b.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},getPropertyType:function(a,b){var c=this.settings.getPropertyType(b);return c||a.__SizePropeties&&-1!=a.__SizePropeties.indexOf(b)&&(c="number"),c},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()];this.xmlString+="<data class='"+a.getClassName()+"' ref='"+c+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+a.getId()+"'"),this.xmlString+=">\n",a.serializeXml(this,b),this.xmlString+="</data>\n"}a.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(a,b,c){var d=this.getPropertyType(a,b);if(d){var e=$b.getValue(a,b,d),f=$b.getValue(c,b,d);e!==f&&this.serializeValue("p",b,e,f,d)}},serializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(b);if(d){var e=a.getStyle(b),f=c.getStyle(b);e!=f&&this.serializeValue("s",b,e,f,d)}},serializeClientXml:function(a,b,c){var d=this.settings.getClientType(b);if(null!=d){var e=a.getClient(b),f=c.getClient(b);e!=f&&this.serializeValue("c",b,e,f,d)}},serializeValue:function(a,b,c,d,e){if("s"===a&&(c=this.flattenArray(c),c instanceof Array&&"string"!==e&&"color"!==e&&"number"!==e&&(e="list."+e,c=new mc(c))),null==c)this.xmlString+="	<"+a+" n='"+b+"' none=''/>\n";else if("cdata"===e)this.xmlString+="	<"+a+" n='"+b+"'><![CDATA["+c+"]]></"+a+">\n";else if("data"===e){var f=this.refMap[c.getId()];null!=f&&(this.xmlString+="	<"+a+" n='"+b+"' ref='"+f+"'/>\n")}else"vec2"===e?d&&c.x===d.x&&c.y===d.y||(this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"'/>\n"):"vec3"===e?d&&c.x===d.x&&c.y===d.y&&c.z==d.z||(this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"' z='"+c.z+"'/>\n"):"list.vec2"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c instanceof Array&&(c=new mc(c)),c.forEach(function(b){if(b instanceof Array){this.xmlString+="	<"+a+">\n";for(var c=0;c<b.length;c++){var d=b[c];this.xmlString+="		<p x='"+d.x+"' y='"+d.y+"'/>\n"}this.xmlString+="	</"+a+">\n"}else this.xmlString+="		<p x='"+b.x+"' y='"+b.y+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):"list.vec3"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c instanceof Array&&(c=new mc(c)),c.forEach(function(b){if(b instanceof Array){this.xmlString+="	<"+a+">\n";for(var c=0;c<b.length;c++){var d=b[c];this.xmlString+="	<"+a+"' x='"+d.x+"' y='"+d.y+"' z='"+d.z+"'/>\n"}this.xmlString+="	</"+a+">\n"}else this.xmlString+="		<"+a+"' x='"+b.x+"' y='"+b.y+"' z='"+b.z+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):"list.string"===e||"list.number"===e||"list.color"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<s>"+a+"</s>\n"},this),this.xmlString+="	</"+a+">\n"):this.xmlString+="	<"+a+" n='"+b+"'>"+c+"</"+a+">\n"},flattenArray:function(a){if(a instanceof Array){for(var b=0;b<a.length-1;b++)if(a[b]!=a[b+1]){if(!a[b]||!a[b].equals)return a;if(!a[b].equals(a[b+1]))return a}return a[0]}return a},deserialize:function(a,b){$b.isDeserializing=!0,this.xmlString=a;var c=$b.xml(a).documentElement;this.refMap={},this.idMap={};var d,e,f,g=new mc,h=new mc,i=c.getElementsByTagName("data"),j=i.length;for(f=0;j>f;f++){e=i[f];var k=e.getAttribute("class"),l=this.settings.getPropertyType("id");if(l&&e.hasAttribute("id")){var m=null;if("string"===l)m=e.getAttribute("id");else if("int"===l)m=parseInt(e.getAttribute("id"));else{if("number"!==l)throw"Unsupported id type '"+l+"'";m=parseFloat(e.getAttribute("id"))}if("remove"===e.getAttribute("action")){this.dataBox.removeById(m);continue}d=this.dataBox.getDataById(m),d||(d=$b.newInstance(k,m))}else d=$b.newInstance(k);if(e.hasAttribute("ref")){var n=e.getAttribute("ref");this.refMap[n]=d}g.add(d),h.add(e),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),j=g.size(),f=0;j>f;f++)d=g.get(f),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));for(f=0;j>f;f++)d=g.get(f),e=h.get(f),d.deserializeXml(this,e);this.settings.isDataBoxSerializable&&1===c.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,c.getElementsByTagName("dataBox")[0]),$b.isDeserializing=!1},deserializePropertyXml:function(a,b,c){var d=this.getPropertyType(a,c);d&&$b.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientXml:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializePoint:function(a){var b=a.getAttribute("x")?parseFloat(a.getAttribute("x")):null,c=a.getAttribute("a")?parseFloat(a.getAttribute("a")):null;if(null!=b){var d=a.getAttribute("y")?parseFloat(a.getAttribute("y")):null,e=a.getAttribute("z")?parseFloat(a.getAttribute("z")):null,f=a.getAttribute("w")?parseFloat(a.getAttribute("w")):null;return null!=f?new $b.Vec4(b,d,e,f):null!=e?new $b.Vec3(b,d,e):new $b.Vec2(b,d)}if(null!=c){var g=a.getAttribute("b")?parseFloat(a.getAttribute("b")):null,h=a.getAttribute("c")?parseFloat(a.getAttribute("c")):null,i=a.getAttribute("d")?parseFloat(a.getAttribute("d")):null;return null!=i?new $b.Face4(c,g,h,i):new $b.Face3(c,g,h)}return null},arrayStyleValue:function(a,b){var c=[];if(a.indexOf(",")){if(c=a.split(","),"string"===b)return c;if("number"===b){for(var d=[],e=0;e<c.length;e++)d.push(parseFloat(c[e]));return d}if("color"===b){for(var f=[],e=0;e<c.length;e++)f.push(new $b.Color(c[e]));return f}}},deserializeValue:function(a,b,c){if(a.hasAttribute("@none"))return null;var d="s"===a.nodeName,e=d&&-1!==a.textContent.indexOf(",");if("string"===b)return e?this.arrayStyleValue(a.textContent,b):a.textContent;if("color"===b)return e?this.arrayStyleValue(a.textContent,b):a.textContent;if("number"===b)return e?this.arrayStyleValue(a.textContent,b):parseFloat(a.textContent);if("boolean"===b)return"true"===a.textContent;if("int"===b)return parseInt(a.textContent);if("point"===b)return this.deserializePoint(a);if("vec2"===b){var f=parseFloat(a.getAttribute("x")),g=parseFloat(a.getAttribute("y"));if(!isNaN(f)&&!isNaN(g)||!d)return new $b.Vec2(f,g);b="list.point"}if("vec3"===b){var f=parseFloat(a.getAttribute("x")),g=parseFloat(a.getAttribute("y")),h=parseFloat(a.getAttribute("z"));return new $b.Vec3(f,g,h)}if("data"===b){var i=a.getAttribute("ref"),j=this.refMap[i];return j?j:this.idMap[i]}var k,l,m,n;if("list.point"===b){var o=new mc,p=a.getElementsByTagName("p");for(k=p.length,n=0;k>n;n++){var q=p[n];o.add(this.deserializePoint(q))}return d?o._as:o}if("list.string"===b){var r=new mc;for(m=a.getElementsByTagName("s"),k=m.length,n=0;k>n;n++)r.add(m[n].textContent);return r}if("list.number"===b){for(l=new mc,m=a.getElementsByTagName("s"),k=m.length,n=0;k>n;n++)l.add(parseFloat(m[n].textContent));return l}if("array.string"===b)return a.textContent.split(",");if("array.number"===b){for(l=a.textContent.split(","),k=l.length,n=0;k>n;n++)l[n]=parseFloat(l[n]);return l}return"rectangle"===b?{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y")),width:parseFloat(a.getAttribute("w")),height:parseFloat(a.getAttribute("h"))}:a.textContent}}),$b.addMethod($b.Data,{serializeXml:function(a,b){if(this.__SizePropeties&&this.__SizePropeties.length){var c,d;for(c=0,d=this.__SizePropeties.length;d>c;c++)this.serializePropertyXml(a,this.__SizePropeties[c],b)}else this.serializePropertyXml(a,"materialSize",b),this.vertices&&this.vertices.length&&this.serializePropertyXml(a,"vertices",b),this.faces&&this.faces.length&&this.serializePropertyXml(a,"faces",b),this.uvs&&this.uvs.length&&this.serializePropertyXml(a,"uvs",b);if(a.settings.isClientSerializable&&this._clientMap)for(var e in this._clientMap)this.serializeClientXml(a,e,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"parent",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),$b.addMethod($b.Element,{serializeXml:function(a,b){if(a.settings.isStyleSerializable&&this.styleMap)for(var c in this.styleMap)this.isSideStyle(c)||this.serializeStyleXml(a,c,b);this.serializePropertyXml(a,"position",b),this.serializePropertyXml(a,"rotation",b),this.serializePropertyXml(a,"scale",b),$b.Element.superClass.serializeXml.call(this,a,b),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")&&(a.xmlString+="	<p n='alarmState'>\n",$b.AlarmSeverity.forEach(function(b){var c=this.getNewAlarmCount(b);c>0&&(a.xmlString+="		<n n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),$b.AlarmSeverity.forEach(function(b){var c=this.getAcknowledgedAlarmCount(b);c>0&&(a.xmlString+="		<a n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),a.xmlString+="	</p>\n")},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeXml:function(a,b){if($b.Element.superClass.deserializeXml.call(this,a,b),a.settings.isStyleSerializable){var c,d,e=b.getElementsByTagName("s"),f=e.length;for(c=0;f>c;c++)d=e[c],d.hasAttribute("n")&&this.deserializeStyleXml(a,d,d.getAttribute("n"))}},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializePropertyXml:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d,e,f,g=b.getElementsByTagName("n");for(e=0;e<g.length;e++)f=g[e],d=mono.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setNewAlarmCount(d,parseInt(f.getAttribute("c")));for(g=b.getElementsByTagName("a"),e=0;e<g.length;e++)f=g[e],d=mono.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(d,parseInt(f.getAttribute("c")))}}else $b.Element.superClass.deserializePropertyXml.call(this,a,b,c)}}),$b.addMethod($b.DataBox,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),$b.JsonSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new $b.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},$b.extend($b.JsonSerializer,Object,{constructor:$b.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:$b.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var a={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=a,this.dataBox.serializeJson(this,this.dataBox.newInstance(),a),uc.isEmptyObject(a.p)&&delete a.p,uc.isEmptyObject(a.s)&&delete a.s,uc.isEmptyObject(a.c)&&delete a.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){if(this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this),a instanceof $b.ComboNode)for(var b=0;b<a.combos.length;b++){var c=a.combos[b];this.refMap[c.getId()]||(this.refMap[c.getId()]=this.ref++)}},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()],d={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=a.getId()),this.jsonObject.datas.push(d),a.serializeJson(this,b,d),uc.isEmptyObject(d.p)&&delete d.p,uc.isEmptyObject(d.s)&&delete d.s,uc.isEmptyObject(d.c)&&delete d.c}a.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(a){var b=a.newInstance(),c=this.refMap[a.getId()],d={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};return a.serializeJson(this,b,d),uc.isEmptyObject(d.p)&&delete d.p,uc.isEmptyObject(d.s)&&delete d.s,uc.isEmptyObject(d.c)&&delete d.c,d},getPropertyType:function(a,b){var c=this.settings.getPropertyType(b);return c||(a.__bool&&-1!=a.__bool.indexOf(b)?c="boolean":a.__SizePropeties&&-1!=a.__SizePropeties.indexOf(b)&&(c="number")),c},getStyleType:function(a,b){a.isSideStyle(b)&&(b=b.substr(b.indexOf(".")+1));var c=this.settings.getStyleType(b);return c},serializePropertyJson:function(a,b,c,d){var e=this.getPropertyType(a,b);if(e){var f=$b.getValue(a,b,e),g=$b.getValue(c,b,e);f!==g&&(f&&f.equals?!f.equals(g)&&this.serializeValue(b,f,g,e,d.p):this.serializeValue(b,f,g,e,d.p))}},serializeStyleJson:function(a,b,c,d){var e=this.getStyleType(a,b);if(e){var f=a.getStyle(b),g=c.getStyle(b);b.startsWith("m.")&&(f=this.flattenArray(f),g=this.flattenArray(g)),b.endsWith(".image")&&(f=this.encodeURI(f),g=this.encodeURI(g)),f!=g&&(f&&f.equals?!f.equals(g)&&this.serializeValue(b,f,g,e,d.s):this.serializeValue(b,f,g,e,d.s))}},serializeClientJson:function(a,b,c,d){var e=this.settings.getClientType(b);if(null!=e){var f=a.getClient(b),g=c.getClient(b);f!=g&&(f&&f.equals?!f.equals(g)&&this.serializeValue(b,f,g,e,d.c):this.serializeValue(b,f,g,e,d.c))}},serializeValue:function(a,b,c,d,e){if(null==b)e[a]=null;else if(b instanceof mc)e[a]=b._as;else if("data"===d){var f=this.refMap[b.getId()];null!=f&&(e[a]=f)}else if("data.list"===d){for(var g=[],h=0;h<b.length;h++)g.push(this.serializeDataValue(b[h]));e[a]=g}else if("serializeabe.list"===d){for(var g=[],h=0;h<b.length;h++)g.push(b[h].serializeJsonValue());e[a]=g}else b.serializeJsonValue?e[a]=b.serializeJsonValue():e[a]=b},deserialize:function(a,b){$b.isDeserializing=!0,this.jsonObject=JSON.parse(a),this.refMap={},this.idMap={};var c,d=new mc,e=new mc,f=this.jsonObject.datas.length;null!=this.deserializeStartCreateData&&this.deserializeStartCreateData(f);for(var g=0;f>g;g++){var h=this.jsonObject.datas[g],i=h["class"],j=this.settings.getPropertyType("id");if(j&&null!=h.id){if("remove"===h.action){this.dataBox.removeById(h.id);continue}c=this.dataBox.getDataById(h.id),c||(c=$b.newInstance(i,h.id))}else{c=$b.newInstance(i)}null!=h.ref&&(this.refMap[h.ref]=c),d.add(c),e.add(h),this.idMap[c.getId()]=c,this.deserializeCreateData&&this.deserializeCreateData(g,f)}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),f=d.size(),this.deserializeStartFillData&&this.deserializeStartFillData(f),g=0;f>g;g++)c=d.get(g),c.deserializeJson(this,e.get(g)),this.deserializeFillData&&this.deserializeFillData(g,f);for(this.deserializeStartAddData&&this.deserializeStartAddData(f),g=0;f>g;g++)c=d.get(g),this.dataBox.containsById(c.getId())||(b&&!c.getParent()&&c.setParent(b),
"TGL.Entity"===c.getClassName()&&(c.computed=!1,c.computeNodeData()),this.dataBox.add(c),this.deserializeAddData&&this.deserializeAddData(g,f));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),$b.isDeserializing=!1},deserializePropertyJson:function(a,b,c){var d=this.getPropertyType(a,c);d&&$b.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleJson:function(a,b,c){var d=this.getStyleType(a,c);if(d){var e=this.deserializeValue(b,d);e._as&&(e=e._as),a.setStyle(c,e)}},deserializeClientJson:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},getClassName:function(a){return null!=a?a["class"]?a["class"]:a.w!==e&&a.x!==e&&a.y!==e&&a.z!==e?"TGL.Vec4":a.x!==e&&a.y!==e&&a.z!==e?"TGL.Vec3":a.x!==e&&a.y!==e?"TGL.Vec2":a.a!==e&&a.b!==e&&a.c!==e&&a.d!==e?"TGL.Face4":a.a!==e&&a.b!==e&&a.c!==e?"TGL.Face3":void 0:void 0},translateJson:function(a){if(null!=a){if(null!=this.getClassName(a)){var b=$b.newInstance(this.getClassName(a));if(b.deserializeJsonValue)b.deserializeJsonValue(a);else for(var c in a)b[c]=a[c];return b}if(a instanceof Array)for(var d=0;d<a.length;d++)a[d]=this.translateJson(a[d]);return a}},isChinese:function(a){return a=a||"",escape(a).indexOf("%u")>0},encodeURI:function(a){if(a instanceof Array){for(var b=0;b<a.length;b++)a[b]=this.encodeURI(a[b]);return a}return"string"==typeof a&&this.isChinese(a)?encodeURI(a):a},flattenArray:function(a){if(a instanceof Array){for(var b=0;b<a.length-1;b++)if(a[b]!=a[b+1]){if(!a[b]||!a[b].equals)return a;if(!a[b].equals(a[b+1]))return a}return a[0]}return a},deserializeValue:function(a,b){if("data"===b){var c=this.refMap[a];return c?c:this.idMap[a]}if("data.list"===b){for(var d,f,g=[],h=0;h<a.length;h++)d=a[h],f=$b.newInstance(d["class"]),null!=d.ref&&(this.refMap[d.ref]=f),f.deserializeJson(this,d),g.push(f);return g}if("color"===b&&a.r!=e){var i=new $b.Color;return i.setRGB(a.r,a.g,a.b),i}if("TGL.Path"===a["class"]){var j=new $b.Path;return j.deserializeJsonValue(a),j}if(a instanceof Array){for(var h=0;h<a.length;h++)a[h]=this.translateJson(a[h]);return a}return null!=this.getClassName(a)?this.translateJson(a):a}}),$b.addMethod($b.DataBox,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),$b.addMethod($b.Data,{serializeJson:function(a,b,c){if(!this.__SizePropeties||!this.__SizePropeties.length||this instanceof $b.Entity)this.materialSize&&this.serializePropertyJson(a,"materialSize",b,c),this instanceof $b.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(a,"vertices",b,c),this.faces&&this.faces.length&&this.serializePropertyJson(a,"faces",b,c),this.uvs&&this.uvs.length&&this.serializePropertyJson(a,"uvs",b,c),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(a,"uv2s",b,c));else{var d,e;for(d=0,e=this.__SizePropeties.length;e>d;d++)this.serializePropertyJson(a,this.__SizePropeties[d],b,c)}if(a.settings.isClientSerializable&&this._clientMap)for(var f in this._clientMap)this.serializeClientJson(a,f,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"parent",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),$b.addMethod($b.Element,{serializeJson:function(a,b,c){if(a.settings.isStyleSerializable&&this.styleMap)for(var d in this.styleMap)this.isSideStyle(d)||this.serializeStyleJson(a,d,b,c);if($b.Element.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"position",b,c),this.serializePropertyJson(a,"rotation",b,c),this.serializePropertyJson(a,"scale",b,c),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")){var e={n:{},a:{}};c.p.alarmState=e,$b.AlarmSeverity.forEach(function(a){var b=this.getNewAlarmCount(a);b>0&&(e.n[a.name]=b)},this._alarmState),$b.AlarmSeverity.forEach(function(a){var b=this.getAcknowledgedAlarmCount(a);b>0&&(e.a[a.name]=b)},this._alarmState),uc.isEmptyObject(e.n)&&delete e.n,uc.isEmptyObject(e.a)&&delete e.a,uc.isEmptyObject(e)&&delete c.p.alarmState}},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeJson:function(a,b){if($b.Element.superClass.deserializeJson.call(this,a,b),a.settings.isStyleSerializable)for(var c in b.s)this.deserializeStyleJson(a,b.s[c],c)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializePropertyJson:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d;for(d in b.n)this._alarmState.setNewAlarmCount(mono.AlarmSeverity.getByName(d),b.n[d]);for(d in b.a)this._alarmState.setAcknowledgedAlarmCount(mono.AlarmSeverity.getByName(d),b.a[d])}}else $b.Element.superClass.deserializePropertyJson.call(this,a,b,c)}}),$b.addMethod($b.Light,{serializeJson:function(a,b,c){if($b.Light.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"color",b,c),this.serializePropertyJson(a,"ambient",b,c),this.serializePropertyJson(a,"diffuse",b,c),this.serializePropertyJson(a,"specular",b,c),this.serializePropertyJson(a,"castShadow",b,c),this.serializePropertyJson(a,"onlyShadow",b,c),b.__accessor&&b.__accessor.length)for(var d=0;d<b.__accessor.length;d++)this.serializePropertyJson(a,b.__accessor[d],b,c)}});var qd=$b.Animate=function(a){var b=this;b.type=null==a.type?"number":a.type,b.delay=null==a.delay?0:a.delay,b.dur=null==a.dur?1e3:a.dur,b.interval=null==a.interval?0:a.interval,b.finish=null==a.finish?b.delay+b.dur+b.interval:a.finish,b.repeat=null==a.repeat?1:a.repeat,b.reverse=null==a.reverse?!0:a.reverse,b.easing=null==a.easing?"easeNone":a.easing,b.onUpdate=a.onUpdate,b.onDone=a.onDone,b.onStop=a.onStop,b.onPlay=a.onPlay,b.attr=a.attr,b.source=a.source,b.filter=a.filter,b.from=a.from,b.to=a.to,b.start=null,b.time=0,b.total=0,b.count=0,b.started=!1,b.stopped=!1,b.id=sd++};$b.extend($b.Animate,Object,{play:function(){return Sb(this)},stop:function(a){return Vb(this,a)},clone:function(){return new qd(this)},chain:function(a){var b,c=this;return c.onDone?(b=c.onDone,c.onDone=function(){b.call(c),a.play()}):c.onDone=function(){a.play()},c}});var rd={},sd=1,td=!1;if(function Ad(a){requestAnimationFrame(Ad),td&&(td=!1,Xb(a))}(0),!d.make){var ud=d.make={},vd={},wd={},xd=[],yd={};ud.Default={path:"./",resPath:"",getImagePath:function(a){return this.path+this.resPath+"res/images/"+(a||"")},register:function(a,b,c){c=c||{},c.name=c.name||a,c.modelDefaultParameters=c.modelDefaultParameters||{},c.description=c.description||c.name,vd[a]&&console.log(a," already exist"),vd[a]=b;var d=c.category||"",e=wd[d]||{};e[a]=b,wd[d]=e,yd[a]=c,-1==xd.indexOf(d)&&xd.push(d),this.checkModelDefaultParameters(c.modelDefaultParameters)},checkModelDefaultParameters:function(a){if(a)for(var b in a){var c=a[b];c instanceof Object||(c={value:c},a[b]=c),c.propertyName=b,c.hidden=!!c.hidden,c.propertyType=c.propertyType||ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,c.type=c.type||ud.Default.PARAMETER_TYPE_STRING,c.category=c.category||ud.Default.PARAMETER_CATEGORY_DETAIL,c.editable=c.editable===e?!0:!!c.editable,c.index=c.index===e?100:parseInt(c.index)}},remove:function(a){if(vd[a]){vd[a]=e,delete vd[a];var b=ud.Default.getCategory(a),c=wd[b];delete c[a];var d=0;for(var f in c)f&&d++;if(0==d)for(var f=0;f<xd.length;f++){var g=xd.indexOf(b);g>=0&&xd.splice(g,1)}delete yd[a]}else console.log(a," not exist")},getCategories:function(){return xd},getCreatorsForCategory:function(a){return wd[a]},getCreator:function(a){return vd[a]},getIds:function(a){var b=[];for(var c in vd)(!a||a&&a(this.getParameters(c)))&&b.push(c);return b},getModelDefaultParameters:function(a){var b=this.getParameters(a);return b.modelDefaultParameters},getDescription:function(a){var b=this.getParameters(a);return b.description},getName:function(a){var b=this.getParameters(a);return b.name},getIcon:function(a){var b=this.getParameters(a);return this.path+b.icon},isAsync:function(a){var b=this.getParameters(a);return b.async},isCombo:function(a){var b=this.getParameters(a);return b.combo},getCategory:function(a){var b=this.getParameters(a);return b.category},getOrder:function(a){var b=this.getParameters(a);return b.order||0},getType:function(a){var b=this.getParameters(a);return b.type},getOtherParameter:function(a,b){var c=this.getParameters(a);return c[b]},registerIcon:function(a,b){var c=this.getParameters(a);if(c)return c.icon=b,c.icon},registerDescription:function(a,b){var c=this.getParameters(a);return c.description=b,c.description},registerName:function(a,b){var c=this.getParameters(a);return c.name=b,c.name},registerOther:function(a,b,c){var d=e[b],e=this.getParameters(a);return e[b]=c,"modelDefaultParameters"===b&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",a,d,c),this.checkModelDefaultParameters(c)),d},appendModelDefaultParameter:function(a,b,c,d,e,f,g){},getParameters:function(a){return yd[a]||{}},load:function(a,b,c){var d,c=c||{},e=c.isRelation;if(b){var f=b;b=function(b){e&&a instanceof Array&&a.length>1&&b instanceof Array&&b.length>1&&this._relation(a,b),f(b)}}if(a instanceof Array){var g={};if(b){var h=function(c,d){var e=a.length;return function(a){c.datas=c.datas||[],c.datas.push(a),c._total===e&&b(c.datas)}(d)};g._total=0;for(var i=0;i<a.length;i++){var j=a[i];this.load(j,function(a){g._total++,h(g,a)})}return null}d=[];for(var i=0;i<a.length;i++){var j=a[i],k=this.load(j);k&&d.push(k)}}else{var l={};"string"==typeof a?l.id=a:l=a,l=this.filterJson(l),b?this._load(l,b):d=this._load(l)}return e&&d instanceof Array&&d.length>1&&this._relation(a,d),d},_relation:function(a,b){var c={};b.forEach(function(a){a.getId&&(c[a.getId()]=a)}),a.forEach(function(a){a.objectId&&a.parentId&&c[a.objectId]&&c[a.parentId]&&c[a.objectId].setParent&&c[a.objectId].setParent(c[a.parentId])})},_load:function(a,b){var c=a.id,d=this.getCreator(c);if(!d)return console.log("unknown id: ",c),null;if(!b){var e=d(a);return ud.Default._setObjectClientId(e,c),e}d(a,function(a){ud.Default._setObjectClientId(a,c),b&&b(a)})},_setObjectClientId:function(a,b){a&&a.setClient&&a.setClient("id",b)},copyArray:function(a,b,c){if(b=[],a)for(var d,e=0,f=a.length;f>e;e++)d={},this.copyProperties(a[e],d),b.push(d);return b},copyProperties:function(a,b,c){if(a&&b)for(var d in a)c&&c.indexOf(d)>=0||0==d.indexOf("_")||(b[d]===e&&(a[d]instanceof Array?b[d]=[]:a[d]instanceof Function?b[d]=a[d]:a[d]instanceof Object?b[d]={}:b[d]=a[d]),!(a[d]instanceof Function)&&a[d]instanceof Object&&b[d]instanceof Object&&ud.Default.copyProperties(a[d],b[d]))},getModelDefaultParametersValues:function(a,b){var c=this.getModelDefaultParameters(a),d={};for(var e in c){var f=c[e];b&&b(f)||(f.propertyType==ud.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(d.client=d.client||{},d.client[e]=f.value):f.propertyType==ud.Default.PARAMETER_PROPERTY_TYPE_STYLE?(d.style=d.style||{},d.style[e]=f.value):d[e]=f.value)}return d},getModelDefaultParameterProperties:function(a,b){var c=this,d=[],e=this.getModelDefaultParameters(a);if(!e)return d;b&&!e.id&&(e.id={propertyName:"id",name:"ID",category:ud.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:ud.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),b&&!e.objectId&&(e.objectId={propertyName:"objectId",name:"ID",category:ud.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:ud.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var f in e)d.push(e[f]);return d.sort(function(a,b){return a.index-b.index}),d=d.map(function(a){return c.modelParameterToProperty(a)})},_getNameFromPropertyName:function(a){for(var b=a.split("."),c="",d=0;d<b.length;d++)b[d].length>0&&(c+=b[d].substring(0,1).toUpperCase()+b[d].substring(1,b[d].length)),d<b.length-1&&(c+=" ");return c},modelParameterToProperty:function(a){var b=new twaver.Property;return b.setCategoryName(a.category),a.name||(a.name=this._getNameFromPropertyName(a.propertyName)),b.setName(a.name),b.setEditable(a.editable),b.setPropertyType(a.propertyType),b.setPropertyName(a.propertyName),b.setValueType(a.type),b.setEnumInfo(a.enumInfo),b.isVisible=function(){return!a.hidden},b},filterJson:function(a){var b=this.getModelDefaultParameters(a.id);for(var c in b){var d=b[c].propertyType||"client",f=b[c].value;d==ud.Default.PARAMETER_PROPERTY_TYPE_STYLE?a.style&&a.style[c]!==e||(a.style=a.style||{},a.style[c]=f):d==ud.Default.PARAMETER_PROPERTY_TYPE_CLIENT?a.client&&a.client[c]!==e||(a.client=a.client||{},a.client[c]=f):a[c]===e&&(a[c]=f)}return a},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(a){return parseInt(a)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*a},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(a){return parseInt(a)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(a)+this.RACK_OFFSET_Y}},ud.Default.toJson=function(a,b){if(a&&a.getClient){var c=a.getClient("id"),d=ud.Default.getModelDefaultParameters(c),e={},f=null,g=null;for(var h in d)if(d[h].exportable!==!1){var i=d[h].propertyType,g=d[h].value;i==ud.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(f=a[_twaver.getter(h)](),ud.Default.equals(f,g)||(e[h]=f)):i==ud.Default.PARAMETER_PROPERTY_TYPE_FIELD?(f=a[h],ud.Default.equals(f,g)||(e[h]=f)):i==ud.Default.PARAMETER_PROPERTY_TYPE_STYLE?(f=a.getStyle(h),ud.Default.equals(f,g)||(e.style=e.style||{},e.style[h]=f)):i==ud.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(f=a.getClient(h),ud.Default.equals(f,g)||(e.client=e.client||{},e.client[h]=f))}return e.id=c,ud.Default.EXPORT_OBJECT_ID&&(e.objectId=a.getId()),b&&(e=b(e)),e}return b&&(a=b(a)),a},ud.Default.copy=function(a,b,c,d,f){var g=function(a,b,c,d,f){f=f||{};var g={},h={},i=ud.Default.getParameters(b);if(i=ud.Default.clone(i),ud.Default.copyProperties(i,h),d instanceof Function?g=d(h)||{}:ud.Default.copyProperties(d,g),f.copyDefaultParamCoverage&&delete h.modelDefaultParameters,f.copyParamCoverage||ud.Default.copyProperties(h,g),f.defaultValue&&g.modelDefaultParameters)for(var j in f.defaultValue)g.modelDefaultParameters[j]!==e&&(g.modelDefaultParameters[j]instanceof Object?g.modelDefaultParameters[j].value=f.defaultValue[j]:g.modelDefaultParameters[j]=f.defaultValue[j]);ud.Default.register(a,function(a,d){var e={id:b};c instanceof Function?c(a):ud.Default.copyProperties(c,e),ud.Default.copyProperties(a,e);var f=ud.Default.load(e,d);return f},g)};g(a,b,c,d,f)},ud.Default.PARAMETER_CATEGORY_BASIC="BASIC",ud.Default.PARAMETER_CATEGORY_DETAIL="Detail",ud.Default.PARAMETER_TYPE_STRING="string",ud.Default.PARAMETER_TYPE_BOOLEAN="boolean",ud.Default.PARAMETER_TYPE_COLOR="color",ud.Default.PARAMETER_TYPE_INT="int",ud.Default.PARAMETER_TYPE_NUMBER="number",ud.Default.PARAMETER_TYPE_IMAGE="image",ud.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",ud.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",ud.Default.PARAMETER_TYPE_ARRAY_INT="array.int",ud.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",ud.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",ud.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",ud.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(a,b,c){return RegExp.prototype.isPrototypeOf(a)?this.replace(a,b):this.replace(new RegExp(a,c?"gi":"g"),b)},String.prototype.format=function(a){var b=this;if(arguments.length>1){for(var c=[],d=0;d<arguments.length;d++)c.push(arguments[d]);a=c}if(a){if(a instanceof Array)a.forEach(function(a,c){a instanceof Object&&(a=JSON.stringify(a)),b=b.replaceAll("{"+c+"}",a)});else{if(!(a instanceof Object))return b.replaceAll("{}",a);for(var e in a){var f=a[e];f instanceof Object&&(f=JSON.stringify(f)),b=b.replaceAll("{"+e+"}",f)}}}return b},ud.Default.getId=function(a){return a.getClient("id")},ud.Default.objectWrapper=function(a,b,c,d){Object.defineProperty(a,b,{get:function(){var d=a["___"+b];return c&&(d=c.call(a,d,a,b)),d},set:function(c){var e=a[b];d&&(c=d.call(a,c,a,b)),e!==c&&(a["___"+b]=c,this.firePropertyChange&&this.firePropertyChange(b,e,c))}})},ud.Default.equals=function(a,b){return a instanceof Object&&b instanceof Object?JSON.stringify(a)==JSON.stringify(b):a==b},ud.Default.clone=function(a){try{return JSON.parse(JSON.stringify(a))}catch(b){throw console.error(b,a),b}},ud.Default.EXPORT_OBJECT_ID=!0}var ud=d.make;mono.Element.prototype.direction2=function(a){var b=a.applyMatrix4((new mono.Mat4).extractRotation(this.matrix));return b.normalize(),b},ud.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap:"envmap.jpg",envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg",envmap6:"envmap6.jpg"},getEnvMap:function(a){var b=ud.Default.getImagePath()+ud.Default._envMaps[a];return[b,b,b,b,b,b]},getOBjPath:function(a){return a?a.indexOf("http")>=0?a:this.path+a:this.path+"obj/"},createFloorForWall:function(a){var b={type:"twaver.floor",data:a.getClient("data")},c=this.getCreator(b.type);if(c){var d=this.loadData(b);d.setParent(a)}},createCombo:function(a,b){var c=[],d=[],e=[],f=[];a&&!(a instanceof Array)&&(a=[a]);for(var g=0;g<a.length;g++){var h=a[g],i=h.op||"+",j=h.style,k=h.client,l=h.position||[0,0,0],m=h.rotation||[0,0,0],n=h.scale||[1,1,1],o=null;if("cube"===h.type&&(o=this.createCube(h)),"cylinder"===h.type&&(o=this.createCylinder(h)),"sphere"===h.type&&(o=this.createSphere(h)),"polygon"===h.type&&(o=this.createPolygon(h)),"torus"===h.type&&(o=this.createTorus(h)),"path"===h.type&&(o=this.createPathCube(h)),"pathNode"===h.type&&(o=this.createPathNode(h)),"shapeNode"===h.type&&(o=this.createShapeNode(h)),o){if(m&&!h.rotationAnchor&&o.setRotation(m[0],m[1],m[2]),h.rotationAnchor){var p=o.getPosition();l=[l[0]+p.x,l[1]+p.y,l[2]+p.z]}o.setPosition(l[0],l[1],l[2]),o.setScale(n[0],n[1],n[2]),j&&o.s(j),k&&o.c(k),h.op?(o.getChildren().size()>0&&(c=c.concat(o.getChildren().toArray())),c.push(o),o.getChildren().size()>0?o.getChildren().forEach(function(){e.push(i)}):c.length>1&&e.push(i),f.push(o.getId())):d.push(o)}}if(c.length>0){var q;return q=b?new mono.ComboNode(c,e,!1,b):new mono.ComboNode(c,e),q.setNames(f),q}return 1==d.length?d[0]:d},setMainObject:function(a){function b(a,b){if(a){var c=a.getBoundingBox(),d=b.getBoundingBox(),e=c.min,f=c.max,g=d.min,h=d.max;(f.x-e.x<h.x-g.x||f.z-e.z<h.z-g.z)&&(a=b)}else a=b;return a}var c=null;if(a instanceof Array){for(var d=0;d<a.length;d++){var e=a[d];e instanceof mono.Entity&&(c=b(c,e))}for(var d=0;d<a.length;d++){var e=a[d];e instanceof mono.Entity&&c!=e&&a[d].setParent(c)}}else c=a;return c&&c.setClient("main",!0),c},createCube:function(a){var b,c=a.width,d=a.height,e=a.depth,f=a.color,g=(a.position||[0,0,0],a.rotation||[0,0,0]),h=a.rotationAnchor,i=a.topColor||f,j=a.repeatX||1,k=a.repeatY||1,l=a.image,m=a.frontImage,n=a.wrapMode;if(b=a.objectId?new mono.Cube({id:a.objectId,width:c,height:d,depth:e}):new mono.Cube(c,d,e),f&&b.s({"m.color":f,"m.ambient":f}),i&&b.s({"top.m.color":i,"top.m.ambient":i,"bottom.m.color":i,"bottom.m.ambient":i}),l&&b.s({"m.texture.image":l,"m.texture.repeat":new mono.Vec2(j,k),"m.texture.anisotropy":15}),m&&b.setStyle("front.m.texture.image",m),n&&b.setWrapMode(n),h){var o,p;"left"===h&&(o=new mono.Vec3(c/2,0,0),p=new mono.Vec3(0,1,0)),"right"===h&&(o=new mono.Vec3(-c/2,0,0),p=new mono.Vec3(0,1,0)),b.rotateFromAxis(p.clone(),o.clone(),g[1])}else b.setRotation(g[0]/180*Math.PI,g[1]/180*Math.PI,g[2]/180*Math.PI);return ud.Default.setObject3dCSProps(b,a),b},createCylinder:function(a){var b=a.radius,c=a.topRadius||b,d=a.bottomRadius||b,e=a.height,f=a.color,g=a.image,h=new mono.Cylinder(c,d,e);return h.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":f,"m.ambient":f,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),g&&h.setStyle("m.texture.image",g),h},createSphere:function(a){var b=a.radius,c=a.color||"#F5F5F5",d=a.image,e=new mono.Sphere(b);return e.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":c,"m.ambient":c,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),d&&e.setStyle("m.texture.image",d),e},createPolygon:function(a){var b=a.radius||100,c=a.topRadius||b,d=a.bottomRadius||b,e=a.height||200,f=a.radialSegments||3,g=a.color||"#F5F5F5",h=a.topColor||g,i=a.smooth||!0,j=a.image,k=new mono.Cylinder(c,d,e,f,i);return k.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":g,"m.ambient":g,"top.m.color":h,"top.m.ambient":h,"bottom.m.color":h,"bottom.m.ambient":h,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),j&&k.setStyle("m.texture.image",j),k},createTorus:function(a){var b=a.radius||50,c=a.tube||30,d=a.tubularSegments||3,e=a.radialSegments||6,f=a.color||"#F5F5F5",g=a.image,h=new mono.Torus(b,c,d,e);return h.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":f,"m.ambient":f,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),g&&h.setStyle("m.texture.image",g),h},createBillboard:function(a){var b=a.position||[0,0,0],c=a.scale||[1,1,1],d=a.image||this.getImagePath("outside_lightmap.jpg"),e=new mono.Billboard;return e.s({"m.texture.image":d,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.depthTest":!1}),e.setScale(c[0],c[1],c[2]),e.p(b[0],b[1],b[2]),e},createPathNodePath:function(a){var b;if(a[0]&&a[0]instanceof Array)for(var c=0;c<a.length;c++){var d=a[c];b?"c"===d[0]?b.quadraticCurveTo(d[1],d[2],d[3],d[4],d[5],d[6]):b.lineTo(d[0],0,d[1]):(b=new mono.Path,b.moveTo(d[0],0,d[1]))}else for(var c=0;c<a.length;c+=2)b?b.lineTo(a[c],0,a[c+1]):(b=new mono.Path,b.moveTo(a[c],0,a[c+1]));return b},createPathNode:function(a){var b,c=a.radius,d=a.pathImage,e=a.repeat||50,f=a.offset||new mono.Vec2(0,0),g=a.startCap||"plain",h=a.endCap||"plain",i=a.pathWidth,j=a.pathHeight,k=i/2,l=j/2,m=[{x:k,y:-l},{x:k,y:l},{x:-k,y:l},{x:-k,y:-l}],n=this.createPathNodePath(a.data),o=n.getLength();return i&&j?b=new mono.PathNode({path:n,shape:m,segments:10,segmentsR:5}):(n=mono.PathNode.prototype.adjustPath(n,c,2),b=new mono.PathNode({path:n,radius:c})),b.s({"m.texture.image":d,"m.texture.repeat":new mono.Vec2(o/e,1),"m.texture.offset":f}),g&&b.setStartCap(g),h&&b.setEndCap(h),ud.Default.setObject3dCSProps(b,a),b},createShapeNodePath:function(a){var b;if(a[0]&&a[0]instanceof Array)for(var c=0;c<a.length;c++){var d=a[c];b?"c"===d[0]?b.quadraticCurveTo(d[1],-d[2],0,d[3],-d[4],0):b.lineTo(d[0],-d[1],0):(b=new mono.Path,b.moveTo(d[0],-d[1],0))}else for(var c=0;c<a.length;c+=2)b?b.lineTo(a[c],-a[c+1],0):(b=new mono.Path,b.moveTo(a[c],-a[c+1],0));return b},createShapeNode:function(a){var b=a.repeat||100,c=a.amount||2,d=!0;(null!==a.vertical||a.vertical!=e)&&(d=a.vertical);var f,g=this.createShapeNodePath(a.data);return f=a.id?new mono.ShapeNode({id:a.id,path:g}):new mono.ShapeNode(g),a.curveSegments&&f.setCurveSegments(a.curveSegments),f.setAmount(c),f.setVertical(d),f.setRepeat(b),f},createPathCube:function(a){var b=a.width,c=a.height,d=a.data,e=a.insideColor,f=a.outsideColor,g=a.asideColor,h=a.zsideColor,i=a.topColor,j=a.bottomColor,k=a.insideImage||a.image,l=a.outsideImage||a.image,m=a.insideMap,n=a.outsideMap,o=a.repeat||a.height,p=a.closed,q=this.createShapeNodePath(d);p&&q.closePath();var r=new mono.PathCube(q,b,c);return r.s({"outside.m.color":f,"inside.m.type":"basic","inside.m.color":e,"aside.m.color":g||f,"zside.m.color":h||f,"top.m.color":i,"top.m.ambient":i,"bottom.m.color":j||i,"inside.m.lightmap.image":m,"outside.m.lightmap.image":n,"aside.m.lightmap.image":n,"zside.m.lightmap.image":n,"inside.m.texture.image":k,"outside.m.texture.image":l}),r.setRepeat(o),r},getPicInfo:function(a,b){var c={};"string"==typeof b&&(b=[b]);for(var d=0;d<b.length;d++){var e=b[d],f=e.substring(0,e.indexOf(".")).toLowerCase();e=a+e,c[f]=e}return c},getRByD:function(a){return a*Math.PI/180},getDByR:function(a){return 180*a/Math.PI},getRsByDs:function(a){var b;if(a&&a.length>0){b=[];for(var c=0;c<a.length;c++)b.push(ud.Default.getRByD(a[c]))}return b},setObject3dCSProps:function(a,b){b.client&&a.c(b.client),b.style&&a.s(b.style)},setObject3dCommonProps:function(a,b){var c=ud.Default.getRsByDs(b.rotation)||[0,0,0],d=b.scale||[1,1,1],e=b.position||[0,0,0];a.setRotation(c[0],c[1],c[2]),a.setScale(d[0],d[1],d[2]),a.setPosition(e[0],0,e[2]),ud.Default.setPositionY(a,e[1]),ud.Default.setObject3dCSProps(a,b)},cloneObjElement:function(a,b){var c=ud.Default.getRsByDs(a.rotation)||[0,0,0],d=a.scale||[1,1,1],e=a.position||[0,0,0];e[1]=parseFloat(e[1])||0;var f=this._objObject[a.name],g=f.getBoundingBoxWithChildren(),h=(g.max.y-g.min.y)/2,i=a.singleton?f:f.clonePrefab();if(a._id&&(i._id=a._id),a.client)for(var j in a.client)i.setClient(j,a.client[j]);return a.style&&i.s(a.style),i.setClient("type",a.name),i.setClient("showShadow",a.showShadow),a.showShadow&&(null!=a.shadowType?(i.setClient("shadowType",a.shadowType),i.setClient("shadowWeight",1)):a.showShadowImage&&i.setClient("shadowImage",a.shadowImage)),"function"==typeof a.interepter&&a.interepter.call(this,i),i.setClient("json",a),i.setScale(d[0],d[1],d[2]),i.setPosition(e[0],e[1]+h*d[1],e[2]),i.setRotation(c[0],c[1],c[2]),b&&b(i),i},setDefaultEnvMap:function(a){var b=this.getEnvMap("envmap5");a.setStyle("m.envmap.image",b);var c=a.getDescendants();return c.forEach(function(a){a.setStyle("m.envmap.image",b)}),a},setShadowImage:function(a,b){a.setClient("shadowImage",b),twaver.Util.registerImageByUrl(b,b)},createObj:function(a,b){var c=this;if(this._objObject[a.name]){var d=this.getOBjPath(a.path),e=a.shadowImage=d+a.name+"S.png";return this.cloneObjElement(a,b)}if(this._objMap[a.name]){if(a.showShadow){var d=this.getOBjPath(a.path),e=a.shadowImage=d+a.name+"S.png";null==a.shadowType&&twaver.Util.registerImageByUrl(e,e)}}else{this._objMap[a.name]=[];var d=this.getOBjPath(a.path),f=d+a.name+".obj",g=d+a.name+".mtl";a.scale||[1,1,1];if(a.showShadow){var e=a.shadowImage=d+a.name+"S.png";null==a.shadowType&&twaver.Util.registerImageByUrl(e,e)}var h=new mono.OBJMTLLoader;h.load(f,g,null,function(b){if(a.merged)b=mono.Utils.mergeElements(b.getDescendants());else if(a.envImages){var d=ud.Default.getEnvMap("envmap5");b.getDescendants().forEach(function(b){var c=b.getStyle("m.texture.image");if(c){var e=a.envImages;e.forEach(function(a){(c.indexOf(a)>=0||c instanceof Array&&c[0].indexOf(a)>=0)&&b.setStyle("m.envmap.image",d)})}})}c._objObject[a.name]=b,c._objMap[a.name].forEach(function(a){return c.cloneObjElement(a.json,a.callback)})})}this._objMap[a.name].push({json:a,callback:b})},getTextSize:function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d"),e=a.split("\n"),f=0;d.font=b;for(var g=0;g<e.length;g++){var h=e[g],i=d.measureText(h).width;i>f&&(f=i)}var j=d.measureText("e").width*e.length*3+4,k={w:f,h:j};return k},generateTextCanvas:function(a,b,c,d,e,f){var g=document.createElement("canvas"),c=c||"bold 80px ,sans-serif",h=g.getContext("2d"),i=a.split("\n"),j=ud.Default.getTextSize(a,c),k=j.w,l=j.h,m={width:k,height:l};g.height=mono.Utils.nextPowerOfTwo(j.h),g.width=mono.Utils.nextPowerOfTwo(j.w),d&&(h.save(),h.globalAlpha=1,h.fillStyle=e||"#FE642E",h.beginPath(),h.moveTo(0,0),h.lineTo(k,0),h.lineTo(k,l),h.lineTo(0,l),h.closePath(),h.fill()),h.restore(),h.fillStyle=b||"white",h.textBaseline="middle",h.textAlign="center",h.font=c,f||(h.shadowColor="#585858",h.shadowBlur=25,h.shadowOffsetX=10,h.shadowOffsetY=10);for(var n=h.measureText("o").width,o=2.5*n,p=0;p<i.length;p++){var q=k/2,r=o*p+o/2+(g.height-m.height);h.fillText(i[p],q,r)}return g.drawRect=m,g},generateShadowNode:function(a,b,c){var d=null,e=a.getDescendants();if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=e[f];if(g instanceof mono.Entity&&g.getClient("type")&&"floor"==g.getClient("type")){d=g;break}}if(d){var h=d.getBoundingBox(),i=(h.max.z-h.min.z,h.max.x-h.min.x,a.getRotation());a.setRotation(0,0,0);var j=ud.Default.createShadowImage(a,d,b,c);return d.setStyle("top.m.lightmap.image",j),d.invalidateTexture(),ud.Default.newcanvas=ud.Default.newcanvas||j,a.setRotation(i),d}},_getWorldRotation:function(a){var b=(new mono.Mat4).extractRotation(a.worldMatrix),c=new mono.Vec3;return c.setEulerFromRotationMatrix(b),c},createShadowImage:function(a,b,c,d){var e=d&&d.shadowColor||"#000",f=(d&&d.shadowWeight||2,b.getBoundingBox()),g=f.max.z-f.min.z,h=f.max.x-f.min.x,i=Math.max(h,g),j=i>4096?Math.ceil(i/4096):1,k=ud.Default.canvas||document.createElement("canvas"),l=h/j,m=g/j,n=h/l,o=g/m;k.width=l,k.height=m;var p=k.getContext("2d");p.clearRect(0,0,l,m),p.fillStyle="white",p.fillRect(0,0,l,m),p.beginPath();for(var q,r=a.getPosition(),s=a?a.getBoundingBox():null,t=-(s.max.x+s.min.x)/2-r.x,u=-(s.max.z+s.min.z)/2-r.z,v=a.getDescendants(),w=0;w<v.length;w++){var x=v[w];if(x.getClient&&"wallCombos"==x.getClient("id")){q=x;break}}if(q){var y=q.getClient("combos");y.forEach(function(a){if(a.getClient&&!a.getClient("resetPos")){var b=a.getPosition();a.p(b.x+parseFloat(r.x),b.y+parseFloat(r.y),b.z+parseFloat(r.z)),a.setClient("resetPos",!0)}v.push(a)})}for(var z,w=0;w<v.length;w++){var x=v[w];if(x.getClient&&"columnCombos"==x.getClient("id")){z=x;break}}if(z){var y=z.getClient("combos");y.forEach(function(a){if(a.getClient&&!a.getClient("resetPos")){var b=a.getPosition();a.p(b.x+parseFloat(r.x),b.y+parseFloat(r.y),b.z+parseFloat(r.z)),a.setClient("resetPos",!0)}v.push(a)})}v.push(a);for(var A=0;A<v.length;A++){var B=v[A],C=B.getWorldPosition(),D=l/2+C.x/n,E=m/2+C.z/o,F=ud.Default._getWorldRotation(B),G=B.getClient("type"),H=B.getClient("showShadow");if(0!=H&&(H=!0),H&&("wall"==G||"inner_wall"==G||"glass_wall"==G)){var I=B.getClient("data"),J=B.getClient("doorData"),K=.9*B.getClient("wallDepth");if(p.save(),p.translate(D,E),p.beginPath(),I[0]&&I[0]instanceof Array){for(var L=0;L<I.length;L++)0==L?p.moveTo(I[L][0]/n+t/n,I[L][1]/o+u/o):p.lineTo(I[L][0]/n+t/n,I[L][1]/o+u/o);"wall"==G&&p.lineTo(I[0][0]/n+t/n,I[0][1]/o+u/o)}else{for(var L=0;L<I.length;L+=2)0==L?p.moveTo(I[L]/n+t/n,I[L+1]/o+u/o):p.lineTo(I[L]/n+t/n,I[L+1]/o+u/o);"wall"==G&&p.lineTo(I[0]/n+t/n,I[1]/o+u/o)}p.lineWidth=K/n,p.strokeStyle="#ccc",p.shadowColor=e;var M=Math.min(parseInt(h/15),300);p.shadowBlur=parseInt(M/n),("inner_wall"==G||"glass_wall"==G)&&(p.lineWidth=K/n,p.shadowBlur=parseInt(M/n)),p.shadowOffsetX=0,p.shadowOffsetY=0;for(var N=0;3>N;N++)p.shadowBlur=i>=4e3?180+80*N:100+50*N,p.stroke(),0==N&&(p.shadowColor="#666",p.shadowBlur=i>=4e3?300:200,p.stroke(),p.shadowColor="#000",p.shadowBlur=10,p.stroke());if(J){p.save(),p.shadowBlur=100,p.shadowColor="#ffffff";for(var w=0;w<J.length;w+=2){var O=(J[w][0]+t)/j,P=(J[w][1]+u)/j,Q=(J[w+1][0]+t)/j,R=(J[w+1][1]+u)/j,S=50/j,T=200/j,U=p.createLinearGradient(O-S,P-T,O-S,P+T);O==Q&&(U=p.createLinearGradient(O-T,P-S,O+T,P-S)),O==Q?(P+=8/j,R-=8/j):P==R&&(O+=8/j,Q-=8/j),U.addColorStop(0,"rgba(255,255,255,0)"),U.addColorStop(.5,"rgba(255,255,255,1)"),
U.addColorStop(1,"rgba(255,255,255,0)"),p.fillStyle=U,p.beginPath(),O==Q?(p.moveTo(O-T,P-S),p.lineTo(O,P),p.lineTo(O+T,P-S),p.lineTo(O+T,R+S),p.lineTo(Q,R),p.lineTo(O-T,R+S)):P==R&&(p.moveTo(O-S,P-T),p.lineTo(Q+S,P-T),p.lineTo(Q,R),p.lineTo(Q+S,R+T),p.lineTo(O-S,R+T),p.lineTo(O,P)),p.closePath(),p.fill()}p.restore()}p.restore()}var H=B.getClient("showShadow");c&&(H=H&&c(B));var V=B.getClient("shadowImage"),W=B.getClient("shadowType")||0,X=B.getClient("shadowRatio")||.99,Y=B.getClient("shadowWeight")||2;if(H){var Z=B.getBoundingBox(),$=Z.size(),_=$.x/n*X,K=depth=$.z/o*X;if(F.y%(Math.PI/2)==0&&(_=$.x/o*X,K=depth=$.z/n*X),F.y%Math.PI==0&&(_=$.x/n*X,K=depth=$.z/o*X),1==W){var aa=Math.min($.x,$.z);_=aa/n*X,K=depth=aa/o*X,F.y%(Math.PI/2)==0&&(_=aa/o*X,K=depth=aa/n*X),F.y%Math.PI==0&&(_=aa/n*X,K=depth=aa/o*X)}if(V){F=B.getRotation();var ba=twaver.Util.getImageAsset(V);if(!ba)continue;p.save(),p.translate(D+t/n,E+u/o),p.rotate(-F.y);var ca,da,ea,fa,ga=.3*Math.max(_,depth);F.y%(Math.PI/2)==0&&(ca=-_/2-ga/2,da=-depth/2-ga/2,ea=_+ga,fa=depth+ga),F.y%Math.PI==0&&(ca=-_/2-ga/2,da=-depth/2-ga/2,ea=_+ga,fa=depth+ga),p.drawImage(ba.getImage(),ca,da,ea,fa),p.restore()}else if(0==W){p.save(),p.translate(D+t/n,E+u/o),p.rotate(-F.y),p.beginPath(),p.moveTo(-_/2,0),p.lineTo(_/2,0),p.lineWidth=K,p.strokeStyle="gray",p.shadowColor="#333";var ha=Math.min(_,depth);p.shadowBlur=2*ha,p.shadowOffsetX=0,p.shadowOffsetY=0,1==Y?(p.shadowBlur=3*ha,p.stroke()):2==Y&&(p.stroke(),p.stroke()),p.restore()}else if(1==W){var D=D+t/n,E=E+u/o,ia=B.getClient("shadowRadius");ia?ia/=o:ia=Math.sqrt(_*_+depth*depth)/2,p.save(),p.beginPath(),p.arc(D,E,ia,0,2*Math.PI,!1),p.fillStyle="gray",p.shadowColor=e,p.shadowBlur=2*ia,p.shadowOffsetX=0,p.shadowOffsetY=0,1==Y?(p.shadowBlur=3*ia,p.fill()):2==Y&&(p.fill(),p.fill()),p.restore()}}}ud.Default.canvas=ud.Default.canvas||k;var i=Math.max(2048,Math.max(h/j,g/j)),ja=i/2048,ka=ud.Default.newcanvas||document.createElement("canvas"),l=mono.Utils.nextPowerOfTwo(h/ja),m=mono.Utils.nextPowerOfTwo(g/ja);ka.width=l,ka.height=m,ka.style.width=l,ka.style.height=m;var la=ka.getContext("2d");return la.clearRect(0,0,l,m),la.fillStyle="white",la.fillRect(0,0,l,m),la.drawImage(k,0,0,h/j,g/j,0,0,l,m),ka},getRelativePosition:function(a,b){var c,d;c=(new mono.Mat4).getInverse(a.worldMatrix.clone()),d=(new mono.Mat4).multiplyMatrices(c,b.worldMatrix.clone());var e=main.position=(new mono.Vec3).getPositionFromMatrix(d);return e},getPathBoundingBox:function(a){var b={},c={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(0==a.length)return c;var d,e,f,g;if(a[0]instanceof Array){d=a[0][0],e=a[0][0],f=-a[0][1],g=-a[0][1];for(var h=1;h<a.length;h++)d=Math.min(d,a[h][0]),e=Math.max(e,a[h][0]),f=Math.min(f,-a[h][1]),g=Math.max(g,-a[h][1])}else{if(a.length<2)return c;d=a[0],e=a[0],f=-a[1],g=-a[1];for(var h=2;h<a.length;h+=2)d=Math.min(d,a[h]),e=Math.max(e,a[h]),f=Math.min(f,-a[h+1]),g=Math.max(g,-a[h+1])}return b.centerPoint={x:(d+e)/2,y:(f+g)/2},b.min={x:d,y:f},b.max={x:e,y:g},b.size={x:e-d,y:g-f},b},setPositionY:function(a,b){if("number"==typeof b)a.setPositionY(b);else if(b==ud.Default.positionFloor){var c=a.getBoundingBox().size();a.setPositionY(c.y/2)}},playAnimation:function(a,b,c){var d=b.split(":");if("move"===d[0]){var e=d[1],f=d[2],g=parseInt(d[3])||1e3,h=parseInt(d[4]||0),i=d[5];this.animateMove(a,e,f,g,h,i,c)}if("rotation"===d[0]){var j=d[1],k=d[2],g=parseInt(d[3])||1e3,h=parseInt(d[4]),i=d[5];this.animateRotate(a,j,k,g,h,i,c)}},animateMove:function(a,b,c,d,e,f,g){f=f||"easeInStrong";var h=a.getBoundingBox().size().multiply(a.getScale()),c=c||.8,i=new mono.Vec3(0,0,1),j=0;"right"===b&&(i=new mono.Vec3(1,0,0),j=h.x),"left"===b&&(i=new mono.Vec3(-1,0,0),j=h.x),"top"===b&&(i=new mono.Vec3(0,1,0),j=h.y),"bottom"===b&&(i=new mono.Vec3(0,-1,0),j=h.y),"front"===b&&(i=new mono.Vec3(0,0,1),j=h.z),"back"===b&&(i=new mono.Vec3(0,0,-1),j=h.z),j*=c,a.getClient("animated")&&(i=i.negate()),i=a.direction2(i);var k=a.getPosition().clone();a.setClient("animated",!a.getClient("animated")),new twaver.Animate({from:0,to:1,dur:d,easing:f,delay:e,onUpdate:function(b){a.setPosition(k.clone().add(i.clone().multiplyScalar(j*b)))},onDone:function(){g&&g()}}).play()},animateRotate:function(a,b,c,d,f,g,h){g=g||"easeInStrong";var i=a.getBoundingBox().size().multiply(a.getScale()),j=0,k=1;a.getClient("animated")&&(k=-1),a.setClient("animated",!a.getClient("animated"));var l,m;if("left"===b){l=new mono.Vec3(-i.x/2,0,0);var m=new mono.Vec3(0,1,0)}if("right"===b){l=new mono.Vec3(i.x/2,0,0);var m=new mono.Vec3(0,1,0)}if("center-z"===b){l=new mono.Vec3(0,0,0);var m=new mono.Vec3(0,0,1)}var n=new twaver.Animate({from:j,to:k,dur:d,delay:f,easing:g,onUpdate:function(b){this.lastValue===e&&(this.lastValue=0),a.rotateFromAxis(m.clone(),l.clone(),Math.PI/180*-c*(b-this.lastValue)),this.lastValue=b},onDone:function(){delete this.lastValue,h&&h()}});n.play()},animateCameraPosition:function(a,b,c,d){var e=a.getPosition(),f=new twaver.Animate({from:0,to:1,dur:c,easing:"easeBoth",onUpdate:function(c){var d=e.x+(b.x-e.x)*c,f=e.y+(b.y-e.y)*c,g=e.z+(b.z-e.z)*c,h=new mono.Vec3(d,f,g);a.setPosition(h)}});return f.onDone=d,f},playCameraAnimation:function(a,b,c,d){var e=a.getTarget(),f=a.getPosition().sub(a.getTarget()),g=new twaver.Animate({from:0,to:1,dur:500,easing:"easeBoth",onUpdate:function(d){var g=e.x+(c.x-e.x)*d,h=e.y+(c.y-e.y)*d,i=e.z+(c.z-e.z)*d,j=new mono.Vec3(g,h,i);a.lookAt(j),b.target=j;var k=(new mono.Vec3).addVectors(f,j);a.setPosition(k)}});g.onDone=d,g.play()}};for(var Xc in ud.Utils3D)ud.Default[Xc]=ud.Utils3D[Xc];ud.Default.register("twaver.cube",function(a,b){a.image&&a.image.indexOf("http")<0&&(a.image=ud.Default.path+a.image);var c=ud.Default.createCube(a);return 0==a.visible&&c.setStyle("m.visible",!1),ud.Default.setObject3dCommonProps(c,a),b&&b(c),c},{category:"",type:"mono.Element",name:"",icon:"model/idc/icons/cube.png",description:"make",modelDefaultParameters:{width:{name:"",value:100,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"",value:100,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"",value:100,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"",value:"white",type:ud.Default.PARAMETER_TYPE_COLOR,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"",value:e,type:ud.Default.PARAMETER_TYPE_IMAGE,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ud.Default.register("twaver.cylinder",function(a,b){var c=ud.Default.createCylinder(a),d=a.position||[0,0,0];return c.p(d[0],0,d[2]),ud.Default.setPositionY(c,d[1]),b&&b(c),c},{category:"",type:"mono.Element",name:"",icon:"model/idc/icons/cylinder.png",description:"make",modelDefaultParameters:{topRadius:{name:"",value:60,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"",value:60,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"",value:100,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"",value:"white",type:ud.Default.PARAMETER_TYPE_COLOR,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"",value:e,type:ud.Default.PARAMETER_TYPE_IMAGE,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ud.Default.register("twaver.sphere",function(a,b){var c=ud.Default.createSphere(a),d=a.position||[0,0,0];return c.p(d[0],0,d[2]),c.setClient("showShadow",!0),c.setClient("shadowType",1),c.setClient("shadowRatio",.3),ud.Default.setPositionY(c,d[1]),b&&b(c),c},{category:"",type:"mono.Element",name:"",icon:"model/idc/icons/sphere.png",description:"make",modelDefaultParameters:{radius:{name:"",value:80,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"",value:"#F5F5F5",type:ud.Default.PARAMETER_TYPE_COLOR,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"",value:e,type:ud.Default.PARAMETER_TYPE_IMAGE,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ud.Default.register("twaver.polygon",function(a,b){var c=ud.Default.createPolygon(a),d=a.position||[0,0,0];return c.p(d[0],0,d[2]),ud.Default.setPositionY(c,d[1]),b&&b(c),c},{category:"",type:"mono.Element",name:"",icon:"model/idc/icons/polygon.png",description:"make",modelDefaultParameters:{color:{name:"",value:"white",type:ud.Default.PARAMETER_TYPE_COLOR,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"",value:e,type:ud.Default.PARAMETER_TYPE_IMAGE,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"",value:100,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"",value:100,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"",value:200,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"",value:3,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ud.Default.register("twaver.torus",function(a,b){var c=ud.Default.createTorus(a),d=a.position||[0,0,0];return c.p(d[0],0,d[2]),ud.Default.setPositionY(c,d[1]),b&&b(c),c},{category:"",type:"mono.Element",name:"",icon:"model/idc/icons/torus.png",description:"make",modelDefaultParameters:{color:{name:"",value:"white",type:ud.Default.PARAMETER_TYPE_COLOR,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"",value:e,type:ud.Default.PARAMETER_TYPE_IMAGE,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"",value:50,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"",value:30,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"",value:3,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"",value:6,type:ud.Default.PARAMETER_TYPE_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"",type:ud.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ud.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var zd=0;ud.Default.register("twaver.combo",function(a,b){var c="pack_"+zd++,d=a.data;if(d&&mono.Utils.isArray(d)){for(var e=null,f=null,g=[],h=[],i=0;i<d.length;i++){if(f=ud.Default.load(d[i]),e){var j=f.getClient("type");"inner_wall"==j||"glass_wall"==j?(g.push(f),f.getChildren().size()>0&&f.getChildren().forEachReverse(function(a){a.setParent(e)})):"column"==j?h.push(f):f.setParent(e)}else e=f;f.setClient?f.setClient("pack",c):(f.client=f.client||{},f.client.pack=c)}if(g&&g.length>0){var k=new mono.ComboNode(g);k.setClient("id","wallCombos"),k.setClient("combos",k.getCombos()),k.setParent(e)}if(h&&h.length>0){var k=new mono.ComboNode(h);k.setClient("id","columnCombos"),k.setClient("combos",k.getCombos()),k.setParent(e)}return b&&b(e),e}},{icon:"model/idc/icons/combo.png",category:"",type:"mono.Element",name:"",description:""}),ud.Default.registerObj=function(a,b,c,d,e,f,g,h,i,j,k){d=d||{},d.async=!0;var l=function(a,h){return a.name=b,a.path=c,a.showShadow=e,e&&(a.showShadowImage=!0),a.shadowType=f,a.merged=g,a.envImages=j,a.singleton=k,i&&(a.style=i),null==a.merged&&(a.merged=!0),a.interepter=d.interepter,ud.Default.createObj(a,h)};ud.Default.register(a,l,d)},ud.Default.register("twaver.loader",function(a,b){return ud.Default.load(a.data,b)}),ud.Utils3D.getRectOfPoints=function(a){if(!a||a.length/2<2)return null;var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=0,g=a.length,h=[],i=function(a,f){d=Math.min(d,a),e=Math.max(e,a),b=Math.min(b,f),c=Math.max(c,f),h.push({x:a,y:f})};if(g>0&&a[f]instanceof Array)for(;g>f;f++){var j=a[f];2==j.length?i(j[0],j[1]):5==j.length&&"c"==j[0]&&i(j[3],j[4])}else for(;g>f;f+=2)i(a[f],a[f+1]);return{min:{x:d,y:b},max:{x:e,y:c},center:function(){return{x:(d+e)/2,y:(b+c)/2}},width:e-d,height:c-b,points:h}}}(window),function(a,b){var c={};a.doodle=c;var d={};d.edit={},d.edit.interaction={},d.edit.ui={},d.edit.data={},c._version="1.5.4",c.getVersion=function(){return c._version},c._debug=!1,c.isDebug=function(){return c._debug},c.id=function(a){return c.isDebug()?c.debugId(a):(a=a||"",a+_twaver.id())},c.idIndex=1e4,c.ID_PREFIX="doodle",c.debugId=function(a){return(a?a:c.ID_PREFIX)+"-"+c.idIndex++};var e=function(){};e.prototype.isNotNull=function(a){return a!==b&&"undefined"!==a&&null!==a&&"null"!==a&&""!==a},e.prototype.loadFile=function(a,c){if(a){var d=new XMLHttpRequest;c!==b&&d.addEventListener("load",function(a){c(a.target.responseText)},!1),d.open("GET",a,!0),d.send(null)}},e.prototype.isCtrlDown=function(a){return a.ctrlKey||a.metaKey},e.prototype.isAltDown=function(a){return a.altKey},e.prototype.isShiftDown=function(a){return a.shiftKey},e.prototype.load2dSceneCategory=function(){var a=new c.AccordionData;return a.filterCategory=function(a){return"2d"==a||"2d"==a||"2d"==a||"2d"==a||"2d"==a?!0:!1},a.sortCategories=function(a){return a},a.filterModel=function(a){return"twaver.idc.floor.top"==a||"twaver.idc.column.top"==a?!1:!0},a.getData()},e.prototype.load2dRackCategory=function(a){var b=new c.AccordionData;return b.filterCategory=function(b){return""==b?!1:""==b?!1:a||"2D"==b||""==b?""!=b&&"2D"!=b&&""!=b&&""!=b?!1:!0:!1},b.filterModel=function(a){return a.indexOf(".back.")>=0?!1:void 0},b.getData()},e.prototype.load2dDeviceCategory=function(){var a=new c.AccordionData;return a.filterCategory=function(a){return""==a?!1:""==a?!1:["","","",""].indexOf(a)<0?!1:!0},a.filterModel=function(a){return"twaver.idc.component.panel"==a?!1:"twaver.idc.background.panel"==a?!1:!0},a.getData()},e.prototype.load2dChassisCategory=function(){var a=new c.AccordionData;return a.filterCategory=function(a){return""==a?!1:""==a?!1:["",""].indexOf(a)<0?!1:!0},a.getData()},e.prototype.load2dCircuitCategory=function(){var a=new c.AccordionData;return a.filterCategory=function(a){return""==a?!1:""==a?!1:""==a?!0:[""].indexOf(a)<0?!1:!0},a.getData()},e.prototype.load3dModelCategory=function(){var a=new c.AccordionData;return a.filterCategory=function(a){return""==a||""==a||""==a||""==a?!0:!1},a.filterModel=function(a){return"twaver.combo"==a||a.indexOf(".top")>=0?!1:!0},a.getData()},e.prototype.transformAndScaleCanvasContext=function(b,c){var d=b.getContext("2d");if(!c&&b.isTransfor&&b.width&&b.height)return d;var e=a.devicePixelRatio||1,f=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1,g=e/f;if(e!==f){var h=b.offsetWidth,i=b.offsetHeight;b.width=h*g,b.height=i*g,b.style.width=h+"px",b.style.height=i+"px",d.scale(g,g)}return b.width&&b.height&&(b.isTransfor=!0),d},e.prototype.animateCamera=function(a,b,c,d,e){var f=a.getPosition().sub(a.getTarget()),g=new twaver.Animate({from:0,to:1,dur:500,easing:"easeBoth",onUpdate:function(e){var g=c.x+(d.x-c.x)*e,h=c.y+(d.y-c.y)*e,i=c.z+(d.z-c.z)*e,j=new mono.Vec3(g,h,i);a.lookAt(j),b.target=j;var k=(new mono.Vec3).addVectors(f,j);a.setPosition(k)}});g.onDone=e,g.play()},e.prototype.findFirstObjectByMouse=function(a,c,d){d===b&&(d=this.findFirstObjectByMouseFilter);var e=a.getElementsByMouseEvent(c);if(e.length){if(!d)return e[0];for(var f=0;f<e.length;f++){var g=e[f],h=g.element;if(d(h))return g}}return null},e.prototype.findFirstObjectByMouseFilter=function(a){return!(a instanceof mono.Billboard)},e.prototype.getUrlParam=function(b){var c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)"),d=a.location.search.substr(1).match(c);return null!=d?unescape(decodeURIComponent(d[2])):null},e.prototype.getModelParameter=function(a){return make.Default.getModelDefaultParameters(a)},e.prototype.initPropertySheet=function(a){a.setEditable(!0);a.getPropertyBox()},e.prototype.addProperties=function(a,b){b.forEach(function(b){a.add(b)})},e.prototype.createSceneNetwork3D=function(a){var b=this;a=a||{};var c=a.network||new mono.Network3D,d=c.getDataBox();if(!a.initialized){var e=new mono.PerspectiveCamera(30,1.5,50,2e4);c.setCamera(e),e.p(1328.647469988342,2925.856952899234,2084.0725294541244),e.look(new mono.Vec3(1356.0876637604608,255.78986100252212,-567.4369627978233));var f=c.getDefaultInteraction();f.yLowerLimitAngle=Math.PI/180*2,f.yUpLimitAngle=Math.PI/2,f.maxDistance=1e4,f.minDistance=50,f.zoomSpeed=3,f.panSpeed=.2,c.setInteractions([f]);var g=new mono.PointLight(16777215,.1);g.setPosition(8e3,8e3,8e3),d.add(g),d.add(new mono.AmbientLight("white"))}var h=c.getRootView(),i=null;a.renderView&&"string"!=typeof a.renderView&&(i=a.renderView),i||(i=document.getElementById(a.renderView)),i||(i=document.getElementsByClassName(a.renderView)[0]),i||(i=document.createElement("div"),i.setAttribute("class","renderView-scene-3d"),i.style.position="absolute",i.style.width="100%",i.style.height="100%",document.body.appendChild(i)),i.appendChild(h),mono.Utils.autoAdjustNetworkBounds(c,i,"clientWidth","clientHeight",0,0);var j=h.getAttribute("class");return j||(j=""),h.setAttribute("class",j+"  network3d-view"),h.addEventListener("dblclick",function(d){b.handleDoubleClick(d,c,a.handleDoubleClick)}),c},e.prototype.loadSceneData=function(a,b,c){make.Default.load(b,function(b){for(var d in b){var e=b[d];c&&c(e)||a.addByDescendant(e)}})},e.prototype.loadDeviceData=function(a,b,c,d){var e=b,f=make.Default.RACK_OFFSET_Y,g=make.Default.getUnitHeight(),h=e.getBoundingBox(),i=make.Default.load(c);for(var j in i){var k=i[j];if(!d||!d(k)){var l=c[j].client.loc,m=k.getBoundingBox(),n=f+(l-1)*g-(h.max.y-h.min.y)/2+(m.max.y-m.min.y)/2;k.setY(n),k.setZ((h.max.z-h.min.z)/2-(m.max.z-m.min.z)/2+1),k.setParent(e),a.addByDescendant(k)}}},e.prototype.handleDoubleClick=function(a,b,c){var d=b.getCamera(),e=b.getDefaultInteraction(),f=this.findFirstObjectByMouse(b,a);if(f){var g=f.element,h=f.point,i=d.getTarget();if(this.animateCamera(d,e,i,h,function(){g.getClient("animation")&&make.Default.playAnimation(g,g.getClient("animation"))}),g.getClient("dbl.func")){var j=g.getClient("dbl.func");j(g,b,f,a)}else if("rack_door"==g.getClient("type")){var j=g.getParent().getClient("dbl.func");j&&j(g.getParent(),b,f,a)}c&&c(g,b,f,a)}else{var i=d.getTarget(),h=new mono.Vec3(0,0,0);this.animateCamera(d,e,i,h)}},e.prototype.createPanelDialog=function(){if(a.$&&a.$.ui&&a.$.ui.dialog){var b=$("<div class='panel-main'></div>").appendTo(document.body);return $(b).dialog({title:"",width:1e3,height:500,modal:!0,close:function(){b.network.dispose(),b.remove()}}),b}throw"there is not import jquery and jquery-ui.js"},e.prototype.createPanelNetwork2D=function(a){a=a||{};var b=a.network||new twaver.vector.Network,c=(b.getElementBox(),b.getView());b.setMaxZoom(50),c.setAttribute("class","network-view-device-panel");var d=null;a.renderView&&"string"!=typeof a.renderView&&(d=a.renderView),d||(d=document.getElementById(a.renderView)),d||(d=document.getElementsByClassName(a.renderView)[0]),d||(d=document.createElement("div"),d.setAttribute("class","renderView-panel"),d.style.position="absolute",d.style.width="100%",d.style.height="100%",document.body.appendChild(d)),d.appendChild(c);var e=d.clientWidth,f=d.clientHeight;return b.adjustBounds({x:0,y:0,width:e,height:f}),setTimeout(function(){b.zoomOverview()},500),b},e.prototype.loadPanelData=function(a,b,c,d,e){e=e||1,c=c||0,d=d||0;var f=make.Default.load({id:"twaver.idc.panel.loader",data:b,scale:e,x:c,y:d});f instanceof Array?f.forEach(function(b){a.addByDescendant(b)}):a.addByDescendant(f)},e.prototype.getSceneEditorModel3dId=function(a){var b=a.replace(j.MODEL_SUFFIX_SEPARATOR+j.SCENE_MODEL_SUFFIX,""),c=b+j.MODEL_SUFFIX_SEPARATOR+j.SCENE_MODEL_SUFFIX;return j.sceneEditorModel2dTo3dMapping[c]||b},e.prototype.getSceneEditorModel2dId=function(a){var b=a.replace(j.MODEL_SUFFIX_SEPARATOR+j.SCENE_MODEL_SUFFIX,""),c=b+j.MODEL_SUFFIX_SEPARATOR+j.SCENE_MODEL_SUFFIX;return j.sceneEditorModel3dTo2dMapping[b]||c},e.prototype.getRackEditorModel3dId=function(a){var b=a.replace(j.MODEL_SUFFIX_SEPARATOR+j.RACK_MODEL_SUFFIX,""),c=b+j.MODEL_SUFFIX_SEPARATOR+j.RACK_MODEL_SUFFIX;return j.rackEditorModel2dTo3dMapping[c]||b},e.prototype.getRackEditorModel2dId=function(a){var b=a.replace(j.MODEL_SUFFIX_SEPARATOR+j.RACK_MODEL_SUFFIX,""),c=b+j.MODEL_SUFFIX_SEPARATOR+j.RACK_MODEL_SUFFIX;return j.rackEditorModel3dTo2dMapping[b]||c},e.prototype.getDeviceEditorModel3dId=function(a){var b=a.replace(j.MODEL_SUFFIX_SEPARATOR+j.DEVICE_MODEL_SUFFIX,""),c=b+j.MODEL_SUFFIX_SEPARATOR+j.DEVICE_MODEL_SUFFIX;return j.deviceEditorModel2dTo3dMapping[c]||b},e.prototype.getDeviceEditorModel2dId=function(a){var b=a.replace(j.MODEL_SUFFIX_SEPARATOR+j.DEVICE_MODEL_SUFFIX,""),c=b+j.MODEL_SUFFIX_SEPARATOR+j.DEVICE_MODEL_SUFFIX;return j.deviceEditorModel3dTo2dMapping[b]||c},e.prototype.createImportDialog=function(a,b,c,e){this.fileIndex=this.fileIndex||1;var f="files-"+this.fileIndex;this.fileIndex++;var g=new d.edit.Dialog(a,{OK:function(){var a=$("#"+f)[0];if(a.files&&a.files.length>0){var d=a.files[0];if(d.name.indexOf(".")>0){var g=d.name.split(".");if(g[1]!=b)return void alert("file format should be "+b);var h=new FileReader;e?h.readAsArrayBuffer(d):h.readAsText(d),h.onloadend=function(){h.error?console.log(h.error):c&&c(h.result)}}}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}});g.init(),g.getView().dialog("option","width",450),g.getView().dialog("option","height",180);var h="<div   ><label class='field'>File Path:</label>   <input id='"+f+"' type='file' class='input' size='20'/></div>";return g.setData(h),g},e.prototype.createExportDialog=function(a){a instanceof Object&&(a=JSON.stringify(a));var b="<div><br><textarea>"+a+"</textarea></div>";$(b).dialog({title:"json",width:400,height:500})},e.prototype.createJsonObject=function(a,b,c){if(b.length>0)for(var d=0;d<b.length;d++){var e=b[d];c&&(e.dataType=c);var f=g._getJsonData(e);a.add(f)}},e.prototype._getJsonData=function(a){var b=new d.edit.data.JsonObject,c=a.id,e=a.data,f=a.position||[0,0,0],h=a.width,i=a.depth;if(c&&(b.id=c),a.objectId&&(b.objectId=a.objectId),null!=e&&e.length>0){var j=[];if(e[0]instanceof Array)for(var k=0;k<e.length;k++){var l=e[k],m=e[k].length;2==m?j.push([l[0]-f[0],l[1]-f[2]]):5==m&&j.push([l[0],l[1]-f[0],l[2]-f[2],l[3]-f[0],l[4]-f[2]])}else for(var k=0;k<e.length;k+=2)j.push([e[k]-f[0],e[k+1]-f[2]]);b.setData(j)}if(a.children){for(var n=[],k=0;k<a.children.length;k++){var o=a.children[k],p=g._getJsonData(o);n.push(p)}b.setChildren(n)}return f&&b.setPosition(f),h&&b.setWidth(h),i&&b.setDepth(i),a.rotation&&b.setRotation(a.rotation),a.closed&&b.setClosed(a.closed),a.showFloor&&b.setShowFloor(a.showFloor),a.client=a.client||{},a.client.label=make.Default.getName(c),a.dataType&&(b.client.dataType=a.dataType),a.client&&b.setClient(a.client),b},e.prototype.isEditModel=function(a){return!0},e.prototype.isMoveModel=function(a){return!0},e.prototype.isChild=function(a){var b=a.getClient("type"),c=["door","window"];return b&&c.indexOf(b)>=0?!0:!1},e.prototype.stopPropagation=function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},e.prototype.parseDxf=function(a){var b=new d.edit.ImportDxf,c=b.loadDxf(a);return c},e.prototype.o2s=function(a){try{return JSON.stringify(a)}catch(b){throw b}},e.prototype.s2o=function(a){try{return JSON.parse(a)}catch(b){throw b}},e.prototype.clone=function(a){return a.clone?a.clone():g.s2o(g.o2s(a))},e.prototype.ext=function(a,b,c){var d=a.prototype;if(twaver.Util.ext(a,b,c),d&&a.prototype)for(var e in d)a.prototype[e]=d[e]},e.prototype.addMask=function(a){var b;parseInt(document.body.scrollWidth),parseInt(document.body.scrollHeight);return b=document.createElement("div"),a?b.setAttribute("id","mask_"+a):b.setAttribute("id","mask"),b.setAttribute("class","mask"),document.body.appendChild(b),b},e.prototype.setDialogRect=function(a){var b=document.getElementById("mask");if(document.getElementById("mask_"+a)&&(b=document.getElementById("mask_"+a)),b){var c=b.offsetWidth,d=b.offsetHeight,e=document.getElementById(a),f=e.offsetWidth,g=e.offsetHeight;e.style.left=c/2-f/2+"px",e.style.top=d/2-g/2+"px"}},e.prototype.queryString=function(a,b){var c=new RegExp(""+b+"=([^&?]*)","ig");return a.match(c)?a.match(c)[0].substr(b.length+1):null},e.prototype.isPointInRect=function(a,b){return a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height},e.prototype.moveSelectionElements=function(a,b,c,d){var e=a.getSelectionModel().getSelection();if(e.size()>0){var f=0,g=0;"left"===b&&(f=-c),"right"===b&&(f=c),"top"===b&&(g=-d),"bottom"===b&&(g=d),twaver.Util.moveElements(e,f,g,!1)}},e.prototype.isNodeInNode=function(a,b){var c=this.getNodePoints(a),d=b.getCenterLocation();return this.isPointInPolygon(c,d)},e.prototype.isPointInPolygon=function(a,b){var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;f>c;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e},e.prototype.rotatePoint=function(a,b,c){var c=c||{x:0,y:0},d=c.x,e=c.y,f=a.x,g=a.y,h=b,i=(f-d)*Math.cos(h)-(g-e)*Math.sin(h)+d,j=(f-d)*Math.sin(h)+(g-e)*Math.cos(h)+e;return{x:i,y:j}},e.prototype.getNodePoints=function(a){var b=this;if(a instanceof twaver.ShapeNode)return a.getPoints().toArray();var c=a.getCenterLocation(),d=a.getAngle()/180*Math.PI,e=a.getLocation(),f=a.getSize(),g=[{x:e.x,y:e.y},{x:e.x+f.width,y:e.y},{x:e.x+f.width,y:e.y+f.height},{x:e.x,y:e.y+f.height}],h=g.map(function(a){return b.rotatePoint(a,d,c)});return h};var f={};e.prototype.runDelayTask=function(a,b,c){f[a]&&clearTimeout(f[a]),f[a]=setTimeout(function(){f[a]=null,c&&c()},b)},e.prototype.is=function(a,b){return Object.prototype.toString.call(a)==="[object "+b+"]"},e.prototype.padStart=function(a,b,c){a+="",c=c||"0";var d=b?a.length:0;return b&&b>d?this.baseRepeat(c,b-d)+a:a},e.prototype.baseRepeat=function(a,b){var c="";if(!a||1>b||b>Number.MAX_SAFE_INTEGER)return c;do b%2&&(c+=a),b=Math.floor(b/2),b&&(a+=a);while(b);return c};var g=new e;c.Utils=c.utils=g;var h=function(){this._data=[],this.init()};h.prototype={init:function(){this._data=[];var a=this,b=make.Default.getCategories(),c=[];b.forEach(function(b){a.filterCategory&&a.filterCategory(b)===!1||c.push(b)}),this.sortCategories&&(c=this.sortCategories(c)),c.forEach(function(b){var c=[],d=make.Default.getCreatorsForCategory(b);for(var e in d)if(!a.filterModel||a.filterModel(e)!==!1){var f=make.Default.getParameters(e),g=make.Default.getIcon(e),h=make.Default.isCombo(e);c.push({id:e,icon:g,label:f.name,category:b,combo:h})}a.sortModels&&(c=a.sortModels(c)),c&&c.length>0&&a._data.push({title:b,contents:c})})},getData:function(){return this.init(),this._data},filterCategory:function(a){return""==a?!1:""==a?!1:!0},sortCategories:function(a){return a},filterModel:function(a){return!0},sortModels:function(a){return a}},c.AccordionData=h,c.utils.ext(h,Object);var i=function(){this.init(),this._categories=[],this._visible=!0,this._reset=!0};i.prototype={init:function(){this.paneBox=$('<div id="accordion-resizer" class="ui-widget-content"></div>'),this.mainPane=$('<div id="accordion"></div>').appendTo(this.paneBox),this.mainPane.accordion({heightStyle:"fill"})},setCategories:function(a){var b=this._categories;this._categories=a,this.mainPane.accordion("destroy"),this.mainPane.empty();var c=this;if(a)for(var d=0;d<a.length;d++){var e=a[d],f=$("."+e.title);0==f.length&&(f=$('<h3 class="'+e.title+'">'+e.title+"</h3>").appendTo(this.mainPane),$('<ul class="mn-accordion"></ul>').appendTo(this.mainPane));var g=f.next(".mn-accordion");e.contents.forEach(function(a){var b=a.icon;(!b||b.indexOf("undefined")>=0)&&(b="images/cloud-up-icon.png");var d=$('<li class="item-li" style="height: 108px;"></li>').appendTo(g),e=$("<img src="+b+" title="+(a.description||a.label)+"></img>"),f=$('<div class="item-label" style="word-break: break-all; display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;overflow: hidden;">'+a.label+"</div>");d.append(e),d.append(f),c.setImageDraggable(e[0],a),e[0]._errCount=0,e.error(function(){this._errCount++,this._errCount<=3&&$(this).attr("src",make.Default.path+"model/idc/icons/ball-red.png")})})}return this.mainPane.accordion({heightStyle:"fill",collapsible:!0}),this.mainPane.accordion("refresh"),this.refresh(),b},getCategories:function(){return this._categories},setVisible:function(a){this._visible!=a&&(this._visible=a,this._visible?this.paneBox.show():this.paneBox.hide())},isVisible:function(){return this._visible},refresh:function(){var a=this;setTimeout(function(){a.mainPane.accordion("refresh")},100)},getView:function(){return this.paneBox[0]},setImageDraggable:function(a,b){var c=this;d.edit.DragAndDrop.setDragTarget(a,b,{effectAllowed:"copyMove",dragImage:b.dragImage||b.icon,ondrag:function(a){c.ondrag&&c.ondrag(a,b)}})},ondrag:function(a,b){}},c.AccordionPane=d.edit.AccordionPane=i,c.utils.ext(i,Object);var j={MODEL_SUFFIX_SEPARATOR:".",SCENE_MODEL_SUFFIX:"top",RACK_MODEL_SUFFIX:"front",DEVICE_MODEL_SUFFIX:"panel",REDIRECT_RACK_EDITOR:!0,REDIRECT_DEVICE_EDITOR:!0,sceneEditorModel3dTo2dMapping:{},sceneEditorModel2dTo3dMapping:{},rackEditorModel3dTo2dMapping:{},rackEditorModel2dTo3dMapping:{},deviceEditorModel3dTo2dMapping:{},deviceEditorModel2dTo3dMapping:{},circuitEditorModel3dTo2dMapping:{},circuitEditorModel2dTo3dMapping:{},pasteOffsetX:10,pasteOffsetY:10,pasteOffsetZ:10};c.consts=j,d.edit.Consts=j;var k=d.edit.Dialog=function(a,b,c,d){var a=a||"Dialog";this.dialog=$('<div id="export-message" title = "'+a+'"></div>'),this.content=$('<div class="inner" ></div>'),this.dialog.append(this.content),this.buttons=b,this.params=c||{}};k.prototype.setData=function(a){"string"==typeof a?this.content.html(a):this.content.append(a)},k.prototype.getView=function(){return this.dialog},k.prototype.init=function(){this.buttons||(this.buttons={Ok:function(){$(this).dialog("close")}}),this.dialog.dialog({height:300,width:350,autoOpen:!1,show:{effect:"fade"},hide:{effect:"fade"},modal:!0,buttons:this.buttons,
close:this.params.close})},k.prototype.show=function(){this.dialog.dialog("open")},k.prototype.hide=function(){this.dialog.dialog("close")};var l=d.edit.DragAndDrop={};l.setDragImage=function(a,b){if(a){var c=a;"string"==typeof a&&(a=document.createElement("img"),a.setAttribute("src",c)),b.dataTransfer.setDragImage&&b.dataTransfer.setDragImage(a,a.width/2,a.height/2)}},l.setDragTarget=function(a,b,c){c=c||{},a.setAttribute("dragable",!0);var d=b;null!=b&&"string"!=typeof d&&(d=JSON.stringify(d));var e=c.dragImage;a.ondragstart=function(a){d&&a.dataTransfer.setData("Text",d),c.effectAllowed&&(a.dataTransfer.effectAllowed=c.effectAllowed),l.setDragImage(e,a),c.ondragstart&&c.ondragstart(a)},c.ondragend&&(a.ondragend=c.ondragend),c.ondrag&&(a.ondrag=c.ondrag)},l.allowDrop=function(a){a.preventDefault()},l.setDropTarget=function(a,b){b=b||{},b.ondragenter&&(a.ondragenter=b.ondragenter),a.ondragover=function(a){l.allowDrop(a),b.dropEffect&&(a.dataTransfer.dropEffect=b.dropEffect);var c=a.dataTransfer.getData("Text");b.ondragover&&b.ondragover(a,c)},a.ondragleave=b.ondragleave,a.ondrop=function(a){a.preventDefault();var c=a.dataTransfer.getData("Text");b.ondrop&&b.ondrop(a,c)}};var m=function(a){var b=this;this.parentView=$(a),this._accordionVisible=!0,this._propertySheetVisible=!0,this.accordionPane=null,this.ruler=null,this.network2d=null,this.bidQuickFinder=null,this.undoManager=null,this.copyFilter=function(a){return a},this.pasteFilter=function(a){return a},this.flowAndCopyFilter=function(a){return a},this.parentView.resize(function(){b.parentResizeHandle&&b.parentResizeHandle()}),this.contentPane=$('<div class="editor-container"></div>').appendTo(a),this.propertySheetBox=$('<div class="propertySheetBox right-content"></div>').appendTo(this.contentPane),this.accordionPaneBox=$('<div class="accordionPaneBox"></div>').appendTo(this.contentPane),this.networkBox=$('<div class="networkBox"></div>').appendTo(this.contentPane),this.adjustBounds({left:"0px",right:"0px",top:"0px",bottom:"0px"}),this.flowOffsetX=0,this.flowOffsetY=0,this.pasteOffsetDx=j.pasteOffsetX,this.pasteOffsetDy=j.pasteOffsetY,this.pasteOffsetDz=j.pasteOffsetZ,this.pasteOffsetX=j.pasteOffsetX,this.pasteOffsetY=j.pasteOffsetY,this.pasteOffsetZ=j.pasteOffsetZ,this._copyAnchor=[],this._init()};m.prototype={_init:function(){this.setPropertySheetVisible(!0),this.setAccordionVisible(!0),this.propertySheetBox.hide()},setAccordionVisible:function(a){this._accordionVisible!=a&&(this._accordionVisible=a,a?(this.accordionPaneBox.show(),this.networkBox.css("left",200)):(this.accordionPaneBox.hide(),this.networkBox.css("left",0)),this.invalidate())},invalidate:function(){},addKeyMoveListener:function(a){var b=a.getElementBox();a.getView().addEventListener("keydown",function(c){var d=!1,e=a.getPositionMagneticX(),f=a.getPositionMagneticY();37==c.keyCode&&(g.moveSelectionElements(b,"left",e,f),d=!0),38==c.keyCode&&(g.moveSelectionElements(b,"top",e,f),d=!0),39==c.keyCode&&(g.moveSelectionElements(b,"right",e,f),d=!0),40==c.keyCode&&(g.moveSelectionElements(b,"bottom",e,f),d=!0),d&&(c.preventDefault(),c.stopPropagation())})},isAccordionVisible:function(){return this._accordionVisible},setPropertySheetVisible:function(a){this._propertySheetVisible!=a&&(this._propertySheetVisible=a,a?this.propertySheetBox.show():this.propertySheetBox.hide())},resetPropertySheetBoxSize:function(a){var b=this;clearTimeout(this.resetPropertySheetBoxSizeTimer),this.resetPropertySheetBoxSizeTimer=setTimeout(function(){var c=a.getDataDiv().clientHeight;b.propertySheetBox.height(c+1);var d=b.propertySheetBox.width(),e=b.propertySheetBox.height();a.adjustBounds({x:0,y:0,width:d,height:e})},500)},isPropertySheetVisible:function(){return this._propertySheetVisible},adjustBounds:function(a){for(var b in a)this.contentPane.css(b,a[b])},parentResizeHandle:function(){this.ruler&&this.ruler.invalidate(),this.accordionPane&&this.accordionPane.refresh()},getBounds:function(){if(this.parentNode){var a=this.parentNode.getLocation(),b=this.parentNode.getSize();return{width:b.width,height:b.height,x:a.x,y:a.y}}var c=this.network2d.getUnionBounds(),d=this.network2d.getZoom();return c.x/=d,c.y/=d,c.width/=d,c.height/=d,c},getScaleByRegion:function(a,b){var c=this.getBounds(),d=a/c.width,e=b/c.height,f=Math.min(d,e);return f},toCanvas:function(a){var b=this.getBounds(),c=a.scale||1,d=a.x||b.x,e=a.y||b.y,f=a.width||b.width,g=a.height||b.height,h=this.network2d.toCanvasByRegion({width:f,height:g,x:d,y:e},c);return{width:h._viewRect.width,height:h._viewRect.height,content:h}},getImage:function(a){a=a||2;var b=this.toCanvas({scale:a}),c=b.content,d=mono.Utils.nextPowerOfTwo(b.width),e=mono.Utils.nextPowerOfTwo(b.height),f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");return g.clearRect(0,0,d,e),g.drawImage(c,0,0,d,e),f.toDataURL()},getIcon:function(a,b){a=a||84,b=b||84;var c=this.getScaleByRegion(a,b),d=this.getBounds();d.scale=c;var e=this.toCanvas(d).content,f=e.width,g=e.height,h=(a-f)/2,i=(b-g)/2,j=document.createElement("canvas");j.width=a,j.height=b;var k=j.getContext("2d");return k.clearRect(0,0,a,b),k.drawImage(e,h,i),j.toDataURL()},setShowGrid:function(a){this.network2d.setShowGrid(a)},isShowGrid:function(){return this.network2d.isShowGrid()},setAutoShowOrHideGrid:function(a){this.network2d.autoShowOrHide=a},isAutoShowOrHideGrid:function(){return this.network2d.autoShowOrHide},getPositionMagneticX:function(){return this.network2d.getPositionMagneticX()},setPositionMagneticX:function(a){return this.network2d.setPositionMagneticX(a)},getPositionMagneticY:function(){return this.network2d.getPositionMagneticY()},setPositionMagneticY:function(a){return this.network2d.setPositionMagneticY(a)},isPositionMagneticEnabled:function(){return this.network2d.isPositionMagneticEnabled()},setPositionMagneticEnabled:function(a){return this.network2d.setPositionMagneticEnabled(a)},setGrids:function(a){var b=this.network2d.setGrids(a);return this.network2d.repaint(),b},getGrids:function(){return this.network2d.getGrids()},zoomOverview:function(){console.warn("this method[{}] is not supported".format("zoomOverview"))},getData:function(){return console.warn("this method[{}] is not supported".format("getData")),[]},setData:function(a){console.warn("this method[{}] is not supported".format("setData"))},getSelectedData:function(){return console.warn("this method[{}] is not supported".format("getSelectedData")),[]},appendData:function(a){console.warn("this method[{}] is not supported".format("appendData"))},removeData:function(a){console.warn("this method[{}] is not supported".format("appendData"))},clear:function(){return console.warn("this method[{}] is not supported".format("clear")),[]},copySelection:function(a){a=a||this.copyFilter;var b=this.getSelectedData();return this._clearPasteOffset(),a&&(b=a(b)),this._copyAnchor=b,this._copyAnchor},pasteSelection:function(a,b){b=b||this.pasteFilter;var d=this;if(!this._copyAnchor||0==this._copyAnchor.length)return null;var e=this.network2d.getSelectionModel();a=a||this._getPasteOffset();var f=[];this._copyAnchor.forEach(function(e){var h=g.clone(e);if(h.objectId=c.id(),f.push(h),h.position){var i=h.position;h.position=[i[0]+a.x,i[1],i[2]+a.z]}if(h.location){var j=h.location;j instanceof Array?h.location=[i[0]+a.x,i[1]+a.z]:(h.location.x+=a.x,h.location.y+=a.z)}h.x&&(h.x+=a.x),h.y&&(h.y+=a.z),b&&(h=b(h)),h&&d.appendData(h)}),setTimeout(function(){e.clearSelection(),f.forEach(function(a){var b=d.network2d.getElementBox().getDataById(a.objectId);e.appendSelection(b)})},100)},flowAndCopy:function(a,b,d){d=d||this.flowAndCopyFilter;var e=this,f=this.getSelectedData(d);if(1!=f.length)return"you can use this fun only select one data";f=f[0];var h=[],i=this.network2d.getElementBox().getDataById(f.objectId);if(!i.getSize)return"this fun used node";var j=i.getSize();j=j||{width:60,height:60};for(var k=j.width+this.flowOffsetX,l=j.height+this.flowOffsetY,m=k,n=l,o=0;b>o;o++){var p=g.clone(f);if(p.objectId=c.id(),h.push(p),p.position){var q=p.position;"hor"==a?(q[0]+=m,m+=k):(q[2]+=n,n+=l)}d&&(p=d(p)),p&&this.appendData(p)}setTimeout(function(){var a=e.network2d.getSelectionModel();h.forEach(function(b){var c=e.network2d.getElementBox().getDataById(b.objectId);a.appendSelection(c)})},100)},_getPasteOffset:function(){return this.pasteOffsetX+=this.pasteOffsetDx,this.pasteOffsetY+=this.pasteOffsetDy,this.pasteOffsetZ+=this.pasteOffsetDz,{x:this.pasteOffsetX,y:this.pasteOffsetY,z:this.pasteOffsetZ}},_clearPasteOffset:function(){this.pasteOffsetX=0,this.pasteOffsetY=0,this.pasteOffsetZ=0},findByBID:function(a){return this.bidQuickFinder||(this.bidQuickFinder=new twaver.QuickFinder(this.network2d.getElementBox(),"bid","client")),this.bidQuickFinder.findFirst(a)},setUndoManagerEnabled:function(a){this.undoManager=this.undoManager||this.network2d.getElementBox().getUndoManager(),this.undoManager.setEnabled(a)},undo:function(){this.undoManager=this.undoManager||this.network2d.getElementBox().getUndoManager(),this.undoManager.undo()},redo:function(){this.undoManager=this.undoManager||this.network2d.getElementBox().getUndoManager(),this.undoManager.redo()},startBatch:function(){this.undoManager=this.undoManager||this.network2d.getElementBox().getUndoManager(),this.undoManager.startBatch()},endBatch:function(){this.undoManager=this.undoManager||this.network2d.getElementBox().getUndoManager(),this.undoManager.endBatch()},setSuspended:function(a){this.undoManager=this.undoManager||this.network2d.getElementBox().getUndoManager(),this.undoManager.setSuspended(a)}},c.utils.ext(m,Object),c.Editor=m,d.edit.GridNetwork=function(a){a=a||new twaver.ElementBox,d.edit.GridNetwork.superClass.constructor.call(this,a),this._positionMagneticEnabled=!0,this._positionMagneticX=10,this._positionMagneticY=10,this.grids=[],this._showGrid=!0,this.autoShowOrHide=!0,this.grid1={width:1e3,height:1e3,visible:!0,visibleFilter:function(a){return a>.05},shapeColor:"#FF0000",shapeSize:1,shape:"line"},this.grid2={width:100,height:100,skipX:[],skipY:[],visible:!0,visibleFilter:function(a){return a>.12},shapeColor:"#FFAA00",shapeSize:1,shape:"line"},this.grid3={width:50,height:50,skipX:[100],skipY:[100],visible:!0,visibleFilter:function(a){return a>1},shapeColor:"#FFFFAE",shapeSize:1,shape:"line"},this.grid4={width:10,height:10,skipX:[100,50],skipY:[100,50],visible:!0,visibleFilter:function(a){return a>2},shapeColor:"#AAFF00",shapeSize:2.5,shape:"point"},this.initGridNetwork()},d.edit.GridNetwork.prototype={initGridNetwork:function(){var a=this;this.setKeyboardRemoveEnabled(!1),this._box.addDataBoxChangeListener(function(b){var c=b.kind,d=b.data;"add"==c&&a.nodePositionMagneticInit(d)},this),this.addInteractionListener(function(b){if("liveMoveStart"==b.kind){var c=a._box.getSelectionModel().getSelection();a.beginMove(c)}else if("liveMoveEnd"==b.kind){var c=a._box.getSelectionModel().getSelection();a.endMove(c)}else"doubleClickBackground"==b.kind&&a.autoShowOrHide&&a.setShowGrid(!a.isShowGrid())},this),this.addPropertyChangeListener(function(a){"zoom"==a.property&&this.invalidateGrids(this.grids)},this),this.grids.push(this.grid1),this.grids.push(this.grid2),this.grids.push(this.grid3),this.grids.push(this.grid4),this.invalidateGrids(this.grids)},beginMove:function(a){a&&a.size()>0&&a.forEach(function(a){a instanceof twaver.Node&&(a.childNodeLiveMove=!0,a.childNodeLastPoint=a.getLocation(),a.childNodeLastPointOffset={x:0,y:0})})},endMove:function(a){a&&a.size()>0&&a.forEach(function(a){delete a.childNodeLiveMove,delete a.childNodeLastPoint,delete a.childNodeLastPointOffset})},setGrids:function(a){this.grids=a,this.invalidateGrids(this.grids)},getGrids:function(){return this.grids},resizeCanvas:function(a){this.repaint()},repaint:function(){this.invalidateElementUIs()},setShowGrid:function(a){this._showGrid=a,this.repaint()},isShowGrid:function(){return this._showGrid},setAutoShowOrHideGrid:function(a){this.autoShowOrHide=a},isAutoShowOrHideGrid:function(){return this.autoShowOrHide},setCursorPosition:function(a){this.cursorPosition=a,this.repaint()},getCursorPosition:function(){return this.cursorPosition},invalidateGrids:function(a){for(var b=this.getZoom(),c=a.length,d=0;c>d;d++){var e=a[d];e.skipX=[],e.skipY=[];for(var f=0;d>f;f++)e.skipX.push(a[f].width),e.skipY.push(a[f].height);e.visibleFilter&&(e.visible=e.visibleFilter(b))}},isSkipX:function(a,b){for(var c=0;c<a.skipX.length;c++)if(b%a.skipX[c]==0)return!0;return!1},paintGridAction:function(a,b,c,d){var e=b.width,f=b.height,g=b.bound.x,h=b.bound.y,i=b.bound.w,j=b.bound.h,k=a,l=this.getZoom(),m=g%e,n=h%f,g=g-m-e,h=h-n-f,i=i+2*e,j=j+2*f,o=g,p=g+i,q=h,r=h+j,s={xFrom:o,xEnd:p,yFrom:q,yEnd:r,width:i,height:j},t=b.shapeSize/l;k.lineWidth=t,k.strokeStyle=b.shapeColor;var u=t/2;b.offset=u;for(var v=o;p>v;v+=e)this.isSkipX(b,v)||c.call(this,b,k,s,v);for(var w=q;r>w;w+=f)this.isSkipY(b,w)||d.call(this,b,k,s,w)},isSkipY:function(a,b){for(var c=0;c<a.skipY.length;c++)if(b%a.skipY[c]==0)return!0;return!1},paintPointGrid:function(a,b){this.paintGridAction(a,b,this.paintPointGridX,this.paintPointGridY)},paintPointGridX:function(a,b,c,d){for(var e=c.yFrom;e<c.yEnd;e+=a.height)this.isSkipY(a,e)||(b.moveTo(d-a.offset,e),b.lineTo(d+a.offset,e),b.moveTo(d,e-a.offset),b.lineTo(d,e+a.offset))},paintPointGridY:function(a,b,c,d){},paintLineGrid:function(a,b){this.paintGridAction(a,b,this.paintLineGridX,this.paintLineGridY)},paintLineGridX:function(a,b,c,d){b.moveTo(d-a.offset,c.yFrom),b.lineTo(d-a.offset,c.yEnd)},paintLineGridY:function(a,b,c,d){b.moveTo(c.xFrom,d-a.offset),b.lineTo(c.xEnd,d-a.offset)},paintGrid:function(a,b){this._showGrid&&b.visible&&(a.beginPath(),"point"==b.shape?this.paintPointGrid(a,b):this.paintLineGrid(a,b),a.stroke())},paintGrids:function(a,b){var c=this.grids.length;if(c>0){var d=this.getViewRect(),e=this.getZoom(),f=d.x/e,g=d.y/e,h=d.width/e,i=d.height/e,j=a;j.save();for(var d={x:f,y:g,w:h,h:i},k=0;c>k;k++){var l=this.grids[k];l.bound=d,this.paintGrid(a,l)}j.restore()}},paintBottom:function(a,b){this.paintGrids(a,b)},getPositionMagneticX:function(){return this._positionMagneticX},setPositionMagneticX:function(a){this._positionMagneticX=a},getPositionMagneticY:function(){return this._positionMagneticY},setPositionMagneticY:function(a){this._positionMagneticY=a},isPositionMagneticEnabled:function(){return!!this._positionMagneticEnabled},setPositionMagneticEnabled:function(a){return this._positionMagneticEnabled=a},getNodePositionMagneticX:function(a){if(a){var c=a.getClient("magnetic.x");if(c!=b&&null!=c)return c}return this.getPositionMagneticX()},getNodePositionMagneticY:function(a){if(a){var c=a.getClient("magnetic.y");if(c!=b&&null!=c)return c}return this.getPositionMagneticY()},isNodePositionMagneticDisabled:function(a){if(a){var b=a.getClient("magnetic.disabled");if(b)return!0}return!this.isPositionMagneticEnabled()},setNodePositionMagnetic:function(a,b,c){if(!this.isNodePositionMagneticDisabled(a)&&!this.isEditingElement(a))var d=this.getNodePositionMagneticX(a),e=this.getNodePositionMagneticY(a),b=Math.round(b/d)*d,c=Math.round(c/e)*e;a.originalSetLocation(b,c)},nodePositionMagneticInit:function(a){if(a instanceof twaver.Node&&!a.originalSetLocation){var b=this,c=a.setLocation;a.originalSetLocation=c,a.setLocation=function(c,d){if(1==arguments.length){var e=c;c=e.x,d=e.y}b.setNodePositionMagnetic(a,c,d)};var d=a.translate;a.translate=function(c,e){if(a.childNodeLiveMove){a.childNodeLastPointOffset.x+=c,a.childNodeLastPointOffset.y+=e;var f=a.childNodeLastPoint.x+a.childNodeLastPointOffset.x,g=a.childNodeLastPoint.y+a.childNodeLastPointOffset.y;b.setNodePositionMagnetic(a,f,g)}else d.call(a,c,e)};var e=a.getX(),f=a.getY();a.setLocation(e,f)}}},c.utils.ext(d.edit.GridNetwork,twaver.vector.Network),d.edit.PropertySheetPane=function(a){this.rightContent=$('<div class = "right-content"></div>'),this.box=a||new twaver.DataBox,this.initPropertySheet()},twaver.Util.ext(d.edit.PropertySheetPane,Object,{element:null,jsonObj:null,initPropertySheet:function(){this.sheet=new CPropertySheet(this.box),this.sheet.setEditable(!0),this.sheet.setSelectColor("#dadada");var a=this.sheet.getView();a.style.background="white",a.style.position="absolute",a.style.right=0,a.style.top=0,a.style.left=0,a.style.bottom=0,this.rightContent.append($(a));var b=this;this.params=null;var c=new d.edit.Dialog("",{OK:function(a){if(b.params){var d=b.params.view;if(d._isCommitting)return;d._isCommitting=!0,d.commitEditValue(b.params,$("#image-url")[0])}c.hide()},Cancel:function(a){var d=b.params.view;d._isCanceling=!0,d.cancelEditing(),c.hide()}},{close:function(){var a=b.params.view;a._isCanceling=!0,a.cancelEditing(),c.hide()}});$("body").append(c.getView()),c.init(),c.getView().dialog("option","width",500),c.getView().dialog("option","height",400);var e=function(a){return a.indexOf("/")>0?a:make.Default.path+"model/idc/images/"+a};this.sheet.renderEditor=function(a){if(b.params=a,a.view._currentEditor)return a.view._currentEditor;if("image"==a.property.getClient("dataType")){var d=a.property.getClient("dataCategory"),f=a.property.getClient("dataId"),g=((new Date).getTime(),"<label></label><select id='image-url'>"),h=b.getImageResourcesForEdit(d,f,a.property.getPropertyName());if(!h||!h.length)return a.view._currentEditor;h.forEach(function(b){g+=b===a.value?"<option value="+b+" selected='selected'> "+b+"</option>":"<option value="+b+"> "+b+"</option>"}),g+="</select><br><br><br><image id = 'dialogImage'></image>",c.setData(g),c.show(),$("#dialogImage").attr("src",e(a.value)),$("#image-url").change(function(a){var b=$("#image-url").val();b=e(b),$("#dialogImage").attr("src",b)});var i={view:$("#image-url")[0],onKeyDown:[{keyCode:13,handlerEvent:function(b){var d=a.view;d._isCommitting||(d._isCommitting=!0,d.commitEditValue(a,b.target),c.hide())}},{keyCode:27,handlerEvent:function(b){var d=a.view;d._isCanceling=!0,d.cancelEditing(),c.hide()}}]};return i}return null}},getImageResourcesForEdit:function(a,b,c){var d={"":["equipment_front-2U.png","server.png","./idc_images/server001.jpg","./idc_images/server002.jpg","./idc_images/server003.jpg","./idc_images/server004.jpg","./idc_images/server005.jpg"],"":["./idc_images/card1.png","card2.png","./idc_images/card3.png","./idc_images/card4.png","./idc_images/card5.png"],"":["alternator-top.jpg","air-condition-side.jpg","battery-top.jpg"]};return d[a]},setElement:function(a){var b=this;if(a){this._setValued=!1;var c=a.id,d=make.Default.getModelDefaultParameterProperties(c),e=this.sheet.getPropertyBox();e.clear(),g.addProperties(e,d),this.jsonObj=make.Default.getModelDefaultParametersValues(c),this._generateNode(a,this.jsonObj),this._setValued=!0}setTimeout(function(){var a=b.sheet.getDataDiv().clientHeight;b.rightContent.height(a+1);var c=b.rightContent.width(),d=b.rightContent.height();b.sheet.adjustBounds({x:0,y:0,width:c,height:d})},500)},_generateNode:function(a,b){this.box.clear();var c=this.node=new twaver.Node({id:a.objectId});c.setClient("id",a.id),this.box.add(c),make.Default.objectWrapper(c,"id",function(){return this.getClient("id")}),make.Default.objectWrapper(c,"objectId",function(){return this.getId()}),delete b.id,delete b.objectId;for(var d in b)make.Default.objectWrapper(c,d),c[d]=a[d]||b[d];this.box.getSelectionModel().setSelection(c)},getData:function(){return make.Default.toJson(this.node)},show:function(a,b){var c=this;this.rightContent.css({marginRight:10,width:220}),c.sheet.invalidate(),setTimeout(function(){var a=c.sheet.getDataDiv().clientHeight;c.rightContent.height(a+1);var b=c.rightContent.width(),d=c.rightContent.height();c.sheet.adjustBounds({x:0,y:0,width:b,height:d})},500),b&&b()},hide:function(){this.rightContent.css({marginRight:-220,width:0})},getView:function(){return this.sheet.getView()}}),CPropertySheet=function(a){CPropertySheet.superClass.constructor.call(this,a)},twaver.Util.ext(CPropertySheet,twaver.controls.PropertySheet,{updateCurrentRowIndex:function(a){var b=this._rowList.size();(0>a||a>=b)&&(a=-1);var c,d=this._currentRowIndex;if(a!==d&&(d>=0&&b>d&&(c=this._rowList.get(d),c.nameRender&&(c.nameRender.style.backgroundColor="")),this._currentRowIndex=a),a>=0&&(c=this._rowList.get(a),c.nameRender&&(c.nameRender.style.backgroundColor=this.getSelectColor(),!this._currentEditor&&c.valueRender&&c.valueRender._editInfo))){var e=c.valueRender._editInfo,f=this.renderEditor&&this.renderEditor(c);f?(this._currentEditor=f.view,null!=e.value&&(this._currentEditor.value=e.value)):e.enumInfo?this._currentEditor=$html.createSelect(e.enumInfo,e.value):(this._currentEditor=document.createElement("input"),null!=e.value&&(this._currentEditor.value=e.value));var g=this;if(this._currentEditor){if(f&&f.onKeyDown){var h=f.onKeyDown;h&&Array.isArray(h)&&g._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<h.length;b++)if(h[b].combKey){var c=null;switch(h[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===h[b].keyCode&&c&&h[b].handlerEvent&&h[b].handlerEvent(a)}else a.keyCode===h[b].keyCode&&h[b].handlerEvent&&h[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(13!==a.keyCode||!a.shiftKey)if(13===a.keyCode){if(b._isCommitting)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)}else 27===a.keyCode&&(b._isCanceling=!0,b.cancelEditing())},!1);if(this._currentEditor.keepDefault=!0,this._currentEditor._rowInfo=c,this._currentEditor._editInfo=e,!this._currentEditor.parentNode){var i=this._currentEditor.style;i.position="absolute",i.margin="0px",i.border="0px",i.padding="0px",i.left=this._indent+this._propertyNameWidth+"px",i.top=c.rowDiv.style.top,i.width=c.valueRender.style.width,i.height=c.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}twaver.Util.setFocus(this._currentEditor)}}}}),d.edit.Ruler=function(a){d.edit.Ruler.superClass.constructor.apply(this,arguments),this._view=this.createElement("div"),this._view.style.position="absolute",this._view.style.left="0px",this._view.style.right="0px",this._view.style.top="0px",this._view.style.bottom="0px",this._topRuler=this.createElement("canvas"),this._leftRuler=this.createElement("canvas"),this._initRuler(),this.setComponent(a),this.init(),this.invalidate()},twaver.Util.ext(d.edit.Ruler,twaver.controls.ViewBase,{_defaultGap:10,_rulerWidth:20,_lineColor:"#888",_lineIntervalLineColor:"#ccc",_mousePoint:null,_showGuides:!0,onPropertyChanged:function(a){this.invalidate()},init:function(){this._topRuler.visible&&this._view.appendChild(this._topRuler),this._leftRuler.visible&&this._view.appendChild(this._leftRuler),this.component.getView?this._view.appendChild(this.component.getView()):this._view.appendChild(this.component)},setComponent:function(a){var b=this.component,c=this;this.component=a,this.firePropertyChange("component",b,a),this.addViewPropertyChangeListener(a,this._handleViewPropertyChange),$(this._view).resize(function(){var a=$(this._view).width(),b=$(this._view).height();c.component.adjustBounds({x:0,y:0,width:a,height:b}),c.invalidate()})},getAbsPostion:function(a){for(var b=0,c=0;a=a.offsetParent;)b+=a.offsetTop,c+=a.offsetLeft;return{left:c,top:b}},_initRuler:function(){this._topRuler.visible=!0,this._leftRuler.visible=!0,this._topRuler.style.borderBottom="1px solid "+this._lineColor,this._topRuler.style.borderLeft="1px solid "+this._lineColor,this._leftRuler.style.borderRight="1px solid "+this._lineColor,this._leftRuler.style.borderTop="1px solid "+this._lineColor},_drawRuler:function(){var a=this.getComponentViewRect(),b=this.getComponentZoom();this.calculateGap(b);var c=this.getGap(),d=a.x,e=a.y,f=a.width,h=a.height,i=d%(5*c),d=d-i-5*c-1,j=Math.round((a.x-i-5*c)/b),k=d-a.x;1===Math.abs(Math.round(d/(5*c))%2)&&(k-=5*c,j-=5*this._defaultGap);var l=f+10*c;if(a&&this._topRuler.visible){var m=g.transformAndScaleCanvasContext(this._topRuler);this._drawHRuler(m,k,j,c,l,this._rulerWidth)}var n=e%(5*c),e=e-n-5*c-1,o=Math.round((a.y-n-5*c)/b),p=e-a.y;1===Math.abs(Math.round(e/(5*c))%2)&&(p-=5*c,o-=5*this._defaultGap);var q=h+10*c;if(a&&this._leftRuler.visible){var m=g.transformAndScaleCanvasContext(this._leftRuler);this._drawVRuler(m,p,o,c,q,this._rulerWidth)}},_drawHRuler:function(a,b,c,d,e,f){a.clearRect(b,0,e,f),a.save(),a.strokeStyle=this._lineIntervalLineColor,a.beginPath(),a.lineWidth=1;for(var g=1,h=f,i=f-6,j=(this.getComponentZoom(),b+d);b+e>j;j+=d)i=f-6,g%5==0&&(i=f-10),g%10!==0&&(a.moveTo(j,h),a.lineTo(j,i)),g++;a.closePath(),a.stroke(),g=1,a.beginPath(),a.strokeStyle=this._lineColor;for(var j=b+d;b+e>j;j+=d)g%10===0&&(i=1,a.moveTo(j,h),a.lineTo(j,i)),g++;a.stroke(),a.restore(),a.save(),a.textBaseline="middle",a.font="11px Arial",a.fillStyle=this._lineColor;for(var k=c,l=b;b+e>l;l+=10*d,k+=10*this._defaultGap)a.fillText(k,l+5,8);a.restore(),this._showGuides&&this._mousePoint&&(a.save(),a.strokeStyle="#f07819",a.lineWidth=3,a.beginPath(),a.moveTo(this._mousePoint.x,0),a.lineTo(this._mousePoint.x,20),a.stroke(),a.restore())},_drawVRuler:function(a,b,c,d,e,f){a.clearRect(0,b,f,e),a.save(),a.strokeStyle=this._lineIntervalLineColor,a.beginPath(),a.lineWidth=1;for(var g=1,h=f,i=f-6,j=(this.getComponentZoom(),b+d);b+e>j;j+=d)i=f-6,g%5==0&&(i=f-10),g%10!==0&&(a.moveTo(h,j),a.lineTo(i,j)),g++;a.closePath(),a.stroke(),a.restore(),g=1,a.beginPath(),a.strokeStyle=this._lineColor;for(var j=b+d;b+e>j;j+=d)g%10===0&&(i=1,a.moveTo(h,j),a.lineTo(i,j)),g++;a.stroke(),a.restore(),a.save(),a.textBaseline="middle",a.textAlign="left",a.font="11px Arial",a.fillStyle=this._lineColor;for(var k=c,l=b;b+e>l;l+=10*d,k+=10*this._defaultGap){a.save();var m=_twaver.g.getTextSize(a.font,k),n={x:2,y:l-8,width:m.width,height:m.height};a.translate(n.x,n.y),a.rotate(3*Math.PI/2),a.translate(-n.x,-n.y),a.fillText(k,0,l-2),a.restore()}a.restore(),this._showGuides&&this._mousePoint&&(a.save(),a.strokeStyle="#f07819",a.lineWidth=3,a.beginPath(),a.moveTo(0,this._mousePoint.y),a.lineTo(20,this._mousePoint.y),a.stroke(),a.restore())},getComponentZoom:function(){return this.component.getZoom()||1},getGap:function(){var a=this.getComponentZoom();return this._defaultGap*a},calculateGap:function(a){.17>a?this._defaultGap=50:.5>a?this._defaultGap=20:.9>a?this._defaultGap=10:3.2>a?this._defaultGap=5:this._defaultGap=1},setShowGuides:function(a){this._showGuides;this._showGuides=a,this._drawRuler()},isShowGuides:function(){return this._showGuides},setShowRuler:function(a){var b=this._topRuler.visible;this._topRuler.visible=a,this._leftRuler.visible=a,a?(this.hasChildNode(this._view,this._topRuler)||this._view.appendChild(this._topRuler),this.hasChildNode(this._view,this._leftRuler)||this._view.appendChild(this._leftRuler)):(this.hasChildNode(this._view,this._topRuler)&&this._view.removeChild(this._topRuler),this.hasChildNode(this._view,this._leftRuler)&&this._view.removeChild(this._leftRuler)),this.firePropertyChange("showRuler",b,a)},hasChildNode:function(a,b){var c=a.childNodes;for(var d in c)if(c[d]==b)return!0;return!1},getComponentViewRect:function(){return this.component.getViewRect?this.component.getViewRect():null},addViewPropertyChangeListener:function(a,b){a&&a.addPropertyChangeListener&&a.addPropertyChangeListener(b,this)},_handleViewPropertyChange:function(a){"viewRect"==a.property&&this._drawRuler()},createElement:function(a){return document.createElement(a)},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=0,d=0,e=0,f=0,h=0,i=0,j=a,k=b;this._topRuler.visible&&(c=this._rulerWidth,f=this._rulerWidth,i=this._rulerWidth),this._leftRuler.visible&&(d=this._rulerWidth,e=this._rulerWidth,h=this._rulerWidth),j=a-d,k=b-c,this._topRuler.visible&&(this._topRuler.width=j,this._topRuler.height=c,_twaver.setViewBounds(this._topRuler,{x:e,y:0,width:j,height:c}),g.transformAndScaleCanvasContext(this._topRuler,!0)),this._leftRuler.visible&&(this._leftRuler.width=d,this._leftRuler.height=k,_twaver.setViewBounds(this._leftRuler,{x:0,y:f,width:d,height:k}),g.transformAndScaleCanvasContext(this._leftRuler,!0)),this.component&&(_twaver.setViewBounds(this.component,{x:h,y:i,width:j,height:k}),g.transformAndScaleCanvasContext(this.component._rootCanvas,!0)),this._drawRuler()},getView:function(){return this._view},left:function(a){this._view.style.left=a+"px",this.invalidate()}});var n=function(a){n.superClass.constructor.call(this,a),this.currentItem=null,this.pasteOffsetDz=0,this.parentNode=null,this.model3dTo2dMapping=j.deviceEditorModel3dTo2dMapping,this.model2dTo3dMapping=j.deviceEditorModel2dTo3dMapping,this.lastSelectedChildNode=null,this._editable=!1,this.isAddChildNode=!1,this.PANEL_CATEGORY="",this.init()};n.prototype={init:function(){var a=this;this.accordionPane=new c.AccordionPane,this.network2dView=this._initNetwork2d(),this.network2d.setMaxZoom(40);var b=this.sheet=new twaver.controls.PropertySheet(this.box);g.initPropertySheet(b);var d=this.propertySheetBox.width(),e=this.propertySheetBox.height();b.adjustBounds({x:0,y:0,width:d,height:e}),this.propertySheetBox.append(this.sheet.getView()),this.accordionPaneBox.append(this.accordionPane.getView()),this.networkBox.append(this.network2dView),$(this.network2dView).on("dblclick",function(b){a.network2d.setDefaultInteractions()}),this.refreshAccordion()},_initNetwork2d:function(){var a=this,b=this.network2d=new d.edit.GridNetwork;this.network2d.setPositionMagneticEnabled(!1);var c=this.box,c=this.box=this.network2d.getElementBox(),e=this.selectionModel=this.box.getSelectionModel();e.addSelectionChangeListener(function(b){var c=e.getLastData();a._resetPropertySheet(),a.lastSelectedChildNode=null,c&&!a.isHost(c)&&(a.lastSelectedChildNode=c),a.parentNode&&(a.setSuspended(!0),a.network2d.isSelected(a.parentNode)?a.parentNode.setStyle("whole.alpha",1):e.size()>0?a.parentNode.setStyle("whole.alpha",.3):a.parentNode.setStyle("whole.alpha",1),a.setSuspended(!1))}),e.setFilterFunction(function(b){return a.isEditable(b)});var f=c.getLayerBox(),g=this.parentLayer=new twaver.Layer("parentLayer"),h=this.childrenLayer=new twaver.Layer("childrenLayer");f.add(g),f.add(h),f.moveToTop(g);var i=this.network2d.getView();l.setDropTarget(i,{self:this,dropEffect:"copy",ondrop:function(d,e){e=JSON.parse(e);var f=e.id;if(!a.onDropHandler||!a.onDropHandler(d,e,c,b)){var g=make.Default.getOtherParameter(f,"category");if(g==a.PANEL_CATEGORY)return a._chassisId=f,void a.setData(make.Default.load(f));if(!a.parentNode)return void alert("");var h,i=a.network2d.getElementAt(d);if(i&&i.getClient("slot")&&(h=i.getClient("bid")),h){var j=a.loadCard(f,{client:{loc:h}});j&&(a.selectionModel.clearSelection(),a.selectionModel.setSelection(j),a._resetPropertySheet())}}},ondragover:function(a){},ondragleave:function(a){}}),b.addInteractionListener(function(c){if("doubleClickElement"===c.kind,"liveMoveStart"===c.kind&&(a._card=b.getSelectionModel().getLastData(),a.setSuspended(!0),a._card.setStyle("whole.alpha",.3)),"liveMoveBetween"===c.kind,"liveMoveEnd"===c.kind){var d,e=b.getElementsAt(c),d=null;e&&e.forEach(function(a){a.getClient("slot")&&!a.getClient("follower")&&(d=a)}),a._card.setStyle("whole.alpha",1),d?(a._card.setLocation(a._card.getHost().getLocation()),a.setSuspended(!1),a.startBatch(),a._card.getHost().setClient("follower",null),a._card.setSize(d.getSize()),a._card.setLocation(d.getLocation()),a._card.setClient("loc",d.getClient("bid")),d.setClient("follower",a._card),a._card.setHost(d),a.endBatch()):(d=a._card.getHost(),a._card.setLocation(d.getLocation()),a.setSuspended(!1)),a._card=null}});var j=this.ruler=new d.edit.Ruler(this.network2d);j.getView().setAttribute("class","room-ruler"),j.setShowGuides(!1),j.setShowRuler(!0);var k=$(j.getView());return k},onDropHandler:function(a,b,c,d){},getEditId:function(a){return g.getDeviceEditorModel2dId(a)},isEditable:function(a){return a.getClient("card")},isHost:function(a){return!!a.getClient("host")},isResizeable:function(a){return!!a.getClient("resizeable");
},loadCards:function(a){var b=[],c=this;if(a instanceof Array)a.forEach(function(a){var d=c.loadCard(a.id,a);b.push(d)});else{var d=c.loadCard(a.id,a);b.push(d)}return b},loadChild:function(a,b){this.parentNode||console.warn("parentNode is null");var d=this;a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id();var e=make.Default.load(b);if(e instanceof Array){var f=e;f.forEach(function(a){a.setLayerId(d.childrenLayer.getId()),d.parentNode&&a.setHost(d.parentNode),d.box.add(a)})}else{var g=e;g.setLayerId(d.childrenLayer.getId()),d.parentNode&&g.setHost(d.parentNode),d.box.add(g)}return e},loadCard:function(a,b){var d=this;a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id();var e=make.Default.load(b);e.setLayerId(d.childrenLayer.getId());var f;return d.box.forEach(function(a){a.getClient("slot")&&a.getClient("bid")===b.client.loc&&(f=a)}),f?(e.setSize(f.getSize()),e.setLocation(f.getLocation()),d.startBatch(),d.box.add(e),f.setClient("follower",e),e.setHost(f),d.endBatch(),e):void alert("no slot: "+b.client.loc)},loadParent:function(a,b){a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id();var d=make.Default.load(b);return d.setLayerId(this.parentLayer.getId()),d.setLocation(0,0),d.setMovable(!1),this.parentNode=d,this.box.add(d),d},setData:function(a){var b=this;this.clear(),this.startBatch();for(var c=0;c<a.length;c++){var d=a[c];0==c&&make.Default.getOtherParameter(d.id,"host")?b.loadParent(d.id,d):b.loadChild(d.id,d)}this.endBatch()},clear:function(){this.box.clear(),this.network2d.getElementBox().getUndoManager().clear()},_resetPropertySheet:function(){if(this.isPropertySheetVisible()){var a=this,b=a.sheet.getPropertyBox();b.clear();var c=this.box.getSelectionModel();if(1!=c.size())b.clear(),this.propertySheetBox.hide();else{this.propertySheetBox.show();var d=c.getLastData();g.addProperties(b,make.Default.getModelDefaultParameterProperties(make.Default.getId(d))),a.resetPropertySheetBoxSize(this.sheet)}}},zoomOverview:function(){this.network2d.zoomOverview()},setMouseEditable:function(a){var b=this._editable;b!=a&&(this._editable=a,this._editable?this.network2d.setInteractions([new twaver.vector.interaction.DefaultInteraction(this.network2d),new twaver.vector.interaction.EditInteraction(this.network2d)]):this.network2d.setInteractions([new twaver.vector.interaction.DefaultInteraction(this.network2d)]))},setDragToPan:function(a){this.network2d.setDragToPan(a)},getData:function(){var a=[];return this.box.forEach(function(b){if(b.getClient("card")){var c=make.Default.toJson(b);a.push(c)}}),a},appendData:function(a){this.loadChildren(a)},removeData:function(a){var b=this;return a instanceof Array?a.map(function(a){return b.box.removeById(a.objectId)}):b.box.removeById(a.objectId)},getSelectedData:function(){var a=this,b=[],c=this.selectionModel.getSelection().toList();return c&&c.size()>0&&c.forEach(function(c){if(!a.isHost(c)){var d=make.Default.toJson(c);b.push(d)}}),b},refreshAccordion:function(a){a=a||c.utils.load2dChassisCategory(),this.accordionPane.setCategories(a)}},c.ChassisEditor=n,c.utils.ext(n,m);var o=function(a){o.superClass.constructor.call(this,a),this.currentItem=null,this.pasteOffsetDz=0,this.parentNode=null,this.model3dTo2dMapping=j.deviceEditorModel3dTo2dMapping,this.model2dTo3dMapping=j.deviceEditorModel2dTo3dMapping,this.copyChildNode=null,this.lastSelectedChildNode=null,this._editable=!1,this.isAddChildNode=!1,this.KEY_CODE_COPY_ONE=81,this.PANEL_CATEGORY="",this.init()};o.prototype={init:function(){var a=this;this.accordionPane=new c.AccordionPane,this.network2dView=this._initNetwork2d(),this.network2d.setMaxZoom(40);var b=this.sheet=new twaver.controls.PropertySheet(this.box);g.initPropertySheet(b);var d=this.propertySheetBox.width(),e=this.propertySheetBox.height();b.adjustBounds({x:0,y:0,width:d,height:e}),this.propertySheetBox.append(this.sheet.getView()),this.accordionPaneBox.append(this.accordionPane.getView()),this.networkBox.append(this.network2dView),this.copyChildNode=this._createCopyChildNode(),this.addKeyMoveListener(this.network2d),$(this.network2dView).on("mousemove",function(b){if(a.copyChildNode){var c=a.network2d.getLogicalPoint(b);a.copyChildNode.setCenterLocation(c)}}),$(document).on("keyup",function(b){b.keyCode==a.KEY_CODE_COPY_ONE&&a.box.contains(a.copyChildNode)&&a.box.remove(a.copyChildNode)}),$(this.network2dView).on("keydown",function(b){if(32==b.keyCode){var c=a.box.getSelectionModel().getLastData();if(!c)return;var d=c.getAngle();c.setAngle(d+90)}else if(b.keyCode==a.KEY_CODE_COPY_ONE&&a.lastSelectedChildNode&&!a.box.contains(a.copyChildNode)){var e=a.lastSelectedChildNode.getSize(),d=a.lastSelectedChildNode.getAngle();a.copyChildNode.setSize(e),a.copyChildNode.setAngle(d),a.copyChildNode.setClient("id",a.lastSelectedChildNode.getClient("id")),a.box.add(a.copyChildNode)}else 8==b.keyCode&&b.preventDefault()}),$(this.network2dView).on("dblclick",function(b){a.network2d.setDefaultInteractions()}),$(this.network2dView).on("click",function(b){if(a.box.contains(a.copyChildNode)){var c=a.copyChildNode.getClient("id"),d=a.network2d.getLogicalPoint(b),e=a.copyChildNode.getSize(),f=a.copyChildNode.getAngle(),g=[d.x,d.y,0];g[0]-=e.width/2,g[1]-=e.height/2;var h={position:g,rotation:[0,0,f],width:e.width,height:e.height};return a.loadChild(c,h),b.preventDefault(),!1}}),this.setUndoManagerEnabled(!0),this.refreshAccordion()},_initNetwork2d:function(){var a=this,b=this.network2d=new d.edit.GridNetwork;this.network2d.setPositionMagneticX(5),this.network2d.setPositionMagneticY(5),this.network2d.setEditableFunction(function(b){return!a.isHost(b)&&a.copyChildNode!=b||a.isResizeable(b)});var c=this.box;this.network2d.getView().addEventListener("keydown",function(b){var d=!1,e=a.network2d.getPositionMagneticX(),f=a.network2d.getPositionMagneticY();37==b.keyCode&&(g.moveSelectionElements(c,"left",e,f),d=!0),38==b.keyCode&&(g.moveSelectionElements(c,"top",e,f),d=!0),39==b.keyCode&&(g.moveSelectionElements(c,"right",e,f),d=!0),40==b.keyCode&&(g.moveSelectionElements(c,"bottom",e,f),d=!0),d&&(b.preventDefault(),b.stopPropagation())});var c=this.box=this.network2d.getElementBox(),e=this.packQuickFinder=new twaver.QuickFinder(this.box,"pack","client"),f=this.selectionModel=this.box.getSelectionModel();f.addSelectionChangeListener(function(b){var c=f.getLastData();clearTimeout(a.selectionChangeHandleTimer),a.selectionChangeHandleTimer=setTimeout(function(){a._resetPropertySheet(),a.lastSelectedChildNode=null,c&&!a.isHost(c)&&(a.lastSelectedChildNode=c),a.parentNode&&(a.network2d.isSelected(a.parentNode)?a.parentNode.setStyle("whole.alpha",1):f.size()>0?a.parentNode.setStyle("whole.alpha",.3):a.parentNode.setStyle("whole.alpha",1))},100);var d=f.getSelection();if(d&&0!=d.size()){var g=c.getClient("pack");if(g){var h=e.find(g);if(d)for(var i=0;i<d.size();i++){var j=d.get(i);h.contains(j)||(f.removeSelection(j),i--)}h.forEach(function(a){f.contains(a)||f.appendSelection(a)},this)}}}),f.setFilterFunction(function(b){return a.isEditable(b)});var h=c.getLayerBox(),i=this.parentLayer=new twaver.Layer("parentLayer"),j=this.childrenLayer=new twaver.Layer("childrenLayer");h.add(i),h.add(j),h.moveToTop(i);var k=this.network2d.getView();l.setDropTarget(k,{self:this,dropEffect:"copy",ondrop:function(d,e){e=JSON.parse(e);var f=e.id;if(a.startBatch(),a.onDropHandler&&a.onDropHandler(d,e,c,b))return void a.endBatch();var g=make.Default.getOtherParameter(f,"category");if(g==a.PANEL_CATEGORY||""==g)return a.setData(make.Default.load(f)),void a.endBatch();var h=a.network2d.getLogicalPoint(d),i=make.Default.getOtherParameter(a.getEditId(f),"host"),j={position:[h.x,h.y,0],centerLocation:{x:h.x,y:h.y}},k=null;i?(k=a.loadParent(f,j),setTimeout(function(){a.network2d.zoomOverview()},100)):k=a.loadChild(f,j),k&&(a.selectionModel.clearSelection(),a.selectionModel.setSelection(k),a._resetPropertySheet()),a.endBatch()},ondragover:function(a){},ondragleave:function(a){}});var m=this.ruler=new d.edit.Ruler(this.network2d);m.getView().setAttribute("class","room-ruler"),m.setShowGuides(!1),m.setShowRuler(!0);var n=$(m.getView());return n},onDropHandler:function(a,b,c,d){},getEditId:function(a){return g.getDeviceEditorModel2dId(a)},isEditable:function(a){return a.getClient("editable")===!0?!0:!this.isHost(a)},isHost:function(a){return!!a.getClient("host")},isResizeable:function(a){return!!a.getClient("resizeable")},_createCopyChildNode:function(){var a=new twaver.Node;return a.setLayerId(this.childrenLayer.getId()),a.setStyle("body.type","vector"),a.setStyle("vector.shape","rectangle"),a.setStyle("vector.fill",!1),a.setStyle("vector.outline.width",2),a.setStyle("vector.outline.color","#a0a819"),a},loadChildren:function(a){var b=[],c=this,d=[];if(a instanceof Array)a.forEach(function(a){if(make.Default.getOtherParameter(a.id,"link"))d.push(a);else{var e=c.loadChild(a.id,a);b.push(e)}}),d.forEach(function(a){var d=c.loadChild(a.id,a);b.push(d)});else{var e=c.loadChild(a.id,a);b.push(e)}return b},loadChild:function(a,b){this.parentNode||console.warn("parentNode is null");var d=this;a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id();var e=make.Default.load(b);if(make.Default.getOtherParameter(b.id,"link")){var f=e;f.setFromNode(d.findByBID(b.from)),f.setToNode(d.findByBID(b.to)),d.box.add(f)}else if(e instanceof Array){var g=e;g.forEach(function(a){a.setLayerId(d.childrenLayer.getId()),d.parentNode&&a.setHost(d.parentNode),d.box.add(a)})}else{var h=e;h.setLayerId(d.childrenLayer.getId()),d.parentNode&&h.setHost(d.parentNode),d.box.add(h)}return e},loadParent:function(a,b){a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id(),this.box.clear();var d=make.Default.load(b);return d.setLayerId(this.parentLayer.getId()),d.setLocation(0,0),d.setMovable(!1),this.parentNode=d,this.startBatch(),this.box.add(d),this.endBatch(),d},setData:function(a){for(var b=this,c=[],d=0;d<a.length;d++){var e=a[d];make.Default.getOtherParameter(e.id,"link")?c.push(e):0==d&&make.Default.getOtherParameter(e.id,"host")?b.loadParent(e.id,e):b.loadChild(e.id,e)}c.forEach(function(a){b.loadChild(a.id,a)})},clear:function(){this.box.clear()},_resetPropertySheet:function(){if(this.isPropertySheetVisible()){var a=this,b=a.sheet.getPropertyBox();b.clear();var c=this.box.getSelectionModel();if(1!=c.size())b.clear(),this.propertySheetBox.hide();else{this.propertySheetBox.show();var d=c.getLastData();g.addProperties(b,make.Default.getModelDefaultParameterProperties(make.Default.getId(d))),a.resetPropertySheetBoxSize(this.sheet)}}},align:function(a){var b=this;if(a){var c=this.selectionModel.getSelection(),d=new twaver.List;c.forEach(function(a){a&&!b.isHost(a)&&d.add(a)}),!d||d.size()<2||make.Default.align(d,a)}},flow:function(a,b){var c=this;if(a){var d=this.selectionModel.getSelection(),e=new twaver.List;d.forEach(function(a){a&&!c.isHost(a)&&e.add(a)}),!e||e.size()<2||make.Default.flow(e,a,b)}},zoomOverview:function(){this.network2d.zoomOverview()},setMouseEditable:function(a){var b=this._editable;b!=a&&(this._editable=a,this._editable?this.network2d.setInteractions([new twaver.vector.interaction.DefaultInteraction(this.network2d),new twaver.vector.interaction.EditInteraction(this.network2d)]):this.network2d.setInteractions([new twaver.vector.interaction.DefaultInteraction(this.network2d)]))},setDragToPan:function(a){this.network2d.setDragToPan(a)},getData:function(){var a=[],b=this;return this.box.forEach(function(c){if(c==b.parentNode){var d=make.Default.toJson(c);a.splice(0,0,d)}else{var d=make.Default.toJson(c);a.push(d)}}),a},appendData:function(a){this.loadChildren(a)},removeData:function(a){var b=this;return a instanceof Array?a.map(function(a){return b.box.removeById(a.objectId)}):b.box.removeById(a.objectId)},getSelectedData:function(){var a=this,b=[],c=this.selectionModel.getSelection().toList();return c&&c.size()>0&&c.forEach(function(c){if(!a.isHost(c)){var d=make.Default.toJson(c,function(a){return a.objectId=c.getId(),a});b.push(d)}}),b},refreshAccordion:function(a){a=a||c.utils.load2dDeviceCategory(),this.accordionPane.setCategories(a)}},c.DeviceEditor=o,c.utils.ext(o,m),CircuitCreateLinkInteraction=function(a,b){CircuitCreateLinkInteraction.superClass.constructor.call(this,a,b)},twaver.Util.ext("CircuitCreateLinkInteraction",twaver.vector.interaction.CreateLinkInteraction,{paint:function(a){a.beginPath();a.lineWidth=this.network.getEditLineWidth(),this.currentPoint&&this.paintLine(a),a.closePath()},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.fromNode.hotPoint.x,d=this.fromNode.hotPoint.y,e=this.currentPoint.x,f=this.currentPoint.y,g=this.network.getViewRect();isFoleLink?(a.strokeStyle=b,a.beginPath(),a.moveTo(c-g.x,d-g.y),a.lineTo(e,d-g.y),a.lineTo(e,f),a.stroke()):(a.strokeStyle=b,a.beginPath(),a.moveTo(c-g.x,d-g.y),a.lineTo(e,f),a.stroke())},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null,this.lastNode=null},handle_mousedown:function(a){if(this.network.isValidEvent(a)){if(this.fromNode){if(this.toNode=this.currentNode,this.toNode instanceof twaver.HorizontalLine){var b=this.createLink(),c=this.toNode.getClient("IntersectionPointOffset")||0;b.s("link.to.percent",[c,0]),b&&this.network.addElementByInteraction(b),this.lastNode.setClient("IntersectionPoint",null)}else if(this.toNode instanceof twaver.VerticalLine){var b=this.createLink(),c=this.toNode.getClient("IntersectionPointOffset")||0;b.s("link.to.percent",[0,c]),b&&this.network.addElementByInteraction(b),this.lastNode.setClient("IntersectionPoint",null)}else if(this.toNode instanceof twaver.Node){var d=this.network.getElementUI(this.toNode);if(!d)return;var e=d._hotPoint1,f=d._hotPoint2;if(!e||!f)return;var g=this.network.getLogicalPoint2(a);Math.pow(g.x-e.x,2)+Math.pow(g.y-e.y,2)<Math.pow(g.x-f.x,2)+Math.pow(g.y-f.y,2)?this.toNode.hotPoint=e:this.toNode.hotPoint=f;var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else{this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint();var d=this.network.getElementUI(this.fromNode);if(!d)return;var e=d._hotPoint1,f=d._hotPoint2;if(!e||!f)return;var g=this.network.getLogicalPoint2(a);Math.pow(g.x-e.x,2)+Math.pow(g.y-e.y,2)<Math.pow(g.x-f.x,2)+Math.pow(g.y-f.y,2)?this.fromNode.hotPoint=e:this.fromNode.hotPoint=f}if(this.lastNode){var h=this.lastNode;h.setClient("drawIntersectionPoint1",!1),h.setClient("drawIntersectionPoint2",!1),h.setClient("IntersectionPoint",null)}}},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;if(this.fromNode){if(this.currentNode=this.getToNode(a,this.fromNode),this.currentPoint=b,this.repaint(),this.currentNode instanceof twaver.HorizontalLine){var d=this.currentNode.getPoints();if(2!==d.size())return;var e=this.network.getLogicalPoint2(a),f=this.currentNode.getLineLength(),g=Math.abs(e.x-d.get(0).x)/f;this.currentNode.setClient("IntersectionPointOffset",g),Math.abs(g)>0&&Math.abs(g)<1&&(g*=f);var h={x:d.get(0).x+g,y:d.get(0).y};this.currentNode.setClient("IntersectionPoint",h),this.lastNode=this.currentNode,this.currentNode.hotPoint=h}else if(this.currentNode instanceof twaver.VerticalLine){var d=this.currentNode.getPoints();if(2!==d.size())return;var e=this.network.getLogicalPoint2(a),f=this.currentNode.getLineLength(),i=Math.abs(e.y-d.get(0).y)/f;this.currentNode.setClient("IntersectionPointOffset",i),Math.abs(i)>0&&Math.abs(i)<1&&(i*=f);var h={x:d.get(0).x,y:d.get(0).y+i};this.currentNode.setClient("IntersectionPoint",h),this.lastNode=this.currentNode,this.currentNode.hotPoint=h}else if(this.currentNode instanceof twaver.Node){if(!this.currentNode.getClient("connectable"))return;var j=this.network.getElementUI(this.currentNode),k=j._hotPoint1,l=j._hotPoint2;if(this.lastNode=this.currentNode,!k||!l)return;var e=this.network.getLogicalPoint2(a);Math.pow(e.x-k.x,2)+Math.pow(e.y-k.y,2)<Math.pow(e.x-l.x,2)+Math.pow(e.y-l.y,2)?this.currentNode.setClient("drawIntersectionPoint1",!0):this.currentNode.setClient("drawIntersectionPoint2",!0)}else if(this.lastNode){var m=this.lastNode;m.setClient("drawIntersectionPoint1",!1),m.setClient("drawIntersectionPoint2",!1),m.setClient("IntersectionPoint",null)}}else if(c=this.getFromNode(a),this.currentNode!==c)if(this.currentNode=c,c instanceof twaver.Node){if(this.lastNode=c,!c.getClient("connectable"))return;var j=this.network.getElementUI(c),k=j._hotPoint1,l=j._hotPoint2;if(!k||!l)return;var e=this.network.getLogicalPoint2(a);Math.pow(e.x-k.x,2)+Math.pow(e.y-k.y,2)<Math.pow(e.x-l.x,2)+Math.pow(e.y-l.y,2)?c.setClient("drawIntersectionPoint1",!0):c.setClient("drawIntersectionPoint2",!0)}else if(this.lastNode){var m=this.lastNode;m.setClient("drawIntersectionPoint1",!1),m.setClient("drawIntersectionPoint2",!1)}}},getNode:function(a,b){var c=this.network.getElementAt(a);return c instanceof twaver.Node&&this.network.isLinkable(c,b)&&this.network.getElementBox().getSelectionModel().isSelectable(c)?c:null}}),CircuitCreatePolyLineInteraction=function(a,b){CircuitCreatePolyLineInteraction.superClass.constructor.call(this,a,b)},twaver.Util.ext("CircuitCreatePolyLineInteraction",twaver.vector.interaction.CreateShapeNodeInteraction,{handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint2(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new twaver.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return;Math.abs(b.x-e.x)>=Math.abs(b.y-e.y)?b.y=e.y:b.x=e.x}this.points.add(b)}this.timeStamp=a.timeStamp,this.repaint()}}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint2(a),this.repaint())}});var p=function(a){p.superClass.constructor.call(this,a),this.currentItem=null,this.parentNode=null,this.model3dTo2dMapping=j.circuitEditorModel3dTo2dMapping,this.model2dTo3dMapping=j.circuitEditorModel2dTo3dMapping,this.copyChildNode=null,this.lastSelectedChildNode=null,this._editable=!1,this.isAddChildNode=!1,this.KEY_CODE_COPY_ONE=0,this.PANEL_CATEGORY="",this.init()};p.prototype={init:function(){var a=this;this.accordionPane=new c.AccordionPane,this.network2dView=this._initNetwork2d(),this.network2d.setMaxZoom(40);var b=this.sheet=new twaver.controls.PropertySheet(this.box);g.initPropertySheet(b);var d=this.propertySheetBox.width(),e=this.propertySheetBox.height();b.adjustBounds({x:0,y:0,width:d,height:e}),this.propertySheetBox.append(this.sheet.getView()),this.accordionPaneBox.append(this.accordionPane.getView()),this.networkBox.append(this.network2dView),this.copyChildNode=this._createCopyChildNode(),$(this.network2dView).on("mousemove",function(b){if(a.copyChildNode){var c=a.network2d.getLogicalPoint(b);a.copyChildNode.setCenterLocation(c)}}),$(document).on("keyup",function(b){b.keyCode==a.KEY_CODE_COPY_ONE&&a.box.contains(a.copyChildNode)&&a.box.remove(a.copyChildNode)}),$(this.network2dView).on("keydown",function(b){if(32==b.keyCode){var c=a.box.getSelectionModel().getLastData();if(!c)return;var d=c.getAngle();c.setAngle(d+90)}else if(b.keyCode==a.KEY_CODE_COPY_ONE&&a.lastSelectedChildNode&&!a.box.contains(a.copyChildNode)){var e=a.lastSelectedChildNode.getSize(),d=a.lastSelectedChildNode.getAngle();a.copyChildNode.setSize(e),a.copyChildNode.setAngle(d),a.copyChildNode.setClient("id",a.lastSelectedChildNode.getClient("id")),a.box.add(a.copyChildNode)}else 8==b.keyCode&&b.preventDefault()}),$(this.network2dView).on("dblclick",function(b){a.network2d.setDefaultInteractions()}),$(this.network2dView).on("click",function(b){if(a.box.contains(a.copyChildNode)){var c=a.copyChildNode.getClient("id"),d=a.network2d.getLogicalPoint(b),e=a.copyChildNode.getSize(),f=a.copyChildNode.getAngle(),g={centerLocation:{x:d.x,y:d.y},width:e.width,height:e.height,angle:f};return a.loadChild(c,g),b.preventDefault(),!1}}),this.refreshAccordion()},_initNetwork2d:function(){var a=this,b=this.network2d=new d.edit.GridNetwork;this.network2d.setPositionMagneticX(5),this.network2d.setPositionMagneticY(5),this.network2d.setWheelToZoom(!1),this.network2d.setPositionMagneticEnabled(!1),this.network2d.setEditableFunction(function(b){return!a.isHost(b)&&a.copyChildNode!=b||a.isResizeable(b)});var c=this.box=this.network2d.getElementBox(),e=this.selectionModel=this.box.getSelectionModel();e.addSelectionChangeListener(function(b){clearTimeout(a.selectionChangeHandleTimer),a.selectionChangeHandleTimer=setTimeout(function(){a._resetPropertySheet(),a.lastSelectedChildNode=null;var b=e.getLastData();b&&!a.isHost(b)&&(a.lastSelectedChildNode=b),a.parentNode&&(a.network2d.isSelected(a.parentNode)?a.parentNode.setStyle("whole.alpha",1):e.size()>0?a.parentNode.setStyle("whole.alpha",.3):a.parentNode.setStyle("whole.alpha",1)),a.network2d.invalidate()},100)}),e.setFilterFunction(function(b){return a.isEditable(b)});var f=c.getLayerBox(),g=this.parentLayer=new twaver.Layer("parentLayer"),h=this.childrenLayer=new twaver.Layer("childrenLayer");f.add(g),f.add(h),f.moveToTop(g);var i=this.network2d.getView();l.setDropTarget(i,{self:this,dropEffect:"copy",ondrop:function(d,e){e=JSON.parse(e);var f=e.id;if(!a.onDropHandler||!a.onDropHandler(d,e,c,b)){var g=make.Default.getOtherParameter(f,"category");if(g==a.PANEL_CATEGORY)return void a.setData(make.Default.load(f));var h=a.network2d.getLogicalPoint(d),i=make.Default.getOtherParameter(a.getEditId(f),"host"),j={centerLocation:{x:h.x,y:h.y}},k=null;i?(k=a.loadParent(f,j),setTimeout(function(){a.network2d.zoomOverview()},100)):k=a.loadChild(f,j),k&&(a.selectionModel.clearSelection(),a.selectionModel.setSelection(k),a._resetPropertySheet())}},ondragover:function(a){},ondragleave:function(a){}});var j=this.ruler=new d.edit.Ruler(this.network2d);j.getView().setAttribute("class","room-ruler"),j.setShowGuides(!1),j.setShowRuler(!0);var k=$(j.getView());return k},onDropHandler:function(a,b,c,d){var e=b.id,f=make.Default.getOtherParameter(e,"interaction");if("createPolyLink"===f)d.setInteractions([new CircuitCreatePolyLineInteraction(d,function(a){var b=make.Default.load(e);return b.setPoints(a),b}),new twaver.vector.interaction.DefaultInteraction(d)]);else if("createLink"==f)return isFoleLink=!1,d.setInteractions([new CircuitCreateLinkInteraction(d,function(a,b){var c,d=a.getCenterLocation(),f=b.getCenterLocation(),g="arc";if(b instanceof twaver.HorizontalLine){if(a.hotPoint)if(a.hotPoint.x>d.x)c=[1,.5];else if(a.hotPoint.x<d.x)c=[0,.5];else if(a.hotPoint.y>d.y){c=[.5,1];var h={x:a.hotPoint.x,y:a.hotPoint.y+30}}else{c=[.5,0];var h={x:a.hotPoint.x,y:a.hotPoint.y-30}}else c=[.5,.5];var i=make.Default.load({id:e,style:{"link.from.percent":c,"link.bundle.enable":!1,"link.type":"arc","link.corner":"none"},client:{"link.type":"HorizontalLine",fromControlPoint:h}});return i.setFromNode(a),i.setToNode(b),i}if(b instanceof twaver.VerticalLine){c=a.hotPoint?a.hotPoint.x>d.x?[1,.5]:a.hotPoint.x<d.x?[0,.5]:a.hotPoint.y>d.y?[.5,1]:[.5,0]:[.5,.5];var i=make.Default.load({id:e,style:{"link.from.percent":c,"link.bundle.enable":!1,"link.type":"arc","link.corner":"none"},client:{"link.type":"VerticalLine"}});return i.setFromNode(a),i.setToNode(b),i}if(a.hotPoint&&b.hotPoint){a.hotPoint.x>d.x&&b.hotPoint.x<f.x?g="orthogonal.horizontal":a.hotPoint.x>d.x&&b.hotPoint.x>f.x?g="extend.right":a.hotPoint.x>d.x?g="orthogonal.H.V":a.hotPoint.x<d.x&&b.hotPoint.x<f.x?g="extend.left":a.hotPoint.x<d.x&&b.hotPoint.x>f.x?g="orthogonal.horizontal":a.hotPoint.x<d.x?g="orthogonal.H.V":a.hotPoint.y>d.y&&b.hotPoint.y<f.y?g="orthogonal.vertical":a.hotPoint.y>d.y&&b.hotPoint.y>f.y?g="extend.bottom":a.hotPoint.y>d.y?g="orthogonal.V.H":a.hotPoint.y<d.y&&b.hotPoint.y<f.y?g="extend.top":a.hotPoint.y<d.y&&b.hotPoint.y>f.y?g="orthogonal.vertical":a.hotPoint.y<d.y&&(g="orthogonal.V.H");var i=make.Default.load({id:e,style:{"link.type":g,"link.corner":"none"}});return i.setFromNode(a),i.setToNode(b),i}}),new twaver.vector.interaction.DefaultInteraction(d)]),!0},getEditId:function(a){return g.getDeviceEditorModel2dId(a)},isEditable:function(a){return a.getClient("editable")===!0?!0:!this.isHost(a)},isHost:function(a){return!!a.getClient("host")},isResizeable:function(a){return!!a.getClient("resizeable")},_createCopyChildNode:function(){var a=new twaver.Node;return a.setLayerId(this.childrenLayer.getId()),a.setStyle("body.type","vector"),a.setStyle("vector.shape","rectangle"),a.setStyle("vector.fill",!1),a.setStyle("vector.outline.width",2),a.setStyle("vector.outline.color","#a0a819"),a},loadChildren:function(a){var b=[],c=this,d=[];if(a instanceof Array)a.forEach(function(a){if(make.Default.getOtherParameter(a.id,"link"))d.push(a);else{var e=c.loadChild(a.id,a);b.push(e)}}),d.forEach(function(a){var d=c.loadChild(a.id,a);b.push(d)});else{var e=c.loadChild(a.id,a);b.push(e)}return b},loadChild:function(a,b){this.parentNode||console.warn("parentNode is null");var d=this;a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id();var e=make.Default.load(b);if(make.Default.getOtherParameter(b.id,"link")){var f=e;f.setFromNode(d.findByBID(b.from)),f.setToNode(d.findByBID(b.to)),d.box.add(f)}else if(e instanceof Array){var g=e;g.forEach(function(a){a.setLayerId(d.childrenLayer.getId()),d.parentNode&&a.setHost(d.parentNode),d.box.add(a)})}else{var h=e;h.setLayerId(d.childrenLayer.getId()),d.parentNode&&h.setHost(d.parentNode),d.box.add(h)}return h},loadParent:function(a,b){a=a.replace("."+j.DEVICE_MODEL_SUFFIX,""),b.id=this.getEditId(a),b.objectId=c.id(),this.box.clear();var d=make.Default.load(b);return d.setLayerId(this.parentLayer.getId()),this.box.add(d),d.setLocation(0,0),d.setMovable(!1),this.parentNode=d,d},setData:function(a){for(var b=this,c=[],d=0;d<a.length;d++){var e=a[d];make.Default.getOtherParameter(e.id,"link")?c.push(e):0==d&&make.Default.getOtherParameter(e.id,"host")?b.loadParent(e.id,e):b.loadChild(e.id,e)}c.forEach(function(a){b.loadChild(a.id,a)})},_resetPropertySheet:function(){if(this.isPropertySheetVisible()){var a=this,b=a.sheet.getPropertyBox();b.clear();var c=this.box.getSelectionModel();if(1!=c.size())b.clear(),this.propertySheetBox.hide();else{this.propertySheetBox.show();var d=c.getLastData();if(!make.Default.getId(d))return;g.addProperties(b,make.Default.getModelDefaultParameterProperties(make.Default.getId(d))),a.resetPropertySheetBoxSize(this.sheet)}}},align:function(a){var b=this;if(a){var c=this.selectionModel.getSelection(),d=new twaver.List;c.forEach(function(a){a&&!b.isHost(a)&&d.add(a)}),!d||d.size()<2||make.Default.align(d,a)}},flow:function(a,b){var c=this;if(a){var d=this.selectionModel.getSelection(),e=new twaver.List;d.forEach(function(a){a&&!c.isHost(a)&&e.add(a)}),!e||e.size()<2||make.Default.flow(e,a,b)}},zoomOverview:function(){this.network2d.zoomOverview()},setMouseEditable:function(a){var b=this._editable;b!=a&&(this._editable=a,this._editable?this.network2d.setInteractions([new twaver.vector.interaction.DefaultInteraction(this.network2d),new twaver.vector.interaction.EditInteraction(this.network2d)]):this.network2d.setInteractions([new twaver.vector.interaction.DefaultInteraction(this.network2d)]))},setDragToPan:function(a){this.network2d.setDragToPan(a)},getData:function(a){var b=[],c=null;this.parentNode&&(c=this.parentNode.getId());var d=this,e=0,f=0;return a&&(e=9999999999,f=9999999999,this.box.forEach(function(a){e=Math.min(e,a.getX()),f=Math.min(f,a.getY())})),this.box.forEach(function(a){if(a==d.parentNode){var g=make.Default.toJson(a,function(a){return a.x=a.x||0,a.y=a.y||0,a.x-=e,a.y-=f,a});b.splice(0,0,g)}else{var g=make.Default.toJson(a,function(a){return a.x-=e,a.y-=f,a.parentObjectId=c,a});b.push(g)}}),b},appendData:function(a){this.loadChildren(a)},removeData:function(a){var b=this;return a instanceof Array?a.map(function(a){return b.box.removeById(a.objectId)}):b.box.removeById(a.objectId)},getSelectedData:function(){var a=this,b=[],c=this.selectionModel.getSelection().toList();return c&&c.size()>0&&c.forEach(function(c){if(!a.isHost(c)){var d=make.Default.toJson(c,function(a){return a});b.push(d)}}),b},refreshAccordion:function(a){a=a||c.utils.load2dCircuitCategory(),this.accordionPane.setCategories(a)},pasteSelection:function(a){var b=this;return this._copyAnchor&&0!=this._copyAnchor.length?(a=a||this._getPasteOffset(),void this._copyAnchor.forEach(function(d){var e=g.clone(d);if(e.objectId=c.id(),e.position){var f=e.position;e.position=[f[0]+a.x,f[1]+a.y,f[2]+a.z]}if(e.location){var h=e.location;h instanceof Array?e.location=[f[0]+a.x,f[1]+a.z]:(e.location.x+=a.x,e.location.y+=a.z)}e.x&&(e.x+=a.x),e.y&&(e.y+=a.z),e.points&&e.points._as.forEach(function(b){b.x+=a.x,b.y+=a.z}),b.appendData(e)})):null}},c.CircuitEditor=p,c.utils.ext(p,m);var q=function(a){q.superClass.constructor.call(this,a),this.jsonObj=null,this._modelChangeDispatcher=new mono.EventDispatcher,this._modelPropertyChangeDispatcher=new mono.EventDispatcher,this._currentModel=null,this.refreshAccordion()};q.prototype={_init:function(){this.accordionPane=new c.AccordionPane,this.propertySheetPane=new d.edit.PropertySheetPane(this.box),this.network3dView=this._initNetwork3d(),this.accordionPaneBox.append(this.accordionPane.getView()),this.propertySheetBox.append(this.propertySheetPane.getView()),this.networkBox.append(this.network3dView),this.addPropertySheetListener(),this.adjustNetwork3dBoundingBox()},parentResizeHandle:function(){q.superClass.parentResizeHandle.call(this),this.invalidate()},addPropertySheetListener:function(){var a=this.propertySheetPane.box;a.addDataPropertyChangeListener(this._handleSheetPropertyChanged,this)},getJsonObject:function(){var a=this.propertySheetPane.getData();return a},setElement:function(a){this.propertySheetPane.setElement(a),this.isPropertySheetVisible()&&(this.propertySheetBox.show(),this.resetPropertySheetBoxSize(this.propertySheetPane.sheet))},importJsonObject:function(a){a.objectId=a.objectId||c.id();var b=this.network3d.getDataBox();b.clear();var d=make.Default.load(a);b.addByDescendant(d),this.setElement(a)},_handleSheetPropertyChanged:function(a){if(this.propertySheetPane._setValued){var b=this.propertySheetPane.getData(),c=make.Default.load(b);this.network3d.getDataBox().clear(),this.network3d.getDataBox().addByDescendant(c),this._currentModel=c,this.fireModelPropertyChange(c,a.property,a.oldValue,a.newValue)}},_initNetwork3d:function(){var a=this.network3d=new mono.Network3D,b=new mono.PerspectiveCamera(30,1.5,50,5e3);a.setCamera(b),a.setClearColor("#000000"),a.setClearAlpha(0),a.setBackgroundImage("./images/bg_network.jpg"),b.p(107,156,609),b.look(new mono.Vec3(0,0,0));var d=a.getDefaultInteraction();d.yLowerLimitAngle=Math.PI/180*2,d.yUpLimitAngle=Math.PI/2,d.maxDistance=1e3,d.minDistance=100,d.zoomSpeed=3,d.panSpeed=.2,a.setInteractions([d]);var e=this.box=a.getDataBox(),f=new mono.PointLight(16777215,.1);f.setPosition(1e3,1e3,1e3),e.add(f),e.add(new mono.AmbientLight("white")),a.getRootView().setAttribute("class","network3d-view");var g=this;return a.getRootView().addEventListener("dblclick",function(b){g._handleDoubleClick(b,a)}),l.setDropTarget(a.getRootView(),{self:this,ondrop:function(d,f){if(!g.onDropHandler||!g.onDropHandler(d,f,e,a)){e.clear();var h=JSON.parse(f);h.objectId=h.objectId||c.id();var i=make.Default.load(h);e.addByDescendant(i),mono.Utils.playCameraAnimation(b,new mono.Vec3(107,156,609),new mono.Vec3(0,0,0),1e3),g.setElement(h),i.setClient("data",f),g.fireModelChange(g._currentModel,i),g._currentModel=i}}}),a.getRootView()},onDropHandler:function(a,b,c,d){},adjustNetwork3dBoundingBox:function(){mono.Utils.autoAdjustNetworkBounds(this.network3d,this.networkBox[0],"clientWidth","clientHeight",0,0);
},fireModelChange:function(a,b){this._modelChangeDispatcher.fire({source:this,oldValue:a,newValue:b})},fireModelPropertyChange:function(a,b,c,d){this._modelPropertyChangeDispatcher.fire({source:a,property:b,oldValue:c,newValue:d})},addModelChangeListener:function(a,b,c){this._modelChangeDispatcher.add(a,b,c)},removeModelChangeListener:function(a,b){this._modelChangeDispatcher.remove(a,b)},addModelPropertyChangeListener:function(a,b,c){this._modelPropertyChangeDispatcher.add(a,b,c)},removeModelPropertyChangeListener:function(a,b){this._modelPropertyChangeDispatcher.remove(a,b)},_handleDoubleClick:function(a,b){var c=b.getCamera(),d=b.getDefaultInteraction(),e=g.findFirstObjectByMouse(b,a);if(e){var f=e.element,h=e.point,i=c.getTarget();f.getClient("animation")?make.Default.playAnimation(f,f.getClient("animation")):g.animateCamera(c,d,i,h)}else{var i=c.getTarget(),h=new mono.Vec3(0,0,0);g.animateCamera(c,d,i,h)}},refreshAccordion:function(a){a=a||c.utils.load3dModelCategory(),this.accordionPane.setCategories(a)},invalidate:function(){this.adjustNetwork3dBoundingBox()},getCurrentModel:function(){return this._currentModel},getData:function(){var a=this.getJsonObject();return a?a:null},setData:function(a){a instanceof Array?this.importJsonObject(a[0]):this.importJsonObject(a)},getSelectedData:function(){throw"not support this function[{}]".format("getSelectedData")},appendData:function(){throw"not support this function[{}]".format("appendData")},copySelection:function(){throw"not support this function[{}]".format("copySelection")},pasteSelection:function(){throw"not support this function[{}]".format("pasteSelection")}},c.ModelEditor=q,c.utils.ext(q,m);var r=function(a,b,d){r.superClass.constructor.call(this,a),this.modelClass=b,this.objectId=d||c.id(),this.parentNode=null,this.dragNode=null,this.currentItem=null,this.model3dTo2dMapping=j.rackEditorModel3dTo2dMapping,this.model2dTo3dMapping=j.rackEditorModel2dTo3dMapping,this.unitHeight=make.Default.getUnitHeight()||1,this.offsetX=0,this.offsetY=0,this.isSettingLocation=!1,this.isAddChildNode=!1,this.DEVICE_PATTEN="",this.RACK_PATTEN="",this.accordionPane=new c.AccordionPane,this.init()};r.prototype={init:function(){var a=this;this.accordionPane.ondrag=function(b,c){a.onDragHandler(b,c)},this.network2dView=this._initNetwork2d(),this.network2d.setMaxZoom(15);var b=this.sheet=new twaver.controls.PropertySheet(this.box);g.initPropertySheet(b);var c=this.propertySheetBox.width(),d=this.propertySheetBox.height();b.adjustBounds({x:0,y:0,width:c,height:d}),this.propertySheetBox.append(this.sheet.getView()),this.accordionPaneBox.append(this.accordionPane.getView()),this.networkBox.append(this.network2dView),$(this.network2dView).on("keydown",function(a){8==a.keyCode&&a.preventDefault()}),this.refreshAccordion(),this.modelClass&&this.loadParent(this.modelClass)},_initNetwork2d:function(){var a=this,b=this.network2d=new d.edit.GridNetwork;this.network2d.setPositionMagneticEnabled();var c=this.box=this.network2d.getElementBox();this._setChildPositionMagnetic(c);var e=this.selectionModel=this.box.getSelectionModel();e.setSelectionMode("singleSelection"),e.addSelectionChangeListener(function(b){a._resetPropertySheet(),a.resetNodeName()}),e.setFilterFunction(function(b){return b!=a.parentNode});var f=c.getLayerBox(),g=this.parentLayer=new twaver.Layer("parentLayer"),h=this.childrenLayer=new twaver.Layer("childrenLayer");f.add(g),f.add(h),f.moveToTop(g);var i=this.network2d.getView();l.setDropTarget(i,{self:this,dropEffect:"copy",ondrop:function(d,e){if(!a.onDropHandler||!a.onDropHandler(d,e,c,b))if(e=JSON.parse(e),a.isPatten(e.id)){var f=make.Default.getOtherParameter(e.id,"category");if(f==a.RACK_PATTEN){var g=make.Default.load(e.id);a.loadParent(g.parent),a.setData(g.data),setTimeout(function(){a.zoomOverview()},100)}else if(a.parentNode){var g=make.Default.load(e.id);a.setData(g)}else alert("add rack first")}else a.dragNode?(c.getSelectionModel().clearSelection(),c.getSelectionModel().appendSelection(a.dragNode),a.dragNode.setStyle("whole.alpha",1),a._resetPropertySheet(),a.resetChildNodeLocation(a.dragNode)):(a.loadParent(e.id),setTimeout(function(){a.network2d.zoomOverview()},100)),a.dragNode&&(a.dragNode=null,a.currentItem=null)},ondragover:function(b){if(b.dataTransfer.dropEffect="copy",a.dragNode&&!a.isHost(a.dragNode)){a.propertySheetBox.hide();var d=a.getSize(a.dragNode);if(!a.parentNode||!a._haveSpace(d,a.dragNode))return void(b.dataTransfer.dropEffect="none");a.dragNode.isAddInBox||(a.dragNode.isAddInBox=!0,a.dragNode.setStyle("whole.alpha",.7),a._initChildNode(a.dragNode,h),c.add(a.dragNode),a.box.getSelectionModel().clearSelection(),a.box.getSelectionModel().appendSelection(a.dragNode));var e=a.network2d.getLogicalPoint(b),f=e.x,g=e.y;g-=a.dragNode.getSize().height/2,e=a.formatLocation(a.dragNode,f,g),e?a.dragNode.setLocation(e.x,e.y):a.resetChildNodeLocation(a.dragNode)}},ondragleave:function(b){a.dragNode&&(a.dragNode.isAddInBox&&c.remove(a.dragNode),a.dragNode=null,a.currentItem=null)}});var j=this.ruler=new d.edit.Ruler(this.network2d);j.getView().setAttribute("class","room-ruler"),j.setShowGuides(!1),j.setShowRuler(!0);var k=$(j.getView());return k},onDropHandler:function(a,b,c,d){},onDragHandler:function(a,b){var d=this;if(!d.isPatten(b.id)&&!d.currentItem){var e=d.getEditId(b.id);if(make.Default.getOtherParameter(e,"host"))return;d.currentItem=b,d.dragNode=make.Default.load({id:d.getEditId(b.id),objectId:c.id()}),d.dragNode.setClient("id",b.id)}},isPatten:function(a){var b=make.Default.getOtherParameter(a,"category");return b==this.DEVICE_PATTEN||b==this.RACK_PATTEN},getEditId:function(a){return g.getRackEditorModel2dId(a)},isHost:function(a){return!!a.getClient("host")},getSize:function(a){return a.getClient("size")||1},setData:function(a){var b=this;a.forEach(function(a){b.loadChild(a.id,a)})},getData:function(){if(!this.parentNode)return[];var a=[],b=this.parentNode.getId(),c=this;return this.box.forEach(function(d){if(d!=c.parentNode){var e=make.Default.toJson(d,function(a){return a.id=g.getRackEditorModel3dId(a.id),a.parentObjectId=b,a});a.push(e)}}),a},appendData:function(a){if(!this.parentNode)throw"rack is empty";this.loadChild(a.id,a)},removeData:function(a){var b=this;return a instanceof Array?a.map(function(a){return b.box.removeById(a.objectId)}):b.box.removeById(a.objectId)},clear:function(){if(this.modelClass){var a=this,b=[];this.box.forEach(function(c){c!=a.parentNode&&b.push(c)}),b.forEach(function(b){a.box.remove(b)})}else this.box.clear()},loadChild:function(a,b){b.id=this.getEditId(a);var c=make.Default.load(b);if(c)return this._initChildNode(c,this.childrenLayer),this.isAddChildNode=!0,this.box.add(c),this.resetChildNodeLocation(c),c},_initChildNode:function(a,b){var c=this;a.setLayerId(b.getId()),a.setHost(this.parentNode);var d=a.setLocation;a.originalSetLocation=d,a.setLocation=function(b,e){var f=c.formatLocation(a,b,e);f?d.call(a,f.x,f.y):c.resetChildNodeLocation(a)};var e=a.translate;return a.translate=function(b,f){if(c.childNodeLiveMove){c.childNodeLastPointOffset.x+=b,c.childNodeLastPointOffset.y+=f;var g=c.childNodeLastPoint.x+c.childNodeLastPointOffset.x,h=c.childNodeLastPoint.y+c.childNodeLastPointOffset.y,i=c.formatLocation(a,g,h);i?d.call(a,i.x,i.y):c.resetChildNodeLocation(a)}else e.call(a,b,f)},a},loadParent:function(a){var b={id:this.getEditId(a),objectId:this.objectId},c=make.Default.load(b);return this._initParentNode(c,this.parentLayer),this.box.clear(),this.box.add(c),c.setLocation(0,0),this._resetPropertySheet(),c.setMovable(!1),this.parentNode=c,c},_initParentNode:function(a,b){a.setLayerId(b.getId()),this.offsetX=a.getClient("offsetX"),this.offsetY=a.getClient("offsetY"),this.childrenSize=a.getClient("childrenSize")},_findChildren:function(){return this.box.toDatas(function(a){return this.parentNode!=a?a:void 0},this)},_isEmpty:function(a,b,c){var d=this._findChildren();if(!d||0==d.size())return!0;var e=this.parentNode.getClient("childrenSize"),f=d.size(),g=a,h=a+b-1;if(h>e-1)return!1;for(var i=0;f>i;i++){var j=d.get(i);if(c!=j){var k=j.getClient("size"),l=parseInt(j.getClient("loc"))-1,m=l,n=l+k-1;if(!(g>n||m>h))return!1}}return!0},_haveSpace:function(a,b){var c=this._findChildren();if(!c||0==c.size())return!0;for(var d=this.parentNode.getClient("childrenSize")||42,e=0;d-a>=e;e++)if(this._isEmpty(e,a,b))return!0;return!1},_getNextLoc:function(a,b){if(this._haveSpace(a,b))for(var c=this.parentNode.getClient("childrenSize"),d=0;c>d;d++)if(this._isEmpty(d,a,b))return d;throw"there have not enough space for "+a+"U  server"},_setChildPositionMagnetic:function(a){var b=this;a.addDataPropertyChangeListener(function(a){var c=a.property,d=a.source;d.getClient("host")?j.HOST_EDITABLE:"C:loc"==c?(d.eventType="loc",b.changeChildNodeHandler(d,a)):"location"==c&&(b.isSettingLocation?b.isSettingLocation=!1:b.moveChildNodeHandler(d,a))}),a.addDataBoxChangeListener(function(a){var c=a.kind,d=a.data;"add"!=c||d.getClient("host")||b.addChildNodeHandler(d,a)}),this.network2d.addInteractionListener(function(a){var c=b.box.getSelectionModel().getLastData();c&&!c.getClient("host")&&("liveMoveStart"==a.kind?(b.propertySheetBox.hide(),b.childNodeLiveMove=!0,b.childNodeLastPoint=c.getLocation(),b.childNodeLastPointOffset={x:0,y:0},c.setStyle("whole.alpha",.5)):"liveMoveEnd"==a.kind&&(b.moveChildNodeEndHandler(c,a),delete b.childNodeLiveMove,delete b.childNodeLastPoint,delete b.childNodeLastPointOffset,c.setStyle("whole.alpha",1),b.propertySheetBox.show()))})},_getLoc:function(a,b){var c=this.parentNode.getClient("childrenSize"),d=this.parentNode.getLocation(),e=c*this.unitHeight-(a-d.y-this.offsetY),f=Math.round(e/this.unitHeight);return b||(f=Math.max(0,f),f=Math.min(c-1,f)),f},formatLocation:function(a,b,c){var d=this.parentNode.getLocation(),e=this.parentNode.getClient("childrenSize");c=Math.max(d.y+this.offsetY,c),c=Math.min(d.y+this.offsetY+e*this.unitHeight-a.getSize().height,c);var f=a.getClient("size"),g=this._getLoc(c+a.getSize().height);if(!this._isEmpty(g,f,a))return null;var d=this.parentNode.getLocation(),b=d.x+this.offsetX,c=d.y+(e-1-g+1)*this.unitHeight+this.offsetY-a.getSize().height;return{x:b,y:c,loc:g}},addChildNodeHandler:function(a){if(this.isAddChildNode)return void(this.isAddChildNode=!1);var b=a.getLocation(),c=this._getLoc(b.y+a.getSize().height);a.setClient("loc",c-1)},resetNodeName:function(){var a=this;this.box.forEach(function(b){a.parentNode!=b&&b.setName(null)});var b=this.selectionModel.getLastData();if(b&&!this.isHost(b)){b.setStyle("label.position","right.right"),b.setStyle("label.xoffset",10);var c=parseInt(b.getClient("loc")),d=parseInt(b.getClient("size")),e=""+c+"U - "+(c+d-1)+"U";b.setName(e)}},changeChildNodeHandler:function(a,b){if(this.resetNodeName(a),"moveChildNodeHandler-loc"==this.eventType)return void(this.eventType=null);var c=a.getClient("size"),d=parseInt(b.newValue)-1;if(this._isEmpty(d,c,a)){var e=this.parentNode.getClient("childrenSize"),f=this.parentNode.getLocation(),g=f.x+this.offsetX,h=f.y+(e-1-d+1)*this.unitHeight+this.offsetY-a.getSize().height;this.setChildNodeLocation(a,g,h)}else d=this._getNextLoc(c,a),a.setClient("loc",d+1)},moveChildNodeHandler:function(a,b){if(this.eventType)return void(this.eventType=null);var c=this,d=a.getClient("size"),e=null;e=b?parseFloat(b.newValue.y):a.getLocation().y;var f=this._getLoc(e+a.getSize().height);if(this._isEmpty(f,d,a)){var g=parseInt(a.getClient("loc"))-1;g!=f&&(this.eventType="moveChildNodeHandler-loc"),a.setClient("loc",f+1)}setTimeout(function(){c.resetChildNodeLocation(a)},500)},moveChildNodeEndHandler:function(a,b){this.resetChildNodeLocation(a)},setChildNodeLocation:function(a,b,c){var d=this.parentNode.getClient("childrenSize"),e=a.getLocation(),f=this.parentNode.getLocation();c=Math.max(f.y+this.offsetY,c),c=Math.min(f.y+this.offsetY+d*this.unitHeight-a.getSize().height,c),(e.x!=b||e.y!=c)&&(this.isSettingLocation=!0,a.setLocation(b,c))},resetChildNodeLocation:function(a){var b=parseInt(a.getClient("loc"))-1,c=this.parentNode.getClient("childrenSize"),d=this.parentNode.getLocation(),e=d.x+this.offsetX,f=d.y+(c-1-b+1)*this.unitHeight+this.offsetY-a.getSize().height,g=a.getLocation();(g.x!=e||g.y!=f)&&(this.isSettingLocation=!0,a.originalSetLocation(e,f))},_resetPropertySheet:function(){if(this.isPropertySheetVisible()){var a=this,b=a.sheet.getPropertyBox();b.clear();var c=this.box.getSelectionModel();if(0==c.size())b.clear(),this.propertySheetBox.hide();else{this.propertySheetBox.show();var d=c.getLastData();g.addProperties(b,make.Default.getModelDefaultParameterProperties(make.Default.getId(d))),a.resetPropertySheetBoxSize(this.sheet)}}},zoomOverview:function(){this.network2d.zoomOverview()},refreshAccordion:function(a){a=a||c.utils.load2dRackCategory(!this.modelClass),this.accordionPane.setCategories(a)}},c.RackEditor=r,c.utils.ext(r,m);var s={wall:100,area:200,innerWall:300,wallChild:400,innerWallChild:500,channel:600,rack:700,"default":800};d.edit.BoxBridge=function(a,b){this.box2d=a,this.jsonBox=b,this.binded=!1,this.refMap2d={},this.refMapJson={},this.isAdjusting=!1},twaver.Util.ext(d.edit.BoxBridge,Object,{bind:function(){this.binded||(this.box2d.addDataBoxChangeListener(this._handle2dBoxChange,this),this.box2d.addDataPropertyChangeListener(this._handle2dDataChange,this),this.jsonBox.addDataBoxChangeListener(this._handleJsonBoxChange,this),this.binded=!0)},unbind:function(){this.box2d.removeDataBoxChangeListener(this._handle2dBoxChange,this),this.box2d.removeDataPropertyChangeListener(this._handle2dDataChange,this),this.jsonBox.removeDataBoxChangeListener(this._handleJsonBoxChange,this),this.binded=!1},synchronizeFilter:function(a,b){return!0},_getJsonData:function(a){var b=new d.edit.data.JsonObject({objectId:a.getId()}),c=a.getClient("radius"),e=a.getCenterLocation(),f=a.getAngle(),h=g.getSceneEditorModel3dId(a.getClient("id")),i=a.getPoints&&a.getPoints(),j=a.getClient("objName"),k=a.getClient("wallWidth")||a.getWidth(),l=a.getHeight(),m=a.getClient("height"),n=a.getClient("positionY"),o=a.getClient("label"),p=a.getClient("bid"),q=a.getClient("closed"),r=a.getClient("showFloor"),s=a.getClient("wallHeight"),t=null;a.getParent()&&(t=a.getParent()),b.setParentId(t);var u=a.getClient("pointsY"),v={};if(c&&b.setRadius(c),e&&b.setPosition([e.x,0,e.y]),f&&b.setRotation([0,f,0]),h&&(b.id=h),j&&b.setName(j),k&&b.setWidth(k),l&&b.setDepth(l),m&&b.setHeight(m),q&&b.setClosed(!0),r&&b.setShowFloor(!0),s&&b.setWallHeight(s),n){var w=b.getPosition()||[0,0,0];b.setPosition(w[0],n,w[2])}if(null!=i&&i.size()>0){for(var x=[],y=0;y<i.size();y++)u?x.push([i.get(y).x-e.x,i[y]||20,i.get(y).y-e.y]):x.push([i.get(y).x-e.x,i.get(y).y-e.y]);b.setData(x)}return o&&(v.label=o),p&&(v.bid=p),b.setClient(v),b},_addJsonData:function(a){if(this.synchronizeFilter(a,null)&&this.box2d.contains(a)){var b=this._getJsonData(a);this.jsonBox.add(b),this.refMapJson[a.getId()]=b}},_removeJsonData:function(a){null!=a&&(this.jsonBox.removeById(a.getId()),delete this.refMapJson[a.getId()]);var b=a.getClient("type");if("door"==b||"window"==b){var c=a.getId();for(var d in this.refMapJson)if(this.refMapJson[d]){var e=this.refMapJson[d].getChildren();if(e&&e.length>0)for(var f=0;f<e.length;f++)e[f].getObjectId()==c&&(this.refMapJson[d].getChildren().splice(e.indexOf(e[f]),1),console.log(this.refMapJson[d]))}}},_handle2dBoxChange:function(a){if(!this.isAdjusting){this.isAdjusting=!0;var b=a.data,c=a.kind;"add"==c?(this._addJsonData(b),this.resetParentAndChildren(b)):"remove"==c?this._removeJsonData(b):"clear"==c&&(this.jsonBox.clear(),this.refMapJson={},this.refMap2d={}),this.isAdjusting=!1}},_handle2dDataChange:function(a){function b(a,b){if(a.getPoints){var c=[],b=b||a.getPoints(),d=a.getCenterLocation(),e=a.getClient("pointsY"),f=a.getSegments();if(!(f&&f.size()>0&&f.size()>b.size())){if(f&&f.size()>0)for(var g=0,i=0;g<f.size();g++,i++){var j=f.get(g),k=b.get(i);if("moveto"==j||"lineto"==j)e?c.push([parseInt(k.x-d.x),e[i],parseInt(k.y-d.y)]):c.push([parseInt(k.x-d.x),parseInt(k.y-d.y)]);else if("quadto"==j)if(e){var l=b.get(++i),m=e[i]||0;c.push(["c",parseInt(k.x-d.x),e[i],parseInt(k.y-d.y),parseInt(l.x-d.x),m,parseInt(l.y-d.y)])}else c.push(["c",parseInt(k.x-d.x),parseInt(k.y-d.y),parseInt(l.x-d.x),parseInt(l.y-d.y)])}else for(var g=0;g<b.size();g++)e?c.push([b.get(g).x-d.x,e[g],b.get(g).y-d.y]):c.push([b.get(g).x-d.x,b.get(g).y-d.y]);h.setData(c)}}}var c=this;if(!this.isAdjusting){this.isAdjusting=!0;var d=a.source,e=a.newValue,f=(a.oldValue,a.property);if(d.getParent()&&("door"==d.getClient("type")||"window"==d.getClient("type"))){var g,h=this.jsonBox.getDataById(d.getParent().getId());if(h.getChildren().forEach(function(a){a.getObjectId()==d.getId()&&(g=a)}),f.startsWith("C:")){o=f.substr(f.indexOf(":")+1),("edgeIndex"==o||"offset"==o)&&(g.client=g.client||{},g.client[o]=e),"length"==o&&g.setWidth(e);var i=d.getCenterLocation(),j=g.getPosition()[1];g.setPosition([i.x,j,i.y]);var k=g.getClient()||{};k[o]=e,g.setClient(k)}}var h=this.jsonBox.getDataById(d.getId());if(!h)return void(this.isAdjusting=!1);if("points"==f){var l=e;b(d,l)}else if("location"==f){var m=d.getCenterLocation(),n=(d.getSize(),h.getPosition()||[0,0,0]);h.setPosition([m.x,n[1],m.y]),b(d),c.resetParentAndChildren(d)}else if("angle"==f)h.setRotation([0,-e,0]);else if("width"==f){h.setWidth(e);var m=d.getCenterLocation(),n=h.getPosition()||[0,0,0];h.setPosition([m.x,n[1],m.y])}else if("height"==f){h.setDepth(e);var m=d.getCenterLocation(),n=h.getPosition()||[0,0,0];h.setPosition([m.x,n[1],m.y])}else if(f.startsWith("C:")){var o=f.substr(f.indexOf(":")+1);if("radius"==o)h.setRadius(e);else if("height"==o)h.setHeight(e);else if("wallHeight"==o)h.setWallHeight(e);else if("positionY"==o){var n=h.getPosition()||[0,0,0];h.setPosition([n[0],parseInt(e),n[2]])}else if("pointsY"==o){for(var p=e,q=h.getData(),r=0;r<q.length;r++)q[r][1]=p[r];h.setData(q)}else"parentId"==o&&h.setParentId(e);var k=h.getClient()||{};k[o]=e,h.setClient(k)}else if(f.startsWith("S:")){var o=f.substr(f.indexOf(":")+1);"vector.outline.color"==o&&h.setColor(e);var s=h.getStyle()||{};s[o]=e,h.setStyle(s)}this.isAdjusting=!1}},_handleJsonBoxChange:function(a){if(!this.isAdjusting){this.isAdjusting=!0;var b=a.data,c=a.kind;"add"==c?(this.refMapJson[b.getObjectId()]||(this.refMapJson[b.getObjectId()]=b),this._add2dData(b)):"remove"==c?this._remove2dData(b):"clear"==c&&(this.box2d.clear(),this.refMapJson={},this.refMap2d={}),this.isAdjusting=!1}},_remove2dData:function(a){null!=a&&(this.box2d.removeById(a.getObjectId()),delete this.refMap2d[a.getObjectId()])},_replaceMappingId:function(a){var b={};return make.Default.copyProperties(a,b),this._replaceMappingIdAction(b),b},_replaceMappingIdAction:function(a){var b=g.getSceneEditorModel2dId(a.id);if(a.id=b,a.children)for(var c in a.children){var d=a.children[c];this._replaceMappingIdAction(d)}},_add2dData:function(a){var b=this;if(this.synchronizeFilter(null,a)&&!this.box2d.getDataById(a.getObjectId())){var c=this._replaceMappingId(a);c.rotation&&(c.rotation[1]*=-1);var d=make.Default.load(c);if(d.setClient("id",a.id),this.box2d.add(d),d.getChildren&&d.getChildren().size()>0){d.setClient("magnetic.disabled",d.getClient("magnetic.disabled")?!0:!1);var e=d.getChildren(),b=this;e.forEach(function(a){b.box2d.getDataById(a.getId())||(a.setClient("magnetic.disabled",!0),b.box2d.add(a))})}this.refMap2d[a.getObjectId()]=d,b.resetParentAndChildren(d)}},resetParentAndChildren:function(a){var b=this,c=a.getId(),d=make.Default.getId(a),e=make.Default.getType(d);"door"!=e&&"window"!=e&&g.runDelayTask(c,1,function(){b._resetParentAndChildren(a)})},_resetParentAndChildren:function(a){this.resetParent(a),this.resetChildren(a)},resetParent:function(a){if(a.getHost&&a.setHost){var b=this.getParent(a);if(b){if(b!=a.getHost()){a.setHost(b),a.setClient("parentId",b.getId());var c=this.refMapJson[a.getId()];c?c.setParentId(b.getId()):console.warn("2DjsonObject, id2d="+a.getId(),a,this.refMapJson)}}else a.setHost(null),a.setClient("parentId",null),this.refMapJson[a.getId()].setParentId(null)}},resetChildren:function(a){var b=this,c=this.getChildren(a);c.forEach(function(c){c.getHost&&c.setHost&&a!=c.getHost()&&(c.setHost(a),c.setClient("parentId",a.getId()),b.refMapJson[c.getId()].setParentId(a.getId()))})},getParent:function(a){var b=this._getParent(a);return b},_isFatherLayer:function(a){return a==s.wall||a==s.area||a==s.channel},_getParent:function(a){var b=(a.getCenterLocation(),a.getLayerId()),c=this.box2d.getLayerBox(),d=c.size(),e=b==s.area||b==s.innerWall||b==s.wallChild||b==s.innerWallChild;if(e)for(var f=0;f<this.box2d.size();f++){var h=this.box2d.getDataAt(f);if(h.getLayerId()==s.wall&&g.isNodeInNode(h,a))return h}else for(var i=d-1;i>=0;i--){var j=c.getDataAt(i);if(!(j.getId()>=b)&&this._isFatherLayer(j.getId())&&j.getId()!=s.wallChild&&j.getId()!=s.innerWallChild&&j.getId()!=s.innerWall)for(var f=0;f<this.box2d.size();f++){var h=this.box2d.getDataAt(f);if(h.getLayerId()==j.getId()&&g.isNodeInNode(h,a))return h}}},getChildren:function(a){var b=a.getLayerId();if(!this._isFatherLayer(b))return[];var c=this._getChildren(a);return c},_getChildren:function(a){for(var b=[],c=a.getLocation(),d=a.getSize(),e=({x:c.x,y:c.y,width:d.width,height:d.height},a.getLayerId()),f=this.box2d.getLayerBox(),h=f.size(),i=0;h>i;i++){var j=f.getDataAt(i);if(!(j.getId()<=e)&&j.getId()!=s.wallChild&&j.getId()!=s.innerWallChild&&j.getId()!=s.innerWall)for(var k=0;k<this.box2d.size();k++){var l=this.box2d.getDataAt(k);l.getCenterLocation();if(l.getLayerId()==j.getId()&&g.isNodeInNode(a,l)){var m=this.getParent(l);m==a&&b.push(l)}}}return b}}),d.edit.Edit2D=function(a,b){this.jsonBox=a||new d.edit.JsonBox,this.editor=b,this._init(),this.loadDataFlag=!1},d.edit.Edit2D.CONTAINER_CLASS="edit2d-container",twaver.Util.ext(d.edit.Edit2D,Object,{_init:function(){this.accordionPane=new c.AccordionPane;this.network2d=new d.edit.GridNetwork,this.network2d.setMinZoom(.1),this.network2d.setMaxZoom(5),this.box=this.network2d.getElementBox();var a=this.sheet=new twaver.controls.PropertySheet(this.box);g.initPropertySheet(a),this.network2dView=this._initNetwork2d(),this.clientBidQuickFinder=new twaver.QuickFinder(this.box,"bid","client");var b=new d.edit.BoxBridge(this.box,this.jsonBox);b.bind(),this.setDragAndDropImage(this.network2d.getView()),this.network2d.addInteractionListener(function(a){"doubleClickElement"==a.kind&&this.doubleClickRackHandler&&this.doubleClickRackHandler(a.element,this.box)},this),this.box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.editor.propertySheetBox.append(this.sheet.getView()),this.editor.accordionPaneBox.append(this.accordionPane.getView()),this.editor.networkBox.append(this.network2dView)},createNodesByJson:function(a){g.createJsonObject(this.jsonBox,a),this.box.getSelectionModel().clearSelection()},zoomOverview:function(){this.network2d.zoomOverview()},setDragAndDropImage:function(a){var b=this;l.setDropTarget(a,{dropEffect:"copyMove",ondrop:function(a,c){b.dragNode&&(b.dragNode=null,b.currentItem=null)},ondragover:function(a){if(a.preventDefault(),b.dragNode){b.dragNode.isAddInBox||(b.dragNode.isAddInBox=!0,b.dragNode.setStyle("whole.alpha",.7),b.box.add(b.dragNode));var c=b.network2d.getLogicalPoint(a),d=c.x,e=c.y;e-=b.dragNode.getSize().height/2,b.dragNode.setLocation(d,e)}},ondragleave:function(a){b.dragNode&&(b.dragNode.isAddInBox&&b.box.remove(b.dragNode),b.dragNode=null,b.currentItem=null)}})},_initNetwork2d:function(){var a=new d.edit.interaction.RoomListener(this.network2d,this.propertySheetPane,this.jsonBox);a.initRoomSettings();var b=this.ruler=new d.edit.Ruler(this.network2d);return b.getView().setAttribute("class","room-ruler"),b.setShowGuides(!1),b.setShowRuler(!0),this.network2d.getLabel=function(a){if(g.isEditModel(a)){var b=a.getClient("bid");return b&&b.trim().length>0?b:a.getClient("label")}},b.getView()},layoutGUI:function(){this.ruler.invalidate()},getJsonBox:function(){return this.jsonBox},getRegionJson:function(a){var b=null,c=this;return b=this.jsonBox.toJson(function(b){return c._isRegion(b,a)})},_isRegion:function(a,b){var c=a.type;return b&&b!=a.getId()?!1:"area-rect"==c||"area-round"==c||"area-polygon"==c?!0:!1},loadData:function(){var b=this.network2d.getElementBox();this.loadDataFlag||(this.loadDataFlag=!0,d.edit.model.model2d.loadData(b,JSON.parse(a.localStorage.getItem("scene"))||[]));var c=[];b.forEach(function(a){"area"==a.getClient("type")&&c.push(a)}),c.forEach(function(a){b.remove(a)}),d.edit.model.model2d.loadData(b,JSON.parse(a.localStorage.getItem("region"))||[])},getObject2dById:function(a){return a?this.clientBidQuickFinder.findFirst(a):null},doubleClickRackHandler:function(a,b){},handleSelectionChange:function(){if(this.editor.isPropertySheetVisible()){var a=this,b=a.sheet.getPropertyBox();b.clear();var c=this.box.getSelectionModel();if(1!=c.size())b.clear(),this.editor.propertySheetBox.hide();else{this.editor.propertySheetBox.show();var d=c.getLastData(),e=make.Default.getId(d);e=g.getSceneEditorModel2dId(e),g.addProperties(b,make.Default.getModelDefaultParameterProperties(e)),a.editor.resetPropertySheetBoxSize(this.sheet)}}}}),d.edit.Edit3D=function(a,b){this.jsonBox=a||new d.edit.JsonBox,this.editor=b,this._init(),this.isZoom=!1,this.afterRefreshNetwork3d=null},twaver.Util.ext(d.edit.Edit3D,Object,{_init:function(){this.network3dView=this._initNetwork3d(),this.jsonBox.addDataBoxChangeListener(this._handleJsonBoxChange,this),this.editor.contentPane3d.append(this.network3dView)},_initNetwork3d:function(){var a=this.network3d=new mono.Network3D,b=new mono.PerspectiveCamera(30,1.5,50,2e4);a.setCamera(b),b.p(638,2571,2763),a.setClearColor("#000000"),a.setClearAlpha(0),a.setBackgroundImage("./images/bg_network.jpg");var c=a.getDefaultInteraction();c.yLowerLimitAngle=Math.PI/180*2,c.yUpLimitAngle=Math.PI/2,c.maxDistance=1e4,c.minDistance=50,c.zoomSpeed=3,c.panSpeed=.2,a.setInteractions([c]);var d=this.box=a.getDataBox(),e=new mono.PointLight(16777215,.1);e.setPosition(8e3,8e3,8e3),d.add(e),d.add(new mono.AmbientLight("white")),a.getRootView().setAttribute("class","network3d-view");var f=function(a,b){var c=b.getCamera(),d=b.getDefaultInteraction(),e=g.findFirstObjectByMouse(b,a);if(e){var f=e.element,h=e.point,i=c.getTarget();if(f.getClient("animation"))if("rack_door"==f.getClient("type")&&f.getClient("animated")){var j=f.getParent().getChildren().toList(function(a){return f!=a&&a.getClient("animated")}),k=j.size(),l=0;k>0?j.forEach(function(a){make.Default.playAnimation(a,a.getClient("animation"),function(){l++,l==k&&make.Default.playAnimation(f,f.getClient("animation"))})}):make.Default.playAnimation(f,f.getClient("animation"))}else make.Default.playAnimation(f,f.getClient("animation"));else g.animateCamera(c,d,i,h);if(f.getClient("dbl.func")){var m=f.getClient("dbl.func");m(f,b,e,a)}else if(f.getParent()&&f.getParent().getClient("dbl.func")){var m=f.getParent().getClient("dbl.func");m&&m(f.getParent(),b,e,a)}}else{var i=c.getTarget(),h=new mono.Vec3(0,0,0);g.animateCamera(c,d,i,h)}};return a.getRootView().addEventListener("dblclick",function(b){f(b,a)}),a.getRootView()},refreshNetwork3d:function(){var a=this,b=this.network3d.getDataBox();b.clear();var c=this.jsonBox.toJson();make.Default.load(c,function(c){if(c&&c.length>0){for(var d=0;d<c.length;d++){var e=c[d];b.addByDescendant(e),e.setClient("dbl.func",function(c,d){a.doubleClickHandler(c,b)})}setTimeout(function(){var a=new mono.Cube(.1,.1,.1);b.add(a),setTimeout(function(){b.remove(a)},500)},500),a.afterRefreshNetwork3d&&a.afterRefreshNetwork3d()}});this.isZoom||this.zoomToOverview()},findByBID:function(a){return this.bidQuickFinder||(this.bidQuickFinder=new mono.QuickFinder(this.network3d.getDataBox(),"bid","client")),this.bidQuickFinder.findFirst(a)},doubleClickHandler:function(a,b){},zoomToOverview:function(){this.isZoom=!0,this.network3d.zoomEstimateOverview(45);var a=this.network3d.getNetworkBoundingBox();console.log(a);var b=this.network3d.getCamera(),c=b.p(),d=b.t();b.setPosition(c.x+2500,c.y+3500,c.z+3500),setTimeout(function(){mono.Utils.playCameraAnimation(b,new mono.Vec3(c.x+500,c.y+500,c.z+500),d,500)},1e3)},getView:function(){return this.network3dView},getJsonBox:function(){return this.jsonBox},_handleJsonBoxChange:function(a){kind=a.kind,"clear"==kind&&this.network3d.getDataBox().clear()}}),d.edit.EditDrop=function(){this.dropFunctionMap={},this.registerDropFunction("model",this.onModelDrop),this.registerDropFunction("default",this.onDefaultDrop)},twaver.Util.ext(d.edit.EditDrop,Object,{registerDropFunction:function(a,b){this.dropFunctionMap[a]=b},onDrop:function(a,b){"string"==typeof b&&(b=JSON.parse(b));var c=b.dragType,d=this.dropFunctionMap[c];d?d(a,b):this.onDefaultDrop(a,b)},onModelDrop:function(a,b){var c=b.model;c&&console.log("load model : "+c)},onDefaultDrop:function(a,b){console.log("onDefaultDrop"),a.setInteractions([new d.edit.interaction.RoomDragInteraction(a)])}}),c.ImportDxf=d.edit.ImportDxf=function(a){this.scale=a||1},twaver.Util.ext(d.edit.ImportDxf,Object,{loadDxf:function(a,b){var c=this;if(!(a instanceof File))return c._loadDxfFile(a,b);if(a.name.match(/\.dxf$/i)){var d=new FileReader;d.onload=function(a){c.loadDxf(a.target.result,b)},d.readAsText(a)}else alert("Only dxf file is supported")},_loadDxfFile:function(a,b){function c(a){var b=make.Default.getType(a.attrib.layer);if(b&&"wall"==b)a instanceof dxf.LineData?(f=a.y1<f?a.y1:f,f=a.y2<f?a.y2:f,g=a.y1>g?a.y1:g,g=a.y2>g?a.y2:g,h=a.x1<h?a.x1:h,h=a.x2<h?a.x2:h,i=a.x1>i?a.x1:i,i=a.x2>i?a.x2:i):a instanceof dxf.PolylineData?a.points.forEach(function(a){f=a.y<f?a.y:f,g=a.y>g?a.y:g,h=a.x<h?a.x:h,i=a.x>i?a.x:i}):a instanceof dxf.InsertData;else if(a instanceof dxf.InsertData&&"road"===a.name){var e=d.getEntitiesFromInsertData(a);e.forEach(function(a){c(a)})}}var d=this;d.data=a;var e=d.parser=new dxf.Dxf;e.parse(a);var f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,j=[];e.sections.entities.forEach(function(a){c(a)}),d.minY=f,d.maxY=g,d.minX=h,d.maxX=i;var k=[],j=d.walls=[];e.sections.entities.forEach(function(a){var b=a.attrib.layer,c=make.Default.getType(b);("wall"==c||"innerWall"==c)&&d.createJsonArray(a,k,b)}),e.sections.entities.forEach(function(a){var b=a.attrib.layer,c=make.Default.getType(b);"door"==c?d.createBlockJson(a,b,j,10):"window"==c&&d.createBlockJson(a,b,j,50)});var l=[],m=d.scale;if(e.sections.entities.forEach(function(a){var b=a.attrib.layer;if(a instanceof dxf.MTextData){var c=(a.ipx+a.width/2*Math.cos(a.angle))*m,d=-(a.ipy+a.height/2*Math.sin(a.angle))*m;l.push({id:b,point:{x:c,y:d},text:a.text,entity:a})}else if(a instanceof dxf.TextData){var c=a.ipx*m,d=-a.ipy*m;l.push({id:b,point:{x:c,y:d},text:a.text,entity:a})}}),e.sections.entities.forEach(function(a){var b=a.attrib.layer,c=make.Default.getType(b);"wall"==c||"innerWall"==c||"door"==c||"window"==c||d.createJsonArray(a,k,b,l)}),b&&k&&k.length>0){var n={};k.forEach(function(a){if(!a.client||a.client.bid){var b=a.id;n[b]||(n[b]=1);var c=b+"_"+n[b]++;a.objectId=c,a.client=a.client||{},a.client.bid=c}})}return k},createBlockJson:function(a,b,c,d){var e,f=this,g=this.translatePoint({x:a.x1,y:a.y1}),h=this.translatePoint({x:a.x2,y:a.y2});if(c.some(function(a){return index=f.getPointIndex(a,g),index<0&&(index=f.getPointIndex(a,h)),index>=0&&(e=a),null!=e}),!(null==e||index<0)){var i={x:(g.x+h.x)/2,y:(g.y+h.y)/2},j=this.getPointOffset(e,i,index),k=Math.atan((g.y-h.y)/(g.x-h.x));e.children=e.children||[];var l=Math.sqrt((g.x-h.x)*(g.x-h.x)+(g.y-h.y)*(g.y-h.y)),m={id:b,position:[i.x,d,i.y],rotation:[0,k,0],width:l,client:{edgeIndex:index,offset:j}};e.children.push(m)}},createJsonArray:function(a,b,c,d){var e=this,f=(a.attrib.layer.split("#"),make.Default.getType(c)),g=this.getEntityPoints(a,1===a.flags),h={};if("wall"==f||"innerWall"==f||"floor"==f||"area"==f||"watercable"==f){if(h={id:c,data:g},"wall"==f&&g[0].toString()==g[g.length-1].toString()&&(g=g.slice(0,g.length-1),
h.data=g,h.closed=!0,h.showFloor=!0),"area"==f){var i=this.getRectOfPoints(g);if(!i)return null;var j=e.getText(c,i.points,d);j&&(h.objectId=j,h.client=h.client||{},h.client.bid=j)}}else{var i=this.getRectOfPoints(g);if(!i)return null;var k=i.max.x-i.min.x,l=i.max.y-i.min.y,m=i.center(),n=0;a instanceof dxf.InsertData&&(n=a.angle),h={id:c,width:k,depth:l,rotation:[0,n,0],position:[m.x,"floor-top",m.y]};var o=e.rotatePoints(i.points,n,m),j=e.getText(c,o,d);j&&(h.objectId=j,h.client=h.client||{},h.client.bid=j)}b.push(h),("wall"==f||"innerWall"==f)&&this.walls.push(h)},rotatePoints:function(a,b,c){var d=c.x,e=c.y,f=Math.cos(b/180*Math.PI),g=Math.sin(b/180*Math.PI),h=[];return a.forEach(function(a){h.push({x:(a.x-d)*f-(a.y-e)*g+d,y:(a.x-d)*g+(a.y-e)*f+e})}),h},getText:function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e.id==a){var f=e.point;if(this.isPointInPolygon(b,f)){var g=e.text;return c.splice(d,1),g}}}},translatePoint:function(a){var b=0,c=0,d=0,e=0,f=d-b,g=e-c,h=0,i=0,j=this.scale;return{x:(a.x-b-f/2)*j+h,y:(-a.y+e-g/2)*j+i}},getFixedNumber:function(a){return parseFloat(a.toFixed(0))},getEntitiesPoints:function(a,b,c){var d=[],e=this;return a.forEach(function(a){var f=e.getEntityPoints(a,1===a.flags,b,c),g=d.length;g>=4&&d[g-2]===f[0]&&d[g-1]===f[1]&&(f.shift(),f.shift()),d.push.apply(d,f)}),d},getRectOfPoints:function(a){if(!a||a.length/2<2)return null;var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=0,g=a.length,h=[],i=function(a,f){d=Math.min(d,a),e=Math.max(e,a),b=Math.min(b,f),c=Math.max(c,f),h.push({x:a,y:f})};if(g>0&&a[f]instanceof Array)for(;g>f;f++){var j=a[f];2==j.length?i(j[0],j[1]):5==j.length&&"c"==j[0]&&i(j[3],j[4])}else for(;g>f;f+=2)i(a[f],a[f+1]);return{min:{x:d,y:b},max:{x:e,y:c},center:function(){return{x:(this.min.x+this.max.x)/2,y:(this.min.y+this.max.y)/2}},points:h}},getBulgeVertex:function(a,b,c){var d={x:b.x,y:b.y},e={x:c.x,y:c.y},f={},g=(d.x-e.x)*(d.y-e.y)*a;return g>0?f={x:e.x,y:d.y}:0>g&&(f={x:d.x,y:e.y}),f},getEntityPoints:function(a,b,c,d){c=c||0,d=d||0;var e=[],f=this;if(a instanceof dxf.LineData){var g=f.translatePoint({x:a.x1+c,y:a.y1+d});e.push(this.getFixedNumber(g.x),this.getFixedNumber(g.y)),g=f.translatePoint({x:a.x2+c,y:a.y2+d}),e.push(this.getFixedNumber(g.x),this.getFixedNumber(g.y))}else if(a instanceof dxf.PolylineData)for(var h=0;h<a.points.length;h++){var i=a.points[h],g=f.translatePoint({x:i.x+c,y:i.y+d});if(e.push([f.getFixedNumber(g.x),f.getFixedNumber(g.y)]),i.bulge&&.414==Math.abs(i.bulge.toFixed(3))){b=!1;var j=a.points[++h]||a.points[0],k=f.getBulgeVertex(i.bulge.toFixed(3),i,j),l=f.translatePoint({x:j.x+c,y:j.y+d}),m=f.translatePoint({x:k.x+c,y:k.y+d});e.push(["c",f.getFixedNumber(m.x),f.getFixedNumber(m.y),f.getFixedNumber(l.x),f.getFixedNumber(l.y)])}}else if(a instanceof dxf.InsertData){var n=a.name,o=null,p=f.parser.sections.blocks,q=a.ipx+c,r=a.ipy+d;o=p[n],e=f.getEntitiesPoints(o.entities,q,r)}if(b){var s=e.length;(e[s-2]!=e[0]||e[s-1]!=e[1])&&e.push(e[0])}return e},pointArrayToPointObjects:function(a){var b=0,c=a.length,d=[];if(a[0]instanceof Array)for(;c>b;b++)d.push({x:a[b][0],y:a[b][1]});else for(;c>b;b+=2)d.push({x:a[b],y:a[b+1]});return d},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},getPointOffset:function(a,b,c){var d=a.data,e=this.pointArrayToPointObjects(d),f=e[c],g=e[c+1];g=g||e[0];var h=0;return f.x!=g.x?h=(b.x-f.x)/(g.x-f.x):f.y!=g.y&&(h=(b.y-f.y)/(g.y-f.y)),h},getPointIndex:function(a,b){var c=a.data,d=this.pointArrayToPointObjects(c);if(d.length<2)return-1;for(var e=0;e<d.length;e++)if(_twaver.math.getDistance(b,d[e])<=10)return-1;for(var f,g=d[0],e=1;e<d.length;e++){if(f=d[e],this.isPointOnLine(b,g,f,10))return e-1;g=f}return g=d[0],this.isPointOnLine(b,g,f,10)?d.length-1:-1},isPointInPolygon:function(a,b){var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;f>c;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e}});var t=function(a){this.scale=a||2.54,this.idMap={"":"twaver.idc.rack42","":"twaver.idc.wall","":"twaver.idc.innerWall2","":"twaver.idc.window","":"twaver.idc.door","":"twaver.idc.column"},this.positionYMap={door:10,window:50}};twaver.Util.ext(t,Object,{loadVsdx:function(a,b,c){var d=this;if(!(a instanceof File))return d._loadVsdxFile(a,b,c);if(a.name.match(/\.Vsdx$/i)){var e=new FileReader;e.onload=function(a){d.loadVsdx(a.target.result,c)},e.readAsText(a)}else alert("Only Vsdx file is supported")},_loadVsdxFile:function(a,b,c){var d=this;JSZip.loadAsync(a).then(function(a){d.parseZip(a,b)})},parseZip:function(a,b){var c,d=this,e=a.files,f="visio/masters/masters.xml",g="visio/pages/page",h="visio/pages/pages.xml",i=[];for(var j in e)if(0==j.indexOf(g)&&j!=h){var k=e[j];i.push(k)}else j==f&&(c=e[j]);this.parseMaster(c,e,function(a){d.masterMap=a;for(var c=[],e=0;e<i.length;e++){var f=i[e];d.parsePage(f,a,function(a){c.push(a),c.length==i.length&&b&&b(c)})}})},parseMaster:function(a,b,c){var d=this;a.async("text").then(function(a){var e=d.parseXml(a),f={},g=e.childNodes[0].childNodes,h=0;g.forEach(function(a,e){var i=a.getAttribute("ID"),j=a.getAttribute("Name"),k=a.getAttribute("Prompt"),l=k||j;l=d.idMap[l]||l,b["visio/masters/master"+(e+1)+".xml"].async("text").then(function(a){var b=d.parseXml(a),e=b.childNodes[0].childNodes[0].childNodes[0],j=d.findCellAttr(e,"Width"),k=d.findCellAttr(e,"Height"),m=1;j&&k&&(f[i]={id:l,width:d.toFloat(j)*m,height:d.toFloat(k)*m}),h++,h==g.length&&c&&c(f)})})})},parsePage:function(a,b,c){var d=this;a.async("text").then(function(a){var e=d.parseXml(a),f=d.parsePageXml(e,b);c&&c(f)})},parsePageXml:function(a,b){var c=a.childNodes[0].childNodes[0].childNodes,d=[],e=this.createWallChildren(c,b),f=this.getPath(c,b,"wall"),g=this.addWallChildren(f,e,!1);if(0==g.length)throw"";if(g.length>1)throw"";var h=this.centerPoint=this.calcCenter(g);this.moveWallToCenter(g,h);var i=this.getPath(c,b,"innerWall"),j=this.addWallChildren(i,e,!0);this.moveWallToCenter(j,h);var k=this.createOther(c,b,h);return d=d.concat(g),d=d.concat(j),d=d.concat(k)},parseXml:function(b){if(a.DOMParser){var c=new DOMParser;return c.parseFromString(b,"text/xml")}b=b.replace(/<!DOCTYPE svg[^>]*>/,"");var d=new ActiveXObject("Microsoft.XMLDOM");return d.async="false",d.loadXML(b),d},calcCenter:function(a){for(var b=99999999,c=99999999,d=-99999999,e=-99999999,f=a.length,g=0;f>g;g++)for(var h=a[g],i=h.data,j=0;j<i.length;j++)b=Math.min(b,i[j][0]),c=Math.min(c,i[j][1]),d=Math.max(d,i[j][0]),e=Math.max(e,i[j][1]);var k=(b+d)/2,l=(c+e)/2;return{x:k,y:l}},moveWallToCenter:function(a,b){for(var c=a.length,d=0;c>d;d++){for(var e=a[d],f=e.data,g=0;g<f.length;g++)f[g][0]-=b.x,f[g][1]-=b.y;if(e.children)for(var h=0;h<e.children.length;h++){var i=e.children[h].position;i[0]-=b.x,i[2]-=b.y}}},addWallChildren:function(a,b,c){var d=[];for(var e in a){var f=a[e];for(var g in f){var h={id:e,position:[0,0,0],children:[]};c||(h.closed=!0,h.showFloor=!0),d.push(h);for(var i=f[g],j=0;j<i.length;j++){var k=i[j];h.data?h.data.push(k.to):h.data=[k.from,k.to];var l=k.shapeId;if(b[l])for(var m in b[l]){var n=b[l][m];n.client=n.client||{},n.client.edgeIndex=j,k.reverse&&(n.client.offset=1-n.client.offset),n.position[0]=(k.to[0]-k.from[0])*n.client.offset+k.from[0],n.position[2]=(k.to[1]-k.from[1])*n.client.offset+k.from[1],h.children.push(n)}}if(!c&&h.data&&h.data.length>1){var o=h.data[0],p=h.data[h.data.length-1];o[0]==p[0]&&o[1]==p[1]&&h.data.splice(h.data.length-1,1)}}}return d},getPath:function(a,b,c){function d(a,b){var c=a.from;a.from=a.to,a.to=c,!b&&a.toShape?(a.fromShape=a.toShape,delete a.toShape,a.fromFrom=a.toFrom,a.fromTo=a.toTo,delete a.toFrom,delete a.toTo):b&&a.fromShape&&(a.toShape=a.fromShape,delete a.fromShape,a.toFrom=a.fromFrom,a.toTo=a.fromTo,delete a.fromFrom,delete a.fromTo),a.reverse=!0}function e(a,b,c,f,g,h){var i=h?g.toShape:g.fromShape;if(i){var j=f[i];if(j&&j.id==a){var k=c.indexOf(j);c.splice(k,1),delete f[i],(h&&g.toTo||!h&&g.fromFrom)&&d(j,h);var l={shapeId:j.shapeId,from:j.from,to:j.to,reverse:j.reverse};h?b.push(l):b.splice(0,0,l),e(a,b,c,f,j,h)}}}var f=this,g={},h={};a.forEach(function(a){var d=a.getAttribute("Master");if(!b[d])return void console.error("master not exist, master=",d,"  masterMap=",b,"  shape=",a);var e=b[d].id,i=make.Default.getType(e);if(i==c){g[e]||(g[e]=[]);var j=f.toFloat(f.findCellAttr(a,"BeginX")),k=-1*f.toFloat(f.findCellAttr(a,"BeginY")),l=f.toFloat(f.findCellAttr(a,"EndX")),m=-1*f.toFloat(f.findCellAttr(a,"EndY")),n=f.toFloat(f.findCellAttr(a,"Width")),o={shapeId:a.getAttribute("ID"),from:[j,k],to:[l,m],width:n,id:e},p=f.findChild(f.findChild(f.findChild(a,"Section","User"),"Row","RX1"),"Cell","Value"),q=f.findChild(f.findChild(f.findChild(a,"Section","User"),"Row","RY1"),"Cell","Value");if(p&&q){var r=p.getAttribute("F").replace("Sheet.",""),s=r.split("!");o.fromShape=s[0],s[1].indexOf("End")>=0?o.fromTo=!0:o.fromFrom=!0}var t=f.findChild(f.findChild(f.findChild(a,"Section","User"),"Row","LX2"),"Cell","Value");f.findChild(f.findChild(f.findChild(a,"Section","User"),"Row","LY2"),"Cell","Value");if(t&&t){var r=t.getAttribute("F").replace("Sheet.",""),s=r.split("!");o.toShape=s[0],s[1].indexOf("End")>=0?o.toTo=!0:o.toFrom=!0}g[e].push(o),h[o.shapeId]=o,a.dirty=!0}});var i={};for(var j in g){var k=g[j],l=[];for(i[j]=l;k.length>0;){var m=[],n=k[0];k.splice(0,1),delete h[n.shapeId];var o={shapeId:n.shapeId,from:n.from,to:n.to};m.push(o),k.length>0&&n.fromShape&&n.toShape?(e(j,m,k,h,n,!0),e(j,m,k,h,n,!1)):k.length>0&&n.fromShape?e(j,m,k,h,n,!1):k.length>0&&n.toShape&&e(j,m,k,h,n,!0),l.push(m)}}return i},createWallChildren:function(a,b){var c=this,d={};return a.forEach(function(a){var e=a.getAttribute("Master");if(!b[e])return void console.error("master not exist, master=",e,"  masterMap=",b,"  shape=",a);var f=b[e].id,g=make.Default.getType(f);if("door"==g||"window"==g){var h=c.findChild(c.findChild(c.findChild(a,"Section","User"),"Row","VisWallRefLn"),"Cell","Value"),i=c.findChild(c.findChild(c.findChild(a,"Section","User"),"Row","PreviousWallParam"),"Cell","Value"),j=h.getAttribute("F").replace("Sheet.",""),k=j.split("!"),l=k[0],m=parseFloat(i.getAttribute("V")),n=c.positionYMap[g]||0,o=c.toFloat(c.findCellAttr(a,"Width")),p=c.toFloat(c.findCellAttr(a,"PinX")),q=-1*c.toFloat(c.findCellAttr(a,"PinY"));d[l]||(d[l]=[]),d[l].push({id:f,width:o,position:[p,n,q],client:{offset:m}}),a.dirty=!0}}),d},createOther:function(a,b,c){var d=this,e=[];return a.forEach(function(a){var f=a.getAttribute("Master");if(!b[f])return void console.error("master not exist, master=",f,"  masterMap=",b,"  shape=",a);var g=b[f].id,h=make.Default.getType(g);if("wall"==h||"innerWall"==h||"door"==h||"window"==h);else{var i={};i.id=g;var j=b[f],k=d.positionYMap[h]||"floor-top",l=d.toFloat(d.findCellAttr(a,"Width"))||j.width,m=d.toFloat(d.findCellAttr(a,"Height"))||j.height,n=d.toFloat(d.findCellAttr(a,"PinX")),o=-1*d.toFloat(d.findCellAttr(a,"PinY")),p=d.toFloat(180*parseFloat(d.findCellAttr(a,"Angle")||"0")/Math.PI,!0);p=(p+360)%360;var q=d.findChildByTag(a,"Text");if(q)for(var r=q.childNodes,s=0;s<r.length;s++)if(3==r[s].nodeType){var t=r[s].textContent;t.indexOf("\n")==t.length-1&&(t=t.substr(0,t.length-1)),i.objectId=t,i.client=i.client||{},i.client.bid=t}i.width=l,i.depth=m,i.position=[n-c.x,k,o-c.y],i.rotation=[0,p,0],e.push(i)}}),e},findCellAttr:function(a,b){for(var c=a.childNodes,d=c.length,e=0;d>e;e++){var f=c[e];if("Cell"==f.tagName&&f.getAttribute("N")==b)return f.getAttribute("V")}},findChild:function(a,b,c){if(a){var d=a.childNodes;if(d)for(var e=d.length,f=0;e>f;f++){var g=d[f];if(g.tagName==b&&g.getAttribute("N")==c)return g}}},findChildByTag:function(a,b){if(a){var c=a.childNodes;if(c)for(var d=c.length,e=0;d>e;e++){var f=c[e];if(f.tagName==b)return f}}},toFloat:function(a,c,d){d===b&&(d=0);var e=parseFloat(a);c||(e*=this.scale);var f=Math.pow(10,d);return Math.round(e*f)/(1*f)}}),d.edit.JsonBox=function(){this._dataList=new mono.List,this._dataMap={},this._dataBoxChangeDispatcher=new TGL.EventDispatcher,this._dataPropertyChangeDispatcher=new TGL.EventDispatcher},twaver.Util.ext(d.edit.JsonBox,Object,{add:function(a){if(a){1===arguments.length&&(index=-1);var b=a.getObjectId();if(this._dataMap.hasOwnProperty(b))throw"Data with ID '"+b+"' already exists";this._dataList.add(a),this._dataMap[b]=a,this._dataBoxChangeDispatcher.fire({kind:"add",data:a,source:this}),a.addPropertyChangeListener(this.handleDataPropertyChange,this)}},contains:function(a){return a?this._dataMap[a.getObjectId()]===a:!1},remove:function(a){if(a){this._dataList.remove(a);var b=a.getObjectId();delete this._dataMap[b],this._dataBoxChangeDispatcher.fire({kind:"remove",data:a,source:this}),a.removePropertyChangeListener(this.handleDataPropertyChange,this)}},getDataById:function(a){return this._dataMap[a]},removeById:function(a){var b=this.getDataById(a);this.remove(b)},getDatas:function(){return this._dataList},clear:function(a){if(this._dataList.size()>0){var b=this._dataList.toList();b.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:b})}},toJson:function(a){var b=[],c=this._dataList;return c.forEach(function(c){var d=c.getId();if("twaver.idc.door"!=d&&"twaver.idc.window"!=d){var e={};c.serializeJson(c,e),(!a||a(c))&&b.push(e)}}),b},fromJson:function(a){for(var b=0;b<a.length;b++){var c=a[b],e=null;if("remove"!==c.action){if(e=this.getDataById(c.objectId),e||(e=new d.edit.data.JsonObject,e.id=c.objectId),e.deserializeJson(e,c),c.children&&c.children.length>0){for(var f=[],g=0;g<c.children.length;g++){var h=c.children[g],i=new d.edit.data.JsonObject(h.objectId);i.id=h.objectId,i.deserializeJson(i,h),f.push(i)}e.setChildren(f)}try{this.add(e)}catch(j){console.error(j)}}else this.removeById(c.objectId)}},handleDataPropertyChange:function(a){var b=a.source;this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)}});var u=function(a){u.superClass.constructor.call(this,a),this.pasteOffsetDy=0,this.contentPane3d=$('<div class="edit3d-container"></div>').appendTo(this.parentView),this.jsonBox=new d.edit.JsonBox,this.edit2d=this.edit2d=new d.edit.Edit2D(this.jsonBox,this),this.edit3d=new d.edit.Edit3D(this.jsonBox,this),this.model3dTo2dMapping=j.sceneEditorModel3dTo2dMapping,this.model2dTo3dMapping=j.sceneEditorModel2dTo3dMapping,this.accordionPane=this.edit2d.accordionPane,this.ruler=this.edit2d.ruler,this.network2d=this.edit2d.network2d,this.box=this.network2d.getElementBox(),this.fileIndex=1,this.init()};u.prototype={init:function(){var a=this;this.edit3d.doubleClickHandler=function(b,c){a.doubleClickHandler3D(b,c)},this.edit2d.doubleClickRackHandler=function(b,c){a.doubleClickHandler2D(b,c)},this.addKeyMoveListener(this.network2d),this.adjustNetwork3dBoundingBox(),this.show2D(),this.hide3D()},adjustNetwork3dBoundingBox:function(){mono.Utils.autoAdjustNetworkBounds(this.edit3d.network3d,this.contentPane3d[0],"clientWidth","clientHeight",0,0)},doubleClickHandler3D:function(a,b){},doubleClickHandler2D:function(a,b){},isHost:function(a){return"wall"==a.getClient("type")},loadDxfFile:function(a,b,c){var e=this.edit2d,f=new d.edit.ImportDxf(.1),g=f.loadDxf(a,c);b&&(g=b(g)),g.sort(function(a,b){return"floor"==make.Default.getOtherParameter(a.id,"sdkCategory")?-1:1}),e.createNodesByJson(g),setTimeout(function(){e.zoomOverview()},500)},loadVsdxFile:function(a,b,c){var d=this.edit2d,e=new t;e.loadVsdx(a,function(a){var c=a[0];b&&(c=b(c)),c.sort(function(a,b){return"floor"==make.Default.getOtherParameter(a.id,"sdkCategory")?-1:1}),d.createNodesByJson(c),setTimeout(function(){d.zoomOverview()},500)})},parentResizeHandle:function(){u.superClass.parentResizeHandle.call(this),this.adjustNetwork3dBoundingBox()},align:function(a){var b=this;if(a){var c=this.edit2d.box.getSelectionModel().getSelection(),d=new twaver.List;c.forEach(function(a){a&&!b.isHost(a)&&d.add(a)}),!d||d.size()<2||make.Default.align(d,a)}},flow:function(a,b){var c=this;if(a){var d=this.edit2d.box.getSelectionModel().getSelection(),e=new twaver.List;d.forEach(function(a){a&&!c.isHost(a)&&e.add(a)}),!e||e.size()<2||make.Default.flow(e,a,b)}},refreshAccordion:function(a){a=a||c.utils.load2dSceneCategory(),this.edit2d.accordionPane.setCategories(a)},show2D:function(){this.contentPane.show(),this.edit2d.layoutGUI()},hide2D:function(){this.contentPane.hide()},show3D:function(){this.contentPane3d.show(),this.adjustNetwork3dBoundingBox(),this.edit3d.refreshNetwork3d()},hide3D:function(){this.contentPane3d.hide(),this.edit3d.box.clear()},zoomOverview:function(){this.edit2d.zoomOverview()},getData:function(a){var b=this,c=this.jsonBox.toJson();if(a){var d=[];return c.forEach(function(a){var c={};make.Default.copyProperties(a,c);var e=c.parentId,f=b.jsonBox.getDataById(e);f&&(f.position=f.position||[0,0,0],c.position=c.position||[0,0,0],c.position[0]-=f.position[0],c.position[2]-=f.position[2]),d.push(c)}),d}return c},setData:function(a,b){var c=this,d={};b&&(a.forEach(function(a){a.objectId&&(d[a.objectId]=a)}),a.forEach(function(a){var b=a.parentId,e=d[b];e||(e=c.jsonBox.getDataById(b)),e&&(e.position=e.position||[0,0,0],a.position=a.position||[0,0,0],a.position[0]+=parseFloat(e.position[0]?e.position[0]:0),a.position[2]+=parseFloat(e.position[2]?e.position[2]:0))})),this.jsonBox.fromJson(a),setTimeout(function(){c.zoomOverview()},100)},getSelectedData:function(){var a=this.edit2d.box.getSelectionModel().getSelection();if(!a||0==a.size())return[];for(var b=[],c=0;c<a.size();c++){var d=a.get(c),e=this.jsonBox.getDataById(d.getId());e?b.push(e):console.warn("jsonObject is null, node.id="+d.getId())}return b},getSelectedNode:function(){var a=this.edit2d.box.getSelectionModel().getSelection();return a&&0!=a.size()?a.toArray():[]},appendData:function(a){return this.jsonBox.add(a)},removeData:function(a){var b=this;return a instanceof Array?a.map(function(a){return b.jsonBox.removeById(a.objectId)}):b.jsonBox.removeById(a.objectId)},removeNode:function(a){var b=this;return a instanceof Array?a.map(function(a){return b.box.removeById(a.getId())}):b.box.removeById(a.getId())},clear:function(){this.jsonBox.clear()},genIds:function(a){a=a||{},type=a.type||"t-l-l",start=a.start||1,toleRance=a.toleRance||15,prefix=a.prefix||"",suffix=a.suffix||"",coreNumLen=a.coreNumLen||2,includeRow=a.includeRow||!0,rowPrefix=a.rowPrefix||"",rowSuffix=a.rowSuffix||"",rowNumLen=a.rowNumLen||2,separator=a.separator||"-";var b=this.box.getSelectionModel().getSelection();if(!b.size())return"no selection";for(var c,d,e,f=type.split("-"),h={},i=f[0],j="t"==i||"b"==i?"y":"x",k=0;k<b.size();k++)if(c=b.get(k),d=Math.round(c.getLocation()[j]),e=Object.keys(h),e.length){var l=!1;for(var m in h)if(Math.abs(d-parseInt(m))<=toleRance){h[m].push(c),l=!0;break}l||(h[d]=[c])}else h[d]=[c];e=Object.keys(h),"t"==i||"l"==i?e.sort():("b"==i||"r"==i)&&e.sort(function(a,b){return b-a});var n=f[1],j="t"==n||"b"==n?"y":"x";if("l"==n||"t"==n)for(var m in h)h[m].sort(function(a,b){return a.getLocation()[j]-b.getLocation()[j]});else if("r"==n||"b"==n)for(var m in h)h(m).sort(function(a,b){return b.getLocation()[j]-a.getLocation()[j]});var o=f[2];if("s"==o)for(var k=0;k<e.length;k++)k%2!==0&&("l"==n||"t"==n?h[e[k]].sort(function(a,b){return b.getLocation()[j]-a.getLocation()[j]}):("r"==n||"b"==n)&&h[e[k]].sort(function(a,b){return a.getLocation()[j]-b.getLocation()[j]}));var p="";e.forEach(function(a,b){row=h[a],includeRow&&(p=rowPrefix+g.padStart(b+1,rowNumLen)+rowSuffix),row.forEach(function(a){a.setClient("bid",prefix+(includeRow?p+separator:"")+g.padStart(start++,coreNumLen)+suffix)})})}},c.SceneEditor=u,c.utils.ext(u,m);var v=d.edit.data.JsonObject=function(a){twaver.PropertyChangeDispatcher.call(this),a=a||{},this.objectId=a.objectId||c.id("JsonObject"),this.name=a.name,this.id=a.id,this.radius=a.radius,this.width=a.width,this.height=a.height,this.depth=a.depth,this.position=a.position,this.rotation=a.rotation,this.color=a.color,this.data=a.data,this.client=a.client||{},this.style=a.style||{},this.children=a.children,this.parentId=a.parentId};twaver.Util.ext(v,twaver.PropertyChangeDispatcher,{_init:function(){},_a:function(){},getObjectId:function(){return this.objectId},getId:function(){return this.id},setId:function(a){var b=this.id;b!=a&&(this.id=a,this.firePropertyChange("id",b,a))},getColor:function(){return this.color},setColor:function(a){var b=this.color;b!=a&&(this.color=a,this.firePropertyChange("radius",b,a))},getParentId:function(){return this.parentId},setParentId:function(a){var b=this.parentId;b!=a&&(this.parentId=a,this.firePropertyChange("parentId",b,a))},getWidth:function(){return this.width},setWidth:function(a){var b=this.width;b!=a&&(this.width=a,this.firePropertyChange("width",b,a))},getHeight:function(){return this.height},setHeight:function(a){var b=this.height;b!=a&&(this.height=a,this.firePropertyChange("height",b,a))},getDepth:function(){return this.depth},setDepth:function(a){var b=this.depth;b!=a&&(this.depth=a,this.firePropertyChange("depth",b,a))},getWallHeight:function(){return this.wallHeight},setWallHeight:function(a){var b=this.wallHeight;b!=a&&(this.wallHeight=a,this.firePropertyChange("wallHeight",b,a))},getName:function(){return this.name},setName:function(a){var b=this.name;b!=a&&(this.name=a,this.firePropertyChange("name",b,a))},isClosed:function(){return this.closed},setClosed:function(a){var b=this.closed;b!=a&&(this.closed=a,this.firePropertyChange("closed",b,a))},isShowFloor:function(){return this.showFloor},setShowFloor:function(a){var b=this.showFloor;b!=a&&(this.showFloor=a,this.firePropertyChange("showFloor",b,a))},getPosition:function(){return this.position},setPosition:function(a){var b=this.position;b!=a&&(this.position=a,this.firePropertyChange("position",b,a))},getRotation:function(){return this.rotation},setRotation:function(a){var b=this.rotation;b!=a&&(this.rotation=a,this.firePropertyChange("rotation",b,a))},getData:function(){return this.data},setData:function(a){var b=this.data;b!=a&&(this.data=a,this.firePropertyChange("data",b,a))},getClient:function(){return this.client},setClient:function(a){var b=this.client;b!=a&&(this.client=a,this.firePropertyChange("client",b,a))},getStyle:function(){return this.style},setStyle:function(a){var b=this.style;b!=a&&(this.style=a,this.firePropertyChange("style",b,a))},getChildren:function(a){return this.children},setChildren:function(a){var b=this.children;b!=a&&(this.children=a,this.firePropertyChange("children",b,a))},serializeJson:function(a,b){this._serializeJsonCommon(a,b),this._serializeJsonType(b),b.client&&(delete b.client.id,delete b.client.objectId,delete b.client.parentId)},_serializeJsonCommon:function(a,b){this.serializePropertyJson("id",a,b),this.serializePropertyJson("objectId",a,b),this.serializePropertyJson("parentId",a,b),this.serializePropertyJson("name",a,b),this.serializePropertyJson("width",a,b),this.serializePropertyJson("wallHeight",a,b),this.serializePropertyJson("height",a,b),this.serializePropertyJson("depth",a,b),a.position&&"0,0,0"!=a.position.toString()&&this.serializePropertyJson("position",a,b),a.rotation&&"0,0,0"!=a.rotation&&this.serializePropertyJson("rotation",a,b),this.serializePropertyJson("data",a,b),this.serializePropertyJson("radius",a,b),this.serializePropertyJson("closed",a,b),this.serializePropertyJson("showFloor",a,b),this.serializePropertyJson("client",a,b),this.serializePropertyJson("style",a,b),this.serializePropertyJson("color",a,b),this.serializeArray("children",a,b)},_serializeJsonType:function(a){var c=make.Default.getType(a.id);if(w[c]){var d=w[c],e=d.client||{},f=d.style||{},g=a.client||{},h=a.style||{};for(var i in e){var j=e[i];g[i]!==b&&(a[j]=g[i],delete g[i])}for(var i in f){var j=f[i];h[i]!==b&&(a[j]=h[i],delete h[i])}}},serializeArray:function(a,b,c){var d=b[a],e=[];if(d&&d instanceof Array&&d.length>0){for(var f=0;f<d.length;f++){var g={};this.serializeJson(d[f],g),e.push(g)}c[a]=e}},serializePropertyJson:function(a,b,c){b[a]&&(c[a]=g.clone(b[a]))},deserializeJson:function(a,b){this._deserializeJsonType(b);for(var c in b)this.deserializePropertyJson(a,b[c],c)},deserializePropertyJson:function(a,b,c){a[c]=g.clone(b)},_deserializeJsonType:function(a){var c=make.Default.getType(a.id);if(w[c]){var d=w[c],e=d.client||{},f=d.style||{},g=a.client||{},h=a.style||{};for(var i in e){var j=e[i];a[j]!==b&&(g[i]=a[j],delete a[j])}for(var i in f){var j=f[i];a[j]!==b&&(h[i]=a[j],delete a[j])}a.client=g,a.style=h}},clone:function(){var a=new v;return make.Default.copyProperties(this,a),a}});var w=c.serializeMap={channel:{client:{rackWidth:"rackWidth",rackDepth:"rackDepth",rackHeight:"rackHeight",rackNumber:"rackNumber",isSingle:"isSingle",side:"side",aisleDepth:"aisleDepth"},style:{},isRemain:!1},area:{client:{label:"label",opacity:"opacity"},style:{"label.xoffset":"labelPositionX","label.yoffset":"labelPositionZ","label.color":"labelColor","label.font":"labelFont"},isRemain:!1}},x=d.edit.interaction.MyCreateShapeNodeInteraction=function(a,b){d.edit.interaction.MyCreateShapeNodeInteraction.superClass.constructor.call(this,a,b)};twaver.Util.ext(d.edit.interaction.MyCreateShapeNodeInteraction,twaver.vector.interaction.CreateShapeNodeInteraction,{handle_mousedown:function(a){if(0===a.button){var b=this.currentPoint||this.network.getLogicalPoint2(a);if(b){if(2===a.detail){if(this.points.size()>2){var c=this.shapeNodeFunction(this.points);if(!c)return;this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new twaver.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.repaint()}}},handle_mousemove:function(a){if(this.points){var b=this.points.get(this.points.size()-1),c=this.network.getLogicalPoint2(a);if(!_twaver.isCtrlDown(a)){var d=c.x-b.x,e=c.y-b.y;Math.abs(d)>=Math.abs(e)?c.y=b.y:c.x=b.x}this.currentPoint=c,this.repaint()}}}),d.edit.interaction.RoomDragInteraction=function(a,b,c){d.edit.interaction.RoomDragInteraction.superClass.constructor.call(this,a),this.propertySheetPane=b,this.jsonBox=c},twaver.Util.ext(d.edit.interaction.RoomDragInteraction,twaver.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","mouseup","dragover","drop","dblclick")},tearDown:function(){this.removeListener("mousedown","mousemove","mouseup","dragover","drop","dblclick")},handle_dblclick:function(a){},handle_dragover:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,a.dataTransfer.dropEffect="copy";for(var b,c=300,d=this.network.getLogicalPoint(a),e=this.network.getElementsAtRect({x:d.x-c/2,y:d.y-c/2,width:c},!0),f=0;f<e.size();f++)e.get(f)instanceof make.Default.WallShapeNode&&(b=e.get(f));if(b){if(this.network.lastElement&&this.network.lastElement!==b&&(this.network.lastElement instanceof make.Default.WallShapeNode&&this.network.lastElement.setClient("focusIndex",-1),this.network.lastElement=null),b instanceof make.Default.WallShapeNode){var g=this.network.getLogicalPoint(a),h=b.getPointIndex(g,c);b.setClient("focusIndex",h),h>=0&&(this.network.lastElement=b)}else this.network.lastElement=null;return!1}},handle_drop:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1;var b=a.dataTransfer.getData("Text");if(!b)return!1;var c=JSON.parse(b),e=g.getSceneEditorModel3dId(c.id),f=g.getSceneEditorModel2dId(e),h=this.network.getElementAt(a);if(c.id)if(c.combo){var i=make.Default.load(c.id);g.createJsonObject(this.jsonBox,i,c.id)}else{var j=(make.Default.getOtherParameter(f,"layer")||900,make.Default.getOtherParameter(f,"type"));if("watercable"===j||"wall"===j||"area"===j||"innerWall"===j||"floor"===j){var j=function(a){var b=[];a.forEach(function(a){b.push(a.x),b.push(a.y)});var c=make.Default.getType(e);if("wall"==c&&b.length<6)return null;if("area"==c&&b.length<6)return null;if("innerWall"==c&&b.length<4)return null;var d=make.Default.load({id:f,data:b});return d};this.network.setAutoShowOrHideGrid(!1),this._createShapeNodeInteractions(j)}else if("door"===j||"window"===j){for(var k=this.network.getLogicalPoint(a),l=300,m=this.network.getElementsAtRect({x:k.x-l/2,y:k.y-l/2,width:l,height:l},!0),n=0;n<m.size();n++)if(m.get(n)instanceof make.Default.WallShapeNode&&(h=m.get(n),h&&h instanceof make.Default.WallShapeNode)){var o=this.network.getLogicalPoint(a);h.setClient("focusIndex",-1);var p=h.getPointIndex(o,l);if(p>=0){var q=h.getPoints(),r=q.get(p),s=q.get(p===q.size()-1?0:p+1),t=s.x-r.x,u=s.y-r.y,v=Math.abs(t)>Math.abs(u)?(o.x-r.x)/t:(o.y-r.y)/u,w=(Math.atan((r.y-s.y)/(r.x-s.x)),{});Math.abs(o.x-r.x)<=l/2&&(w={x:r.x,y:10*Math.round(o.y/10)}),Math.abs(o.y-r.y)<=l/2&&(w={x:10*Math.round(o.x/10),y:r.y});var x=new d.edit.data.JsonObject;x.id=e,x.position=[o.x,0,o.y],"window"===make.Default.getOtherParameter(f,"type")?(x.position=[w.x,30,w.y],x.setWidth(120)):"door"===make.Default.getOtherParameter(f,"type")&&(x.position=[w.x,0,w.y],x.setWidth(205)),x.client={edgeIndex:p,offset:v},x.client.id=e;var y=this.jsonBox.getDataById(h.getId());if(this.jsonBox.remove(y),y){var z=y.getChildren()||[];z.push(x),y.setChildren(z)}this.jsonBox.add(y)}}}else{this.network.getSelectionModel().clearSelection();var A=this.network.getLogicalPoint(a),B=[A.x,"floor-top",A.y],C=make.Default.getModelDefaultParameters(g.getSceneEditorModel2dId(e));C&&C.positionY&&(B[1]=C.positionY.value);var D=new d.edit.data.JsonObject;D.id=e,D.position=B,D.client=c,D.client.id=D.id,this.jsonBox.add(D);var E=this.network.getElementBox();this.network.getSelectionModel().appendSelection(E.getDataById(D.getObjectId()))}}return this._setNetworkCreateShapeNodeCursor(),!1},_createShapeNodeInteractions:function(a){this.network.setInteractions([new x(this.network,a),new twaver.vector.interaction.DefaultInteraction(this.network)])},_setNetworkCreateShapeNodeCursor:function(){var a=this;this.network.getInteractions().forEach(function(b){b instanceof twaver.vector.interaction.CreateShapeNodeInteraction&&(a.network.getView().style.cursor="crosshair")})},handle_mousedown:function(a){if(this.mouseDown=!0,this.lastLogicalPoint=this.network.getLogicalPoint(a),this.lastLogicalPoint){var b=this.network.getElementAt(a);if(!b||g.isMoveModel(b)){if(b instanceof make.Default.WallShapeNode)if(resize=this.network.getElementUI(b).isPointOnBorderLine(this.lastLogicalPoint),null!==resize)this.lastElement=b,this.network.isMovable=function(a){return!1};else{var c=b.getPointIndex(this.network.getLogicalPoint(a));c>=0&&(this.lastIndex=c,this.lastElement=b,this.network.isMovable=function(a){return!1})}b instanceof make.Default.Block&&(this.block=b)}}},handle_mousemove:function(a){var b;if(this._setNetworkCreateShapeNodeCursor(),this.mouseDown){var c=this.network.getLogicalPoint(a);if(!c)return this.network.getView().scrollTop+=10,void(this.network.getView().scrollLeft+=10);if(this.lastElement&&!g.isMoveModel(this.lastElement))return;if(this.block&&!g.isMoveModel(this.block))return;if(offsetX=this.lastLogicalPoint?c.x-this.lastLogicalPoint.x:0,
offsetY=this.lastLogicalPoint?c.y-this.lastLogicalPoint.y:0,this.lastIndex>=0){g.stopPropagation(a);var d=this.lastElement.getPoints(),e=d.get(this.lastIndex),f=d.get(this.lastIndex===d.size()-1?0:this.lastIndex+1);this.network.enableSingleOrientationMove?this.mouseMoved||(this.horizontal=e.x==f.x,this.vertical=!this.horizontal,this.mouseMoved=!0):!this.mouseMoved&&_twaver.isCtrlDown(a)&&(this.horizontal=Math.abs(offsetX)>=Math.abs(offsetY),this.vertical=!this.horizontal,this.mouseMoved=!0),this.vertical||(e.x+=offsetX,f.x+=offsetX),this.horizontal||(e.y+=offsetY,f.y+=offsetY),this.lastElement.firePointsChange(null,this.lastElement.getPoints()),this.lastLogicalPoint=c}if(this.block){var h=this.block.getClient("edgeIndex"),i=this.block.getClient("length"),j=this.block.getClient("offset"),d=this.block.getParent().getPoints(),e=d.get(h),f=d.get(h===d.size()-1?0:h+1),k=f.x-e.x,l=f.y-e.y,m=Math.abs(k)>Math.abs(l),n=m?offsetX:offsetY,o=n;if(this.block.getClient("focusLeft"))m?k>0&&(o=-o):(k>=0&&0>l&&(n=-n),k>=0&&l>0&&(o=-o),0>k&&l>0&&(n=-n,o=-o)),this.block.setClient("length",i-n),this.block.setClient("offset",j-o/Math.abs(m?k:l)/2);else if(this.block.getClient("focusRight"))m?0>k&&(o=-o):(k>=0&&0>l&&(n=-n,o=-o),0>k&&l>0&&(n=-n),0>k&&0>l&&(o=-o)),this.block.setClient("length",i+n),this.block.setClient("offset",j+o/Math.abs(m?k:l)/2);else{var j=Math.abs(k)>Math.abs(l)?(c.x-this.lastLogicalPoint.x)/k:(c.y-this.lastLogicalPoint.y)/l;this.block.setClient("offset",this.block.getClient("offset")+j)}this.lastLogicalPoint=c}null!==b&&this.lastElement&&(0===b?(this.lastElement.setLocation(this.lastElement.getX()+offsetX,this.lastElement.getY()+offsetY),this.lastElement.setSize(this.lastElement.getWidth()-offsetX,this.lastElement.getHeight()-offsetY)):1===b?(this.lastElement.setLocation(this.lastElement.getX(),this.lastElement.getY()+offsetY),this.lastElement.setSize(this.lastElement.getWidth()+offsetX,this.lastElement.getHeight()-offsetY)):2===b?this.lastElement.setSize(this.lastElement.getWidth()+offsetX,this.lastElement.getHeight()+offsetY):3===b&&(this.lastElement.setLocation(this.lastElement.getX()+offsetX,this.lastElement.getY()),this.lastElement.setSize(this.lastElement.getWidth()-offsetX,this.lastElement.getHeight()+offsetY)),this.lastLogicalPoint=c)}else{var p=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(p&&!g.isMoveModel(p))return;if(this.lastElement&&this.lastElement!==p&&(this.lastElement instanceof make.Default.WallShapeNode&&(this.lastElement.setClient("focusIndex",-1),this.network.getView().style.cursor="default"),this.lastElement instanceof make.Default.Block&&(this.lastElement.setClient("focus",!1),this.lastElement.setClient("focusLeft",!1),this.lastElement.setClient("focusRight",!1),this.network.getView().style.cursor="default"),this.lastElement=null),p instanceof make.Default.WallShapeNode)if(b=this.network.getElementUI(p).isPointOnBorderLine(c),null!==b)this.lastElement=p,this.network.getView().style.cursor="move";else{var h=p.getPointIndex(c);p.setClient("focusIndex",h),h>=0?(this.lastElement=p,_twaver.isAltDown(a)?this.network.getView().style.cursor=this.addPointCursor:this.network.getView().style.cursor="move"):p.isPointOnPoints(c)||(this.network.getView().style.cursor="default")}else p instanceof make.Default.Block?(p.setClient("focus",!0),this.network.getSelectionModel().contains(p)&&_twaver.math.getDistance(c,p.getClient("leftPoint"))<=10?(p.setClient("focusLeft",!0),p.setClient("focusRight",!1),this.network.getView().style.cursor="move"):this.network.getSelectionModel().contains(p)&&_twaver.math.getDistance(c,p.getClient("rightPoint"))<=10?(p.setClient("focusLeft",!1),p.setClient("focusRight",!0),this.network.getView().style.cursor="move"):(p.setClient("focusLeft",!1),p.setClient("focusRight",!1),this.network.getView().style.cursor="default"),this.lastElement=p):this.lastElement=null}},handle_mouseup:function(a){this.mouseDown=!1,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.lastIndex=-1,this.lastElement=null,this.lastLogicalPoint=null,this.block=null,this.resize=!1,this.network.getView().style.cursor="default",delete this.network.isMovable},getAllElementsAt:function(a){var b={x:a.x-1,y:a.y-1,width:2,height:2},c=this.network.getElementsAtRect(b,!0,null,!1);return c},findFirstFloorAt:function(a){var b=this.getAllElementsAt(a);if(b)for(var c=0;c<b.size();c++)if(b.get(c)instanceof d.edit.data.FloorShapeNode)return b.get(c)}}),d.edit.interaction.RoomEditInteraction=function(a,b){d.edit.interaction.RoomEditInteraction.superClass.constructor.call(this,a)},twaver.Util.ext(d.edit.interaction.RoomEditInteraction,twaver.vector.interaction.EditInteraction,{deletePointCursor:"url('data:image/png;base64,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'),auto",setUp:function(){d.edit.interaction.RoomEditInteraction.superClass.setUp.apply(this,arguments)},tearDown:function(){d.edit.interaction.RoomEditInteraction.superClass.setUp.apply(this,arguments)},handle_mouseup:function(a){if(this.isStart){var b=_twaver.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new twaver.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection})});twaver.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&b){var e=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&b){var e=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},_isEditingShapeNode:function(a,b){if(this.node instanceof twaver.ShapeNode){this.shapeNode=this.node;for(var c=this.shapeNode.getPoints(),d=this.network.getEditPointSize(),e=0,f=c.size();f>e;e++){var g=c.get(e);if(this._contains(a,g,d))return _twaver.isAltDown(b)?this._setCursor(this.deletePointCursor):this._setCrossCursor(),this.pointIndex=e,!0}if(!this.shapeNode.getPointIndex)return!1;if(null!=this.shapeNode.getPointIndex(a)&&this.shapeNode.getPointIndex(a)>=0)return!0}return this.pointIndex=-1,!1},_resetShapeNodePoints:function(a){if(this.lastPoint){if(!_twaver.isCtrlDown(event)){var b=a.x-this.lastPoint.x,c=a.y-this.lastPoint.y;Math.abs(b)>=Math.abs(c)?a.y=this.lastPoint.y:a.x=this.lastPoint.x}}else this.lastPoint=a;d.edit.interaction.RoomEditInteraction.superClass._resetShapeNodePoints.call(this,a)},handle_mousemove:function(a){if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(a);return}if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a);var b=this.network.getLogicalPoint2(a);if(this.node&&this.node instanceof twaver.ShapeNode&&this.node.getPointIndex(b)&&this.node.getPointIndex(b)>=0)return void(this.network._dragToPan=!1)}else{this.lastPoint=null;var c=this.network.getElementAt(a);if(!c||g.isMoveModel(c)){if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var d=this.network.getElementUI(c);if(!d||!d.getEditAttachment())return void this.clear();var b=this.network.getLogicalPoint2(a);if(c instanceof twaver.ShapeNode&&(b=this.network.getLogicalPoint(a)),c instanceof twaver.Node){if(this.node=c,this.node instanceof make.Default.Block)return this.network._dragToPan=!1,void(this.isStart=!0);if(this._isEditingShapeNode(b,a)||this._isResizingNode(b))return void this.network.setEditingElement(!0);if(this._isRotatingElement(b))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(c instanceof twaver.ShapeLink){if(this.shapeLink=c,this._isEditingShapeLink(b))return void this.network.setEditingElement(!0)}else if(d instanceof twaver.network.LinkUI&&twaver.Link.isOrthogonalLink(d._element)){this.linkUI=d;var e=this.linkUI.getControlPoint();return void(e&&this._contains(b,e)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}this.clear()}}}},handle_mousedown:function(a){if(0===a.button)if(!_twaver.isAltDown(a)||this.network.isEditingElement()){if(this.network.isEditingElement()&&!this.isStart&&!this.isStartRotate)if(this.node&&this.resizeDirection)this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0){var b=this.shapeNode.getPoints()._as.length;_twaver.isAltDown(a)?2==b?confirm("You will delete the entire wall, Sure to Delete")&&(this.shapeNode.removeAt(0),this.shapeNode.removeAt(1),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):confirm("Sure to Delete")&&(3==b&&this.shapeNode.setClient("shapenode.closed",!1),this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex}))}else this.shapeLink&&this.pointIndex>=0?_twaver.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.shapeNode?this.isStart=!0:this.node&&(this.node.getClient("className")&&"mono.Billboard"==this.node.getClient("className")||(this.isStartRotate=!0,this._handle_mousedown(a)))}else{var c=this.network.getElementAt(a),d=this.network.getLogicalPoint(a);if(c instanceof twaver.ShapeNode){var e=this.getPointIndex(c.getPoints(),d,!0);e>0&&(this._handle_mousedown(a),this.pointIndex=e,this.shapeNode=c,c.addPoint(d,e),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:c,pointIndex:e}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:c,pointIndex:e}))}if(c instanceof twaver.ShapeLink){var f=new twaver.List(c.getPoints()),g=this.network.getElementUI(c);f.add(g.getFromPoint(),0),f.add(g.getToPoint());var e=this.getPointIndex(f,d)-1;e>0&&(this._handle_mousedown(a),this.pointIndex=e,this.shapeLink=c,c.addPoint(d,e),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:c,pointIndex:e}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:c,pointIndex:e}))}}},clear:function(){d.edit.interaction.RoomEditInteraction.superClass.clear.apply(this,arguments),this.network.setRotatePointSize(twaver.Defaults.NETWORK_ROTATE_POINT_SIZE)}}),d.edit.interaction.RoomListener=function(a,b,c){d.edit.interaction.RoomListener.superClass.constructor.apply(this,arguments),this.network=a,this.propertySheetPane=b,this.jsonBox=c,this.box2d=this.network.getElementBox(),this.initLayer()},twaver.Util.ext(d.edit.interaction.RoomListener,Object,{initLayer:function(){for(var a=this.box2d.getLayerBox(),b=100;900>=b;b+=100){var c=new twaver.Layer(b);a.add(c)}},initRoomSettings:function(){this.network.enableSingleOrientationMove=!1,this.network.getView().setAttribute("draggable","true"),this.network.setEditPointFillColor("yellow"),this.network.setEditPointOutlineColor("#333333"),this.network.setEditPointOutlineWidth(1),this.network.setEditPointSize(10),this.network.setResizePointSize(0),this.network.setToolTipEnabled(!1),this.network.setKeyboardRemoveEnabled(!1),this.network.setRotatePointFillColor("yellow"),this.interactions2d=[new d.edit.interaction.RoomDragInteraction(this.network,this.propertySheetPane,this.jsonBox),new d.edit.interaction.RoomEditInteraction(this.network),new twaver.vector.interaction.DefaultInteraction(this.network)],this.network.setInteractions(this.interactions2d),this.installNetwork2dFunctions(this.network),this.installNetwork2dListeners(this.network)},installNetwork2dFunctions:function(a){a.isRotatable=function(a){return g.isChild(a)?!1:g.isEditModel(a)},a.isEditable=function(){return!0},a.setMovableFunction(function(a){return g.isChild(a)?!1:g.isMoveModel(a)}),a.setEditableFunction(function(a){return g.isChild(a)?!1:g.isEditModel(a)})},installNetwork2dListeners:function(a){var b=this;a.getElementBox().addDataBoxChangeListener(this.handleDataBoxChange,this),a.addElementByInteraction=function(a){twaver.vector.Network.prototype.addElementByInteraction.call(this,a),setTimeout(function(){b.network.setInteractions(b.interactions2d)},100)}},handleDataBoxChange:function(a){var b=a.kind,c=a.data;if("add"===b){var d=g.getSceneEditorModel2dId(c.getClient("id"));c.setLayerId(make.Default.getOtherParameter(d,"layer")||900);var e=make.Default.getOtherParameter(d,"type");e&&e.indexOf("wall")>=0}}})}(window),function(a,b){var c={};a.it=c,c.version="v1.0.0";var d=c.Util={};d._debug=!0,d.dropImg=new Image,d.dropImg.src="data:image/png;base64,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",
d.dropImg.client={width:318,height:442,size:50,lineWidth:5,color:"#FFFFFF",startX:100,startY:300,withUnit:!0},d._blue=new Image,d._blue.src="data:image/png;base64,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",d._green=new Image,d._green.src="data:image/png;base64,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",d._yellow=new Image,d._yellow.src="data:image/png;base64,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",
d._red=new Image,d._red.src="data:image/png;base64,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",d._imgMaps={},d.registerImg=function(a,b,c){var e=new Image;if(e.src=b,e.client={},c)for(var f in c)e.client[f]=c[f];d._imgMaps[a]=e},d.isDebug=function(){return d._debug},d.checkNotNull=function(a,b){if(null==a){if(b)throw b+"can't be null";return!1}return!0},d.translateJson=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){}return a},d.clone=function(a){var b;if("object"==typeof a)if(null===a)b=null;else if(a instanceof Array){b=[];for(var c=0,e=a.length;e>c;c++)b.push(d.clone(a[c]))}else{b={};for(var f in a)"function"!=typeof b[f]&&"_alarmState"!=f&&(b[f]=d.clone(a[f]))}else b=a;return b},d.getComputedStyle=function(b){return b.currentStyle?b.currentStyle:a.getComputedStyle(b,null)},d.updateEmptyBillboardContent=function(a,b,c){var c=this.ext({contentX:0,contentY:0,contentWidth:a.args.width,contentHeight:a.args.height-a.args.arrowHeight},c);c=this.ext(a.args,c);var d=this.getBillboardContent(c),e=d.getContext("2d");e.drawImage(b,c.contentX,c.contentY,c.contentWidth,c.contentHeight),a.s({"m.texture.image":d})},d.updateTextBillboardText=function(a,b,d){b=b||"";var e=c.Util.getTextBillboardContent(b,d);this.updateTextBillboardContent(a,e)},d.updateTextBillboardContent=function(a,b){a.s({"m.texture.image":b}),a.contentWidth=b.width,a.contentHeight=b.height,a.setScale(b.width/2,b.height/2,1)},d.updateTitleBillboardContent=function(a,b){var d=a.contentWidth,e=a.contentHeight,f=a.title,g=c.Util.getTitleBillboardContent(f,b,d,e,a.content);a.s({"m.texture.image":g})},d.createEmptyBillboardForNode=function(a,b){var c=this.createEmptyBillboard(b),d=a.getBoundingBox();return c.setParent(a),c.p(0,d.max.y,0),c},d.createEmptyBillboard=function(a){a=c.Util.ext({width:256,height:128,radius:16,arrowWidth:16,arrowHeight:16,bgColor:"#5B85B5"},a);var b=this.getBillboardContent(a),d=new mono.Billboard;return d.s({"m.texture.image":b,"m.transparent":!0,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.vertical":!1}),d.args=a,d.setScale(a.width,a.height,1),d.setSelectable(!1),d.contentWidth=a.width,d.contentHeight=a.height,d.isEmptyBillboard=!0,d},d.createTitleBillboardForNode=function(a,b){var c=this.createTitleBillboard(b),d=a.getBoundingBox();return c.setParent(a),c.p(0,d.max.y,0),c},d.getTitleBillboardContent=function(a,b,c,d,e){var f=document.createElement("canvas");f.width=c,f.height=d;var g=f.getContext("2d");return g.save(),g.drawImage(a,Math.max(0,(f.width-a.width)/2),0,a.width,a.height),g.translate(0,a.height),e&&g.drawImage(e,Math.max(0,(f.width-e.width)/2),0,e.width,e.height,0,0,c,d-a.height),g.drawImage(b,Math.max(0,(f.width-b.width)/2),0,b.width,b.height,0,0,c,d),f},d.createTitleBillboard=function(a){a=c.Util.ext({title:"",titleColor:"#FFFFFF",titleFont:"24px LEDFont,sans-serif",titleBgColor:"#4a74a4",titleWidth:256,titleHeight:32,titleRadius:16,width:256,height:128,radius:0,arrowWidth:0,arrowHeight:0,bgColor:"#5B85B5"},a);var b=this.getBillboardTitle(a),d=this.getBillboardContent(a),e=Math.max(b.width,d.width),f=b.height+d.height,g=c.Util.getTitleBillboardContent(b,d,e,f),h=new mono.Billboard;return h.title=b,h.content=d,h.s({"m.texture.image":g,"m.transparent":!0,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.vertical":!1}),h.args=a,h.setScale(g.width,g.height,1),h.setSelectable(!1),h.contentWidth=e,h.contentHeight=f,h.isTitleBillboard=!0,h},d.createTextBillboard=function(a,b){var c=this.getTextBillboardContent(a,b),d=new mono.Billboard;return d.s({"m.texture.image":c,"m.transparent":!0,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.vertical":!1,"m.texture.wrapS":TGL.ClampToEdgeWrapping,"m.texture.wrapT":TGL.ClampToEdgeWrapping}),d.setScale(c.width/2,c.height/2,1),d.setSelectable(!1),d.contentWidth=c.width,d.contentHeight=c.height,d.isTextBillboard=!0,d},d.createTextBillboardForNode=function(a,b,c){b=b||"";var d=this.createTextBillboard(b,c),e=a.getBoundingBox();return d.setParent(a),d.p(0,e.max.y,0),d},d.createSpecailTextBillboard=function(a,b,c,d){var e=null;e=c?this.getHumOrTempCanvas(a,null,null,b,d):this.getSpecialTextBillboard(a,null,null,b,d);var f=new mono.Billboard;return f.s({"m.texture.image":e,"m.transparent":!0,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.vertical":!1}),f.setScale(e.width/2,e.height/2,1),f.setSelectable(!1),f.contentWidth=e.width,f.contentHeight=e.height,f.isTextBillboard=!0,f.invalidateTexture(),f},d.getImageById=function(a,b){return a?this._imgMaps&&this._imgMaps[a]?this._imgMaps[a]:this[a]?this[a]:this.dropImg:this.dropImg},d.getHumOrTempCanvas=function(a,b,c,d,e){var f=this.getImageById(d,a),e=e||document.createElement("canvas");if(!f)return e;f.client||(f.client={width:318,height:442,size:50,lineWidth:5,color:"#FFFFFF",startX:100,startY:300}),color=f.client.color||"#888888";var g=f.width,h=f.height,i=e.getContext("2d");g=f.client.width||2*f.width,h=f.client.height||2*f.height,e.height=h,e.width=g,i.drawImage(f,0,0,g,h);var j=parseInt(f.client.startX)||h-50,k=parseInt(f.client.startY)||h-50;if(a){var l=parseInt(f.client.size)||80;i.font=l+'px "Microsoft Yahei" ',i.strokeStyle=color,i.fillStyle=color,i.textAlign="left",i.textBaseline="middle",i.lineWidth=parseInt(f.client.lineWidth)||8,f.client.stroke?i.strokeText(a,j,k):i.fillText(a,j,k)}return e},d.createHumOrTempCanvas=function(a,b,d,e){var f=c.Util.getImageById(d,a),e=e||document.createElement("canvas");if(!f)return e;f.client||(f.client={width:256,height:123,size:50,lineWidth:5,color:"#FFFFFF",startX:20,startY:60}),color=f.client.color||"#888888";var g=f.width,h=f.height,i=e.getContext("2d");g=f.client.width||2*f.width,h=f.client.height||2*f.height,e.height=h,e.width=g,i.drawImage(f,0,0,g,h);var j=parseInt(f.client.startX)||h-50,k=parseInt(f.client.startY)||h-50;if(a){var l=parseInt(f.client.size)||80,m=f.client.fontFamily||'"Microsoft Yahei"';if(i.font="bold "+l+"px "+m,i.textAlign="left",i.textBaseline="middle",i.lineWidth=parseInt(f.client.lineWidth)||8,f.client.stroke?(i.strokeStyle=color,i.strokeText(a,j,k)):(i.fillStyle=color,i.fillText(a,j,k)),f.client.withUnit&&b){var g=i.measureText(a).width,n=parseInt(l/2)||5;i.font="bold "+n+'px "Microsoft Yahei"',f.client.stroke?i.strokeText(b,j+g,k):i.fillText(b,j+g,k)}}return e},d.getSpecialTextBillboard=function(a,b,c,d,e){var f,g,e=e||document.createElement("canvas"),h=e.getContext("2d");f=512,g=256;var i=g/4,j=f/4;e.height=g+i,e.width=f,this.getBillboardContent({width:f,height:g+i,radius:f/16,arrowWidth:j,arrowHeight:i,bgColor:d,canvas:e});var k="white";if(b){var l=50;h.font=l+'px "Microsoft Yahei" ',h.fillStyle=k,h.textAlign="left",h.textBaseline="middle",h.fillText(b,g/10,g/5)}if(a){var m=120;h.font=m+'px "Microsoft Yahei" ',h.fillStyle=k,h.textAlign="left",h.textBaseline="middle",h.fillText(a,2*g/10,2*g/3),h.strokeStyle=k,h.lineWidth=4,h.strokeText(a,2*g/10,2*g/3)}if(c){var n=60;h.font=n+'px "Microsoft Yahei" ',h.fillStyle=k,h.textAlign="right",h.textBaseline="middle",h.fillText(c,f-g/10,g/2+20)}return e},d.getTextBillboardContent=function(a,b,d){d=d||{};var e=document.createElement("canvas"),f=e.getContext("2d");f.font="120px LEDFont,sans-serif";var g=[];g=a.indexOf("\n")?a.split("\n"):[a];for(var h=0,i=0;i<g.length;i++)h=0==i?f.measureText(g[i]).width:Math.max(f.measureText(g[i]).width,h);var j=mono.Utils.getMaxTextSize(g,f.font),k=mono.Utils.nextPowerOfTwo(h),l=j.height,m=l/4,n=k/4,o=mono.Utils.nextPowerOfTwo(l+m);e.height=o,e.width=k;var p=o/g.length;l/g.length;d=c.Util.ext({labelColor:"white",width:k,height:o,radius:k/16,arrowWidth:n,arrowHeight:m,bgColor:b,canvas:e},d),this.getBillboardContent(d),f.fillStyle=d.labelColor,f.textBaseline="middle",f.font="120px LEDFont,sans-serif";for(var i=0;i<g.length;i++){var q=g[i];h=f.measureText(q).width,f.fillText(q,(k-h)/2,p*(i+.5))}return e},d.getBillboardTitle=function(a){var b=a.titleWidth=mono.Utils.nextPowerOfTwo(a.titleWidth)||192,c=a.titleHeight=mono.Utils.nextPowerOfTwo(a.titleHeight)||64,d=a.titleRadius||8,e=a.canvas;e||(e=document.createElement("canvas"),e.width=b,e.height=c);var f=e.getContext("2d");f.globalAlpha=a.globalAlpha||.8,f.fillStyle=a.titleBgColor||"#5B85B5",f.font=a.titleFont||"120px LEDFont,sans-serif";var g=a.titleSizeWidth=f.measureText(a.title).width;a.titleSizeHeight=mono.Utils.getMaxTextSize(a.title,a.titleFont);return f.beginPath(),f.moveTo(0,c),f.lineTo(0,d),f.arcTo(0,0,d,0,d),f.lineTo(b-d,0),f.arcTo(b,0,b,d,d),f.lineTo(b,c),f.closePath(),f.fill(),f.textBaseline="top",f.fillStyle=a.titleColor||"#A5855B",f.fillText(a.title,(b-g)/2,2),f.restore(),f.restore(),e},d.getBillboardContent=function(a){a=c.Util.ext({width:256,height:128,radius:20,arrowWidth:50,arrowHeight:30},a);var b=a.width,d=a.height,e=a.radius,f=a.arrowWidth,g=a.arrowHeight,h=a.canvas;if(h||(h=document.createElement("canvas"),h.width=b,h.height=d),!a.isHumOrTemp){var i=h.getContext("2d");i.globalAlpha=a.globalAlpha||.8,i.fillStyle=a.bgColor||"#5B85B5",i.save(),i.beginPath(),i.moveTo(e,0),i.lineTo(b-e,0),i.arcTo(b,0,b,e,e),i.lineTo(b,d-g-e),i.arcTo(b,d-g,b-e,d-g,e),i.lineTo(b/2+f/2,d-g),i.lineTo(b/2,d),i.lineTo(b/2-f/2,d-g),i.lineTo(e,d-g),i.arcTo(0,d-g,0,d-g-e,e),i.lineTo(0,e),i.arcTo(0,0,e,0,e),i.closePath(),i.fill(),i.restore()}return h},d.getNodeCenterPosition=function(a){if(!a)return null;var b=a.getBoundingBox(),c=(b.max.x+b.min.x)/2*a.getScaleX(),d=(b.max.y+b.min.y)/2*a.getScaleY(),e=(b.max.z+b.min.z)/2*a.getScaleZ(),f=a.getWorldPosition();return f.setX(f.x+c),f.setY(f.y+d),f.setZ(f.z+e),f},d.formatDate=function(a,b){if(!a||!b)return null;var c={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in c)new RegExp("("+d+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[d]:("00"+c[d]).substr((""+c[d]).length)));return b},d.formateDateTime=function(a){if(!a)return"";if("string"==typeof a){var b=new Date(a),d=b.getTime()+6e4*b.getTimezoneOffset();a=new Date(d)}return a instanceof Date?c.Util.formatDate(a,"yyyy-MM-dd hh:mm:ss"):a},d.ext=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||jQuery.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&(jQuery.isPlainObject(e)||(f=jQuery.isArray(e)))?(f?(f=!1,g=d&&jQuery.isArray(d)?d:[]):g=d&&jQuery.isPlainObject(d)?d:{},h[c]=jQuery.extend(k,g,e)):e!==b&&(h[c]=e));return h},d.jsonUtil={object2String:function(a){try{var b=JSON.stringify(a);return b}catch(c){if(d.isDebug())throw c;console.error("json",a)}},string2Object:function(a){try{var b=JSON.parse(a);return b}catch(c){console.error("json",a)}}},d.o2s=function(a){return d.jsonUtil.object2String(a)},d.s2o=function(a){return d.jsonUtil.string2Object(a)},d.toJsonArray=function(a){if(!a)return[];var b=a;"string"==typeof a&&(b=d.s2o(a));var c;return c=b instanceof Array?b:[b]},d.findFirstObjectByMouse=function(a,b,c){c||(c=function(a){return!(a instanceof mono.Billboard)});var d=a.getElementsByMouseEvent(b);if(d.length)for(var e=0;e<d.length;e++){var f=d[e],g=f.element;if(c(g))return f}return null},d.compare=function(a,b){return a==b?0:0==a.length?1:0==b.length?-1:a>b?1:b>a?-1:0},d.getEstimateOverviewPositionAndTarget=function(a,b){if(!a)return null;var c=a.getCamera(),d=a.getNetworkBoundingBox();if(null==d)return null;var e=d.center(),f=new mono.Vec3(0,d.max.y-d.min.y,d.max.z-d.min.z),g=new mono.Vec3(d.max.x-d.min.x,0,0,0),h=f.clone();h.length()<g.length()&&(h=g.clone());var i;if(b){var j=f.length();f.y=f.z*Math.tan(b/180*Math.PI),f.setLength(j)}i=(new mono.Vec3).addVectors(e,f.multiplyScalar(.5));var k=c.fov,l=(c.aspect,h.length()/2/Math.tan(k*Math.PI/180));return i.add(f.normalize().multiplyScalar(l)),{target:e,position:i}},d.getBoundingBox=function(a,b){if(!a)return null;if(a instanceof mono.Billboard)return null;var c=a.getBoundingBox?a.getBoundingBox():null;if(!b&&c&&c.size().x&&c.size().x!=-(1/0)&&c.size().x!=1/0)return c;var e=[],f=a.clonePrefab();return f.setPosition(0,0,0),d.getTransformVertices(f,e),c=new mono.BoundingBox,c.setFromPoints(e),c},d.getTransformVertices=function(a,b){null==b&&(b=[]);var c,e;if(a instanceof TGL.Node||a instanceof TGL.Billboard){for(c=0;c<a.vertices.length;c++)e=a.vertices[c].clone(),a instanceof TGL.Billboard?(e.x*=a.rotation3d.x,e.y*=a.rotation3d.y,e.add(a.getPosition())):e.applyMatrix4(a.worldMatrix),b.push(e);for(var c=0;c<(a._childList?a._childList.size():0);c++){var f=a._childList.get(c);f.getClient("it_data_id")==a.getClient("it_data_id")&&"parkSkybox"!=a.getClient("type")&&d.getTransformVertices(f,b)}}return b},d.playCameraAnimation=function(a,b,c,e,f){if(d.activeAnimates&&d.activeAnimates instanceof Array)for(var g=0;g<d.activeAnimates.length;g++)d.activeAnimates[g].stop();if(b=b||a.p(),c=c||a.getTarget(),b.equals(a.getPosition())&&c.equals(a.target))return f&&f(),null;var h=a.getPosition().sub(a.getTarget()),i=(new mono.Vec3).addVectors(h,c);e=e||3e3;var j=mono.Utils.getVectorAngles(c,i),k=mono.Utils.getVectorAngles(c,b),l=k[0]-j[0];l>180?l-=360:-180>l&&(l+=360);var m=k[1]-j[1];m>180?m-=360:-180>m&&(m+=360);var n=a.getTarget(),o=c,p=a.getDistance(),q=(new mono.Vec3).subVectors(b,c).length(),r=j[0],s=j[1],t=k[0],u=k[1],v=new mono.Animate({from:0,to:1,repeat:1,dur:e/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(b){var c=t,d=s>u?s+m*b:u,e=o,f=p+(q-p)*b;q>p&&0==l&&s>u&&(f=q);var g=new mono.Vec3;g.x=e.x+f*Math.sin(c*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(d*mono.Utils.DEGREES_TO_RADIANS),g.z=e.z+f*Math.cos(c*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(d*mono.Utils.DEGREES_TO_RADIANS),g.y=e.y+f*Math.sin(d*mono.Utils.DEGREES_TO_RADIANS),a.p(g),a.lookAt(e)},onDone:function(){f&&f()},onStop:function(){}}),w=new mono.Animate({from:0,to:1,repeat:1,dur:e/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(b){var c=r+l*b,d=s>u?s:u,e=o,f=p>q?p:q;p>q&&u>=s&&(f=p+(q-p)*b);var g=new mono.Vec3;g.x=e.x+f*Math.sin(c*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(d*mono.Utils.DEGREES_TO_RADIANS),g.z=e.z+f*Math.cos(c*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(d*mono.Utils.DEGREES_TO_RADIANS),g.y=e.y+f*Math.sin(d*mono.Utils.DEGREES_TO_RADIANS),a.p(g),a.lookAt(e)},onDone:function(){p=a.getDistance(),n=a.getTarget()},onStop:function(){this.isPlaying&&(delete this.isPlaying,u>=s?f&&f():v.play())}}),x=new mono.Animate({from:0,to:1,dur:e/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(b){var c=r,d=s>u?s:s+m*b,e=(new mono.Vec3).lerpVectors(n,o,b),f=p+(q-p)*b;p>q&&(0!=l||s>u)&&(f=p);var g=new mono.Vec3;g.x=e.x+f*Math.sin(c*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(d*mono.Utils.DEGREES_TO_RADIANS),g.z=e.z+f*Math.cos(c*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(d*mono.Utils.DEGREES_TO_RADIANS),g.y=e.y+f*Math.sin(d*mono.Utils.DEGREES_TO_RADIANS),a.p(g),a.lookAt(e)},onDone:function(){},onStop:function(){this.isPlaying&&(delete this.isPlaying,0==l&&u>=s?f&&f():0!=l?setTimeout(function(){w.play()},0):setTimeout(function(){v.play()},0))}});return 0==l&&u>=s?(x.dur=e,x.finish=e):0==l?(v.dur=2*e/3,v.finish=2*e/3):s>u&&(w.dur=2*e/3,w.finish=2*e/3),x.play(),d.activeAnimates=[x,w,v],[x,w,v]},d.getZoomEstimateOverviewTargetAndPosition=function(a,b){if(a){var c=a.getNetworkBoundingBox();if(null!=c){var d=c.center(),e=new $Vec3(0,c.max.y-c.min.y,c.max.z-c.min.z),f=new $Vec3(c.max.x-c.min.x,0,0,0),g=e.clone();g.length()<f.length()&&(g=f.clone());var h;if(b){var i=e.length();e.y=e.z*Math.tan(b/180*Math.PI),e.setLength(i)}h=(new $Vec3).addVectors(d,e.multiplyScalar(.5));var j=a._camera.fov,k=(a._camera.aspect,g.length()/2/Math.tan(j*Math.PI/180));return h.add(e.normalize().multiplyScalar(k)),{target:d,position:h}}}};var e=(a.jsonUtil=d.jsonUtil,function(){mono.PropertyChangeDispatcher.call(this)});c.Base=e,mono.extend(e,mono.PropertyChangeDispatcher,{onPropertyChange:function(a,b,c){}});var f=function(a){e.call(this),a=a||{},"string"==typeof a&&(a={id:a}),this._id=a.id,this._description=a.description,this._selectable=!0,this._stopAlarmPropagationable=!1,this._lazyLoad=!1,this._lazyLoadScene="",this._rotationExp={},this._positionExp={},this._visible=a.visible==b?!0:a.visible,this._userDataMap={},this.handleDoubleClick=null,this.handleClick=null};c.Category=f,mono.extend(f,e,{___accessor:["description","stopAlarmPropagationable"],getId:function(){return this._id},setId:function(a){if(this._id!==b)throw"Can not set id";this._id=a},setVisible:function(a){this._visible=a},isVisible:function(){return this._visible},setUserData:function(a,b){null==b?delete this._userDataMap[a]:this._userDataMap[a]=b},getUserData:function(a){return this._userDataMap[a]},fromJson:function(a){a.selectable==b&&1==a.selectable,this._id=a.id,this._description=a.description,this._visible=a.visible,this._selectable=a.selectable,this._stopAlarmPropagationable=a.stopAlarmPropagationable,this._lazyLoad=a.lazyLoad,this._lazyLoadScene=a.lazyLoadScene||"",this._rotationExp=a.rotationExp||{},this._positionExp=a.positionExp||{}}});var g=function(a){e.call(this),a=a||{},"string"==typeof a&&(a={id:a}),this._ii=a.ii,this._id=a.id,this._description=a.description,this._position=a.position||new mono.Vec3,this._position2d=a.position2d||new mono.Vec2,this._rotation=a.rotation,this._location=null,this._userDataMap={},this._parentId=a.parentId,this._hostId="",this._dataTypeId=a.dataTypeId,this._businessTypeId=a.businessTypeId,this._childList=new mono.List,this._alarmState=new c.AlarmState(this),this._powerParentId="",this._allLinks={},this._power="",this._weight=0};c.Data=g,mono.extend(g,e,{___accessor:["ii","rotation","parentId","hostId","dataTypeId","businessTypeId","alarmState","description","power","weight","name","extend"],
IT_Data:!0,getId:function(){return this._id},getLocation:function(){return this._location},setLocation:function(a){if(a){var b=new c.Location(a);if(this._location&&b.x==this._location.x&&b.y==this._location.y&&b.z==this._location.z)return;var d=this._location;this._location=b,this.firePropertyChange("location",d,b)}},setPosition:function(a,b,c){var d;if(3===arguments.length?d=new mono.Vec3(a,b,c):1===arguments.length&&(d=mono.Utils.isArray(a)?new mono.Vec3(a[0],a[1],a[2]):new mono.Vec3(a.x||0,a.y||0,a.z||0)),!this._position||d.x!=this._position.x||d.y!=this._position.y||d.z!=this._position.z){var e=this._position;this._position=d,this.firePropertyChange("position",e,d)}},setPosition2d:function(a,b){this._position2d=new mono.Vec2(a,b)},getValue:function(a){return a?this["_"+a]?this["_"+a]:this.getUserData(a):null},getPosition:function(){return this._position||new mono.Vec3},getPosition2d:function(){return this._position2d||new mono.Vec2},u:function(a){if(a)for(var b in a)this.setUserData(b,a[b])},addLink:function(a){a&&a instanceof c.Link&&a.getId()&&!this._allLinks[a.getId()]&&(this._allLinks[a.getId()]=a)},removeLink:function(a){a&&a.getId()&&delete this._allLinks[a.getId()]},getAllLinks:function(){return this._allLinks},getPosition2d:function(){return this._position2d},setUserData:function(a,b){null==b?delete this._userDataMap[a]:this._userDataMap[a]=b},getUserData:function(a){return this._userDataMap[a]},fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._ii=a.ii,this._id=a.id,this._description=a.description,!a.position||a.position.x===b&&a.position.y===b&&a.position.z===b?mono.Utils.isArray(a.position)&&(this._position=new mono.Vec3(a.position[0]||0,a.position[1]||0,a.position[2]||0)):this._position=new mono.Vec3(a.position.x||0,a.position.y||0,a.position.z||0),!a.position2d||a.position2d.x===b&&a.position2d.y===b?mono.Utils.isArray(a.position2d)&&(this._position2d=new mono.Vec2(a.position2d[0]||0,a.position2d[1]||0)):this._position2d=new mono.Vec2(a.position2d.x||0,a.position2d.y||0),a.rotation&&(a.rotation.x!==b&&""!=a.rotation.x||a.rotation.y!==b&&""!=a.rotation.y||a.rotation.z!==b&&""!=a.rotation.z)?this._rotation=new mono.Vec3(a.rotation.x,a.rotation.y,a.rotation.z):mono.Utils.isArray(a.rotation)&&(this._rotation=new mono.Vec3(a.rotation[0]||0,a.rotation[1]||0,a.rotation[2]||0)),this.setLocation(a.location),this._parentId=a.parentId,this._dataTypeId=a.dataTypeId,this._businessTypeId=a.businessTypeId,this._hostId=a.hostId||a.groupId,this._power=a.power,this._weight=a.weight,this._name=a.name,this._extend=a.extend},onAlarmChange:function(){},addChild:function(a){a&&!this._childList.contains(a)&&this._childList.add(a)},addChildren:function(a){if(a&&!(a.length<1))for(var b=0;b<a.length;b++){var c=a[b];this.addChild(c)}},removeChild:function(a){this._childList.remove(a)},removeChildren:function(a){if(a&&!(a.length<1))for(var b=0;b<a.length;b++){var c=a[b];this.removeChild(c)}},getChildren:function(){return this._childList},clone:function(a,b){var c=new g(a);c.setDataTypeId(this.getDataTypeId());var d=this.getPosition(),e=this.getLocation();return c.setPosition(d.clone()),e&&c.setLocation(new M(e.x,e.y,e.z)),b&&c.setParentId(this.getParentId()),c}});var h=function(a){e.call(this),a=a||{},"string"==typeof a&&(a={id:a}),this._id=a.id,this._categoryId="",this._description="",this._size=null,this._childrenSize=new c.Size,this._model2d="",this._model2dParameters=null,this._model2d2="",this._model2d2Parameters=null,this._parameters=null,this._model="",this._modelParameters=null,this._simpleModel="",this._simpleModelParameters=null,this._prefabAble=a.prefabAble==b?!0:a.prefabAble,this._simplePrefabAble=a.simplePrefabAble==b?!0:a.simplePrefabAble,this._selectable=!0,this._stopAlarmPropagationable=!1,this._batchable=!1,this._lazyable=!1,this.handleDoubleClick=null,this.handleClick=null,this._rotationExp={},this._positionExp={},this._visible=!0,this._weightRating=0,this._powerRating=0,this._subType="server",this._templateDatas=a.templateDatas||[],this._templateDataMap={},this._userDataMap={}};mono.extend(h,e,{___accessor:["categoryId","description","rotationExp","positionExp","size","childrenSize","parameters","model2d","model2dParameters","model2d2","model2d2Parameters","model","modelParameters","simpleModel","simpleModelParameters","batchable","lazyable","selectable","stopAlarmPropagationable","prefabAble","noVirtualOther","simplePrefabAble","weightRating","powerRating","subType"],getId:function(){return this._id},setId:function(a){if(this._id!==b)throw"Can't change id";this._id=a},getTemplateDatas:function(a){a=a||!1;var b=[];for(var c in this._templateDataMap)c.indexOf("@"+a)>0&&b.push(this._templateDataMap[c]);return b},setTemplateDatas:function(a){this._templateDatas.length=0;var b=this;a&&a.length>0&&a.forEach(function(a){b.addTemplateData(a)})},addTemplateData:function(a){if(a instanceof c.Data)this._templateDatas.push(a),this._templateDataMap[a.getId()+"@"+a.getUserData("side")]=a;else{var b=new c.Data;b.setUserData("side",a.side),b.fromJson(a),this._templateDatas.push(b),this._templateDataMap[b.getId()+"@"+b.getUserData("side")]=b}},getTemplateDataById:function(a){return this._templateDataMap[a]},setUserData:function(a,b){null==b?delete this._userDataMap[a]:this._userDataMap[a]=b},getUserData:function(a){return this._userDataMap[a]},fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._categoryId=a.categoryId,this._description=a.description,this._size=new L(a.size),this._childrenSize=new L(a.childrenSize),this._model2d=a.model2d,this._model2dParameters=d.translateJson(a.model2dParameters),this._model2d2=a.model2d2,this._model2d2Parameters=d.translateJson(a.model2d2Parameters),this._model=a.model,this._modelParameters=d.translateJson(a.modelParameters),this._simpleModel=a.simpleModel,this._simpleModelParameters=a.simpleModelParameters,this._selectable=a.selectable===b?!0:a.selectable,this._stopAlarmPropagationable=!!a.stopAlarmPropagationable,this._batchable=!!a.batchable,this._prefabAble=!!a.prefabAble,this._simplePrefabAble=!!a.simplePrefabAble,this._noVirtualOther=!!a.noVirtualOther,this._rotationExp=a.rotationExp||{},this._positionExp=a.positionExp||{},this._lazyable=a.lazyable,this._weightRating=a.weightRating,this._powerRating=a.powerRating,this._subType=a.subType}}),c.DataType=h;var i=function(a){e.call(this),a=a||{},this._id=a.id||"",this._parentId=a.parentId||"",this._name=a.name||"",this._description=a.description,this._userDataMap={}};mono.extend(i,e,{___accessor:["id","name","parentId","description"],fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._parentId=a.parentId,this._name=a.name,this._description=a.description},setUserData:function(a,b){null==b?delete this._userDataMap[a]:this._userDataMap[a]=b},getUserData:function(a){return this._userDataMap[a]}}),c.BusinessType=i;var k=function(){this.defaultCategory=new c.Category(""),this._categories=[],this._categoryMap={},this._dataTypes=[],this._dataTypeMap={},this._businessTypes=[],this._businessTypeMap={},this._datas=[],this._dataMap={},this._roots=[],this._rootMap={},this._links=[],this._linkMap={},this._dataTypeDatas={},this._categoryDatas={},this._scenes=[],this._sceneMap={},this._rootScene=null,this._categorySceneMap={},this._temperatureFields={},this._collectors={},this._typeCollectors={},this._dataManagerChangeDispatcher=new mono.EventDispatcher,this._dataPropertyChangeDispatcher=new mono.EventDispatcher};mono.extend(k,mono.PropertyChangeDispatcher,{addScene:function(a){if(!(a instanceof c.Scene))return!1;var b=a.getId();if(this._sceneMap[b])throw"Scene with id '"+b+"' already exists";var d=a.getCategoryId();if(!this._categoryMap[d]&&!a.isRoot())throw"Scene Category with category id '"+d+"' does not exist";if(this._categorySceneMap[d])throw"Scene with category id '"+d+"' already exists";if(a.isRoot()){if(null!=this._rootScene)throw"Only support one root scene";this._rootScene=a}this._scenes.push(a),this._sceneMap[b]=a,this._categorySceneMap[d]=a},addSceneFromJson:function(a){for(var b=0,d=a.length;d>b;b++){var e=new c.Scene;e.fromJson(a[b]),this.addScene(e)}},getSceneByCategory:function(a){if(!a)return null;var b=a.getId?a.getId():a;return this._categorySceneMap[b]},getSceneByData:function(a){var b=this.getCategoryForData(a);return this.getSceneByCategory(b)},getRootScene:function(){return this._rootScene},getChildrenScene:function(a){},addCategory:function(a){var b=a.getId();if(!(a instanceof c.Category))throw"Can only add it.Category";if(this._categoryMap[b])throw"Category for id '"+b+"' already exists";this._categories.push(a),this._categoryMap[b]=a},removeCategory:function(a){if(!a)return!1;var b=a.getId();if(!this._categoryMap[b])return!1;var c=this._categories.indexOf(a);return-1==c?!1:(delete this._categoryMap[b],this._categories.splice(c,1),!0)},removeCategoryById:function(a){var b=this._categoryMap[a];b&&this.removeCategory(b)},addCategories:function(a){if(mono.Utils.isArray(a))for(var b=0;b<a.length;b++){var c=a[b];this.addCategory(c)}},addCategoryFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));for(var d=0,e=b.length;e>d;d++){var f=b[d],g=new c.Category;g.fromJson(f),this.addCategory(g)}},addDataType:function(a){if(a){if(!(a instanceof c.DataType))throw"Can only add 'it.DataType'";var b=a.getId();if(this._dataTypeMap[b])throw"DataType for id '"+b+"' already exists";var d=a.getCategoryId();if(d&&!this._categoryMap[d])throw"Category for '"+d+"' does not exist";this._dataTypes.push(a),this._dataTypeMap[b]=a}},addBusinessType:function(a){if(a){var b=a.getId();if(!(a instanceof c.BusinessType))throw"Can only add it.BusinessType";if(this._businessTypeMap[b])throw"BusinessType for id '"+b+"' already exists";this._businessTypes.push(a),this._businessTypeMap[b]=a}},removeBusinessType:function(a){if(!a)return!1;var b=a.getId();if(!this._businessTypeMap[b])return!1;var c=this._businessTypes.indexOf(a);return-1==c?!1:(delete this._businessTypeMap[b],this._businessTypes.splice(c,1),!0)},removeBusinessTypeById:function(a){var b=this._businessTypeMap[a];b&&this.removeBusinessType(b)},addBusinessTypes:function(a){if(mono.Utils.isArray(a))for(var b=0;b<a.length;b++){var c=a[b];this.addBusinessType(c)}},addBusinessTypeFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));for(var d=0,e=b.length;e>d;d++){var f=b[d],g=new c.BusinessType;g.fromJson(f),this.addBusinessType(g)}},getBusinessTypeById:function(a){return this._businessTypeMap[a]},getBusinessTypeForData:function(a){var b=a.getBusinessTypeId();return b?this.getBusinessTypeById(b):null},addTemplateData:function(a){var b=a.parentDataTypeId||"";if(!b)return!1;var d=this._dataTypeMap[b];if(!d)return!1;var e=new c.Data;if(a.position){var f=a.position;f instanceof Array&&f.length>=2?a.position2d={x:f[0],y:f[1]}:a.position2d=f}e.fromJson(a),e.setUserData("side",a.side),d.addTemplateData(e)},addTemplateDataFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));for(var c=0,d=b.length;d>c;c++){var e=b[c];this.addTemplateData(e)}},removeDataType:function(a){if(!a)return!1;var b=a.getId();if(!this._dataTypeMap[b])return!1;var c=this._dataTypes.indexOf(a);return-1===c?!1:this._dataTypeDatas[b]?!1:(delete this._dataTypeMap[b],void this._dataTypes.splice(c,1))},removeDataTypeById:function(a){this.removeDataType[this._dataTypeMap[a]]},getCategoryForDataType:function(a){var b=a;if("string"==typeof a&&(b=this._dataTypeMap[a]),!b)return null;var c=b.getCategoryId();return this._categoryMap[c]},getCategoryForData:function(a){var b=this.getDataTypeForData(a);if(b){var c=b.getCategoryId();return this._categoryMap[c]}return null},getDataTypeForData:function(a){if(a){var b=a;if("string"==typeof b&&(b=this._dataMap[b]),b&&(b instanceof c.Data||b instanceof c.Link)){b.getDataTypeId||console.log("data.getDataTypeId");var d=b.getDataTypeId();return this._dataTypeMap[d]}}},getDataTypeById:function(a){return a?this._dataTypeMap[a]:null},addDataTypeFromJson:function(a){for(var b=0,d=a.length;d>b;b++){var e=new c.DataType;e.fromJson(a[b]),this.addDataType(e)}},setParentAndChildren:function(a){if(!a)return null;var b=a.getParentId();if(b){var c=this._dataMap[b];c&&c.addChild(a)}var d=this.getChildren(a);a.addChildren(d)},setAllParentAndChildren:function(){for(var a in this._dataMap){var b=this._dataMap[a];if(b&&b.getParentId()){var c=this._dataMap[b.getParentId()];c&&c.addChild(b)}}},addData:function(a,c,d){if(a){c===b&&(c=!0),d===b&&(d=!0);var e=a.getId(),f=a.getDataTypeId();if(this._dataMap[e])throw"Data for '"+e+"' already exists";var g=this.getDataTypeForData(a);if(!g)throw"DataType '"+f+"' does not exist";this._datas.push(a),this._dataMap[e]=a;var h=a.getParentId();h||(this._roots.push(a),this._rootMap[e]=a),d&&this.setParentAndChildren(a);var i=this._dataTypeDatas[f];null==i&&(i={},this._dataTypeDatas[f]=i),i[e]=a;var j=this.getCategoryForData(a);if(j){var k=this._categoryDatas[j.getId()];null==k&&(k={},this._categoryDatas[j.getId()]=k),k[e]=a}a.addPropertyChangeListener(this.handleDataPropertyChange,this),c&&this._dataManagerChangeDispatcher.fire({kind:"add",data:a,source:this})}},addDataFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));for(var d=0,e=b.length;e>d;d++){a.id,a.dataTypeId}for(d=0;e>d;d++){var f=b[d],g=new c.Data;g.fromJson(f),this.addData(g,!0,!1)}this.setAllParentAndChildren()},removeData:function(a,b){if(!a)return!1;var c=a.getId?a.getId():a;if(!this._dataMap[c])return!1;var a=this._dataMap[c],d=this._datas.indexOf(a);if(-1===d)return!1;if(a.getParentId()){var e=this._dataMap[a.getParentId()];e&&e.removeChild(a)}var f=a.getChildren();if(f&&f.size()&&!b)return!1;if(f&&f.size())for(var g=0;g<f.size();g++)this.removeData(f.get(g),b);delete this._dataMap[c],this._datas.splice(d,1);var h=a.getDataTypeId(),i=this._dataTypeDatas[h];null!=i&&delete i[c];var j=this.getCategoryForData(a);if(j){var k=this._categoryDatas[j.getId()];null!=k&&delete k[c]}return a.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataManagerChangeDispatcher.fire({kind:"remove",data:a,source:this}),!0},addLink:function(a){var b=a.getId();if(!this._linkMap[b]){var c=a.getFromId(),d=a.getToId();return this._dataMap[c]?this._dataMap[d]?(this._linkMap[b]=a,this._links.push(a),this._dataMap[c].addLink(a),this._dataMap[d].addLink(a),this._dataManagerChangeDispatcher.fire({kind:"add",data:a,source:this}),!0):void console.log("To Id does not exist"):void console.log("From Id does not exist")}},removeLink:function(a){var b=a.getId();if(this._linkMap[b]){var c=this._links.indexOf(a);this._links.splice(c,1),delete this._linkMap[b]}var d=a.getFromId(),e=a.getToId();this._dataMap[d].removeLink(a),this._dataMap[e].removeLink(a),this._dataManagerChangeDispatcher.fire({kind:"remove",data:a,source:this})},addTemperatureField:function(a){if(a){if(this._temperatureFields&&this._temperatureFields[a.getId()])throw"Temparature Field for '"+a.getId()+"' already exists";if(this._temperatureFields[a.getId()]=a,this._collectors)for(var b in this._collectors){var c=this._collectors[b];c.getType()==o.Type.temperature&&c.getParentId()==a.getId()&&a.addCollector(c)}}},addTemperatureFieldFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));for(var c=0,d=b.length;d>c;c++){var e=b[c],f=new p;f.fromJson(e),this.addTemperatureField(f)}},removeTemparatureField:function(a){if(a){var b=a.getCollectors();if(b&&b.size()>0){var c=this;b.forEach(function(a){a&&delete c._collectors[a.getId()]})}delete this._temperatureFields[a.getId()]}},addCollector:function(a){if(a){if(this._collectors&&this._collectors[a.getId()])throw"Collector for '"+a.getId()+"' already exists";this._collectors[a.getId()]=a;var b=this._temperatureFields[a.getParentId()];b&&b.addCollector(a);var c=a.getType(),d=this._typeCollectors[c];null==d&&(d={},this._typeCollectors[c]=d),d[a.getId()]=a}},addCollectorFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));for(var c=0,d=b.length;d>c;c++){var e=b[c],f=new o;f.fromJson(e),this.addCollector(f)}},removeCollector:function(a){if(a){if(delete this._collectors[a.getId()],"temperature"==a.getType()){var b=this._temperatureFields[a.getParentId()];b&&b.removeCollector(a)}var c=a.getType(),d=this._typeCollectors[c];d&&delete d[a.getId()]}},getParent:function(a){if(!a)return null;if(a instanceof c.Data){var b=a.getParentId();return this._dataMap[b]}},getChildren:function(a,b){var c=[];if(!a)return c;var d=a.getId();for(var e in this._dataMap){var a=this._dataMap[e];b&&a.getDataTypeId()!=b||a.getParentId()===d&&c.push(a)}return c},isAncestor:function(a,b,c){if(!b||!a)return!1;if(b.getId()===a||b.getParentId()===a)return!0;var c=c||this;if(b.getParentId()){var d=this._dataMap[b.getParentId()];if(d)return c.isAncestor(a,d,c)}return!1},getDescendants:function(a,b,c){var d=b||[],c=c||this;if(!a)return d;var e=a.getChildren();return e&&e.size()>0&&e.forEach(function(a){d.push(a),c.getDescendants(a,d,c)}),d},getDataMap:function(){return this._dataMap},getLinkMap:function(){return this._linkMap},getLinkById:function(a){return a?this._linkMap[a]:null},getFromLinks:function(a){},getToLinks:function(a){},getDataMapByCategory:function(a){var b=a;return b instanceof c.Category&&(c=b.getId()),this._categoryDatas[b]},getDataById:function(a){if(!a)return null;var b=this._dataMap[a];if(!b&&"string"==typeof a&&a.indexOf("@")>0){var c=a.split("@"),d=c[0],e=c[1],f=this.getDataById(e);if(f)return null;var g=this.getDataTypeForData(f);if(!g)return null;var h=g.getTemplateDataById(d);if(h){var i=this.getDataTypeForData(h);if(!i)return null;var j=h.clone(a);return j.setParentId(e),this.addData(j),j}}return b},getCollectorById:function(a){return this._collectors[a]},getDatas:function(){return this._datas},getLinks:function(){return this._links},getAncestors:function(a,b){b=b||[];var c=this.getDataById(a.getParentId());return c&&(b.push(c),this.getAncestors(c,b)),b},getAncestor:function(a,b){var c=this.getDataTypeForData(a),d=this.getCategoryForData(a);if(b(a,c,d))return a;var e=this.getParent(a);return null==e?null:this.getAncestor(e,b)},getRootMap:function(){return this._rootMap},getRoots:function(){return this._roots},getTemperatureFields:function(){return this._temperatureFields},isLazyable:function(a){if(!a)return!1;var b=this.getDataTypeForData(a);if(b.isLazyable())return!0;var c=this.getParent(a);return this.isLazyable(c)?!0:!1},fromJson:function(a){a=d.translateJson(a);for(var b=a.categories||[],c=a.dataTypes||[],e=a.datas||[],f={},g={},h=0;h<b.length;h++){var i=b[h];f[i.id]=i}for(h=0;h<c.length;h++){var j=c[h];if(j.categoryId&&!f[j.categoryId]&&!this._categoryMap[j.categoryId])throw"Category for '"+j.categoryId+"' does not exist";g[j.id]=j}for(h=0;h<e.length;h++){var k=e[h],l=k.dataTypeId;if(!g[l]&&!this._dataTypeMap[l])throw"DataType '"+l+"' does not exist"}b&&b.length&&this.addCategoryFromJson(b),c&&c.length&&this.addDataTypeFromJson(c),e&&e.length&&this.addDataFromJson(e)},handleDataPropertyChange:function(a){var b=a.source;if("parentId"===a.property){var c=a.oldValue,d=a.newValue;if(null==d)this._roots.push(b),this._rootMap[b.getId()]=b;else if(null==c){delete this._rootMap[b.getId()];var e=this._roots.indexOf(b);-1!=e&&this._roots.splice(e,1)}}this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},addDataManagerChangeListener:function(a,b,c){this._dataManagerChangeDispatcher.add(a,b,c)},addDataBoxChangeListener:function(a,b,c){this._dataManagerChangeDispatcher.add(a,b,c)},removeDataManagerChangeListener:function(a,b){this._dataManagerChangeDispatcher.remove(a,b)},isStopAlarmPropagation:function(a){if(!a)return!1;var b=this.getDataTypeForData(a);if(!b)return!1;if(b.isStopAlarmPropagationable())return!0;var c=this.getCategoryForData(a);return c&&c.isStopAlarmPropagationable()?!0:!1}}),c.DataManager=k;var l=function(a){e.call(this),a=a||{},"string"==typeof a&&(a={id:a}),this._id=a.id,this._categoryId=a.categoryId,this._root=!1||a.root,this._sceneType=a.sceneType||"ShowSelf",this._twod=a.twod||!1,this._withGis=a.withGis||!1,this.zoomLevel=a.zoomLevel||5,this.center=a.center,this._description="",this.lights=[],this.networkParameters={},this.cameraParameters={},this.animateParameters={},this.showStaticInfo=a.showStaticInfo,this.defaultInteractionParameters=a.defaultInteractionParameters,this._preRender=a.preRender||!1};mono.extend(l,e,{___accessor:["categoryId","sceneType","root","twod","withGis","description","preRender"],getId:function(){return this._id},isRoot:function(){return this._root},isShowStaticInfo:function(){return this.showStaticInfo},fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._categoryId=a.categoryId,this._root=!1||a.root,this._sceneType=a.sceneType||"ShowSelf",this._twod=a.twod||!1,this._withGis=a.withGis||!1,this.zoomLevel=a.zoomLevel||5,this.center=a.center,this._description=a.description,this.networkParameters=a.networkParameters,this.cameraParameters=a.cameraParameters,this.showStaticInfo=a.showStaticInfo,this.defaultInteractionParameters=a.defaultInteractionParameters,this._preRender=a.preRender||!1}}),c.Scene=l;var m=function(a,b){this.sceneManager=b,this.sceneId=a,this.defaultEventHandler=this.sceneManager.viewManager3d.getDefaultEventHandler()};mono.extend(m,Object,{getContainer:function(){return null},getNetwork3D:function(){return null},getCamera:function(){return null},adjustBounds:function(a,b,c,d){},show:function(a){},clear:function(){return null},setFocusNode:function(a){},lookAt:function(a){},isLoadData:function(){return!0}}),c.CustomSceneView=m;var n=function(a){e.call(this),a=a||{},"string"==typeof a&&(a={id:a}),this._id=a.id,this._name=a.name||"",this._dataTypeId=a.dataTypeId||"",this._type=a.type||"",this._fromId=a.fromId,this._fromSide=a.fromSide||0,this._toId=a.toId,this._toSide=a.toSide||0,this._userDataMap={},this._fromControls=a.fromControls||null,this._toControls=a.toControls||null,this._radius=2,this._alarmState=new c.AlarmState(this),this._fromPortId=a.fromPortId,this._toPortId=a.toPortId,this._routeType=a.routeType,this._fromIpAddress=a.fromIpAddress,this._toIpAddress=a.toIpAddress};mono.extend(n,e,{___accessor:["name","type","dataTypeId","fromId","fromSide","toId","toSide","fromControls","toControls","radius","alarmState","fromPortId","toPortId","routeType","fromIpAddress","toIpAddress"],IT_Data:!0,getId:function(){return this._id},setId:function(a){if(this._id!==b)throw"Can't change id";this._id=a},setUserData:function(a,b){null==b?delete this._userDataMap[a]:this._userDataMap[a]=b},getUserData:function(a){return this._userDataMap[a]}}),c.Link=n;var o=function(a){e.call(this),a=a||{},this._parentId=a.parentId||"",this._id=a.id||"",this._position=a.position||new mono.Vec3,this._location=a.location||"",this._value=a.value||"0",this._data=a.data||{},this._width=a.width||0,this._height=a.height||0,this._depth=a.depth||0,this._description=a.description,this._type=a.type||"temperature"};o.Type={},o.Type.humidity="humidity",o.Type.temperature="temperature",mono.extend(o,e,{___accessor:["id","parentId","value","data","width","height","depth","type","position","location"],fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._parentId=a.parentId,this._description=a.description,this._width=a.width,this._height=a.height,this._depth=a.depth,this._type=a.type,this._value=a.value,this._data=a.data,!a.position||a.position.x===b&&a.position.y===b&&a.position.z===b?mono.Utils.isArray(a.position)&&(this._position=new mono.Vec3(a.position[0]||0,a.position[1]||0,a.position[2]||0)):this._position=new mono.Vec3(a.position.x||0,a.position.y||0,a.position.z||0),this._location=a.location}}),c.Collector=o;var p=function(a){e.call(this),a=a||{},this._parentDataId=a.parentDataId,this._id=a.id||"",this._width=a.width||null,this._height=a.height||null,this._position=a.position||new mono.Vec3,this._description=a.description||"",this._minValue=a.minValue||null,this._maxValue=a.maxValue||null,this._withBg=a.withBg||!1,this.collectors=new mono.List};mono.extend(p,e,{___accessor:["id","parentDataId","width","height","position","minValue","maxValue","withBg"],fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._parentDataId=a.parentDataId,this._description=a.description,this._width=a.width,this._height=a.height,this._withBg=a.withBg,this._minValue=a.minValue,this._maxValue=a.maxValue,!a.position||a.position.x===b&&a.position.y===b&&a.position.z===b?mono.Utils.isArray(a.position)&&(this._position=new mono.Vec3(a.position[0]||0,a.position[1]||0,a.position[2]||0)):this._position=new mono.Vec3(a.position.x||0,a.position.y||0,a.position.z||0)},addCollector:function(a){a&&this.collectors.add(a)},removeCollector:function(a){a&&this.collectors.remove(a)},getCollectors:function(){return this.collectors}}),c.TemperatureField=p;var q=function(a){var a=a||{};this._id=a.id||"",this._description=a.description,this._sceneId=a.sceneId,this._type=a.type,this._color=a.color||"PointLight",this._intensity=a.intensity,this._distance=a.distance,this._position=a.position||new mono.Vec3};mono.extend(q,e,{___accessor:["id","sceneId","type","color","intensity","distance","position"],fromJson:function(a){"string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._description=a.description,!a.position||a.position.x===b&&a.position.y===b&&a.position.z===b?mono.Utils.isArray(a.position)&&(this._position=new mono.Vec3(a.position[0]||0,a.position[1]||0,a.position[2]||0)):this._position=new mono.Vec3(a.position.x||0,a.position.y||0,a.position.z||0),this._sceneId=a.sceneId,this._type=a.type,this._color=a.color,this._intensity=a.intensity,this._distance=a.distance}}),c.Light=q;var r=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.isVirtualElementFunction=function(){return!0},this.virtualFilter=new c.VirtualManager(this.sceneManager),this.oldOpacityValue=this.virtualFilter.opacityValue,this.virtualFilter.opacityValue=.2,this.sceneManager.viewManager3d.addMaterialFilter(this.virtualFilter),this.fields=null,this.dataBox=this.sceneManager.network3d.getDataBox(),this.heatMaps={},this.tempBoards={},this.bgMap={},this.isAnimate=!0,this.deltaY=0,this.billboardCanvasMap={},this.highestValue=70,this.isBillboardVertical=!0};mono.extend(r,Object,{getAllCollectors:function(){return this.sceneManager.dataManager._typeCollectors[o.Type.temperature]},showWithoutTempField:function(b,c){if(this.tempBillbords={},this.tempCollectors=this.getAllCollectors(),!this.tempCollectors)return 0;if(this.intervalId)return 0;var d=0;for(var e in this.tempCollectors){var f=this.tempCollectors[e];f&&this.sceneManager.isCurrentSceneInstance(f.getParentId())&&(this.createBillboard(f),d++)}if(1>d)return 0;var g=this;return b?(c=parseInt(c)||5e3,this.intervalId=a.setInterval(function(){g.updateBillboards()},c)):this.intervalId=a.setInterval(function(){},1e4),d},getCollectorById:function(a){return this.dataManager._collectors[a]},beforeUpdateBillboards:function(){},updateBillboards:function(){if(this.beforeUpdateBillboards(),this.tempBillbords)for(var a in this.tempBillbords){var b=this.getCollectorById(a);this.createBillboard(b)}},show:function(){if(this.fields=this.dataManager.getTemperatureFields(),!this.intervalId){var b=this.getCurrentSceneFields();if(b&&!(b.length<1)){for(var c=0;c<b.length;c++)this.createTempFieldByField(b[c]);this.virtualAllElement(),this.sceneManager.network3d.dirtyNetwork();var d=this;this.intervalId=a.setInterval(function(){d.beforeRefresh(),d.refresh(function(a){var b=d.heatMaps[a],c=d.tempBoards[a];if(d.isAnimate){var e=parseFloat(c.orgPositionY)+parseFloat(d.deltaY);c.setPositionY(e)}c&&(c.setStyle("m.texture.image",b.heatMapCanvas),c.invalidateTexture(),b.heatMapCanvas.parentNode&&document.body.removeChild(b.heatMapCanvas))}),d.deltaY>80?d.deltaY=0:d.deltaY+=30},2e3)}}},beforeRefresh:function(){},refresh:function(b){var c=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,d=this,e=function(){for(var a in d.heatMaps){var c=d.heatMaps[a];if(d.isAnimate&&d.deltaY>0){if(c.datas&&c.datas.length>0)for(var e=0;e<c.datas.length;e++){var f=c.datas[e];f&&3==f.length&&(f[2]=f[2]+.05)}d.refreshColletor(d.fields[a],c)}else c.clear(),d.setDataByField(d.fields[a],c);document.body.appendChild(c.getCanvas()),b&&b(a)}};c(e)},hide:function(){if(this.intervalId){if(a.clearInterval(this.intervalId),delete this.intervalId,this.virtualFilter.clearAll(),this.sceneManager.network3d.setSelectTransparencyThreshold(this.oldOpacityValue+.1),this.tempBoards)for(var b in this.tempBoards){var c=this.tempBoards[b];this.dataBox.remove(c),delete this.heatMaps[b],delete this.tempBoards[b]}if(this.tempBillbords){for(var d in this.tempBillbords)if(d){var e=this.tempBillbords[d];e&&(e.setParent(null),this.dataBox.remove(e))}delete this.tempBillbords}this.sceneManager.network3d.dirtyNetwork()}},isShowing:function(){return this.intervalId?!0:!1},getNnVirtualCategorys:function(){return["floor","room"]},virtualAllElement:function(){if(this.sceneManager.network3d.setSelectTransparencyThreshold(this.virtualFilter.opacityValue+.01),this.isVirtualElementFunction&&this.isVirtualElementFunction()){this.virtualFilter.addAll();var a=this.getNnVirtualCategorys();if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b],d=this.dataManager.getDataMapByCategory(c);if(d)for(var e in d){var f=d[e];f&&this.virtualFilter.remove(f)}}}},createTempFieldByField:function(a){if(!a)return null;var b=this.sceneManager.getNodeByDataOrId(a.getParentDataId());if(!b)return null;var d=a.getPosition(),e=a.getWithBg(),f=c.Util.getNodeCenterPosition(b),g=f.x+d.x,h=f.z+d.y,i=new c.HeatMap({width:a.getWidth(),height:a.getHeight(),positionX:g,positionY:h,withBg:e});this.setDataByField(a,i),this.heatMaps[a.getId()]=i;var j=i.getTemperatureBoard();this.tempBoards[a.getId()]=j;var k=d.z||0,l=b.getWorldPosition().y+50+k;j.setPositionY(l);var m=b.getWorldPosition();return j.setPositionX(d.x+m.x),j.setPositionZ(d.y+m.z),j.orgPositionY=l,j.setRotationZ(-1*b.getRotationY()),j.setClient(c.SceneManager.CLIENT_EXT_VITUAL,!0),this.dataBox.add(j),i},setDataByField:function(a,b){if(a&&a.collectors&&!(a.collectors.length<1)){this.dataBox.startBatch();for(var c=0;c<a.collectors.size();c++){var d=a.collectors.get(c);d&&this.createHeatPoint(d,b,a)}this.dataBox.endBatch()}},refreshColletor:function(a){if(a&&a.collectors&&!(a.collectors.length<1))for(var b=0;b<a.collectors.size();b++){var c=a.collectors.get(b);c&&this.showBillboard(c)&&this.createBillboard(c,a)}},format:function(a){return":\n"+a.toFixed(1)+"C"},showBillboard:function(a){return!0},getToFixed:function(){return 0},createBillboard:function(a,d){if(a){var e=a.getId();this.tempBillbords||(this.tempBillbords={});var f=this.tempBillbords[e];if(!f){var g=null;g=d?d.getParentDataId():a.getParentId();var h,i,j,k=this.sceneManager.getNodeByDataOrId(g),l=a.getPosition(),m=a.getLocation(),n=k.getWorldPosition();if(m&&"string"==typeof m&&this.dataManager.getDataById(m)){var o=this.sceneManager.getNodeByDataOrId(m);if(o){var n=c.Util.getNodeCenterPosition(o);h=n.x,i=n.z}}else h=n.x+l.x,i=n.z+l.z;var j=n.y+l.y,p=k.getBoundingBox();if(p){var q=(p.max.y-p.min.y)/2;10>q&&(q=100),j+=q}else j+=100;f=new mono.Billboard,f.s({"m.texture.image":this.createCanvas(e,0,"","",null),"m.transparent":!0,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.vertical":!!this.isBillboardVertical}),f.setPositionX(h),f.setPositionY(j),f.setPositionZ(i),this.tempBillbords[e]=f,this.dataBox.add(f)}var r=parseFloat(a.getValue()||0);if(f._tvalue!=r){var s=null;if(this.bgMap)for(var t in this.bgMap){var u=this.bgMap[t];if(u)if(2==u.length){if(u[0]!=b&&u[1]!=b&&r>=u[0]&&r<=u[1]){s=t;break}if((u[0]==b||""==u[0])&&u[1]!=b&&r<=u[1]){s=t;break}if(u[0]!=b&&(u[1]==b||""==u[1])&&r>=u[0]){
s=t;break}}else if(1==u.length&&u[0]!=b&&r>=u[0]){s=t;break}}f._tvalue=r;var v=this.createCanvas(e,r.toFixed(this.getToFixed()),":","C",s);f.setStyle("m.texture.image",v),this.setBillboardScale(f,v),f.setStyle("m.transparent",!1),f.setStyle("m.alphaTest",.5);var w=c.Util.getImageById(s,r),x=v.width/2,y=v.height/2;w&&w.client&&(w.client.scaleX&&(x=parseFloat(w.client.scaleX)),w.client.scaleY&&(y=parseFloat(w.client.scaleY))),f.setScale(x,y,1),f.invalidateTexture(),this.afterCreateBillboard(k,f)}}},afterCreateBillboard:function(a,b){},setBillboardScale:function(a,b){a&&b&&a.setScale(b.width/2,b.height/2,1)},createCanvas:function(a,b,d,e,f){var g=this.billboardCanvasMap[a],h=c.Util.createHumOrTempCanvas(b,e,f,g);return g||(this.billboardCanvasMap[a]=h),h},getRelativePosition:function(a,b){var c,d;c=(new mono.Mat4).getInverse(a.worldMatrix.clone()),d=(new mono.Mat4).multiplyMatrices(c,b.worldMatrix.clone());var e=(new mono.Vec3).getPositionFromMatrix(d);return e},createHeatPoint:function(a,d,e){if(a&&d){var f,g,h=this.sceneManager.getNodeByDataOrId(e.getParentDataId()),i=h.getPosition(),j=a.getPosition(),k=a.getLocation();if(k&&"string"==typeof k&&this.dataManager.getDataById(k)){var l=this.sceneManager.getNodeByDataOrId(k),m=this.getRelativePosition(h,l);if(l){var n=c.Util.getNodeCenterPosition(l);n.x=m.x,n.z=m.z,n.x=n.x+i.x,n.z=n.z+i.z,f=n.x,g=n.z}}else{var n=c.Util.getNodeCenterPosition(h);n.x=n.x,n.z=n.z,f=n.x+j.x,g=n.z+j.z}var o=a.getValue();if(o&&(o=parseFloat(o/(this.highestValue||70))),f!=b&&g!=b){var p={x:f||0,y:g||0,w:a.getWidth()||0,l:a.getDepth()||0,value:o||0};d.addPointWithArea(p)}this.showBillboard(a)&&this.createBillboard(a,e)}},getCurrentSceneFields:function(){var a=[],b=this.dataManager.getTemperatureFields();for(var c in b){var d=b[c];d&&this.sceneManager.isCurrentSceneInstance(d.getParentDataId(),!0)&&a.push(d)}return a}}),c.TemperatureFieldManager=r;var s=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.dataBox=this.sceneManager.network3d.getDataBox(),this.humCollectors=null,this.tempBillbords={},this.bgMap={},this.billboardCanvasMap={},this.isBillboardVertical=!1};mono.extend(s,Object,{show:function(){if(this.humCollectors=this.sceneManager.dataManager._typeCollectors[o.Type.humidity],!this.humCollectors)return 0;if(this.intervalIndex)return 0;var b=0;for(var c in this.humCollectors){var d=this.humCollectors[c];d&&this.sceneManager.isCurrentSceneInstance(d.getParentId())&&(this.createBillboard(d),b++)}if(1>b)return 0;var e=this;return this.intervalIndex=a.setInterval(function(){e.update()},5e3),b},update:function(){if(this.tempBillbords)for(var a in this.tempBillbords){var b=this.dataManager._collectors[a];this.createBillboard(b)}},hide:function(){if(this.intervalIndex&&(a.clearInterval(this.intervalIndex),delete this.intervalIndex),this.tempBillbords)for(var b in this.tempBillbords){var c=this.tempBillbords[b];c&&this.dataBox.remove(c),delete this.tempBillbords[b]}},isShowing:function(){return this.intervalIndex?!0:!1},getToFixed:function(){return 2},createBillboard:function(a){if(!a)return null;var d=a.getId(),e=this.tempBillbords[d];if(!e){var f=this.sceneManager.getNodeByDataOrId(a.getParentId());if(!f)return console.log("parent does not exists!"),null;var g=a.getPosition(),h=c.Util.getNodeCenterPosition(f),i=h.x+g.x,j=h.z+g.z,k=h.y+g.y,l=f.getBoundingBox(),m=0;l&&(m=(l.max.y-l.min.y)/2),10>m&&(m=100),k+=m,e=new mono.Billboard,e.s({"m.texture.image":this.createCanvas(d,0,"","",null),"m.transparent":!0,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.vertical":!!this.isBillboardVertical}),e.setPositionX(i),e.setPositionY(k),e.setPositionZ(j),this.tempBillbords[d]=e,this.dataBox.add(e)}var n=parseFloat(a.getValue()||0);if(e._tvalue==n)return e;var o=null;if(this.bgMap)for(var p in this.bgMap){var q=this.bgMap[p];if(q)if(2==q.length){if(q[0]!=b&&q[1]!=b&&n>=q[0]&&n<=q[1]){o=p;break}if((q[0]==b||""==q[0])&&q[1]!=b&&n<=q[1]){o=p;break}if(q[0]!=b&&(q[1]==b||""==q[1])&&n>=q[0]){o=p;break}}else if(1==q.length&&q[0]!=b&&n>=q[0]){o=p;break}}e._tvalue=n;var r=this.createCanvas(d,n.toFixed(this.getToFixed()),":","%",o),s=c.Util.getImageById(o,n),t=r.width/2,u=r.height/2;return s&&s.client&&(s.client.scaleX&&(t=parseFloat(s.client.scaleX)),s.client.scaleY&&(u=parseFloat(s.client.scaleY))),e.setScale(t,u,1),e.setStyle("m.texture.image",r),e.setStyle("m.transparent",!1),e.setStyle("m.alphaTest",.5),e.invalidateTexture(),e},createCanvas:function(a,b,d,e,f){var g=this.billboardCanvasMap[a],h=c.Util.createHumOrTempCanvas(b,e,f,g);return g||(this.billboardCanvasMap[a]=h),h},getsCurrentCollector:function(){if(this.humCollectors=this.sceneManager.dataManager._typeCollectors[o.Type.humidity],this.humCollectors){var a=[];for(var b in this.humCollectors){var c=this.humCollectors[b];c&&this.sceneManager.isCurrentSceneInstance(c.getParentId())&&a.push(c)}return a}}}),c.HumidityManager=s;var t=function(){};mono.extend(t,Object,{getQueue:function(){return 1e3},shouldHandleDoubleClickElement:function(a,b,c,d){return!1},shouldHandleMouseUpElement:function(a,b,c,d){return!1},shouldPropogateDoubleClickElement:function(a,b,c,d){return!1},shouldHandleDoubleClickBackground:function(a,b){return!1},shouldHandleMouseUpBackground:function(a,b){return!1},shouldPropogateDoubleClickBackground:function(a){return!1},shouldHandleClickElement:function(a,b,c,d){return!1},shouldPropogateClickElement:function(a,b,c,d){return!1},shouldHandleClickBackground:function(a){return!1},shouldPropogateClickBackground:function(a){return!1},handleDoubleClickBackground:function(a){},handleClickBackground:function(a){},handleDoubleClickElement:function(a,b,c,d,e){},handleClickElement:function(a,b,c,d){},handleMouseMoveElement:function(a,b,c,d,e){},handleMouseMoveBackground:function(a){},handleMouseUpElement:function(a,b,c,d,e){},handleMouseUpBackground:function(a){}}),c.EventHandler=t;var u=function(a,b,c){mono.PropertyChangeDispatcher.call(this),this.sceneManager=a,this.network=b||this.initView(),this.network.getRootView().style.position="absolute",this._for2d=c,this._defaultNode=new mono.List,this.initResource(),this.configView(),this.networkParameters={},this.cameraParameters={},this.enableDBLClick=!0,this.enableClick=!1,this.enableMousemove=!0,this.enableMouseup=!1,this.visibleMap={}};mono.extend(u,mono.PropertyChangeDispatcher,{initView:function(){return new mono.Network3D},initResource:function(){this._eventHandlers=[],this._materialFilters=[],this.visibleMap={},this._visibleFilters=[],this._selectableFilters=[],this._renderCallbacks=[],this._focusNode=null},initDefault:function(){this.defaultEventHandler=new c.DefaultEventHandler(this.sceneManager),this._eventHandlers.push(this.defaultEventHandler),this.defaultMaterialFilter=new c.VirtualManager(this.sceneManager),this._materialFilters.push(this.defaultMaterialFilter),this.defaultSelectableFilter=new c.SelectableManager(this.defaultMaterialFilter),this._selectableFilters.push(this.defaultSelectableFilter);var a=this;this.addPropertyChangeListener(function(b){if("focusNode"==b.property){var c=b.newValue;a.isDealWithVirtual&&a.dealWithVirtual(c),a.setCameraDistanceForBeforePlayCamere(c)}}),this.defaultEventHandler.addAfterLookFinishedAtListener(function(b,c){a._focusNode==b&&a.setCameraDistanceForAfterPlayCamere(b)}),this.network.setPickingTexturePixel(!1),this.network.sortNodes=!0,this.tooltipManager=new c.TooltipManager(this.sceneManager),this.addEventHandler(this.tooltipManager),this.addRenderCallback(this.tooltipManager),this.addDefaultYRestrict(),this.addCameraDistanceRestrict(),this.setDefaultCamera(),this.sceneManager.addSceneVisibleChangeListener(function(b){a.visibleMap={}})},dealWithVirtual:function(a){if(this.defaultMaterialFilter)if(a)if(this.defaultMaterialFilter.isVirtualOther(this.getDataByNode(a))){if(this.defaultMaterialFilter.addAll(),this.defaultMaterialFilter.removeByDescendant(a),this.sceneManager.isLink(a)){var b=a.getFromNode(),c=a.getToNode(),d=this.getDataByNode(a);d&&(d.getFromId()&&(b=this.sceneManager.getNodeByDataOrId(d.getFromId())),d.getToId()&&(c=this.sceneManager.getNodeByDataOrId(d.getToId()))),this.defaultMaterialFilter.removeByDescendant(b),this.defaultMaterialFilter.removeByDescendant(c)}}else{this.defaultMaterialFilter.addAll();var e=this.sceneManager.getNodeData(a);this.defaultMaterialFilter.remove(e);var f=e._parentId,g=this.sceneManager.dataManager.getDataById(f);this.defaultMaterialFilter.remove(g)}else this.defaultMaterialFilter.clear()},getSetMethod:function(a){var b="set"+a.charAt(0).toUpperCase()+a.slice(1);return b},setNetworkValue:function(a,b){if(a){var c=this.getSetMethod(a);this.network[c]&&"function"==typeof this.network[c]?this.network[c](b):this.network[a]=b,this.networkParameters[a]=b}},resetNetwork:function(){if(this.networkParameters)for(var a in this.networkParameters)this.setNetworkValue(a,this.networkParameters[a])},setCameraValue:function(a,b){if(a){var c=this.network.getCamera(),d=this.getSetMethod(a);c[d]&&"function"==typeof c[d]?c[d](b):c[a]=b,this.cameraParameters[a]=b}},resetCamera:function(){if(this.cameraParameters)for(var a in this.cameraParameters)this.setCameraValue(a,this.cameraParameters[a])},clear:function(){this.defaultMaterialFilter.clearAll();var a=this.network.getDataBox();a.clear(),this._defaultNode.size()>0&&this._defaultNode.forEach(function(b){b instanceof mono.Light||a.add(b)})},addDefaultNode:function(a){if(a){var b=this.network.getDataBox();a instanceof mono.Light||this._defaultNode.add(a),b.add(a)}},initLights:function(){var a=new mono.AmbientLight(16777215);this.addDefaultNode(a);var b=new mono.PointLight(16777215,.05);b.setPosition(1e4,1e4,1e4),this.addDefaultNode(b),b=new mono.PointLight(16777215,.05),b.setPosition(-1e4,1e4,-1e4),this.addDefaultNode(b);var b=new mono.PointLight(16777215,.05);b.setPosition(1e4,1e4,-1e4),this.addDefaultNode(b),b=new mono.PointLight(16777215,.05),b.setPosition(-1e4,1e4,1e4),this.addDefaultNode(b),b=new mono.PointLight(16777215,.05),b.setPosition(0,0,1e4),this.addDefaultNode(b),b=new mono.PointLight(16777215,.05),b.setPosition(0,0,-1e4),this.addDefaultNode(b),b=new mono.PointLight(16777215,.05),b.setPosition(1e4,0,0),this.addDefaultNode(b),b=new mono.PointLight(16777215,.05),b.setPosition(0,0,-1e4),this.addDefaultNode(b)},addDefaultYRestrict:function(){var a=this.getDefaultInteraction();a&&(a.yRistrict=!0,a.yLowerLimitAngle=0,a.yUpLimitAngle=Math.PI/4,a.minDistance=200,a.maxDistance=1e4)},removeDefaultYRestrict:function(){var a=this.getDefaultInteraction();a&&(a.yRistrict=!0,a.yLowerLimitAngle=-Math.PI/2,a.yUpLimitAngle=Math.PI/2,a.minDistance=0,a.maxDistance=1/0)},setDistance:function(a,b){var c=this.getDefaultInteraction();c&&((a||0==a)&&(c.minDistance=0),b&&(c.maxDistance=1/0))},configView:function(){var a=this,b=!1,c=!1;this.network.getRootView().addEventListener("dblclick",function(b){if(a.enableDBLClick){var c=a.filterDoubleClickElement(b);if(c&&a.isHandleDoubleClickable(c.element))a.handleDoubleClick(c);else{if(c&&"unableDBLClick"==c.element.getClient("bid"))return!1;a.handleDoubleClickBackground()}}}),this.network.getRootView().addEventListener("click",function(b){if(a.enableClick){var c=a.filterClickElement(b);c?a.handleClick(c):a.handleClickBackground()}}),this.network.getRootView().addEventListener("mousedown",function(a){b=!0,c=!1}),this.network.getRootView().addEventListener("mouseup",function(d){if(b=!1,a.enableMouseup){d._mousemove=c,c=!1;var e=a.filterMouseMoveElement(d);if(e){e.element;a.handleMouseUpElement(e,d)}else a.handleMouseUpBackground(d)}}),this.network.getRootView().addEventListener("mousemove",function(d){if(c=!0,a.enableMousemove&&(d._mousedown=b,!b)){var e=a.filterMouseMoveElement(d);if(e){e.element;a.handleMouseMoveElement(e,d)}else a.handleMouseMoveBackground(d)}}),this.setOverLoadMaterial(),this.setVisibleFunction(),this.setSelectableFunction(),this.setNetworkRenderCallback()},isHandleDoubleClickable:function(a){return!0},getDataByNode:function(a){if(!a)return null;var b=this.sceneManager.getNodeData(a);if(null==b&&a.getParent()){var c=a.getParent();b=this.sceneManager.getNodeData(c),null==b&&c.getParent()&&(b=this.sceneManager.getNodeData(c.getParent()))}return b},setFocusNode:function(a,c){if(c==b&&(c=!0),this._focusNode!=a){var d=this.getDataByNode(a),e=this.sceneManager.dataManager.getCategoryForData(d);if(e&&e.getId().indexOf("earth")>=0)return void(this._focusNode=null);var f=this._focusNode;this._focusNode=a,this.isDealWithVirtual=c,this.firePropertyChange("focusNode",f,a),this.isDealWithVirtual=!0}},getFocusNode:function(){return this._focusNode},getDefaultEventHandler:function(){return this.defaultEventHandler},removeDefaultEventHandler:function(){this.defaultEventHandler&&(this.removeEventHandler(this.defaultEventHandler),this.defaultEventHandler=null)},getDefaultVirtualMaterialFilter:function(){return this.defaultMaterialFilter},removeDefaultMaterialFilter:function(){this.defaultMaterialFilter&&(this.removeMaterialFilter(this.defaultMaterialFilter),this.defaultMaterialFilter=null)},getDefaultInteraction:function(){return this.network.getDefaultInteraction()},addMaterialFilter:function(a){this.includeMaterialFilter(a)||this._materialFilters.push(a)},removeMaterialFilter:function(a){var b=this._materialFilters.indexOf(a);-1!==b&&(a.destoryBillboard&&a.destoryBillboard(),this._materialFilters.splice(b,1))},includeMaterialFilter:function(a){var b=this._materialFilters.indexOf(a);return-1!==b?!0:!1},addVisibleFilter:function(a){this.includeVisibleFilter(a)||(this.visibleMap={},this._visibleFilters.push(a))},removeVisibleFilter:function(a){var b=this._visibleFilters.indexOf(a);-1!==b&&(this.visibleMap={},this._visibleFilters.splice(b,1))},includeVisibleFilter:function(a){var b=this._visibleFilters.indexOf(a);return-1!==b?!0:!1},addSelectableFilter:function(a){this._selectableFilters.push(a)},removeSelectableFilter:function(a){var b=this._selectableFilters.indexOf(a);-1!==b&&this._selectableFilters.splice(b)},addEventHandler:function(a,d){return a instanceof c.EventHandler?d===b?this._eventHandlers.push(a):this._eventHandlers.splice(d,0,a):void 0},removeEventHandler:function(a){var b=this._eventHandlers.indexOf(a);-1!==b&&this._eventHandlers.splice(b,1)},addRenderCallback:function(a,c){return this._renderCallbacks.indexOf(a)>=0?void 0:a.onRenderCallback?c===b?this._renderCallbacks.push(a):this._renderCallbacks.splice(c,0,a):void 0},removeRenderCallback:function(a){var b=this._renderCallbacks.indexOf(a);-1!==b&&this._renderCallbacks.splice(b,1)},filterMouseMoveElement:function(a){return this.network.getFirstElementByMouseEvent(a,!1)},handleMouseMoveElement:function(a,b){for(var c,d=a.element,e=this.getDataByNode(d),f=0;f<this._eventHandlers.length;f++)c=this._eventHandlers[f],c.handleMouseMoveElement(d,this.network,e,a,b)},handleMouseMoveBackground:function(a){for(var b,c=0;c<this._eventHandlers.length;c++)b=this._eventHandlers[c],b.handleMouseMoveBackground(this.network,a)},handleMouseUpElement:function(a,b){for(var c,d=a.element,e=this.getDataByNode(d),f=0;f<this._eventHandlers.length;f++)if(c=this._eventHandlers[f],c.shouldHandleMouseUpElement(d,this.network,e,a,b))return void c.handleMouseUpElement(d,this.network,e,a,b)},handleMouseUpBackground:function(a){for(var b,c=0;c<this._eventHandlers.length;c++)if(b=this._eventHandlers[c],b.shouldHandleMouseUpBackground(this.network,a))return void b.handleMouseUpBackground(this.network,a)},isFilterVirtualElement:function(){return!0},filterDoubleClickElement:function(a){var b=null,c=this;return this.isFilterVirtualElement()&&(b=function(a){return c.isVirtual(a)}),this.network.getFirstElementByMouseEvent(a,!1,b)},getFirstElementInIntersectsByMouseEvent:function(a,b,c,d){var e=this.network.getPickingByEvent(b),f=a;a instanceof mono.List&&(f=a.toArray());var g=e.intersectObjects(f,!1,c);if(g.length)for(var h=0;h<g.length;h++){var i=g[h],j=i.element;if(null==d||d.call(null,j))return i}return null},getAnimation:function(a){var b=a.element?a.element:a,c=b.getClient("animation");return c},playAnimation:function(a,b){b=b||this.getAnimation(a),b&&make.Default.playAnimation(a.element||a,b)},filterClickElement:function(a){return this.network.getFirstElementByMouseEvent(a,!1)},handleDoubleClick:function(a){for(var b,c=a.element,d=0;d<this._eventHandlers.length;d++){b=this._eventHandlers[d];var e=this.getDataByNode(c);if(b.shouldHandleDoubleClickElement(c,this.network,e,a))return void b.handleDoubleClickElement(c,this.network,e,a)}var f=this.getAnimation(c);f&&this.playAnimation(c,f)},handleClick:function(a){for(var b,c=a.element,d=0;d<this._eventHandlers.length;d++){b=this._eventHandlers[d];var e=this.getDataByNode(c);if(b.shouldHandleClickElement(c,this.network,e,a))return void b.handleClickElement(c,this.network,e,a)}},handleDoubleClickBackground:function(){for(var a,b=0;b<this._eventHandlers.length;b++)if(a=this._eventHandlers[b],a.shouldHandleDoubleClickBackground(this.network))return void a.handleDoubleClickBackground(this.network)},handleClickBackground:function(){for(var a,b=0;b<this._eventHandlers.length;b++)if(a=this._eventHandlers[b],a.shouldHandleClickBackground(this.network))return void a.handleClickBackground(this.network)},clearVisibleMap:function(){this.visibleMap={},this.network.dirtyNetwork()},setOverLoadMaterial:function(){var a=this.network;a.sortOpaqueOrderByMaterial=!1;var b=this._materialFilters;a.getOverLoadMaterial=function(a,c){for(var d=null,e=0;e<b.length;e++){var f=b[e];d=f.filterMaterial(c,d,a)}return d}},setVisibleFunction:function(){var a=this.network,b=this;a.isVisible=function(a){return b.isVisible(a)}},setSelectableFunction:function(){var a=this;this.network.selectableFunction=function(b){if(b){var c=a._selectableFilters;if(!c||c.length<1)return!0;for(var d=0;d<c.length;d++){var e=c[d];if(!e.isSelectable(b,a.network))return!1}}return!0}},setNetworkRenderCallback:function(){var a=this,b=this._renderCallbacks;this.network.renderCallback=function(){for(var c=0;c<b.length;c++){var d=b[c];d.onRenderCallback(a.network)}}},_computeMinDistanceByNode:function(a){if(!a)return 0;var b=a.getBoundingBox(),c=0;return b&&b.size()&&(c=b.size().x,b.size().y<c&&(c=b.size().y),b.size().z<c&&(c=b.size().z),c&&(c+=.6*this.network.getCamera().getNear())),c},getMinDistanceByNode:function(a){var b=this.sceneManager.getNodeData(a);if(b&&b instanceof n){var c=this.sceneManager.getNodeByDataOrId(b.getFromId()),d=this.sceneManager.getNodeByDataOrId(b.getToId()),e=this._computeMinDistanceByNode(c),f=this._computeMinDistanceByNode(d);return f>e?e:f}return this._computeMinDistanceByNode(a)},getCameraDistanceByNode:function(a){if(!a)return null;var b=this.network.getCamera().getFov()||70,c=this.getDefaultInteraction();if(c){var d=this.sceneManager.getNodeData(a),e=this.sceneManager.dataManager.getCategoryForData(d),f=c.minDistance,g=c.maxDistance,h=a.getClient("complexNode");if("unload"==h&&(h=this.sceneManager.loadComplexNode(d)),a=h||a,!a||!a.getBoundingBoxWithChildren)return null;var i=a.getBoundingBoxWithChildren(),j=this.getMinDistanceByNode(a);if(!e)return c.minDistance=j||200,void(c.maxDistance=1e4);var k=e.getId().toLowerCase(),l=this.sceneManager.getCurrentScene();if(k.indexOf("datacenter")>=0){var m=1500,n=0;i&&i.size().x&&(n=i.size().x,i.size().z>n&&(n=i.size().z)),n>0&&(m=n*Math.atan(Math.PI*(90-b/2)/360)),f=300,g=m}else if(k.indexOf("building")>=0)if(l&&l.getCategoryId().toLowerCase().indexOf("building")>=0)f=100,g=1e4;else{var o=this.sceneManager.getCurrentRootNode();if(o){var h=o.getClient("complexNode");"unload"==h&&(h=this.sceneManager.loadComplexNode(this.sceneManager.getNodeData(o))),o=h||o}var i=o?o.getBoundingBox():null,m=2e3;if(i){var p=i.size().x;i.size().y>p&&(p=i.size().y),p&&(m=p*Math.atan(Math.PI*(90-b/2)/180))}m==-(1/0)&&(m=2e3),f=200,g=m}else if(k.indexOf("floor")>=0||k.indexOf("channel")>=0||k.indexOf("area")>=0||k.indexOf("room")>=0){if(f=100,g=1e4,i&&i.size()){var n=0;i.size().x>n&&(n=i.size().x),i.size().z>n&&(n=i.size().z),i.size().y>n&&(n=i.size().y),n>1e4&&(g=n)}}else k.indexOf("rack")>=0||k.indexOf("equipment")>=0||k.indexOf("card")>=0?(f=j||50,g=500):(f=j||200,g=1e4);if(l&&e&&l.defaultInteractionParameters&&l.getCategoryId()==e.getId()){var q=l.defaultInteractionParameters;parseInt(q.maxDistance)&&(g=parseInt(q.maxDistance)),parseInt(q.minDistance)&&(f=parseInt(q.minDistance))}return{maxDistance:g,minDistance:f}}},setCameraDistanceForBeforePlayCamere:function(a){if(this.cameraDistanceRestrict&&a){var b=this.getDefaultInteraction();if(b){var c=this.getCameraDistanceByNode(a);if(c){var d=b.maxDistance,e=b.minDistance,f=c.minDistance,g=c.maxDistance;g&&g>d&&(b.maxDistance=g),f&&e>f&&(b.minDistance=f)}}}},setCameraDistanceForAfterPlayCamere:function(a){if(this.cameraDistanceRestrict&&a){var b=this.getDefaultInteraction();if(b){var c=this.getCameraDistanceByNode(a);if(c){var d=(b.maxDistance,b.minDistance,c.minDistance),e=c.maxDistance;e&&(b.maxDistance=e),d&&(b.minDistance=d)}}}},resetCameraDistance:function(a){if(this.cameraDistanceRestrict&&a){var b=this.network.getCamera().getFov()||70,c=this.getDefaultInteraction();if(c){var d=this.sceneManager.getNodeData(a),e=this.sceneManager.dataManager.getCategoryForData(d),f=a.getClient("complexNode");"unload"==f&&(f=this.sceneManager.loadComplexNode(d)),a=f||a;var g=a.getBoundingBoxWithChildren(),h=this.getMinDistanceByNode(a);if(!e)return c.minDistance=h||200,void(c.maxDistance=1e4);var i=e.getId().toLowerCase(),j=this.sceneManager.getCurrentScene();if(i.indexOf("datacenter")>=0){var k=1500,l=0;g&&g.size().x&&(l=g.size().x,g.size().z>l&&(l=g.size().z)),l>0&&(k=l*Math.atan(Math.PI*(90-b/2)/360)),c.minDistance=300,c.maxDistance=k}else if(i.indexOf("building")>=0)if(j&&j.getCategoryId().toLowerCase().indexOf("building")>=0)c.minDistance=100,c.maxDistance=1e4;else{var m=this.sceneManager.getCurrentRootNode();if(m){var f=m.getClient("complexNode");"unload"==f&&(f=this.sceneManager.loadComplexNode(this.sceneManager.getNodeData(m))),m=f||m}var g=m?m.getBoundingBox():null,k=2e3;if(g){var n=g.size().x;g.size().y>n&&(n=g.size().y),n&&(k=n*Math.atan(Math.PI*(90-b/2)/180))}k==-(1/0)&&(k=2e3),c.minDistance=200,c.maxDistance=k}else if(i.indexOf("floor")>=0||i.indexOf("channel")>=0||i.indexOf("area")>=0||i.indexOf("room")>=0){if(c.minDistance=100,c.maxDistance=1e4,g&&g.size()){var l=0;g.size().x>l&&(l=g.size().x),g.size().z>l&&(l=g.size().z),g.size().y>l&&(l=g.size().y),l>1e4&&(c.maxDistance=l)}}else i.indexOf("rack")>=0||i.indexOf("equipment")>=0||i.indexOf("card")>=0?(c.minDistance=h||50,c.maxDistance=1e3):(c.minDistance=h||200,c.maxDistance=1e4);if(j&&e&&j.defaultInteractionParameters&&j.getCategoryId()==e.getId()){var o=j.defaultInteractionParameters;parseInt(o.maxDistance)&&(c.maxDistance=parseInt(o.maxDistance)),parseInt(o.minDistance)&&(c.minDistance=parseInt(o.minDistance))}}}},setCameraDistance:function(a,c){var d=this.getDefaultInteraction();d&&(null!=a&&a!=b&&parseInt(a)&&(d.minDistance=parseInt(a)),null!=c&&c!=b&&parseInt(c)&&(d.maxDistance=parseInt(c)))},setSelectedStype:function(a,b){if(a&&!(a instanceof Array&&a.length<1)){this.defaultInteractions=this.network.getInteractions();var c=new mono.DefaultInteraction(this.network);c.maxDistance=3e3,c.minDistance=800,this.network.setInteractions([c]);var b=b||"#0431B4",d=this.network.getDataBox().getSelectionModel();if(a instanceof Array)for(var e=0;e<a.length;e++){var f=a[e];f.s({"m.type":"phong","select.style":"outline.glow","select.color":b}),d.appendSelection(f)}else a.s({"m.type":"phong","select.style":"outline.glow","select.color":b}),d.appendSelection(a)}},addCameraDistanceRestrict:function(){this.cameraDistanceRestrict=!0},removeCameraDistanceRestrict:function(){delete this.cameraDistanceRestrict},lookAt:function(a){this.defaultEventHandler&&this.defaultEventHandler.lookAt&&this.defaultEventHandler.lookAt(a)},setDefaultCamera:function(){var a=this.network.getCamera();a.setNear(50),a.fov=70},isVisible:function(a){if(!a)return!1;var b=null,d=a;if(a instanceof c.Data?(b=a,d=null):d instanceof mono.Billboard&&d.getClient("_alarmBillboard")?b=d.getClient("_alarmBillboard"):a instanceof mono.Element?b=this.sceneManager.getNodeData(a):"string"==typeof a&&(b=this.sceneManager.dataManager.getDataById(a),d=null),!b)return d.isVisible();if(d||(d=this.sceneManager.getNodeByDataOrId(b)),!d)return!1;if(!d.isVisible())return!1;if(1==this.visibleMap[d.getId()])return!0;if(0==this.visibleMap[d.getId()])return!1;if(d instanceof TGL.Link||d instanceof TGL.PathLink){if(!this.isVisible.call(this,d._fromNode))return this.visibleMap[d.getId()]=!1,!1;if(!this.isVisible.call(this,d._toNode))return this.visibleMap[d.getId()]=!1,!1}for(var e=this._visibleFilters,f=0;f<e.length;f++){var g=e[f];if(!g.isVisible(d,b,this.network))return this.visibleMap[d.getId()]=!1,!1}return this.visibleMap[d.getId()]=!0,!0},isVirtual:function(a){for(var b=0;b<this._materialFilters.length;b++){var c=this._materialFilters[b];if(c&&c.isVirtual&&c.isVirtual(a))return!1}return!0}}),c.ViewManager=u;var v=function(b,c){mono.PropertyChangeDispatcher.call(this),this.sceneManager=b,this.map=null,this.network=c,c||(a.BMap?(this.network=new twaver.canvas.Network,this.network.setRectSelectEnabled(!1)):this.network=new twaver.vector.Network),this.container=document.createElement("div"),this.container.style.position="absolute",this.mapView=null,this._visibleFilters=[],this._selectableFilters=[],this._eventHandlers=[];var d=this;this.dbClickHandle=function(a){if(a){var b=d.network.getElementAt(a);b?d.handleDoubleClick({element:b}):d.handleDoubleClickBackground()}},this.network.adjustBounds({x:0,y:0,width:1,height:1}),this.left=1,this.top=0,this.width=document.documentElement.clientWidth,this.height=document.documentElement.clientHeight,this.adapter=null,this.isCreateMap=!1,this.focusData=null,this.isGis=null;var e=this.network.getElementBox();this.tree=new twaver.controls.Tree(e),this.table=new twaver.controls.Table(e),this.tableRule={},this.treeRule={},this.addTableAndTree()};mono.extend(v,mono.PropertyChangeDispatcher,{createMap:function(){if(this.registerNormalImage("./images/building1.png","b1"),this.registerNormalImage("./images/building2.png","b2"),this.registerNormalImage("./images/building3.png","b3"),a.BMap){var b;document.getElementById("mainView")?b=document.getElementById("mainView"):(b=document.createElement("div"),b.id="mainView",b.style.height="100%",document.body.appendChild(b)),b.appendChild(this.container),this.container.style.height="100%",this.container.style.width="100%",this.mapView=document.createElement("div"),this.mapView.id="MapView",this.mapView.style.height="100%",this.container.appendChild(this.mapView),this.map=new BMap.Map("MapView");var c=this.map,d=new BMap.Point(108.95,34.27);c.centerAndZoom(d,7),c.addControl(new BMap.NavigationControl),c.enableScrollWheelZoom();var e=this.network.getView();document.getElementsByClassName("BMap_mask")[0].appendChild(e),this.network.adjustBounds({x:0,y:0,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight});var f=this.network,g=this;f.addInteractionListener(function(a){if(a.kind="liveMoveBetween"){c.disableDragging();var b=f.getSelectionModel().getSelection();b.forEach(function(a){var b=new BMap.Pixel(a.getX(),a.getY());c.pixelToPoint(b)})}}),f.getView().addEventListener("dbclick",function(a){f.getElementAt(a)?(c.disableDoubleClickZoom(),a.preventDefault()):c.enableDoubleClickZoom()}),f.getView().addEventListener("mousedown",function(a){f.getElementAt(a)?c.disableDragging():c.enableDragging()}),f.getView().addEventListener("mousedown",function(a){clickPoint=f.getLogicalPoint(a)}),f.getView().addEventListener("mouseup",function(a){clickPoint=null}),c.addEventListener("movestart",function(){e.style.opacity=0}),c.addEventListener("moveend",function(){e.style.opacity=1,g.changePostionWithMap()}),c.addEventListener("dragstart",function(){e.style.opacity=0,g.changePostionWithMap()}),c.addEventListener("dragend",function(){e.style.opacity=1,g.changePostionWithMap()}),c.addEventListener("zoomstart",function(){e.style.opacity=0,g.changePostionWithMap()}),c.addEventListener("zoomend",function(){e.style.opacity=1,g.changePostionWithMap()}),this.isCreateMap=!0}else{this.mapView=document.createElement("div");var c=this.map=new twaver.gis.Map(this.mapView,"MapView");c.setSize({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}),c.setEnableDoubleZoom(!1),c.addLayer("BINGMAP",GISConsts.EXECUTOR_TYPE_BINGMAP),c.setZoomLevel(5),c.setCenter(new twaver.gis.geometry.GeoCoordinate(31.41,121.48)),this.adapter=new twaver.gis.Adapter,this.isCreateMap=!0}},changePostionWithMap:function(){if(a.BMap){var b=this;this.network.getElementBox().forEach(function(a){if(a instanceof twaver.Node){var c=a.getClient("coordinate"),d=b.map.pointToPixel(c);a.setCenterLocation(d.x,d.y)}})}},clearContainer:function(){var a=this.container.childNodes;if(a&&a.length>0)for(var b=0;b<a.length;b++)this.container.removeChild(a[b])},bindGIS:function(){null!=this.isGis&&this.isGis||(this.isCreateMap||this.createMap(),this.adapter&&this.map&&this.adapter.bindNetworkAndMap(this.network,this.map),this.clearContainer(),this.container.appendChild(this.mapView),this.network.getView().removeEventListener("dblclick",this.dbClickHandle),a.BMap?this.map.addEventListener("dblclick",this.dbClickHandle):this.map.getView().addEventListener("dblclick",this.dbClickHandle),this.adjustViewBounds(),this.isGis=!0)},unbindGIS:function(){(null==this.isGis||this.isGis)&&(this.adapter&&this.adapter.unbindNetworkAndMap(),this.clearContainer(),this.container.appendChild(this.network.getView()),this.container.parentNode&&this.adjustViewBounds(),this.map&&(a.BMap?this.map.removeEventListener("dblclick",this.dbClickHandle):this.map.getView().removeEventListener("dblclick",this.dbClickHandle)),this.network.getView().addEventListener("dblclick",this.dbClickHandle),this.isGis=!1)},getContainer:function(){return this.container},removeGis:function(){this.unbindGIS(),this.hideNavigator(),this.hideOverView()},addGis:function(a,b){this.bindGIS(),a&&this.showNavigator(),b&&this.showOverView()},adjustViewBounds:function(b,c,d,e){arguments.length<1?(this.flag?this.flag++:this.flag=1,this.width=this.width+Math.pow(-1,parseInt(this.flag))):this.flag=0,this.left=d||this.left,this.top=e||this.top,this.width=b||this.width,this.height=c||this.height,this.network.adjustBounds({x:this.left,y:this.top,width:this.width,height:this.height}),this.isCreateMap&&this.map&&(a.BMap||(this.map.setSize({width:this.width,height:this.height}),this.map.content.style.left=this.left+"px",this.map.content.style.top=this.top+"px"))},setZoomLevel:function(b){b&&this.isCreateMap&&this.map&&(a.BMap||this.map.setZoomLevel(5))},setCenter:function(b){if(this.isCreateMap&&this.map&&b&&b.x&&b.y)if(a.BMap){var c=new BMap.Point(b.y,b.x);this.map.centerAndZoom(c,7)}else this.map.setCenter(new twaver.gis.geometry.GeoCoordinate(b.x,b.y))},showNavigator:function(b,c){if(this.isCreateMap&&!a.BMap){var d=document.getElementById("navigator_id");if(d)d.style.display="block";else{var e=new twaver.gis.gadget.Navigator("navigator_id",this.map);b||(b=20),c||(c=50),this.map.installGadget(e,{x:b,y:c})}}},hideNavigator:function(){if(this.isCreateMap){var a=document.getElementById("navigator_id");a&&(a.style.display="none")}},showOverView:function(c,d,e,f){if(this.isCreateMap&&!a.BMap)if(this.overview&&this.overview.getView())this.overview.getView().style.display="block";else{var g=this.overview=new twaver.gis.gadget.Overview("overview_id",this.map);(null==e||e==b||0>e)&&(e=150),(null==f||f==b||0>f)&&(f=150),g.setSize({width:e,height:f}),g.map.addLayer("BINGMAP",GISConsts.EXECUTOR_TYPE_BINGMAP),g.setBorder("1px solid red"),c=c?c-e+5:e+5,d=d?d-f+5:f+5,this.map.installGadget(g,{right:c,bottom:d})}},hideOverView:function(){this.overview&&this.overview.getView()&&(this.overview.getView().style.display="none")},registerNormalImage:function(a,b){var c=this,d=new Image;d.src=a,
d.onload=function(){twaver.Util.registerImage(b,d,d.width/2,d.height/2),d.onload=null,c.network.invalidateElementUIs()}},setPosition:function(b,c,d){if(b)if(this.container.contains(this.mapView)){if(a.BMap){var e=new BMap.Point(d,c);b.setClient("coordinate",e);var f=this.map.pointToPixel(e);b.setCenterLocation(f.x,f.y)}else{var g=new twaver.gis.geometry.GeoCoordinate(parseInt(c)||0,parseInt(d)||0);b.setClient(GISSettings.GEOCOORDINATE,g)}this.setDefaultImage(b)}else b.setLocation(parseInt(c)||0,parseInt(d)||0)},setDefaultImage:function(a,b){if(a)if(1==b)a.setImage("b1");else if(2==b)a.setImage("b2");else if(3==b)a.setImage("b3");else{var c=parseInt(3*Math.random()+1);a.setImage("b"+c)}},getDataByNode:function(a){return a?this.sceneManager.getNodeData(a):null},handleDoubleClick:function(a){for(var b,c=a.element,d=0;d<this._eventHandlers.length;d++){b=this._eventHandlers[d];var e=this.getDataByNode(c);if(b.shouldHandleDoubleClickElement(c,this.network,e,a))return b.handleDoubleClickElement(c,this.network,e,a),void(this.focusData=e)}},handleDoubleClickBackground:function(){if(this.focusData&&this.focusData.getParentId()){var a=this.sceneManager.dataNodeMap[this.focusData.getParentId()];a&&this.sceneManager.viewManager3d.setFocusNode(a)}for(var b,c=0;c<this._eventHandlers.length;c++)if(b=this._eventHandlers[c],b.shouldHandleDoubleClickBackground(this.network))return void b.handleDoubleClickBackground(this.network)},addEventHandler:function(a,d){return a instanceof c.EventHandler?d===b?this._eventHandlers.push(a):this._eventHandlers.splice(d,0,a):void 0},removeEventHandler:function(a){var b=this._eventHandlers.indexOf(a);-1!==b&&this._eventHandlers.splice(b,1)},createColumn:function(a,b,c,d,e,f){var g=new twaver.Column(b);return g.setName(b),g.setPropertyName(c),g.setPropertyType(d),e&&g.setValueType(e),f?g.setWidth(f):g.setClient("pack",!0),g.renderHeader=function(a){var b=document.createElement("span");b.style.whiteSpace="nowrap",b.style.verticalAlign="middle",b.style.padding="1px 2px 1px 2px",b.innerHTML=g.getName()?g.getName():g.getPropertyName(),b.setAttribute("title",b.innerHTML),b.style.font="bold 12px Helvetica",a.style.textAlign="center",a.appendChild(b)},a.getColumnBox().add(g),g},addTableAndTree:function(){var a=this.network.getView(),b=new twaver.controls.TablePane(this.table),c=b.getTableHeader().getView();c.style.backgroundColor="rgba(255,255,255,0.1)";var d=b.getView();d.style.position="absolute",d.style.bottom="30px",d.style.left="400px",d.style.width="500px",d.style.height="120px",a.appendChild(d);var e=this.tree.getView();e.style.position="absolute",e.style.top="30px",e.style.left="30px",e.style.width="160px",e.style.height="250px",a.appendChild(e),this.tree.getToggleImage=function(a){return a.getChildrenSize()>0?this.isExpanded(a)?"../images/collapse_icon.png":"../images/expand_icon.png":null},this.tree.getIcon=function(a){return null}},initTable:function(a){this.table.setEditable(!0),this.createColumn(this.table,"","toolTip","accessor","string").setWidth(80);var b=this.createColumn(this.table,"","toId","client","string",!0);b.setWidth(150),this.createColumn(this.table,"","flow","client","string",!0).setWidth(120);var d=this.createColumn(this.table,"","raisedTime","client","Date");d.setWidth(150),d.setHorizontalAlign("center"),d.renderCell=function(a){var b=document.createElement("span");b.innerHTML=c.Util.formatDate(a.value,"yyyy-MM-dd hh:mm:ss"),b.style.whiteSpace="nowrap",a.div.appendChild(b)}},refreshTable:function(){var a=this.network.getView(),b=new twaver.controls.TablePane(this.table),c=(b.getTableHeader().getView(),b.getView());c.style.position="absolute",c.style.bottom="30px",c.style.left="400px",c.style.width="500px",c.style.height="120px",a.appendChild(c)},showTable:function(a){this.table.getColumnBox().clear(),this.table.getView().style.display="block",this.table.setVisibleFunction(function(a){return a.getName()?!1:a.getName()||a.getToolTip()?a.getClient("group_id")?!1:!0:!1}),this.initTable(a),this.refreshTable()},showTree:function(a){this.tree.getView().style.display="block",this.tree.setLineType("dotted"),this.tree.setLineColor("#000000"),this.tree.setLineAlpha(1),this.tree.setLineThickness(.5),this.tree.setLineDash([1,1]),this.tree.setVisibleFunction(function(a){return a.getName()||a.getToolTip()?!0:!1}),this.tree.getLabel=function(a){return a.getToolTip()||a.getName()},this.tree.expandAll()}}),c.ViewManager2D=v,c.SceneManager=function(a){d.checkNotNull(a,"dataManager"),t.call(this),this.dataManager=a,this.initViewManager(),this.network3d=this.viewManager3d.network,this.network2d=this.viewManager2d&&this.viewManager2d.network,this.prefabMap={},this.dataNodeMap={},this.dataNode2DMap={},this.linkMap={},this.categoryNodeMap={},this.assetTypeNodeMap={},this.locationManager=new c.LocationManager(this),this._sceneManagerChangeDispatcher=new mono.EventDispatcher,this._sceneChangeDispather=new mono.EventDispatcher,this._sceneVirtualChangeDispather=new mono.EventDispatcher,this._sceneVisibleChangeDispather=new mono.EventDispatcher,this._scenes=[],this._sceneMap=[],this._sceneNodeMap={},this._sceneNodes=[],this.cameraManager=new $CameraManager(this),this.viewManager3d.initDefault(),this._linkTemplateMap={};var b=this.getAlarmManagerClass();this._alarmManager=new b(this.dataManager,this),this.doubleClickBackgroundGotoUpLevelScene=!1,this.linkControlsFunction=function(a,b,c){var d=b.getBoundingBox(),e=c.getBoundingBox(),f=20,g=Math.max(d.max.y,e.max.y),h=b.frontWorldPosition(d.max.z+f),i=c.frontWorldPosition(e.max.z+f),j=[];return j.push(h),j.push(h.clone().add(new mono.Vec3(0,g,0))),j.push(i.clone().add(new mono.Vec3(0,g,0))),j.push(i),j},this.gcsManager=new c.GCSManager({sceneManager:this}),this.postManager=new I(this),this.beforeLoadSceneFunction=null,this.afterLoadSceneFunction=null,this.isBindingBuildingAndFloor=!0,this.sceneChangeWithOutAnimate=!1,this.resetCameraWhenSceneChange=!0,this.lightManager=new y(this),this.adapterManager=new $PropertyChangeAdaperManager(this),this.invisibleFilter=new c.VisibleManager(this),this.viewManager3d.addVisibleFilter(this.invisibleFilter),this.sceneViewMap={},this._focusNode=null,this.isClearCache=!1;var e=this;a.addDataManagerChangeListener(function(a){if(e._loaded){var b=a.kind;"add"===b?e.handleDataAdd(a):"remove"===b&&e.handleDataRemove(a)}}),a.addDataPropertyChangeListener(function(a){e._loaded&&e.handleDataPropertyChange(a)}),this.removeAndAddAllChildrenWhenSetFocusFilter=null,this.addSceneChangeListener(function(a){e.setDefaultInteractionValue(a.data)})},c.SceneManager.CLIENT_IT_DATA="it_data",c.SceneManager.CLIENT_IT_DATA_ID="it_data_id",c.SceneManager.CLIENT_EXT_VITUAL="it_extend_virtual_node",c.SceneManager.CLIENT_EXT_VISIBLE="it_extend_visible_node",c.SceneManager.getNodeData=function(a){return a.getClient(c.SceneManager.CLIENT_IT_DATA)},c.SceneManager.getNodeDataId=function(a){return a?a.getClient(c.SceneManager.CLIENT_IT_DATA_ID):null},mono.extend(c.SceneManager,t,{getSceneView:function(a){var b;return document.getElementById("mainView")?b=this.mainView=document.getElementById("mainView"):(b=this.mainView=document.createElement("div"),b.id="mainView"),a&&this.sceneViewMap[a]&&this.sceneViewMap[a].getContainer()&&(b.appendChild(this.sceneViewMap[a].getContainer()),this.network3d.getRootView().style.display="none"),b.appendChild(this.network3d.getRootView()),this.viewManager2d&&b.appendChild(this.viewManager2d.getContainer()),b},adjust2DBounds:function(a,b,c,d){this.viewManager2d&&this.viewManager2d.adjustViewBounds(a,b,c,d)},adjust3DBounds:function(b,c,d,e){b||(b=document.documentElement.clientWidth),c||(c=document.documentElement.clientHeight),d=d||0,e=e||0,this.network3d.adjustBounds(b-d,c-e);var f=this;a.addEventListener?a.addEventListener("resize",function(){f.network3d.adjustBounds(b-d,c-e,e,d)},!0):a.attachEvent?a.attachEvent("onresize",function(){f.network3d.adjustBounds(b-d,c-e,e,d)}):a.onresize=function(){f.network3d.adjustBounds(b-d,c-e,e,d)}},removeAndAddAllChildrenWhenSetFocus:function(a){if(this.removeAndAddAllChildrenWhenSetFocusFilter)return this.removeAndAddAllChildrenWhenSetFocusFilter(a);if(!a)return!1;var b=this.getNodeData(a);if(b){var c=this.dataManager.getCategoryForData(b);if(c&&c.getId()&&c.getId().toLowerCase().indexOf("rack")>=0)return!0}return!1},isChild:function(a,b){if(!a||!b)return!1;var c=this.getNodeData(a);if(!c)return!1;var d=this.getNodeData(b);return d&&d instanceof g&&d.getParentId()&&d.getParentId()===c.getId()?!0:!1},adjustBounds:function(a,b,c,d){this.adjust2DBounds(a,b,c,d),this.adjust3DBounds(a,b,c,d)},getDataBox:function(){var a=this.getCurrentSceneView();return a&&a.getNetwork3D()?a.getNetwork3D().getDataBox():this.network3d.getDataBox()},getDataBox2d:function(){return this.network2d.getElementBox()},setDefaultInteractionSpeed:function(a,b,c){var d=this.network3d.getDefaultInteraction();d&&(d.setRotateSpeed(a),d.setPanSpeed(b),d.setZoomSpeed(c))},shouldHandleDoubleClickBackground:function(a){if(!this.doubleClickBackgroundGotoUpLevelScene)return!1;if(!this.dataManager.getRootScene())return!1;if(this._currentScene===this.dataManager.getRootScene())return!1;if(a instanceof mono.Network3D){var b=this.viewManager3d.getFocusNode();if(b&&(b=this.getMainNode(b),this._currentRootNode!==b))return!1}return!0},handleDoubleClickBackground:function(a){this.gotoUpLevelScene()},shouldHandleDoubleClickElement:function(a,b,c,d){var e=this.dataManager;if(!e.getRootScene())return!1;if(a.doubliClick)return!0;if(!c)return!1;var f=null,g=this.getSceneAndRootByData(c);return g&&(f=g.scene),f&&this._currentScene!=f?!0:!1},handleDoubleClickElement:function(a,b,c,d,e){var f=(this.dataManager,this.getSceneAndRootByData(c)),g=f.scene,h=f.rootData||c,i=this.getNodeByDataOrId(h),j=a.doubliClick||(i?i.doubliClick:null);return j?j(a,b,c,d,e):this._currentScene==g?void(e&&e()):(this.toScene(g,h,e),void(h&&this.viewManager3d.setFocusNode(this.dataNodeMap[h.getId()])))},clearCache:function(a,b){if(a=a||this._currentScene,b=b||this._currentRootData,a&&b)for(var c in this.dataNodeMap){var d=this.dataNodeMap[c],e=this.getNodeData(d),f=this.dataManager.getDataTypeForData(e);if(f&&f.getModel()){var g=f.getModel().replace("twaver.idc.","").replace("twaver.meeting.","");make.Default._objObject[g]&&delete make.Default._objObject[g],make.Utils3D._objObject[g]&&delete make.Utils3D._objObject[g]}a&&"earth"!=a.getCategoryId()&&this.isSceneInstance(a,b,e)||delete this.dataNodeMap[c]}else this.dataNodeMap={};for(var h in make.Default._objMap)make.Default._objMap[h]=[];this.prefabMap={},this._sceneNodes=[],this._sceneNodeMap={},this.categoryNodeMap={},this.assetTypeNodeMap={};for(var i=this.dataManager._datas,j=0;j<i.length;j++){var k=i[j].boards;if(k&&k instanceof Array){for(var l=0;l<k.length;l++){var m=k[l];m&&m.setParent(null)}delete i[j].boards}}this._alarmManager._alarmBillboardMap={},this._alarmManager._alarmNodeMap={}},clear:function(a,b){this.beforeClearFunction&&this.beforeClearFunction();var c=new mono.List;for(var d in this.dataNodeMap){var e=this.dataNodeMap[d];e&&(e.setParent(null),c.add(e))}this.viewManager3d.clear(),this.getDataBox2d().clear(),this.clearSceneNodeMap(),this._sceneManagerChangeDispatcher.fire({kind:"clear",datas:c}),this.isClearCache&&this.clearCache(a,b)},getCurrentScene:function(){return this._currentScene},getParentScene:function(a){if(!a)return null;var b=this.dataManager.getParent(a);if(!b)return null;var c=this.dataManager.getCategoryForData(b);if(!c)return this.getParentScene(b,this);var d=this.dataManager.getSceneByCategory(c);return d?{scene:d,data:b}:this.getParentScene(b,this)},gotoUpLevelScene:function(){var a=this._currentScene;return a?void(a.getTwod()?(this.clear(),this.gotoUpLevelSceneFor2D()):this.gotoUpLevelSceneFor3D()):!1},toScene:function(a,b,c,d){if(a){var e=this,f=function(){e.clear(a,b),e._loadOneScene(a,b,c,d)};this.beforeLoadSceneAnimate(a,b,this._currentScene,this._currentRootData,f,this)}},gotoScene:function(a,b,c,d){if(!a)return void(c&&c("scene is null"));if(a==this._currentScene){var e=this.getNodeData(this._currentRootNode);if(b&&e&&b==e)return void(c&&c("scene is current scene, no change"))}this.toScene(a,b,c,d),b&&!a.getTwod()&&this.setFocusNode(this.dataNodeMap[b.getId()])},gotoUpLevelSceneFor2D:function(){var a=this._currentScene;if(!a)return!1;var b=this._currentRootNode;if(!b)return!1;var c=this.getNodeData(b),d=this.getParentScene(c);if(d&&d.scene&&d.data){var e=this,f=function(){var a=e.getNodeData(b);if(a&&a.getParentId()){var c=e.dataNodeMap[a.getParentId()],d=e.network3d.getDataBox();c&&d.getDataById(c.getId())||(e.loadLazyData(a.getParentId()),c=e.dataNodeMap[a.getParentId()]),c&&e.viewManager3d.lookAt(c)}};this.toScene(d.scene,d.data),f()}this.afterGotoUpLevelScene(c,a,d.data,d.scene)},afterGotoUpLevelScene:function(a,b,c,d){},getUpLevelDataByData:function(a){return a?this.dataManager.getParent(a):null},gotoUpLevelSceneFor3D:function(){var a=this._currentScene;if(!a)return!1;var b=this._currentRootNode,c=this._currentRootData;if(!b&&!c)return!1;var d=this.getNodeData(b);d||(d=c);var e=this.getUpLevelDataByData(d);if(!e)return!1;var f=this.getSceneAndRootByData(e);return f?(this.gotoScene(f.scene,f.rootData),this.afterGotoUpLevelScene(d,a,e,f),!0):!1},gotoData:function(a){var b=this.dataManager,c=a;if(typeof a!==g&&(c=b.getDataById(a)),!c)return!1;var d=b.getCategoryForData(c);if(!d)return!1;var e=this.dataManager.getSceneByCategory(d);if(!e)return!1;this.toScene(e,c);var f=null;return c&&(f=this.dataNodeMap[c.getId()]),this.setFocusNode(f),!0},initViewManager:function(){this.viewManager3d=new c.ViewManager(this),this.viewManager3d.addEventHandler(this),c.ViewManager2D&&(this.viewManager2d=new c.ViewManager2D(this),this.viewManager2d.addEventHandler(this))},removeNodeChildren:function(a,b){var c=a;(a instanceof g||"string"==typeof a)&&(c=this.getNodeByDataOrId(a));var d=this.getDataBox(),e=c.getChildren().toList();e.forEach(function(a){(!b||b(a))&&(a.setParent(null),d.removeByDescendant(a))})},setNodeData:function(a,b,d){if(b&&(!b.getClient(c.SceneManager.CLIENT_IT_DATA)||!b.getClient(c.SceneManager.CLIENT_IT_DATA_ID))){b.setClient(c.SceneManager.CLIENT_IT_DATA,a),b.setClient(c.SceneManager.CLIENT_IT_DATA_ID,a.getId()),d?b.setClient("modelParent",d):(d=b,b.setClient("modelParent",null));var e=b.getClient("complexNode");e&&"unload"!=e&&this.setNodeData(a,e,d);var f=this;b.getChildren()&&b.getChildren().size()>0&&b.getChildren().forEach(function(b){f.setNodeData(a,b,d)})}},getMainNode:function(a){return a?(null==a.getClient(c.SceneManager.CLIENT_IT_DATA)&&(a=a.getParent()),this.getNodeByDataOrId(this.getNodeData(a))):void 0},getParentNode:function(a){var b=a.getParentId();return b?this.dataNodeMap[b]:null},getChildrenNodes:function(a,b){var c=a;a instanceof mono.Node&&(c=this.getNodeData(node));var d,e=0,f=[];if(c)for(d=this.dataManager.getChildren(c,b),e=0;e<d.length;e++)f.push(this.getNodeByDataOrId(d[e]));return f},getNodeData:function(a){return a&&a.getClient?a.getClient("it_data"):null},getNodeByDataOrId:function(a){if(!a)return null;var b=a.getId?a.getId():a;return this.dataNodeMap[b]},getNodeForDataOrId:function(a){if(!a)return null;var b=a.getId?a.getId():a;return this.dataNodeMap[b]},loadModel:function(a,b,c,d,e){var b=JSON.parse(JSON.stringify(b)),f=null;if(c&&d&&(f=this.prefabMap[d],f&&f.clonePrefab&&(f=f.clonePrefab())),!f){b=b||{},b.type=b.type||a;var g=a||b.type;if(!g)return null;var h={};b instanceof Array?(h.data=b,h.id=g):"twaver.loader"===g?(h.id=g,h.data=b):(h=b||{},h.id=g);var i=make.Default.load(h,e);if(!i)return null;c&&d&&"twaver.loader"!=g?(this.prefabMap[d]=i,f=i.clonePrefab()):f=i}return f},loadDataTypeTemplateModels:function(a,b,c){var d=a.getTemplateDatas();if(null!=d&&0!=d.length){var e=this;d.forEach(function(a){a=e._translateTemplateData(a,b);var d=e.dataNode2DMap[b.getId()],f=e.loadDataModel2D(a,c);f&&(f.setMovable(!1),f.setHost(d),f.setParent(d),f.setName(""))})}},_loadDataModeCallback:function(a,b,c){var d=this.dataManager,e=this.network3d.getDataBox(),f=a.getId(),g=d.getDataTypeForData(a),h=d.getCategoryForData(a);e.addByDescendant(b),!this.dataNodeMap[f]&&this.afterFirstLoadDataModelFunction&&this.afterFirstLoadDataModelFunction(a,b),this.dataNodeMap[f]=b;var i=this.assetTypeNodeMap[g.getId()];i||(i={},this.assetTypeNodeMap[g.getId()]=i),i[f]=b,h&&(i=this.categoryNodeMap[h.getId()],i||(i={},this.categoryNodeMap[h.getId()]=i),i[f]=b),this.setNodeData(a,b),this.addToSceneNodeMap(a,b),c&&c(b),this._sceneManagerChangeDispatcher.fire({kind:"add",data:b})},loadDataModel:function(a,b,c){var d=this.dataManager,e=d.getDataTypeForData(a),f=d.getCategoryForData(a);if(!f||f.isVisible()||(this.invisibleFilter.setVisible(a,!1),b)){var g=(this.network3d.getDataBox(),a.getId()),h=this.dataNodeMap[g],i=(e.getModelParameters(),e.isPrefabAble(),e.isSimplePrefabAble()),j=e.getSimpleModel(),k=e.getSimpleModelParameters();if(h)this._loadDataModeCallback(a,h,c);else{var l;if(j&&(l=this.loadModel(j,k,i,e.getId()+"_simple")),l){var m=l.getBoundingBoxWithChildren&&l.getBoundingBoxWithChildren(),n={x:1,y:1,z:1};m&&(n=m.size());var o=new mono.Cube(n.x,n.y,n.z);o.s({"m.visible":!1}),l.setParent(o),o.setClient("simpleNode",l),o.setClient("complexNode","unload"),this._loadDataModeCallback(a,o,c)}else this.loadComplexNode(a,c)}}},loadComplexNode:function(a,b){if(!a)return b&&b(null),null;var c=this.dataNodeMap[a.getId()];if(c){var d=c.getClient("complexNode");if(d&&"unload"!=d)return b&&b(d),d}var e=this.dataManager,f=this,g=e.getDataTypeForData(a),h=g.getModelParameters(),i=g.isPrefabAble(),d=(g.isSimplePrefabAble(),this.loadModel(g.getModel(),h,i,g.getId()));if(d){if(d instanceof Array){for(var j=1;j<d.length;j++)d[j].setParent(d[0]);d=d[0]}return c?(c.setClient("complexNode",d),this.setNodeData(a,d,c),b&&b(d)):(this._loadDataModeCallback(a,d,null),this.setRelationShipAndPosition(a),b&&b(d)),d}return this.loadModel(g.getModel(),h,i,g.getId(),function(d){if(!f.dataNodeMap[a.getId()]){if(d&&d instanceof Array){for(var e=1;e<d.length;e++)console.log("load a lots of model"),d[e].setParent(d[0]);d=d[0]}c?(c.setClient("complexNode",d),f.setNodeData(a,d,c),b&&b(d)):f.isCurrentSceneInstance(a)?(f._loadDataModeCallback(a,d,null),f.setRelationShipAndPosition(a),b&&b(d)):b&&b(d)}}),null},loadModel2D:function(a,b,c){if(a||mono.Utils.isArray(b)){var d={};return b instanceof Array?(b.forEach(function(a){a.scale=20}),d.data=b,d.id=a):(d=b||{},d.id=a),make.Default.load(d)}return console.log("unknown 2d model params: "+b),null},_translateTemplateData:function(a,b){var c=a.getId(),d=b.getId(),e=a.getPosition2d()||new mono.Vec2,f=b.getPosition2d()||new mono.Vec2,g=c+"@"+d,h=this.dataManager.getDataById(g);if(!h){h=a.clone(g),h.setHostId(a.getHostId()),this.dataManager.addData(h,!1);var i=h.getPosition2d()||new mono.Vec2;i.x=parseInt(f.x||0)+e.x,i.y=parseInt(f.y||0)+e.y}return h.setParentId(d),h},loadDataTypeTemplateModel2Ds:function(a,b,c){var d=a.getTemplateDatas();if(null!=d&&0!=d.length){var e=this,f={};d.forEach(function(a){a=e._translateTemplateData(a,b);var d=a.getHostId(),g=e.dataNode2DMap[b.getId()],h=e.loadDataModel2D(a,c);if(h){h.setMovable(!1),d?e.setTemplatesGroup(h,d,g,f):g&&(h.setHost(g),h.setParent(g)),h.setName("");var i=a.getId(),j=b.getId();i.length>j.length+1&&(i=i.substring(0,i.length-j.length-1)),h.setToolTip(i)}})}},setTemplatesGroup:function(a,b,c,d){if(!a||!b)return null;d||(d={});var e=a.getParent();if(!e||!e.getClient("group_id")||e.getClient("group_id")!=b){var f=null;if(d[b])f=d[b];else{var g=this.getDataBox2d();if(f=new twaver.Node,c){var h=this.getNodeData(c);f.setParent(c),f.setClient("parent_data",h),f.setName(""),f.setToolTip(b),f.setVisible(!1)}f.setClient("group_id",b),d[b]=f,g.add(f)}a.setHost(c),a.setParent(f)}},loadDataModel2D:function(a,b){if(!this.viewManager2d)return console.log("need add ViewManager2D model!"),null;var c=this.dataManager,d=c.getDataTypeForData(a),e=this.getDataBox2d(),f=a.getId(),g=this.dataNode2DMap[f],h=d.getModel2dParameters();if(!g){g=this.loadModel2D(d.getModel2d(),h,a);var i=g;if(g instanceof Array&&(i=g[0])){i.setMovable(!1);for(var j=1;j<g.length;j++){var k=g[j];k&&(k.setMovable(!1),this.setNodeData(a,k),i.addChild(k),k.setHost(i))}}if(i){i.setName(a.getDescription()||f),this.setNodeData(a,i),this.dataNode2DMap[f]=i;var l=a.getPosition2d();l&&this.viewManager2d.setPosition(i,l.x,l.y)}}return e.getDataById(g.getId())||e.addByDescendant(g),this.loadDataTypeTemplateModel2Ds(d,a,b),g},handleDataAdd:function(a){var b=a.data;b instanceof g?this.shouldLoadData(b)?this.loadOneData(b):this.shouldLoadData2D(b)&&this.loadDataModel2D(b):b instanceof n&&this.loadLink(b)},shouldLoadData:function(a,b){if(!a)return!1;if(b){var c=this.getNodeByDataOrId(a);if(c)return!0}var d=this.dataManager.getDataTypeForData(a);if(d&&d.isLazyable()){var e=this.viewManager3d.getFocusNode(),f=this.getNodeData(e);return f&&f.getId()==a.getId()?!0:!1}var g=a.getParentId(),h=this.dataManager.getDataById(g);return this.shouldLoadData(h,!0)&&this.isCurrentSceneInstance(a)},shouldLoadData2D:function(a){var b=this.getCurrentScene();if(null==b)return!1;var c=this.getParentScene(a);return c.scene==this.getCurrentScene()&&b.getTwod()},handleDataRemove:function(a){var b=a.data,c=(this.dataManager,this.network3d.getDataBox());if(b instanceof g){var d=this.dataNodeMap[b.getId()];c.removeByDescendant(d)}else if(b instanceof n){var e=this.linkMap[b.getId()];c.removeByDescendant(e)}},handleDataPropertyChange:function(a){var b=a.source,c=a.property;if("parentId"===c){a.oldValue,b.getId();this.setParentRelationShip(b),this.translatePosition(b)}else("location"===c||"position"===c)&&this.translatePosition(b)},setAllParentRelationShip:function(a,b){for(var c in this.dataNodeMap){var d=this.dataNodeMap[c],e=this.getNodeData(d);this.setParentRelationShip(e)}},isNeedSetParent:function(a,b){if(a){var c=this.dataNodeMap[a.getParentId()];if(this.earthScene&&this.earthScene.rootData){var d=this.getNodeByDataOrId(this.earthScene.rootData);if(c&&c==d)return this._currentScene&&this._currentScene.getCategoryId().indexOf("earth")>=0?!0:!1}}return!0},setParentRelationShip:function(a){if(a){var b=this.dataNodeMap[a.getId()];if(this.isNeedSetParent(a,b)){var c=this.dataNodeMap[a.getParentId()];b&&c&&b.setParent(c)}}},setRelationShipAndPosition:function(a){if(a){this.setParentRelationShip(a),this.translatePosition(a);var b=a.getChildren();if(b&&!(b.size()<1)){var c=this.dataNodeMap[a.getId()],d=this;b.forEach(function(a){var b=d.dataNodeMap[a.getId()];b&&d.isNeedSetParent(a,b)&&b.setParent(c),d.translatePosition(a)})}}},translateAllPosition:function(){for(var a in this.dataNodeMap){var b=this.dataNodeMap[a],c=this.getNodeData(b);this.translatePosition(c)}},computePosition:function(a,b,c,d){this.locationManager.computePosition(a,b,c,d)},computeRotation:function(a,b,c,d){this.locationManager.computeRotation(a,b,c,d)},translatePosition:function(a){if(a){var b=this.dataManager,c=a.getId(),d=this.dataNodeMap[c];if(d){var e=a.getParentId(),f=b.getDataById(e),d=this.dataNodeMap[c],g=this.dataNodeMap[e];this.computePosition(a,f,d,g),this.computeRotation(a,f,d,g)}}},beforeLoadSceneAnimate:function(a,b,c,d,e,f){e&&e.call(f)},beforeLoadScene:function(a,b,c){return this.beforeLoadSceneFunction&&this.beforeLoadSceneFunction(a,b,c),!0},afterLoadScene:function(a,b,c,d,e){this._sceneChangeDispather.fire({kind:"changeScene",data:a,rootData:b,oldData:c,oldRootData:d,clientMap:e}),this.afterLoadSceneFunction&&this.afterLoadSceneFunction(a,b)},loadOneData:function(a,b,c){var d=this.dataManager.getDataTypeForData(a);return d&&make.Default.getCreator(d._model)?(this.loadDataModel(a,b,c),this.setParentRelationShip(a),void this.translatePosition(a)):(d?console.log("model id "+d._model+" does not exist!"):console.log("modelType is  null!"),void(c&&c()))},getSceneFromData:function(a){var b=this.dataManager;if(null==b.getRootScene())return null;if(!a)return null;var b=this.dataManager,c=a;a.getId||(c=b.getDataById(a));var d=b.getSceneByData(c);return null==d?c&&this.getSceneFromData(c.getParentId()):(d.__currentRootData=c,d)},loadLazyData:function(a,b){if(a){var c=this,d=this.dataManager,e=a;a.getId||(e=d.getDataById(a));var f=e.getParentId(),g=this.getSceneFromData(f),h=this.getSceneFromData(e);if((null!=g||null!=h)&&g!=h){var i=this.getNodeByDataOrId(e);if(i){var j=this.getDataBox();j.contains(i)||(j.addByDescendant(i,function(a){var b=c.getNodeData(a);return b&&c.isCurrentSceneInstance(b)?!0:!1}),this.setParentRelationShip(e),this.translatePosition(e))}else this.loadOneData(e,null,b);return void(b&&b(i))}this.loadLazyData(f);var i=this.getNodeByDataOrId(e);if(i){var j=this.getDataBox();j.contains(i)||(j.addByDescendant(i),this.setParentRelationShip(e),this.translatePosition(e)),b&&b(i)}else this.loadOneData(e,null,b)}},loadLazyChildren:function(a,b){b=b||!1;var d=a,e=a;if(a instanceof mono.Data?d=this.getNodeData(a):e=this.getNodeByDataOrId(d),!(d instanceof c.Data))return null;var f=this.getSceneFromData(d),h=new mono.List;d instanceof g&&(h=d.getChildren());for(var i,j,k,l=0,m=h.size();m>l;l++)if(i=h.get(l),k=this.dataNodeMap[i.getId()]){if(!this.isCurrentSceneInstance(i))continue;var n=this,j=this.dataManager.getDataTypeForData(i);if(j&&(!j.isLazyable()||!b)){this.network3d.getDataBox().getDataById(k.getId())||this.network3d.getDataBox().addByDescendant(k,function(a){var b=n._currentScene,c=n.getSceneFromData(n.getNodeData(a)),d=n.getNodeData(a);if(d==i)return!0;if(a instanceof mono.Billboard&&a.getClient("_alarmBillboard"))return!0;var e=k.getClient("complexNode"),f=k.getClient("simpleNode");return e&&f&&"unload"!=e&&e.getParent()!=k&&f.getParent()==k?!1:null==b&&null==c||b==c?!0:!1});var o=this.getSceneFromData(i);if((null!=f||null!=o)&&f!=o)continue;this.loadLazyChildren(i,!0)}}else j=this.dataManager.getDataTypeForData(i),j.isLazyable()&&b||this.isCurrentSceneInstance(i)&&(this.loadOneData(i),this.loadLazyChildren(i,!0))},$P:function(a,b){},loadLinks:function(){var a=this.dataManager,b=a.getLinkMap();for(var c in b)this.loadLink(b[c])},loadLink:function(a){var b=this.dataManager,d=a.getFromId(),e=a.getToId(),f=a.getFromSide(),g=a.getToSide(),h=this.dataNodeMap[d],i=this.dataNodeMap[e];if(h&&i){var j=null,k=null;if(a.getFromPortId()&&(j=this.postManager.loadPortByPortId(d,a.getFromPortId(),f)),a.getToPortId()&&(k=this.postManager.loadPortByPortId(e,a.getToPortId(),g)),j&&(h=j),k&&(i=k),!this.linkMap[a.getId()]){var l=null,m=a.getRadius()||2,n=null,o=a.getDataTypeId(),p=b._dataTypeMap[o];if(null!=p&&(n=this._linkTemplateMap[o],n||(n=this.loadModel(p.getModel(),p.getModelParameters()))),a.getType()&&"link"==a.getType()){if(l=new mono.Link(h,i),n&&n instanceof mono.PathNode)for(var q in n.styleMap)l.setStyle(q,n.styleMap[q]);else l.s({"m.type":"phong","m.color":"cyan","m.ambient":"cyan"});l.setStyle("m.linewidth",5)}else l=new mono.PathLink(h,i),l.s({"m.type":"phong","m.color":"cyan","m.ambient":"cyan"});if(!(n instanceof mono.PathNode)&&l instanceof mono.PathNode&&(l.setStartCap("plain"),l.setEndCap("plain"),l.setRadius(m),l.s({"m.specularStrength":30,"m.ambient":"#C6FEFA","m.type":"phong"})),l._adjustTimes=10,this.linkControlsFunction){h.updateWorldMatrix(),i.updateWorldMatrix();var r=this.linkControlsFunction(a,h,i);l.setLinkType("control"),l.setControls(r)}else var r=(l.getFromControls(),l.getToControls(),[]);l.setClient("id",a.getId()),l.setClient(c.SceneManager.CLIENT_IT_DATA,a),this.linkMap[a.getId()]=l,l.setVisible(!1),this.network3d.getDataBox().add(l)}}},_getControlPoint:function(a,b){b=b||{};var c=this._getControlNumber(a,b.x,"x"),d=this._getControlNumber(a,b.y,"y"),e=this._getControlNumber(a,b.z,"z");return new mono.Vec3(c,d,e)},_getControlNumber:function(a,b,c){function d(a,b){if(0==a)return b;var c=i.dataManager.getParent(b);return c?d(a-1,c):b}if(!b)return 0;for(var e=a.getId?a:this.dataManager.getDataById(a),f=/\$(p|P)\d/g,g=b.match(f),h={},i=this,j=0;j<g.length;j++){var k=g[j],l=k.toLowerCase().replace("$p",""),m=i.getNodeByDataOrId(d(l,e));h[k]=i._wrapBoundingBox(m)}var n=" with (scope) {  return "+b+"}",o=new Function("scope",n);try{var p=o(h);return p}catch(q){console.error(q)}return 0},_wrapBoundingBox:function(a){var b=a.getBoundingBox();return b.front=function(b){return b=b||0,a.frontWorldPosition(this.max.z+b).z},b.top=function(b){return b=b||0,a.worldPosition(new mono.Vec3(0,1,0),this.max.y+b).y},b},isLink:function(a){return a&&a.getClient(c.SceneManager.CLIENT_IT_DATA)&&a.getClient(c.SceneManager.CLIENT_IT_DATA)instanceof n?!0:!1},getLinkNodeById:function(a){var b=a;return a instanceof c.Link&&(b=a.getId()),this.linkMap[b]},dwRootScene:function(a,b){var c=this,d=a.getChildren()._as;if(d.length){for(var e=0;e<d.length;e++){var f=c.dataManager.getCategoryForData(d[e]),g=f.getId();if(b==g)return!1}return!0}return!1},_loadRootScene:function(){var a=this.dataManager,b=a.getRootScene(),c=this,d=function(){var d=null;if(b){var e=b.getCategoryId(),f=a.getDataMapByCategory(e);for(var g in f){d=f[g];var h=c.dwRootScene(d,e);if(h)break}}c._loadOneScene(b,d),c._currentRootNode&&c.setFocusNode(c._currentRootNode)};this.beforeLoadSceneAnimate(b,null,null,null,d,this)},clearCustomSceneView:function(){if(this.sceneViewMap)for(var a in this.sceneViewMap){var b=this.sceneViewMap[a];b&&b.getContainer()&&this.mainView.contains(b.getContainer())&&this.mainView.removeChild(b.getContainer())}},_saveTextures:function(){if(this.isClearCache){this._textures={};var a=this;this.network3d.getDataBox().forEach(function(b){b.material&&b.material.materials&&b.material.materials.forEach(function(b){b.uniformsList&&b.uniformsList.forEach(function(b){"t"===b[0].type&&b[0].value?a._textures[b[0].value.id]=!0:"tv"===b[0].type&&b[0].value&&b[0].value.length&&console.log(b[0].value)})})})}},_clearTextures:function(){if(this._textures&&this.isClearCache){var a=this;Object.keys(this._textures).forEach(function(b){a.network3d._gl.deleteTexture(a.network3d.pm.glTextureMap[b]),delete a.network3d.pm.glTextureMap[b]}),Object.keys(this._textures).forEach(function(b){a.network3d.pm.textureUpdateFlags[b]=!0})}},_loadOneScene:function(a,b,c,d){if(this.beforeLoadScene(a,b,d)){this._saveTextures(),this.setSceneCamera(a),this.setSceneNetworkAndLight(a);var e,f=this._currentScene,g=this.getNodeData(this._currentRootNode),h=this.dataManager,i=a.getCategoryId(),j=a.getSceneType(),k=a.getTwod(),l=a.getWithGis();e="ShowSelf"==j?0:"ShowSelfAndChildren"===j||"ShowChildren"===j?1:"ShowThird"===j?2:100,this.earthScene&&this.earthScene.clear(),this.clearCustomSceneView(),this._currentScene=a;var m=this.sceneViewMap[a.getId()];if(m)return m.getContainer()?(this.network3d.getRootView().style.display="none",this.viewManager2d.getContainer().style.display="node",this.mainView.appendChild(m.getContainer()),m.show(b),c&&c()):c&&c(),this._currentRootData=b,m.isLoadData()&&this._loadSceneData(b,j,e,k),k?this._currentRootNode=this.dataNode2DMap[b.getId()]:this._currentRootNode=this.dataNodeMap[b.getId()],this._onLoadFinish(a,b,f,g,d),void this.afterLoadScene(a,b,f,g,d);if(this._currentScene.getTwod()){if(!this.viewManager2d)return void console.log("need install viewManager2d model!");l?this.viewManager2d.addGis(!0,!0):this.viewManager2d.removeGis(),this._currentScene.zoomLevel&&this.viewManager2d.setZoomLevel(this._currentScene.zoomLevel),this._currentScene.center&&this.viewManager2d.setCenter(this._currentScene.center),this.network3d.getRootView().style.display="none",this.viewManager2d.getContainer().style.display="block"}else{if(l){if(this.earthScene)this._currentRootData=b,this.earthScene.refresh();else{if(this.earthScene=this.createDefaultEarthScene(a),!this.earthScene)return;this._currentRootData=b,setTimeout(function(){self.earthScene&&self._currentScene===self.earthScene.scene&&self.earthScene.doPlay()},1e3)}return this.viewManager2d&&(this.viewManager2d.getContainer().style.display="none"),this.network3d.getRootView().style.display="block",this.earthScene&&this.earthScene.rootData?this._currentRootNode=this.dataNodeMap[this.earthScene.rootData.getId()]:this._currentRootNode=null,
this.viewManager3d.setFocusNode(null),c&&c(),this.resetCamera(a,b,f,g,d),this.afterLoadScene(a,b,f,g,d),this.setAllParentRelationShip(a,b),void this.translateAllPosition()}this.viewManager2d&&(this.viewManager2d.getContainer().style.display="none"),this.network3d.getRootView().style.display="block"}if(null==b){var n=h.getDataMapByCategory(i);this.network3d.getDataBox().startBatch();for(var o in n)this._currentRootData=n[o],this._loadSceneData(n[o],j,e,k),this._currentRootNode=this.dataNodeMap[o]}else this._currentRootData=b,this.network3d.getDataBox().startBatch(),this._loadSceneData(b,j,e,k),k?this._currentRootNode=this.dataNode2DMap[b.getId()]:this._currentRootNode=this.dataNodeMap[b.getId()];c&&c(),this._currentScene.getTwod()&&this.viewManager2d&&(this.viewManager2d.showTable(this._currentScene),this.viewManager2d.showTree(this._currentScene),this.network2d.zoomOverview()),this.network3d.getDataBox().endBatch(),this._onLoadFinish(a,b,f,g,d),this.afterLoadScene(a,b,f,g,d)}},afterCreateEarthScene:function(a){},createDefaultEarthScene:function(a){if(!c.DefaultEarthScene)return console.log("  need include DefaultEarthScene!!!"),null;var b=new c.DefaultEarthScene(this,a);return b.createDCBillboard=function(a){return null},this.afterCreateEarthScene(b),this._sceneManagerChangeDispatcher.fire({kind:"createDefaultEarthScene",data:b}),b},_loadSceneData:function(a,b,c,d){var e=this.dataManager;if("ShowChildren"===b&&1===c||"ShowDescendant"===b&&100===c||("ShowSelfAndDescendant"===b&&100===c?this.loadDataModel(a):d?this.loadDataModel2D(a):e.isLazyable(a)||this.loadDataModel(a)),!(0>=c))for(var f=a.getChildren(),g=0;g<f.size();g++)this._loadSceneData(f.get(g),b,c-1,d)},_onLoadFinish:function(a,b,c,d,e){this.setAllParentRelationShip(a,b),this.translateAllPosition(),this.loadLinks(),this._clearTextures(),this.resetCamera(a,b,c,d,e),this._loaded=!0},getSetMethod:function(a){var b="set"+a.charAt(0).toUpperCase()+a.slice(1);return b},setNetworkValue:function(a,b,c){if(b){var d=this.getSetMethod(b);a[d]&&"function"==typeof a[d]?a[d](c):a[b]=c}},setDefaultInteractionValue:function(a){if(a){var b=a.defaultInteractionParameters;if(b){var c=this.network3d;a&&this.sceneViewMap[a.getId()]&&this.sceneViewMap[a.getId()].getNetwork3D()&&(c=this.sceneViewMap[a.getId()].getNetwork3D());var d=c.getDefaultInteraction();if(b)for(var e in b){var f=this.getSetMethod(e),g=b[e];d[f]&&"function"==typeof d[f]?d[f](g):d[e]=g}}}},setCameraValue:function(a,b,c){if(b&&a){var d=this.getSetMethod(b);a[d]&&"function"==typeof a[d]?c instanceof Array&&3===c.length?a[d](c[0],c[1],c[2]):a[d](c):"target"==b?c instanceof Array&&3===c.length&&a.lookAt(c[0],c[1],c[2]):a[b]=c}},clearSceneNodeMap:function(){this._sceneNodeMap={},this._sceneNodes=[]},addToSceneNodeMap:function(a,b){a&&b&&(this._sceneNodeMap[a.getId()]=b,this._sceneNodes.push(b))},setSceneNetworkAndLight:function(a){if(!a)return null;if(!a.getTwod()){var b=a.networkParameters,c=(a.lights,a.animateParameters,this.network3d),d=this.sceneViewMap[a.getId()];if(d&&d.getNetwork3D()&&(c=d.getNetwork3D()),this.viewManager3d.resetNetwork(),b)for(var e in b)this.setNetworkValue(c,e,b[e])}},setSceneCamera:function(a){if(this.viewManager3d.resetCamera(),!a)return null;if(!a.getTwod()){var b=this.network3d.getCamera(),c=this.sceneViewMap[a.getId()];c&&c.getCamera()&&(b=c.getCamera());var d=a.cameraParameters;if(d)for(var e in d)this.setCameraValue(b,e,d[e])}},_loadDataMap:function(a){var b=this.dataManager;for(id in a){var c=a[id];b.isLazyable(c)||this.loadDataModel(a[id])}this._onLoadFinish(),this.afterLoadScene()},resetCamera:function(a,b,c,d,e){this.resetCameraWhenSceneChange&&(this._currentRootNode?this.viewManager3d.getDefaultEventHandler().lookAtNodeWithOutAnimate(this._currentRootNode):this.network3d.zoomEstimateOverview(30)),this.resetCameraWhenSceneChange=!0},loadScene:function(){var a=this.dataManager,b=a.getRootScene();if(b)return this.loadPreRenderScene(),this._loadRootScene();var c=a.getDataMap();this._loadDataMap(c)},loadPreRenderScene:function(a){var b=this.dataManager._sceneMap,c=this.dataManager.getRootScene();for(var d in b){var e=b[d];if(e&&e!=c&&e.getPreRender()&&!this.isSameView(e,c)){var f,g=e.getSceneType();f="ShowSelf"==g?0:"ShowSelfAndChildren"===g||"ShowChildren"===g?1:"ShowThird"===g?2:100;var h=this.sceneViewMap[e.getId()];h&&h.getContainer()?e.getContainer().style.display="none":(this.network3d.getRootView().style.display="none",this.viewManager2d.getContainer().style.display="node");var i=this.dataManager.getDataMapByCategory(e.getCategoryId());for(var j in i){var k=i[j];k&&(k&&k.getParentId()&&!this.dataManager.getDataById(k.getParentId())||k.getChildren()&&k.getChildren().size()<=0||(this._loadSceneData(k,g,f,e.getTwod()),this.setFocusNode(this.getNodeByDataOrId(k)),this.lookAt(this.getNodeByDataOrId(k))))}}}a&&a()},isSameView:function(a,b){if(!a||!b)return!0;if(a==b)return!0;var c=this.sceneViewMap[a.getId()],d=this.sceneViewMap[b.getId()];return c=a.getTwod()?this.network2d:c&&c.getContainer()?a.getContainer():this.network3d,d=b.getTwod()?this.network2d:d&&d.getContainer()?d.getContainer():this.network3d,c!=d?!1:!0},showAllInvisibleData:function(){var a=this.dataManager._categoryMap;if(!a)return!1;for(var b in a)this.setInvisibleDataByCategoryId(b,!0)},invisibleAllInvisibleData:function(){var a=this.dataManager._categoryMap;if(!a)return!1;for(var b in a)this.setInvisibleDataByCategoryId(b,!1)},setInvisibleDataByCategoryId:function(a,b){if(a){var c=this.dataManager._categoryMap[a];if(c&&!c.isVisible()){var d=this.dataManager.getDataMapByCategory(a);if(d){for(var e in d){var f=d[e];!this.dataNodeMap[e]&&this.isCurrentSceneInstance(f)&&this.loadOneData(f,!0),this.invisibleFilter.setVisible(f,b)}this.viewManager3d.clearVisibleMap(),this.network3d.dirtyNetwork()}}}},getAlarmManager:function(){return this._alarmManager},addSceneManagerChangeListener:function(a,b,c){this._sceneManagerChangeDispatcher.add(a,b,c)},removeSceneManagerChangeListener:function(a,b){this._sceneManagerChangeDispatcher.remove(a,b)},addSeneChangeListener:function(a,b,c){this._sceneChangeDispather.add(a,b,c)},addSceneChangeListener:function(a,b,c){this._sceneChangeDispather.add(a,b,c)},removeSceneChangeListener:function(a,b){this._sceneChangeDispather.remove(a,b)},addSceneVirtualChangeListener:function(a,b,c){this._sceneVirtualChangeDispather.add(a,b,c)},removeSceneVirtualChangeListener:function(a,b){this._sceneVirtualChangeDispather.remove(a,b)},addSceneVisibleChangeListener:function(a,b,c){this._sceneVisibleChangeDispather.add(a,b,c)},removeSceneVisibleChangeListener:function(a,b){this._sceneVisibleChangeDispather.remove(a,b)},removeBillboard:function(a){a.setParent(null),this.getDataBox().remove(a)},createBillboard:function(a,b){return this.createTitleBillboardById(a.getId(),b)},createTextBillboard:function(a,b,c){return this.createTextBillboardById(a.getId(),b,c)},createTextBillboardById:function(a,b,d){var e=this.dataNodeMap[a],f=c.Util.createTextBillboardForNode(e,b,d);return this.getDataBox().add(f),f},createEmptyBillboardById:function(a,b){var d=this.dataNodeMap[a],e=c.Util.createEmptyBillboardForNode(d,b);return this.getDataBox().add(e),e},createEmptyBillboard:function(a,b,c){return this.createEmptyBillboardById(a.getId(),b,c)},createTitleBillboardById:function(a,b){var d=this.dataNodeMap[a],e=c.Util.createTitleBillboardForNode(d,b);return this.getDataBox().add(e),e},createTitleBillboard:function(a,b){return this.createTitleBillboardById(a.getId(),b)},margeObject:function(a,b){if(a=a||{},!b)return a;if(b instanceof Array)for(var c=0;c<b.length;c++){var d=b[c];d.getId()&&(a[d.getId()]=d)}else if(b instanceof mono.List)for(var c=0;c<b.size();c++){var d=b.get(c);d&&d.getId()&&(a[d.getId()]=d)}else for(var e in b)e&&b[e]&&(a[e]=b[e]);return a},getSceneDatas:function(a){a=a||this.getNodeData(this._currentRootNode);var b=this.getSceneAndRootByData(a)||{},c=b.scene||this._currentScene,d=this.dataManager;if(!c)return d.getDataMap();var e=c.getCategoryId(),f=c.getSceneType()||"",g={};if(a)if(g[a.getId()]=a,"ShowSelfAndChildren"===f||"ShowChildren"===f){var h=a.getChildren();this.margeObject(g,h)}else{var i=d.getDescendants(a);this.margeObject(g,i)}else{var j=d.getDataMapByCategory(e);if(!j||"ShowSelf"==f)return j;for(var k in j){var l=j[k];if(l)if(g[k]=l,"ShowSelfAndChildren"===f||"ShowChildren"===f){var h=l.getChildren();this.margeObject(g,h)}else{var i=d.getDescendants(l);this.margeObject(g,i)}}}return g},getSceneDataTypes:function(a){var b={},c=this.getSceneDatas(a);if(c)for(var d in c){var e=c[d];if(e){var f=this.dataManager.getDataTypeForData(e);b[f.getId()]=f}}return b},getDatasByAncestorId:function(){},getCurrentRootNode:function(){return this._currentRootNode},getLinkData:function(a){if(!a)return null;var b=a.getClient(c.SceneManager.CLIENT_IT_DATA);return b&&b instanceof n?b:null},removeDataNodeByDataOrId:function(a){if(a){var b=a;a instanceof c.Data&&(b=a.getId());var d=this.network3d.getDataBox(),e=this.getNodeByDataOrId(a);e&&(e.setParent(null),delete this.dataNodeMap[b],d.removeByDescendant(e),this._sceneManagerChangeDispatcher.fire({kind:"remove",data:e}))}},createNodeByDataOrId:function(a){if(a&&this.isCurrentSceneInstance(a)){var b=a;a instanceof c.Data||(b=this.dataManager.getDataById(a)),b&&(this.loadDataModel(b),this.setParentRelationShip(b),this.translatePosition(b))}},isAncestor:function(a,b,c){var d=c||this;if(!a||!b)return!1;var e=null;if(e=a instanceof g?a:this.dataManager.getDataById(a),!e)return!1;var f=null;return b instanceof g?(f=b,b=f.getId()):f=this.dataManager.getDataById(b),f?f.getParentId()&&f.getParentId()===e.getId()?!1:e.getParentId()?e.getParentId()===b?!0:d.isAncestor(e.getParentId(),b,d):!1:!1},lastSceneFilter:function(a){return!0},getLastSceneInstance:function(a,b,c){var d=c||this;if(b=b||d.dataManager._categorySceneMap,!a||!b)return null;if("string"==typeof a&&(a=d.dataManager.getDataById(a)),!a)return null;var e=d.dataManager.getCategoryForData(a);if(e&&b[e.getId()]&&d.lastSceneFilter(a))return{rootData:a,scene:b[e.getId()]};if(a&&a.getParentId&&a.getParentId()){var f=d.dataManager.getDataById(a.getParentId());return d.getLastSceneInstance(f,b,d)}return null},getSceneAndRootByData:function(a){if(!a)return null;var b=this.dataManager._categorySceneMap;return b?this.getLastSceneInstance(a,b):null},isCurrentSceneInstance:function(a,b){if(!a)return!1;var c=a;if(c instanceof g||(c=this.dataManager.getDataById(c)),!c)return!1;var d=this.dataManager._categorySceneMap;if(!d)return!0;var e=this._currentScene;if(!e)return!1;var f=this._currentRootData||this.getNodeData(this._currentRootNode);if(!f)return!1;if(c==f)return!0;if(b){var h=this.getLastSceneInstance(c);return h&&h.rootData==f&&h.scene==e?!0:!1}if(f&&!this.isAncestor(c,f.getId()))return!1;var i=e.getSceneType();if("ShowSelf"===i)return f.getId()==c.getId()?!0:!1;if("ShowSelfAndChildren"===i||"ShowChildren"===i)return!f||f.getId()!=c.getId()&&f.getId()!=c.getParentId()?!1:!0;if("ShowThird"===i){if(f.getId()==c.getId()||f.getId()==c.getParentId())return!0;var j=this.dataManager.getDataById(c.getParentId());return j&&f.getId()==j.getParentId()?!0:!1}return!0},isSceneInstance:function(a,b,c){if(!a||!b||!c)return!1;if(b!=c&&!this.isAncestor(c,b.getId()))return!1;var d=this.dataManager.getCategoryForData(b),e=this.dataManager.getCategoryForData(c);if(d&&"datacenter"==d.getId().toLowerCase()&&e&&"floor"==e.getId())return!0;var f=a.getSceneType();if(!f)return!1;if("ShowSelf"===f)return b.getId()==c.getId()?!0:!1;if("ShowSelfAndChildren"===f||"ShowChildren"===f)return b.getId()==c.getId()||b.getId()==c.getParentId()?!0:!1;if("ShowThird"===f){if(b.getId()==c.getId()||b.getId()==c.getParentId())return!0;var g=this.dataManager.getDataById(c.getParentId());return g&&b.getId()==g.getParentId()?!0:!1}return!0},isSceneRootData:function(a){if(!a)return!1;var b=this.dataManager._categorySceneMap;if(!b)return!1;var c=this.dataManager.getCategoryForData(a);return c&&b[c.getId()]?!0:void 0},getAlarmManagerClass:function(){return c.AlarmManager},registerCustomSceneView:function(a,b){a&&b&&(this.sceneViewMap||(this.sceneViewMap={}),this.sceneViewMap[a]=b)},deregisterCustomSceneView:function(a){a&&this.sceneViewMap&&this.sceneViewMap[a]&&delete this.sceneViewMap[a]},adjustCustomSceneViewBounds:function(a,b,c,d){for(var e in this.sceneViewMap){var f=this.sceneViewMap[e];f&&f.adjustBounds(a,b,c,d)}},getCurrentSceneView:function(){return this._currentScene?this.sceneViewMap[this._currentScene.getId()]:null},getSceneViewByNode:function(a){if(!a)return null;var b=null,c=this.getNodeData(a);if(this.isCurrentSceneInstance(c))b=this._currentScene;else{var d=this.getSceneAndRootByData(c);d&&d.scene&&(b=d.scene)}return b&&this.sceneViewMap[b.getId()]?this.sceneViewMap[b.getId()]:this.viewManager3d},getFocusNode:function(){return this._focusNode},setFocusNode:function(a){this._focusNode=a;var b=this.getSceneViewByNode(a);b&&b.setFocusNode&&b.setFocusNode(a)},getCurrentCamera:function(){var a=this._currentScene,b=null;return a&&(b=this.sceneViewMap[a.getId()]),b?"upload"==b.getCamera()?null:b.getCamera():this.network3d.getCamera()},lookAt:function(a,b){var c=this.getSceneViewByNode(a);c?this.viewManager3d.defaultEventHandler.lookAt(a,b):this.viewManager3d.defaultEventHandler.lookAt(a,b)}});var w=function(a){};c.MaterialFilter=w,mono.extend(w,Object,{filterMaterial:function(a,b,c){return a}});var x=function(a){};mono.extend(x,Object,{isVisible:function(a,b,c){return!0}}),c.VisibleFilter=x;var y=function(a){this.sceneManager=a,this.sceneLights={},this.init()};mono.extend(y,Object,{init:function(){var a=this;this.sceneManager.addSceneChangeListener(function(b){var c=b.data;a.setUpLights(c)})},getDefaultLights:function(){var a={},b=new mono.AmbientLight(16777215);a.a=b;var c=new mono.PointLight(16777215,.05);c.setPosition(1e4,1e4,1e4),a.p1=c;var c=new mono.PointLight(16777215,.05);c.setPosition(-1e4,1e4,-1e4),a.p2=c;var c=new mono.PointLight(16777215,.05);c.setPosition(1e4,1e4,-1e4),a.p3=c;var c=new mono.PointLight(16777215,.05);c.setPosition(-1e4,1e4,1e4),a.p4=c;var c=new mono.PointLight(16777215,.05);c.setPosition(0,0,1e4),a.p5=c;var c=new mono.PointLight(16777215,.05);c.setPosition(0,0,-1e4),a.p6=c;var c=new mono.PointLight(16777215,.05);c.setPosition(1e4,0,0),a.p7=c;var c=new mono.PointLight(16777215,.05);return c.setPosition(0,0,-1e4),a.p8=c,a},setUpLights:function(a){var b={},d=a;this.clearLights(),a instanceof c.Scene&&(d=a.getId()),b=d&&this.sceneLights[d]?this.sceneLights[d]:this.getDefaultLights();var e=this.sceneManager.network3d.getDataBox();for(var f in b){var g=b[f];e.add(g)}},clearLights:function(){for(var a=this.sceneManager.network3d.getDataBox(),b=[],c=0;c<a.size();c++){var d=a.getLights().get(c);d&&b.push(d)}for(var c=0;c<b.length;c++){var d=b[c];a.remove(d)}},addSceneLight:function(a){if(a){var b=a.getSceneId(),c=a.getId(),d=null;a.getType().toLowerCase().indexOf("am")>=0?d=new mono.AmbientLight(a.getColor()):(d=new mono.PointLight(a.getColor(),a.getIntensity()||1,a.getDistance()||0),d.setPosition(a.getPosition()));var e=this.sceneLights[b];e?e[c]=d:this.sceneLights[b]={lightId:d}}},removeSceneLight:function(a){if(a){var b=a.geSceneId(),c=a.getId(),d=this.sceneLights[b];d&&delete d[c]}},addLightsFromJson:function(a){var b=a;"string"==typeof a&&(b=JSON.parse(a));var c=0,d=b.length;for(c=0;d>c;c++){var e=b[c],f=new q;f.fromJson(e),this.addSceneLight(f)}}}),c.LightManager=y,c.AlarmSeverity=function(a,b,d,e,f){c.Base.call(this),this.value=a,this.name=b,this.nickName=d,this.color=e,this.displayName=f},mono.extend(c.AlarmSeverity,c.Base,{IT_Alarm_Severity:!0}),function(){var a=c.AlarmSeverity;a.severities=new mono.List,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:0>c?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?0===a.value:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),c.Alarm=function(a,b,d,e,f){if(c.Base.call(this),this._id=a,this._dataId=b,this._alarmSeverity=d||c.AlarmSeverity.CRITICAL,this._dateTime=f,this._description=e,!this._alarmSeverity.IT_Alarm_Severity)throw"alarmSeverity is not it.AlarmSeverity"},mono.extend(c.Alarm,c.Base,{___accessor:["alarmSeverity","alarmType","description","dateTime"],IT_Alarm:!0,getId:function(){return this._id},getDataId:function(){return this._dataId},fromJson:function(a){a=a||"","string"==typeof a&&(a=JSON.parse(a)),this._id=a.id,this._dataId=a.dataId,this._alarmSeverity=c.AlarmSeverity.getByName(a.level),this._dateTime=a.time,this._description=a.description}}),c.AlarmState=function(a){c.Base.call(this),this._data=a,this._selfHighestAlarmSeverity=null,this._selfAlarmCount=0,this._propagateHighestAlarmSeverity=null,this._propagateAlarmCount=0,this._highestAlarmSeverity=null,this._alarmCount=0},mono.extend(c.AlarmState,c.Base,{___accessor:["selfHighestAlarmSeverity","selfAlarmCount","propagateHighestAlarmSeverity","propagateAlarmCount","highestAlarmSeverity","alarmCount"],IT_Alarm_Status:!0,clear:function(){this._selfHighestAlarmSeverity=null,this._selfAlarmCount=0,this._propagateHighestAlarmSeverity=null,this._propagateAlarmCount=0,this._highestAlarmSeverity=null,this._alarmCount=0}}),c.AlarmManager=function(a,b){c.Base.call(this),this._dataManager=a,this._sceneManager=b,this._alarmList=new mono.List,this._alarmMap={},this._dataAlarms={},this._dirtyDataAlarmState=[],this._alarmBillboardMap={},this._alarmNodeMap={},this._alarmManagerChangeDispatcher=new mono.EventDispatcher,this._alarmPropertyChangeDispatcher=new mono.EventDispatcher,this.renderType=c.AlarmManager.RENDER_TYPE_DEFAULT,this._sceneManager.addSceneManagerChangeListener(this.handleSceneManagerChange,this,!0),this._dataManager.addDataManagerChangeListener(this.handleDataManagerChange,this,!0),this.addAlarmPropertyChangeListener(this.handleAlarmPropertyChange,this,!0),this.addAlarmManagerChangeListener(this.handleAlarmManagerChange,this,!0)},c.AlarmManager.RENDER_TYPE_DEFAULT=0,c.AlarmManager.RENDER_TYPE_PAINT=1,c.AlarmManager.RENDER_TYPE_PAINT_BILLBOARD=2,mono.extend(c.AlarmManager,c.Base,{__accessor:["removeAlarmWhenDataIsRemoved"],_name:"AlarmBox",getAlarms:function(a,b){return this._alarmList.toList(a,b)},_calculateDataPropagateAlarmState:function(){for(;this._dirtyDataAlarmState.length>0;){var a=this._dirtyDataAlarmState.pop();this.calculateDataPropagateAlarmState(a)}},_setDataAlarmStateDirty:function(a){a._alarmRenderDirty=!0},_clearDataAlarmStateDirty:function(a){delete a._alarmRenderDirty},_isDataAlarmStateDirty:function(a){return a._alarmRenderDirty},_dirtyParentDataAlarmState:function(a,b){var c=this._dataManager.getParent(a);if(c){var d=this,e=c.getAlarmState(),f=e.getSelfAlarmCount();0>=f?c.isSkipRender=b:c.isSkipRender=null,clearTimeout(c._dirtyParentTimerId),c._dirtyParentTimerId=setTimeout(function(){d._dirtyDataAlarmState.push(c),d._dirtyDataAlarmState&&d._calculateDataPropagateAlarmState()},10)}else this._dirtyDataAlarmState&&this._calculateDataPropagateAlarmState()},calculateDataAlarmState:function(a){var b=this.getDataAlarmState(a),d=a.getAlarmState(),e=d.getSelfAlarmCount(),f=d.getSelfHighestAlarmSeverity();if(e!=b.alarmCount||0!=c.AlarmSeverity.compare(b.highestAlarmSeverity,f)){d.setSelfHighestAlarmSeverity(b.highestAlarmSeverity),d.setSelfAlarmCount(b.alarmCount),b.alarmCount>0&&(a.isSkipRender=null),this._calculateDataAlarmState(a);var g=this._dataManager.isStopAlarmPropagation(a)||a.isSkipRender;this._dirtyParentDataAlarmState(a,g)}},calculateDataPropagateAlarmState:function(a){var b=this._dataManager.getChildren(a),c={highestAlarmSeverity:null,alarmCount:0};if(b)for(var d=0;d<b.length;d++){var e=b[d],f=e.getAlarmState();c.alarmCount+=f.getAlarmCount(),c.highestAlarmSeverity=this._getHighestAlarmSeverity(c.highestAlarmSeverity,f.getHighestAlarmSeverity())}var f=a.getAlarmState();f.getPropagateAlarmCount(),f.getPropagateHighestAlarmSeverity();f.setPropagateAlarmCount(c.alarmCount),f.setPropagateHighestAlarmSeverity(c.highestAlarmSeverity),this._calculateDataAlarmState(a);var g=this._dataManager.isStopAlarmPropagation(a)||a.isSkipRender;this._dirtyParentDataAlarmState(a,g)},_calculateDataAlarmState:function(a){var b=a.getAlarmState(),c={highestAlarmSeverity:null,alarmCount:0};c.alarmCount=b.getSelfAlarmCount()+b.getPropagateAlarmCount(),c.highestAlarmSeverity=this._getHighestAlarmSeverity(c.highestAlarmSeverity,b.getSelfHighestAlarmSeverity()),c.highestAlarmSeverity=this._getHighestAlarmSeverity(c.highestAlarmSeverity,b.getPropagateHighestAlarmSeverity()),b.setAlarmCount(c.alarmCount),b.setHighestAlarmSeverity(c.highestAlarmSeverity),this._setDataAlarmStateDirty(a),this.renderDataAlarm(a)},_getHighestAlarmSeverity:function(a,b){return c.AlarmSeverity.compare(a,b)>0?a:b},renderDataAlarm:function(a){if(!a.isSkipRender||this.isForceRenderData(a)){if(!this._sceneManager.isCurrentSceneInstance(a))return void this._setDataAlarmStateDirty(a);var b=this._sceneManager.getNodeByDataOrId(a);!b&&this._sceneManager.earthScene&&this._sceneManager.earthScene.dataCenterNodeMap&&(b=this._sceneManager.earthScene.dataCenterNodeMap[a.getId()]),b&&this._isDataAlarmStateDirty(a)?this._renderAlarm(a,b):b||this._setDataAlarmStateDirty(a)}},isForceRenderData:function(a){return!1},_renderAlarm:function(a,b){this._clearDataAlarmStateDirty(a);var c=this._sceneManager.getCurrentScene();if(c&&c.renderAlarm)return void c.renderAlarm(a,b);var d=this._dataManager.getCategoryForData(a);if(d&&d.renderAlarm)return void d.renderAlarm(a,b);var e=this._dataManager.getDataTypeForData(a);return e&&e.renderAlarm?void e.renderAlarm(a,b):void this.renderAlarm(a,b)},renderAlarm:function(a,b){if(this.renderType==c.AlarmManager.RENDER_TYPE_PAINT){var d=a.getAlarmState();if(d.getAlarmCount()>0){var e=d.getHighestAlarmSeverity();this.paintDataColor(a,b,e)}else this.clearDataColor(a,b)}else if(this.renderType==c.AlarmManager.RENDER_TYPE_PAINT_BILLBOARD){var d=a.getAlarmState();if(d.getAlarmCount()>0){var e=d.getHighestAlarmSeverity();this.paintDataColor(a,b,e)}else this.clearDataColor(a,b);var f=this._dataManager.getParent(a);d.getAlarmCount()>0&&(!f||this._dataManager.isStopAlarmPropagation(a))?this.showDataBillboard(a,b):this._alarmBillboardMap[a.getId()]&&this.hideDataBillboard(a,b)}else{var d=a.getAlarmState();d.getSelfAlarmCount()>0?this.paintDataColor(a,b):this.clearDataColor(a,b);var f=this._dataManager.getParent(a);d.getAlarmCount()>0&&(!f||this._dataManager.isStopAlarmPropagation(a))?this.showDataBillboard(a,b):this._alarmBillboardMap[a.getId()]&&this.hideDataBillboard(a,b)}},paintDataColor:function(a,b,c){b.getClient("complexNode")&&(b="unload"!=b.getClient("complexNode")&&b.getClient("complexNode").getParent()?b.getClient("complexNode"):b.getClient("simpleNode"));var d=a.getAlarmState(),c=c||d.getSelfHighestAlarmSeverity();this._setNodeAlarmEffect(b,c),this._alarmNodeMap[b.getId()]=b;for(var e=b.getChildren(),f=e.size(),g=0;f>g;g++){var h=e.get(g);h.getClient("modelParent")&&(this._setNodeAlarmEffect(h,c),this._alarmNodeMap[h.getId()]=h)}},clearDataColor:function(a,b){if(b.getClient("complexNode")&&(b="unload"!=b.getClient("complexNode")&&b.getClient("complexNode").getParent()?b.getClient("complexNode"):b.getClient("simpleNode")),b.getStyle("alarm.m.ambient")){this._clearNodeAlarmEffect(b),delete this._alarmNodeMap[b.getId()];for(var c=b.getChildren(),d=c.size(),e=0;d>e;e++){var f=c.get(e);f.getClient("modelParent")&&(this._clearNodeAlarmEffect(f),delete this._alarmNodeMap[f.getId()])}}},showDataBillboard:function(a,b){var c=a.getAlarmState(),d=c.getHighestAlarmSeverity(),e=null;d&&(e=d.color);var f=null;this._alarmBillboardMap[a.getId()]?f=this._alarmBillboardMap[a.getId()]:(f=this._sceneManager.createEmptyBillboardById(a.getId()),this.initAlarmBillboard(f,a),this._alarmBillboardMap[a.getId()]=f),f.setStyle("m.texture.image",mono.ImageCache.AlarmBillboardImage),f.setStyle("m.color",e),f.setStyle("m.alignment",mono.BillboardAlignment.bottomCenter),this._setAlarmBillboardPositionAndSize(b,f)},hideDataBillboard:function(a,b){this._sceneManager.removeBillboard(this._alarmBillboardMap[a.getId()]),delete this._alarmBillboardMap[a.getId()]},initAlarmBillboard:function(a,b){a.setClient("_alarmBillboard",b);var c=this._sceneManager.getNodeByDataOrId(b);c.setClient("_alarmBillboard",a)},_setAlarmBillboardPositionAndSize:function(a,b){var c=a.getStyle("alarm.billboard.position"),d=a.getBoundingBox(),e=d.min,f=d.max,g=d.center(),h=d.size();"topLeft"===c?b._position.set(e.x,f.y,g.z+1):"topRight"===c?b._position.set(f.x,f.y,g.z+1):"topBack"===c?b._position.set(g.x,f.y,e.z-1):"topFront"===c?b._position.set(g.x,f.y,f.z+1):b._position.set(g.x,f.y,g.z+1);var i=a.getStyle("alarm.billboard.scale");i instanceof mono.Vec3?b._scale.copy(i):b._scale.set(h.x/2,h.x/2,1);var j=a.getStyle("alarm.billboard.vertical");b.setStyle("m.vertical",j)},_setNodeAlarmEffect:function(a,b){var c=a.getStyle("alarm.m.ambient")||a.getStyle("m.ambient"),d=b?b.color:c;a.setStyle("m.ambient",d),a.setStyle("m.color",d),a.setStyle("alarm.m.ambient",c)},_clearNodeAlarmEffect:function(a){var b=a.getStyle("alarm.m.ambient");a.setStyle("m.ambient",b),a.setStyle("m.color",b),a.setStyle("alarm.m.ambient",null)},_add:function(a){this._alarmList.add(a),this._alarmMap[a.getId()]=a;var b=this._dataAlarms[a.getDataId()];b||(b=this._dataAlarms[a.getDataId()]=new mono.List),b.add(a)},_remove:function(a){this._alarmList.remove(a),delete this._alarmMap[a.getId()];var b=this._dataAlarms[a.getDataId()];b&&b.remove(a),0==b.size()&&delete this._dataAlarms[a.getDataId()]},getAlarm:function(a){if(!a)return null;var b=null;return b=a.IT_Alarm?this._alarmMap[a.getId()]:this._alarmMap[a]},add:function(a){if(!a)throw"alarm is null or undefined";if(!a.getId())throw"alarm`s id is empty";if(!a.getDataId())throw"alarm`s dataId is empty";if(!a.IT_Alarm)throw"alarm`s class is not it.Alarm";var b=this._alarmMap[a.getId()];if(b)throw"alarm`s id repeat";var c=this._dataManager.getDataById(a.getDataId());c||(a.error="data is not exist",console.warn(a.error)),this._add(a),this._alarmManagerChangeDispatcher.fire({kind:"add",data:a}),a.addPropertyChangeListener(this.handleAlarmDataPropertyChange,this)},addAlarmFromJson:function(a){for(var b=d.toJsonArray(a),e=0,f=b.length;f>e;e++){var g=b[e],h=new c.Alarm;h.fromJson(g),this.add(h)}},remove:function(a){if(!a)throw"alarmOrId is null or undefined";var b=null;return(b=a.IT_Alarm?this._alarmMap[a.getId()]:this._alarmMap[a])?(this._remove(b),b.removePropertyChangeListener(this.handleAlarmDataPropertyChange,this),this._alarmManagerChangeDispatcher.fire({kind:"remove",data:b}),b):void console.warn("alarm is not exist")},clear:function(){var a=this._alarmList.toList();return this._alarmList.clear(),this._alarmMap={},this._dataAlarms={},this._dirtyDataAlarmState=[],this._alarmManagerChangeDispatcher.fire({kind:"clear",datas:a}),a},getAlarmsByDataOrId:function(a){if(!a)return[];var b=a;return a.IT_Data&&(b=a.getId()),this._dataAlarms[b]},removeAlarmsByDataOrId:function(a){var b=this.getAlarmsByDataOrId(a);return b&&(b=b.toList(),b.forEach(this.remove,this)),b},getDataByAlarmOrId:function(a){var b=this.getAlarm(a);if(!b)return null;var c=b.getDataId();return this._dataManager.getDataById(c)},getDataAlarmState:function(a){var b={highestAlarmSeverity:null,alarmCount:0},d=this.getAlarmsByDataOrId(a);return d&&(b.alarmCount=d.size(),d.forEach(function(a){if(b.highestAlarmSeverity){var d=a.getAlarmSeverity();c.AlarmSeverity.compare(d,b.highestAlarmSeverity)>0&&(b.highestAlarmSeverity=d)}else b.highestAlarmSeverity=a.getAlarmSeverity()})),b},handleAlarmManagerChange:function(a){if("add"===a.kind){var b=a.data,c=this._dataManager.getDataById(b.getDataId());if(c){var d=this;clearTimeout(c._calculateTimerId),c._calculateTimerId=setTimeout(function(){d.calculateDataAlarmState(c)},100)}}else if("remove"===a.kind){var b=a.data,c=this._dataManager.getDataById(b.getDataId());if(c){var d=this;d.calculateDataAlarmState(c)}}else if("clear"===a.kind){var e=a.datas;if(e&&e.size()>0){var f=this._dataManager.getDatas();if(f&&f.length>0)for(var g=f.length,h=0;g>h;h++){var c=f[h],i=c.getAlarmState();i.getAlarmCount()&&i.clear()}for(var j in this._alarmBillboardMap)this._sceneManager.removeBillboard(this._alarmBillboardMap[j]);this._alarmBillboardMap={};for(var j in this._alarmNodeMap)this._clearNodeAlarmEffect(this._alarmNodeMap[j]);this._alarmNodeMap={}}}},handleAlarmDataPropertyChange:function(a){this._alarmPropertyChangeDispatcher.fire(a)},handleAlarmPropertyChange:function(a){var b=a.source;if("alarmSeverity"===a.property){var c=this._dataManager.getDataById(b.getDataId());c&&this.calculateDataAlarmState(c)}},handleDataManagerChange:function(a){if("add"===a.kind)this.calculateDataAlarmState(a.data);else if("remove"===a.kind){var b=a.data;this.removeAlarmsByDataOrId(b);var c=this._dataManager.isStopAlarmPropagation(b)||b.isSkipRender;this._dirtyParentDataAlarmState(b,c)}else"clear"===a.kind},handleSceneManagerChange:function(a){var b=this;if("add"===a.kind){var c=a.data,d=this._sceneManager.getNodeData(c);b.renderDataAlarm(d)}else if("change"===a.kind){var c=a.data,d=this._sceneManager.getNodeData(c);d&&(this._setDataAlarmStateDirty(d),this.renderDataAlarm(d))}},addAlarmManagerChangeListener:function(a,b,c){this._alarmManagerChangeDispatcher.add(a,b,c)},removeAlarmManagerChangeListener:function(a,b){this._alarmManagerChangeDispatcher.remove(a,b)},addAlarmPropertyChangeListener:function(a,b,c){this._alarmPropertyChangeDispatcher.add(a,b,c)},removeAlarmPropertyChangeListener:function(a,b){this._alarmPropertyChangeDispatcher.remove(a,b)},getAlarmCountNow:function(a){if(!a)return 0;var b=this._dataManager.getDescendants(a);if(!b)return 0;var c=0;return b.forEach(function(a){c+=a.getAlarmState().getSelfAlarmCount()}),c}}),c.AlarmStatePropagator=function(a,b,c){this._dataManager=a,this._sceneManager=b,this._alarmManager=c,this.dataBox=c.dataBox,this.alarmBox=c.alarmBox,mono.AlarmStatePropagator.call(this,this.dataBox,"alarmState"),this.dataBox.setAlarmStatePropagator(this),this.childrenAlarms=[]},mono.extend(c.AlarmStatePropagator,mono.AlarmStatePropagator,{propagateToTop:function(a){var b=!0;for(b=this.propagateToParent(null,a);a&&a.getParent()&&b!==!1;)b=this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(a,b){var d=null==a?null:c.SceneManager.getNodeData(a),e=null==b?null:c.SceneManager.getNodeData(b);return e?this.dataPropagateToParent(d,e,a,b):!1},dataPropagateToParent:function(a,b,c,d){return this.dataPropagateToParentForRoom(a,b,c,d)},dataPropagateToParentForRoom:function(a,b,d,e){if(this.isStop(a))return!1;if(!b.getAlarmState)return!1;e.getClient("modelParent")&&(e=e.getClient("modelParent")),b.getAlarmState().setPropagateSeverity(null),e.getAlarmState().setPropagateSeverity(null);for(var f=b.getAlarmState().getHighestOverallAlarmSeverity(),g=b.getChildren(),h=g.size(),i=0;h>i;i++){var j=g.get(i),k=j.getAlarmState().getHighestOverallAlarmSeverity();c.AlarmSeverity.compare(k,f)>0&&(f=k)}if(b.getAlarmState().setPropagateSeverity(f),e.getClient("complexNode")){var l="unload"!=e.getClient("complexNode")&&e.getClient("complexNode").getParent()?e.getClient("complexNode"):e.getClient("simpleNode");l.getAlarmState().setPropagateSeverity(f);
}this.modelChildAlarmSyn(a,b,d,e);var m=null==b?null:this.dataManager.getDataTypeForData(b);if(!m)return!1;if(m.isStopAlarmPropagationable())return!1;var n=this.dataManager.getCategoryForData(b);return n?n.isStopAlarmPropagationable()?!1:!0:!m.isStopAlarmPropagationable()},isStop:function(a){if(a){var b=this.dataManager.getDataTypeForData(a);if(b){if(b.isStopAlarmPropagationable())return!0;var c=this.dataManager.getCategoryForData(a);if(c&&c.isStopAlarmPropagationable())return!0}}return!1},modelChildAlarmSyn:function(a,b,c,d){d.getClient("complexNode")&&(d="unload"!=d.getClient("complexNode")&&d.getClient("complexNode").getParent()?d.getClient("complexNode"):d.getClient("simpleNode"));for(var e=d.getChildren(),f=e.size(),g=d.getAlarmState().getPropagateSeverity(),h=0;f>h;h++){var i=e.get(h);if(i.getClient("modelParent")){var j="child_alarm_"+i.getId();if(g){var k=this.alarmBox.getDataById(j);k?k.setAlarmSeverity(g):(k=new mono.Alarm(j,i.getId(),g),this.alarmBox.add(k)),i.getAlarmState().setPropagateSeverity(g)}else this.alarmBox.removeById(j),i.getAlarmState().setPropagateSeverity(null)}}}});var z=function(a){t.call(this),this.sceneManager=a,this.dataManager=a.dataManager,a||console.log("sceneManager can not be null!"),this.mode="lookat",this.filterFunction=null,this.defaultPostion=null,this.defaultTarget=null,this.defaultLookAtDistance=2e3,this.lookAtDistanceFunction=null,this.isLookAtFunction=null,this.afterLookAtFunction=null,this.afterLookAtFinishedFunction=null,this._afterLookAtListener=[],this._afterLookAtFinishedListener=[],this.box3d=a.network3d.getDataBox(),this.withOutAnimate=!1,this.lookAtWithOutMoveCamera=!0,this.handleDoubleClickBackgroundFunction=null,this.cameraInfoStack=[]};mono.extend(z,t,{setDefaultPositionAndTarget:function(a,b){this.defaultPostion=a,this.defaultTarget=b},getDefaultVirtual:function(){return this.sceneManager.viewManager3d.getDefaultVirtualMaterialFilter()},setMode:function(a){this.mode=a},getCamera:function(a){var b=this.sceneManager.getSceneViewByNode(a);return b&&b.getCamera&&b.getCamera()?b.getCamera():this.sceneManager.network3d.getCamera()},isLookAtWithAngle:function(a){if(!a)return!1;var b=c.Util.getBoundingBox(a),d=this.sceneManager.getNodeData(a),e=this.sceneManager.dataManager.getCategoryForData(d);return e&&"building"==e.getId()?!0:b&&(b.size().x>500||b.size().y>500||b.size().z>500)?!0:!1},getElementPerfectDistance:function(a,b){if(!a)return 100;b=1==b?!0:!1;var d=this.getCamera(a),e=100,f=c.Util.getBoundingBox(a);if(f){var g=f.max.y-f.min.y,h=f.max.x-f.min.x,i=f.max.z-f.min.z;b||(g*=a.getScaleY(),h*=a.getScaleX()),e=g>h?g:h,i>e&&(e=i)}var j=e/(2*Math.tan(d.fov*Math.PI/180/2)),k=this.getElementPerfectDistanceOffset(a);return j+=k},getElementPerfectDistanceOffset:function(a){return 50},getElementPerfectFrontPositionOffsetY:function(a){var b=this.sceneManager.getNodeData(a),c=this.dataManager.getCategoryForData(b);return c&&"equipment"==c.getId()?0:20},getElementPerfectFrontPosition:function(a){if(!a)return null;var b=this.getElementPerfectDistance(a);100>b&&(b=100);var c=this.getNodeCenterPosition(a),d=b>0?b:1,e=c.add(a.frontDirection().multiplyScalar(d)),f=this.getElementPerfectFrontPositionOffsetY(a)||0;return e.y=e.y+f,e},getElementPerfectFrontPositionForNodeCenterPosition:function(a,c){if(!a)return null;var d=this.getElementPerfectDistance(a);100>d&&(d=100);var e=this.getNodeCenterPosition(a),f=null;return c==b&&(c=!0),c&&(f=new mono.Vec3(0,1,2)),f?e.add(a.direction(f).multiplyScalar(d)):e.add(a.frontDirection().multiplyScalar(d))},getNodeCenterPosition:function(a){if(!a)return null;var b=c.Util.getBoundingBox(a),d=0,e=0,f=0;b&&b.max&&b.min&&(d=(b.max.x+b.min.x)/2*a.getScaleX(),e=(b.max.y+b.min.y)/2*a.getScaleY(),f=(b.max.z+b.min.z)/2*a.getScaleZ());var g=a.getWorldPosition();return g.setX(g.x+d),g.setY(g.y+e),g.setZ(g.z+f),g},getCameraPositionForLookAt:function(a){var b=this.getElementPerfectDistance(a),c=this.getNodeCenterPosition(a);return c.add(a.direction(new mono.Vec3(0,1,2)).multiplyScalar(b))},getCameraTargetAndPositionByNode:function(a){return null},moveCameraForLookAtNode:function(a,b,d){function e(){b&&b()}if(a){var f=this.getCamera(a),g=this.getSavedCameraInfoByNode(a)||this.getCameraTargetAndPositionByNode(a),h=null,i=null;if(g&&g.target&&g.position)h=g.target,i=g.position;else{var j=this.getNodeCenterPosition(a);j||(j=new mono.Vec3(0,0,0));var k=c.Util.getBoundingBox(a);if(h=new mono.Vec3(j.x,j.y,j.z),i=this.getElementPerfectFrontPosition(a),this.isLookAtWithAngle(a)){var l=this.getElementPerfectDistance(a);i=this.getCameraPositionForLookAt(a),k&&k.max.y+k.min.y!=0&&(i.y=i.y+(k.max.y+k.min.y)/2);var m=0;a.getRotationY()&&(m=l*Math.sin(a.getRotationY())),i.x=h.x+m}d&&(i.x+=d.x,i.y+=d.y,i.z+=d.z)}c.Util.playCameraAnimation(f,i,h,1500,e)}},lookAtNodeWithOutAnimate:function(a){if(a&&a instanceof mono.Element){var b=this.getCamera(a),c=this.getSavedCameraInfoByNode(a)||this.getCameraTargetAndPositionByNode(a);if(c&&c.target&&c.position)b.setPosition(c.position.x,c.position.y,c.position.z),b.lookAt(c.target.x,c.target.y,c.target.z);else{var d=this.getNodeCenterPosition(a);d||(d=new mono.Vec3(0,0,0));var e=this.getElementPerfectFrontPosition(a);if(this.isLookAtWithAngle(a)){var f=this.getElementPerfectDistance(a);e=a.worldPosition(new mono.Vec3(0,1,1),f);var g=0,h=0;a.getRotationY()&&(g=f*Math.sin(a.getRotationY()),h=f*(1-Math.cos(a.getRotationY()))),e.x=d.x+g,e.z=e.z-h}b.setPosition(e.x,e.y,e.z),b.lookAt(d.x,d.y,d.z)}}},lookAtElements:function(a,b){if(!a||a.length<1)return null;1===a.length&&this.lookAt(a[0]),this.sceneManager.viewManager3d.setCameraDistance(null,1e4);for(var d,e,f,g,h,i,j=this.getCamera(a[0]),k=0;k<a.length;k++){var l=a[k];if(l){var m=l.getBoundingBox()||{min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},n=l.getWorldPosition();(!d||d>n.x+m.min.x)&&(d=n.x+m.min.x),(!e||e>n.y+m.min.y)&&(e=n.y+m.min.y),(!f||f>n.z+m.min.z)&&(f=n.z+m.min.z),(!g||g<n.x+m.max.x)&&(g=n.x+m.max.x),(!h||h<n.y+m.max.y)&&(h=n.y+m.max.y),(!i||i<n.z+m.max.z)&&(i=n.z+m.max.z)}}var o=new mono.Vec3(d+(g-d)/2,e+(h-e)/2,f+(i-f)/2),p=Math.sqrt((g-d)*(g-d)+(h-e)*(h-e)),q=p/(2*Math.tan(j.fov*Math.PI/180/2)),r=50;q+=r,500>q&&(q=500);var s=50;300>h-e&&(s=q);var t=new mono.Vec3(o.x,o.y+s,o.z+q);c.Util.playCameraAnimation(j,t,o,1500,b)},getCameraTarAndPosForLookAtNodes:function(a,b,d){if(!a||a.length<1)return null;if(1==a.length){var e=this.getNodeCenterPosition(a[0]);e||(e=new mono.Vec3(0,0,0));var f=c.Util.getBoundingBox(a[0]),g=new mono.Vec3(e.x,e.y,e.z),h=this.getElementPerfectFrontPosition(a[0]);if(this.isLookAtWithAngle(a[0])){var i=this.getElementPerfectDistance(a[0]);h=this.getCameraPositionForLookAt(a[0]),f&&f.max.y+f.min.y!=0&&(h.y=h.y+(f.max.y+f.min.y)/2);var j=0;a[0].getRotationY()&&(j=i*Math.sin(a[0].getRotationY())),h.x=g.x+j}return{target:e,position:h}}var k=this.getCamera(a[0]),f=this.computeNodesBoundingBox(a);if(!f)return null;var l=f.center(),m=new mono.Vec3(0,f.max.y-f.min.y,f.max.z-f.min.z),n=new mono.Vec3(f.max.x-f.min.x,0,0,0),o=m.clone();o.length()<n.length()&&(o=n.clone());var p;if(b){var q=m.length();m.y=m.z*Math.tan(b/180*Math.PI),m.setLength(q)}p=(new mono.Vec3).addVectors(l,m.multiplyScalar(.5));var r=k.fov,s=(k.aspect,o.length()/2/Math.tan(r*Math.PI/180));return s=2*s,p.add(m.normalize().multiplyScalar(s)),{target:l,position:p}},moveCameraForLookAtNodes:function(a,b,d,e){if(!a||a.length<1)return void(b&&b());var f=this.getCamera(a[0]),g=this.getCameraTarAndPosForLookAtNodes(a,d,e);if(g){var h=g.position,i=g.target;c.Util.playCameraAnimation(f,h,i,1500,b)}},computeNodesBoundingBox:function(a){function b(a,b){a.applyMatrix4(b),c.push(a)}if(a&&!(a.length<1)){for(var c=[],d=0;d<a.length;d++){var e=a[d];if(e instanceof TGL.Node){bb=e.getBoundingBox(),matrix=e.worldMatrix;var f=bb.min,g=bb.max;b(f.clone(),matrix),b(g.clone(),matrix),b(new mono.Vec3(f.x,f.y,g.z),matrix),b(new mono.Vec3(f.x,g.y,f.z),matrix),b(new mono.Vec3(g.x,f.y,f.z),matrix),b(new mono.Vec3(g.x,g.y,f.z),matrix),b(new mono.Vec3(g.x,f.y,g.z),matrix),b(new mono.Vec3(f.x,g.y,g.z),matrix)}}if(c.length<=1)return null;var h=new mono.BoundingBox;return h.setFromPoints(c),h}},getCenter:function(a,b){if(a||b){if(!a&&b)return b.getWorldPosition();if(!b&&a)return a.getWorldPosition();var c=a.getWorldPosition(),d=b.getWorldPosition(),e=d.x-c.x>0?c.x+(d.x-c.x)/2:d.x+(c.x-d.x)/2,f=d.y-c.y>0?c.y+(d.y-c.y)/2:d.y+(c.y-d.y)/2,g=d.z-c.z>0?c.z+(d.z-c.z)/2:d.z+(c.z-d.z)/2;return new mono.Vec3(e,f+50,g)}return null},getPerfectDistanceForNodes:function(a,b){var c="z",d={direction:"x",length:0};if(!a&&!b)return null;if(!a&&b){var e=1;b.frontDirection().z<0&&(e=-1),d={direction:"x",length:this.getElementPerfectDistance(b)*e}}else if(!b&&a){var e=1;a.frontDirection().z<0&&(e=-1),d={direction:"x",length:this.getElementPerfectDistance(a)*e}}else{var f=this.getCamera(a),g=a.getWorldPosition(),h=b.getWorldPosition(),i=Math.abs(h.x-g.x),j=Math.abs(h.y-g.y),k=Math.abs(h.z-g.z),l=i;j>l&&(l=j),k>l&&(l=k,c="x");var m=l/(2*Math.tan(f.fov*Math.PI/180/2)),n=50;m+=n,500>m&&(m=500);var e=1;a.frontDirection().z<0&&(e=-1),d={direction:c,length:2*m*e}}return d},moveCameraForLookAtLink:function(a,b,d){if(a){d=d||1500;var e=this.getCamera(a),f=this.sceneManager.getLinkData(a);if(!f)return void this.moveCameraForLookAtNode(a,b);var g=this.sceneManager.getNodeByDataOrId(f.getFromId()),h=this.sceneManager.getNodeByDataOrId(f.getToId());g&&!this.box3d.getDataById(g.getId())&&this.box3d.add(g),h&&!this.box3d.getDataById(h.getId())&&this.box3d.add(h);var i=this.getCenter(g,h),j=this.getPerfectDistanceForNodes(g,h),k=null,l=null;j&&(k=j.length,l=j.direction);var m=0;if(g&&h){var n=g.getWorldPosition(),o=h.getWorldPosition();m=Math.abs(n.y-o.y)>100?0:Math.abs(k)*Math.tan(Math.PI/6)}var p=new mono.Vec3(i.x,i.y+m,i.z);l&&"x"==l&&k?p.x=p.x+k:l&&"z"==l&&k&&(p.z=p.z+k),c.Util.playCameraAnimation(e,p,i,d,b)}},_isLookAt:function(a){if(null!=this.isLookAtFunction)return this.isLookAtFunction(a);var b=this.sceneManager.getNodeData(a);return b?!0:!1},isDoLookAt:function(a){return a&&a.getClient("notLookAt")?!1:!0},isUseCameraStackByNode:function(a){var b=this.sceneManager.getNodeData(a);if(!b)return!1;var c=this.dataManager.getCategoryForData(b);return!c||"floor"!=c.getId().toLowerCase()&&"room"!=c.getId().toLowerCase()?!1:!0},isPushCameraInfoBeforeLookAt:function(a){if(!a)return!1;var b=this.sceneManager.getNodeData(a);if(!b)return!1;var c=this.sceneManager.viewManager3d.getFocusNode(),d=this.sceneManager.getNodeData(c);return b!=d&&this.dataManager.isAncestor(b.getId(),d)?!1:this.isUseCameraStackByNode(a)},pushCameraInfoByChildNode:function(a){if(a){var b=this.sceneManager.getNodeData(a),c=this.sceneManager.viewManager3d.getFocusNode(),d=this.sceneManager.getNodeData(c);if(b!=d&&this.isPushCameraInfoBeforeLookAt(c)){var e=this.getCamera();e&&this.cameraInfoStack.push({id:d.getId(),target:e.target,position:e.getPosition()})}}},popCameraInfoByNode:function(a){var b=this.sceneManager.getNodeData(a);return b&&this.isUseCameraStackByNode(a)?this.popToDataParentByData(b):!1},popToDataParentByData:function(a,b){if(b=b||this,a&&b.cameraInfoStack&&!(b.cameraInfoStack.length<1)&&b.cameraInfoStack[0]&&b.cameraInfoStack[0].id!=a.getParentId()){var c=b.cameraInfoStack.pop();return c&&c.id==a.getId()?!0:b.popToDataParentByData(a,b)}},clearCameraInfo:function(){this.cameraInfoStack=[]},getSavedCameraInfoByNode:function(a){var b=this.sceneManager.getNodeData(a);if(!a||!b||!this.cameraInfoStack||this.cameraInfoStack.length<1)return null;if(!this.isUseCameraStackByNode(a))return null;for(var c=this.cameraInfoStack.length-1;c>=0;c--){var d=this.cameraInfoStack[c];if(d.id==b.getId())return d}return null},isDealWithVirtualBeforeMoveCamera:function(a,b){var c=this.sceneManager.getNodeData(b),d=this.sceneManager.getNodeData(a),e=this.sceneManager.dataManager.getCategoryForData(d);return e&&"datacenter"==e.getId().toLowerCase()?!1:this.sceneManager.isAncestor(c,d)},lookAt:function(a,b){if(this.pushCameraInfoByChildNode(a),!a)return void(b&&b());if(!this.isDoLookAt(a))return void(b&&b());var c=this.sceneManager.viewManager3d.getFocusNode(),d=this.sceneManager.getMainNode(a);if(d||this.sceneManager.isLink(a)){var e=this.sceneManager.getNodeData(d);!d&&this.sceneManager.isLink(a)?d=a:this.box3d.getDataById(d.getId())||this.sceneManager.loadLazyData(e);var f=!0;if(this.isDealWithVirtualBeforeMoveCamera(d,c)&&(f=!1),this.sceneManager.viewManager3d.isDealWithVirtual=f,this.sceneManager.viewManager3d.setFocusNode(d,f),this.beforeLookAtFunction&&this.beforeLookAtFunction(a,c),this.sceneManager.isLink(a)||(d=this.sceneManager.getMainNode(a)),!d||!this.box3d.getDataById(d.getId()))return void this.afterLookAt(d,a,c);var g=this,h=function(){!f&&g.sceneManager.viewManager3d.isDealWithVirtual&&g.sceneManager.viewManager3d.dealWithVirtual(d),g.popCameraInfoByNode(d),g.openDoor(d,b,c),g.afterLookAtFinished(d,a,c)};this.lookAtWithOutMoveCamera?this.sceneManager.isLink(a)?this.moveCameraForLookAtLink(a,h):this.withOutAnimate?(this.lookAtNodeWithOutAnimate(d),h(),this.withOutAnimate=!1):this.moveCameraForLookAtNode(d,h):(h(),this.lookAtWithOutMoveCamera=!0),this.afterLookAt(d,a,c)}},afterLookAt:function(a,b,c){this.afterLookAtFunction&&this.afterLookAtFunction(a,b,c);for(var d=0;d<this._afterLookAtListener.length;d++){var e=this._afterLookAtListener[d];e.call(e.scope||this,a,b,c)}},addAfterLookAtListener:function(a,b){a&&(a.scope=b,this._afterLookAtListener.push(a))},removeAfterLookAtListener:function(a){var b=this._afterLookAtListener.indexOf(a);-1!==b&&this._afterLookAtListener.splice(b,1)},afterLookAtFinished:function(a,b){this.afterLookAtFinishedFunction&&this.afterLookAtFinishedFunction(a,b);for(var c=0;c<this._afterLookAtFinishedListener.length;c++){var d=this._afterLookAtFinishedListener[c];d.call(d.scope||this,a,b)}},addAfterLookFinishedAtListener:function(a,b){a&&(a.scope=b,this._afterLookAtFinishedListener.push(a))},removeAfterLookAtFinishedListener:function(a){var b=this._afterLookAtFinishedListener.indexOf(a);-1!==b&&this._afterLookAtFinishedListener.splice(b,1)},findOidfromChildren:function(a,b){var c=[];a.getClient("type")==b&&c.push(a);for(var d=a.getChildren(),e=0;e<d.size();e++){var f=d.get(e);if(f.getClient("it_data")==a.getClient("it_data")){var g=this.findOidfromChildren(f,b,this);if(g&&g.length>0)for(var h=0;h<g.length;h++)c.push(g[h])}}return c},findAllOidDatafromChildren:function(a,b){var c=[];a.getClient("type")==b&&c.push(a);for(var d=a.getChildren(),e=0;e<d.size();e++){var f=d.get(e);if(f.getClient("it_data")==a.getClient("it_data")){var g=this.findOidfromChildren(f,b);if(g&&g.length>0)for(var h=0;h<g.length;h++)c.push(g[h])}}return c},findRackDoorElementAtRack:function(a){return a?this.findAllOidDatafromChildren(a,"rack_door"):void 0},findChannelDoorElementAtChannel:function(a){return a?this.findAllOidDatafromChildren(a,"channel_door"):void 0},openDoor:function(a,b){var c=this.findRackDoorElementAtRack(a),d=c.length,e=0,f=!1;c&&c.length>0&&c.forEach(function(a){a&&a.getClient("animation")&&!a.getClient("animated")&&(f=!0,make.Default.playAnimation(a,a.getClient("animation"),function(){b&&b(e++,d)}))}),!f&&b&&b(0,0)},closeDoor:function(a,b){var c=this,d=this.findRackDoorElementAtRack(a);d=d.concat(this.findChannelDoorElementAtChannel(a));var e=!1;d&&d.length>0&&d.forEach(function(a){a&&a.getClient("animation")&&a.getClient("animated")&&(e=!0,make.Default.playAnimation(a,a.getClient("animation"),b))});var f=this.sceneManager.getNodeData(a),g=this.dataManager.getChildren(f);g&&g.length>0&&g.forEach(function(a){var d=c.sceneManager.getNodeByDataOrId(a);d&&d.getClient("animation")&&d.getClient("animated")&&make.Default.playAnimation(d,d.getClient("animation"),b)}),!e&&b&&b()},isFollow:function(a){if(a){var b=this.sceneManager.getNodeData(a),c=this.dataManager.getCategoryForData(b);if(c){var d=c.getId().toLowerCase();if("datacenter"===d||"floor"===d||"room"===d)return!0}}return!1},moveToClickPoint:function(a){if(a){var b=this.getCamera();if(b){var d=a.point,e=b.getPosition().sub(b.getTarget()),f=(new mono.Vec3).addVectors(e,d);c.Util.playCameraAnimation(b,f,d,1e3)}}},moveToClickNode:function(a,b,d){if(a){d||(d=0);var e=this.getCamera();if(e){var f=this.getNodeCenterPosition(a),g=e.getPosition().sub(e.getTarget()),h=(new mono.Vec3).addVectors(g,f),i=(new mono.Vec3).subVectors(f,e.getTarget());Math.abs(i.x)>d||Math.abs(i.y)>d||Math.abs(i.z)>d?c.Util.playCameraAnimation(e,h,f,1e3,b):b&&b()}}},getElementPerfectBackPosition:function(a){if(!a)return null;var b=this.getElementPerfectDistance(a),c=a.worldPosition(new mono.Vec3(0,0,-1),b);return c&&(c.y=c.y+20),c},rotateElement:function(a){if(a){!a.isVisible()&&a.simpleRack&&(a=a.simpleRack);var b=this.getCamera(a),d=null,e=a.getWorldPosition(),f=a.getClient("rotate_flage");f?(d=this.getElementPerfectFrontPosition(a),a.setClient("rotate_flage",!1)):(d=this.getElementPerfectBackPosition(a),a.setClient("rotate_flage",!0));var g=new mono.Vec3(e.x,e.y,e.z);c.Util.playCameraAnimation(b,d,g,1e3)}},shouldHandleDoubleClickElement:function(a,b,c,d){var e=this.sceneManager.viewManager3d.getFocusNode(),f=a.getClient("modelParent")||a,g=this.sceneManager.getNodeData(f),h=this.sceneManager.getNodeData(e);return this._isLookAt(f)&&g!=h?!0:a&&(a.getClient("animation")||a.getClient("animated"))?!0:this.isFollow(a)?!0:!1},shouldPropogateDoubleClickElement:function(a,b,c,d){return!1},shouldHandleDoubleClickBackground:function(a){return!0},shouldPropogateDoubleClickBackground:function(a){return!1},handleDoubleClickBackground:function(a){var b=this.sceneManager.viewManager3d.getFocusNode();if(b){if(this.sceneManager.isLink(b)){var c=this.sceneManager.getNodeData(b);c&&(b=c.getFromId()&&this.sceneManager.isCurrentSceneInstance(c.getFromId())?this.sceneManager.getNodeByDataOrId(c.getFromId()):c.getToId()?this.sceneManager.getNodeByDataOrId(c.getToId()):b.getFromNode())}var d=this.getParentFocusNode(b);if(d)return this.lookAt(d),this.handleDoubleClickBackgroundFunction&&this.handleDoubleClickBackgroundFunction(a)}this.handleDoubleClickBackgroundFunction&&this.handleDoubleClickBackgroundFunction(a)},getParentFocusNode:function(a){var b=this.sceneManager.getNodeData(a);if(b&&b.getParentId()){var c=this.sceneManager.dataManager.getDataById(b.getParentId());if(!c)return null;var d=this.sceneManager.dataNodeMap[b.getParentId()];return d}},isLookAtParentFirst:function(a,b,c,d){return!0},isPlayAnimate:function(a){return!0},handleDoubleClickElement:function(a,b,c,d){var e=a.getClient("modelParent")||a,f=this,g=this.sceneManager.viewManager3d.getFocusNode();if(c&&d.distance>2500&&this.isLookAtParentFirst(a,b,c,d)){var h=this.sceneManager.dataManager.getDataById(c.getParentId()),i=this.sceneManager.getNodeByDataOrId(c.getParentId());if(h&&i&&i!=g){var j=this.sceneManager.dataManager.getCategoryForData(h);j&&(j.getId().indexOf("channel")>=0||"room"===j.getId().toLowerCase())&&(e=i)}}if(this._isLookAt(e)&&g!=e)this.lookAt(e);else if(a&&(a.getClient("animation")||a.getClient("animated"))){var k=a.getClient("animate");if(this.isPlayAnimate(a)){var l=function(){f.afterPlayAnimateFunction&&f.afterPlayAnimateFunction(a,!!k)};make.Default.playAnimation(a,a.getClient("animation"),l)}}else this.isFollow(a)&&this.moveToClickPoint(d)},lookAtByData:function(a,c,d){if(!a)return void(c&&c());("string"==typeof a||"number"==typeof a)&&(a=this.sceneManager.dataManager.getDataById(a));var e=this.sceneManager.getNodeByDataOrId(a),f=this.sceneManager.getSceneAndRootByData(a);if(f){if(e&&f.scene==this.sceneManager.getCurrentScene()&&f.rootData==this.sceneManager._currentRootData)return void this.lookAt(e,c);d=d||d==b||null==d?!0:!1,d&&this.sceneManager.cameraManager.setStopCamera(!0);var g=this,h=function(){f.rootData!=a?(e=g.sceneManager.dataNodeMap[a.getId()],e||(g.sceneManager.loadLazyData(a),e=g.sceneManager.dataNodeMap[a.getId()])):e=null,g.lookAt(e,c)};"earth"==f.scene.getCategoryId()?this.sceneManager.gotoScene(f.scene,f.rootData,h):(f.rootData!=a&&(this.sceneManager.resetCameraWhenSceneChange=!1),this.sceneManager.gotoScene(f.scene,f.rootData),h()),d&&mono.Utils.stopAllAnimates(!0)}}}),c.DefaultEventHandler=z;var A=function(a){w.call(this),this.sceneManager=a,this.opacityValue=.26,this.focusElement=null,this.virtualFilter=null,this.materialMap={},this.isDealWithFunction=null,this._global_tmap={},this._global_linkTmap={},this._tmap={},this._linkTmap={},this._billboard_tmap={},this._link_tmap={},this.sceneManager.network3d.setSelectTransparencyThreshold(this.opacityValue+.1),this.dealWithLinkFunction=null,this.virtualFunction=null,this.getOpacityValueFunction=null};mono.extend(A,w,{clearGlobal:function(){this._global_tmap={},this._global_linkTmap={},this.sceneManager._sceneVirtualChangeDispather.fire({type:"clearGlobal"})},clear:function(){this._tmap={},this._linkTmap={},this.sceneManager._sceneVirtualChangeDispather.fire({type:"clear"})},clearAll:function(){this._tmap={},this._linkTmap={},this._global_tmap={},this._global_linkTmap={},this.sceneManager._sceneVirtualChangeDispather.fire({type:"clearAll"})},isDealWith:function(a){return null!=this.isDealWithFunction?this.isDealWithFunction(a):!0},isVirtualOther:function(a){var b=this.sceneManager.dataManager.getDataTypeForData(a);return b&&b._noVirtualOther?!1:this.virtualFunction?this.virtualFunction(a):!0},isDealWithLink:function(a){return this.dealWithLinkFunction?this.dealWithLinkFunction(a):!1},getBId:function(a){return a&&this.isDealWith(a)?"string"==typeof a?a:a.getId():null},addGlobal:function(a){if(a instanceof c.Link)return void this.addGlobalLink(a);var b=this.getBId(a);b&&(this._global_tmap[b]=!0)},addGlobalLink:function(a){this.getBId(a)},addGlobalByDescendant:function(a){if(a&&(a instanceof mono.Element&&(a=this.getDataByNode(a)),a&&a.getId())){this.addGlobal(a);var b=this.sceneManager.dataNodeMap[a.getId()],c=b.getChildren();if(c&&c.size()>0)for(var d=0;d<c.size();d++){var e=c.get(d),f=this.getDataByNode(e);f&&this.getBId(f)!=this.getBId(a)&&this.addGlobalByDescendant(e,this)}}},removeGlobal:function(a){var b=this.getBId(a);b&&(a instanceof c.Link?delete this._global_linkTmap[b]:delete this._global_tmap[b])},removeGlobalByDescendant:function(a){if(a&&(a instanceof mono.Element&&(a=this.getDataByNode(a)),a&&a.getId())){this.removeGlobal(a);var b=this.sceneManager.dataNodeMap[a.getId()],c=b.getChildren();if(c&&c.size()>0)for(var d=0;d<c.size();d++){var e=c.get(d),f=this.getDataByNode(e);f&&this.getBId(f)!=this.getBId(a)&&this.removeGlobalByDescendant(e,this)}}},beforeAdd:function(a){},add:function(a){this.beforeAdd(a);var b=this.getBId(a);b&&(a instanceof c.Link||(this._tmap[b]=!0))},addLink:function(a){if(a){this.getBId(a)}},getDataByNode:function(a){return a?a.getClient(c.SceneManager.CLIENT_IT_DATA):null},addByDescendant:function(a){if(a&&(a instanceof mono.Element&&(a=this.getDataByNode(a)),a&&a.getId())){this.add(a);var b=a.getChildren();if(b&&!(b.size()<1))for(var c=0;c<b.size();c++){var d=b.get(c);d&&this.addByDescendant(d,this)}}},remove:function(a){var b=this.getBId(a);if(b)if(a instanceof c.Link)delete this._linkTmap[b];else{if(a.getAllLinks){var d=a.getAllLinks();if(d)for(var e in d)delete this._linkTmap[e]}delete this._tmap[b]}},removeByDescendant:function(a){var b=a;if(b&&(b instanceof mono.Element&&(b=this.getDataByNode(b)),b&&b.getId())){this.remove(b);var d=this.sceneManager.dataNodeMap[b.getId()];b instanceof c.Link&&(d=this.sceneManager.linkMap[b.getId()]);var e=this;!d||!d.getChildren;var f=null;if(b.getChildren&&(f=b.getChildren(),f&&f.size()>0))for(var g=0;g<f.size();g++){var h=f.get(g);h&&e.getBId(h)!=e.getBId(b)&&e.removeByDescendant(h,e)}}},addAll:function(){this.addAllData(),this.addAllLink(),this.sceneManager._sceneVirtualChangeDispather.fire({type:"addAll"})},addAllData:function(){var a=this.sceneManager.dataManager.getDataMap();if(a){for(var b in a){var c=a[b];c&&this.add(c)}this.sceneManager._sceneVirtualChangeDispather.fire({type:"addAllData"})}},addAllLink:function(){var a=this.sceneManager.dataManager.getLinkMap();if(a){for(var b in a){var c=a[b];c&&this.addLink(c)}this.sceneManager._sceneVirtualChangeDispather.fire({type:"addAllLink"})}},isDealWithBillboard:function(a){return!0},isVirtual:function(a){var b=a;if(a instanceof mono.Element&&(b=this.getDataByNode(a)),!(b instanceof c.Data||b instanceof c.Link))return!1;var d=this.sceneManager.getNodeByDataOrId(b);if(d&&d.getClient(c.SceneManager.CLIENT_EXT_VITUAL))return!1;var e=this.getBId(b),f=!1;return e&&(a instanceof mono.Link?this._global_linkTmap[e]?f=this._global_linkTmap[e]:this._linkTmap[e]&&(f=this._linkTmap[e]):this._global_tmap[e]?f=this._global_tmap[e]:this._tmap[e]&&(f=this._tmap[e])),f},isLink:function(a){return a&&a.getClient(c.SceneManager.CLIENT_IT_DATA)&&a.getClient(c.SceneManager.CLIENT_IT_DATA)instanceof c.Link?!0:!1},isHideVirtualBillboard:function(a){return a&&a instanceof mono.Billboard&&a.getParent()&&a.getClient("_alarmBillboard")?!0:!1},setFocusElement:function(a){},setOpacityValue:function(a){a&&(this.opacityValue=a)},getOpacityValue:function(a){return this.getOpacityValueFunction&&this.getOpacityValueFunction(a)?this.getOpacityValueFunction(a):this.opacityValue},destoryBillboard:function(){if(this._billboard_tmap)for(var a in this._billboard_tmap){var c=this._billboard_tmap[a];if(c.hasOwnProperty("orig_opacity")){var d=c.orig_opacity;d==b&&(d=1),c.setStyle("m.opacity",d),this.isHideVirtualBillboard(c)&&c.setVisible(!0),delete c.orig_opacity,c.renderDepth=0,delete this._billboard_tmap[c.getId()]}}},getParentDataByNode:function(a,b){if(!a)return null;b||(b=this);var c=b.getDataByNode(a);if(c)return c;var d=a.getParent();return arguments.callee(d,b)},filterMaterial:function(a,d,e){if(!this.isLink(e)&&e instanceof mono.Line)return a;if(e&&e.getClient(c.SceneManager.CLIENT_EXT_VITUAL))return a;var f=this.materialMap,g=d?d:a,h=this.getDataByNode(e);!h&&e instanceof mono.Billboard&&e.getParent()&&(h=this.getDataByNode(e.getParent())),h||(h=this.getParentDataByNode(e));var i=this.getOpacityValue(h);if(1==i)return g;var j="",k=!1;if(h&&h instanceof c.Link&&this.isDealWithLink())return j=this.getBId(h),j&&(this._global_linkTmap[j]?k=this._global_linkTmap[j]:this._linkTmap[j]&&(k=this._linkTmap[j])),k?(this._link_tmap[e.getId()]=e.isVisible(),e.setVisible(!1)):(null!=this._link_tmap[e.getId()]||this._link_tmap[e.getId()]!==b)&&(e.setVisible(this._link_tmap[e.getId()]),delete this._link_tmap[e.getId()]),g;if(h&&h instanceof c.Data&&(j=this.getBId(h)),j&&(this._global_tmap[j]?k=this._global_tmap[j]:this._tmap[j]&&(k=this._tmap[j])),e instanceof mono.Billboard&&this.isDealWithBillboard(e)){if(k)e.renderDepth=1e4,e.hasOwnProperty("orig_opacity")||(e.orig_opacity=e.getStyle("m.opacity")),this._billboard_tmap[e.getId()]=e,e.setStyle("m.opacity",i),this.isHideVirtualBillboard(e)&&e.setVisible(!1);else if(e.hasOwnProperty("orig_opacity")&&this._billboard_tmap[e.getId()]){var l=e.orig_opacity;l==b&&(l=1),e.setStyle("m.opacity",l),this.isHideVirtualBillboard(e)&&e.setVisible(!0),delete e.orig_opacity,e.renderDepth=0,delete this._billboard_tmap[e.getId()]}return g}if(!k)return g;var m=d?d.getUniqueCode():a.getUniqueCode();if(null==f[m]){var n=d?d.clone():a.clone();return n.transparent=!0,n.opacity>i&&(n.opacity=i),f[m]=n,n}return f[m]}}),c.VirtualManager=A;var B=function(){};mono.extend(B,Object,{isSelectable:function(a,b){return!0}}),c.SelectableFilter=B;var C=function(a){this.virtualManager=a};mono.extend(C,B,{isSelectable:function(a,b){return this.virtualManager.isVirtual(a)?!1:a instanceof mono.Line?!1:!0}}),c.SelectableManager=C,$CameraManager=function(a){this.sceneManager=a,this.onloadFinishFunction=null,this.doAnimateFunction=null,this.finalCameraFunction=null,this.beforeSceneChangeCameraFunction=null,this._afterPlayCameraListener=[],this.initCamera(),this.callback=this.afterPlayCamera,this._stopCamera=!1},mono.extend($CameraManager,Object,{initCamera:function(){var a=this;this.sceneManager.resetCamera=function(b,c,d,e,f){return a.sceneManager.resetCameraWhenSceneChange?a._stopCamera?void(a._stopCamera=!1):void a.setCameraForOnloadFinish(b,c,d,e,f):void(a.sceneManager.resetCameraWhenSceneChange=!0)},this.sceneManager.beforeLoadSceneAnimate=function(b,c,d,e,f,g){a.beforeSceneChangeCameraFunction?a.beforeSceneChangeCameraFunction(b,c,d,e,f,g):f&&f.call(g)}},setStopCamera:function(a){this._stopCamera=a===!0},beforePlaySceneChangeAnimate:function(a,b,c,d,e){return!0},setCameraForOnloadFinish:function(a,b,c,d,e){if(this.beforePlaySceneChangeAnimate(a,b,c,d,e)){var f=this,g=function(){f.doAnimate(a,b,c,d,e)};if(this.onloadFinishFunction)return void this.onloadFinishFunction(a,b,c,d,g);var h=this.sceneManager;h.resetCameraWhenSceneChange&&(h._currentRootNode?h.viewManager3d.getDefaultEventHandler().lookAtNodeWithOutAnimate(h._currentRootNode):h.network3d.zoomEstimateOverview(30)),h.resetCameraWhenSceneChange=!0,g.call(this,a,b,c,d)}},isDoAnimate:function(a,b,c,d,e){return!0},doAnimate:function(a,b,c,d,e){var f=this,g=function(){f.setFinalCamera(a,b,c,d,e)};return this.isDoAnimate(a,b,c,d,e)&&this.doAnimateFunction?void this.doAnimateFunction.call(this,a,b,c,d,g,e):void g(a,b,c,d,e)},isDoFinalCamera:function(a,b,c,d,e){return!0},setFinalCamera:function(a,b,c,d,e){var f=this.callback;return this.finalCameraFunction?void this.finalCameraFunction(a,b,c,d,f,e):void(f&&f.call(this,a,b,c,d,e))},addAfterPlayCameraListener:function(a,b){a.scope=b,this._afterPlayCameraListener.push(a)},removeAfterPlayCameraListener:function(a){var b=this._afterPlayCameraListener.indexOf(a);-1!==b&&this._afterPlayCameraListener.splice(b,1)},afterPlayCamera:function(a,b,c,d,e){for(var f=0;f<this._afterPlayCameraListener.length;f++){var g=this._afterPlayCameraListener[f];g.call(g.scope||this,a,b,c,d,e)}}}),c.CameraManager=$CameraManager;var D=function(a){this.dataManager=a,this.descentdantMap={},this.ancesstorIdsMap={},this.init()};mono.extend(D,Object,{init:function(){},getGetMethod:function(a){var b="get"+a.charAt(0).toUpperCase()+a.slice(1);return b},getDatas:function(){return this.dataManager.getDatas()},getDataById:function(a){return this.dataManager.getDataById(a)},isChild:function(a,b,c){if(!a||!b)return!1;if(a.getId()==b)return!0;if(a.getParentId()==b)return!0;if(a.getParentId()){var d=this.dataManager.getDataById(a.getParentId()),c=c||this;return c.isChild(d,b,c)}return!1},filter:function(a){return!0},isVisible:function(a){if(a){var b=this.dataManager.getCategoryForData(a);if(b&&!b.isVisible())return!1}return!0},find:function(a){var b=this.getDatas();if(!b||b.length<1)return[];var c=[];if(!a||a.length<1){for(var d=0;d<b.length;d++)this.isVisible(b[d])&&this.filter(b[d])&&c.push(b[d]);return c}for(var e,d=0,f=b.length;f>d;d++)e=b[d],this.isVisible(e)&&this.filter(e)&&this.isDataConformConditions(e,a)&&c.push(e);return c},isDataConformConditions:function(a,b){var c=!0;for(var d in b)if(!this.isDataConformCondition(a,b[d])){c=!1;break}return c},isDataConformCondition:function(a,b,c){if(""==b.value||null==b.value)return!0;var c=c||b.key,d=b.dataType||"string";if(c.indexOf(",")>0){for(var e=c.split(","),f=0;f<e.length;f++)if(this.isDataConformCondition(a,b,e[f]))return!0;return!1}var g=!1,h=!1,i=!1;c.toUpperCase().startsWith("U:")?(g=!0,c=c.slice(2)):c.toUpperCase().startsWith("C:")?(h=!0,c=c.slice(2)):c.toUpperCase().startsWith("D:")&&(i=!0,c=c.slice(2));var j=this.getGetMethod(c),k=b.operation,l=b.value,m=null;if(g)m=a.getUserData(c);else if(h){var n=this.dataManager.getCategoryForData(a);m=null==n[j]?n.getUserData(c):n[j]()}else if(i){var d=this.dataManager.getDataTypeForData(a);m=null==d[j]?d.getUserData(c):d[j]()}else{var j=this.getGetMethod(c);m=a[j]&&a[j]()}if(!m&&"ancestor"===c&&this.isChild(a,b.value,this))return!0;var o=this[k];return"function"==typeof o?this[k](l,m,c):this.other(l,m,c,k,d)},equal:function(a,b,c){return a&&b?a.toLowerCase()==b.toLowerCase():b==a},like:function(a,b,c){return b+="",b.trim&&(b=b.trim()),a.trim&&(a=a.trim()),a=a.toLowerCase(),b=b.toLowerCase(),b.indexOf&&b.indexOf(a)>=0?!0:!1},between:function(a,b,c){
return a[0]||a[1]?null==a[0]?b<=a[1]:null==a[1]?b>=a[0]:b>=a[0]&&b<=a[1]:!1},other:function(a,b,c,d,e){if(!d)return this.like(a,b,c);if(e=e||"string",a&&b){"number"==e?(b=parseFloat(b),a=parseFloat(a)):"number"==typeof b&&(b+="");var d=d.trim();if(">"==d)return b>a;if("<"==d)return a>b;if("<="==d)return a>=b;if(">="==d)return b>=a;if("="==d)return"number"==typeof b||"number"==typeof a?b===a:b.toLowerCase()==a.toLowerCase()}return this.like(a,b,c)},descentdantOf:function(a,b,c){if("id"!==c)throw"Only id support descentdantOf";var d=this.getDataById(a),e=this.getDataById(b);if(null==d||null==e)return!1;var f=this.dataManager.getAncestors(e)||[];return-1!==f.indexOf(d)}}),c.DataFinder=D;var E=function(a){this.bfAdapter=a,this.sceneManager=this.bfAdapter.sceneManager,this.dataManager=this.sceneManager.dataManager,this.beforeDoubleClickFloorFunction=null};mono.extend(E,Object,{doubliClickFloorNode:function(a,b,d,e,f){if(this.beforeDoubleClickFloorFunction&&this.beforeDoubleClickFloorFunction(a),d){var g=this.dataManager.getDataById(d.getParentId());if(g){var h=this.sceneManager.viewManager3d.getDefaultEventHandler(),i=this.dataManager.getCategoryForData(d),j=this.dataManager.getSceneByCategory(i),k=this.sceneManager.getSceneAndRootByData(d);if(this.sceneManager._currentScene==j&&k&&this.sceneManager._currentRootData==k.rootData)return void h.moveToClickPoint(e);if(j&&!this.doubleClickFloorNodeFlag){this.sceneManager.viewManager3d.enableDBLClick=!1;var l=new c.VirtualManager(this.sceneManager);l.opacityValue=1,l.addByDescendant(this.sceneManager._currentRootData),l.removeByDescendant(d),this.sceneManager.viewManager3d.addMaterialFilter(l),this.doubleClickFloorNodeFlag=!0;for(var m=[],n=this,o=g.getChildren(),p=this.sceneManager.dataNodeMap[d.getId()],q=o.size()-1;q>=0;q--){var r=o.get(q),s=this.dataManager.getCategoryForData(r);if(s&&s.getId()&&s.getId().toLowerCase().indexOf("floor")>=0){var t=this.sceneManager.dataNodeMap[r.getId()];t&&t.getY()>p.getY()&&m.push(t)}}var u=this.sceneManager.network3d.getCamera();b&&(u=b.getCamera());var v=this.sceneManager.viewManager3d.getFocusNode(),w=function(){var a=n.sceneManager.viewManager3d.getFocusNode();if(a!=v)return this.doubleClickFloorNodeFlag=!1,void(n.sceneManager.viewManager3d.enableDBLClick=!0);var b=function(){u.fov=60;var a=n.sceneManager.getCurrentScene(),b=n.sceneManager._currentRootData;if(n.sceneManager.resetCameraWhenSceneChange=!1,n.sceneManager._loadOneScene(j,d,f),d){var c=n.sceneManager.dataNodeMap[d.getId()];c&&c.setParent(null),n.sceneManager.viewManager3d.setFocusNode(c)}n.doubleClickFloorNodeFlag=!1,n.sceneManager.viewManager3d.enableDBLClick=!0,n.sceneManager.cameraManager.callback&&n.sceneManager.cameraManager.callback(j,d,a,b)};b()},x=d.getPosition(),y=p.getWorldPosition().clone(),z=p.getScale(),A=function(a){if(!a)return null;var b=a.getRotation().clone(),c=a.getParent();if(c){var d=A.call(this,c);d&&(b.x=b.x+d.x,b.y=b.y+d.y,b.z=b.z+d.z)}return b},B=A(p),C=function(){var a=p.getBoundingBox(),b=u.getDistance(),c=a.size().z>a.size().x?a.size().x:a.size().z;c=2*c;var e=mono.Utils.getVectorAngles(u.target,u.getPosition()),f=d.getRotation()||new mono.Vec3,g=new mono.Animate({from:0,to:1,dur:1e3,onUpdate:function(a){var d=(new mono.Vec3).lerpVectors(y,x,a);if(p.setPosition(d),p.orgScale){var g=p.orgScale.clone();p.setScaleX(z.x+(g.x-z.x)*a),p.setScaleY(z.y+(g.y-z.y)*a),p.setScaleZ(z.z+(g.z-z.z)*a)}p.setRotationX(B.x+(f.x*mono.Utils.DEGREES_TO_RADIANS-B.x)*a),p.setRotationY(B.y+(f.y*mono.Utils.DEGREES_TO_RADIANS-B.y)*a),p.setRotationZ(B.z+(f.z*mono.Utils.DEGREES_TO_RADIANS-B.z)*a);var h=b+(c-b)*a,i=new mono.Vec3,j=d.clone();i.x=j.x+h*Math.sin(e[0]*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(e[1]*mono.Utils.DEGREES_TO_RADIANS),i.z=j.z+h*Math.cos(e[0]*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(e[1]*mono.Utils.DEGREES_TO_RADIANS),i.y=j.y+h*Math.sin(e[1]*mono.Utils.DEGREES_TO_RADIANS),u.setPosition(i),u.lookAt(j)},onStop:function(){w()}});g.play()},D=function(){var a=function(){n.removeDcAndBuilding(d),p.orgScale&&(p.setScaleX(z.x),p.setScaleY(z.y),p.setScaleZ(z.z)),p.setRotationX(B.x),p.setRotationY(B.y),p.setRotationZ(B.z),p.setPosition(y),n.sceneManager.viewManager3d.removeMaterialFilter(l),C()},b=u.getDistance(),c=u.target,e=u.getPosition(),f=mono.Utils.getVectorAngles(c,e),g=f[1],h=f[0],i=p.getWorldPosition(),j=new twaver.Animate({from:0,to:1,dur:1e3,onUpdate:function(a){var d=(new mono.Vec3).lerpVectors(c,i,a),e=new mono.Vec3;e.x=d.x+b*Math.sin(h*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(g*mono.Utils.DEGREES_TO_RADIANS),e.z=d.z+b*Math.cos(h*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(g*mono.Utils.DEGREES_TO_RADIANS),e.y=d.y+b*Math.sin(g*mono.Utils.DEGREES_TO_RADIANS),u.p(e),u.lookAt(d)},onStop:function(){a()}});j.play()},E=new mono.Animate({from:0,to:1,dur:1e3,easing:"easeOut",onUpdate:function(a){for(var b=m.length-1;b>=0;b--){var c=m[b],d=n.sceneManager.getNodeData(c),e=parseFloat(d.getPosition().y/10);c.setY(e+50+200*a)}l.opacityValue=1-a,l.materialMap={}},onStop:function(){D()}});E.play()}}}},removeDcAndBuilding:function(a){if(a){this.sceneManager.getNodeByDataOrId(a);for(var b in this.sceneManager.dataNodeMap){var c=this.sceneManager.dataNodeMap[b];c&&!this.sceneManager.isAncestor(b,a.getId())&&c.setParent(null)}for(var b in this.sceneManager.dataNodeMap){var c=this.sceneManager.dataNodeMap[b];c&&b!=a.getId()&&!this.sceneManager.isAncestor(b,a.getId())&&this.sceneManager.network3d.dataBox.removeByDescendant(c)}}}});var F=function(a){this.bfAdapter=a,this.sceneManager=a.sceneManager,this.virFilter=new c.VirtualManager(this.sceneManager),this.virFilter.opacityValue=.01,this.oldResetCamera=this.sceneManager.resetCamera,this.defaultEventHandler=this.sceneManager.viewManager3d.defaultEventHandler,this.animates=[],this.init()};mono.extend(F,Object,{init:function(){},destroy:function(){},doFloorToDatacenter:function(a,b,c,d,e){var f=this;this.oldIsNeedSetParent=this.sceneManager.isNeedSetParent,this.sceneManager.isNeedSetParent=function(a,b){return a==d?!1:f.oldIsNeedSetParent.call(f.sceneManager,a,b)},this.oldTranslatePosition=this.sceneManager.translatePosition,this.sceneManager.translatePosition=function(a){return a==d?null:f.oldTranslatePosition.call(f.sceneManager,a)};var g=this.sceneManager.resetCamera;this.sceneManager.resetCamera=function(){return null},this.sceneManager.viewManager3d.enableDBLClick=!1;var h=this.sceneManager.getNodeByDataOrId(d);this.sceneManager.viewManager3d.addMaterialFilter(this.virFilter),this.virFilter.opacityValue=0,this.virFilter.materialMap={},this.virFilter.addByDescendant(b),this.virFilter.removeByDescendant(d);var i=(this.sceneManager.viewManager3d.defaultEventHandler,function(a){var b=f.sceneManager.getNodeByDataOrId(d.getParentId()),c=f.sceneManager.dataManager.getDataById(d.getParentId()),e=f.sceneManager.getNodeByDataOrId(c.getParentId());e&&(f.sceneManager.viewManager3d.defaultMaterialFilter.addAll(),f.sceneManager.viewManager3d.defaultMaterialFilter.removeByDescendant(e)),f.sceneManager.viewManager3d.setFocusNode(b);var g=f.getFloorsByBuildingNode(b);f.sceneManager.viewManager3d.defaultMaterialFilter.clear(),f.sceneManager.viewManager3d.defaultMaterialFilter.addByDescendant(c);for(var i=0;i<g.length;i++){var j=g[i],k=f.sceneManager.getNodeData(j);if(f.sceneManager.viewManager3d.defaultMaterialFilter.removeByDescendant(k),k!=d){j.setParent(b),j.setY(k.getPosition().y/10+50),f.sceneManager.computeRotation(k,c,j,b);var l=f.getFloorScaleInDc(j,b)||new mono.Vec3(1,1,1);j.setScale(l)}}setTimeout(function(){f.removeChildrenByFloorNode(h),f.doFloorPRSAnimate(h,a)},500)});this.clearOtherFloorParentRelaction(),this.animates=[];var j=f.sceneManager.getCurrentScene(),k=f.sceneManager._currentRootData;this.sceneManager._loadOneScene(a,b),this.sceneManager.resetCamera=g;var l=function(){f.sceneManager.cameraManager.callback&&f.sceneManager.cameraManager.callback(a,b,j,k),e&&e()};i(l),this.sceneManager.isNeedSetParent=this.oldIsNeedSetParent,this.sceneManager.translatePosition=this.oldTranslatePosition},clearOtherFloorParentRelaction:function(a){var b=this.sceneManager.dataManager._categoryDatas.floor;if(b){for(var c in b){var d=this.sceneManager.dataManager.getDataById(c);d&&d!=a&&d.getChildren()&&d.getChildren().size()>0&&this.clearRelactionByParentData(d)}}},doFloorPRSAnimate:function(a,b){if(!a)return void(this.sceneManager.viewManager3d.enableDBLClick=!1);var c=this,d=this.getBuildingNodeByFloor(a),e=this.getFloorsByBuildingNode(d),f=this.getFloorPositionInDc(a,d)||new mono.Vec3,g=this.getFloorRotationInDc(a,d)||new mono.Vec3,h=this.getFloorScaleInDc(a,d)||new mono.Vec3(1,1,1),i=this.sceneManager.network3d.getCamera(),j=i.target.clone(),k=null;if(1==e.length)k=this.defaultEventHandler.getCameraTarAndPosForLookAtNodes([d],30);else{var l=this.getEndingFloorsByFloors(e,d,a);k=this.defaultEventHandler.getCameraTarAndPosForLookAtNodes(l,30)}var m=mono.Utils.getVectorAngles(k.target,k.position),n=i.getDistance(),o=k.position.distanceTo(k.target),p=a.getWorldPosition(),q=a.getRotation(),r=a.getScale(),s=new mono.Animate({from:0,to:1,dur:2e3,onUpdate:function(b){var c=(new mono.Vec3).lerpVectors(p,f,b);a.setPosition(c),a.setScaleX(r.x+(h.x-r.x)*b),a.setScaleY(r.y+(h.y-r.y)*b),a.setScaleZ(r.z+(h.z-r.z)*b),a.setRotationX(q.x+(g.x-q.x)*b),a.setRotationY(q.y+(g.y-q.y)*b),a.setRotationZ(q.z+(g.z-q.z)*b);var d=(new mono.Vec3).lerpVectors(j,k.target,b),e=n+(o-n)*b,l=new mono.Vec3;l.x=d.x+e*Math.sin(m[0]*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(m[1]*mono.Utils.DEGREES_TO_RADIANS),l.z=d.z+e*Math.cos(m[0]*mono.Utils.DEGREES_TO_RADIANS)*Math.cos(m[1]*mono.Utils.DEGREES_TO_RADIANS),l.y=d.y+e*Math.sin(m[1]*mono.Utils.DEGREES_TO_RADIANS),i.setPosition(l),i.lookAt(d)},onStop:function(){c.setFloorRelationShipAndPosition(a,d),c.doFadeOutAnimate(a,e,b),c.animates=[]}});this.animates.push(s),s.play()},doFadeOutAnimate:function(a,b,c){var d=this,e=new mono.Animate({from:0,to:1,dur:2e3,onUpdate:function(a){d.virFilter.opacityValue=.16+.84*a,d.virFilter.materialMap={},d.sceneManager.network3d.dirtyNetwork()},onStop:function(){d.sceneManager.viewManager3d.removeMaterialFilter(d.virFilter),d.sceneManager.viewManager3d.enableDBLClick=!0,(!b||b.length<=1)&&d.sceneManager.viewManager3d.setFocusNode(d.sceneManager.getCurrentRootNode()),d.animates=[],c&&c()}});this.animates.push(e),e.play()},stopAllAnimate:function(){if(this.animates&&this.animates.length>0)for(var a=0;a<this.animates.length;a++){var b=this.animates[a];b.stop()}this.animates=[]},setFloorRelationShipAndPosition:function(a,b){if(a&&b){var c=this.sceneManager.getNodeData(a),d=this.sceneManager.getNodeData(b),e=new mono.Vec3;new mono.Vec3;c.getPosition()&&(e.setY(c.getPosition().y/10+50),e.setX(c.getPosition().x),e.setZ(c.getPosition().z)),this.sceneManager.computeRotation(c,d,a,b),a.setPosition(e),a.setParent(b)}},removeChildrenByFloorNode:function(a){if(a){var b=this.sceneManager.getNodeData(a);this.sceneManager.network3d.dataBox.removeByDescendant(a),this.clearRelactionByParentData(b),this.sceneManager.network3d.dataBox.addByDescendant(a),this.sceneManager.isClearCache&&this.sceneManager.clearCache()}},clearRelactionByParentData:function(a){if(a){var b=a.getChildren();if(b&&!(b.size()<1))for(var c=0;c<b.size();c++){var d=b.get(c),e=this.sceneManager.getNodeByDataOrId(d);e&&e.setParent(null),this.clearRelactionByParentData.call(this,d)}}},getBuildingNodeByFloor:function(a){if(!a)return null;var b=this.sceneManager.getNodeData(a),c=b.getParentId(),d=this.sceneManager.dataManager.getCategoryForData(c);return d&&"building"==d.getId().toLowerCase()?this.sceneManager.getNodeByDataOrId(c):null},getFloorsByBuildingNode:function(a){for(var b=this.sceneManager.getNodeData(a),c=b.getChildren(),d=[],e=0;e<c.size();e++){var f=c.get(e),g=this.sceneManager.dataManager.getCategoryForData(f);if(g&&g.getId()&&g.getId().toLowerCase().indexOf("floor")>=0){var h=this.sceneManager.dataNodeMap[f.getId()];d.push(h)}}return d},getEndingFloorsByFloors:function(a,b,c){if(!a)return null;for(var d=[],e=0;e<a.length;e++){var f=a[e],g=f.clonePrefab();if(f==c){var h=this.getFloorScaleInDc(c,b);h&&g.setScale(h);var i=f.p().clone();i.setY(i.y/10),g.setPosition(b.p().clone().add(i))}else g.setPosition(f.getWorldPosition());d.push(g)}return d},getFloorPositionInDc:function(a,b){if(!a||!b)return null;var c=this.sceneManager.getNodeData(a);if(b){var d=b.getWorldPosition().clone();return c.getPosition()&&c.getPosition().y&&(d.setY(d.y+c.getPosition().y/10+50),d.setX(d.x+c.getPosition().x),d.setZ(d.z+c.getPosition().z)),d}return null},getFloorRotationInDc:function(a,b){if(!a||!b)return null;var c=new mono.Vec3;a&&(c=a.getRotation().clone());var d=b.getRotation().clone();return d&&(c=c.add(d)),c},getFloorScaleInDc:function(a,b){if(!a||!b)return null;for(var d=this.sceneManager.getNodeData(b),e=b.getScale(),f=c.Util.getBoundingBox(b),g=d.getChildren(),h=10,i=10,j=0;j<g.size();j++){var k=g.get(j),l=this.sceneManager.dataManager.getCategoryForData(k);if(l&&l.getId()&&l.getId().toLowerCase().indexOf("floor")>=0){var m=this.sceneManager.dataNodeMap[k.getId()];if(m){m.orgScale||(m.orgScale=m.getScale().clone()),m.orgPosY||(m.orgPosY=m.getPositionY());var n=m.getBoundingBox();if(f&&n){var o=f.size(),p=n.size(),q=.1,r=.1;o&&p&&(o.x!=-(1/0)&&o.x!=1/0&&p.x!=-(1/0)&&p.x!=1/0&&(q=o.x/p.x),o.z!=-(1/0)&&o.z!=1/0&&p.z!=-(1/0)&&p.z!=1/0&&(r=o.z/p.z)),h>q&&(h=q),i>r&&(i=r)}}}}var s=h>i?i:h;return new mono.Vec3(s*e.x,s>.1?s:.1,s*e.z)}}),$BaseFocuseChangeAdapeter=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.box=this.sceneManager.network3d.getDataBox()},mono.extend($BaseFocuseChangeAdapeter,Object,{realToFake:function(a,b){},fakeToReal:function(a,b){},focusNodeChange:function(a,b){},startInit:function(){},destroy:function(){}}),c.BaseFocuseChangeAdapeter=$BaseFocuseChangeAdapeter,$ComplexNodeAndSimpleNodeChangeAdapter=function(a){$BaseFocuseChangeAdapeter.call(this,a)},mono.extend($ComplexNodeAndSimpleNodeChangeAdapter,$BaseFocuseChangeAdapeter,{realToFake:function(a,b){if(!a)return null;var d=this,e=a.getClient("complexNode"),f=a.getClient("simpleNode"),g=this.sceneManager.getNodeData(a);if(e.setParent(null),f.setParent(a),this.box.getDataById(a.getId())){var h=null,i=null,j=this.sceneManager.getNodeData(b);j&&j instanceof c.Link&&(h=this.sceneManager.getNodeByDataOrId(j.getFromId()),i=this.sceneManager.getNodeByDataOrId(j.getToId())),this.box.removeByDescendant(a,!1,function(a){var b=d.sceneManager.getNodeData(a),c=d.dataManager.getDataTypeForData(b);return c&&!c.isLazyable()?!1:(!h||h!=a&&a.getParent()!=h)&&(!i||i!=a&&a.getParent()!=i)&&b&&g&&b.getParentId&&b.getParentId()===g.getId()?!0:!1}),this.box.removeByDescendant(e),this.box.addByDescendant(f,function(a){return!0}),this.sceneManager._sceneManagerChangeDispatcher.fire({kind:"change",data:a})}this.sceneManager.viewManager3d.getDefaultEventHandler().closeDoor(e)},fakeToReal:function(a,b){if(b){var c=b.getClient("simpleNode"),d=b.getClient("complexNode");c.setParent(null),d.setParent(b),this.box.addByDescendant(d,function(a){return!0}),this.box.removeByDescendant(c),this.sceneManager._sceneManagerChangeDispatcher.fire({kind:"change",data:b})}},getRackByData:function(a){if(!a)return null;var b=this.sceneManager.dataManager.getCategoryForData(a).getId();return"rack"==b?a:"earth"==b?null:(a=this.sceneManager.dataManager.getParent(a),this.getRackByData(a))},clearNodeState:function(a){a&&this.sceneManager.viewManager3d.getDefaultEventHandler().isPlayAnimate(a)&&a.getClient("animation")&&a.getClient("animated")===!0&&make.Default.playAnimation(a,a.getClient("animation"),null)},focusNodeChange:function(a,b){if(a){var c=this.sceneManager.getNodeData(a),d=this.sceneManager.dataManager.getCategoryForData(c),e=d.getId(),f=this.sceneManager.getNodeData(b),g=this.getRackByData(c),h=this.getRackByData(f);if(d&&"rack"!=e&&g&&!h){var i=this.sceneManager.dataManager.getDataById(c.getParentId());!i||f==i||f.getParentId&&f.getParentId()==i.getId()||(oldRackNode=this.sceneManager.getNodeByDataOrId(g),this.clearNodeState(a),this.realToFake(oldRackNode))}}}});var G=function(a){c.BaseFocuseChangeAdapeter.call(this,a),this.isMoveCameraBeforeLaunchFloor=!0,this.animates=[],this.init()};mono.extend(G,c.BaseFocuseChangeAdapeter,{init:function(){var a=this;this.f2BHandle=new F(this),this.b2fHandle=new E(this),this.sceneChangeListener=function(b){a.bindingBuildingAndFloor(b.data,b.rootData,b.oldData,b.oldRootData)},this.sceneManager.addSceneChangeListener(this.sceneChangeListener,this),this.orgChangeAnimate=this.sceneManager.cameraManager.beforePlaySceneChangeAnimate,this.newChangeAnimate=function(b,c,d,e){var f=a.dataManager.getCategoryForData(e),g=a.dataManager.getCategoryForData(c);return f&&g&&"floor"===f.getId().toLowerCase()&&"datacenter"===g.getId().toLowerCase()?!1:a.orgChangeAnimate.call(a.sceneManager.cameraManager,b,c,d,e)},this.bindingBuildingAndFloorVisibleManager=new c.VisibleManager(this.sceneManager),this.sceneManager.viewManager3d.addVisibleFilter(this.bindingBuildingAndFloorVisibleManager);var b=this.sceneManager.viewManager3d.getDefaultEventHandler();this.oldlookAtFun=b.lookAt,this.newLookAtfun=function(c,d){var e=a.sceneManager.getNodeData(c),f=a.sceneManager.dataManager.getCategoryForData(e);if(f&&"building"==f.getId()){var g=a.sceneManager.getNodeByDataOrId(e);return a.sceneManager.viewManager3d.setFocusNode(g),b.afterLookAt(g,c),void(d&&d())}a.oldlookAtFun.call(b,c,d)},this.oldGotoScene=this.sceneManager.gotoScene,this.newGotoScene=function(b,c,d){var e=a.sceneManager.getCurrentScene(),f=a.sceneManager.getNodeData(a.sceneManager.getCurrentRootNode()),g=a.sceneManager.getNodeByDataOrId(c),h=a.sceneManager.viewManager3d.getFocusNode(),i=a.sceneManager.getNodeData(h);return i&&i.getId()==c.getParentId()&&a.sceneManager.resetCameraWhenSceneChange&&g&&g.doubliClick?void g.doubliClick(g,a.sceneManager.network3d,c,null,d):void(e&&"floor"==e.getId()&&b&&"datacenter"==b.getId().toLowerCase()?a.f2BHandle.doFloorToDatacenter(b,c,e,f,d):a.oldGotoScene.call(a.sceneManager,b,c,d))};var d=this.sceneManager.viewManager3d.defaultMaterialFilter;this.oldGetOpacityValue=d.getOpacityValue,this.newGetOpacityValue=function(b){return a.sceneManager.getCurrentScene()&&a.sceneManager.getCurrentScene().getCategoryId()&&"datacenter"==a.sceneManager.getCurrentScene().getCategoryId().toLowerCase()?.01:a.oldGetOpacityValue.call(d,b)}},startInit:function(){this.bindingBuildingAndFloorVisibleManager&&this.sceneManager.viewManager3d.addVisibleFilter(this.bindingBuildingAndFloorVisibleManager),this.sceneChangeListener&&(this.sceneManager.removeSceneChangeListener(this.sceneChangeListener,this),this.sceneManager.addSceneChangeListener(this.sceneChangeListener,this)),this.sceneManager.viewManager3d.getDefaultEventHandler().lookAt=this.newLookAtfun,this.sceneManager.gotoScene=this.newGotoScene,this.sceneManager.cameraManager.beforePlaySceneChangeAnimate=this.newChangeAnimate,this.sceneManager.viewManager3d.defaultMaterialFilter.getOpacityValue=this.newGetOpacityValue},destroy:function(){this.bindingBuildingAndFloorVisibleManager&&(this.bindingBuildingAndFloorVisibleManager.clear(),this.sceneManager.viewManager3d.removeVisibleFilter(this.bindingBuildingAndFloorVisibleManager)),this.sceneChangeListener&&this.sceneManager.removeSceneChangeListener(this.sceneChangeListener,this),this.sceneManager.viewManager3d.getDefaultEventHandler().lookAt=this.oldlookAtFun,this.sceneManager.gotoScene=this.oldGotoScene,this.sceneManager.cameraManager.beforePlaySceneChangeAnimate=this.orgChangeAnimate,this.sceneManager.viewManager3d.defaultMaterialFilter.getOpacityValue=this.oldGetOpacityValue},stopAllAnimate:function(){if(this.animates&&this.animates.length>0)for(var a=0;a<this.animates.length>0;a++){var b=this.animates[a];b.stop()}this.animates=[]},focusNodeChange:function(a,b){if(b){var c=this.dataManager._sceneMap;for(var d in c){var e=c[d];if(e&&e.getCategoryId()&&e.getCategoryId().toLowerCase().indexOf("building")>=0)return}var f=this,g=this.sceneManager.getNodeData(b),h=this.dataManager.getCategoryForData(g),i=a?this.sceneManager.getNodeData(a):null,j=this.dataManager.getCategoryForData(i);if(!(h&&h.getId().toLowerCase().indexOf("datacenter")>=0&&j&&"floor"==j.getId()))if(h&&h.getId()&&h.getId().toLowerCase().indexOf("building")>=0&&j&&j.getId()&&j.getId().toLowerCase().indexOf("building")>=0){var k=i.getChildren();if(k&&k.size()>0)for(var l=0;l<k.size();l++){var m=k.get(l),n=this.dataManager.getCategoryForData(m);if(n&&n.getId()&&n.getId().toLowerCase().indexOf("floor")>=0){var o=f.sceneManager.dataNodeMap[m.getId()];o&&f.box.getDataById(o.getId())&&(f.box.removeByDescendant(o),f.bindingBuildingAndFloorVisibleManager.setVisibleByDescendant(m,!1))}}this.switchToBuilding(b,a,this.switchToBuildingFinished)}else if(h&&h.getId()&&h.getId().toLowerCase().indexOf("building")>=0){if(j&&"floor"==j.getId())return;this.switchToBuilding(b,a,this.switchToBuildingFinished)}else if(j&&j.getId()&&j.getId().toLowerCase().indexOf("building")>=0){var p=i.getChildren();if(p&&p.size()>0){for(var q=[],l=0;l<p.size();l++){var m=p.get(l),n=this.dataManager.getCategoryForData(m);if(n&&n.getId()&&n.getId().toLowerCase().indexOf("floor")>=0){var o=this.sceneManager.dataNodeMap[m.getId()];q.push(o)}}var r=function(){for(var a=0;a<q.length;a++){var b=q[a],c=f.sceneManager.getNodeData(b);g!=c&&b&&f.box.getDataById(b.getId())&&(f.box.removeByDescendant(b),f.bindingBuildingAndFloorVisibleManager.setVisible(c,!1))}};h&&h.getId().toLowerCase().indexOf("datacenter")>=0?this.hideFloorAnimate(q,a,r):(r(),this.sceneManager.viewManager3d.defaultMaterialFilter.removeByDescendant(i))}}}},bindingBuildingAndFloor:function(a,b,c,d){this.stopAllAnimate();var e=this.dataManager._categoryDatas.floor;if(a&&a.getCategoryId()&&"datacenter"==a.getCategoryId().toLowerCase()){if(e)for(var f in e){var g=e[f];(!d||g&&g!=d&&g.getParentId()!=d.getParentId())&&this.bindingBuildingAndFloorVisibleManager.setVisibleByDescendant(g,!1)}}else if(this.bindingBuildingAndFloorVisibleManager.clear(),e)for(var f in e){var g=e[f],h=this.sceneManager.getNodeByDataOrId(g);h&&(h.orgScale&&(h.setScale(h.orgScale.clone()),h==this.sceneManager._currentRootNode&&this.afterLoadFloor&&this.afterLoadFloor(h)),h.orgPosY&&h.setPositionY(h.orgPosY))}},showFloorAnimate:function(a,b,c,d,e){if(a||!(a.length<1)){var f=this,g=(this.sceneManager.getNodeData(b),this.sceneManager.viewManager3d.getDefaultEventHandler()),h=this.sceneManager.getNodeData(c),i=null;if(h&&(i=this.sceneManager.getSceneAndRootByData(h)),i&&i.scene&&i.scene.getCategoryId().toLowerCase().indexOf("floor")>=0);else{var j=new mono.Animate({from:0,to:1,dur:1e3,delay:0,easing:"elasticOut",onUpdate:function(b){for(var c=a.length-1;c>=0;c--){var d=a[c],e=f.sceneManager.getNodeData(d),g=parseFloat(e.getPosition().y/10);d.setY(g+50*b)}},onStop:function(){f.animates&&f.animates.length>0&&(f.animates=[]),d&&d(b)}}),k=function(){if(e&&e(),f.sceneChangeWithOutAnimate)for(var b=a.length-1;b>=0;b--){var c=a[b],d=f.sceneManager.getNodeData(c),g=parseFloat(d.getPosition().y/10);c.setY(g+50)}else j.play()};this.animates.push(j),a&&a.length>1?this.isMoveCameraBeforeLaunchFloor?(g.moveCameraForLookAtNodes(a,k,30),this.sceneManager.viewManager3d.clearVisibleMap()):setTimeout(function(){k()},100):g.moveCameraForLookAtNode(b,k)}}},hideFloorAnimate:function(a,b,c){if(!a&&a.length<1)return void(c&&c());this.doubliClickFloorNodeAnimate&&this.doubliClickFloorNodeAnimate.stop(),this.sceneManager.viewManager3d.getDefaultEventHandler().lookAtWithOutMoveCamera=!1;var d=this.sceneManager.getNodeData(b);d&&(this.sceneManager.viewManager3d.defaultMaterialFilter.add(d),this.sceneManager.network3d.dirtyNetwork());var e=this,f=new mono.Animate({from:0,to:1,dur:1e3,easing:"easeOut",onUpdate:function(b){for(var c=a.length-1;c>=0;c--){var d=a[c],f=e.sceneManager.getNodeData(d);if(!f)return;var g=parseFloat(f.getPosition().y/10)+50;d.setY(g-50*b)}},onStop:function(){c&&c(),e.sceneManager.viewManager3d.defaultMaterialFilter.clearAll(),e.sceneManager.network3d.dirtyNetwork(),e.animates&&e.animates.length>0&&(e.animates=[])}});this.animates.push(f),f.play()},getFloorScaleByBuildingNodeAndFloorNode:function(a,b){if(!a||!b)return null;var d=c.Util.getBoundingBox(a),e=c.Util.getBoundingBox(b),f=.1,g=.1;if(d&&e){var h=d.size(),i=e.size();h&&i&&(h.x&&h.x!=-(1/0)&&h.x!=1/0&&i.x!=-(1/0)&&i.x!=1/0&&(f=h.x/i.x),h.z&&h.z!=-(1/0)&&h.z!=1/0&&i.z!=-(1/0)&&i.z!=1/0&&(g=h.z/i.z))}var j=f>g?g:f;return new mono.Vec3(j,1,j)},isIntoFloor:function(){return!0},shouldDoubliClickFloorNode:function(a){return!0},switchToBuilding:function(a,b,c){if(a){var d=this.sceneManager.getNodeData(a);if(d){var e=(a.getWorldPosition(),a.getScale()),f=d.getChildren();if(f&&!(f.size()<1)){var g=this,h=[],i=1,j=1;if(f&&f.size()>0){for(var k=0;k<f.size();k++){var l=f.get(k),m=this.sceneManager.dataManager.getCategoryForData(l);if(m&&m.getId()&&m.getId().toLowerCase().indexOf("floor")>=0){var n=this.sceneManager.dataNodeMap[l.getId()];if(n){n.orgScale||(n.orgScale=n.getScale().clone()),n.orgPosY||(n.orgPosY=n.getPositionY());var o=this.getFloorScaleByBuildingNodeAndFloorNode(a,n)||new mono.Vec3(.1,.1,.1);i>o.z&&(i=o.z),j>o.x&&(j=o.x),n.setPositionY(l.getPosition().y/10),this.sceneManager.viewManager3d.defaultMaterialFilter.removeByDescendant(l),delete this.doubleClickFloorNodeFlag,n.doubliClick=function(a,b,c,d,e){g.shouldDoubliClickFloorNode(c)&&g.b2fHandle.doubliClickFloorNode(a,b,c,d,e)},h.push(n)}}}if(h.length<1)return void this.sceneManager.viewManager3d.defaultMaterialFilter.clear();for(var k=h.length-1;k>=0;k--)h[k].setScale(j*e.x,j>.1?j:.1,i*e.z);var p=function(){g.sceneManager.viewManager3d.defaultMaterialFilter.addByDescendant(d);for(var b=0;b<h.length;b++){var c=g.sceneManager.getNodeData(h[b]);g.sceneManager.viewManager3d.defaultMaterialFilter.removeByDescendant(c)}if(g.sceneManager.network3d.dirtyNetwork(),g.bindingBuildingAndFloorVisibleManager&&h.length>0)for(var b=0;b<h.length;b++){var e=g.sceneManager.getNodeData(h[b]);g.bindingBuildingAndFloorVisibleManager.setVisibleByDescendant(e,!0)}g.afterLookAtBuildingFunction&&g.afterLookAtBuildingFunction(a,h)},q=function(){if(c&&c(),1==h.length&&g.isIntoFloor()&&g.shouldDoubliClickFloorNode(a)){var a=g.sceneManager.getNodeData(h[0]);g.b2fHandle.doubliClickFloorNode(h[0],g.sceneManager.network3d,a,null,null)}};this.sceneManager.viewManager3d.defaultMaterialFilter.clear(),this.showFloorAnimate(h,a,b,q,p)}}}}}}),c.BuidingAndFloorChangeAdapter=G,$PropertyChangeAdaperManager=function(a){this.sceneManager=a,this.changeAdapterList=new mono.List,this.defaultFocuseAdaper=new $ComplexNodeAndSimpleNodeChangeAdapter(a),this.buildAndFloorAdaper=new G(a),this.init()},mono.extend($PropertyChangeAdaperManager,Object,{init:function(){var a=this;this.sceneManager.viewManager3d.addPropertyChangeListener(function(b){var c=a.sceneManager.getCurrentScene();if(b&&"focusNode"==b.property&&(!c||"earth"!=c.getId())){var d=b.newValue;d&&a.sceneManager.loadLazyChildren(d)}a.focusChange(b)}),this.register(this.defaultFocuseAdaper),this.register(this.buildAndFloorAdaper)},focusChange:function(a){var b=this;if(a&&"focusNode"==a.property){var d=a.oldValue,e=a.newValue;if(d){var f=d.getClient("simpleNode"),g=d.getClient("complexNode");if(f&&(g&&"unload"!=g&&g.getParent()==d||f.getParent()!=d)&&!b.isChild(d,e))for(var h=0;h<b.changeAdapterList.size();h++){var i=b.changeAdapterList.get(h);i&&i instanceof c.BaseFocuseChangeAdapeter&&i.realToFake(d,e)}}if(e){b.fakeToRealForParent(e);var g=e.getClient("complexNode"),f=e.getClient("simpleNode"),j=b.sceneManager.getNodeData(e);"unload"==g?b.sceneManager.loadComplexNode(j,function(a){b._doFakeToReal(a,f,d,e)}):b._doFakeToReal(g,f,d,e)}for(var h=0;h<b.changeAdapterList.size();h++){var i=b.changeAdapterList.get(h);i&&i instanceof c.BaseFocuseChangeAdapeter&&i.focusNodeChange(d,e)}}},_doFakeToReal:function(a,b,d,e){if(a&&(a.getParent()!=e||b&&b.getParent()==e))for(var b=e.getClient("simpleNode"),f=0;f<this.changeAdapterList.size();f++){var g=this.changeAdapterList.get(f);g&&g instanceof c.BaseFocuseChangeAdapeter&&g.fakeToReal(d,e)}},fakeToRealForParent:function(a){var b=this.sceneManager.getNodeData(a),c=this;if(b&&b.getParentId&&b.getParentId()){var d=this.sceneManager.dataManager.getDataById(b.getParentId());if(d&&this.sceneManager.isCurrentSceneInstance(d)){var e=this.sceneManager.getNodeByDataOrId(d);if(!e)return;this.fakeToRealForParent.call(this,e);var f=e.getClient("complexNode"),g=e.getClient("simpleNode");"unload"==f?c.sceneManager.loadComplexNode(d,function(a){c._doFakeToReal(a,g,null,e)}):f&&f.getParent()!=e&&c._doFakeToReal(f,g,null,e)}}},isChild:function(a,b,c){if(c=c||this,!a||!b)return!1;var d=a;if(a instanceof mono.Element&&(d=c.sceneManager.getNodeData(a)),!d)return!1;var e=b;if(b instanceof mono.Element&&(e=c.sceneManager.getNodeData(b)),!(e&&e instanceof g))return!1;var f=c.sceneManager.getSceneFromData(d),h=c.sceneManager.getSceneFromData(e);if(!f&&h||f&&!h||f!=h)return!1;if(e.getParentId()&&e.getParentId()===d.getId())return!0;var i=c.sceneManager.dataManager.getDataById(e.getParentId());return c.isChild(d,i,c)},register:function(a){a&&(this.changeAdapterList.contains(a)||(a.startInit(),this.changeAdapterList.add(a)))},deregister:function(a){a&&this.changeAdapterList.contains(a)&&(this.changeAdapterList.remove(a),a.destroy())}}),c.PropertyChangeAdaperManager=$PropertyChangeAdaperManager;var H=function(a,b){c.BaseFocuseChangeAdapeter.call(this,a),this.spaceManager=b,this.box=this.sceneManager.network3d.getDataBox()};mono.extend(H,c.BaseFocuseChangeAdapeter,{realToFake:function(a,b){var c=!1,d=null,e=a.getChildren().toArray(),f=this.sceneManager.getNodeData(a);for(j=0;j<e.length;j++){var g=e[j];if(this.spaceManager.isSpaceChildrenNode(g))this.box.removeByDescendant(g),g.setParent(null),c=!0;else{var h=this.sceneManager.getNodeData(g),i=this.sceneManager.dataManager.getCategoryForData(h);f!=h&&(!i||i.getId().toLowerCase().indexOf("rack")<0)&&this.box.removeByDescendant(g)}this.spaceManager.isSpaceNode(g)&&(d=g)}if(c){var k=a.getClient("complexNode"),l=a.getClient("simpleNode");this.box.removeByDescendant(k),this.box.removeByDescendant(l),d&&this.box.addByDescendant(d)}},fakeToReal:function(a,b){var c=this,d=this.sceneManager.getNodeData(b);if(d){var e=!1,f=b.getChildren().toArray();for(j=0;j<f.length;j++){var g=f[j];this.spaceManager.isSpaceNode(g)&&(this.box.removeByDescendant(g),e=!0)}if(e){var h=b.getClient("complexNode");h?this.box.addByDescendant(h):this.box.addByDescendant(b,function(a){return c.spaceManager.isSpaceNode(a)?!1:!0});var i=this.spaceManager.create1DChildrenSpaceNodes(d);for(j=0;j<i.length;j++)spaceChildNode=i[j],spaceChildNode.setParent(b),this.box.addByDescendant(spaceChildNode)}}}}),c.SpaceAdapter=H,c.PowerCapacityManager=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.visibleManager=new J(this.sceneManager),this.sceneManager.viewManager3d.addVisibleFilter(this.visibleManager)},mono.extend(c.PowerCapacityManager,Object,{computePowerPercent:function(a){var b=this.dataManager,c=a;c.getId||(c=b.getDataById(a));var d=b.getDataTypeForData(c);if(d){var e=d.getPowerRating();if(null==e||0==e)return null;var f,g=0,h=c.getChildren();return h.forEach(function(a){f=a.getPower()||0,g+=f}),g/e}},createPowerNode:function(a){var b=this.sceneManager,c=this.dataManager,d=a,e=b.network3d.getDataBox();if(b.isCurrentSceneInstance(a)){d.getId||(d=c.getDataById(a));var f=this.computePowerPercent(a);if(null!=f){var g,h=b.getNodeByDataOrId(d),i=h.getBoundingBox(),j=i.size(),k=j.x,l=j.y,m=j.z,n=h.getClient("powerNode");f=f||.01,n||(n=new mono.Cube(k-.2,l,m-.2),g=new mono.Cube(k,l,m),g.setParent(n),n.s({"m.type":"phong"}),g.s({"m.wireframe":!0,"m.wireframeLinewidth":1,"m.color":"white"}),n.setClient("child",g));var o=this.getPowerNodeColor(f);return n.s({"m.color":o,"m.ambient":o,"m.specularStrength":30}),n.setParent(h),n.setScale(1,f,1),n.setY(l*f/2-l/2+5),n.setClient("powerChildNode",!0),
h.setClient("powerNode",n),n.setClient("it_data","power"),e.addByDescendant(n),this.makeItDataUnvisible(d),n}}},makeItDataUnvisible:function(a){if(a){this.visibleManager.setVisible(a,!1);var b=this;a.getChildren().forEach(function(a){b.makeItDataUnvisible(a)})}},makeItDataVisible:function(a){if(a){this.visibleManager.setVisible(a,!0);var b=this;a.getChildren().forEach(function(a){b.makeItDataVisible(a)})}},removePowerNode:function(a){var b=this.sceneManager,c=this.dataManager,d=a,e=b.network3d.getDataBox();d.getId||(d=c.getDataById(a));var f=b.getNodeByDataOrId(a);if(f){var g=f.getClient("powerNode");g&&(g.setParent(null),e.removeByDescendant(g)),this.makeItDataVisible(d)}},getPowerNodeColor:function(a){if(this.powerNodeColorFunction){var b=this.powerNodeColorFunction(a);return b}var b;return b=.25>a?"green":a>=.25&&.75>=a?"orange":"red"},isPowerAvailabe:function(){}}),c.WeightCapacityManager=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.visibleManager=new J(this.sceneManager),this.sceneManager.viewManager3d.addVisibleFilter(this.visibleManager)},mono.extend(c.WeightCapacityManager,Object,{computeWeightPercent:function(a){var b=this.dataManager,c=a;c.getId||(c=b.getDataById(a));var d=b.getDataTypeForData(c);if(d){var e=d.getWeightRating();if(null==e||0==e)return null;var f=this.computeChildrenWeight(c);return f/e}},computeChildrenWeight:function(a){var b=this.dataManager,c=this,d=a;d.getId||(d=b.getDataById(a));var e,f=0,g=d.getChildren();return g.forEach(function(a){e=a.getWeight()||0,f+=e;var b=a.getChildren();b&&b.size()>0&&(f+=c.computeChildrenWeight(a))}),f},createWeightNode:function(a){var b=this.sceneManager,c=this.dataManager,d=a,e=b.network3d.getDataBox();if(b.isCurrentSceneInstance(a)){d.getId||(d=c.getDataById(a));var f=b.getNodeByDataOrId(d),g=this.computeWeightPercent(d);if(null!=g){d._weightPercent=g;var h,i=f.getBoundingBox(),j=i.size(),k=j.x,l=j.y,m=j.z,n=f.getClient("weightNode");g=g||.01,n||(n=new mono.Cube(k-.2,l,m-.2),h=new mono.Cube(k,l,m),h.setParent(n),n.s({"m.type":"phong"}),h.s({"m.wireframe":!0,"m.wireframeLinewidth":1,"m.color":"white"}),n.setClient("child",h));var o=this.getWeightNodeColor(g);return n.s({"m.color":o,"m.ambient":o,"m.specularStrength":30}),n.setParent(f),n.setScale(1,g,1),n.setY(l*g/2-l/2+5),n.setClient("weightChildNode",!0),f.setClient("weightNode",n),n.setClient("it_data","weight"),e.addByDescendant(n),this.makeItDataUnvisible(d),n}}},makeItDataUnvisible:function(a){if(a){this.visibleManager.setVisible(a,!1);var b=this;a.getChildren().forEach(function(a){b.makeItDataUnvisible(a)})}},makeItDataVisible:function(a){if(a){this.visibleManager.setVisible(a,!0);var b=this;a.getChildren().forEach(function(a){b.makeItDataVisible(a)})}},removeWeightNode:function(a){var b=this.sceneManager,c=this.dataManager,d=a,e=b.network3d.getDataBox();d.getId||(d=c.getDataById(a)),delete d._weightPercent;var f=b.getNodeByDataOrId(a);if(f){var g=f.getClient("weightNode");g&&(g.setParent(null),e.removeByDescendant(g)),this.makeItDataVisible(d)}},getWeightNodeColor:function(a){if(this.weightNodeColorFunction){var b=this.weightNodeColorFunction(a);return b}var b;return b=.25>a?"green":a>=.25&&.75>=a?"orange":"red"},isWeightAvailabe:function(){}}),c.CameraFollow=function(a){function b(b,c){var d=b.property;if(d.startsWith("position")||d.startsWith("rotation")){var e=c.p(),f=a.getDistance(),g=c.worldPosition(new mono.Vec3(-2,1,0),f);a.lookAt(e),a.setPosition(g)}}this.setHost=function(c){a._hostNode&&a._hostNode.removePropertyChangeListener(b),a._hostNode=c,c.addPropertyChangeListener(function(a){b(a,c)})}},c.InspectionManager=function(a){c.EventHandler.call(this),this.sceneManager=a,this.visibleManager=new c.VisibleManager(a),a.viewManager3d.addVisibleFilter(this.visibleManager),this.dataManager=this.sceneManager.dataManager,this.camera=this.sceneManager.network3d.getCamera(),this.box=this.sceneManager.network3d.getDataBox(),this.status=c.InspectionManager.STATUS_READY,this.host=null,this.path=[],this.animates=[],this.loop=!1,this.finalAngle=null,this.limitDistance=200,this.limitAngle=40,this.inspectDataArray=[],this.inspectDataMap={},this.currentInspectDataArray=[],this.currentInspectingDataMap={},this.inspectColor="orange",this.moveSpeed=10,this.rotateSpeed=400,this.showTrail=!0,this.trailColor="green",this.trailWidth=20,this.trailHeight=3,this.hideDataMap={},this.isCameraFollow=!0,this.cameraFollow=null},c.InspectionManager.STATUS_READY="ready",c.InspectionManager.STATUS_PLAYING="playing",c.InspectionManager.STATUS_PAUSE="pause",c.InspectionManager.STATUS_STOP="stop",mono.extend(c.InspectionManager,c.EventHandler,{renderDataHandle:function(a){},resetDataHandler:function(a){},createTrail:function(a,b,c,d){var e=new mono.Path;e.moveTo(a[0][0],a[0][1]);for(var f=1;f<a.length;f++)e.lineTo(a[f][0],a[f][1]);e=mono.PathNode.prototype.adjustPath(e,20),b=b||this.trailWidth,c=c||this.trailHeight,d=d||this.trailColor;var g=new mono.PathCube(e,b,c);return g.s({"m.type":"phong","m.specularStrength":30,"m.color":d,"m.ambient":d,"m.texture.repeat":new mono.Vec2(150,1)}),g.setRotationX(Math.PI),g.setPositionY(c/2+4),g.setClient("type","trail"),g},play:function(){return this.isPlaying()?void console.warn("it is already playing"):this.isPause()?void console.warn("status is pause, you should call resume function"):(this.startPlay(),void(this.status=c.InspectionManager.STATUS_PLAYING))},pause:function(){if(this.isPlaying()){var a=this.getCurrentAnimate();a.pause(),this.status=c.InspectionManager.STATUS_PAUSE}else console.warn("when inspection status is playing, you can pause inspection")},resume:function(){if(this.isPause()){var a=this.getCurrentAnimate();a.resume(),this.status=c.InspectionManager.STATUS_PLAYING}else console.warn("when inspection status is pause, you can resume inspection")},stop:function(a){if(this.isPlaying()||this.isPause()){if(!a){var b=this.getCurrentAnimate();b.stop()}this.resetHideData(),this.resetInspectData(),this.onFinish(),this.trail&&this.box.remove(this.trail),delete this.animates,delete this.trail,delete this.host.animate,this.status=c.InspectionManager.STATUS_STOP}else console.warn("inspection is not started")},setPath:function(a){this.path=a},setHost:function(a){this.host=a},isReady:function(){return this.status==c.InspectionManager.STATUS_READY},isPlaying:function(){return this.status==c.InspectionManager.STATUS_PLAYING},isPause:function(){return this.status==c.InspectionManager.STATUS_PAUSE},isStop:function(){return this.status==c.InspectionManager.STATUS_STOP},onFinish:function(){console.log("inspection is completed")},startPlay:function(){var a=this,b=(this.sceneManager,this.camera),d=this.box;this.initInspectData();var e=this.host;if(this.isCameraFollow){var f=this.cameraFollow||new c.CameraFollow(b);f.setHost(e)}var g=this.path;e.setPositionX(g[0][0]),e.setPositionZ(g[0][1]);var h=this.animates=this.createPathAnimates(b,e,g,this.loop,this.finalAngle);h[h.length-1].onDone=function(){a.stop(!0)},this.hideData(),this.showTrail&&(a.createTrail&&(this.trail=a.createTrail(this.path)),this.trail&&(this.trail.setParent(this.host.getParent()),d.add(this.trail))),e.animate=h[0],e.animate.play()},hideData:function(){var a=this,b=Object.keys(this.hideDataMap);b.forEach(function(b){var c=a.hideDataMap[b];a.visibleManager.setVisible(c,!1)})},resetHideData:function(){var a=this,b=Object.keys(this.hideDataMap);b.forEach(function(b){var c=a.hideDataMap[b];a.visibleManager.setVisible(c,!0)})},initInspectData:function(){this.inspectDataArray=[],this.inspectDataMap={},this.hideDataMap={},this.box.getNodes().forEach(function(a){var b=this.sceneManager.getNodeData(a);b&&!this.inspectDataMap[b.getId()]&&this.isInspect(b)&&(this.initDataPositionAndRotation(b),this.inspectDataMap[b.getId()]=b,this.inspectDataArray.push(b)),b&&!this.hideDataMap[b.getId()]&&this.isHideInInspection(b)&&(this.hideDataMap[b.getId()]=b)},this)},getCurrentAnimate:function(){return this.host?this.host.animate:null},createPathAnimates:function(a,c,d,e,f){var g=[],h=this.moveSpeed||10,i=this.rotateSpeed||400;if(d&&d.length>=2){for(var j=c.getRotationY()||0,k=1;k<d.length;k++){var l=d[k-1],m=d[k],n=l[0],o=l[1],p=m[0],q=m[1],r=Math.atan2(-(q-o),p-n)||0,s=this.createRotateAnimate(a,c,i,r,j);s&&(g.push(s),j=s.toAngle);var t=this.createMoveAnimate(a,c,h,n,o,p,q);g.push(t),n=p,o=q}if(f!=b&&j!=f){var s=this.createRotateAnimate(a,c,i,f,j);s&&g.push(s)}}for(var u,k=0;k<g.length;k++)k>0?(g[k-1].chain(g[k]),e&&k==g.length-1&&g[k].chain(u)):u=g[k];return g},createMoveAnimate:function(a,b,c,d,e,f,g){var h=this,i=new mono.Animate({from:{x:d,y:e},to:{x:f,y:g},type:"point",dur:Math.sqrt((f-d)*(f-d)+(g-e)*(g-e))*c,easing:"easeNone",onPlay:function(){b.animate=this,h.currentInspectDataArray=h.getCurrentInspectionData(this),h.resetInspectData()},onUpdate:function(a){b.setPositionX(a.x),b.setPositionZ(a.y),h.renderInspectData()}});return i},createRotateAnimate:function(a,c,d,e,f){if(f=parseFloat(f),e=parseFloat(e),f===b||null===f||isNaN(f)||e===b||null===f||isNaN(e)||e==f)return null;e-f>Math.PI&&(e-=2*Math.PI),e-f<-Math.PI&&(e+=2*Math.PI);var g=new mono.Animate({from:f,to:e,type:"number",dur:Math.abs(e-f)*d,easing:"easeNone",onPlay:function(){c.animate=this},onUpdate:function(a){a=a||0,c.setRotationY(a)}});return g.toAngle=e,g},renderData:function(a){if(!a._inspected){a._inspected=!0;var b=this.sceneManager.getNodeByDataOrId(a);b.getClient("complexNode")&&(b="unload"!=b.getClient("complexNode")&&b.getClient("complexNode").getParent()?b.getClient("complexNode"):b.getClient("simpleNode"));var c=b.getStyle("inspection.m.ambient")||b.getStyle("m.ambient");b.setStyle("m.ambient",this.inspectColor),b.setStyle("inspection.m.ambient",c),this.renderDataHandle&&this.renderDataHandle(a)}},resetData:function(a){if(a._inspected){a._inspected=!1,delete a._inspected,delete a._face2animateLine,delete a._distance2host;var b=this.sceneManager.getNodeByDataOrId(a);b.getClient("complexNode")&&(b="unload"!=b.getClient("complexNode")&&b.getClient("complexNode").getParent()?b.getClient("complexNode"):b.getClient("simpleNode")),b.setStyle("m.ambient",b.getStyle("inspection.m.ambient")),b.setStyle("inspection.m.ambient",null),this.resetDataHandler&&this.resetDataHandler(a)}},renderInspectData:function(){var a=!1,b=this,c=[];this.currentInspectDataArray.forEach(function(a){b.isClosed(a,b.host)&&c.push(a)});var d=this.filterInspectData(c),e={};d.forEach(function(a){e[a.getId()]=a}),d.forEach(function(c){b.currentInspectingDataMap[c.getId()]||(b.renderData(c),b.currentInspectingDataMap[c.getId()]=c,a=a||!0)});var f=Object.keys(this.currentInspectingDataMap);return f.length>0&&f.forEach(function(c){e[c]||(b.resetData(b.currentInspectingDataMap[c]),delete b.currentInspectingDataMap[c],a=a||!0)}),a},resetInspectData:function(){var a=this,b=Object.keys(this.currentInspectingDataMap);b.length>0&&b.forEach(function(b){a.resetData(a.currentInspectingDataMap[b]),delete a.currentInspectingDataMap[b]})},filterInspectData:function(a){if(a.length<=1)return a;var c=[];a.sort(function(a,b){return a._distance2host-b._distance2host});for(var d=0;d<a.length;d++){var e=a[d];e._face2animateLine!==b&&(this.haveSameDir(e,c)||c.push(e))}return c},haveSameDir:function(a,b){for(var c=a._face2animateLine,d=0;d<b.length;d++){var e=b[d]._face2animateLine;if(Math.abs(c-e)<45)return!0}return!1},isInspect:function(a){var b=this.dataManager.getDataTypeForData(a);if(!b)return!1;var c=b.getCategoryId();return"rack"==c||"headerRack"==c?!0:!1},isHideInInspection:function(a){var b=this.dataManager.getDataTypeForData(a);if(!b)return!1;var c=b.getCategoryId();return"channel"==c?!0:!1},getCurrentInspectionData:function(a){var b=[],c=a.from,d=a.to,e=this.getLine(c,d);return this.inspectDataArray.forEach(function(a){this.isFace2Line(a,c,d,e)&&b.push(a)},this),b},isFace2Line:function(a,b,c,d){var e=a._absolutePosition,f=e.x,g=e.z,h=a._absoluteRotation.y;if(0==d.b){var i=f-c.x;if(Math.abs(i)>this.limitDistance)return!1;var j;if(j=f>-d.c?270:90,Math.abs(h-j)>this.limitAngle)return!1;a._face2animateLine=j}else if(0==d.a){var k=g-c.y;if(Math.abs(k)>this.limitDistance)return!1;var j;if(j=g>-d.c?180:0,Math.abs(h-j)>this.limitAngle)return!1;a._face2animateLine=j}else{var l=Math.abs((d.a*f+d.b*g+d.c)/Math.sqrt(Math.pow(d.a,2)+Math.pow(d.b,2)));if(l>this.limitDistance)return!1;var m=1/d.k,j=Math.atan(m)/Math.PI*180,n=-(d.b*g+d.c)/d.a;f>n?j+=180:0>j&&(j+=360),j+=90,j%=360;var o=Math.abs(h-j);if(o>180&&(o=360-o),o>this.limitAngle)return!1;a._face2animateLine=j}return!0},isClosed:function(a,b){var c=a._absolutePosition,d=c.x,e=c.z,f=b.getPosition(),g=f.x,h=f.z,i=Math.sqrt(Math.pow(g-d,2)+Math.pow(h-e,2));return a._distance2host=i,i<this.limitDistance},getLine:function(a,b){if(a.x==b.x)return{a:1,b:0,c:-a.x};if(a.y==b.y)return{a:0,b:1,c:-a.y};var c=0,d=0,e=0,f=(a.y-b.y)/(a.x-b.x),e=a.y-f*a.x;return c=f,d=-1,{a:c,b:d,c:e,k:f}},initDataPositionAndRotation:function(a){if(!a._absolutePosition||!a._absoluteRotation){var b=this.sceneManager.getNodeByDataOrId(a),c=b.getPosition(),d=b.getRotation(),e={x:c.x,y:c.y,z:c.z},f={x:d.x,y:d.y,z:d.z},g=this.dataManager.getDataById(a.getParentId());this._initDataPositionAndRotation(g,e,f),f.x=f.x/Math.PI*180%360,f.y=f.y/Math.PI*180%360,f.z=f.z/Math.PI*180%360,a._absolutePosition=e,a._absoluteRotation=f}},_initDataPositionAndRotation:function(a,b,c){if(a){var d=this.dataManager.getDataTypeForData(a);if(!d)return void console.warn("dataType is null");var e=d.getCategoryId();if("floor"==e)return void console.warn("parent data type is floor, calculate position complete");var f=this.sceneManager.getNodeByDataOrId(a);if(f){var g=f.getPosition(),h=f.getRotation(),i=b.x,j=b.z,k=0,l=0,m=-h.y,n=(i-k)*Math.cos(m)-(j-l)*Math.sin(m)+k,o=(i-k)*Math.sin(m)+(j-l)*Math.cos(m)+l;b.x=n,b.z=o,b.x+=g.x,b.y+=g.y,b.z+=g.z,c.x+=h.x,c.y+=h.y,c.z+=h.z}var p=this.dataManager.getDataById(a.getParentId());p&&this._initDataPositionAndRotation(p,b,c)}}});var I=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.dataBox=this.sceneManager.network3d.getDataBox(),this.portNodeMap={}};mono.extend(I,Object,{removePortsByParentId:function(a){var b=this.portNodeMap[a];if(b)for(var c in b){var d=b[c];d&&(d.setParent(null),this.dataBox.remove(d))}},getAllPortsByParentId:function(a){var b=[],c=this.dataManager.getDataTypeForData(a);if(!c||!c.getTemplateDatas())return null;for(var d=c.getTemplateDatas(),e=0;e<d.length;e++){var f=d[e],g=f.getUserData("side")||0;port=this.loadPortByPortId(a,f.getId(),g),b.push(port)}return b},loadAllPortsByParentId:function(a){for(var b=this.getAllPortsByParentId(a),c=0;c<b.length;c++){var d=b[c];this.dataBox.add(d)}},loadPortByPortId:function(a,b,c){var d=this.getPortById(a,b);if(d)return d;if(d=this.createPortByPortId(a,b,c)){var e=this.portNodeMap[a];e?e[b]=d:(e={portId:d},this.portNodeMap[a]=e)}return d},getPortById:function(a,b){var c=this.portNodeMap[a];return c?c[b]:null},createPortByPortId:function(a,b,c){var d=this.dataManager.getDataTypeForData(a),e=this.sceneManager.getNodeByDataOrId(a);if(!d||!b||!e)return null;c=c||0;var f=d.getTemplateDataById(b+(c?"@true":"@false"));if(!f)return null;var g=d.getModel2dParameters()[0],h=this.dataManager.getDataTypeById(f.getDataTypeId());if(!h)return null;if(!g)return null;if(!h.getModel())return console.log("portTypes model is null!"),null;var i=make.Default.getModelDefaultParametersValues(g.id),j=make.Default.getModelDefaultParametersValues(h.getModel2d());if(!j)return console.log("port Param is null"),null;var k=this.sceneManager.loadModel(h.getModel(),h.getModelParameters(),!0,h.getId()),l=f.getPosition(),m=f.getRotation(),n=e.getBoundingBox();if(!k||!l||!i)return null;var o=i.width/n.size().x,p=i.height/n.size().y,q=(l.x+j.width/2-i.width/2)/o,r=(i.height/2-j.height/2-l.y)/p;if(1===c){var s=d.getModel2d2Parameters()[0],t=make.Default.getModelDefaultParametersValues(s.id),u=(t.width,t.height,0),v=0;q=(l.x+j.width/2+v-t.width/2)/o,r=(t.height/2-j.height/2-l.y-u)/p}if(k.setX(q),k.setY(r),1===c){k.setZ(n.min.z),k.setRotationY(Math.PI);var w=-1*q;k.setX(w)}else k.setZ(n.max.z);return m&&(m.x&&k.setRotationX(m.x*Math.PI/180),m.z&&k.setRotationZ(m.z*Math.PI/180)),k.c({parentId:a,portId:b,side:c}),k.setParent(e),k}}),c.PortManager=I,c.PortCapacityManager=function(a){c.EventHandler.call(this),this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.visibleManager=new J(this.sceneManager),this.sceneManager.viewManager3d.addVisibleFilter(this.visibleManager),this.colors=["#8A0808","#088A08","#088A85","#6A0888","#B18904"],this.padding=2.5,this.portNodes=[],this.solidColor="#eaeaea"},c.PortCapacityManager.CATEGORY_EQUIPMENT="equipment",c.PortCapacityManager.CATEGORY_PORT="port",mono.extend(c.PortCapacityManager,c.EventHandler,{computePortPercent:function(a){var b=this.dataManager,d=a;d.getId||(d=b.getDataById(a));var e=b.getDataTypeForData(d);if(e&&e.getCategoryId()==c.PortCapacityManager.CATEGORY_EQUIPMENT){var f=this.computePortInfo(d);if(!f||0==f.length)return 100;for(var g=0,h=0;h<f.length;h++){var i=f[h],j=i.getAllLinks();j&&Object.keys(j).length>0&&g++}return g/f.length*100}},computePortInfo:function(a){var b=this.dataManager,d=a;d.getId||(d=b.getDataById(a));var e=[],f=b.getChildren(d);return f.forEach(function(a){var d=b.getDataTypeForData(a);d&&d.getCategoryId()==c.PortCapacityManager.CATEGORY_PORT&&e.push(a)}),e},createPortNode:function(a,b,c,d,e,f){var g=this.sceneManager,h=this.dataManager,i=a,j=g.network3d.getDataBox();if(g.isCurrentSceneInstance(a)){i.getId||(i=h.getDataById(a));var k=this.computePortPercent(i);if(null!=k){k=Math.round(100*Math.random()),i._portPercent=k;var l=i._portNode;l||(l=new mono.Cube(b,c,d),l.setPosition(0,e,0),l.s({"m.type":"phong","m.specularStrength":50,"m.transparent":!0,"m.opacity":.6}),l.setClient("it_data","port"),l.setClient("portChildNode",!0),l.setClient("data",i),i._portNode=l);var m=this.getPortNodeColor(k);return l.s({"m.color":m,"m.ambient":m}),l.setParent(f),j.addByDescendant(l),l}}},createSolidNode:function(a,b,c,d,e){var f=this.sceneManager,g=(this.dataManager,f.network3d.getDataBox()),h=h=new mono.Cube(a,b,c);return h.setPosition(0,d,0),h.s({"m.type":"phong","m.specularStrength":50,"m.color":this.solidColor,"m.ambient":this.solidColor}),h.setClient("it_data","port_solid"),h.setClient("portChildNode_solid",!0),h.setParent(e),g.addByDescendant(h),h},makeItDataUnvisible:function(a){if(a){this.visibleManager.setVisible(a,!1);var b=this;a.getChildren().forEach(function(a){b.makeItDataUnvisible(a)})}},makeItDataVisible:function(a){if(a){this.visibleManager.setVisible(a,!0);var b=this;a.getChildren().forEach(function(a){b.makeItDataVisible(a)})}},removePortNode:function(a){var b=this.sceneManager,c=this.dataManager,d=a,e=b.network3d.getDataBox();d.getId||(d=c.getDataById(a)),delete d._portPercent;var f=d._portNode;f&&(f.setParent(null),e.removeByDescendant(f)),this.makeItDataVisible(d)},getPortNodeColor:function(a){if(this.portNodeColorFunction){var b=this.portNodeColorFunction(a);return b}var c=Math.ceil(a/20);return this.colors[c-1]},isDataSupport:function(a){var b=this.dataManager,d=b.getDataTypeForData(a);return d&&d.getCategoryId()==c.PortCapacityManager.CATEGORY_EQUIPMENT&&"network"==d.getSubType()?!0:!1},calcDataHeight:function(a){var b=this.dataManager,c=b.getDataTypeForData(a),d=c.getSize();return parseInt(d.ySize||0)*make.Default.UNIT_HEIGHT},createPortNodeInRack:function(a){var b=[],c=this.sceneManager,d=this.dataManager,e=this;if(c.isCurrentSceneInstance(a)){var f=d.getDataTypeForData(a);if(!f)return void console.warn("dataType is not exist");var g=c.getNodeByDataOrId(a);if(!g)return void console.warn("rack node is not exist");var h=f.getChildrenSize(),i=g.getBoundingBox(),j=i.size(),k=j.x,l=j.y,m=j.z;this.makeItDataUnvisible(a);var n=d.getChildren(a),o={};n.forEach(function(a){e.isDataSupport(a)&&(o[a.getLocation().y]=a)});for(var p=0,q=1;q<=h.ySize;q++)if(o[q]){var r=o[q];if(0!=p){var s=q-p,t=parseInt(s)*make.Default.UNIT_HEIGHT;t-=e.padding;var u=h.yPadding[0];u+=(p-1+s/2)*make.Default.UNIT_HEIGHT,u+=e.padding/2,u-=l/2,console.log("solid: height = "+t+"  positionY = "+u);var v=e.createSolidNode(k,t,m,u,g);v&&b.push(v),p=0}var w=d.getDataTypeForData(r),s=w.getSize().ySize,t=parseInt(s||0)*make.Default.UNIT_HEIGHT;t-=e.padding;var x=r.getLocation(),u=h.yPadding[0];u+=(x.y-1+s/2)*make.Default.UNIT_HEIGHT,u+=e.padding/2,u-=l/2,console.log("port : height = "+t+"  positionY = "+u);var v=e.createPortNode(r,k,t,m,u,g);v&&b.push(v),q--,q+=s}else if(0==p){p=q;continue}if(0!=p){var s=q-p,t=parseInt(s)*make.Default.UNIT_HEIGHT;t-=e.padding;var u=h.yPadding[0];u+=(p-1+s/2)*make.Default.UNIT_HEIGHT,u+=e.padding/2,u-=l/2,console.log("solid: height = "+t+"  positionY = "+u);var v=e.createSolidNode(k,t,m,u,g);v&&b.push(v),p=0}return a.portNodeArray=b,b}},hasChild:function(a,b){},removePortNodeInRack:function(a){var b=this.sceneManager,c=(this.dataManager,b.network3d.getDataBox());if(b.isCurrentSceneInstance(a)){var d=b.getNodeByDataOrId(a);d&&(this.makeItDataVisible(a),a.portNodeArray&&a.portNodeArray.forEach(function(a){c.remove(a)}))}}});var J=function(a){c.VisibleFilter.call(this),this.sceneManager=a,this.isDealWithFunction=null,this._vmap={}};mono.extend(J,c.VisibleFilter,{clear:function(){this._vmap={},this.sceneManager._sceneVisibleChangeDispather.fire({data:null,type:"clear"})},isDealWith:function(a){return null!=this.isDealWithFunction?this.isDealWithFunction(a):!0},getBId:function(a){return a&&a instanceof c.Data&&this.isDealWith(a)?a.getId():null},setVisible:function(a,c,d){var e=this.getBId(a);if(e){var f=this._vmap[e];if(c?delete this._vmap[e]:this._vmap[e]=!1,f==b)return;(null===d||d===b)&&(d=!0),d&&f!=c&&this.sceneManager._sceneVisibleChangeDispather.fire({data:a,value:c})}},getDataByNode:function(a){return a?this.sceneManager.getNodeData(a):null},setVisibleByDescendant:function(a,c,d){if(a&&(a instanceof mono.Element&&(a=this.getDataByNode(a)),(null===d||d===b)&&(d=!0),a&&a.getId())){this.setVisible(a,c,!1);var e=a.getChildren();if(e&&e.size()>0)for(var f=0;f<e.size();f++){var g=e.get(f);(this.getBId(g)!=this.getBId(a)||!this.getBId(g)&&!this.getBId(a))&&this.setVisibleByDescendant(g,c,!1,this)}d&&this.sceneManager._sceneVisibleChangeDispather.fire({data:a,type:"descendtant",value:c})}},isVisible:function(a,b,d){var e=null;b&&(e=b instanceof c.Data?b:this.sceneManager.dataManager.getDataById(b));var f=this.getBId(e);return a&&a.getClient(c.SceneManager.CLIENT_EXT_VISIBLE)?!0:0!=this._vmap[f]?!0:!1}}),c.VisibleManager=J,c.SData=function(a,b,d,e,f,g){c.Base.call(this),this._key="",this._isClient=!1,this._value="",this._operation="",this._clientMap={},this._style="",this.placeholder=e,this.label=d,this.inputType=b,this.inputIndex=a,this._dataType=f||"string",this._readonly=!1,g===!0&&(this._readonly=!0)},mono.extend(c.SData,c.Base,{___accessor:["key","isClient","value","operation","style","dataType"],setClient:function(a,b){a&&(this._clientMap[a]=b)},getClient:function(a){return this._clientMap[a]},toString:function(){if(!this._key||!this._value)return"";var a=this._key;this._isClient&&(a="u:"+a);var b={key:a},c="";this._value&&(c=this._value),b.value=c;var d="=";return this._operation&&(d=this._operation),b.operation=d,b.dataType=this._dataType,b}}),c.BasePanel=function(a){a||(a="base-search-panel"),this.mainPane=$('<div id="'+a+'" class="inputPane"> </div>'),this._ids=[],this.inputMap={},this.className="BasePanel",this.doClickFunction=null,this.doClearFunction=null},mono.extend(c.BasePanel,Object,{createRow:function(){return $('<div class="row"></div>')},createCol:function(a,b){return a||(a=3),b?$('<div class="without-padding col-md-'+a+" "+b+'"></div>'):$('<div class="without-padding col-md-'+a+'"></div>')},appendRow:function(a){if(a){this.mainPane.append(a);var b=this.mainPane.height();b+=27}},addQuick:function(a){if(a){this.className&&a.inputIndex&&(a.inputIndex=this.className+"_"+a.inputIndex);var b=a.inputIndex,c=a.placeholder,d=this.createRow(),e=this.createCol(12),f=$('<input type="text" class="input-min contral-width" id="'+b+'" placeholder="'+c+'">'),g=a.getStyle()||"";g&&f.attr("style",g);var h=this;f.keypress(function(a){13===a.keyCode&&h.doClick()}),e.append(f),this.inputMap[b]=f,d.append(e),this.appendRow(d),this._ids.push(a)}},validateDatePick:function(){$(".datetime-picker").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,startView:2,minView:2})},createInput:function(a){if(a){var b=a.inputIndex,c=null;a.inputType&&"date"==a.inputType.toLowerCase()?(c=$('<input id="'+b+'" class="input-min contral-width datetime-picker">'),c.datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,startView:2,minView:2})):c=$('<input id="'+b+'" class="input-min contral-width">');var d=a.getStyle()||"";return d&&c.attr("style",d),a._readonly&&c.attr("readonly","readonly"),c}},addRow:function(a,b){if(a||b){this.className&&(a&&a.inputIndex&&(a.inputIndex=this.className+"_"+a.inputIndex),b&&b.inputIndex&&(b.inputIndex=this.className+"_"+b.inputIndex));var c=this.createRow();if(a&&b){var d=a.inputIndex,e=a.label,f=this.createCol(3),g=$('<label for="'+d+'" class="inputpane-label label-min">'+e+"</label>");f.append(g),c.append(f);var h=this.createCol(4),i=this.createInput(a);this.inputMap[a.inputIndex]=i,h.append(i),c.append(h),i.keypress(function(a){13===a.keyCode&&u.doClick()}),this._ids.push(a);var j=b.inputIndex,k=b.label,l=this.createCol(1,"text-center"),m=$('<label for="'+j+'" class="inputpane-label label-min">'+k+"</label>");l.append(m),c.append(l);var n=this.createCol(4),o=this.createInput(b);this.inputMap[b.inputIndex]=o,n.append(o),c.append(n),o.keypress(function(a){13===a.keyCode&&u.doClick()}),this.appendRow(c),this._ids.push(b)}else{!a&&b&&(a=b);var p=a.inputIndex,q=a.label,r=this.createCol(3),s=this.createCol(9),g=$('<label for="'+p+'" class="inputpane-label label-min">'+q+"</label>");r.append(g),c.append(r);var t=this.createInput(a);this.inputMap[a.inputIndex]=t;var u=this;t.keypress(function(a){13===a.keyCode&&u.doClick()}),s.append(t),c.append(s),this.appendRow(c),this._ids.push(a)}}},addConstantCondition:function(a){a||this._ids.push(a)},addButtonRow:function(){var a=this.createRow(),b=this.createCol(12),c=$('<span id="btn_search_it" class="base-panel-search-btn" type="submit" title=" "> </span>'),d=$('<span id="btn_cancel_search_it" class="base-panel-search-btn" type="cancel" title=" "> </span>');b.append(d),b.append(c);var e=this;c.click(function(){e.doClick()}),d.click(function(){e.doClear()}),a.append(b),this.appendRow(a)},createSDataByObj:function(a){if(!a)return null;var b=a.inputIndex,d=a.inputType,e=a.label,f=a.placeholder,g=a.dataType,h=a.key;if(!h)return null;var i=new c.SData(b,d,e,f,g);if(i.setKey(h),i.setOperation(a.operation),a.source)if(a.source instanceof Array)i.setClient("options",a.source);else if(this[a.source]&&"function"==typeof this[a.source]){var j=this[a.source]();i.setClient("options",j)}return a.style&&i.setStyle(a.style),i},getContentPane:function(){return this.mainPane},getDataValue:function(a){if(a&&a.inputIndex){var b=a.inputIndex,c=(a.inputType,$("#"+b).val());if(a.setValue(c),a.toString())return a.toString()}return""},getInputValues:function(){if(this._ids){for(var a=[],b=0;b<this._ids.length;b++){var c=this._ids[b],d=this.getDataValue(c);d&&a.push(d)}return a}},getInputHtmlById:function(a){return this.inputMap[this.className+"_"+a]},doClick:function(){var a=this.getInputValues();this.doClickFunction&&this.doClickFunction(a)},clearInputByData:function(a,b){},clearInput:function(){if(this._ids)for(var a=0;a<this._ids.length;a++){var b=this._ids[a];if(b&&b.inputIndex){var c=b.inputIndex;this.clearInputByData(c,b),!b||!b.inputType||b.inputType.toLowerCase().indexOf("input")>=0?$("#"+c).val(""):$("#"+c).val("")}}},doClear:function(){this.clearInput(),this.doClearFunction&&this.doClearFunction()}}),c.ITSearchPanel=function(){c.BasePanel.call(this),this.init()},mono.extend(c.ITSearchPanel,c.BasePanel,{init:function(){var a=new c.SData("it_key_text",null,null,"");a.setKey("id"),a.setStyle('background: url("./css/images/insidesearch.svg") no-repeat scroll right center;background-position-x: 98%;'),this.addQuick(a),a=new c.SData("txt_location","select",""),a.setKey("location"),a.setIsClient(!0);var b=["","","",""];a.setClient("options",b),this.addRow(a),a=new c.SData("txt_type","select",""),a.setKey("userId"),a.setIsClient(!1);var b=["","1","1",""];a.setClient("options",b),this.addRow(a),a=new c.SData("txt_model","input",""),a.setKey("model"),a.setIsClient(!0),this.addRow(a),a=new c.SData("txt_manu","input",""),a.setKey("userId"),a.setIsClient(!0),this.addRow(a),a=new c.SData("txt_Type","input",""),a.setKey("userId"),a.setIsClient(!0),this.addRow(a),this.addRow(a),this.addButtonRow()},createInput:function(a){if(a&&a.inputType){var b=a.inputType,c=a.inputIndex;if(b.toLowerCase().indexOf("select")>=0){var d=$('<select id="'+c+'" class="input-min contral-width"></select>'),e=a.getClient("options");if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=e[f],h=$('<option value="'+g+'" class="input-min">'+g+"</option>");d.append(h)}return this.inputMap[c]=d,d}}return this.constructor.superClass.createInput(a)}}),c.SpaceSearchPanel=function(){c.BasePanel.call(this),this.className="SpaceSearchPanel",this.init()},mono.extend(c.SpaceSearchPanel,c.BasePanel,{init:function(){var a=new c.SData("U_ID","input","U");a.setKey("dyna_user_data_maxSerSpace"),a.setIsClient(!0),a.setOperation(">="),a.setDataType("number"),this.addRow(a),this.addButtonRow()},getUNumber:function(){return $("#"+this.className+"_U_ID").val()}}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(b,c){if(!b.jstree){var d,e,f=0,g=!1,h=!1,i=!1,j=[],k=b("script:last").attr("src"),l=a.document,m=l.createElement("LI");m.setAttribute("role","treeitem"),d=l.createElement("I"),d.className="jstree-icon jstree-ocl",d.setAttribute("role","presentation"),m.appendChild(d),d=l.createElement("A"),d.className="jstree-anchor",d.setAttribute("href","#"),d.setAttribute("tabindex","-1"),e=l.createElement("I"),e.className="jstree-icon jstree-themeicon",e.setAttribute("role","presentation"),d.appendChild(e),m.appendChild(d),d=e=null,b.jstree={version:"3.1.1",defaults:{plugins:[]},plugins:{},path:k&&-1!==k.indexOf("/")?k.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g},b.jstree.create=function(a,c){var d=new b.jstree.core(++f),e=c;return c=b.extend(!0,{},b.jstree.defaults,c),e&&e.plugins&&(c.plugins=e.plugins),b.each(c.plugins,function(a,b){"core"!==a&&(d=d.plugin(b,c[b]))}),b(a).data("jstree",d),d.init(a,c),d},b.jstree.destroy=function(){b(".jstree:jstree").jstree("destroy"),b(l).off(".jstree")},b.jstree.core=function(a){this._id=a,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},b.jstree.reference=function(a){var c=null,d=null;if(!a||!a.id||a.tagName&&a.nodeType||(a=a.id),!d||!d.length)try{d=b(a)}catch(e){}if(!d||!d.length)try{d=b("#"+a.replace(b.jstree.idregex,"\\$&"))}catch(e){}return d&&d.length&&(d=d.closest(".jstree")).length&&(d=d.data("jstree"))?c=d:b(".jstree").each(function(){var d=b(this).data("jstree");return d&&d._model.data[a]?(c=d,!1):void 0}),c},b.fn.jstree=function(a){var d="string"==typeof a,e=Array.prototype.slice.call(arguments,1),f=null;return a!==!0||this.length?(this.each(function(){var g=b.jstree.reference(this),h=d&&g?g[a]:null;return f=d&&h?h.apply(g,e):null,g||d||a!==c&&!b.isPlainObject(a)||b.jstree.create(this,a),(g&&!d||a===!0)&&(f=g||!1),null!==f&&f!==c?!1:void 0}),null!==f&&f!==c?f:this):!1},b.expr[":"].jstree=b.expr.createPseudo(function(a){return function(a){return b(a).hasClass("jstree")&&b(a).data("jstree")!==c}}),b.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:b.noop,
animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},b.jstree.core.prototype={plugin:function(a,c){var d=b.jstree.plugins[a];return d?(this._data[a]={},d.prototype=this,new d(c,this)):this},init:function(a,c){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=b(a).addClass("jstree jstree-"+this._id),this.settings=c,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(b){if(this._wrk)try{a.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(c){}b||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var c="",d=null,e=0;this.element.on("dblclick.jstree",function(){if(l.selection&&l.selection.empty)l.selection.empty();else if(a.getSelection){var b=a.getSelection();try{b.removeAllRanges(),b.collapse()}catch(c){}}}).on("mousedown.jstree",b.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),e=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",b.proxy(function(a){this.toggle_node(a.target)},this)).on("dblclick.jstree",".jstree-anchor",b.proxy(function(a){this.settings.core.dblclick_toggle&&this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",b.proxy(function(a){a.preventDefault(),a.currentTarget!==l.activeElement&&b(a.currentTarget).focus(),this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",b.proxy(function(a){if("INPUT"===a.target.tagName)return!0;if(32!==a.which&&13!==a.which&&(a.shiftKey||a.ctrlKey||a.altKey||a.metaKey))return!0;var c=null;switch(this._data.core.rtl&&(37===a.which?a.which=39:39===a.which&&(a.which=37)),a.which){case 32:a.ctrlKey&&(a.type="click",b(a.currentTarget).trigger(a));break;case 13:a.type="click",b(a.currentTarget).trigger(a);break;case 37:a.preventDefault(),this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(c=this.get_parent(a.currentTarget),c&&"#"!==c.id&&this.get_node(c,!0).children(".jstree-anchor").focus());break;case 38:a.preventDefault(),c=this.get_prev_dom(a.currentTarget),c&&c.length&&c.children(".jstree-anchor").focus();break;case 39:a.preventDefault(),this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):this.is_open(a.currentTarget)&&(c=this.get_node(a.currentTarget,!0).children(".jstree-children")[0],c&&b(this._firstChild(c)).children(".jstree-anchor").focus());break;case 40:a.preventDefault(),c=this.get_next_dom(a.currentTarget),c&&c.length&&c.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:a.preventDefault(),c=this._firstChild(this.get_container_ul()[0]),c&&b(c).children(".jstree-anchor").filter(":visible").focus();break;case 35:a.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",b.proxy(function(a,c){c.status&&("#"!==c.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(b.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var a,c,d=[];for(a=0,c=this._data.core.selected.length;c>a;a++)d=d.concat(this._model.data[this._data.core.selected[a]].parents);for(d=b.vakata.array_unique(d),a=0,c=d.length;c>a;a++)this.open_node(d[a],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",b.proxy(function(a){if("INPUT"===a.target.tagName)return!0;d&&clearTimeout(d),d=setTimeout(function(){c=""},500);var e=String.fromCharCode(a.which).toLowerCase(),f=this.element.find(".jstree-anchor").filter(":visible"),g=f.index(l.activeElement)||0,h=!1;if(c+=e,c.length>1){if(f.slice(g).each(b.proxy(function(a,d){return 0===b(d).text().toLowerCase().indexOf(c)?(b(d).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g).each(b.proxy(function(a,d){return 0===b(d).text().toLowerCase().indexOf(c)?(b(d).focus(),h=!0,!1):void 0},this)),h)return}if(new RegExp("^"+e+"+$").test(c)){if(f.slice(g+1).each(b.proxy(function(a,c){return b(c).text().toLowerCase().charAt(0)===e?(b(c).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g+1).each(b.proxy(function(a,c){return b(c).text().toLowerCase().charAt(0)===e?(b(c).focus(),h=!0,!1):void 0},this)),h)return}},this)).on("init.jstree",b.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots,this._data.core.themes.stripes=a.stripes,this._data.core.themes.icons=a.icons,this.set_theme(a.name||"default",a.url),this.set_theme_variant(a.variant)},this)).on("loading.jstree",b.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",b.proxy(function(a){this._data.core.focused=null,b(a.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",b.proxy(function(a){var c=this.get_node(a.currentTarget);c&&c.id&&(this._data.core.focused=c.id),this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave(),b(a.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",b.proxy(function(){if(+new Date-e>500&&!this._data.core.focused){e=0;var a=this.get_node(this.element.attr("aria-activedescendant"),!0);a&&a.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",b.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",b.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),b(l).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={}),b.instance=this,this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(a){var c=this.settings.core.strings;return b.isFunction(c)?c.call(this,a):c&&c[a]?c[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,c){a&&a.id&&(a=a.id);var d;try{if(this._model.data[a])a=this._model.data[a];else if("string"==typeof a&&this._model.data[a.replace(/^#/,"")])a=this._model.data[a.replace(/^#/,"")];else if("string"==typeof a&&(d=b("#"+a.replace(b.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[d.closest(".jstree-node").attr("id")])a=this._model.data[d.closest(".jstree-node").attr("id")];else if((d=b(a,this.element)).length&&this._model.data[d.closest(".jstree-node").attr("id")])a=this._model.data[d.closest(".jstree-node").attr("id")];else{if(!(d=b(a,this.element)).length||!d.hasClass("jstree"))return!1;a=this._model.data["#"]}return c&&(a="#"===a.id?this.element:b("#"+a.id.replace(b.jstree.idregex,"\\$&"),this.element)),a}catch(e){return!1}},get_path:function(a,b,c){if(a=a.parents?a:this.get_node(a),!a||"#"===a.id||!a.parents)return!1;var d,e,f=[];for(f.push(c?a.id:a.text),d=0,e=a.parents.length;e>d;d++)f.push(c?a.parents[d]:this.get_text(a.parents[d]));return f=f.reverse().slice(1),b?f.join(b):f},get_next_dom:function(a,c){var d;if(a=this.get_node(a,!0),a[0]===this.element[0]){for(d=this._firstChild(this.get_container_ul()[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);return d?b(d):!1}if(!a||!a.length)return!1;if(c){d=a[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return d?b(d):!1}if(a.hasClass("jstree-open")){for(d=this._firstChild(a.children(".jstree-children")[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);if(null!==d)return b(d)}d=a[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return null!==d?b(d):a.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(a,c){var d;if(a=this.get_node(a,!0),a[0]===this.element[0]){for(d=this.get_container_ul()[0].lastChild;d&&0===d.offsetHeight;)d=this._previousSibling(d);return d?b(d):!1}if(!a||!a.length)return!1;if(c){d=a[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);return d?b(d):!1}d=a[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);if(null!==d){for(a=b(d);a.hasClass("jstree-open");)a=a.children(".jstree-children").first().children(".jstree-node:visible:last");return a}return d=a[0].parentNode.parentNode,d&&d.className&&-1!==d.className.indexOf("jstree-node")?b(d):!1},get_parent:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){return a=this.get_node(a,!0),a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):a&&a.length?a.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(a){return a=this.get_node(a),a&&(a.state.loaded===!1||a.children.length>0)},is_loaded:function(a){return a=this.get_node(a),a&&a.state.loaded},is_loading:function(a){return a=this.get_node(a),a&&a.state&&a.state.loading},is_open:function(a){return a=this.get_node(a),a&&a.state.opened},is_closed:function(a){return a=this.get_node(a),a&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,c){var d,e,f,g,h;if(b.isArray(a))return this._load_nodes(a.slice(),c),!0;if(a=this.get_node(a),!a)return c&&c.call(this,a,!1),!1;if(a.state.loaded){for(a.state.loaded=!1,d=0,e=a.children_d.length;e>d;d++){for(f=0,g=a.parents.length;g>f;f++)this._model.data[a.parents[f]].children_d=b.vakata.array_remove_item(this._model.data[a.parents[f]].children_d,a.children_d[d]);this._model.data[a.children_d[d]].state.selected&&(h=!0,this._data.core.selected=b.vakata.array_remove_item(this._data.core.selected,a.children_d[d])),delete this._model.data[a.children_d[d]]}a.children=[],a.children_d=[],h&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}return a.state.failed=!1,a.state.loading=!0,this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(a,b.proxy(function(b){a=this._model.data[a.id],a.state.loading=!1,a.state.loaded=b,a.state.failed=!a.state.loaded;var d=this.get_node(a,!0);a.state.loaded&&!a.children.length&&d&&d.length&&!d.hasClass("jstree-leaf")&&d.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),d.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:a,status:b}),c&&c.call(this,a,b)},this)),!0},_load_nodes:function(a,b,c){var d,e,f=!0,g=function(){this._load_nodes(a,b,!0)},h=this._model.data,i=[];for(d=0,e=a.length;e>d;d++)!h[a[d]]||(h[a[d]].state.loaded||h[a[d]].state.failed)&&c||(this.is_loading(a[d])||this.load_node(a[d],g),f=!1);if(f){for(d=0,e=a.length;e>d;d++)h[a[d]]&&h[a[d]].state.loaded&&i.push(a[d]);b&&!b.done&&(b.call(this,i),b.done=!0)}},load_all:function(a,b){if(a||(a="#"),a=this.get_node(a),!a)return!1;var c,d,e=[],f=this._model.data,g=f[a.id].children_d;for(a.state&&!a.state.loaded&&e.push(a.id),c=0,d=g.length;d>c;c++)f[g[c]]&&f[g[c]].state&&!f[g[c]].state.loaded&&e.push(g[c]);e.length?this._load_nodes(e,function(){this.load_all(a,b)}):(b&&b.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,c){var d,e=this.settings.core.data;return e?b.isFunction(e)?e.call(this,a,b.proxy(function(d){d===!1&&c.call(this,!1),this["string"==typeof d?"_append_html_data":"_append_json_data"](a,"string"==typeof d?b(b.parseHTML(d)).filter(function(){return 3!==this.nodeType}):d,function(a){c.call(this,a)})},this)):"object"==typeof e?e.url?(e=b.extend(!0,{},e),b.isFunction(e.url)&&(e.url=e.url.call(this,a)),b.isFunction(e.data)&&(e.data=e.data.call(this,a)),b.ajax(e).done(b.proxy(function(d,e,f){var g=f.getResponseHeader("Content-Type");return g&&-1!==g.indexOf("json")||"object"==typeof d?this._append_json_data(a,d,function(a){c.call(this,a)}):g&&-1!==g.indexOf("html")||"string"==typeof d?this._append_html_data(a,b(b.parseHTML(d)).filter(function(){return 3!==this.nodeType}),function(a){c.call(this,a)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:f})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))},this)).fail(b.proxy(function(b){c.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:b})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(d=b.isArray(e)||b.isPlainObject(e)?JSON.parse(JSON.stringify(e)):e,"#"===a.id?this._append_json_data(a,d,function(a){c.call(this,a)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))):"string"==typeof e?"#"===a.id?this._append_html_data(a,b(b.parseHTML(e)).filter(function(){return 3!==this.nodeType}),function(a){c.call(this,a)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1)):c.call(this,!1):"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0),function(a){c.call(this,a)}):c.call(this,!1)},_node_changed:function(a){a=this.get_node(a),a&&this._model.changed.push(a.id)},_append_html_data:function(a,c,d){a=this.get_node(a),a.children=[],a.children_d=[];var e,f,g,h=c.is("ul")?c.children():c,i=a.id,j=[],k=[],l=this._model.data,m=l[i],n=this._data.core.selected.length;for(h.each(b.proxy(function(a,c){e=this._parse_model_from_html(b(c),i,m.parents.concat()),e&&(j.push(e),k.push(e),l[e].children_d.length&&(k=k.concat(l[e].children_d)))},this)),m.children=j,m.children_d=k,f=0,g=m.parents.length;g>f;f++)l[m.parents[f]].children_d=l[m.parents[f]].children_d.concat(k);this.trigger("model",{nodes:k,parent:i}),"#"!==i?(this._node_changed(i),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==n&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),d.call(this,!0)},_append_json_data:function(c,d,e,f){if(null!==this.element){c=this.get_node(c),c.children=[],c.children_d=[],d.d&&(d=d.d,"string"==typeof d&&(d=JSON.parse(d))),b.isArray(d)||(d=[d]);var g=null,h={df:this._model.default_state,dat:d,par:c.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},i=function(b,c){b.data&&(b=b.data);var d,e,f,g,h=b.dat,i=b.par,j=[],k=[],l=[],m=b.df,n=b.t_id,o=b.t_cnt,p=b.m,q=p[i],r=b.sel,s=function(a,b,d){d=d?d.concat():[],b&&d.unshift(b);var e,f,g,h,i=a.id.toString(),j={id:i,text:a.text||"",icon:a.icon!==c?a.icon:!0,parent:b,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in m)m.hasOwnProperty(e)&&(j.state[e]=m[e]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(j.icon=a.data.jstree.icon),(j.icon===c||null===j.icon||""===j.icon)&&(j.icon=!0),a&&a.data&&(j.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(j.state[e]=a.data.jstree[e]);if(a&&"object"==typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(j.state[e]=a.state[e]);if(a&&"object"==typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(j.li_attr[e]=a.li_attr[e]);if(j.li_attr.id||(j.li_attr.id=i),a&&"object"==typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(j.a_attr[e]=a.a_attr[e]);for(a&&a.children&&a.children===!0&&(j.state.loaded=!1,j.children=[],j.children_d=[]),p[j.id]=j,e=0,f=j.children.length;f>e;e++)g=s(p[j.children[e]],j.id,d),h=p[g],j.children_d.push(g),h.children_d.length&&(j.children_d=j.children_d.concat(h.children_d));return delete a.data,delete a.children,p[j.id].original=a,j.state.selected&&l.push(j.id),j.id},t=function(a,b,d){d=d?d.concat():[],b&&d.unshift(b);var e,f,g,h,i,j=!1;do j="j"+n+"_"+ ++o;while(p[j]);i={id:!1,text:"string"==typeof a?a:"",icon:"object"==typeof a&&a.icon!==c?a.icon:!0,parent:b,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in m)m.hasOwnProperty(e)&&(i.state[e]=m[e]);if(a&&a.id&&(i.id=a.id.toString()),a&&a.text&&(i.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(i.icon=a.data.jstree.icon),(i.icon===c||null===i.icon||""===i.icon)&&(i.icon=!0),a&&a.data&&(i.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(i.state[e]=a.data.jstree[e]);if(a&&"object"==typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(i.state[e]=a.state[e]);if(a&&"object"==typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(i.li_attr[e]=a.li_attr[e]);if(i.li_attr.id&&!i.id&&(i.id=i.li_attr.id.toString()),i.id||(i.id=j),i.li_attr.id||(i.li_attr.id=i.id),a&&"object"==typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(i.a_attr[e]=a.a_attr[e]);if(a&&a.children&&a.children.length){for(e=0,f=a.children.length;f>e;e++)g=t(a.children[e],i.id,d),h=p[g],i.children.push(g),h.children_d.length&&(i.children_d=i.children_d.concat(h.children_d));i.children_d=i.children_d.concat(i.children)}return a&&a.children&&a.children===!0&&(i.state.loaded=!1,i.children=[],i.children_d=[]),delete a.data,delete a.children,i.original=a,p[i.id]=i,i.state.selected&&l.push(i.id),i.id};if(h.length&&h[0].id!==c&&h[0].parent!==c){for(e=0,f=h.length;f>e;e++)h[e].children||(h[e].children=[]),p[h[e].id.toString()]=h[e];for(e=0,f=h.length;f>e;e++)p[h[e].parent.toString()].children.push(h[e].id.toString()),q.children_d.push(h[e].id.toString());for(e=0,f=q.children.length;f>e;e++)d=s(p[q.children[e]],i,q.parents.concat()),k.push(d),p[d].children_d.length&&(k=k.concat(p[d].children_d));for(e=0,f=q.parents.length;f>e;e++)p[q.parents[e]].children_d=p[q.parents[e]].children_d.concat(k);g={cnt:o,mod:p,sel:r,par:i,dpc:k,add:l}}else{for(e=0,f=h.length;f>e;e++)d=t(h[e],i,q.parents.concat()),d&&(j.push(d),k.push(d),p[d].children_d.length&&(k=k.concat(p[d].children_d)));for(q.children=j,q.children_d=k,e=0,f=q.parents.length;f>e;e++)p[q.parents[e]].children_d=p[q.parents[e]].children_d.concat(k);g={cnt:o,mod:p,sel:r,par:i,dpc:k,add:l}}return"undefined"!=typeof a&&"undefined"!=typeof a.document?g:void postMessage(g)},j=function(a,c){if(null!==this.element){if(this._cnt=a.cnt,this._model.data=a.mod,c){var d,f,g=a.add,h=a.sel,i=this._data.core.selected.slice(),j=this._model.data;if(h.length!==i.length||b.vakata.array_unique(h.concat(i)).length!==h.length){for(d=0,f=h.length;f>d;d++)-1===b.inArray(h[d],g)&&-1===b.inArray(h[d],i)&&(j[h[d]].state.selected=!1);for(d=0,f=i.length;f>d;d++)-1===b.inArray(i[d],h)&&(j[i[d]].state.selected=!0)}}a.add.length&&(this._data.core.selected=this._data.core.selected.concat(a.add)),this.trigger("model",{nodes:a.dpc,parent:a.par}),"#"!==a.par?(this._node_changed(a.par),this.redraw()):this.redraw(!0),a.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),e.call(this,!0)}};if(this.settings.core.worker&&a.Blob&&a.URL&&a.Worker)try{null===this._wrk&&(this._wrk=a.URL.createObjectURL(new a.Blob(["self.onmessage = "+i.toString()],{type:"text/javascript"}))),!this._data.core.working||f?(this._data.core.working=!0,g=new a.Worker(this._wrk),g.onmessage=b.proxy(function(a){j.call(this,a.data,!0);try{g.terminate(),g=null}catch(b){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),h.par?g.postMessage(h):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([c,d,e,!0])}catch(k){j.call(this,i(h),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else j.call(this,i(h),!1)}},_parse_model_from_html:function(a,d,e){e=e?[].concat(e):[],d&&e.unshift(d);var f,g,h,i,j,k=this._model.data,l={id:!1,text:!1,icon:!0,parent:d,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in this._model.default_state)this._model.default_state.hasOwnProperty(h)&&(l.state[h]=this._model.default_state[h]);if(i=b.vakata.attributes(a,!0),b.each(i,function(a,c){return c=b.trim(c),c.length?(l.li_attr[a]=c,void("id"===a&&(l.id=c.toString()))):!0}),i=a.children("a").first(),i.length&&(i=b.vakata.attributes(i,!0),b.each(i,function(a,c){c=b.trim(c),c.length&&(l.a_attr[a]=c)})),i=a.children("a").first().length?a.children("a").first().clone():a.clone(),i.children("ins, i, ul").remove(),i=i.html(),i=b("<div />").html(i),l.text=this.settings.core.force_text?i.text():i.html(),i=a.data(),l.data=i?b.extend(!0,{},i):null,l.state.opened=a.hasClass("jstree-open"),l.state.selected=a.children("a").hasClass("jstree-clicked"),l.state.disabled=a.children("a").hasClass("jstree-disabled"),l.data&&l.data.jstree)for(h in l.data.jstree)l.data.jstree.hasOwnProperty(h)&&(l.state[h]=l.data.jstree[h]);i=a.children("a").children(".jstree-themeicon"),i.length&&(l.icon=i.hasClass("jstree-themeicon-hidden")?!1:i.attr("rel")),l.state.icon!==c&&(l.icon=l.state.icon),(l.icon===c||null===l.icon||""===l.icon)&&(l.icon=!0),i=a.children("ul").children("li");do j="j"+this._id+"_"+ ++this._cnt;while(k[j]);return l.id=l.li_attr.id?l.li_attr.id.toString():j,i.length?(i.each(b.proxy(function(a,c){f=this._parse_model_from_html(b(c),l.id,e),g=this._model.data[f],l.children.push(f),g.children_d.length&&(l.children_d=l.children_d.concat(g.children_d))},this)),l.children_d=l.children_d.concat(l.children)):a.hasClass("jstree-closed")&&(l.state.loaded=!1),l.li_attr["class"]&&(l.li_attr["class"]=l.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),l.a_attr["class"]&&(l.a_attr["class"]=l.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),k[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_flat_json:function(a,b,d){d=d?d.concat():[],b&&d.unshift(b);var e,f,g,h,i=a.id.toString(),j=this._model.data,k=this._model.default_state,l={id:i,text:a.text||"",icon:a.icon!==c?a.icon:!0,parent:b,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in k)k.hasOwnProperty(e)&&(l.state[e]=k[e]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),(l.icon===c||null===l.icon||""===l.icon)&&(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(l.state[e]=a.data.jstree[e]);if(a&&"object"==typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(l.state[e]=a.state[e]);if(a&&"object"==typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(l.li_attr[e]=a.li_attr[e]);if(l.li_attr.id||(l.li_attr.id=i),a&&"object"==typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(l.a_attr[e]=a.a_attr[e]);for(a&&a.children&&a.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),j[l.id]=l,e=0,f=l.children.length;f>e;e++)g=this._parse_model_from_flat_json(j[l.children[e]],l.id,d),h=j[g],l.children_d.push(g),h.children_d.length&&(l.children_d=l.children_d.concat(h.children_d));return delete a.data,delete a.children,j[l.id].original=a,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(a,b,d){d=d?d.concat():[],b&&d.unshift(b);var e,f,g,h,i,j=!1,k=this._model.data,l=this._model.default_state;do j="j"+this._id+"_"+ ++this._cnt;while(k[j]);i={id:!1,text:"string"==typeof a?a:"",icon:"object"==typeof a&&a.icon!==c?a.icon:!0,parent:b,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in l)l.hasOwnProperty(e)&&(i.state[e]=l[e]);if(a&&a.id&&(i.id=a.id.toString()),a&&a.text&&(i.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(i.icon=a.data.jstree.icon),(i.icon===c||null===i.icon||""===i.icon)&&(i.icon=!0),a&&a.data&&(i.data=a.data,a.data.jstree))for(e in a.data.jstree)a.data.jstree.hasOwnProperty(e)&&(i.state[e]=a.data.jstree[e]);if(a&&"object"==typeof a.state)for(e in a.state)a.state.hasOwnProperty(e)&&(i.state[e]=a.state[e]);if(a&&"object"==typeof a.li_attr)for(e in a.li_attr)a.li_attr.hasOwnProperty(e)&&(i.li_attr[e]=a.li_attr[e]);if(i.li_attr.id&&!i.id&&(i.id=i.li_attr.id.toString()),i.id||(i.id=j),i.li_attr.id||(i.li_attr.id=i.id),a&&"object"==typeof a.a_attr)for(e in a.a_attr)a.a_attr.hasOwnProperty(e)&&(i.a_attr[e]=a.a_attr[e]);if(a&&a.children&&a.children.length){for(e=0,f=a.children.length;f>e;e++)g=this._parse_model_from_json(a.children[e],i.id,d),h=k[g],i.children.push(g),h.children_d.length&&(i.children_d=i.children_d.concat(h.children_d));i.children_d=i.children_d.concat(i.children)}return a&&a.children&&a.children===!0&&(i.state.loaded=!1,i.children=[],i.children_d=[]),delete a.data,delete a.children,i.original=a,k[i.id]=i,i.state.selected&&this._data.core.selected.push(i.id),i.id},_redraw:function(){var a,b,c,d=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),e=l.createElement("UL"),f=this._data.core.focused;for(b=0,c=d.length;c>b;b++)a=this.redraw_node(d[b],!0,this._model.force_full_redraw),a&&this._model.force_full_redraw&&e.appendChild(a);this._model.force_full_redraw&&(e.className=this.get_container_ul()[0]?this.get_container_ul()[0].className:null,e.setAttribute("role","group"),this.element.empty().append(e)),null!==f&&(a=this.get_node(f,!0),a&&a.length&&a.children(".jstree-anchor")[0]!==l.activeElement?a.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:d})},redraw:function(a){a&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(a){var b=this.get_node(a),c=!1,d=!1,e=!1,f=l;if(!b)return!1;if("#"===b.id)return this.redraw(!0);if(a=this.get_node(a,!0),!a||!a.length)return!1;if(a.children(".jstree-children").remove(),a=a[0],b.children.length&&b.state.loaded){for(e=f.createElement("UL"),e.setAttribute("role","group"),e.className="jstree-children",c=0,d=b.children.length;d>c;c++)e.appendChild(this.redraw_node(b.children[c],!0,!0));a.appendChild(e)}},redraw_node:function(a,c,d,e){var f=this.get_node(a),g=!1,h=!1,i=!1,j=!1,k=!1,n=!1,o="",p=l,q=this._model.data,r=!1,s=null,t=0,u=0;if(!f)return!1;if("#"===f.id)return this.redraw(!0);if(c=c||0===f.children.length,a=l.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(f.id[0])?"\\3"+f.id[0]+" "+f.id.substr(1).replace(b.jstree.idregex,"\\$&"):f.id.replace(b.jstree.idregex,"\\$&"))):l.getElementById(f.id))a=b(a),d||(g=a.parent().parent()[0],g===this.element[0]&&(g=null),h=a.index()),c||!f.children.length||a.children(".jstree-children").length||(c=!0),c||(i=a.children(".jstree-children")[0]),r=a.children(".jstree-anchor")[0]===l.activeElement,a.remove();else if(c=!0,!d){if(g="#"!==f.parent?b("#"+f.parent.replace(b.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===g||g&&q[f.parent].state.opened))return!1;h=b.inArray(f.id,null===g?q["#"].children:q[f.parent].children)}a=m.cloneNode(!0),o="jstree-node ";for(j in f.li_attr)if(f.li_attr.hasOwnProperty(j)){if("id"===j)continue;"class"!==j?a.setAttribute(j,f.li_attr[j]):o+=f.li_attr[j]}f.a_attr.id||(f.a_attr.id=f.id+"_anchor"),a.setAttribute("aria-selected",!!f.state.selected),a.setAttribute("aria-level",f.parents.length),a.setAttribute("aria-labelledby",f.a_attr.id),f.state.disabled&&a.setAttribute("aria-disabled",!0),f.state.loaded&&!f.children.length?o+=" jstree-leaf":(o+=f.state.opened&&f.state.loaded?" jstree-open":" jstree-closed",a.setAttribute("aria-expanded",f.state.opened&&f.state.loaded)),null!==f.parent&&q[f.parent].children[q[f.parent].children.length-1]===f.id&&(o+=" jstree-last"),a.id=f.id,a.className=o,o=(f.state.selected?" jstree-clicked":"")+(f.state.disabled?" jstree-disabled":"");for(k in f.a_attr)if(f.a_attr.hasOwnProperty(k)){if("href"===k&&"#"===f.a_attr[k])continue;"class"!==k?a.childNodes[1].setAttribute(k,f.a_attr[k]):o+=" "+f.a_attr[k]}if(o.length&&(a.childNodes[1].className="jstree-anchor "+o),(f.icon&&f.icon!==!0||f.icon===!1)&&(f.icon===!1?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===f.icon.indexOf("/")&&-1===f.icon.indexOf(".")?a.childNodes[1].className+=" "+f.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+f.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?a.childNodes[1].appendChild(p.createTextNode(f.text)):a.childNodes[1].innerHTML+=f.text,c&&f.children.length&&(f.state.opened||e)&&f.state.loaded){for(n=p.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",j=0,k=f.children.length;k>j;j++)n.appendChild(this.redraw_node(f.children[j],c,!0));a.appendChild(n)}if(i&&a.appendChild(i),!d){for(g||(g=this.element[0]),j=0,k=g.childNodes.length;k>j;j++)if(g.childNodes[j]&&g.childNodes[j].className&&-1!==g.childNodes[j].className.indexOf("jstree-children")){s=g.childNodes[j];break}s||(s=p.createElement("UL"),s.setAttribute("role","group"),s.className="jstree-children",g.appendChild(s)),g=s,h<g.childNodes.length?g.insertBefore(a,g.childNodes[h]):g.appendChild(a),r&&(t=this.element[0].scrollTop,u=this.element[0].scrollLeft,a.childNodes[1].focus(),this.element[0].scrollTop=t,this.element[0].scrollLeft=u)}return f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(b.proxy(function(){this.open_node(f.id,!1,0)},this),0)),a},open_node:function(a,d,e){var f,g,h,i;if(b.isArray(a)){for(a=a.slice(),f=0,g=a.length;g>f;f++)this.open_node(a[f],d,e);
return!0}if(a=this.get_node(a),!a||"#"===a.id)return!1;if(e=e===c?this.settings.core.animation:e,!this.is_closed(a))return d&&d.call(this,a,!1),!1;if(this.is_loaded(a))h=this.get_node(a,!0),i=this,h.length&&(e&&h.children(".jstree-children").length&&h.children(".jstree-children").stop(!0,!0),a.children.length&&!this._firstChild(h.children(".jstree-children")[0])&&this.draw_children(a),e?(this.trigger("before_open",{node:a}),h.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(e,function(){this.style.display="",i.trigger("after_open",{node:a})})):(this.trigger("before_open",{node:a}),h[0].className=h[0].className.replace("jstree-closed","jstree-open"),h[0].setAttribute("aria-expanded",!0))),a.state.opened=!0,d&&d.call(this,a,!0),h.length||this.trigger("before_open",{node:a}),this.trigger("open_node",{node:a}),e&&h.length||this.trigger("after_open",{node:a});else{if(this.is_loading(a))return setTimeout(b.proxy(function(){this.open_node(a,d,e)},this),500);this.load_node(a,function(a,b){return b?this.open_node(a,d,e):d?d.call(this,a,!1):!1})}},_open_to:function(a){if(a=this.get_node(a),!a||"#"===a.id)return!1;var c,d,e=a.parents;for(c=0,d=e.length;d>c;c+=1)"#"!==c&&this.open_node(e[c],!1,0);return b("#"+a.id.replace(b.jstree.idregex,"\\$&"),this.element)},close_node:function(a,d){var e,f,g,h;if(b.isArray(a)){for(a=a.slice(),e=0,f=a.length;f>e;e++)this.close_node(a[e],d);return!0}return a=this.get_node(a),a&&"#"!==a.id?this.is_closed(a)?!1:(d=d===c?this.settings.core.animation:d,g=this,h=this.get_node(a,!0),h.length&&(d?h.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(d,function(){this.style.display="",h.children(".jstree-children").remove(),g.trigger("after_close",{node:a})}):(h[0].className=h[0].className.replace("jstree-open","jstree-closed"),h.attr("aria-expanded",!1).children(".jstree-children").remove())),a.state.opened=!1,this.trigger("close_node",{node:a}),void(d&&h.length||this.trigger("after_close",{node:a}))):!1},toggle_node:function(a){var c,d;if(b.isArray(a)){for(a=a.slice(),c=0,d=a.length;d>c;c++)this.toggle_node(a[c]);return!0}return this.is_closed(a)?this.open_node(a):this.is_open(a)?this.close_node(a):void 0},open_all:function(a,b,c){if(a||(a="#"),a=this.get_node(a),!a)return!1;var d,e,f,g="#"===a.id?this.get_container_ul():this.get_node(a,!0);if(!g.length){for(d=0,e=a.children_d.length;e>d;d++)this.is_closed(this._model.data[a.children_d[d]])&&(this._model.data[a.children_d[d]].state.opened=!0);return this.trigger("open_all",{node:a})}c=c||g,f=this,g=this.is_closed(a)?g.find(".jstree-closed").addBack():g.find(".jstree-closed"),g.each(function(){f.open_node(this,function(a,d){d&&this.is_parent(a)&&this.open_all(a,b,c)},b||0)}),0===c.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(c)})},close_all:function(a,c){if(a||(a="#"),a=this.get_node(a),!a)return!1;var d,e,f="#"===a.id?this.get_container_ul():this.get_node(a,!0),g=this;if(!f.length){for(d=0,e=a.children_d.length;e>d;d++)this._model.data[a.children_d[d]].state.opened=!1;return this.trigger("close_all",{node:a})}f=this.is_open(a)?f.find(".jstree-open").addBack():f.find(".jstree-open"),b(f.get().reverse()).each(function(){g.close_node(this,c||0)}),this.trigger("close_all",{node:a})},is_disabled:function(a){return a=this.get_node(a),a&&a.state&&a.state.disabled},enable_node:function(a){var c,d;if(b.isArray(a)){for(a=a.slice(),c=0,d=a.length;d>c;c++)this.enable_node(a[c]);return!0}return a=this.get_node(a),a&&"#"!==a.id?(a.state.disabled=!1,this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:a})):!1},disable_node:function(a){var c,d;if(b.isArray(a)){for(a=a.slice(),c=0,d=a.length;d>c;c++)this.disable_node(a[c]);return!0}return a=this.get_node(a),a&&"#"!==a.id?(a.state.disabled=!0,this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:a})):!1},activate_node:function(a,b){if(this.is_disabled(a))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==c?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var d,e,f=this.get_node(a).id,g=this._data.core.last_clicked.id,h=this.get_node(this._data.core.last_clicked.parent).children,i=!1;for(d=0,e=h.length;e>d;d+=1)h[d]===f&&(i=!i),h[d]===g&&(i=!i),this.is_disabled(h[d])||!i&&h[d]!==f&&h[d]!==g?this.deselect_node(h[d],!0,b):this.select_node(h[d],!0,!1,b);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:b})}else this.is_selected(a)?this.deselect_node(a,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){if(a=this.get_node(a,!0),!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b),a.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(a)}),setTimeout(function(){c.attr("aria-activedescendant",a[0].id)},0)},dehover_node:function(a){return a=this.get_node(a,!0),a&&a.length&&a.children(".jstree-hovered").length?(a.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(a)})):!1},select_node:function(a,c,d,e){var f,g,h;if(b.isArray(a)){for(a=a.slice(),g=0,h=a.length;h>g;g++)this.select_node(a[g],c,d,e);return!0}return a=this.get_node(a),a&&"#"!==a.id?(f=this.get_node(a,!0),void(a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),d||(f=this._open_to(a)),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:e}),c||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:e})))):!1},deselect_node:function(a,c,d){var e,f,g;if(b.isArray(a)){for(a=a.slice(),e=0,f=a.length;f>e;e++)this.deselect_node(a[e],c,d);return!0}return a=this.get_node(a),a&&"#"!==a.id?(g=this.get_node(a,!0),void(a.state.selected&&(a.state.selected=!1,this._data.core.selected=b.vakata.array_remove_item(this._data.core.selected,a.id),g.length&&g.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:d}),c||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:d})))):!1},select_all:function(a){var b,c,d=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),b=0,c=this._data.core.selected.length;c>b;b++)this._model.data[this._data.core.selected[b]]&&(this._model.data[this._data.core.selected[b]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:d})},deselect_all:function(a){var b,c,d=this._data.core.selected.concat([]);for(b=0,c=this._data.core.selected.length;c>b;b++)this._model.data[this._data.core.selected[b]]&&(this._model.data[this._data.core.selected[b]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:d}),a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:d})},is_selected:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.state.selected:!1},get_selected:function(a){return a?b.map(this._data.core.selected,b.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var c,d,e,f,g=this.get_selected(!0),h={};for(c=0,d=g.length;d>c;c++)h[g[c].id]=g[c];for(c=0,d=g.length;d>c;c++)for(e=0,f=g[c].children_d.length;f>e;e++)h[g[c].children_d[e]]&&delete h[g[c].children_d[e]];g=[];for(c in h)h.hasOwnProperty(c)&&g.push(c);return a?b.map(g,b.proxy(function(a){return this.get_node(a)},this)):g},get_bottom_selected:function(a){var c,d,e=this.get_selected(!0),f=[];for(c=0,d=e.length;d>c;c++)e[c].children.length||f.push(e[c].id);return a?b.map(f,b.proxy(function(a){return this.get_node(a)},this)):f},get_state:function(){var a,b={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(a in this._model.data)this._model.data.hasOwnProperty(a)&&"#"!==a&&(this._model.data[a].state.opened&&b.core.open.push(a),this._model.data[a].state.selected&&b.core.selected.push(a));return b},set_state:function(a,d){if(a){if(a.core){var e,f;if(a.core.open)return b.isArray(a.core.open)&&a.core.open.length?this._load_nodes(a.core.open,function(b){this.open_node(b,!1,0),delete a.core.open,this.set_state(a,d)},!0):(delete a.core.open,this.set_state(a,d)),!1;if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==c&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==c&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,d),!1;if(a.core.selected)return e=this,this.deselect_all(),b.each(a.core.selected,function(a,b){e.select_node(b,!1,!0)}),delete a.core.selected,this.set_state(a,d),!1;for(f in a)a.hasOwnProperty(f)&&"core"!==f&&-1===b.inArray(f,this.settings.plugins)&&delete a[f];if(b.isEmptyObject(a.core))return delete a.core,this.set_state(a,d),!1}return b.isEmptyObject(a)?(a=null,d&&d.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,c){this._data.core.state=c===!0?{}:this.get_state(),c&&b.isFunction(c)&&(this._data.core.state=c.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var d=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+d+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node("#",function(a,c){c&&(this.get_container_ul()[0].className=d,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(b.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(a){if(a=this.get_node(a),!a||"#"===a.id)return!1;var c=[],d=[];this._data.core.selected.concat([]);d.push(a.id),a.state.opened===!0&&c.push(a.id),this.get_node(a,!0).find(".jstree-open").each(function(){c.push(this.id)}),this._load_nodes(d,b.proxy(function(b){this.open_node(c,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:a,nodes:b})},this))},set_id:function(a,c){if(a=this.get_node(a),!a||"#"===a.id)return!1;var d,e,f=this._model.data;for(c=c.toString(),f[a.parent].children[b.inArray(a.id,f[a.parent].children)]=c,d=0,e=a.parents.length;e>d;d++)f[a.parents[d]].children_d[b.inArray(a.id,f[a.parents[d]].children_d)]=c;for(d=0,e=a.children.length;e>d;d++)f[a.children[d]].parent=c;for(d=0,e=a.children_d.length;e>d;d++)f[a.children_d[d]].parents[b.inArray(a.id,f[a.children_d[d]].parents)]=c;return d=b.inArray(a.id,this._data.core.selected),-1!==d&&(this._data.core.selected[d]=c),d=this.get_node(a.id,!0),d&&(d.attr("id",c).children(".jstree-anchor").attr("id",c+"_anchor").end().attr("aria-labelledby",c+"_anchor"),this.element.attr("aria-activedescendant")===a.id&&this.element.attr("aria-activedescendant",c)),delete f[a.id],a.id=c,a.li_attr.id=c,f[c]=a,!0},get_text:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.text:!1},set_text:function(a,c){var d,e;if(b.isArray(a)){for(a=a.slice(),d=0,e=a.length;e>d;d++)this.set_text(a[d],c);return!0}return a=this.get_node(a),a&&"#"!==a.id?(a.text=c,this.get_node(a,!0).length&&this.redraw_node(a.id),this.trigger("set_text",{obj:a,text:c}),!0):!1},get_json:function(a,c,d){if(a=this.get_node(a||"#"),!a)return!1;c&&c.flat&&!d&&(d=[]);var e,f,g={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:b.extend(!0,{},a.li_attr),a_attr:b.extend(!0,{},a.a_attr),state:{},data:c&&c.no_data?!1:b.extend(!0,{},a.data)};if(c&&c.flat?g.parent=a.parent:g.children=[],!c||!c.no_state)for(e in a.state)a.state.hasOwnProperty(e)&&(g.state[e]=a.state[e]);if(c&&c.no_id&&(delete g.id,g.li_attr&&g.li_attr.id&&delete g.li_attr.id,g.a_attr&&g.a_attr.id&&delete g.a_attr.id),c&&c.flat&&"#"!==a.id&&d.push(g),!c||!c.no_children)for(e=0,f=a.children.length;f>e;e++)c&&c.flat?this.get_json(a.children[e],c,d):g.children.push(this.get_json(a.children[e],c));return c&&c.flat?d:"#"===a.id?g.children:g},create_node:function(a,d,e,f,g){if(null===a&&(a="#"),a=this.get_node(a),!a)return!1;if(e=e===c?"last":e,!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,d,e,f,!0)});d||(d={text:this.get_string("New node")}),"string"==typeof d&&(d={text:d}),d.text===c&&(d.text=this.get_string("New node"));var h,i,j,k;switch("#"===a.id&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":h=this.get_node(a.parent),e=b.inArray(a.id,h.children),a=h;break;case"after":h=this.get_node(a.parent),e=b.inArray(a.id,h.children)+1,a=h;break;case"inside":case"first":e=0;break;case"last":e=a.children.length;break;default:e||(e=0)}if(e>a.children.length&&(e=a.children.length),d.id||(d.id=!0),!this.check("create_node",d,a,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(d.id===!0&&delete d.id,d=this._parse_model_from_json(d,a.id,a.parents.concat()),!d)return!1;for(h=this.get_node(d),i=[],i.push(d),i=i.concat(h.children_d),this.trigger("model",{nodes:i,parent:a.id}),a.children_d=a.children_d.concat(i),j=0,k=a.parents.length;k>j;j++)this._model.data[a.parents[j]].children_d=this._model.data[a.parents[j]].children_d.concat(i);for(d=h,h=[],j=0,k=a.children.length;k>j;j++)h[j>=e?j+1:j]=a.children[j];return h[e]=d.id,a.children=h,this.redraw_node(a,!0),f&&f.call(this,this.get_node(d)),this.trigger("create_node",{node:this.get_node(d),parent:a.id,position:e}),d.id},rename_node:function(a,c){var d,e,f;if(b.isArray(a)){for(a=a.slice(),d=0,e=a.length;e>d;d++)this.rename_node(a[d],c);return!0}return a=this.get_node(a),a&&"#"!==a.id?(f=a.text,this.check("rename_node",a,this.get_parent(a),c)?(this.set_text(a,c),this.trigger("rename_node",{node:a,text:c,old:f}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(a){var c,d,e,f,g,h,i,j,k,l;if(b.isArray(a)){for(a=a.slice(),c=0,d=a.length;d>c;c++)this.delete_node(a[c]);return!0}if(a=this.get_node(a),!a||"#"===a.id)return!1;if(e=this.get_node(a.parent),f=b.inArray(a.id,e.children),l=!1,!this.check("delete_node",a,e,f))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==f&&(e.children=b.vakata.array_remove(e.children,f)),g=a.children_d.concat([]),g.push(a.id),j=0,k=g.length;k>j;j++){for(h=0,i=a.parents.length;i>h;h++)f=b.inArray(g[j],this._model.data[a.parents[h]].children_d),-1!==f&&(this._model.data[a.parents[h]].children_d=b.vakata.array_remove(this._model.data[a.parents[h]].children_d,f));this._model.data[g[j]].state.selected&&(l=!0,f=b.inArray(g[j],this._data.core.selected),-1!==f&&(this._data.core.selected=b.vakata.array_remove(this._data.core.selected,f)))}for(this.trigger("delete_node",{node:a,parent:e.id}),l&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:e.id}),j=0,k=g.length;k>j;j++)delete this._model.data[g[j]];return this.redraw_node(e,!0),!0},check:function(a,c,d,e,f){c=c&&c.id?c:this.get_node(c),d=d&&d.id?d:this.get_node(d);var g=a.match(/^move_node|copy_node|create_node$/i)?d:c,h=this.settings.core.check_callback;return"move_node"!==a&&"copy_node"!==a||f&&f.is_multi||c.id!==d.id&&b.inArray(c.id,d.children)!==e&&-1===b.inArray(d.id,c.children_d)?(g&&g.data&&(g=g.data),g&&g.functions&&(g.functions[a]===!1||g.functions[a]===!0)?(g.functions[a]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})}),g.functions[a]):h===!1||b.isFunction(h)&&h.call(this,a,c,d,e,f)===!1||h&&h[a]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(a,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(d=this.get_node(d),e=e===c?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(a,d,e,f,!0,!1,i)});if(b.isArray(a)){if(1!==a.length){for(j=0,k=a.length;k>j;j++)(r=this.move_node(a[j],d,e,f,g,!1,i))&&(d=r,e="after");return this.redraw(),!0}a=a[0]}if(a=a&&a.id?a:this.get_node(a),!a||"#"===a.id)return!1;if(l=(a.parent||"#").toString(),n=e.toString().match(/^(before|after)$/)&&"#"!==d.id?this.get_node(d.parent):d,o=i?i:this._model.data[a.id]?this:b.jstree.reference(a.id),p=!o||!o._id||this._id!==o._id,m=o&&o._id&&l&&o._model.data[l]&&o._model.data[l].children?b.inArray(a.id,o._model.data[l].children):-1,o&&o._id&&(a=o._model.data[a.id]),p)return(r=this.copy_node(a,d,e,f,g,!1,i))?(o&&o.delete_node(a),r):!1;switch("#"===d.id&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":e=b.inArray(d.id,n.children);break;case"after":e=b.inArray(d.id,n.children)+1;break;case"inside":case"first":e=0;break;case"last":e=n.children.length;break;default:e||(e=0)}if(e>n.children.length&&(e=n.children.length),!this.check("move_node",a,n,e,{core:!0,origin:i,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===n.id){for(q=n.children.concat(),r=b.inArray(a.id,q),-1!==r&&(q=b.vakata.array_remove(q,r),e>r&&e--),r=[],s=0,t=q.length;t>s;s++)r[s>=e?s+1:s]=q[s];r[e]=a.id,n.children=r,this._node_changed(n.id),this.redraw("#"===n.id)}else{for(r=a.children_d.concat(),r.push(a.id),s=0,t=a.parents.length;t>s;s++){for(q=[],w=o._model.data[a.parents[s]].children_d,u=0,v=w.length;v>u;u++)-1===b.inArray(w[u],r)&&q.push(w[u]);o._model.data[a.parents[s]].children_d=q}for(o._model.data[l].children=b.vakata.array_remove_item(o._model.data[l].children,a.id),s=0,t=n.parents.length;t>s;s++)this._model.data[n.parents[s]].children_d=this._model.data[n.parents[s]].children_d.concat(r);for(q=[],s=0,t=n.children.length;t>s;s++)q[s>=e?s+1:s]=n.children[s];for(q[e]=a.id,n.children=q,n.children_d.push(a.id),n.children_d=n.children_d.concat(a.children_d),a.parent=n.id,r=n.parents.concat(),r.unshift(n.id),w=a.parents.length,a.parents=r,r=r.concat(),s=0,t=a.children_d.length;t>s;s++)this._model.data[a.children_d[s]].parents=this._model.data[a.children_d[s]].parents.slice(0,-1*w),Array.prototype.push.apply(this._model.data[a.children_d[s]].parents,r);("#"===l||"#"===n.id)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(n.id)),h||this.redraw()}return f&&f.call(this,a,n,e),this.trigger("move_node",{node:a,parent:n.id,position:e,old_parent:l,old_position:m,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id,old_instance:o,new_instance:this}),a.id},copy_node:function(a,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t;if(d=this.get_node(d),e=e===c?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(a,d,e,f,!0,!1,i)});if(b.isArray(a)){if(1!==a.length){for(j=0,k=a.length;k>j;j++)(m=this.copy_node(a[j],d,e,f,g,!0,i))&&(d=m,e="after");return this.redraw(),!0}a=a[0]}if(a=a&&a.id?a:this.get_node(a),!a||"#"===a.id)return!1;switch(q=(a.parent||"#").toString(),r=e.toString().match(/^(before|after)$/)&&"#"!==d.id?this.get_node(d.parent):d,s=i?i:this._model.data[a.id]?this:b.jstree.reference(a.id),t=!s||!s._id||this._id!==s._id,s&&s._id&&(a=s._model.data[a.id]),"#"===d.id&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":e=b.inArray(d.id,r.children);break;case"after":e=b.inArray(d.id,r.children)+1;break;case"inside":case"first":e=0;break;case"last":e=r.children.length;break;default:e||(e=0)}if(e>r.children.length&&(e=r.children.length),!this.check("copy_node",a,r,e,{core:!0,origin:i,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(p=s?s.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a,!p)return!1;if(p.id===!0&&delete p.id,p=this._parse_model_from_json(p,r.id,r.parents.concat()),!p)return!1;for(m=this.get_node(p),a&&a.state&&a.state.loaded===!1&&(m.state.loaded=!1),l=[],l.push(p),l=l.concat(m.children_d),this.trigger("model",{nodes:l,parent:r.id}),n=0,o=r.parents.length;o>n;n++)this._model.data[r.parents[n]].children_d=this._model.data[r.parents[n]].children_d.concat(l);for(l=[],n=0,o=r.children.length;o>n;n++)l[n>=e?n+1:n]=r.children[n];return l[e]=m.id,r.children=l,r.children_d.push(m.id),r.children_d=r.children_d.concat(m.children_d),"#"===r.id&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(r.id),h||this.redraw("#"===r.id),f&&f.call(this,m,r,e),this.trigger("copy_node",{node:m,original:a,parent:r.id,position:e,old_parent:q,old_position:s&&s._id&&q&&s._model.data[q]&&s._model.data[q].children?b.inArray(a.id,s._model.data[q].children):-1,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id,old_instance:s,new_instance:this}),m.id},cut:function(a){if(a||(a=this._data.core.selected.concat()),b.isArray(a)||(a=[a]),!a.length)return!1;var c,d,e,f=[];for(d=0,e=a.length;e>d;d++)c=this.get_node(a[d]),c&&c.id&&"#"!==c.id&&f.push(c);return f.length?(g=f,i=this,h="move_node",void this.trigger("cut",{node:a})):!1},copy:function(a){if(a||(a=this._data.core.selected.concat()),b.isArray(a)||(a=[a]),!a.length)return!1;var c,d,e,f=[];for(d=0,e=a.length;e>d;d++)c=this.get_node(a[d]),c&&c.id&&"#"!==c.id&&f.push(c);return f.length?(g=f,i=this,h="copy_node",void this.trigger("copy",{node:a})):!1},get_buffer:function(){return{mode:h,node:g,inst:i}},can_paste:function(){return h!==!1&&g!==!1},paste:function(a,b){return a=this.get_node(a),a&&h&&h.match(/^(copy_node|move_node)$/)&&g?(this[h](g,a,b,!1,!1,!1,i)&&this.trigger("paste",{parent:a.id,node:g,mode:h}),g=!1,h=!1,void(i=!1)):!1},clear_buffer:function(){g=!1,h=!1,i=!1,this.trigger("clear_buffer")},edit:function(a,c,d){var e,f,g,h,i,j,k,l,m;return(a=this.get_node(a))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(m=a,c="string"==typeof c?c:a.text,this.set_text(a,""),a=this._open_to(a),m.text=c,e=this._data.core.rtl,f=this.element.width(),g=a.children(".jstree-anchor"),h=b("<span>"),i=c,j=b("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),k=b("<input />",{value:i,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:b.proxy(function(){var c,e=h.children(".jstree-rename-input"),f=e.val(),k=this.settings.core.force_text;""===f&&(f=i),j.remove(),h.replaceWith(g),h.remove(),i=k?i:b("<div></div>").append(b.parseHTML(i)).html(),this.set_text(a,i),c=!!this.rename_node(a,k?b("<div></div>").text(f).text():b("<div></div>").append(b.parseHTML(f)).html()),c||this.set_text(a,i),d&&d.call(this,m,c)},this),keydown:function(a){var b=a.which;27===b&&(this.value=i),(27===b||13===b||37===b||38===b||39===b||40===b||32===b)&&a.stopImmediatePropagation(),(27===b||13===b)&&(a.preventDefault(),this.blur())},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){k.width(Math.min(j.text("pW"+this.value).width(),f))},keypress:function(a){return 13===a.which?!1:void 0}}),l={fontFamily:g.css("fontFamily")||"",fontSize:g.css("fontSize")||"",fontWeight:g.css("fontWeight")||"",fontStyle:g.css("fontStyle")||"",fontStretch:g.css("fontStretch")||"",fontVariant:g.css("fontVariant")||"",letterSpacing:g.css("letterSpacing")||"",wordSpacing:g.css("wordSpacing")||""},h.attr("class",g.attr("class")).append(g.contents().clone()).append(k),g.replaceWith(h),j.css(l),void k.css(l).width(Math.min(j.text("pW"+k[0].value).width(),f))[0].select()):!1},set_theme:function(a,c){if(!a)return!1;if(c===!0){var d=this.settings.core.themes.dir;d||(d=b.jstree.path+"/themes"),c=d+"/"+a+"/style.css"}c&&-1===b.inArray(c,j)&&(b("head").append('<link rel="stylesheet" href="'+c+'" type="text/css" />'),j.push(c)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=a,this.element.addClass("jstree-"+a),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive"),this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=a,a&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,d){var e,f,g,h;if(b.isArray(a)){for(a=a.slice(),e=0,f=a.length;f>e;e++)this.set_icon(a[e],d);return!0}return a=this.get_node(a),a&&"#"!==a.id?(h=a.icon,a.icon=d===!0||null===d||d===c||""===d?!0:d,g=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon"),d===!1?this.hide_icon(a):d===!0||null===d||d===c||""===d?(g.removeClass("jstree-themeicon-custom "+h).css("background","").removeAttr("rel"),h===!1&&this.show_icon(a)):-1===d.indexOf("/")&&-1===d.indexOf(".")?(g.removeClass(h).css("background",""),g.addClass(d+" jstree-themeicon-custom").attr("rel",d),h===!1&&this.show_icon(a)):(g.removeClass(h).css("background",""),g.addClass("jstree-themeicon-custom").css("background","url('"+d+"') center center no-repeat").attr("rel",d),h===!1&&this.show_icon(a)),!0):!1},get_icon:function(a){return a=this.get_node(a),a&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var c,d;if(b.isArray(a)){for(a=a.slice(),c=0,d=a.length;d>c;c++)this.hide_icon(a[c]);return!0}return a=this.get_node(a),a&&"#"!==a?(a.icon=!1,this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(a){var c,d,e;if(b.isArray(a)){for(a=a.slice(),c=0,d=a.length;d>c;c++)this.show_icon(a[c]);return!0}return a=this.get_node(a),a&&"#"!==a?(e=this.get_node(a,!0),a.icon=e.length?e.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,a.icon||(a.icon=!0),e.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},b.vakata={},b.vakata.attributes=function(a,c){a=b(a)[0];var d=c?{}:[];return a&&a.attributes&&b.each(a.attributes,function(a,e){-1===b.inArray(e.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==e.value&&""!==b.trim(e.value)&&(c?d[e.name]=e.value:d.push(e.name))}),d},b.vakata.array_unique=function(a){var b,d,e=[],f={};for(b=0,d=a.length;d>b;b++)f[a[b]]===c&&(e.push(a[b]),f[a[b]]=!0);return e},b.vakata.array_remove=function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=0>b?a.length+b:b,a.push.apply(a,d),a},b.vakata.array_remove_item=function(a,c){var d=b.inArray(c,a);return-1!==d?b.vakata.array_remove(a,d):a};var n=l.createElement("I");n.className="jstree-icon jstree-checkbox",n.setAttribute("role","presentation"),b.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},b.jstree.plugins.checkbox=function(a,d){this.bind=function(){d.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",b.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",b.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",b.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(b.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",b.proxy(function(a,b){var c,d,e=this._model.data,f=(e[b.parent],b.nodes);for(c=0,d=f.length;d>c;c++)e[f[c]].state.checked=e[f[c]].original&&e[f[c]].original.state&&e[f[c]].original.state.checked,e[f[c]].state.checked&&this._data.checkbox.selected.push(f[c])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",b.proxy(function(a,c){var d,e,f,g,h,i,j=this._model.data,k=j[c.parent],l=c.nodes,m=[],n=this.settings.checkbox.cascade,o=this.settings.checkbox.tie_selection;
if(-1!==n.indexOf("down"))if(k.state[o?"selected":"checked"]){for(e=0,f=l.length;f>e;e++)j[l[e]].state[o?"selected":"checked"]=!0;this._data[o?"core":"checkbox"].selected=this._data[o?"core":"checkbox"].selected.concat(l)}else for(e=0,f=l.length;f>e;e++)if(j[l[e]].state[o?"selected":"checked"]){for(g=0,h=j[l[e]].children_d.length;h>g;g++)j[j[l[e]].children_d[g]].state[o?"selected":"checked"]=!0;this._data[o?"core":"checkbox"].selected=this._data[o?"core":"checkbox"].selected.concat(j[l[e]].children_d)}if(-1!==n.indexOf("up")){for(e=0,f=k.children_d.length;f>e;e++)j[k.children_d[e]].children.length||m.push(j[k.children_d[e]].parent);for(m=b.vakata.array_unique(m),g=0,h=m.length;h>g;g++)for(k=j[m[g]];k&&"#"!==k.id;){for(d=0,e=0,f=k.children.length;f>e;e++)d+=j[k.children[e]].state[o?"selected":"checked"];if(d!==f)break;k.state[o?"selected":"checked"]=!0,this._data[o?"core":"checkbox"].selected.push(k.id),i=this.get_node(k,!0),i&&i.length&&i.attr("aria-selected",!0).children(".jstree-anchor").addClass(o?"jstree-clicked":"jstree-checked"),k=this.get_node(k.parent)}}this._data[o?"core":"checkbox"].selected=b.vakata.array_unique(this._data[o?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",b.proxy(function(a,c){var d,e,f,g,h=c.node,i=this._model.data,j=this.get_node(h.parent),k=this.get_node(h,!0),l=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection;if(-1!==l.indexOf("down"))for(this._data[m?"core":"checkbox"].selected=b.vakata.array_unique(this._data[m?"core":"checkbox"].selected.concat(h.children_d)),d=0,e=h.children_d.length;e>d;d++)g=i[h.children_d[d]],g.state[m?"selected":"checked"]=!0,g&&g.original&&g.original.state&&g.original.state.undetermined&&(g.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(;j&&"#"!==j.id;){for(f=0,d=0,e=j.children.length;e>d;d++)f+=i[j.children[d]].state[m?"selected":"checked"];if(f!==e)break;j.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(j.id),g=this.get_node(j,!0),g&&g.length&&g.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),j=this.get_node(j.parent)}-1!==l.indexOf("down")&&k.length&&k.find(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",b.proxy(function(a,b){var c,d,e,f=this.get_node("#"),g=this._model.data;for(c=0,d=f.children_d.length;d>c;c++)e=g[f.children_d[c]],e&&e.original&&e.original.state&&e.original.state.undetermined&&(e.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",b.proxy(function(a,c){var d,e,f,g=c.node,h=this.get_node(g,!0),i=this.settings.checkbox.cascade,j=this.settings.checkbox.tie_selection;if(g&&g.original&&g.original.state&&g.original.state.undetermined&&(g.original.state.undetermined=!1),-1!==i.indexOf("down"))for(d=0,e=g.children_d.length;e>d;d++)f=this._model.data[g.children_d[d]],f.state[j?"selected":"checked"]=!1,f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1);if(-1!==i.indexOf("up"))for(d=0,e=g.parents.length;e>d;d++)f=this._model.data[g.parents[d]],f.state[j?"selected":"checked"]=!1,f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1),f=this.get_node(g.parents[d],!0),f&&f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass(j?"jstree-clicked":"jstree-checked");for(f=[],d=0,e=this._data[j?"core":"checkbox"].selected.length;e>d;d++)-1!==i.indexOf("down")&&-1!==b.inArray(this._data[j?"core":"checkbox"].selected[d],g.children_d)||-1!==i.indexOf("up")&&-1!==b.inArray(this._data[j?"core":"checkbox"].selected[d],g.parents)||f.push(this._data[j?"core":"checkbox"].selected[d]);this._data[j?"core":"checkbox"].selected=b.vakata.array_unique(f),-1!==i.indexOf("down")&&h.length&&h.find(".jstree-anchor").removeClass(j?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",b.proxy(function(a,b){for(var c,d,e,f,g=this.get_node(b.parent),h=this._model.data,i=this.settings.checkbox.tie_selection;g&&"#"!==g.id;){for(e=0,c=0,d=g.children.length;d>c;c++)e+=h[g.children[c]].state[i?"selected":"checked"];if(e!==d)break;g.state[i?"selected":"checked"]=!0,this._data[i?"core":"checkbox"].selected.push(g.id),f=this.get_node(g,!0),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass(i?"jstree-clicked":"jstree-checked"),g=this.get_node(g.parent)}},this)).on("move_node.jstree",b.proxy(function(a,c){var d,e,f,g,h,i=c.is_multi,j=c.old_parent,k=this.get_node(c.parent),l=this._model.data,m=this.settings.checkbox.tie_selection;if(!i)for(d=this.get_node(j);d&&"#"!==d.id;){for(e=0,f=0,g=d.children.length;g>f;f++)e+=l[d.children[f]].state[m?"selected":"checked"];if(e!==g)break;d.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(d.id),h=this.get_node(d,!0),h&&h.length&&h.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}for(d=k;d&&"#"!==d.id;){for(e=0,f=0,g=d.children.length;g>f;f++)e+=l[d.children[f]].state[m?"selected":"checked"];if(e===g)d.state[m?"selected":"checked"]||(d.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(d.id),h=this.get_node(d,!0),h&&h.length&&h.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"));else{if(!d.state[m?"selected":"checked"])break;d.state[m?"selected":"checked"]=!1,this._data[m?"core":"checkbox"].selected=b.vakata.array_remove_item(this._data[m?"core":"checkbox"].selected,d.id),h=this.get_node(d,!0),h&&h.length&&h.attr("aria-selected",!1).children(".jstree-anchor").removeClass(m?"jstree-clicked":"jstree-checked")}d=this.get_node(d.parent)}},this))},this._undetermined=function(){if(null!==this.element){var a,b,d,e,f={},g=this._model.data,h=this.settings.checkbox.tie_selection,i=this._data[h?"core":"checkbox"].selected,j=[],k=this;for(a=0,b=i.length;b>a;a++)if(g[i[a]]&&g[i[a]].parents)for(d=0,e=g[i[a]].parents.length;e>d;d++)f[g[i[a]].parents[d]]===c&&"#"!==g[i[a]].parents[d]&&(f[g[i[a]].parents[d]]=!0,j.push(g[i[a]].parents[d]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var h,i=k.get_node(this);if(i.state.loaded){for(a=0,b=i.children_d.length;b>a;a++)if(h=g[i.children_d[a]],!h.state.loaded&&h.original&&h.original.state&&h.original.state.undetermined&&h.original.state.undetermined===!0)for(f[h.id]===c&&"#"!==h.id&&(f[h.id]=!0,j.push(h.id)),d=0,e=h.parents.length;e>d;d++)f[h.parents[d]]===c&&"#"!==h.parents[d]&&(f[h.parents[d]]=!0,j.push(h.parents[d]))}else if(i.original&&i.original.state&&i.original.state.undetermined&&i.original.state.undetermined===!0)for(f[i.id]===c&&"#"!==i.id&&(f[i.id]=!0,j.push(i.id)),d=0,e=i.parents.length;e>d;d++)f[i.parents[d]]===c&&"#"!==i.parents[d]&&(f[i.parents[d]]=!0,j.push(i.parents[d]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),a=0,b=j.length;b>a;a++)g[j[a]].state[h?"selected":"checked"]||(i=this.get_node(j[a],!0),i&&i.length&&i.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}},this.redraw_node=function(a,c,e,f){if(a=d.redraw_node.apply(this,arguments)){var g,h,i=null;for(g=0,h=a.childNodes.length;h>g;g++)if(a.childNodes[g]&&a.childNodes[g].className&&-1!==a.childNodes[g].className.indexOf("jstree-anchor")){i=a.childNodes[g];break}i&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(i.className+=" jstree-checked"),i.insertBefore(n.cloneNode(!1),i.childNodes[0]))}return e||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(b.proxy(this._undetermined,this),50)),a},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(a){a=this.get_node(a);var c,d,e=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection,g=this._data[f?"core":"checkbox"].selected,h=this._model.data;if(!a||a.state[f?"selected":"checked"]===!0||-1===e.indexOf("undetermined")||-1===e.indexOf("down")&&-1===e.indexOf("up"))return!1;if(!a.state.loaded&&a.original.state.undetermined===!0)return!0;for(c=0,d=a.children_d.length;d>c;c++)if(-1!==b.inArray(a.children_d[c],g)||!h[a.children_d[c]].state.loaded&&h[a.children_d[c]].original.state.undetermined)return!0;return!1},this.activate_node=function(a,c){return this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||b(c.target).hasClass("jstree-checkbox"))&&(c.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!b(c.target).hasClass("jstree-checkbox")?d.activate_node.call(this,a,c):this.is_disabled(a)?!1:(this.is_checked(a)?this.uncheck_node(a,c):this.check_node(a,c),void this.trigger("activate_node",{node:this.get_node(a)}))},this.check_node=function(a,c){if(this.settings.checkbox.tie_selection)return this.select_node(a,!1,!0,c);var d,e,f;if(b.isArray(a)){for(a=a.slice(),e=0,f=a.length;f>e;e++)this.check_node(a[e],c);return!0}return a=this.get_node(a),a&&"#"!==a.id?(d=this.get_node(a,!0),void(a.state.checked||(a.state.checked=!0,this._data.checkbox.selected.push(a.id),d&&d.length&&d.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:a,selected:this._data.checkbox.selected,event:c})))):!1},this.uncheck_node=function(a,c){if(this.settings.checkbox.tie_selection)return this.deselect_node(a,!1,c);var d,e,f;if(b.isArray(a)){for(a=a.slice(),d=0,e=a.length;e>d;d++)this.uncheck_node(a[d],c);return!0}return a=this.get_node(a),a&&"#"!==a.id?(f=this.get_node(a,!0),void(a.state.checked&&(a.state.checked=!1,this._data.checkbox.selected=b.vakata.array_remove_item(this._data.checkbox.selected,a.id),f.length&&f.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:a,selected:this._data.checkbox.selected,event:c})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var a,b;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),a=0,b=this._data.checkbox.selected.length;b>a;a++)this._model.data[this._data.checkbox.selected[a]]&&(this._model.data[this._data.checkbox.selected[a]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var a,b,c=this._data.checkbox.selected.concat([]);for(a=0,b=this._data.checkbox.selected.length;b>a;a++)this._model.data[this._data.checkbox.selected[a]]&&(this._model.data[this._data.checkbox.selected[a]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:c})},this.is_checked=function(a){return this.settings.checkbox.tie_selection?this.is_selected(a):(a=this.get_node(a),a&&"#"!==a.id?a.state.checked:!1)},this.get_checked=function(a){return this.settings.checkbox.tie_selection?this.get_selected(a):a?b.map(this._data.checkbox.selected,b.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected},this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);var c,d,e,f,g=this.get_checked(!0),h={};for(c=0,d=g.length;d>c;c++)h[g[c].id]=g[c];for(c=0,d=g.length;d>c;c++)for(e=0,f=g[c].children_d.length;f>e;e++)h[g[c].children_d[e]]&&delete h[g[c].children_d[e]];g=[];for(c in h)h.hasOwnProperty(c)&&g.push(c);return a?b.map(g,b.proxy(function(a){return this.get_node(a)},this)):g},this.get_bottom_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(a);var c,d,e=this.get_checked(!0),f=[];for(c=0,d=e.length;d>c;c++)e[c].children.length||f.push(e[c].id);return a?b.map(f,b.proxy(function(a){return this.get_node(a)},this)):f},this.load_node=function(a,c){var e,f,g,h;if(!b.isArray(a)&&!this.settings.checkbox.tie_selection&&(h=this.get_node(a),h&&h.state.loaded))for(e=0,f=h.children_d.length;f>e;e++)this._model.data[h.children_d[e]].state.checked&&(g=!0,this._data.checkbox.selected=b.vakata.array_remove_item(this._data.checkbox.selected,h.children_d[e]));return d.load_node.apply(this,arguments)},this.get_state=function(){var a=d.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?a:(a.checkbox=this._data.checkbox.selected.slice(),a)},this.set_state=function(a,c){var e=d.set_state.apply(this,arguments);if(e&&a.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var f=this;b.each(a.checkbox,function(a,b){f.check_node(b)})}return delete a.checkbox,this.set_state(a,c),!1}return e}},b.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,c){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.create_node(d,{},"last",function(a){setTimeout(function(){c.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.edit(d)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.is_selected(d)?c.delete_node(c.get_selected()):c.delete_node(d)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.is_selected(d)?c.cut(c.get_top_selected()):c.cut(d)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.is_selected(d)?c.copy(c.get_top_selected()):c.copy(d)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!b.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",action:function(a){var c=b.jstree.reference(a.reference),d=c.get_node(a.reference);c.paste(d)}}}}}}},b.jstree.plugins.contextmenu=function(a,d){this.bind=function(){d.bind.call(this);var a,c,e=0,f=null;this.element.on("contextmenu.jstree",".jstree-anchor",b.proxy(function(a,b){a.preventDefault(),e=a.ctrlKey?+new Date:0,(b||f)&&(e=+new Date+1e4),f&&clearTimeout(f),this.is_loading(a.currentTarget)||this.show_contextmenu(a.currentTarget,a.pageX,a.pageY,a)},this)).on("click.jstree",".jstree-anchor",b.proxy(function(a){this._data.contextmenu.visible&&(!e||+new Date-e>250)&&b.vakata.context.hide(),e=0},this)).on("touchstart.jstree",".jstree-anchor",function(d){d.originalEvent&&d.originalEvent.changedTouches&&d.originalEvent.changedTouches[0]&&(a=d.pageX,c=d.pageY,f=setTimeout(function(){b(d.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(b){f&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(Math.abs(a-b.pageX)>50||Math.abs(c-b.pageY)>50)&&clearTimeout(f)}).on("touchend.vakata.jstree",function(a){f&&clearTimeout(f)}),b(l).on("context_hide.vakata.jstree",b.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&b.vakata.context.hide(),d.teardown.call(this)},this.show_contextmenu=function(a,d,e,f){if(a=this.get_node(a),!a||"#"===a.id)return!1;var g=this.settings.contextmenu,h=this.get_node(a,!0),i=h.children(".jstree-anchor"),j=!1,k=!1;(g.show_at_node||d===c||e===c)&&(j=i.offset(),d=j.left,e=j.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(a)&&this.activate_node(a,f),k=g.items,b.isFunction(k)&&(k=k.call(this,a,b.proxy(function(b){this._show_contextmenu(a,d,e,b)},this))),b.isPlainObject(k)&&this._show_contextmenu(a,d,e,k)},this._show_contextmenu=function(a,c,d,e){var f=this.get_node(a,!0),g=f.children(".jstree-anchor");b(l).one("context_show.vakata.jstree",b.proxy(function(a,c){var d="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";b(c.element).addClass(d)},this)),this._data.contextmenu.visible=!0,b.vakata.context.show(g,{x:c,y:d},e),this.trigger("show_contextmenu",{node:a,x:c,y:d})}},function(b){var c=!1,d={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};b.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(a){b(l).triggerHandler("context_"+a+".vakata",{reference:d.reference,element:d.element,position:{x:d.position_x,y:d.position_y}})},_execute:function(a){return a=d.items[a],a&&(!a._disabled||b.isFunction(a._disabled)&&!a._disabled({item:a,reference:d.reference,element:d.element}))&&a.action?a.action.call(null,{item:a,reference:d.reference,element:d.element,position:{x:d.position_x,y:d.position_y}}):!1},_parse:function(a,c){if(!a)return!1;c||(d.html="",d.items=[]);var e,f="",g=!1;return c&&(f+="<ul>"),b.each(a,function(a,c){return c?(d.items.push(c),!g&&c.separator_before&&(f+="<li class='vakata-context-separator'><a href='#' "+(b.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),g=!1,f+="<li class='"+(c._class||"")+(c._disabled===!0||b.isFunction(c._disabled)&&c._disabled({item:c,reference:d.reference,element:d.element})?" vakata-contextmenu-disabled ":"")+"' "+(c.shortcut?" data-shortcut='"+c.shortcut+"' ":"")+">",f+="<a href='#' rel='"+(d.items.length-1)+"'>",b.vakata.context.settings.icons&&(f+="<i ",c.icon&&(f+=-1!==c.icon.indexOf("/")||-1!==c.icon.indexOf(".")?" style='background:url(\""+c.icon+"\") center center no-repeat' ":" class='"+c.icon+"' "),f+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),f+=(b.isFunction(c.label)?c.label({item:a,reference:d.reference,element:d.element}):c.label)+(c.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+c.shortcut+'">'+(c.shortcut_label||"")+"</span>":"")+"</a>",c.submenu&&(e=b.vakata.context._parse(c.submenu,!0),e&&(f+=e)),f+="</li>",void(c.separator_after&&(f+="<li class='vakata-context-separator'><a href='#' "+(b.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",g=!0))):!0}),f=f.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),c&&(f+="</ul>"),c||(d.html=f,b.vakata.context._trigger("parse")),f.length>10?f:!1},_show_submenu:function(d){if(d=b(d),d.length&&d.children("ul").length){var e=d.children("ul"),f=d.offset().left+d.outerWidth(),g=d.offset().top,h=e.width(),i=e.height(),j=b(a).width()+b(a).scrollLeft(),k=b(a).height()+b(a).scrollTop();c?d[f-(h+10+d.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):d[f+h+10>j?"addClass":"removeClass"]("vakata-context-right"),g+i+10>k&&e.css("bottom","-1px"),e.show()}},show:function(e,f,g){var h,i,j,k,l,m,n,o,p=!0;switch(d.element&&d.element.length&&d.element.width(""),p){case!f&&!e:return!1;case!!f&&!!e:d.reference=e,d.position_x=f.x,d.position_y=f.y;break;case!f&&!!e:d.reference=e,h=e.offset(),d.position_x=h.left+e.outerHeight(),d.position_y=h.top;break;case!!f&&!e:d.position_x=f.x,d.position_y=f.y}e&&!g&&b(e).data("vakata_contextmenu")&&(g=b(e).data("vakata_contextmenu")),b.vakata.context._parse(g)&&d.element.html(d.html),d.items.length&&(d.element.appendTo("body"),i=d.element,j=d.position_x,k=d.position_y,l=i.width(),m=i.height(),n=b(a).width()+b(a).scrollLeft(),o=b(a).height()+b(a).scrollTop(),c&&(j-=i.outerWidth()-b(e).outerWidth(),j<b(a).scrollLeft()+20&&(j=b(a).scrollLeft()+20)),j+l+20>n&&(j=n-(l+20)),k+m+20>o&&(k=o-(m+20)),d.element.css({left:j,top:k}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),d.is_visible=!0,b.vakata.context._trigger("show"))},hide:function(){d.is_visible&&(d.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),d.is_visible=!1,b.vakata.context._trigger("hide"))}},b(function(){c="rtl"===b("body").css("direction");var a=!1;d.element=b("<ul class='vakata-context'></ul>"),d.element.on("mouseenter","li",function(c){c.stopImmediatePropagation(),b.contains(this,c.relatedTarget)||(a&&clearTimeout(a),d.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),b(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),b.vakata.context._show_submenu(this))}).on("mouseleave","li",function(a){b.contains(this,a.relatedTarget)||b(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(c){b(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),b.vakata.context.settings.hide_onmouseleave&&(a=setTimeout(function(a){return function(){b.vakata.context.hide()}}(this),b.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(a){a.preventDefault(),b(this).blur().parent().hasClass("vakata-context-disabled")||b.vakata.context._execute(b(this).attr("rel"))===!1||b.vakata.context.hide()}).on("keydown","a",function(a){var c=null;switch(a.which){case 13:case 32:a.type="mouseup",a.preventDefault(),b(a.currentTarget).trigger(a);break;case 37:d.is_visible&&(d.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),a.stopImmediatePropagation(),a.preventDefault());break;case 38:d.is_visible&&(c=d.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),c.length||(c=d.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),c.addClass("vakata-context-hover").children("a").focus(),a.stopImmediatePropagation(),a.preventDefault());break;case 39:d.is_visible&&(d.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),a.stopImmediatePropagation(),a.preventDefault());break;case 40:d.is_visible&&(c=d.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),c.length||(c=d.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),c.addClass("vakata-context-hover").children("a").focus(),a.stopImmediatePropagation(),a.preventDefault());break;case 27:b.vakata.context.hide(),a.preventDefault()}}).on("keydown",function(a){a.preventDefault();var b=d.element.find(".vakata-contextmenu-shortcut-"+a.which).parent();b.parent().not(".vakata-context-disabled")&&b.click()}),b(l).on("mousedown.vakata.jstree",function(a){d.is_visible&&!b.contains(d.element[0],a.target)&&b.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,b){d.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),c&&d.element.addClass("vakata-context-rtl").css("direction","rtl"),d.element.find("ul").hide().end()})})}(b),b.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1},b.jstree.plugins.dnd=function(a,c){this.bind=function(){c.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",b.proxy(function(a){if(this.settings.dnd.large_drag_target&&b(a.target).closest(".jstree-node")[0]!==a.currentTarget)return!0;if("touchstart"===a.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!b(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var c=this.get_node(a.target),d=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,e=d>1?d+" "+this.get_string("nodes"):this.get_text(a.currentTarget);return this.settings.core.force_text&&(e=b.vakata.html.escape(e)),c&&c.id&&"#"!==c.id&&(1===a.which||"touchstart"===a.type)&&(this.settings.dnd.is_draggable===!0||b.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,d>1?this.get_top_selected(!0):[c]))?(this.element.trigger("mousedown.jstree"),b.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:d>1?this.get_top_selected():[c.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+e+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},b(function(){var a=!1,c=!1,d=!1,e=b('<div id="jstree-marker">&#160;</div>').hide();b(l).on("dnd_start.vakata.jstree",function(b,c){a=!1,c&&c.data&&c.data.jstree&&e.appendTo("body")}).on("dnd_move.vakata.jstree",function(f,g){if(d&&clearTimeout(d),g&&g.data&&g.data.jstree&&(!g.event.target.id||"jstree-marker"!==g.event.target.id)){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=b.jstree.reference(g.event.target),w=!1,x=!1,y=!1;if(v&&v._data&&v._data.dnd)if(e.attr("class","jstree-"+v.get_theme()+(v.settings.core.themes.responsive?" jstree-dnd-responsive":"")),g.helper.children().attr("class","jstree-"+v.get_theme()+" jstree-"+v.get_theme()+"-"+v.get_theme_variant()+" "+(v.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"show":"hide"](),g.event.target!==v.element[0]&&g.event.target!==v.get_container_ul()[0]||0!==v.get_container_ul().children().length){if(w=v.settings.dnd.large_drop_target?b(g.event.target).closest(".jstree-node").children(".jstree-anchor"):b(g.event.target).closest(".jstree-anchor"),w&&w.length&&w.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(x=w.offset(),y=g.event.pageY-x.top,j=w.outerHeight(),m=j/3>y?["b","i","a"]:y>j-j/3?["a","i","b"]:y>j/2?["i","a","b"]:["i","b","a"],b.each(m,function(f,y){switch(y){case"b":h=x.left-6,i=x.top,k=v.get_parent(w),l=w.parent().index();break;case"i":t=v.settings.dnd.inside_pos,u=v.get_node(w.parent()),h=x.left-2,i=x.top+j/2+1,k=u.id,l="first"===t?0:"last"===t?u.children.length:Math.min(t,u.children.length);break;case"a":h=x.left-6,i=x.top+j,k=v.get_parent(w),l=w.parent().index()+1}for(n=!0,o=0,p=g.data.nodes.length;p>o;o++)if(q=g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",r=l,"move_node"===q&&"a"===y&&g.data.origin&&g.data.origin===v&&k===v.get_parent(g.data.nodes[o])&&(s=v.get_node(k),r>b.inArray(g.data.nodes[o],s.children)&&(r-=1)),n=n&&(v&&v.settings&&v.settings.dnd&&v.settings.dnd.check_while_dragging===!1||v.check(q,g.data.origin&&g.data.origin!==v?g.data.origin.get_node(g.data.nodes[o]):g.data.nodes[o],k,r,{dnd:!0,ref:v.get_node(w.parent()),pos:y,origin:g.data.origin,is_multi:g.data.origin&&g.data.origin!==v,is_foreign:!g.data.origin})),!n){v&&v.last_error&&(c=v.last_error());break}return"i"===y&&w.parent().is(".jstree-closed")&&v.settings.dnd.open_timeout&&(d=setTimeout(function(a,b){return function(){a.open_node(b)}}(v,w),v.settings.dnd.open_timeout)),n?(a={ins:v,par:k,pos:"i"!==y||"last"!==t||0!==l||v.is_loaded(u)?l:"last"},e.css({left:h+"px",top:i+"px"}).show(),g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),c={},m=!0,!1):void 0}),m===!0))return}else{for(n=!0,o=0,p=g.data.nodes.length;p>o&&(n=n&&v.check(g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",g.data.origin&&g.data.origin!==v?g.data.origin.get_node(g.data.nodes[o]):g.data.nodes[o],"#","last",{dnd:!0,ref:v.get_node("#"),pos:"i",origin:g.data.origin,is_multi:g.data.origin&&g.data.origin!==v,is_foreign:!g.data.origin}),n);o++);if(n)return a={ins:v,par:"#",pos:"last"},e.hide(),void g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}a=!1,g.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),e.hide()}}).on("dnd_scroll.vakata.jstree",function(b,c){c&&c.data&&c.data.jstree&&(e.hide(),a=!1,c.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(f,g){if(d&&clearTimeout(d),g&&g.data&&g.data.jstree){e.hide().detach();var h,i,j=[];if(a){for(h=0,i=g.data.nodes.length;i>h;h++)j[h]=g.data.origin?g.data.origin.get_node(g.data.nodes[h]):g.data.nodes[h];a.ins[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node"](j,a.par,a.pos,!1,!1,!1,g.data.origin)}else h=b(g.event.target).closest(".jstree"),h.length&&c&&c.error&&"check"===c.error&&(h=h.jstree(!0),h&&h.settings.core.error.call(this,c))}}).on("keyup.jstree keydown.jstree",function(a,c){c=b.vakata.dnd._get(),c&&c.data&&c.data.jstree&&c.helper.find(".jstree-copy").first()[c.data.origin&&(c.data.origin.settings.dnd.always_copy||c.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey))?"show":"hide"]()})}),function(b){b.vakata.html={div:b("<div />"),escape:function(a){return b.vakata.html.div.text(a).html()},strip:function(a){return b.vakata.html.div.empty().append(b.parseHTML(a)).text()}};var c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};b.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(a,c){var d=b.vakata.dnd._get();d.event=c,b(l).triggerHandler("dnd_"+a+".vakata",d)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},b(l).off("mousemove.vakata.jstree touchmove.vakata.jstree",b.vakata.dnd.drag),b(l).off("mouseup.vakata.jstree touchend.vakata.jstree",b.vakata.dnd.stop)},_scroll:function(a){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t)return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1;if(!c.scroll_i)return c.scroll_i=setInterval(b.vakata.dnd._scroll,100),!1;if(a===!0)return!1;var d=c.scroll_e.scrollTop(),e=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(d+c.scroll_t*b.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(e+c.scroll_l*b.vakata.dnd.settings.scroll_speed),(d!==c.scroll_e.scrollTop()||e!==c.scroll_e.scrollLeft())&&b.vakata.dnd._trigger("scroll",c.scroll_e)},start:function(d,e,f){"touchstart"===d.type&&d.originalEvent&&d.originalEvent.changedTouches&&d.originalEvent.changedTouches[0]&&(d.pageX=d.originalEvent.changedTouches[0].pageX,d.pageY=d.originalEvent.changedTouches[0].pageY,d.target=l.elementFromPoint(d.originalEvent.changedTouches[0].pageX-a.pageXOffset,d.originalEvent.changedTouches[0].pageY-a.pageYOffset)),c.is_drag&&b.vakata.dnd.stop({});try{d.currentTarget.unselectable="on",d.currentTarget.onselectstart=function(){return!1},d.currentTarget.style&&(d.currentTarget.style.MozUserSelect="none");
}catch(g){}return c.init_x=d.pageX,c.init_y=d.pageY,c.data=e,c.is_down=!0,c.element=d.currentTarget,c.target=d.target,c.is_touch="touchstart"===d.type,f!==!1&&(c.helper=b("<div id='vakata-dnd'></div>").html(f).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),b(l).on("mousemove.vakata.jstree touchmove.vakata.jstree",b.vakata.dnd.drag),b(l).on("mouseup.vakata.jstree touchend.vakata.jstree",b.vakata.dnd.stop),!1},drag:function(d){if("touchmove"===d.type&&d.originalEvent&&d.originalEvent.changedTouches&&d.originalEvent.changedTouches[0]&&(d.pageX=d.originalEvent.changedTouches[0].pageX,d.pageY=d.originalEvent.changedTouches[0].pageY,d.target=l.elementFromPoint(d.originalEvent.changedTouches[0].pageX-a.pageXOffset,d.originalEvent.changedTouches[0].pageY-a.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(d.pageX-c.init_x)>(c.is_touch?b.vakata.dnd.settings.threshold_touch:b.vakata.dnd.settings.threshold)||Math.abs(d.pageY-c.init_y)>(c.is_touch?b.vakata.dnd.settings.threshold_touch:b.vakata.dnd.settings.threshold)))return;c.helper&&(c.helper.appendTo("body"),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,b.vakata.dnd._trigger("start",d)}var e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!1,m=!1,n=!1,o=!1;return c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,b(b(d.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(b(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var a=b(this),e=a.offset();return this.scrollHeight>this.offsetHeight&&(e.top+a.height()-d.pageY<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),d.pageY-e.top<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(e.left+a.width()-d.pageX<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),d.pageX-e.left<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=b(this),!1):void 0}),c.scroll_e||(e=b(l),f=b(a),g=e.height(),h=f.height(),i=e.width(),j=f.width(),k=e.scrollTop(),m=e.scrollLeft(),g>h&&d.pageY-k<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),g>h&&h-(d.pageY-k)<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),i>j&&d.pageX-m<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),i>j&&j-(d.pageX-m)<b.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=e)),c.scroll_e&&b.vakata.dnd._scroll(!0),c.helper&&(n=parseInt(d.pageY+b.vakata.dnd.settings.helper_top,10),o=parseInt(d.pageX+b.vakata.dnd.settings.helper_left,10),g&&n+25>g&&(n=g-50),i&&o+c.helper_w>i&&(o=i-(c.helper_w+2)),c.helper.css({left:o+"px",top:n+"px"})),b.vakata.dnd._trigger("move",d),!1}},stop:function(d){if("touchend"===d.type&&d.originalEvent&&d.originalEvent.changedTouches&&d.originalEvent.changedTouches[0]&&(d.pageX=d.originalEvent.changedTouches[0].pageX,d.pageY=d.originalEvent.changedTouches[0].pageY,d.target=l.elementFromPoint(d.originalEvent.changedTouches[0].pageX-a.pageXOffset,d.originalEvent.changedTouches[0].pageY-a.pageYOffset)),c.is_drag)b.vakata.dnd._trigger("stop",d);else if("touchend"===d.type&&d.target===c.target){var e=setTimeout(function(){b(d.target).click()},100);b(d.target).one("click",function(){e&&clearTimeout(e)})}return b.vakata.dnd._clean(),!1}}}(b),b.jstree.defaults.massload=null,b.jstree.plugins.massload=function(a,c){this.init=function(a,b){c.init.call(this,a,b),this._data.massload={}},this._load_nodes=function(a,d,e){var f=this.settings.massload;return e&&!b.isEmptyObject(this._data.massload)?c._load_nodes.call(this,a,d,e):b.isFunction(f)?f.call(this,a,b.proxy(function(b){if(b)for(var f in b)b.hasOwnProperty(f)&&(this._data.massload[f]=b[f]);c._load_nodes.call(this,a,d,e)},this)):"object"==typeof f&&f&&f.url?(f=b.extend(!0,{},f),b.isFunction(f.url)&&(f.url=f.url.call(this,a)),b.isFunction(f.data)&&(f.data=f.data.call(this,a)),b.ajax(f).done(b.proxy(function(b,f,g){if(b)for(var h in b)b.hasOwnProperty(h)&&(this._data.massload[h]=b[h]);c._load_nodes.call(this,a,d,e)},this)).fail(b.proxy(function(b){c._load_nodes.call(this,a,d,e)},this))):c._load_nodes.call(this,a,d,e)},this._load_node=function(a,d){var e=this._data.massload[a.id];return e?this["string"==typeof e?"_append_html_data":"_append_json_data"](a,"string"==typeof e?b(b.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(b){d.call(this,b),delete this._data.massload[a.id]}):c._load_node.call(this,a,d)}},b.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},b.jstree.plugins.search=function(a,d){this.bind=function(){d.bind.call(this),this._data.search.str="",this._data.search.dom=b(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this.element.on("before_open.jstree",b.proxy(function(a,c){var d,e,f=this._data.search.res,g=[],h=b();if(f&&f.length&&(this._data.search.dom=b(this.element[0].querySelectorAll("#"+b.map(f,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(b.jstree.idregex,"\\$&"):a.replace(b.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){for(d=0,e=f.length;e>d;d++)g=g.concat(this.get_node(f[d]).parents);g=b.vakata.array_remove_item(b.vakata.array_unique(g),"#"),h=g.length?b(this.element[0].querySelectorAll("#"+b.map(g,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(b.jstree.idregex,"\\$&"):a.replace(b.jstree.idregex,"\\$&")}).join(", #"))):b(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),h=h.add(this._data.search.dom),this._data.search.smc&&this._data.search.dom.children(".jstree-children").find(".jstree-node").show(),h.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){b(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",b.proxy(function(a,c){this._data.search.som&&c.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),this._data.search.smc&&c.nodes.children(".jstree-children").find(".jstree-node").show(),c.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){b(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},this)).on("clear_search.jstree",b.proxy(function(a,b){this._data.search.som&&b.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))},this.search=function(a,d,e,f,g,h){if(a===!1||""===b.trim(a.toString()))return this.clear_search();f=this.get_node(f),f=f&&f.id?f.id:null,a=a.toString();var i=this.settings.search,j=i.ajax?i.ajax:!1,k=this._model.data,l=null,m=[],n=[];return this._data.search.res.length&&!g&&this.clear_search(),e===c&&(e=i.show_only_matches),h===c&&(h=i.show_only_matches_children),d||j===!1?(g||(this._data.search.str=a,this._data.search.dom=b(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=e,this._data.search.smc=h),l=new b.vakata.search(a,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),b.each(k[f?f:"#"].children_d,function(b,c){var d=k[c];d.text&&(i.search_callback&&i.search_callback.call(this,a,d)||!i.search_callback&&l.search(d.text).isMatch)&&(!i.search_leaves_only||d.state.loaded&&0===d.children.length)&&(m.push(c),n=n.concat(d.parents))}),m.length&&(n=b.vakata.array_unique(n),this._search_open(n),g?(this._data.search.dom=this._data.search.dom.add(b(this.element[0].querySelectorAll("#"+b.map(m,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(b.jstree.idregex,"\\$&"):a.replace(b.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=b.vakata.array_unique(this._data.search.res.concat(m))):(this._data.search.dom=b(this.element[0].querySelectorAll("#"+b.map(m,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(b.jstree.idregex,"\\$&"):a.replace(b.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=m),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),void this.trigger("search",{nodes:this._data.search.dom,str:a,res:this._data.search.res,show_only_matches:e})):b.isFunction(j)?j.call(this,a,b.proxy(function(c){c&&c.d&&(c=c.d),this._load_nodes(b.isArray(c)?b.vakata.array_unique(c):[],function(){this.search(a,!0,e,f,g)},!0)},this),f):(j=b.extend({},j),j.data||(j.data={}),j.data.str=a,f&&(j.data.inside=f),b.ajax(j).fail(b.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(j)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(b.proxy(function(c){c&&c.d&&(c=c.d),this._load_nodes(b.isArray(c)?b.vakata.array_unique(c):[],function(){this.search(a,!0,e,f,g)},!0)},this)))},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=b()},this._search_open=function(a){var c=this;b.each(a.concat([]),function(d,e){if("#"===e)return!0;try{e=b("#"+e.replace(b.jstree.idregex,"\\$&"),c.element)}catch(f){}e&&e.length&&c.is_closed(e)&&(c._data.search.opn.push(e[0].id),c.open_node(e,function(){c._search_open(a)},0))})}},function(a){a.vakata.search=function(b,c,d){d=d||{},d=a.extend({},a.vakata.search.defaults,d),d.fuzzy!==!1&&(d.fuzzy=!0),b=d.caseSensitive?b:b.toLowerCase();var e,f,g,h,i=d.location,j=d.distance,k=d.threshold,l=b.length;return l>32&&(d.fuzzy=!1),d.fuzzy&&(e=1<<l-1,f=function(){var a={},c=0;for(c=0;l>c;c++)a[b.charAt(c)]=0;for(c=0;l>c;c++)a[b.charAt(c)]|=1<<l-c-1;return a}(),g=function(a,b){var c=a/l,d=Math.abs(i-b);return j?c+d/j:d?1:c}),h=function(a){if(a=d.caseSensitive?a:a.toLowerCase(),b===a||-1!==a.indexOf(b))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var c,h,j,m,n,o,p,q,r,s=a.length,t=k,u=a.indexOf(b,i),v=l+s,w=1,x=[];for(-1!==u&&(t=Math.min(g(0,u),t),u=a.lastIndexOf(b,i+l),-1!==u&&(t=Math.min(g(0,u),t))),u=-1,c=0;l>c;c++){for(j=0,m=v;m>j;)g(c,i+m)<=t?j=m:v=m,m=Math.floor((v-j)/2+j);for(v=m,o=Math.max(1,i-m+1),p=Math.min(i+m,s)+l,q=new Array(p+2),q[p+1]=(1<<c)-1,h=p;h>=o;h--)if(r=f[a.charAt(h-1)],0===c?q[h]=(q[h+1]<<1|1)&r:q[h]=(q[h+1]<<1|1)&r|((n[h+1]|n[h])<<1|1)|n[h+1],q[h]&e&&(w=g(c,h-1),t>=w)){if(t=w,u=h-1,x.push(u),!(u>i))break;o=Math.max(1,2*i-u)}if(g(c+1,i)>t)break;n=q}return{isMatch:u>=0,score:w}},c===!0?{search:h}:h(c)},a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(b),b.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},b.jstree.plugins.sort=function(a,c){this.bind=function(){c.bind.call(this),this.element.on("model.jstree",b.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",b.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1),this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",b.proxy(function(a,b){this.sort(b.parent,!1),this.redraw_node(b.parent,!0)},this))},this.sort=function(a,c){var d,e;if(a=this.get_node(a),a&&a.children&&a.children.length&&(a.children.sort(b.proxy(this.settings.sort,this)),c))for(d=0,e=a.children_d.length;e>d;d++)this.sort(a.children_d[d],!1)}};var o=!1;b.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},b.jstree.plugins.state=function(a,c){this.bind=function(){c.bind.call(this);var a=b.proxy(function(){this.element.on(this.settings.state.events,b.proxy(function(){o&&clearTimeout(o),o=setTimeout(b.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",b.proxy(function(b,c){this.element.one("restore_state.jstree",a),this.restore_state()||a()},this))},this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};b.vakata.storage.set(this.settings.state.key,JSON.stringify(a))},this.restore_state=function(){var a=b.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(c){return!1}return a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl?!1:(a&&a.state&&(a=a.state),a&&b.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a)),a?(this.element.one("set_state.jstree",function(c,d){d.instance.trigger("restore_state",{state:b.extend(!0,{},a)})}),this.set_state(a),!0):!1)},this.clear_state=function(){return b.vakata.storage.del(this.settings.state.key)}},function(b,c){b.vakata.storage={set:function(b,c){return a.localStorage.setItem(b,c)},get:function(b){return a.localStorage.getItem(b)},del:function(b){return a.localStorage.removeItem(b)}}}(b),b.jstree.defaults.types={"#":{},"default":{}},b.jstree.plugins.types=function(a,d){this.init=function(a,b){var e,f;if(b&&b.types&&b.types["default"])for(e in b.types)if("default"!==e&&"#"!==e&&b.types.hasOwnProperty(e))for(f in b.types["default"])b.types["default"].hasOwnProperty(f)&&b.types[e][f]===c&&(b.types[e][f]=b.types["default"][f]);d.init.call(this,a,b),this._model.data["#"].type="#"},this.refresh=function(a,b){d.refresh.call(this,a,b),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",b.proxy(function(a,b){var d,e,f=this._model.data,g=b.nodes,h=this.settings.types,i="default";for(d=0,e=g.length;e>d;d++)i="default",f[g[d]].original&&f[g[d]].original.type&&h[f[g[d]].original.type]&&(i=f[g[d]].original.type),f[g[d]].data&&f[g[d]].data.jstree&&f[g[d]].data.jstree.type&&h[f[g[d]].data.jstree.type]&&(i=f[g[d]].data.jstree.type),f[g[d]].type=i,f[g[d]].icon===!0&&h[i].icon!==c&&(f[g[d]].icon=h[i].icon);f["#"].type="#"},this)),d.bind.call(this)},this.get_json=function(a,c,e){var f,g,h=this._model.data,i=c?b.extend(!0,{},c,{no_id:!1}):{},j=d.get_json.call(this,a,i,e);if(j===!1)return!1;if(b.isArray(j))for(f=0,g=j.length;g>f;f++)j[f].type=j[f].id&&h[j[f].id]&&h[j[f].id].type?h[j[f].id].type:"default",c&&c.no_id&&(delete j[f].id,j[f].li_attr&&j[f].li_attr.id&&delete j[f].li_attr.id,j[f].a_attr&&j[f].a_attr.id&&delete j[f].a_attr.id);else j.type=j.id&&h[j.id]&&h[j.id].type?h[j.id].type:"default",c&&c.no_id&&(j=this._delete_ids(j));return j},this._delete_ids=function(a){if(b.isArray(a)){for(var c=0,d=a.length;d>c;c++)a[c]=this._delete_ids(a[c]);return a}return delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id,a.children&&b.isArray(a.children)&&(a.children=this._delete_ids(a.children)),a},this.check=function(a,e,f,g,h){if(d.check.call(this,a,e,f,g,h)===!1)return!1;e=e&&e.id?e:this.get_node(e),f=f&&f.id?f:this.get_node(f);var i,j,k,l,m=e&&e.id?h&&h.origin?h.origin:b.jstree.reference(e.id):null;switch(m=m&&m._model&&m._model.data?m._model.data:null,a){case"create_node":case"move_node":case"copy_node":if("move_node"!==a||-1===b.inArray(e.id,f.children)){if(i=this.get_rules(f),i.max_children!==c&&-1!==i.max_children&&i.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(i.valid_children!==c&&-1!==i.valid_children&&-1===b.inArray(e.type||"default",i.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(m&&e.children_d&&e.parents){for(j=0,k=0,l=e.children_d.length;l>k;k++)j=Math.max(j,m[e.children_d[k]].parents.length);j=j-e.parents.length+1}(0>=j||j===c)&&(j=1);do{if(i.max_depth!==c&&-1!==i.max_depth&&i.max_depth<j)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent),i=this.get_rules(f),j++}while(f)}}return!0},this.get_rules=function(a){if(a=this.get_node(a),!a)return!1;var b=this.get_type(a,!0);return b.max_depth===c&&(b.max_depth=-1),b.max_children===c&&(b.max_children=-1),b.valid_children===c&&(b.valid_children=-1),b},this.get_type=function(a,c){return a=this.get_node(a),a?c?b.extend({type:a.type},this.settings.types[a.type]):a.type:!1},this.set_type=function(a,d){var e,f,g,h,i;if(b.isArray(a)){for(a=a.slice(),f=0,g=a.length;g>f;f++)this.set_type(a[f],d);return!0}return e=this.settings.types,a=this.get_node(a),e[d]&&a?(h=a.type,i=this.get_icon(a),a.type=d,(i===!0||e[h]&&e[h].icon!==c&&i===e[h].icon)&&this.set_icon(a,e[d].icon!==c?e[d].icon:!0),!0):!1}},b.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,b){return a+" ("+b+")"}},b.jstree.plugins.unique=function(a,d){this.check=function(a,c,e,f,g){if(d.check.call(this,a,c,e,f,g)===!1)return!1;if(c=c&&c.id?c:this.get_node(c),e=e&&e.id?e:this.get_node(e),!e||!e.children)return!0;var h,i,j="rename_node"===a?f:c.text,k=[],l=this.settings.unique.case_sensitive,m=this._model.data;for(h=0,i=e.children.length;i>h;h++)k.push(l?m[e.children[h]].text:m[e.children[h]].text.toLowerCase());switch(l||(j=j.toLowerCase()),a){case"delete_node":return!0;case"rename_node":return h=-1===b.inArray(j,k)||c.text&&c.text[l?"toString":"toLowerCase"]()===j,h||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+j+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),h;case"create_node":return h=-1===b.inArray(j,k),h||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+j+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),h;case"copy_node":return h=-1===b.inArray(j,k),h||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+j+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),h;case"move_node":return h=c.parent===e.id&&(!g||!g.is_multi)||-1===b.inArray(j,k),h||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+j+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),h}return!0},this.create_node=function(a,e,f,g,h){if(!e||e.text===c){if(null===a&&(a="#"),a=this.get_node(a),!a)return d.create_node.call(this,a,e,f,g,h);if(f=f===c?"last":f,!f.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(a))return d.create_node.call(this,a,e,f,g,h);e||(e={});var i,j,k,l,m,n=this._model.data,o=this.settings.unique.case_sensitive,p=this.settings.unique.duplicate;for(j=i=this.get_string("New node"),k=[],l=0,m=a.children.length;m>l;l++)k.push(o?n[a.children[l]].text:n[a.children[l]].text.toLowerCase());for(l=1;-1!==b.inArray(o?j:j.toLowerCase(),k);)j=p.call(this,i,++l).toString();e.text=j}return d.create_node.call(this,a,e,f,g,h)}};var p=l.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",b.jstree.plugins.wholerow=function(a,c){this.bind=function(){c.bind.call(this),this.element.on("ready.jstree set_state.jstree",b.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",b.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",b.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",b.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var c,d,e=!1;for(c=0,d=b.selected.length;d>c;c++)e=this.get_node(b.selected[c],!0),e&&e.length&&e.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",b.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",b.proxy(function(a,b){"hover_node"===a.type&&this.is_disabled(b.node)||this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",b.proxy(function(a){a.preventDefault();var c=b.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});b(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c)},this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var c=b.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});b(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",b.proxy(function(a){a.stopImmediatePropagation();var c=b.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});b(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",b.proxy(function(a){return a.stopImmediatePropagation(),this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",b.proxy(function(a){this.dehover_node(a.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),c.teardown.call(this)},this.redraw_node=function(a,d,e,f){if(a=c.redraw_node.apply(this,arguments)){var g=p.cloneNode(!0);-1!==b.inArray(a.id,this._data.core.selected)&&(g.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===a.id&&(g.className+=" jstree-wholerow-hovered"),a.insertBefore(g,a.childNodes[0])}return a}},l.registerElement&&Object&&Object.create){var q=Object.create(HTMLElement.prototype);q.createdCallback=function(){var a,c={core:{},plugins:[]};for(a in b.jstree.plugins)b.jstree.plugins.hasOwnProperty(a)&&this.attributes[a]&&(c.plugins.push(a),this.getAttribute(a)&&JSON.parse(this.getAttribute(a))&&(c[a]=JSON.parse(this.getAttribute(a))));for(a in b.jstree.defaults.core)b.jstree.defaults.core.hasOwnProperty(a)&&this.attributes[a]&&(c.core[a]=JSON.parse(this.getAttribute(a))||this.getAttribute(a));b(this).jstree(c)};try{l.registerElement("vakata-jstree",{prototype:q})}catch(r){}}}}),c.TreeView=function(a){this.mainPane=a,this.mainPane||(this.mainPane=$("body"));var b=this;this.treeView=$('<div id = "plugin_tree_view_id" class="black-font-color"></div>'),this.treeView.on("changed.jstree",function(a,c){b.clickNode(a,c)}).on("hover_node.jstree",function(a,c){b.mouseover(a,c)}).jstree({core:{data:[],themes:{theme:"default",dots:!1,icons:!0}}}),this.treePane=$('<div id="tree-content" class="scroll-class" style="height:100px;overflow:auto; position: relative;display: block;top:15px"></div>'),this.treePane.append(this.treeView),this.mainPane.append(this.treePane),this.dataSet=null,this.clickNodeFunction=null,this.mouseoverNodeFunction=null,this.sortFunction=null},mono.extend(c.TreeView,Object,{isClick:function(a){return!0},clickNode:function(a,b){if(b.selected.length){var c=b.instance.get_node(b.selected[0]);if(c.select_flag)return void delete c.select_flag;c.original&&this.clickNodeFunction&&this.clickNodeFunction(c.original,b)}},mouseover:function(a,b){if(b&&b.node&&b.node.original){this.mouseoverNodeFunction&&this.mouseoverNodeFunction(b.node.original);var c=b.node.original.text;if(c){c=c.replace("<label color=#F00>",""),c=c.replace("</label>","");var d=b.node.id;d&&(d=d.replaceAll("/","\\/"),d=d.replaceAll("@","\\@")),$("#"+d).prop("title",c)}}},isSortById:function(){return!1},sort:function(a,b){if(this.sortFunction)return this.sortFunction(a,b);var d,e;return d=a?this.isSortById()?a.id:a.text:a,b?this.isSortById()?d=b.id:e=b.text:e=b,c.Util.compare(d,e)},setData:function(a,c){if((this.dataSet||a)&&(this.dataSet=a,this.treeView.jstree(!1)&&this.treeView.jstree(!1)._model&&this.treeView.jstree(!1)._model.data&&(this.treeView.jstree(!1)._model.data={}),this.treeView.data("jstree",!1).empty(),a)){var d=!0;c!=b&&(d=c);var e=this;this.treeView.data("jstree",!1).empty().jstree({core:{data:a,themes:{theme:"default",dots:!0,icons:d}},plugins:["sort"],sort:function(a,b){var c=this.get_node(a)?this.get_node(a).original:null,d=this.get_node(b)?this.get_node(b).original:null;return e.sort(c,d)}})}},setSelectNode:function(a){if(a){var b=this.treeView.jstree(!0),c=b.get_node(a);c&&(c.select_flag=!0),b.deselect_all(),b.select_node(a),this.scrollTreeByNodeId(a)}},getNodeById:function(a){if(a){var b=this.treeView.jstree(!0);return b.get_node(a)}},clearTreeData:function(){this.treeView.data("jstree",!1).empty()},show:function(){this.treeView.show()},hidden:function(){this.treeView.hide()},open:function(a){},close:function(a){},scrollTreeByNodeId:function(a){if(a){var b=$("#"+a);if(b&&!(b.length<1)){var c=0;this.treePane.parent()&&this.treePane.parent().height()>0&&(c=this.treePane.parent().height()-this.treePane.height());var d=this.treePane,e=d[0].clientHeight;e||(e=400);var f=0;if(b.offset()&&(f=b.offset().top),c>f){var g=d.scrollTop()-(c-f);g&&d.scrollTop(g)}else if(f>e+c){var g=d.scrollTop()+(f-(e+c)+70);g&&d.scrollTop(g)}}}},setTreeHeight:function(a){a&&a>15&&this.treePane.height(a-15)}}),c.OrganizeTreeManager=function(a,b){a||console.log("dataManager can not be null"),this.dataManager=a,this.dataType=b},mono.extend(c.OrganizeTreeManager,Object,{includeParent:function(a){return!0},getDataByNode:function(a){return a&&a.id?this.getDataById(a.id):null},getDataById:function(a){return a?this.dataType&&"link"===this.dataType?this.dataManager.getLinkById(a):this.dataManager.getDataById(a):null},isOpen:function(a){return!0},createLabel:function(a){return a?a.getId():""},getParentIdByData:function(a){return a?a instanceof c.Link?null:a.getParentId():null},createNode:function(a,b){if(a){var c={id:a.getId(),text:this.createLabel(a),parentId:this.getParentIdByData(a)};if(b?c.children=b:c.children=[],this.isOpen(a)){var d=c.state;d?d.opened=!0:c.state={opened:!0}}return c}return null},addChild:function(a,b){if(!a||!b)return a;var c=this.getChildren(a);return c?c.push(b):a.children=[b],a},getChildren:function(a){return a.children},organizeTree:function(a){if(!a||a.length<1)return null;for(var b={},d=0;d<a.length;d++){var e=a[d];if(e){var f=this.createNode(e);b[e.getId()]=f}}var g=[],h=c.Util.clone(b);for(var i in b){var f=h[i];this.organizeParent(f,g,h)}return g},organizeParent:function(a,b,c){if(!a)return null;var d=a.parentId;if(!d)return b.push(a),a;var e=c[d];if(e)this.addChild(e,a);else if(this.includeParent(a.data)){var f=this.getDataById(d);if(f){var g=this.createNode(f,[a]);c[f.getId()]=g,this.organizeParent(g,b,c,this)}else b.push(a)}else{var h=this.getAncestorInTreeMap(d,c);h?this.addChild(h,a):b.push(a)}},getAncestorInTreeMap:function(a,b){if(!a||!b)return null;if(b[a])return b[a];var c=this.getDataById(a);return c&&this.getParentIdByData(c)?this.getAncestorInTreeMap(this.getParentIdByData(c),b,this):null}});var K=function(a){a=a||{},this.diagramPane=$('<div class="diagram"></div>'),a.width&&this.diagramPane.css("width",a.width),this.diagramContentPane=$('<div class="diagram-content"></div>');var b=$("#itv-main");b.append(this.diagramPane),this.serialNumColorMap={},this.num=1,this.hideDiagram()};mono.extend(K,Object,{setData:function(a,b,c,d){if(a&&!(a.length<1)){this.diagramPane.empty(),this.diagramContentPane.empty(),this.diagramPane.show(),b||(b="");var e=$('<div class="title">'+b+"</div>");if(this.diagramPane.append(e),this.diagramPane.append(this.diagramContentPane),a instanceof Array)for(var f=0;f<a.length;f++){var g=a[f];this.createItem(g)}c&&this.diagramPane.mouseover(function(a){var b=$(a.target).parent();if(b.hasClass("diagram-item")){var d=b.index();c(d,b)}}),d&&this.diagramPane.mouseout(function(a){var b=$(a.target).parent();if(b.hasClass("diagram-item")){var c=b.index();d(c,b)}})}},createItem:function(a){if(a){var b=a.value,c=a.color,d=a.width;if(b&&c){var e=$('<div class="diagram-item"></div>');d&&e.css("width",d);var f=$('<div class="cl"></div>');f.css("background-color",c),e.append(f);var g=$('<label class="lb">'+b+"</label>");e.append(g),this.diagramContentPane.append(e)}}},showSerialDiagram:function(a){var b=[];this.serialNumColorMap={},a=parseInt(a),a||(a=1),this.num=a;var c=Math.floor(47/a),d=Math.floor(c/4),e=this.getCapacityColor(null,.1),f={color:e,value:3*d+1+"-"+c};if(4>=c)f.value=c,this.serialNumColorMap[c]=e;else for(var g=3*d+1;c>=g;g++)this.serialNumColorMap[g]=e;if(b.push(f),e=this.getCapacityColor(null,.3),f={color:e,value:2*d+1+"-"+3*d},c>1&&4>=c)f.value=c-1,this.serialNumColorMap[c-1]=e;else for(var g=2*d+1;3*d>=g;g++)this.serialNumColorMap[g]=e;if(c>1&&b.push(f),e=this.getCapacityColor(null,.6),f={color:e,value:d+1+"-"+2*d},c>2&&4>=c)f.value=c-2,this.serialNumColorMap[c-2]=e;else for(var g=d+1;2*d>=g;g++)this.serialNumColorMap[g]=e;if(c>2&&b.push(f),e=this.getCapacityColor(null,.8),f={color:e,value:"1-"+d},c>3&&4>=c)f.value=c-3,this.serialNumColorMap[c-3]=e;else for(var g=1;d>=g;g++)this.serialNumColorMap[g]=e;c>3&&b.push(f),this.setData(b,"")},showTotalSpaceDiagram:function(){var a=[];this.num=1;var b=this.getCapacityColor(null,.1),c={color:b,value:"1-25%"};a.push(c),b=this.getCapacityColor(null,.3),c={color:b,value:"25-50%"},a.push(c),b=this.getCapacityColor(null,.6),c={color:b,value:"50-75%"},a.push(c),b=this.getCapacityColor(null,.8),c={color:b,value:"75-100%"},a.push(c),this.setData(a,"")},hideDiagram:function(){this.diagramPane.empty(),this.diagramPane.hide()},getCapacityColor:function(a,b){return b?.25>=b?"#5DBDE0":.5>=b?"#6FD772":.75>=b?"#FFC95A":"#Fd674F":"#5DBDE0"}}),c.Diagram=K,c.SearchManager=function(a,b,c,d){this.sceneManager=a,this.itSearchManager=null,this.spaceSearchManager=null,this.itSearchInputPanel=b,this.spaceSearchInputPanel=c,this.showModel="",this.spaceMode=d||1,this.init()},mono.extend(c.SearchManager,Object,{init:function(){this.spaceSearchManager=new c.SpaceSearchManager(this.sceneManager,this.spaceSearchInputPanel,this.spaceMode),this.itSearchManager=new c.ITSearchManager(this.sceneManager,this.itSearchInputPanel),this.itSearchManager.clearAll(),this.itSearchManager.clearAllVirtual(),this.itSearchManager.hide(),this.spaceSearchManager.clearAll(),this.spaceSearchManager.clearAllVirtual(),this.spaceSearchManager.hide()},showITSearch:function(){this["switch"](!1)},hideITSearch:function(){this.itSearchManager&&(this.itSearchManager.clearAll(),this.itSearchManager.clearAllVirtual(),this.itSearchManager.hide())},showSpaceSearch:function(){this["switch"](!0)},hideSpaceSearch:function(){this.spaceSearchManager&&(this.spaceSearchManager.clearAll(),this.spaceSearchManager.clearAllVirtual(),this.spaceSearchManager.hide())},"switch":function(a){if(a){if("S"===this.showModel)return;this.showModel="S",this.itSearchManager.clearAll(),this.itSearchManager.clearAllVirtual(),this.itSearchManager.hide(),this.spaceSearchManager.virtualAllNodes(),this.spaceSearchManager.setupInit(),this.spaceSearchManager.show()}else{if("IT"===this.showModel)return;this.showModel="IT",this.spaceSearchManager.clearAll(),
this.spaceSearchManager.clearAllVirtual(),this.spaceSearchManager.clearInit(),this.spaceSearchManager.hide(),this.itSearchManager.show()}},getITSearchTree:function(){return this.itSearchManager?this.itSearchManager.getTreeView():null},getSpaceSearchTree:function(){return this.spaceSearchManager?this.spaceSearchManager.getTreeView():null},getITSearchOrganizeTreeManager:function(){return this.itSearchManager?this.itSearchManager.getOrganizeTreeManager():null},getSpaceSearchOrganizeTreeManager:function(){return this.spaceSearchManager?this.spaceSearchManager.getOrganizeTreeManager():null},setPanelLocation:function(a){this.setITSearchPanelLocation(a),this.setSpaceSearchPanelLocation(a)},setITSearchPanelLocation:function(a){var c=this.itSearchManager.searPanel;a&&(c.css("left","auto"),c.css("right","auto"),c.css("bottom","auto"),c.css("top","auto"),null!=a.left&&a.left!=b&&c.css("left",parseInt(a.left)+"px"),null!=a.right&&a.right!=b&&c.css("right",parseInt(a.right)+"px"),null!=a.bottom&&a.bottom!=b&&c.css("bottom",parseInt(a.bottom)+"px"),null!=a.top&&a.top!=b&&c.css("top",parseInt(a.top)+"px"))},setSpaceSearchPanelLocation:function(a){var c=this.spaceSearchManager.searPanel;a&&(c.css("left","auto"),c.css("right","auto"),c.css("bottom","auto"),c.css("top","auto"),null!=a.left&&a.left!=b&&c.css("left",parseInt(a.left)+"px"),null!=a.right&&a.right!=b&&c.css("right",parseInt(a.right)+"px"),null!=a.bottom&&a.bottom!=b&&c.css("bottom",parseInt(a.bottom)+"px"),null!=a.top&&a.top!=b&&c.css("top",parseInt(a.top)+"px"))},getItSearchPane:function(){return this.itSearchManager.searPanel},getSpaceSearchPane:function(){return this.spaceSearchManager.searPanel},setParent:function(a){a&&$(a)?(a=$(a),a.append(this.itSearchManager.searPanel),a.append(this.spaceSearchManager.searPanel)):($("body").append(this.itSearchManager.searPanel),$("body").append(this.spaceSearchManager.searPanel))}}),c.BaseSearch=function(a,b){if(!a)return void console.error("agument sceneManager can not be null");this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.dataFinder=new c.DataFinder(this.sceneManager.dataManager);var d=this;this.dataFinder.filter=function(a){return d.filter(a)},this.virtualManager=this.getVirtualManager()||new c.VirtualManager(a),this.virtualManager.isDealWithFunction=function(a){if(!a)return!1;var b=d.dataManager.getCategoryForData(a);if(b){var c=b.getId().toLowerCase();if(c.indexOf("room")>=0)return!1;if(c.indexOf("datacenter")>=0)return!1;if(c.indexOf("building")>=0)return!1;if(c.indexOf("earth")>=0)return!1}return!0},this.sceneManager.viewManager3d.addMaterialFilter(this.virtualManager),this.treeView=null,this.orgTreeManager=new c.OrganizeTreeManager(this.sceneManager.dataManager),this.defaultEventHandler=a.viewManager3d.getDefaultEventHandler(),this.inputPane=b||this.createInputPane(),this.searPanel=null,this.clearAllFunction=null,this.initSearchPane()},mono.extend(c.BaseSearch,Object,{createInputPane:function(){return new c.BasePanel},getVirtualManager:function(){return new c.VirtualManager(this.sceneManager)},addVirtualManager:function(){this.sceneManager.viewManager3d.addMaterialFilter(this.virtualManager)},removeVirtualManager:function(){this.sceneManager.viewManager3d.removeMaterialFilter(this.virtualManager)},filter:function(a){return!0},clearAllVirtual:function(){this.virtualManager.clearAll()},showNoData:function(){},initSearchPane:function(){this.searPanel=$(".search-main-pane");var a=0;this.searPanel&&this.searPanel.length>0&&(a=this.searPanel.length),this.searPanel=$('<div id = "search-main-pane_'+a+'" class="search-main-pane"></div>'),this.searPanel.append(this.inputPane.getContentPane()),this.treeView=new c.TreeView(this.searPanel);var b=this;this.treeView.clickNodeFunction=function(a){b.clickTreeNode(a)},this.treeView.mouseoverNodeFunction=function(a){b.mouseOverTreeNode(a)},this.inputPane.doClickFunction=function(a){b.beforeDoClick(),b.setData(a);var c=b.searPanel.height()-b.inputPane.getContentPane().height();b.treeView.setTreeHeight(c),b.sceneManager.viewManager3d.clearVisibleMap()},this.inputPane.doClearFunction=function(){b.clearSearch()}},beforeDoClick:function(){},show:function(){this.searPanel.show()},beforHide:function(){},hide:function(){this.beforHide(),this.searPanel.hide()},setData:function(a){var b=this.getResultByConditions(a),c=null;!b||b.length<1?this.treeView.clearTreeData():(c=this.orgTreeManager.organizeTree(b),this.treeView.setData(c,!1)),this.setResult(b,c)},getResultByConditions:function(a){return this.dataFinder.find(a)},setResult:function(a,b){},clearSearch:function(){this.treeView.setData(null),this.clearSearchData(),this.sceneManager.network3d.dirtyNetwork()},clearSearchData:function(){},clearAll:function(){this.treeView.setData(null),this.inputPane.clearInput&&this.inputPane.clearInput(),this.clearAllFunction?this.clearAllFunction():this.clearSearchData()},shouldClick:function(a){return!0},getRootDataBySceneAndData:function(a,b,c){if(!a||!b)return null;c=c||this;var d=this.sceneManager.dataManager.getDataTypeForData(b);if(d&&d.getCategoryId()===a.getCategoryId())return b;if(b.getParentId()){var e=this.sceneManager.dataManager.getDataById(b.getParentId());if(e)return c.getRootDataBySceneAndData(a,e,c)}return null},clickTreeNode:function(a){var b=a.id;if(b&&this.sceneManager.viewManager3d.enableDBLClick){var c=this.sceneManager.dataManager.getDataById(b);if(c&&this.treeView.isClick(c)){var d=this.sceneManager.dataNodeMap[b];if(this.shouldClick(c)){if(!this.sceneManager.isCurrentSceneInstance(c,!0)){var e=this.sceneManager.getSceneAndRootByData(c);if(e){if(this.sceneManager.gotoScene(e.scene,e.rootData,null,!1),e.rootData==c)return;d=this.sceneManager.dataNodeMap[b],d||this.sceneManager.loadLazyData(c)}}var f=this.sceneManager.network3d.getDataBox();d&&f.getDataById(d.getId())||(this.sceneManager.loadLazyData(c),d||(d=this.sceneManager.dataNodeMap[c.getId()])),this.defaultEventHandler&&d!=this.sceneManager.getCurrentRootNode()&&this.defaultEventHandler.lookAt(d)}}}},mouseOverTreeNode:function(a){var b=a.id;if(this.sceneManager.network3d.getDataBox().getSelectionModel().clearSelection(),b){var c=this.sceneManager.dataNodeMap[b];c&&c.setSelected(!0)}},getTreeView:function(){return this.treeView},getOrganizeTreeManager:function(){return this.orgTreeManager}}),c.ITSearchManager=function(a,b){c.ITSearchManager.superClass.constructor.call(this,a,b),this._assetImage="data:image/png;base64,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"},mono.extend(c.ITSearchManager,c.BaseSearch,{createInputPane:function(){return new c.ITSearchPanel},clearSearchData:function(){this.clearBillboard()},setResult:function(a,b){if(this.clearBillboard(),this.virtualManager.addAll(),!b)return void this.showNoData();for(var c=0;c<b.length;c++){var d=b[c];this.showData(d)}},showData:function(a){var b=this.orgTreeManager.getDataByNode(a);if(b){this.showBillboard(b)&&this.addDataBillBoard(b),this.virtualManager.remove(b);var c=this.orgTreeManager.getChildren(a);if(c&&c.length>0)for(var d=0;d<c.length;d++){var e=c[d];e&&this.showData(e,this)}}},showBillboard:function(a){if(!a)return!1;var b=a.getDataTypeId();if(b){if(b.indexOf("equipment")>=0)return!1;if(b.indexOf("room")>=0)return!1;if(b.indexOf("floor")>=0)return!1}return!0},clearBillboard:function(){if(this.sceneManager.dataNodeMap)for(var a in this.sceneManager.dataNodeMap){var b=this.sceneManager.dataNodeMap[a];if(b&&b.getClient("asset_billboard")){var c=b.getClient("asset_billboard");c.setParent(null),this.sceneManager.network3d.getDataBox().remove(c)}}this.virtualManager.clearAll()},addDataBillBoard:function(a){if(a){var b=this.sceneManager.dataNodeMap[a.getId()];if(b){var c=this.sceneManager.network3d.getDataBox();if(c.getDataById(b.getId())){var d=new mono.Billboard;d.setPosition(0,b.getBoundingBox().max.y+20,0),d.setStyle("m.alignment",mono.BillboardAlignment.bottomCenter),d.setStyle("m.transparent",!0),d.setStyle("m.texture.image",this._assetImage),d.setStyle("m.alignment",mono.BillboardAlignment.bottomCenter),d.setScale(40,50,1),d.setParent(b),d.setClient("it_data",a),c.add(d),b.setClient("asset_billboard",d)}}}}}),c.SpaceSearchVirtualManager=function(a,b){c.VirtualManager.call(this,a),this.spaceManager=b},mono.extend(c.SpaceSearchVirtualManager,c.VirtualManager,{beforeAdd:function(a){a&&(delete a._userDataMap.dyna_user_data_maxSerSpace,delete a._userDataMap.dyna_user_data_totalCount,delete a._userDataMap.dyna_user_data_empCount)},filterMaterial:function(a,b,c){var d=this.sceneManager,e=this.spaceManager;this.materialMap;if(d.getNodeData(c))return b;if(e.isSpaceNode(c)){var f=c.getParent();e.isSpaceNode(f)&&(f=f.getParent());var g=!1;if(f){var h=this.getDataByNode(f);h&&(i=this.getBId(h),this._global_tmap[i]?g=this._global_tmap[i]:this._tmap[i]&&(g=this._tmap[i]))}if(!g)return b;var i=a.getUniqueCode(),j=this.materialMap[i];return j||(j=a.clone(),this.materialMap[i]=j,j.transparent=!0,j.opacity=.05),j}}}),c.SpaceSearchManager=function(a,b,d){c.BaseSearch.call(this,a,b),this.spaceManager=new c.SpaceManager(this.dataManager,this.sceneManager),this.diagram=new c.Diagram,this.isVirtualFunction=null,this.virtualNode=[],this.spaceMap={},this.mode=d||1,this.maxRackUSize=47;var e=this;this.spaceManager.spaceNodeColorFunction=function(a,b,c){if(b&&b.getUserData("dyna_user_data_empCount")){var d=parseInt(b.getUserData("dyna_user_data_empCount")),f=e.getUNumber()||1,g=Math.floor(e.maxRackUSize/f),h=Math.floor(g/4);if(4>=g)return d===g?"#5DBDE0":g-1>0&&d===g-1?"#6FD772":g-2>0&&d===g-2?"#FFC95A":"#Fd674F";if(h>=d)return"#Fd674F";if(d>=h+1&&2*h>=d)return"#FFC95A";if(d>=2*h+1&&3*h>=d)return"#6FD772";if(d>=3*h+1&&g>=d)return"#5DBDE0";console.log("can not compute the spaceNodeColorFunction color !")}return a?.25>=a?"#5DBDE0":.5>=a?"#6FD772":.75>=a?"#FFC95A":"#Fd674F":"#5DBDE0"},this.spaceManager.spaceNodeFrameColorFunction=function(a,b,c){if(b&&b.getUserData("dyna_user_data_empCount")){var d=parseInt(b.getUserData("dyna_user_data_empCount")),f=e.getUNumber()||1,g=Math.floor(e.maxRackUSize/f),h=Math.floor(g/4);if(4>=g)return 1===d?"#018ABD":2===d?"#1A920A":3===d?"#E68D00":"#CE3118";if(h>=d)return"#CE3118";if(d>=h+1&&2*h>=d)return"#E68D00";if(d>=2*h+1&&3*h>=d)return"#1A920A";if(d>=3*h+1&&g>=d)return"#018ABD";console.log("can not compute the spaceNodeFrameColorFunction color !")}return a?.25>=a?"#018ABD":.5>=a?"#1A920A":.75>=a?"#E68D00":"#CE3118":"#018ABD"},this.resetTreeLabel(),this.virtualAllNodes(),this.clearAllFunction=function(){this.clearSpaceNode()}},mono.extend(c.SpaceSearchManager,c.BaseSearch,{beforeDoClick:function(){var a=this.sceneManager._currentRootNode;this.sceneManager.viewManager3d.defaultEventHandler.lookAt(a)},setupInit:function(){this.visOrVirtFilter||(this.visOrVirtFilter=this.setVisibleOrVirtualData(this.sceneManager)),this.visOrVirtFilter instanceof c.VisibleManager?this.sceneManager.viewManager3d.addVisibleFilter(this.visOrVirtFilter):this.visOrVirtFilter instanceof c.VirtualManager&&this.sceneManager.viewManager3d.addMaterialFilter(this.visOrVirtFilter),this.addVirtualManager(),this.setupDoOther(this.sceneManager)},clearInit:function(){this.sceneManager.removeSceneChangeListener(this.sceneChangeListener),this.visOrVirtFilter&&(this.visOrVirtFilter instanceof c.VisibleManager?this.sceneManager.viewManager3d.removeVisibleFilter(this.visOrVirtFilter):this.visOrVirtFilter instanceof c.VirtualManager&&this.sceneManager.viewManager3d.removeMaterialFilter(this.visOrVirtFilter)),this.removeVirtualManager(),this.clearDoOther(this.sceneManager)},invisibleOrVirtualData:function(a,b){if(!a&&!b)return!1;var c=this.sceneManager.dataManager.getCategoryForDataType(a);return c&&c.getId()&&c.getId().toLowerCase().indexOf("channel")>=0?!0:!1},setVisibleOrVirtualData:function(a){var b=new c.VisibleManager(a),d=this.dataManager._dataTypeDatas;if(d)for(var e in d)if(this.invisibleOrVirtualData(e)){var f=d[e];if(f)for(var g in f)b.setVisible(f[g],!1)}return b},setupDoOther:function(a){},clearDoOther:function(a){},createInputPane:function(){return this.inputPane=new c.SpaceSearchPanel,this.inputPane},getVirtualManager:function(){return new c.SpaceSearchVirtualManager(this.sceneManager,new c.SpaceManager(this.dataManager,this.sceneManager))},resetTreeLabel:function(){var a=this;this.orgTreeManager.createLabel=function(b){return a.setLabel(b)}},getUNumber:function(){return this.inputPane?parseInt(this.inputPane.getUNumber()):1},setLabel:function(a){if(!a||!a.getId())return null;var b=a.getId(),c=this.dataManager.getDataById(b),d=this.getTreeNodeLabel(a);d||(d=b);var e=0;return c&&(e=parseInt(c.getUserData("dyna_user_data_empCount"))),e&&(d+="("+e+")"),d},getTreeNodeLabel:function(a){return a?a.getId():""},setData:function(a){var b=this.dataFinder.find(a),c=null;this.setResult(b),!b||b.length<1?(this.showNoData(),this.treeView.clearTreeData()):(c=this.orgTreeManager.organizeTree(b),this.treeView.setData(c,!1))},setResult:function(a,b){if(this.clearSpaceNode(),this.virtualManager.addAll(),a){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=this.sceneManager.dataNodeMap[e.getId()];this.virtualManager.remove(e),f&&(this._dealWithOneNode(f),c.push(f))}this.showSpaceNode(c)}},beforHide:function(){this.diagram.hideDiagram()},clearSearchData:function(){this.initAllNodes(),this.showSpaceNode(),this.virtualManager.clearAll()},clearSpaceNode:function(){var a=this.getAllNodes();this.spaceManager.remove1DSpaceNodeForNodes(a),this.spaceManager.hideSpaceMode(),this.showSerialDiagram(1,a)},virtualAllNodes:function(){this.initAllNodes(),this.showSpaceNode()},showSpaceNode:function(a){var b=this.getSceneNodes();(!a||a.length<1)&&(a=b),b&&b.length>0?this.showSerialDiagram(this.getUNumber(),a):this.diagram.hideDiagram(),this.spaceManager.create1DSpaceNodeForNodes(b,this.mode),this.spaceManager.showSpaceMode()},showSerialDiagram:function(a,b){var c=[],d={};a=parseInt(a),a||(a=1),this.num=a;var e=Math.floor(this.maxRackUSize/a),f=Math.floor(e/4),g=this.getCapacityColor(.1),h={color:g,minCount:3*f+1,maxCount:e,value:3*f+1+"-"+e};if(4>=e)h.value=e,h.minCount=e,h.maxCount=e,d[e]=g;else for(var i=3*f+1;e>=i;i++)d[i]=g;if(c.push(h),g=this.getCapacityColor(.3),h={color:g,minCount:2*f+1,maxCount:3*f,value:2*f+1+"-"+3*f},e>1&&4>=e)h.value=e-1,h.minCount=e-1,h.maxCount=e-1,d[e-1]=g;else for(var i=2*f+1;3*f>=i;i++)d[i]=g;if(e>1&&c.push(h),g=this.getCapacityColor(.6),h={color:g,minCount:f+1,maxCount:2*f,value:f+1+"-"+2*f},e>2&&4>=e)h.value=e-2,h.minCount=e-2,h.maxCount=e-2,d[e-2]=g;else for(var i=f+1;2*f>=i;i++)d[i]=g;if(e>2&&c.push(h),g=this.getCapacityColor(.8),h={color:g,minCount:1,maxCount:f,value:"1-"+f},e>3&&4>=e)h.value=e-3,h.minCount=e-3,h.maxCount=e-3,d[e-3]=g;else for(var i=1;f>=i;i++)d[i]=g;e>3&&c.push(h);var j={},k={};if(b&&b.length>0){for(var i=0;i<b.length;i++){var h=this.sceneManager.getNodeData(b[i]),l=d[h.getUserData("dyna_user_data_empCount")],m=h.getUserData("dyna_user_data_totalSpace"),n=h.getUserData("dyna_user_data_totalOccupation");if(l)if(k[l]?k[l]++:k[l]=1,j[l]){var o=j[l],p=Math.round(n/m*100);p<o.minP&&(o.minP=p),p>o.maxP&&(o.maxP=p)}else{var p=Math.round(n/m*100);j[l]={minP:p,maxP:p}}}for(var i=0;i<c.length;i++){var q=c[i];if(q&&k[q.color]){var r="";q.minCount&&(r=q.minCount),q.minCount!=q.maxCount&&(r+="-"+q.maxCount),r+="("+k[q.color]+")",q.value=r}}}$.each(c,function(b,c){var d=j[c.color],e=k[c.color]||0;c.tip=""+c.minCount+"-"+c.maxCount+""+a+"U"+e+"",d&&(c.tip+=", "+d.minP+"% - "+d.maxP+"%")}),this.diagram.setData(c,"",function(a,b){var d=c[a];layer.tips(d.tip,b,{tips:[3,d.color],time:3e4})},function(a,b){layer.closeAll()})},getCapacityColor:function(a){return a?.25>=a?"#5DBDE0":.5>=a?"#6FD772":.75>=a?"#FFC95A":"#Fd674F":"#5DBDE0"},isDealwith:function(a){if(!a)return!1;if(this.isVirtualFunction)return this.isVirtualFunction(a);var b=this.sceneManager.getNodeData(a);if(!b)return!1;var c=this.sceneManager.dataManager.getCategoryForData(b);return c&&"rack"==c.getId().toLowerCase()?!0:!1},getDataSpace:function(a){if(!a)return null;var b=this.spaceMap[a.getId()];if(!b){var d=this.spaceManager.computeSpace(a);d&&d instanceof c.Space1&&(this.spaceMap[a.getId()]=d,b=d)}return b},_dealWithOneNode:function(a){var b=this.getUNumber();if(b||(b=1),a&&this.isDealwith(a)){var c=this.sceneManager.getNodeData(a);if(!c)return;var d=this.getDataSpace(c),e=0;if(d){var f=0,g=d.getTotal()-d.getOccupation(),h=d.getEmptyList();if(h&&h.length>0)for(var i=0;i<h.length;i++){var j=h[i];j.total>f&&(f=j.total),j.total>=b&&(e+=Math.floor(j.total/b))}c.setUserData("dyna_user_data_totalSpace",d.getTotal()),c.setUserData("dyna_user_data_totalOccupation",d.getOccupation()),c.setUserData("dyna_user_data_maxSerSpace",f),c.setUserData("dyna_user_data_totalEmpSpace",g),c.setUserData("dyna_user_data_totalCount",parseInt(d.getTotal()/b)),c.setUserData("dyna_user_data_empCount",e),this.virtualNode.push(a)}}},getAllNodes:function(){var a=this.sceneManager.dataNodeMap;if(!a)return null;var b=[];for(var c in a){var d=a[c];if(d&&this.isDealwith(d)){var e=this.sceneManager.getNodeData(d);if(!e)return;var f=this.getDataSpace(e);f&&b.push(d)}}return b},getSceneNodes:function(){var a=[],b=this.sceneManager.getSceneDatas();if(b){var c=this.sceneManager.dataNodeMap;for(var d in b){var e=c[d],f=b[d];if(e&&f&&this.isDealwith(e)){var g=this.getDataSpace(f);g&&(this._dealWithOneNode(e),a.push(e))}}}return a},initAllNodes:function(){var a=this.sceneManager.dataNodeMap;if(!a)return null;this.virtualNode=[];for(var b in a){var c=a[b],d=this.sceneManager.getNodeData(c);d&&(d.setUserData("dyna_user_data_totalCount",null),d.setUserData("dyna_user_data_empCount",null)),this._dealWithOneNode(c)}return this.virtualNode}}),c.Tab=function(){},mono.extend(c.Tab,Object,{_getTargetLi:function(a){return a?a.tagName&&"LI"==a.tagName.toUpperCase()?a:a.parentElement?arguments.callee(a.parentElement):null:null},_onclick:function(a){a.preventDefault&&a.preventDefault();var b=this._getTargetLi(a.originalEvent.target),c=b.getAttribute("href");if(c||(c=b.childNodes[0].getAttribute("href")),c&&c.length>0){var d=c.substring(1,c.length);$("#"+d)[0]&&$("#"+d)[0].children&&$("#"+d)[0].children.length>0&&(this._clearHover(),b.className="hover",$(".contentbox div.tab-pane").hide(),$("#"+d).show())}},_clearHover:function(){var a=$(".property-pane-tab .menu ul li");if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c&&c.className&&(c.className="")}},initAll:function(){var a=this;$(".property-pane-tab .menu ul li").click(function(b){a._onclick(b)})}}),c.PropertyPane=function(a){this.propertyPane=$("<div class='property-pane it-shadow'></div>"),this.propertyTab=$("<div class='property-pane-tab'></div>"),this.propertyItemsDiv=$("<div class='menu'></div>"),this.propertyItemsPane=$("<ul></ul>"),this.propertyTabContent=$('<div class="contentbox scroll-class">'),this.propertyItemsDiv.append(this.propertyItemsPane),this.propertyTab.append(this.propertyItemsDiv),this.propertyTab.append(this.propertyTabContent),this.propertyPane.append(this.propertyTab),a||(a=document.body),a.appendChild(this.propertyPane[0]),this.closeDiv=$('<div class="it-property-title"></div>'),this.propertyPane.prepend(this.closeDiv),this.isvisible,this.tab=new c.Tab,this.hide()},mono.extend(c.PropertyPane,Object,{_createTitle:function(a){a||(a="");var b=$("<span>"+a+"</span>"),c=$('<div class="close"></div>'),d=this;c.click(function(a){d.hide()}),this.closeDiv.append(b),this.closeDiv.append(c)},clear:function(){this.propertyItemsPane.empty(),this.propertyTabContent.empty(),this.closeDiv.empty()},setData:function(a,b,c,d){if(this.clear(),this._createTitle(c),a&&a.items&&!(a.items<1)){for(var e=a.items,f=0;f<e.length;f++){var g=e[f];if(g&&(!g.isShow||g.isShow(b))){var h="tab_"+f,i=g.title,j=g.className,k=g.onclick,l=g.properties,m=g.isGroup||g.isGrop;0==f?this.addTab(h,i,l,j,!0,m,k,b):this.addTab(h,i,l,j,!1,m,k,b)}}this.showTooltip({id:".menu ul li a",parent:this.propertyPane,offsetY:10}),this.tab.initAll(),this.showTabByIndex(d)}},addTab:function(a,b,c,d,e,f,g,h){var i=$('<li ><a href="#'+a+'" rel = "'+b+'" class= '+d+" ></a></li>");e&&(i.show(),i.attr("class","hover")),g&&i.click(g),this.propertyItemsPane.append(i);var j=$('<div class="tab-pane" id="'+a+'"></div>');e&&j.show(),j.append(this.createTableItemContentByObj(c,f,h)),this.propertyTabContent.append(j)},showTabByIndex:function(a){var b="tab_"+parseInt(a||0);$("#"+b)[0]&&$("#"+b)[0].children&&$("#"+b)[0].children.length>0&&$('[href="#'+b+'"]')&&$('[href="#'+b+'"]').length>0&&(this.tab._clearHover(),$('[href="#'+b+'"]').parent().attr("class","hover"),$(".contentbox div.tab-pane").hide(),$("#"+b).show())},createTableItemContentByObj:function(a,c,d){if(a){var e=$('<form class="form-horizontal" role="form"></form>'),f=a.src;if("function"==typeof f&&(f=f(d)),a.isIframe&&f){e=$('<form class="form-horizontal" role="form" style="position:relative;height:100%;width:100%"></form>');var g='<iframe src="'+f+'" style="position: relative;height: 100%;width: 100%"></iframe>';e.append(g)}else if(a instanceof Array){if(a.length>0){if(a.title){var h=this._createTableRow(a.title);h&&e.append(h)}for(var i=0;i<a.length;i++){var j=a[i];if(j){var k=j.callback,l=j.mousemove;if(j.values){var m=j.values,n=this._createTableRow(m,i+1,k,l);n&&e.append(n)}else if(j.name){var o=j.name,p=j.value,n=this._createKeyValueRow(o,p,c,i+1,k,l);n&&e.append(n)}}}}}else for(var q in a)if("function"!=typeof a[q]){var p=a[q],r=p,s=null,t=null,u=null,v=!1;p&&(p.value!=b&&(r=p.value),p.onclick&&(s=p.onclick),p.isButton&&1==p.isButton&&(v=!0),p.style&&(t=p.style),u=p.classname);var n=this._createKeyValueRow(q,r,c,null,s,null,v,t,u,d);n&&e.append(n)}return e}},_createTableHead:function(a){if(a){var b=$('<div class="form-group-no-margin"></div>');if(a instanceof Array&&a.length>0){var c=Math.floor(12/a.length);if(c>1){for(var d="col-sm-"+c+" table-label-min label-inline-block",e=0;e<a.length;e++){var f=a[e];if(f){var g=$('<label class="'+d+'">'+f+"</label>");b.append(g)}}return b}}}},_createKeyValueRow:function(a,c,d,e,f,g,h,i,j,k){if(!a&&!c)return null;var l="form-group-no-margin",m=$('<div class="'+l+'"> </div>'),n="";h&&(n="col-btn");var o=function(a){f&&f(a,k)};if(c&&"string"!=typeof c&&!(c instanceof Array)&&c.isTitle){var p=15-a.length,q="";if(p>0)for(var e=0;p/2>e;e++)q+="";a=q+a+q;var r=n+"col-sm-12 label-min label-inline-block ",s=$('<label style = "text-align:center" class="'+r+'">'+a+"</label>");return m.append(s),m}a&&(a+=":");var r="col-sm-4 label-min label-inline-block",s=$('<label class="'+r+'">'+a+"</label>");this.propertyPane.width()>300&&s.css("max-width","100px"),m.append(s),(d==b||null==d)&&(d=!0);var t="contral-width label-inline-block",u=null;if(c instanceof Array&&c.length>0){var v=$('<div class = "col-sm-8 multi-label-value"></div>');if(this.propertyPane.width()>300,d)for(var w=2,e=0;e<c.length;e+=w){var x=c[e];if(x){var y=c[e],z=c[e+1],A=$('<div class = "row"></div>'),B=$('<div class = "col-xs-6 col-sm-6"></div>'),C=$('<div class = "col-xs-6 col-sm-6"></div>');y&&A.append(B),z&&A.append(C),v.append(A);var D=$('<label class="'+t+'">'+c[e]+"</label>");B.append(D);var D=$('<label class="'+t+'">'+c[e+1]+"</label>");C.append(D)}}else for(var e=0;e<c.length;e++){var x=c[e];if(x){var u=$('<label class="'+t+'">'+x+"</label>");v.append(u)}}m.append(v)}else{i=i||"",j=j||"";var E="";u=$('<label class=" '+j+n+E+' col-sm-8 label-value label-inline-block " style="'+i+'">'+c+"</label>"),this.propertyPane.width()>300,m.append(u)}return h&&u?(o&&u.click(o),g&&u.mousemove(g)):(o&&m.click(o),g&&m.mousemove(g)),m},_createTableRow:function(a,c,d,e){if(!a||a.length<=0)return null;if(a instanceof Array){var f="form-group-no-margin",g=Math.floor(12/a.length);if(!(0>=g)){f=c&&c%2==1?"form-group-table-margin t-odd":"form-group-table-margin";for(var h=$('<div class="'+f+'"> </div>'),i=0;i<a.length;i++){var j=a[i];if(j){var k=j,l=g;j.c_width&&parseInt(j.c_width)&&(l=parseInt(j.c_width)),j.text!=b&&(k=j.text);var m="col-sm-"+l+" table-label-min label-inline-block",n=$('<label class="'+m+'">'+k+"</label>");h.append(n)}}return d&&h.click(d),e&&h.mousemove(e),h}}},show:function(a,c,d,e,f){if(e){if(this.propertyPane.css("left","auto"),this.propertyPane.css("right","auto"),this.propertyPane.css("top","auto"),this.propertyPane.css("bottom","auto"),null!=e.left&&e.left!=b&&this.propertyPane.css("left",parseInt(e.left)+"px"),null!=e.right&&e.right!=b)if(this.propertyPane.parent()&&this.propertyPane.parent().css("width")){var g=parseInt(this.propertyPane.parent().css("width"))-parseInt(this.propertyPane.css("width"))-e.right;this.propertyPane.css("left",g+"px")}else this.propertyPane.css("right",parseInt(e.right)+"px");if(null!=e.bottom&&e.bottom!=b)if(this.propertyPane.parent()&&this.propertyPane.parent().css("height")){var h=parseInt(this.propertyPane.parent().css("height"))-parseInt(this.propertyPane.css("height"))-e.bottom;this.propertyPane.css("top",h+"px")}else this.propertyPane.css("bottom",parseInt(e.bottom)+"px");null!=e.top&&e.top!=b&&this.propertyPane.css("top",parseInt(e.top)+"px")}this.setData(a,c,d,f),this.propertyPane.show(),this.isvisible=!0},hide:function(){this.propertyPane.hide(),this.clear(),this.isvisible=!1},showTooltip:function(a){if(a&&a.parent){var b=a.offsetY?a.offsetY:0,c=a.offsetX?a.offsetX:0;if(a.id)$(a.id).mouseover(function(d){var e=d.target.rel,f=$("<div id='tooltip' class='tap-tooltip-content it-shadow'>"+e+"</div>");a.parent.append(f);var g=d.target.offsetTop-d.target.offsetHeight+b,h=d.target.offsetLeft+d.target.offsetWidth+c;f.css("top",g),f.css("left",h)}).mouseout(function(){$("#tooltip").remove()});else if(a.selector){if(!a.text)return;a.selector.mouseover(function(d){var e=$("<div id='tooltip' class='tap-tooltip-content it-shadow'>"+a.text+"</div>");a.parent.append(e);var f=d.target.offsetTop-d.target.offsetHeight+b,g=d.target.offsetLeft+d.target.offsetWidth+c;
e.css("top",f),e.css("left",g)}).mouseout(function(){$("#tooltip").remove()})}}},setWidthForPropertyPane:function(a){var a=a||"23%";this.propertyPane.css("width",a)},setHeightForPropertyPane:function(a){var a=a||"30%";this.propertyPane.css("height",a)}}),c.PropertyManager=function(a,b){this.sceneManager=null,this.dataManager=null,this.mainParentDiv=b;var d=b||(null!=a&&null!=a.network3d?a.network3d.getRootView():null);this.propertyPane=new c.PropertyPane(d),this.setSceneManager(a),this.getContentFunction=null,this.nodeDefaultInfoFunction=null,this.mouseoverDevFunction=null,this.devClickFunction=null,this.devListSortFunction=null,this.devTableRule={},this.dataInfoRule={},this.statInfoRule={},this.otherInfoRule={},this.preExtInfoRule={},this.width,this.height,this.defaultShowIndexFunction=null},mono.extend(c.PropertyManager,Object,{setDefaultRackRule:function(a){if(a&&!(a.length<1)){a instanceof Array||(a=[a]);for(var b=this,d=[{label:"",property:function(a){return a.getId()}},{label:"Id",property:"userId"},{label:"",property:""}],e=[{header:"",width:"5",property:function(a){return a.getId()}},{header:"",width:3,property:function(a){var c=b.dataManager.getDataTypeForData(a);return c&&c.getDescription()?c.getDescription():c&&c.getModel()?c.getModel():void 0}},{header:"",width:4,property:function(a){var c="",d=b.dataManager.getDataTypeForData(a),e=1;return d&&d.getSize()&&d.getSize().ySize&&(e=d.getSize().ySize),a.getLocation()&&a.getLocation().y&&(c=a.getLocation().y+"U-"+(a.getLocation().y+e)+"U("+e+"U)"),c}}],f={value:function(a){var d=new c.SpaceManager(b.dataManager,b.sceneManager),e=d.computeSpace(a);if(e&&e instanceof c.Space1){var f=[];if(e._emptyList&&e._emptyList.length>0)for(var g=0;g<e._emptyList.length;g++){var h=e._emptyList[g];f.push(h.start+"U-"+h.end+"U("+h.total+"U)")}var i={};return i.U=e._occupation+"U",i.U=e._total-e._occupation+"U",i.=f,i}}},g=0;g<a.length;g++){var h=a[g];h&&(this.dataInfoRule[h]=d,this.devTableRule[h]=e,this.statInfoRule[h]=f)}}},setDefaultEquipmentRule:function(a){if(a&&!(a.length<1)){a instanceof Array||(a=[a]);for(var b=this,c=[{label:"",property:function(a){return a.getId()}},{label:"",property:function(a){var c=b.dataManager.getDataTypeForData(a),d=1;return c&&c.getSize()&&c.getSize().ySize&&(d=c.getSize().ySize),d}},{label:"",property:""}],d=0;d<a.length;d++){var e=a[d];e&&(this.dataInfoRule[e]=c)}}},isShow:function(a){return!0},show:function(a,b){if(this.isShow(a)&&a){var d=null,e=null;a instanceof c.Data?d=a:a instanceof c.Link?e=this.sceneManager.getLinkNodeById(a):d=this.dataManager.getDataById(a),e||(e=this.sceneManager.getNodeByDataOrId(d));var f=this.getContentByNode(e),g=this.getTitleByNode(a),h=this.getOffset(e);this.propertyPane.show({items:f},e,g,h,b)}},showTabByIndex:function(a){this.propertyPane.showTabByIndex(a)},getDefaultShowIndex:function(a,b,c){return this.defaultShowIndexFunction?this.defaultShowIndexFunction(a,b,c):void 0},setSceneManager:function(a){if(a){this.sceneManager=a,this.dataManager=a.dataManager;var b=this.defaultEventHandler=a.viewManager3d.getDefaultEventHandler();if(b){var d=this,e=b.afterLookAtFunction;b.afterLookAtFunction=function(a,b){e&&e(a,b);var f=null;a instanceof c.Data?(f=a,a=d.sceneManager.getNodeByDataOrId(a)):f=d.sceneManager.getNodeData(a);var g=d.getContentByNode(a);if(g&&g.length>0&&d.isShow(g)){var h=d.getTitleByNode(a),i=d.getOffset(a),j=d.getDefaultShowIndex(f,a,{items:g});d.propertyPane.show({items:g},a,h,i,j)}else d.propertyPane.hide()}}var f=new c.EventHandler;f.shouldHandleDoubleClickElement=function(){return!0},f.handleDoubleClickElement=function(a,b,c,e){var f=d.getContentByNode(a);if(f&&f.length>0){var g=d.getTitleByNode(c),h=d.getOffset(a);d.propertyPane.show({items:f},g,h)}else d.propertyPane.hide()},this.sceneManager.addSceneChangeListener(function(a){d.propertyPane.hide()}),this.sceneManager.viewManager2d&&this.sceneManager.viewManager2d.addEventHandler(f)}},setPropertyPaneSize:function(a,b){this.width=a,this.height=b},getContentByNode:function(a){if(this.getContentFunction){var b=this.getContentFunction(a);return b instanceof Array?b:[b]}if(!this.mainParentDiv){var d=null;d=a instanceof twaver.Element?this.sceneManager.network2d.getView():this.sceneManager.network3d.getRootView(),d&&d.appendChild(this.propertyPane.propertyPane[0])}var e=this.sceneManager.getLinkData(a);return e&&e instanceof c.Link?(this.propertyPane.setWidthForPropertyPane("30%"),this.createDefaultLinkContent(a)):(this.width&&parseInt(this.width)&&this.propertyPane.setWidthForPropertyPane(parseInt(this.width)+"px"),this.height&&parseInt(this.height)&&this.propertyPane.setHeightForPropertyPane(parseInt(this.height)+"px"),this.createDefaultDataContent(a))},getTitleByNode:function(a){var b="";return a?(a instanceof c.Data?b=":"+a.getId():this.sceneManager&&this.sceneManager.getNodeData(a)&&(b=":"+this.sceneManager.getNodeData(a).getId()),""+b):""},getOffset:function(a){return{left:100,top:100}},createDefaultDataContent:function(a){var b=this.getPreExtInfo(a),c=this.getGeneralInfo(a),d=this.getDevListInfo(a),e=this.getStatInfo(a),f=this.getOthers(a),g=[];if(b)if(b instanceof Array)for(var h=0;h<b.length;h++)g.push(b[h]);else g.push(b);if(c&&g.push(c),d&&g.push(d),e&&g.push(e),f)if(f instanceof Array)for(var h=0;h<f.length;h++)g.push(f[h]);else g.push(f);return g},createDefaultLinkContent:function(a){var b=null;if(b=a instanceof c.Link?a:a instanceof mono.Element?this.sceneManager.getLinkData(a):this.dataManager.getLinkById(a),!b)return null;var d=b.getFromId(),e=b.getToId(),f=this.dataManager.getDataTypeForData(d),g=this.dataManager.getDataTypeForData(e),h=f?f.getDescription():"",i=g?g.getDescription():"",j={};j.=b.getName(),j.=b.getType(),j.A=d||"",j.A=b.getFromPortId(),j.B=e||"",j.B=b.getToPortId(),j.1=":"+(d||"")+"  :"+h+" :"+b.getFromPortId(),j.2=":"+(e||"")+"  :"+i+" :"+b.getToPortId();var k={title:"",properties:j,className:"it-property-basic",onclick:function(a){}},l={title:"",properties:null,className:"it-property-equip"};return[k,l]},getGeneralInfo:function(a){if(!a)return null;var b=a.getClient(c.SceneManager.CLIENT_IT_DATA),d=null,e=this.dataManager.getDataTypeForData(b);if(e&&e.getCategoryId()){var f=this.dataInfoRule[e.getCategoryId()];if(f&&f.length>0)for(var g=0;g<f.length;g++){var h=f[g];if(h){var i=h.label,j="";h.property&&(j="function"==typeof h.property?h.property(b):b.getUserData(h.property));var k=!1;h.isButton&&(k="function"==typeof h.isButton?h.isButton(b):h.isButton);var l="";h.style&&(l="function"==typeof h.style?h.style(b):h.style);var m=h.classname,n=h.onclick;d||(d={}),d[i]={value:j||"",isButton:k,style:l,onclick:n,classname:m,origin:h.origin}}}}if(!d&&this.nodeDefaultInfoFunction&&this.nodeDefaultInfoFunction(a)&&(d=this.nodeDefaultInfoFunction(a)),!d)return null;var o={title:"",properties:d,className:"it-property-basic",onclick:function(a){}};return o},getDevListInfo:function(a){if(!a||!this.dataManager)return null;var b=a.getClient(c.SceneManager.CLIENT_IT_DATA);if(!b)return null;var d=b.getChildren(),e=[],f=this.dataManager.getDataTypeForData(b);if(!f||!f.getCategoryId())return null;var g=this.devTableRule[f.getCategoryId()];if(!g)return null;if(e.title=this.createTableHeaderByRuleInfo(g),d&&d.size()>0){var h=this;d.forEach(function(a){if(a){var b=h.createTableRowByRuleInfo(g,a),c={values:b,callback:function(){if(h.devClickFunction)return h.devClickFunction(a);if(h.defaultEventHandler&&h.sceneManager){var b=h.sceneManager.dataNodeMap[a.getId()];b&&h.defaultEventHandler.lookAt(b)}},mousemove:function(){h.mouseoverDevFunction&&h.mouseoverDevFunction(a)}};e.push(c)}})}if(this.devListSortFunction){var h=this;e.sort(function(a,b){return h.devListSortFunction(a,b)})}var i={title:"",properties:e,className:"it-property-equip"};return i},createTableHeaderByRuleInfo:function(a){var b=[];if(a&&a instanceof Array)for(var c=0;c<a.length;c++){var d=a[c];if(d){var e={};d.width&&(e.c_width=d.width),d.header&&(e.text=d.header),b.push(e)}}return b},createTableRowByRuleInfo:function(a,b){if(!b)return null;var c=[];if(a&&a instanceof Array)for(var d=0;d<a.length;d++){var e=a[d];if(e){var f={};e.width&&(f.c_width=e.width),e.property&&"function"==typeof e.property&&(f.text=e.property(b)),c.push(f)}}return c},getStatInfo:function(a){if(!a)return null;var b=a.getClient(c.SceneManager.CLIENT_IT_DATA);if(!b)return null;var d=this.dataManager.getDataTypeForData(b);if(!d||!d.getCategoryId())return null;var e=this.statInfoRule[d.getCategoryId()],f=null;if(e&&e.value&&(f="function"==typeof e.value?e.value(b):e.value),f){var g={title:"",properties:f,isGrop:!1,className:"it-property-chart"};return g}},getPreExtInfo:function(a){if(!a)return null;var b=a.getClient(c.SceneManager.CLIENT_IT_DATA);if(!b)return null;var d=[],e=this.dataManager.getDataTypeForData(b);if(e&&e.getCategoryId()){var f=this.preExtInfoRule[e.getCategoryId()];f&&(f instanceof Array?d=f:d.push(f))}if(this.getPreExtInfoFunction){var g=this.getPreExtInfoFunction(a);if(g)if(g instanceof Array)for(var h=0;h<g.length;h++)d.push(g[h]);else d.push(g)}return d},getOthers:function(a){if(!a)return null;var b=a.getClient(c.SceneManager.CLIENT_IT_DATA);if(!b)return null;var d=[],e=this.dataManager.getDataTypeForData(b);if(e&&e.getCategoryId()){var f=this.otherInfoRule[e.getCategoryId()];f&&(f instanceof Array?d=f:d.push(f))}if(this.getExtInfoFunction){var g=this.getExtInfoFunction(a);if(g)if(g instanceof Array)for(var h=0;h<g.length;h++)d.push(g[h]);else d.push(g)}return d}});var L=function(a){a=a||{},this.xSize=a.x,this.ySize=a.y,this.zSize=a.z,this.xPadding=a.xPadding||[0,0],this.yPadding=a.yPadding||[0,0],this.zPadding=a.zPadding||[0,0],this.xGap=0,this.yGap=0,this.zGap=0};mono.extend(L,Object,{__accessor:["xSize","ySize","zSize","xPadding","yPadding","zPadding"],parse:function(){}}),c.Size=L;var M=function(a){this.parse(a)};c.Location=M;var N=c.Location.Align={};N.pos_neg=-1,N.center_neg=-2,N.neg_neg=-3,N.center=-4,N.pos_pos=-5,N.center_pos=-6,N.neg_pos=-7,mono.extend(M,Object,{set:function(a,b){var d=b;"string"==typeof b&&(d=c.Location.Align[b],d||(d=b)),this[a]=d},setX:function(a){this.set("x",a)},setY:function(a){this.set("y",a)},setZ:function(a){this.set("z",a)},getX:function(){return this.x},getY:function(){return this.y},getZ:function(){return this.z},parse:function(a){if(a){if(!c.defaultLocatonParser)throw"it.defaultLocatonParser is null";var b=c.defaultLocatonParser.parse(a);if(!(null!=b&&b instanceof c.Location))throw"it.defaultLocatonParser.parse() does not return a it.Location";this.location=b,this.x=b.x,this.y=b.y,this.z=b.z}}}),M.getAlignName=function(a){for(var b in N)if(N[b]===a)return b},c.LocationParser=function(){},mono.extend(c.LocationParser,Object,{parse:function(a){return null}}),c.DefaultLocatonParser=function(){c.LocationParser.call(this)},mono.extend(c.DefaultLocatonParser,c.LocationParser,{parse:function(a){var d=new c.Location;return a instanceof c.Location?(d.x=a.x,d.y=a.y,d.z=a.z):a.x!==b||a.y!==b||a.z!==b?(d.setX(a.x),d.setY(a.y),d.setZ(a.z)):"string"==typeof a&&(d=this.parseText(a)),d},parseText:function(a){var a=JSON.parse(a);if(!a)return null;if(a.x!==b||a.y!==b||a.z!==b){var d=new c.Location;return d.setX(a.x),d.setY(a.y),d.setZ(a.z),d}return null},charToNum:function(a){return a&&a.toUpperCase&&a.length?(a=a.toUpperCase(),a.chartCodeAt(0)-96):void 0}}),c.defaultLocatonParser=new c.DefaultLocatonParser;var O=function(a){this.sceneManager=a,this.dataManager=a.dataManager,this._positionFunctionMap={},this._rotationFunctionMap={}};mono.extend(O,Object,{registerPositionFunction:function(a,b,c){var d=b+"&"+a;this._positionFunctionMap[d]=c},registerRotationFunction:function(a,b,c){var d=b+"&"+a;this._rotationFunctionMap[d]=c},_computePosition:function(a,b,d,e,f){var g=this.dataManager,h=a.getLocation(),i=g.getDataTypeForData(a),j=g.getDataTypeForData(b),k=this.dataManager.getCategoryForDataType(j),l=i.getSize(),m=j.getChildrenSize()||new c.Size,n=d.getBoundingBox();n.size()&&(n.size().x||n.size().y||n.size().z)||(n=c.Util.getBoundingBox(d));var f=f||e.getBoundingBox(),o=i.getPositionExp()||{},p=h.getX(),q=h.getY(),r=h.getZ(),s={x:p,y:q,z:r,dataType:i,parentDataType:j,parentCategory:k,data:a,parentData:b,bb:n,pbb:f};if(o.x){var t=new Function("x","y","z","data","return "+o.x);p=t.call(this,p,q,r,s)||p}if(o.z){var t=new Function("x","y","z","data","return "+o.z);r=t.call(this,p,q,r,s)||r}if(o.y){var t=new Function("x","y","z","data","return "+o.y);q=t.call(this,p,q,r,s)||q}var u=this._computeOneAxisPosition("x",p,l.getXSize(),m.getXSize(),m.getXPadding(),n,f)||a.getPosition().x,v=this._computeOneAxisPosition("z",r,l.getZSize(),m.getZSize(),m.getZPadding(),n,f)||a.getPosition().z,w=h.getY(),x=null;this._isAlignment(w)&&(x=this._findFloor(e),f=x.getBoundingBox());var y=this._computeOneAxisPosition("y",q,l.getYSize(),m.getYSize(),m.getYPadding(),n,f)||a.getPosition().y,z=new mono.Vec3(u,y,v);d.p(z)},computePosition:function(a,b,d,e){var f=this.dataManager,g=f.getCategoryForData(a),h=f.getCategoryForData(b),i=g?g.getId():"",j=h?h.getId():"",k=this._positionFunctionMap,l=this,m=k[j+"&"+i];if(m){var n=m(a,b,d,e);if(n!==!1)return}if(!b)return void d.p(a.getPosition());var o=a.getLocation();if(!o)return void d.p(a.getPosition());if(d instanceof mono.Billboard)return void d.p(a.getPosition());if(!e)return void d.p(a.getPosition());if(e){var p=e.getClient("complexNode");if(p)"unload"==p?this.sceneManager.loadComplexNode(b,function(f){var g=f.getBoundingBox();g.size()&&(g.size().x||g.size().y||g.size().z)||(g=c.Util.getBoundingBox(f)),l._computePosition(a,b,d,e,g)}):(q=p.getBoundingBox(),q.size()&&(q.size().x||q.size().y||q.size().z)||(q=c.Util.getBoundingBox(p)),l._computePosition(a,b,d,e,q));else{var q=e.getBoundingBox();q.size()&&(q.size().x||q.size().y||q.size().z)||(q=c.Util.getBoundingBox(e)),l._computePosition(a,b,d,e,q)}}},_findFloor:function(a){return a},_computeOneAxisPosition:function(a,b,c,d,e,f,g){if(b=parseFloat(b),Number.isNaN(b))return null;if(d&&!this._isAlignment(b)){e=e||[0,0];var h=g.max[a]-g.min[a]-parseFloat(e[0])-parseFloat(e[1]),i=h/d;return g.min[a]-f.min[a]+i*(b-1)+parseFloat(e[0])}return this._isAlignment(b)?this._getAlignPosition(f,g,b,e,a):void 0},_isAlignment:function(a){return!!c.Location.getAlignName(a)},_getAlignPosition:function(a,b,c,d,e){return c===N.pos_neg?b.min[e]-a.max[e]+d[0]:c===N.center_neg?b.min[e]:c===N.neg_neg?b.min[e]-a.min[e]+d[0]:c===N.center?b.center()[e]:c===N.pos_pos?b.max[e]-a.max[e]-d[1]:c===N.center_pos?b.max[e]:c===N.neg_pos?b.max[e]-a.min[e]-d[1]:void 0},isNull:function(a){return a==b?!0:"string"==typeof a&&""==a.trim()?!0:!1},translateRotation:function(a){if(!a)return a;var b=new mono.Vec3;return a.x?b.setX(Math.PI*a.x/180):b.setX(a.x),a.y?b.setY(Math.PI*a.y/180):b.setY(a.y),a.z?b.setZ(Math.PI*a.z/180):b.setZ(a.z),b},computeRotation:function(a,c,d,e){var f=this.dataManager,g=a.getLocation(),h=f.getDataTypeForData(a),i=h.getRotationExp(),j=this.translateRotation(a.getRotation());if(d.setRotation(new mono.Vec3),!(!j||this.isNull(j.x)&&this.isNull(j.y)&&this.isNull(j.z)))return void d.setRotation(j);if(g&&i){var k,l,m,n=g.getX(),o=g.getY(),p=g.getZ(),q={x:n,y:o,z:p,data:a,dataType:h,parentData:c,location:g},r=a.getPosition();r.x,r.y,r.z;if(i.x){var s=new Function("x","y","z","data","return "+i.x);k=s.call(this,n,o,p,q)||0}if(i.y){var s=new Function("x","y","z","data","return "+i.y);l=s.call(this,n,o,p,q)||0}if(i.z){var s=new Function("x","y","z","data","return "+i.z);m=s.call(this,n,o,p,q)||0}k!=b&&null!=k&&d.setRotationX(k),l!=b&&null!=l&&d.setRotationY(l),m!=b&&null!=m&&d.setRotationZ(m)}}}),c.LocationManager=O,c.Space1=function(a,b){this._spaceArray=a||[],this._axis=b,this.init(),this.compute()},mono.extend(c.Space1,Object,{setSpaceArray:function(a){this._spaceArray=a,this.init(),this.compute()},getSpaceArray:function(){return this._spaceArray},getTotal:function(){return this._total},getPercent:function(){return this._percent},getOccupation:function(){return this._occupation},getOccupationList:function(){return this._occupationList},getEmptyList:function(){return this._emptyList},getAxis:function(){return this._axis},isAvailableAt:function(a,b){if(1>a&&a>this._total)return!1;b=b||1;var c=a,d=a+b-1;if(d>this._total)return!1;for(var e,f=0,g=this._occupationList.length;g>f;f++)if(e=this._occupationList[f],c>=e.start&&c<=e.end||d>=e.start&&d<=e.end)return!1;return!0},isValid:function(){return this._total>0},_addStatistic:function(a,b,c){(1===a||0===a)&&(b.end=c,b.occupation?this._occupationList.push(b):this._emptyList.push(b),b.total=b.end-b.start+1,delete b.occupation)},getCountForSize:function(a){for(var b=0,c=0;c<this._emptyList.length;c++){var d=this._emptyList[c];b+=parseInt(d.total/a)}return b},init:function(){this._total=0,this._percent=0,this._occupation=0,this._occupationList=[],this._emptyList=[]},compute:function(){var a,b=this._spaceArray,c=b.length,d=null;this._total=c;for(var e=0;c>e;e++){var f=b[e];1==f&&this._occupation++,(0==e||d!=f)&&(this._addStatistic(d,a,e),a={start:e+1,occupation:f}),d=f,e==c-1&&this._addStatistic(d,a,e+1)}this._total>0&&(this._percent=this._occupation/this._total)}}),c.Space2=function(a,b,c){this._spaceArray=a||[[]],this._axis=b,this._mainAxis=c,this.init(),this.compute()},mono.extend(c.Space2,Object,{setSpaceArray:function(a){this._spaceArray=a,this.init(),this.compute()},getSpaceArray:function(){return this._spaceArray},getAxis:function(){return this._axis},getMainAxis:function(){return this._mainAxis},init:function(){this._total=0,this._percent=0,this._occupation=0},compute:function(){for(var a,b=0,c=this._spaceArray.length;c>b;b++)a=this._spaceArray[b],this._total+=a.getTotal(),this._occupation+=a.getOccupation();this._total>0&&(this._percent=this._occupation/this._total)},getCountForSize:function(a){for(var b,c=0,d=this._spaceArray.length,e=0;d>c;c++)b=this._spaceArray[c],e+=b.getCountForSize(a);return e}});var P=function(a,b){this.dataManager=a,this.sceneManager=b,this.nodeMap={},this.spaceNodeColorFunction=null,this.spaceNodeFrameColorFunction=null,this.spaceVisibleFilter=new c.SpaceVisibleFilter(b,this),this.spaceMaterialFilter=new c.SpaceMaterialFilter(b,this),this.spaceAdapter=new H(b,this)};mono.extend(P,Object,{_initArray:function(a,b){b=b||0;for(var c=[],d=0;a>d;d++)c.push(b);return c},_initArray2:function(a,b,c){c=c||0;for(var d=[],e=0;a>e;e++){for(var f=[],g=0;b>g;g++)f.push(0);d.push(f)}return d},initSpaceArray:function(a,b,c){},computeSpace:function(a,b){var d,e=this.dataManager,f=e.getDataTypeForData(a),g=f.getChildrenSize(),h=a.getChildren(),i=g.getXSize(),j=g.getYSize(),k=g.getZSize(),l=0,m=[],n="",o="";if(i&&(l++,m.push({axis:"x",size:i}),n+="x",n!==b&&(o="x")),j&&(l++,m.push({axis:"y",size:j}),n+="y",n!==b&&(o="y")),k&&(l++,n+="z",m.push({axis:"z",size:k}),n!==b&&(o="z")),l>2)return void console.error("Only support 1 or 2 dimension");if(2==l&&!b)return void console.error("Main Axis is needed for 2 dimension");var p=null;if(1==l){p=this._initArray(m[0].size);for(var q=0;q<h.size();q++){var d=h.get(q),r=e.getDataTypeForData(d),s=r.getSize(),t=d.getLocation();this.computeOneDimesion(p,s["get"+n.toUpperCase()+"Size"](),t["get"+n.toUpperCase()]())}var u=new c.Space1(p,n);return u}if(2==l){for(var v=g["get"+o.toUpperCase()+"Size"](),w=g["get"+b.toUpperCase()+"Size"](),x=[],y=0;v>y;y++){for(var p=this._initArray(w),q=0;q<h.size();q++){var d=h.get(q),r=e.getDataTypeForData(d),s=r.getSize(),t=d.getLocation();t["get"+o.toUpperCase()]()==y+1&&this.computeOneDimesion(p,s["get"+b.toUpperCase()+"Size"](),t["get"+b.toUpperCase()]())}var z=new c.Space1(p,b);x.push(z)}var A=new c.Space2(x,n,b);return A}return null},computeOneDimesion:function(a,c,d){if((null==c||c==b)&&(c=1),a&&c&&d>0){for(var e=0;c>e;e++)a[d-1+e]=1;return a}},getSpaceNodeColor:function(a,b,c){if(this.spaceNodeColorFunction){var d=this.spaceNodeColorFunction(a,b,c);return d}var d=null;return d="orange"},getSpaceNodeFrameColor:function(a,b,c){if(this.spaceNodeFrameColorFunction){var d=this.spaceNodeFrameColorFunction(a,b,c);return d}return this.getSpaceNodeColor(a,b,c)},showSpaceMode:function(){this.sceneManager.viewManager3d.addVisibleFilter(this.spaceVisibleFilter),this.sceneManager.viewManager3d.addMaterialFilter(this.spaceMaterialFilter),this.sceneManager.adapterManager.register(this.spaceAdapter)},hideSpaceMode:function(){this.sceneManager.viewManager3d.removeVisibleFilter(this.spaceVisibleFilter),this.sceneManager.viewManager3d.removeMaterialFilter(this.spaceMaterialFilter),this.sceneManager.adapterManager.deregister(this.spaceAdapter)},getModelParent:function(a){if(null==a)return null;var b=a.getClient("modelParent");return null==b?this.getModelParent(a.getParent()):b},remove1DSpaceNodeForNodes:function(a){a instanceof mono.List&&(a=a.toArray());for(var b,c,d=this.sceneManager.network3d.getDataBox(),e=0,f=0;e<a.length;e++){b=a[e];var g=null,h=b.getChildren().toArray();for(f=0;f<h.length;f++)c=h[f],(this.isSpaceNode(c)||this.isSpaceChildrenNode(c))&&(d.removeByDescendant(c),c.setParent(null),this.isSpaceNode(c)&&(g=c));if(g){var i=g.getClient("modelRemovedNode");if(i){var j=b.getClient("complexNode");b.getClient("simpleNode");if("unload"!=j&&j&&b.getChildren().contains(j))for(var h=b.getChildren(),e=0;e<h.size();e++){var c=h.get(e);this.isSpaceChildrenNode(c)&&(c.setParent(null),d.removeByDescendant(c))}else i.setParent(b),d.getDataById(b.getId())&&d.addByDescendant(i)}}}},create1DSpaceNodeForNodes:function(a,b){b=b||1,a instanceof mono.List&&(a=a.toArray());var c=this.sceneManager.network3d.getDataBox();c.startBatch();for(var d,e,f,g=this.sceneManager.viewManager3d._focusNode,h=0,i=0;h<a.length;h++)if(d=a[h],d!==g){var j=d.getChildren().toArray();for(i=0;i<j.length;i++){var k=j[i];if((this.isSpaceNode(k)||this.isSpaceChildrenNode(k))&&(c.removeByDescendant(k),k.setParent(null),this.isSpaceNode(k)&&k.getClient("modelRemovedNode"))){var l=k.getClient("modelRemovedNode");l.setParent(d),c.addByDescendant(l)}}if(e=this.sceneManager.getNodeData(d)){if(f=1==b?this.create1DSpaceNode(e):this.create1DSpaceNode2(e),!f)continue;var m=d.getClient("complexNode"),n=d.getClient("simpleNode");n&&d.getChildren().contains(n)?(n.setParent(null),c.removeByDescendant(n),f.setClient("modelRemovedNode",n)):"unload"!=m&&m&&d.getChildren().contains(m)&&(m.setParent(null),c.removeByDescendant(m),f.setClient("modelRemovedNode",m));var o=d.getChildren();if(o&&o.size())for(var p=0;p<o.size();p++){var q=o.get(p),r=this.sceneManager.getNodeData(q);r&&r.getParentId()==e.getId()&&(q.setParent(null),c.removeByDescendant(q))}f.setClient("modelParent",d),f.setParent(d),c.addByDescendant(f)}}c.endBatch()},isSpaceNode:function(a){return a.getClient("spaceNode")},hasSpaceNode:function(a){if(!a)return!1;var b=a.getChildren();if(b&&b.size()>0)for(var c=0;c<b._as.length;c++){var d=b._as[c];if(this.isSpaceNode(d))return!0}return!1},hasSpaceChildrenNode:function(a){if(!a)return!1;var b=a.getChildren();if(b&&b.size()>0)for(var c=0;c<b._as.length;c++){var d=b._as[c];if(this.isSpaceChildrenNode(d))return!0}return!1},isSpaceChildrenNode:function(a){return a.getClient("spaceChildrenNode")},create1DSpaceNode:function(a,b){var d=this.computeSpace(a);if(d instanceof c.Space1){var e=this.dataManager,f=this.sceneManager,g=e.getDataTypeForData(a),h=(g.getChildrenSize(),f.getNodeForDataOrId(a));if(h){var i=d.getPercent();0==i&&(i=.01);var j=this.getSpaceNodeColor(i,a,d),k=(this.getSpaceNodeFrameColor(i,a,d)||j,h.getBoundingBox()),l=k.max.x-k.min.x,m=k.max.y-k.min.y,n=k.max.z-k.min.z,o=1;l-=4,m-=4;var p=new mono.Cube(l+o,m+o,n+o);p.setClient("spaceNode",!0),p.s({"m.wireframe":!0,"m.transparent":!0,"m.wireframeLineopacity":.1});var q=d.getAxis();"x"===q&&(l*=i),"y"===q&&(m*=i),"z"===q&&(n*=i);var r=this.createColorCube(l,m,n);r.setClient("spaceNode",!0),r.setY(10),r.setParent(p);var s=r.getBoundingBox();"x"===q?r.setX(k.min.x-s.min.x*r.getScaleX()):"y"===q?r.setY(k.min.y-s.min.y*r.getScaleY()+1):r.setZ(k.min.z-s.min.z*r.getScaleZ());var t="data:image/jpeg;base64,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",u=-(10*Math.random()+5);
return j=this.shadeColor(j,u),r.s({"m.type":"phong","m.color":j,"m.ambient":j,"m.specularStrength":20,"left.m.lightmap.image":t,"right.m.lightmap.image":t,"back.m.lightmap.image":t,"front.m.lightmap.image":t}),p}}},shadeColor:function(a,b){var c=parseInt(a.substring(1,3),16),d=parseInt(a.substring(3,5),16),e=parseInt(a.substring(5,7),16);c=parseInt(c*(100+b)/100),d=parseInt(d*(100+b)/100),e=parseInt(e*(100+b)/100),c=255>c?c:255,d=255>d?d:255,e=255>e?e:255;var f=1==c.toString(16).length?"0"+c.toString(16):c.toString(16),g=1==d.toString(16).length?"0"+d.toString(16):d.toString(16),h=1==e.toString(16).length?"0"+e.toString(16):e.toString(16);return"#"+f+g+h},createColorCube:function(a,b,c){this.colorCube||(this.colorCube=new mono.Cube(1,1,1));var d=this.colorCube.clonePrefab();return d.setScale(a,b,c),d},removeSpaceNode:function(a){var b=this.sceneManager;b.removeNodeChildren(a,function(a){return a.getClient("spaceNode")})},create1DSpaceNode2:function(a,b){var c=this.create1DChildrenSpaceNodes2(a,b);return c},removeSpaceChildrenNode:function(a){var b=this.sceneManager;b.removeNodeChildren(a,function(a){return a.getClient("spaceChildrenNode")})},create1DChildrenSpaceNodes2:function(a,b){var d=this.computeSpace(a);if(!(!d instanceof c.Space1)){var e=this.dataManager,f=this.sceneManager,g=f.getNodeForDataOrId(a),h=e.getDataTypeForData(a),i=h.getChildrenSize();if(g){var j=d.getAxis();if(j){var k=g.getBoundingBox(),l=k.size(),m=d.getEmptyList(),n=d.getOccupationList(),o=new mono.Cube(l.x-2,l.y,l.z-2);o.setClient("spaceNode",!0),o.setParent(g);for(var p,q=[],r=0;r<m.length;r++){p=m[r];var s=this.create1DChildrenSpaceNode2(k,i,p,j,!0);s.setParent(o),q.push(s)}for(var r=0;r<n.length;r++){p=n[r];var s=this.create1DChildrenSpaceNode2(k,i,p,j,!1);s.setParent(o),q.push(s)}return o.s({"m.transparent":!0,"m.opacity":.1}),o}}}},create1DChildrenSpaceNode2:function(a,b,c,d,e){var f=c.total,g=c.start,h=(c.end,a.size()),i=h.x,j=h.y,k=h.z,l=(b.getXPadding()||[0,0],b.getYPadding()||[0,0],b.getZPadding()||[0,0],0),m=1;"x"===d?(i=f*i/b.getXSize(),i-=m,l=f/b.getXSize()):"y"===d?(j=f*j/b.getYSize(),j-=m,l=f/b.getYSize()):"z"===d&&(k=f*k/b.getZSize(),k-=m,l=f/b.getZSize());var n=new mono.Cube(i-2,j-2,k-2),o=n.getBoundingBox(),p=0,q=0,r=0;"x"===d?p=a.min.x-o.min.x+h.x/b.getXSize()*(g-1)+m/2:"y"===d?q=a.min.y-o.min.y+h.y/b.getYSize()*(g-1)+m/2:"z"===d&&(r=a.min.z-o.min.z+h.z/b.getZSize()+m/2),n.p(p,q,r);var s=emtpy?this.getSpaceNodeColor(l):"#A4A4A4";return n.s({"m.type":"phong","m.specularStrength":50,"m.color":s,"m.ambient":s}),e&&n.s({"m.transparent":!0,"m.opacity":.6}),n.setClient("spaceNode",!0),n},create1DChildrenSpaceNodes:function(a,b){var d=this.computeSpace(a);if(d instanceof c.Space1){var e=this.dataManager,f=this.sceneManager,g=e.getDataTypeForData(a),h=g.getChildrenSize(),i=f.getNodeForDataOrId(a);if(i){var j=d.getAxis();if(j){var k=i.getBoundingBox(),l=i.getClient("complexNode");l&&"unload"!=l&&(k=l.getBoundingBox(),k.size()&&(k.size().x||k.size().y||k.size().z)||(k=c.Util.getBoundingBox(l)));for(var m,n=k.size(),o=n.x,p=n.y,q=n.z,r=d.getEmptyList(),s=[],t=0,u=d.getPercent();t<r.length;t++)m=r[t],s.push(this.createEmptyNode(m,o,p,q,j,h,k,a,u));return s}}}},createEmptyNode:function(a,b,c,d,e,f,g,h,i){var j=a.total,k=a.start,l=(a.end,f.getXPadding()||[0,0]),m=f.getYPadding()||[0,0],n=f.getZPadding()||[0,0];b-=l[0]+l[1],c-=m[0]+m[1],d-=n[0]+n[1];var o=1,p="";"x"===e?(b=j*b/f.getXSize(),p=j+"("+k+"-"+(k+j-1)+")"):"y"===e?(c=j*c/f.getYSize(),p=j+"U("+k+"-"+(k+j-1)+")"):"z"===e&&(d=j*d/f.getZSize(),p=j+"("+k+"-"+(k+j-1)+")");var q=new mono.Cube(b-o,c-o,d-o),r=q.getBoundingBox(),s=0,t=0,u=0;"x"===e?s=g.min.x-r.min.x+l[0]+b/j*(k-1)+o/2:"y"===e?t=g.min.y-r.min.y+m[0]+c/j*(k-1)+o/2:"z"===e&&(u=g.min.z-r.min.z+n[0]+d/j*(k-1)+o/2),q.p(s,t,u);var v=this.getSpaceNodeColor(i,h);q.setClient("spaceChildrenNode",!0);var w=q.width/q.height,x=this.createTextImage(p,{color:"#000000",font:'180px "Microsoft YaHei"',ratio:w,background:v,powerOfTwo:!0}),y=new mono.Vec3(x.drawRect.width/x.width,x.drawRect.height/x.height);return q.s({"m.color":v,"front.m.type":"basic","front.m.texture.image":x,"front.m.texture.repeat":y}),q},createTextImage:function(a,c){a=a||"",a+="";var d=c.font,e=c.color,f=c.background,g=c.powerOfTwo,h=c.canvas,i=c.drawFunction;h=h||document.createElement("canvas"),d=d||'20px "Dialog"',e=e||"white",f=f===b?"#0F90C4":f,g=g||!1;var j=a.split("\n"),k=mono.Utils.getMaxTextSize(j,d),l=c.ratio||k.width/k.height,m=h.realSize={width:k.width,height:k.height},n=h.drawRect={width:m.width/m.height>l?m.width:m.height*l,height:m.width/m.height>l?m.width/l:m.height};Number.isNaN(n.width)&&console.log("debug -- b",m.width,m.height,l),g&&(k.width=mono.Utils.nextPowerOfTwo(n.width),k.height=mono.Utils.nextPowerOfTwo(n.height)),h.width=k.width,h.height=k.height,Number.isNaN(n.width)&&console.log("debug -- a");var o=h.getContext("2d");if(f&&(o.fillStyle=f),i)i(o,h.width,h.height);else{f&&o.fillRect(0,0,h.width,h.height),o.font=d,o.fillStyle=e,o.strokeStyle="gray",o.textBaseline="middle";for(var p=j.length,q=m.height/p,r=0;p>r;r++){var s=(mono.Utils.getTextSize(d,j[r]).width,h.height,(n.width-m.width)/2),t=(n.height-m.height)/2+q/2+r*q+(h.height-n.height);o.strokeText(j[r],s,t),o.fillText(j[r],s,t)}}return h}}),c.SpaceManager=P;var Q=function(a,b){this.sceneManager=a,this.spaceManager=b,this.visibleMap={};var c=this;this.sceneManager.viewManager3d.addPropertyChangeListener(function(a){"focusNode"==a.property&&(c.visibleMap={})})};mono.extend(Q,x,{isVisible:function(a,b,c){var d=a.getId();return a instanceof mono.Billboard?(this.visibleMap[d]=!1,!1):!0}}),c.SpaceVisibleFilter=Q;var R=function(a,b){this.sceneManager=a,this.spaceManager=b,this.materialMap={}};mono.extend(R,w,{filterMaterial:function(a,b,c){var d=this.sceneManager,e=d.viewManager3d,f=this.spaceManager,g=e.getFocusNode();this.materialMap;if(d.getNodeData(c))return b;if(f.isSpaceNode(c)&&g){if(c.isDescendantOf(g))return b;var h=a.getUniqueCode(),i=this.materialMap[h];return i||(i=a.clone(),this.materialMap[h]=i,i.transparent=!0,i.opacity=.05),i}}}),c.SpaceMaterialFilter=R;var S=function(a){var a=a||{};this.sceneManager=a.sceneManager,this.viewManager3d=this.sceneManager.viewManager3d,this.box3D=this.sceneManager.network3d.getDataBox(),this.defaultMaterialFilter=this.viewManager3d.getDefaultVirtualMaterialFilter(),this.defaultEventHandler=this.viewManager3d.getDefaultEventHandler(),this._flagLink=null,this.animates={},this.linkBillboard={},this.linkManager=new U(this.sceneManager),this.defaultSetFocusNode=this.viewManager3d.setFocusNode,this.undoSetFocusNode=function(a){},this.mdfMap={},this.lightBillboardMap={},this.init()};mono.extend(S,t,{init:function(){this.viewManager3d.addEventHandler(this);var a=this;this.gcsManagerInterval=setInterval(function(){var b=a.linkBillboard;if(b)for(var d in b){var e=a.sceneManager.dataManager.getLinkById(d);if(e){var f=b[d],g="#5B8505",h=e._userDataMap.flow||1,i=f.getStyle("m.texture.image");i instanceof HTMLCanvasElement||(i=null),f.setStyle("m.texture.image",c.Util.getSpecialTextBillboard(h.toFixed(2),c.util.i18n("LinkSearch_Flow")+":","M/s",g,!1,i)),f.invalidateTexture()}}},1e4),this.sceneManager.addSceneChangeListener(function(b){a.clearAllLink()})},clearAllLink:function(a,b){for(var c in this.sceneManager.linkMap)this.clearLinkById(c,b);this.unlock(),this.gcsManagerInterval&&clearInterval(this.gcsManagerInterval),a||this.afterClearAllLinkFunction&&this.afterClearAllLinkFunction()},lock:function(){this.sceneManager.doubleClickBackgroundGotoUpLevelScene=!1,this.viewManager3d.setFocusNode=this.undoSetFocusNode,this.viewManager3d.setCameraDistanceForAfterPlayCamere(this.sceneManager.getCurrentRootNode())},unlock:function(){this.sceneManager.doubleClickBackgroundGotoUpLevelScene=!0,this.viewManager3d.setFocusNode=this.defaultSetFocusNode},stopAllAnimates:function(){if(this.animates)for(var a in this.animates){var b=this.animates[a];if(b instanceof Array)for(var c=0;c<b.length;c++)b[c]&&b[c].stop();else this.animates[a].stop();delete this.animates[a]}},clearAllAnimateBillboard:function(){if(this.lightBillboardMap)for(var a in this.lightBillboardMap)this.lightBillboardMap[a]&&this.box3D.remove(this.lightBillboardMap[a])},clearLinkById:function(a,b){var d=a;a instanceof c.Link&&(d=a.getId());var e=this.sceneManager,f=e.dataManager.getLinkById(d);if(f){var g=e.linkMap[d];if(g){if(this.animates&&this.animates[d]){var h=this.animates[d];if(h instanceof Array)for(var i=0;i<h.length;i++)h[i]&&h[i].stop();else this.animates[d].stop();delete this.animates[d]}if(this.lightBillboardMap&&this.lightBillboardMap[d]&&this.box3D.remove(this.lightBillboardMap[d]),g&&g.isVisible()&&this.box3D.getDataById(g.getId())){var j=f.getFromId(),k=f.getToId(),l=e.dataManager.getDataById(j),m=e.dataManager.getDataById(k);if(l&&m){var n=e.getSceneAndRootByData(l),o=e.getSceneAndRootByData(m),p=!0,q=e.getSceneAndRootByData(b);if(n&&!o?p=!1:!n&&o?p=!1:n&&o&&(n.scene!=o.scene||n.rootData!=o.rootData)?p=!1:n&&q&&(n.scene!=q.scene||n.rootData!=q.rootData)&&(p=!1),!p){var r=e.getNodeByDataOrId(n.rootData),s=e.getNodeByDataOrId(o.rootData);!b||b!=l&&b!=m?(n&&n.rootData&&r!=e.getCurrentRootNode()&&this.box3D.removeByDescendant(r),o&&o.rootData&&s!=e.getCurrentRootNode()&&this.box3D.removeByDescendant(s)):b==l?(this.box3D.removeByDescendant(s),(e._currentScene!=n.scene||e._currentRootNode!=r)&&(e._currentScene=n.scene,e._currentRootNode=r,e._sceneChangeDispather.fire({kind:"changeScene",data:n.scene}),this.defaultEventHandler.lookAt(e.getNodeByDataOrId(b)))):(this.box3D.removeByDescendant(r),(e._currentScene!=o.scene||e._currentRootNode!=s)&&(e._currentScene=o.scene,e._currentRootNode=s,e._sceneChangeDispather.fire({kind:"changeScene",data:o.scene}),this.defaultEventHandler.lookAt(e.getNodeByDataOrId(b))))}}var t=this.getRackNodeByNode(this.sceneManager.getNodeByDataOrId(j)),u=this.sceneManager.getNodeData(t),v=this.mdfMap[u.getId()];v&&(v.setParent(null),this.sceneManager.network3d.dataBox.remove(v));var w=this.getRackNodeByNode(this.sceneManager.getNodeByDataOrId(k)),x=this.sceneManager.getNodeData(w),y=this.mdfMap[x.getId()];y&&(y.setParent(null),this.sceneManager.network3d.dataBox.remove(y))}g.setVisible(!1);var z=this.linkBillboard[d];z&&z.setVisible(!1)}}},clearLinksByData:function(a,b){var d=null,e=this.sceneManager;if(d=a instanceof c.Data?a:this.sceneManager.dataManager.getDataById(a)){var f=this.getRackNodeByNode(this.sceneManager.getNodeByDataOrId(d)),g=this.sceneManager.getNodeData(f),h=this.mdfMap[g.getId()];h&&(h.setParent(null),this.sceneManager.network3d.dataBox.remove(h));var i=d.getAllLinks();if(i){var j=0;for(var k in i)this.clearLinkById(k),j++;if(1>j)return;if(b){var l=this.sceneManager.getSceneAndRootByData(b),m=!0,n=e.getNodeByDataOrId(b),o=null;l&&l.rootData&&(o=e.getNodeByDataOrId(l.rootData)),l&&!e._currentScene?m=!1:!l&&e._currentScene?m=!1:(l.scene!=e._currentScene||e._currentRootNode!=o)&&(m=!1),m||(this.box3D.removeByDescendant(e._currentRootNode),this.box3D.addByDescendant(o),this.box3D.addByDescendant(n),e._currentScene=l.scene,e._currentRootNode=o,e._sceneChangeDispather.fire({kind:"changeScene",data:l.scene}),this.defaultEventHandler.lookAt(n))}}}},showLinksByData:function(a,b){var d=null;if(this.clearAllLink(),d=a instanceof c.Data?a:this.sceneManager.dataManager.getDataById(a)){var e=d.getAllLinks(),f=[];if(e){var g=[];for(var h in e){this._createLinkByLinkId(h,b,!1);var i=this.sceneManager.linkMap[h];g.push(i);var j=e[h];if(j){var k=this.sceneManager.getNodeByDataOrId(j.getFromId()),l=this.sceneManager.getNodeByDataOrId(j.getToId());f.push(k),f.push(l)}}if(1===g.length)return void this.defaultEventHandler.lookAt(g[0]);this.defaultEventHandler.lookAtElements(f),this.lock()}else{var m=this.sceneManager.getNodeByDataOrId(d);m&&this.defaultEventHandler.lookAt(m)}}},afterShowLink:function(a){},afterShowNetLinks:function(a){},showMulLinkByData:function(a,b){var d=null;if(this.clearAllLink(),d=a instanceof c.Data?a:this.sceneManager.dataManager.getDataById(a)){this.linkManager.linkMap||this.linkManager.computeLinkTree();var e=this.linkManager.getMulLinksByDataId(a),f=[];if(e&&e.length>0){this.lock();var g=[];this.viewManager3d.defaultMaterialFilter.addAll(),this.viewManager3d.defaultMaterialFilter.remove(this.sceneManager._currentRootData);for(var h=0;h<e.length;h++){var i=e[h];if(!i||i.length<1)console.log("link's length is 0 ,please to check!!!");else for(var j=0;j<i.length;j++){var k=i[j];if(k){this._createLinkByLinkId(k.getId(),b,!1);var l=this.sceneManager.linkMap[k.getId()];g.push(l);var m=this.sceneManager.getNodeByDataOrId(k.getFromId()),n=this.sceneManager.getNodeByDataOrId(k.getToId());f.push(m),f.push(n),this.viewManager3d.defaultMaterialFilter.remove(this.sceneManager.getNodeData(m)),this.viewManager3d.defaultMaterialFilter.remove(this.sceneManager.getNodeData(n))}}}if(f&&f.length>0)for(var j=0;j<f.length;j++)if(!this.sceneManager.isCurrentSceneInstance(this.sceneManager.getNodeData(f[j]))){this.viewManager3d.defaultMaterialFilter.add(this.sceneManager._currentRootData);break}1===g.length?this.defaultEventHandler.lookAt(g[0]):this.defaultEventHandler.lookAtElements(f),this.afterShowNetLinks(e),this.playAnimateByLinks(e[0])}else{var o=this.sceneManager.getNodeByDataOrId(d);o&&this.defaultEventHandler.lookAt(o)}this.sceneManager.viewManager3d._focusNode=this.sceneManager.getCurrentRootNode()}},lookAtLinks:function(a){if(a){if(!(a instanceof Array)){var b=this.sceneManager.linkMap[a.getId()];return void this.defaultEventHandler.lookAt(b)}if(1==a.length){var b=this.sceneManager.linkMap[a[0].getId()];return void this.defaultEventHandler.lookAt(b)}for(var c=[],d=0;d<a.length;d++){var e=a[d];if(e){var f=this.sceneManager.getNodeByDataOrId(e.getFromId()),g=this.sceneManager.getNodeByDataOrId(e.getToId());c.push(f),c.push(g)}}this.defaultEventHandler.lookAtElements(c)}},showAllLinks:function(a){var b=this.sceneManager.dataManager.getLinkMap();if(b)for(var c in b)this.showLinkByLinkId(c,a,!1)},showBillboard:function(a){return!0},_createLinkByLinkId:function(a,d,e,f,g,h){var i=a,j=!0;if(e!=b&&null!=e&&(j=e),j&&this.clearAllLink(),a instanceof c.Link&&(i=a.getId()),i){this.originLinkId=i;var k=this.createlinkRelationById(i),l=k.link,m=k.fromId,n=k.toId,o=(k.fromPortId,k.toPortId,k.fromSide,k.toSide,k.fromNode),p=k.toNode,q=k.linkNode;if(o&&p)this.showFromAndToNode(o,p),q||this.sceneManager.loadLink(l),this.afterLoadLinkNode(i,d,f,g,h);else{var r=this,s=function(a){var b=function(a){var b=r.createlinkRelationById(i).link,c=r.createlinkRelationById(i).fromNode,a=r.createlinkRelationById(i).toNode;r.showFromAndToNode(c,a),r.sceneManager.loadLink(b),r.afterLoadLinkNode(i,d,f,g,h)};r.sceneManager.loadLazyData(n,b)};this.sceneManager.loadLazyData(m,s)}}},createlinkRelationById:function(a){var b=this.sceneManager.dataManager.getLinkById(a),c=b.getFromId(),d=b.getToId(),e=b.getFromPortId(),f=b.getToPortId(),g=b.getFromSide(),h=b.getToSide(),i=this.sceneManager.dataNodeMap[c],j=this.sceneManager.dataNodeMap[d],k=this.sceneManager.linkMap[a];return{link:b,fromId:c,toId:d,fromPortId:e,toPortId:f,fromSide:g,toSide:h,fromNode:i,toNode:j,linkNode:k}},showLinkNode:function(a,b,c){var d=this.createlinkRelationById(a),e=(d.link,d.fromId),f=d.toId,g=d.fromPortId,h=d.toPortId,i=d.fromSide,j=d.toSide,k=d.fromNode,l=d.toNode,m=d.linkNode;if(!m.getFromNode()){var n=k;if(g){var o=this.sceneManager.postManager.loadPortByPortId(e,g,i);o&&(n=o)}m.setFromNode(n)}if(!m.getToNode()){var p=l;if(h){var q=this.sceneManager.postManager.loadPortByPortId(f,h,j);q&&(p=q)}m.setToNode(l)}m.setVisible(!0),this.box3D.getDataById(m.getId())||this.box3D.add(m),b&&(contralPoints=this.resetPathByLink(a,c))},showFromAndToNode:function(a,b){this.defaultMaterialFilter.removeByDescendant(a),this.defaultMaterialFilter.removeByDescendant(b),this.box3D.getDataById(a.getId())||this.box3D.addByDescendant(a),this.box3D.getDataById(b.getId())||this.box3D.addByDescendant(b);var c=this.getNodeRootNodeByNode(a),d=this.sceneManager.getNodeData(c),e=this;c&&!this.box3D.getDataById(c.getId())&&this.box3D.addByDescendant(c,function(a){var b=e.sceneManager.getNodeData(a);return b&&b==d?!0:!1});var f=this.getNodeRootNodeByNode(b),g=this.sceneManager.getNodeData(f);f&&!this.box3D.getDataById(f.getId())&&this.box3D.addByDescendant(f,function(a){var b=e.sceneManager.getNodeData(a);return b&&b==g?!0:!1})},afterLoadLinkNode:function(a,b,c,d,e){var f=this.createlinkRelationById(a).link;this.lock();var g=f.getFromId(),h=f.getToId();if(this.sceneManager.isCurrentSceneInstance(g)&&this.sceneManager.isCurrentSceneInstance(h)||this.viewManager3d.defaultMaterialFilter.add(this.sceneManager._currentRootData),this.showLinkNode(a,b,c),this.showBillboard(f)){this.createBillboard(f)}this.afterShowLink(f),d&&d(e)},showLinkByLinkId:function(a,b,d,e,f,g){var h=a;a instanceof c.Link&&(h=a.getId());var i=this.sceneManager.dataManager.getLinkById(h);i&&(this.viewManager3d.defaultMaterialFilter.addAll(),this.viewManager3d.defaultMaterialFilter.remove(this.sceneManager._currentRootData),this._createLinkByLinkId(i,b,d,e,f,g))},getNodeRootNodeByNode:function(a){if(!a)return null;var b=this.sceneManager.getNodeData(a),c=this.sceneManager.getSceneAndRootByData(b);return c&&c.rootData?this.sceneManager.getNodeByDataOrId(c.rootData):null},createBillboard:function(a){if(a){var b=this.sceneManager.linkMap[a.getId()];if(b){var d,e,f,g=b.getControls();if(g&&g.length>4){var h=g[3];d=h.x,e=h.y+60,f=h.z}var i=this.linkBillboard[a.getId()];if(i)i.setVisible(!0),this.box3D.getDataById(i.getId())||this.box3D.add(i);else{var i=c.Util.createSpecailTextBillboard("text");i.setPosition(d||0,e||0,f||0);var j="#5B8505",k=a._userDataMap.flow||0;i.setStyle("m.texture.image",c.Util.getSpecialTextBillboard(k.toFixed(2),c.util.i18n("LinkSearch_Flow")+":","M/s",j)),i.invalidateTexture(),i.s({"m.fixedSize":5e3}),this.box3D.add(i),this.linkBillboard[a.getId()]=i}}}},reloadLink:function(a){if(!a)return!1;var b=null;if(b=a instanceof c.Link?a:this.sceneManager.dataManager.getLinkById(a),!b)return!1;var d=this.sceneManager.linkMap[b.getId()];if(d)return!1;var e=b.getFromId(),f=b.getToId(),g=this.sceneManager.dataNodeMap[e];if(!g){if(!this.sceneManager.dataManager.getDataById(e))return!1;this.sceneManager.loadLazyData(e)}var h=this.sceneManager.dataNodeMap[f];if(!h){if(!this.sceneManager.dataManager.getDataById(f))return!1;this.sceneManager.loadLazyData(f)}return this.sceneManager.loadLink(b),!0},resetPathByLink:function(a,b){if(!a)return null;var d=a;a instanceof c.Link&&(d=a.getId());var e=this.sceneManager.linkMap[d];if(!e)return null;var f=null;return f=b?this.generateControlsWithOutHeight(e):this.generateControlsWithMDF(e),f&&e.setControls(f),f},resetPathByData:function(a){},getRelatePosition:function(a){var b=this.sceneManager.getCurrentRootNode();if(!b||!a)return null;var c=new mono.Mat4;c.setPosition(a);var d,e;d=(new mono.Mat4).getInverse(b.worldMatrix.clone()),e=(new mono.Mat4).multiplyMatrices(d,c);var f=(new mono.Vec3).getPositionFromMatrix(e);return f},getRackNodeByNode:function(a){if(!a)return null;var b=this.sceneManager.getNodeData(a),c=this.sceneManager.dataManager.getCategoryForData(b);if(c&&"rack"==c.getId())return a;if(c&&"equipment"==c.getId()){var d=this.sceneManager.getNodeByDataOrId(b.getParentId()),e=this.getRackNodeByNode.call(this,d);return e||a}if(a.getClient("parentId")){var f=this.sceneManager.getNodeByDataOrId(a.getClient("parentId")),g=this.getRackNodeByNode.call(this,f);return g||f||a}return a},generateControlsWithMDF:function(a,b){if(!a)return null;var c=a.getFromNode(),d=a.getToNode();if(!c||!d)return null;var e=[],f=this.getNodeToMDFControls(c),g=this.getNodeToMDFControls(d);if(f&&g&&f.length>0&&g.length>0){for(var h=0;h<f.length;h++)e.push(f[h]);var i=f[f.length-1],j=g[g.length-1],k=this.getInflectionPoints(i,j);if(k&&k.length>0)for(var h=0;h<k.length;h++)e.push(k[h]);for(var h=g.length-1;h>=0;h--)e.push(g[h])}return e},getMdfByRack:function(a){if(!a)return null;var b=this.sceneManager.getNodeData(a);if(!b)return null;var d=this.mdfMap[b.getId()];if(!d){var e=a.getBoundingBox(),f=(e.size()||{x:60},55),g=0,h=0,d=new mono.Cube(f,20,3);e&&(f=e.size().x,g=e.max.z-5,g+=5,h=e.max.y-12),d.setPosition(0,h,g),d.setClient(c.SceneManager.CLIENT_EXT_VITUAL,!0),d.setStyle("front.m.texture.image","./images/mdf_front.jpg"),d.setStyle("back.m.texture.image","./images/mdf_front.jpg"),d.setClient("itv_mdf",!0),d.setClient("itv_mdf_rack_data",b),this.mdfMap[b.getId()]=d}return d.setParent(a),this.sceneManager.network3d.dataBox.add(d),d},getInflectionPoints:function(a,b){if(!a||!b)return null;var c=a.clone(),d=b.clone(),e=0,f=[];return c.x!=d.x&&e++,c.y!=d.y&&e++,c.z!=d.z&&e++,1>=e?null:(c.x!=d.x&&e>1&&(e--,f.push(new mono.Vec3(d.x,c.y,c.z))),c.y!=d.y&&e>1&&(e--,f.push(new mono.Vec3(d.x,d.y,c.z))),f)},getNodeToMDFControls:function(a){if(!a)return null;var b=[],c=this.getRackNodeByNode(a),d=a.getBoundingBox(),e=a.getWorldPosition(),f=20,g=10,h=50,i=-23;if(c&&c!=a){var j=this.getMdfByRack(c),k=c.getBoundingBox(),l=c.getWorldPosition(),m=a.frontWorldPosition(d.max.z+f),n=a.getWorldPosition();b.push(m);var o=m.clone();o.setY(l.y+k.max.y+i),b.push(o);var p=new mono.Vec3(0,k.max.y+i,0);if(m.x!=n.x&&(m.x>n.x?p.x=-g-10:p.x=g+10),m.z!=n.z&&(m.z>n.z?p.z=-g-10:p.z=g+10),o=e.clone().add(p),o.setY(l.y+k.max.y+i),b.push(o),j){var q=180*j.getParent().getRotationY()/Math.PI,r=20*Math.random(),s=0;q%90==0&&(s=20*Math.random(),r=0);var t=new mono.Vec3(r,5,s),u=j.getWorldPosition().clone().add(t),v=j.frontWorldPosition(f),w=o.clone();v.x!=u.x&&u.z!=w.z?(w.setZ(u.z),b.push(w)):v.z!=u.z&&u.x!=w.x&&(w.setX(u.x),b.push(w));var x=w.clone();x.setY(u.y),b.push(x),v=v.clone().add(t);var y=this.getInflectionPoints(x,u);if(y&&y.length>0)for(var z=0;z<y.length;z++)b.push(y[z]);b.push(v),v=v.clone().add(new mono.Vec3(0,h,0)),b.push(v)}else o=o.clone().add(new mono.Vec3(0,43,0)),b.push(o)}else{var A=c.getWorldPosition().clone().add(new mono.Vec3(0,d.max.y+43,0));b.push(A)}return b},generateControlsWithOutHeight:function(a,b){if(!a)return null;var c=a.getFromNode(),d=a.getToNode();if(!c||!d)return null;var e=c.getBoundingBox(),f=d.getBoundingBox(),g=c.getWorldPosition(),h=d.getWorldPosition(),i=null,j=null,k=this.getRackNodeByNode(c),l=this.getRackNodeByNode(d);k&&k.getBoundingBox&&(e=k.getBoundingBox(),i=k.getWorldPosition()),l&&l.getBoundingBox&&(f=l.getBoundingBox(),j=l.getWorldPosition());var m=20,n=Math.max(e.max.y,f.max.y)+20;50>n&&(n=50);var o=c.worldPosition(new mono.Vec3(0,0,-1),e.max.z+m),p=d.frontWorldPosition(f.max.z+m),q=[];q.push(o);var r=Math.max(g.y,h.y);return i&&(r=Math.max(r,i.y)),j&&(r=Math.max(r,j.y)),r!=o.y&&q.push(new mono.Vec3(o.x,r,o.z)),q.push(new mono.Vec3(o.x,r,p.z)),r!=p.y&&q.push(new mono.Vec3(p.x,r,p.z)),q.push(p),q},handleMouseMoveElement:function(a,b,c,d,e){var f=this.sceneManager.getLinkData(a);if(f){if(!a.org_radius&&a.setRadius){var g=a.getRadius()||1;a.org_radius=a.getRadius(),a.setRadius(g+1)}this._flagLink=a}},handleMouseMoveBackground:function(a,b){this._flagLink&&this._flagLink.org_radius&&(this._flagLink.setRadius(this._flagLink.org_radius),delete this._flagLink.org_radius,this._flagLink=null)},doFlow:function(a,b){if(a){var d=null,e=a;if(a instanceof mono.Element){d=a;var f=this.sceneManager.getLinkData(d);e=f.getId()}else a instanceof c.Link&&(e=a.getId()),d=this.sceneManager.linkMap[e];if(d){var g=!0;if(0==b&&(g=!1),!d.styleMap["m.texture.image"])return;d.setStyle("m.texture.flipX",g);var h=this.animates[e];h||(h=new mono.Animate({from:0,to:1,type:"number",dur:500,repeat:Number.POSITIVE_INFINITY,reverse:!1,onUpdate:function(a){d.setStyle("m.texture.offset",new mono.Vec2(a,0))}}),this.animates[e]=h),h.play()}}},clearFlow:function(a){if(a){var b=a;a instanceof c.Link&&(b=a.getId());var d=this.animates[b];d&&(d instanceof Array||d.stop(),delete this.animates[b])}},clearAllFlow:function(){this.stopAllAnimates()},getImage:function(){return"data:image/png;base64,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"},createLightBillboard:function(){var a=new mono.Billboard;return a.s({"m.texture.image":this.getImage(),"m.transparent":!0,"m.opacity":1}),a.setScale(35,35,35),a},getAnimateDur:function(){return 2500},createLinkAnimate:function(a,b){if(!a||!b)return null;if(!(b instanceof mono.PathLink))return null;var c=this,d=new mono.Animate({from:0,to:1,type:"number",dur:c.getAnimateDur(),onUpdate:function(c){var d=b.getPointAt(c);a.p(d.x,d.y,d.z)}});return d},playAnimateByLinks:function(a){if(a){if(!(a instanceof Array))return this.playAnimate(a);if(!(a.length<1)){var b=a[0].getId(),c=this.lightBillboardMap[b];c||(c=this.createLightBillboard(),this.lightBillboardMap[b]=c);for(var d=null,e=null,f=[],g=a.length-1;g>=0;g--){var h=this.sceneManager.linkMap[a[g].getId()],i=this.createLinkAnimate(c,h);i&&(d||(d=i),e?(e.chain(i),e=i):e=i,f.push(i))}if(e!=d)e.chain(d);else{if(!d)return;d.repeat=Number.POSITIVE_INFINITY,d.reverse=!1}d&&(this.box3D.add(c),this.animates[b]=f,d.play())}}},playAnimate:function(a){if(a){if(a instanceof Array)return this.playAnimateByLinks(a);var b=a.getId(),c=this.lightBillboardMap[b];c||(c=this.createLightBillboard(),this.lightBillboardMap[b]=c);var d=this,e=this.sceneManager.linkMap[b];if(e&&e instanceof mono.PathLink){this.box3D.add(c);var f=new mono.Animate({from:0,to:1,type:"number",dur:d.getAnimateDur(),repeat:Number.POSITIVE_INFINITY,reverse:!1,onUpdate:function(a){var b=e.getPointAt(a);c.p(b.x,b.y,b.z)}});f.play(),this.animates[b]=f}}}}),c.GCSManager=S;var T=function(a){this.id=a||"",this.parent=null,this.parents=[],this.children=new mono.List,this.toParentLink=null,this.toParentLinks=[]};mono.extend(T,Object,{setParent:function(a){this.parent=a},addChildren:function(a){if(a&&!(a.length<1))for(var b=0;b<a.length;b++){var c=a[b];this.addChild(c)}},addChildren:function(a){a&&!this.children.contains(a)&&this.children.add(data)}});var U=function(a){this.sceneManager=a,this.linkMap=null};mono.extend(U,Object,{computeLinkTree:function(){this.linkMap={};var a=this.sceneManager.dataManager.getLinks();if(a&&!(a.length<1))for(var b=0;b<a.length;b++){var c=a[b];if(c){var d=c.getFromId(),e=c.getToId(),f=this.linkMap[d],g=this.linkMap[e];f||(f=new T(d),f.parent=null,this.linkMap[d]=f),g||(g=new T(e),g.toParentLink=c,g.parent=f,this.linkMap[e]=g),g.parents.includes(f)||g.parents.push(f),g.toParentLinks.push(c)}}},setParentAndChildren:function(a){if(!a)return null;var b=a.parent&&a.parent.id;if(b){var c=this.linkMap[b];c&&c.addChild(a)}var d=this.getChildren(a.id);data.addChildren(d)},getChildren:function(a){var b=[];if(!a)return b;for(var c in this.linkMap){var d=this.linkMap[c];d.parent&&d.parent.id===a&&b.push(d)}return b},cloneArray:function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},getMulLinksByDataId:function(a,b,d,e){if(e=e||this,!a||!this.linkMap)return null;var f=a;a instanceof c.Data&&(f=f.getId());var g=this.linkMap[f];if(!g)return null;if(b=b||[],d||(d=[],b.push(d)),!g.toParentLinks||g.toParentLinks.length<1)return null;if(g.toParentLinks.length>1)for(var h=1;h<g.toParentLinks.length;h++){var i=e.cloneArray(d),j=g.toParentLinks[h];i.includes(j)||(b.push(i),i.push(j),
e.getMulLinksByDataId(j.getFromId(),b,i,e))}var k=g.toParentLinks[0];if(d.includes(k))return b;d.push(k);var l=k.getFromId();return l&&e.getMulLinksByDataId(l,b,d,e),b},getLinksByDataId:function(a,b){if(b=b||this,!a||!this.linkMap)return null;var d=a;a instanceof c.Data&&(d=d.getId());var e=this.linkMap[d];if(!e)return null;var f=[];e.toParentLink&&f.push(e.toParentLink);var g=b.getLinksByDataId(e.parent&&e.parent.id);if(g&&g.length>0)for(var h=0;h<g.length;h++)f.push(g[h]);return f}}),c.TooltipRule=function(a){a=a||{},this._id=a.id||this.randomId(),this._customerId=a.customerId||"",this._categoryId=a.categoryId||"",this._dataTypeId=a.dataTypeId||"",this._sceneId=a.sceneId||"",this._propertiesDesc=a.propertiesDesc||"",this._extInfo=a.extInfo||{},this._mul=a.mul||!1,this._withCloseDiv=a.withCloseDiv||!1},mono.extend(c.TooltipRule,c.Base,{___accessor:["customerId","categoryId","mul","dataTypeId","sceneId","propertiesDesc","extInfo","withCloseDiv"],getId:function(){return this._id},randomId:function(){return mono.id("tooltipRule")}}),c.TooltipManager=function(a){this.sceneManager=a,this.dataManager=a.dataManager,this._tooltipRules=[],this._tooltipRuleMap={},this._lastData=null,this._tooltipDivCreator=new c.TooltipDivCreator,this.tooltipContentFunction=null,this.toolTipMap={},this.network3d=this.sceneManager.network3d,this.box3D=this.network3d.getDataBox(),this.enableMulforTooltip=!1,this.textNodeMap={},this.init()},mono.extend(c.TooltipManager,c.EventHandler,{init:function(){var a=this;this.sceneManager.addSceneManagerChangeListener(function(b){"add"==b.kind&&b.data instanceof mono.Element&&(a.enableMulforTooltip?a.createToolTipForNode(b.data):a.createTextNodeForFloor(b.data))}),this.sceneManager.cameraManager.addAfterPlayCameraListener(function(b){a.sceneChangeListener()})},_createTooltipDiv:function(a){var b=this._tooltipDivCreator.createTooltipDiv(a);return b.style.position="absolute",b.style.display="none",b},setTooltipDivCreator:function(a){null!=a&&this._tooltipDivCreator!==a&&(this._tooltipDivCreator=a,this.destoryTooltipDiv())},getTooltipDivCreator:function(){return this._tooltipDivCreator},destoryTooltipDiv:function(){this._tooltipDiv=null},getTooltipDiv:function(){if(null==this._tooltipDiv){this._tooltipDiv=this._createTooltipDiv();var a=this.sceneManager.network3d;this._tooltipDivCreator.addToNetwork(a,this._tooltipDiv)}return this._tooltipDiv},hideToolTipDiv:function(){var a=this.getTooltipDiv();a.style.display="none"},showTooltipDiv:function(a,b,c){var d=this.getTooltipDiv();d.style.display="";var e=!1;a.tooltipRule&&a.tooltipRule.getWithCloseDiv()&&(e=a.tooltipRule.getWithCloseDiv()),this._tooltipDivCreator.setTooltipData(a,d),e&&this.addCloseDivForTooltip(d),this.computeTooltipDivPosition(b,null,c)},addCloseDivForTooltip:function(a){if(a){var b=document.createElement("DIV");b.className="close",b.style="float: right;";var c=this;return b.onclick=function(b){a.style.display="none",c._lastData=null},a.appendChild(b),b}},onRenderCallback:function(a){this.computeTooltipDivPosition(),this.enableMulforTooltip&&this.cameraChangeListener()},generateTooltipPosition:function(a,b,c,d){if(!a)return new mono.Vec3(b,c,d);var e=this.sceneManager.getNodeData(a);if(!e)return new mono.Vec3(b,c,d);var f=this.dataManager.getDataTypeForData(e),g=this.dataManager.getCategoryForDataType(f),h=a.getPosition();if(g&&g.getId().indexOf("floor")>=0){if(!e.getPosition())return new mono.Vec3(b,c,d);var i=e.getPosition().y,j=this.dataManager.getDataById(e.getParentId());if(j){var k=j.getChildren();if(k&&k.size()>0){var l=0,m=0;if(k.forEach(function(a){var b=a.getPosition().y;l>b&&(l=b),b>m&&(m=b)}),l!=m){var n,o,p,q=a.getBoundingBox(),r=(q.max.z-q.min.z)/2;p=h.z+r;var s=q.max.x-q.min.x,t=s/(k.size()+1);return n=parseInt((i-l)/((m-l)/k.size()))*t+t/2-s/2,o=h.y+(q.max.y+q.min.y)/2+q.size().y/2,new mono.Vec3(n,o,p)}}}}return new mono.Vec3(b,c,d)},computeTooltipDivPosition:function(a,b,c){function e(){var a,b,c,d=document.createElement("p"),e={width:"100px",height:"100px"};for(var f in e)d.style[f]=e[f];return document.body.appendChild(d),a=d.clientWidth,d.style.overflowY="scroll",b=d.clientWidth,c=a-b,d.remove(),c}var f=b||this.getTooltipDiv();if(a=a||this._lastData,c=c||this._lastNode,f&&a){var g=this.sceneManager,h=g.getNodeForDataOrId(a);h=this.getTooltipDivPositionNode(a,h,c);var i=h.getBoundingBox?h.getBoundingBox():null,j=h.getWorldPosition(),k=j.x,l=j.y,m=j.z;i&&(k+=i.center().x,l+=i.max.y,m+=i.center().z);var n=this.generateTooltipPosition(h,k,l,m);n&&(k=n.x||k,l=n.y||l,m=n.z||m);var o=this.sceneManager.network3d.getViewPosition(new mono.Vec3(k,l,m)),p=o.x,q=o.y,r=d.getComputedStyle(f);p-=parseInt(r.width)/2,q=q-parseInt(r.height)-10;var s=e(),t=f.children[0];parseInt(r.height)>300?(t.style.overflowY="auto",t.style.height="300px",f.style.top=o.y-330+"px",f.style.left=p-s/2+"px"):(f.style.top=q+"px",f.style.left=p+"px")}},getTooltipDivPositionNode:function(a,b,c){return c||b},getCustomerIdByNode:function(a){return""},getTooltipContent:function(a,b){if(this.tooltipContentFunction)return this.tooltipContentFunction(a);if(a&&!(a instanceof mono.Billboard&&a.getStyle("m.opacity")&&a.getStyle("m.opacity")<.3)){var c="",d="",e="";this.getCustomerIdByNode&&(c=this.getCustomerIdByNode(a));var f=this.sceneManager._currentScene,g=this.sceneManager,h=this.dataManager,i=g.getNodeData(a);if(i){var j=h.getCategoryForData(i),k=h.getDataTypeForData(i);k&&(d=j?j.getId():"",e=k.getId())}for(var l,m,n,o,p,q=0;q<this._tooltipRules.length;q++)p=this._tooltipRules[q],(!b||p.getMul())&&(b||!p.getMul())&&(f&&p.getSceneId()&&f.getId()!=p.getSceneId()||(p.getCustomerId()&&p.getCustomerId()===c&&!l&&(l=p),p.getDataTypeId()&&p.getDataTypeId()===e&&!m&&(m=p),p.getCategoryId()&&p.getCategoryId()===d&&!n&&(n=p),p.getDataTypeId()||p.getCategoryId()||p.getCustomerId()||(o=p)));return l?this._getTooltipContent(a,i,l):m?this._getTooltipContent(a,i,m):n?this._getTooltipContent(a,i,n):o?this._getTooltipContent(a,i,o):void 0}},_getDataFieldValue:function(a,b,c){return b?b.getValue(c):""},_getTooltipContent:function(a,b,c){var e={},f=c.getPropertiesDesc(),g=f.split("@@");if(g.length)for(var h=0;h<g.length;h++){var i=g[h],j=i.split(":");if(2===j.length){var k=j[0],l=j[1],m=this._getDataFieldValue(a,b,l);e[k]=m||""}}var n=c.getExtInfo();if(n="function"==typeof n?n(a,b):d.translateJson(n),n instanceof Array)return n.tooltipRule=c,n;if(n)for(var o in n){var p=n[o];"function"==typeof p?e[o]=p(a,b):e[o]=p}return e.tooltipRule=c,e},addTooltipRule:function(a){var b=a.getId();this._tooltipRuleMap[b]||(this._tooltipRules.push(a),this._tooltipRuleMap[b]=a)},removeTooltipRule:function(a){var b=a.getId();if(this._tooltipRuleMap[b]){var c=this._tooltipRules.indexOf(a);c&&this._tooltipRules.splice(c,1),delete this._tooltipRuleMap[b]}},handleMouseMoveElement:function(a,b,c,d,e){if(!e._mousedown){var f=this.getTooltipContent(a);if(null==f)return this._lastData=null,this._lastNode=a,void this.hideToolTipDiv();var g=this;this._lastNode!=a&&(clearTimeout(this._tooltipTimer),g._lastData=c,g._lastNode=a,this._tooltipTimer=setTimeout(function(){g.showTooltipDiv(f,c,a)},200))}},handleMouseMoveBackground:function(a,b){this.hideToolTipDiv(),this._lastData=null},clearToolTipMap:function(){if(this.toolTipMap)for(var a in this.toolTipMap){var b=this.toolTipMap[a];b&&$("#"+b.id).remove()}},createToolTipForNode:function(a){if(a){var b=null;if(b=a instanceof c.Data?a:this.sceneManager.getNodeData(a)){var d=this.getTooltipContent(a,!0);if(d){var e="tooltip"+b.getId(),f=null;if(this.toolTipMap[b.getId()]?f=document.getElementById(e):(this.toolTipMap[b.getId()]={id:e,rule:d.tooltipRule,element:a},f=this._createTooltipDiv(e),this._tooltipDivCreator.addToNetwork(this.sceneManager.network3d,f)),f){f.style.display="block";var g=!1;d.tooltipRule&&(g=d.tooltipRule.getWithCloseDiv()),this._tooltipDivCreator.setTooltipData(d,f),g&&this.addCloseDivForTooltip(tooltip),this.computeTooltipDivPosition(b,f)}}}}},cameraChangeListener:function(){if(this.toolTipMap)for(var a in this.toolTipMap){var b=this.toolTipMap[a],c=b.element;if(b){var d=b.id,e=b.rule;if(d.startsWith("tooltip")){var a=d.substring(7,d.length),f=this.dataManager.getDataById(a),g=this.sceneManager.getNodeByDataOrId(f);if(!f||!g)continue;var h=document.getElementById(d);if(!h)continue;var i=this.sceneManager.getCurrentScene();if(e.getSceneId()&&i&&e.getSceneId()!=i.getId()){h.style.display="none";continue}if(!g||!this.sceneManager.viewManager3d.isVisible(g)||!this.box3D.getDataById(g.getId())){h.style.display="none";continue}if(h.style.display="",c){var j=this.getTooltipContent(c,!0);if(j){var k=e.getWithCloseDiv();this._tooltipDivCreator.setTooltipData(j,h),k&&this.addCloseDivForTooltip(tooltip)}}this.computeTooltipDivPosition(f,h)}}}},getRuleByData:function(a,b){if(a){var d=(this.sceneManager,this.dataManager),e=null;if(e=a instanceof c.Data?a:a instanceof c.Link?a:d.getDataById(a)){var f=d.getCategoryForData(e),g=d.getDataTypeForData(e);if(null!=g){for(var h,i,j,k,l=f?f.getId():"",m=g.getId(),n=0;n<this._tooltipRules.length;n++)k=this._tooltipRules[n],(!b||k.getMul())&&(b||!k.getMul())&&(k.getDataTypeId()!==m||h||(h=k),l&&k.getCategoryId()===l&&!i&&(i=k),k.getDataTypeId()||k.getCategoryId()||(j=k));return h?h:i?i:j?j:null}}}},computeTextNodePosition:function(a,b){if(!a)return null;var d=this.sceneManager.getNodeData(a);this.sceneManager.setParentRelationShip(d),this.sceneManager.translatePosition(d);var b=b||0,e=a.getBoundingBox(),f=c.Util.getNodeCenterPosition(a),g=f.x,h=f.y,i=f.z;e&&(g=g+(e.max.x-e.min.x)/2-b,i=i+(e.max.z-e.min.z)/2+5);var j=e.max.y-e.min.y;h=j/2;var k=i+50,l=this.getElementsByPosition(g,h,k);if(l&&l.length>0){for(var m=null,n=0;n<l.length;n++){var o=l[n];o&&o.distance&&(!m||m>o.distance)&&(m=o.distance)}m&&(i=k-m)}return{x:g,y:h,z:i}},getElementsByPosition:function(a,b,c){var d=new mono.Vec3(a,b,c),e=new mono.Vec3(0,1,0),f=new mono.Vec3(a,b,-1),g=this.network3d.getCamera(),h=new mono.Picking(d,f.sub(d).normalize(),e,g.getNear(),g.getFar(),this.network3d),i=new mono.List;i.addAll(this.box3D.getNodes());var j=h.intersectObjects(i.toArray(),!0,!1);return j},getTextNodeOffset:function(a){return null},createTextNodeForFloor:function(a){if(a){var b=null;if(b=a instanceof c.Data?a:this.sceneManager.getNodeData(a)){var d=this.sceneManager.dataManager.getCategoryForData(b);if(d&&!(d.getId().toLowerCase().indexOf("floor")<0)){var e=this.getRuleByData(b,!0);if(e){var f=b.getId(),g=this.textNodeMap[f];if(!g&&f){var g=new mono.TextNode(f,null,100,"helvetiker","bold");g.setStyle("m.texture.image","../images/yellow.png"),g.setStyle("m.type","phong");var h=1;g.setScale(h,h,.1*h),g.setSelectable(!1),g.setParent(a);var i=a.getBoundingBox(),j=a.getPositionX(),k=a.getPositionZ(),l=a.getPositionY(),m=0,n=0,o=g.getBoundingBox();o&&(m=o.max.x-o.min.x,n=o.max.y-o.min.y),i&&(j=i.max.x-m,k=i.max.z+5);var p=i.max.y-i.min.y;l=p/2;var q=this.getTextNodeOffset(b);q&&(q.x&&(j+=q.x),q.y&&(l+=q.y));var r=k+50,s=this.getElementsByPosition(j,l,r);if(s&&s.length>0){for(var t=null,u=0;u<s.length;u++){var v=s[u];v&&v.distance&&(!t||t>v.distance)&&(t=v.distance)}t&&(k=r-t)}q&&q.z&&q.z&&(k+=q.z),g.setPosition(j,l,k),this.textNodeMap[f]=g,g.setVisible(!1),this.box3D.add(g),g.rule=e}}}}}},sceneChangeListener:function(){if(this.textNodeMap)for(var a in this.textNodeMap){var b=this.textNodeMap[a],c=b.rule,d=this.sceneManager.getCurrentScene();if(c.getSceneId()&&d&&c.getSceneId()!=d.getId())b.setVisible(!1);else{var e=this.sceneManager.getNodeByDataOrId(a);e&&this.sceneManager.viewManager3d.isVisible(e)&&this.box3D.getDataById(e.getId())?(this.box3D.getDataById(b.getId())||this.box3D.add(b),b.setVisible(!0)):b.setVisible(!1)}}this._tooltipTimer&&clearTimeout(this._tooltipTimer),this.hideToolTipDiv()}}),c.TooltipDivCreator=function(a){},mono.extend(c.TooltipDivCreator,Object,{createTooltipDiv:function(a){var b=document.createElement("DIV");return b.className="tooltip-panel",a&&(b.id=a),b},addToNetwork:function(a,b){a.getRootView().appendChild(b)},setTooltipData:function(a,b){if(b.style="",this._removeAllChildren(b),a){delete a.tooltipRule;var c=document.createElement("div");b.appendChild(c);var d=document.createElement("table"),e=document.createElement("tbody");if(c.appendChild(d),d.appendChild(e),a instanceof Array){var f=a.header;if(f){var g=this._createTableRow(f,!0);e.appendChild(g)}for(var h=0;h<a.length;h++){var i=a[h],j=this._createTableRow(i);e.appendChild(j)}}else for(var k in a)if("object"==typeof a[k]){var l=a[k].value,m=a[k].onclick,j=this._createRow(k,l,m);e.appendChild(j)}else{var j=this._createRow(k,a[k]);e.appendChild(j)}}},_createTableRow:function(a,b){var c=document.createElement("tr");if(a instanceof Array)for(var d=0;d<a.length;d++){var e=a[d],f=this._createColumn(e,b);c.appendChild(f)}else for(var g in a){var e=a[g],f=this._createColumn(e,b);c.appendChild(f)}return c},_createColumn:function(a,b){var c=document.createElement("td");b?c.style="width: 60px;text-align:center;":(c.className="tooltip-value",c.style="text-align:center;"),a.className&&(c.className=a.className),a.style&&(c.style=a.style);var d=a;return a.hasOwnProperty("value")?d=a.value:a.hasOwnProperty("text")&&(d=a.text),a.onclick&&(c.onclick=a.onclick),c.innerHTML=d,c},_createRow:function(a,b,c){var d=document.createElement("tr"),e=document.createElement("td");e.className="tooltip-key",e.innerHTML=a+":";var f=document.createElement("td"),g="tooltip-value";return c&&(g+=" tooltip-value-btn"),f.className=g,f.innerHTML=b,d.appendChild(e),d.appendChild(f),f.onclick=c,d},_removeAllChildren:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)}}),function(a){var b,c,d,e,f,g,h,i,j,k,l=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};i=function(){var b,c,d,e;return null!=a.WebGLRenderingContext?(e=["WEBKIT","MOZ","MS","O"],d=/^WEBKIT_(.*)|MOZ_(.*)|MS_(.*)|O_(.*)/,b=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(a){var c,f,g,h,i;if(f=a.match(d),null!==f&&(a=f[1]),c=b.call(this,a),null===c){for(h=0,i=e.length;i>h;h++)if(g=e[h],c=b.call(this,g+"_"+a),null!==c)return c;return null}return c},c=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var a,b,e,f,g,h;for(f=c.call(this),e=[],g=0,h=f.length;h>g;g++)a=f[g],b=a.match(d),null!==b&&(a=b[1]),l.call(e,a)<0&&e.push(a);return e}):void 0},j=function(){var b,c,d,e,f,g,h,i,j,k,m,n,o,p;if(f=function(){var a,b,c;return a=document.createElement("canvas"),a.width=2,a.height=2,b=a.getContext("2d"),c=b.getImageData(0,0,2,2),c.data.set(new Uint8ClampedArray([0,0,0,0,255,255,255,255,0,0,0,0,255,255,255,255])),b.putImageData(c,0,0),a},f(),c=function(a,b){var c,d,e,g,h,i,j,k,l,m,n,o,p,q;if(i=a.createProgram(),p=a.createShader(a.VERTEX_SHADER),a.attachShader(i,p),a.shaderSource(p,"attribute vec2 position;\nvoid main(){\n    gl_Position = vec4(position, 0.0, 1.0);\n}"),a.compileShader(p),!a.getShaderParameter(p,a.COMPILE_STATUS))throw a.getShaderInfoLog(p);if(e=a.createShader(a.FRAGMENT_SHADER),a.attachShader(i,e),a.shaderSource(e,"uniform sampler2D source;\nvoid main(){\n    gl_FragColor = texture2D(source, vec2(1.0, 1.0));\n}"),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw a.getShaderInfoLog(e);if(a.linkProgram(i),!a.getProgramParameter(i,a.LINK_STATUS))throw a.getProgramInfoLog(i);return a.useProgram(i),d=function(){return a.deleteShader(e),a.deleteShader(p),a.deleteProgram(i),a.deleteBuffer(c),a.deleteTexture(l),a.deleteTexture(o),a.deleteFramebuffer(g),a.bindBuffer(a.ARRAY_BUFFER,null),a.useProgram(null),a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null)},o=a.createTexture(),a.bindTexture(a.TEXTURE_2D,o),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,2,2,0,a.RGBA,a.UNSIGNED_BYTE,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),g=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,g),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,o,0),m=f(),l=a.createTexture(),a.bindTexture(a.TEXTURE_2D,l),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,b,m),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),q=new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),c=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,q,a.STATIC_DRAW),h=a.getAttribLocation(i,"position"),n=a.getUniformLocation(i,"source"),a.enableVertexAttribArray(h),a.vertexAttribPointer(h,2,a.FLOAT,!1,0,0),a.uniform1i(n,0),a.drawArrays(a.TRIANGLES,0,6),j=new Uint8Array(16),a.readPixels(0,0,2,2,a.RGBA,a.UNSIGNED_BYTE,j),k=Math.abs(j[0]-127)<10,d(),k},e=function(a,b){var c;return c=a.createTexture(),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,2,2,0,a.RGBA,b,null),0===a.getError()?(a.deleteTexture(c),!0):(a.deleteTexture(c),!1)},b=function(a,b){var c,d,e;return e=a.createTexture(),a.bindTexture(a.TEXTURE_2D,e),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,2,2,0,a.RGBA,b,null),d=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,d),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),c=a.checkFramebufferStatus(a.FRAMEBUFFER),a.deleteTexture(e),a.deleteFramebuffer(d),a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),c===a.FRAMEBUFFER_COMPLETE?!0:!1},j=[],k={},m=[],d=function(){var a,d,f,g,h,i,l;a=document.createElement("canvas"),f=null;try{f=a.getContext("experimental-webgl"),null===f&&(f=a.getContext("webgl"))}catch(n){}return null!=f&&(i=f.getExtension("OES_texture_float"),null===i?e(f,f.FLOAT)?(l=!0,j.push("OES_texture_float"),k.OES_texture_float={shim:!0}):(l=!1,m.push("OES_texture_float")):e(f,f.FLOAT)?(l=!0,j.push("OES_texture_float")):(l=!1,m.push("OES_texture_float")),l&&(d=f.getExtension("WEBGL_color_buffer_float"),null===d?b(f,f.FLOAT)?(j.push("WEBGL_color_buffer_float"),k.WEBGL_color_buffer_float={shim:!0,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):m.push("WEBGL_color_buffer_float"):b(f,f.FLOAT)?j.push("WEBGL_color_buffer_float"):m.push("WEBGL_color_buffer_float"),d=f.getExtension("OES_texture_float_linear"),null===d?c(f,f.FLOAT)?(j.push("OES_texture_float_linear"),k.OES_texture_float_linear={shim:!0}):m.push("OES_texture_float_linear"):c(f,f.FLOAT)?j.push("OES_texture_float_linear"):m.push("OES_texture_float_linear")),g=f.getExtension("OES_texture_half_float"),null===g?e(f,36193)?(h=!0,j.push("OES_texture_half_float"),g=k.OES_texture_half_float={HALF_FLOAT_OES:36193,shim:!0}):(h=!1,m.push("OES_texture_half_float")):e(f,g.HALF_FLOAT_OES)?(h=!0,j.push("OES_texture_half_float")):(h=!1,m.push("OES_texture_half_float")),h)?(d=f.getExtension("EXT_color_buffer_half_float"),null===d?b(f,g.HALF_FLOAT_OES)?(j.push("EXT_color_buffer_half_float"),k.EXT_color_buffer_half_float={shim:!0,RGBA16F_EXT:34842,RGB16F_EXT:34843,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):m.push("EXT_color_buffer_half_float"):b(f,g.HALF_FLOAT_OES)?j.push("EXT_color_buffer_half_float"):m.push("EXT_color_buffer_half_float"),d=f.getExtension("OES_texture_half_float_linear"),null===d?c(f,g.HALF_FLOAT_OES)?(j.push("OES_texture_half_float_linear"),k.OES_texture_half_float_linear={shim:!0}):m.push("OES_texture_half_float_linear"):c(f,g.HALF_FLOAT_OES)?j.push("OES_texture_half_float_linear"):m.push("OES_texture_half_float_linear")):void 0},null!=a.WebGLRenderingContext){for(d(),n={},o=0,p=m.length;p>o;o++)i=m[o],n[i]=!0;return g=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(a){var b;return b=k[a],void 0===b?n[a]?null:g.call(this,a):b},h=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var a,b,c,d,e,f,g;for(c=h.call(this),b=[],d=0,f=c.length;f>d;d++)a=c[d],void 0===n[a]&&b.push(a);for(e=0,g=j.length;g>e;e++)a=j[e],l.call(b,a)<0&&b.push(a);return b},WebGLRenderingContext.prototype.getFloatExtension=function(a){var b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(null==a.prefer&&(a.prefer=["half"]),null==a.require&&(a.require=[]),null==a["throws"]&&(a["throws"]=!0),p=this.getExtension("OES_texture_float"),g=this.getExtension("OES_texture_half_float"),n=this.getExtension("WEBGL_color_buffer_float"),e=this.getExtension("EXT_color_buffer_half_float"),o=this.getExtension("OES_texture_float_linear"),f=this.getExtension("OES_texture_half_float_linear"),m={texture:null!==p,filterable:null!==o,renderable:null!==n,score:0,precision:"single",half:!1,single:!0,type:this.FLOAT},d={texture:null!==g,filterable:null!==f,renderable:null!==e,score:0,precision:"half",half:!0,single:!1,type:null!=(z=null!=g?g.HALF_FLOAT_OES:void 0)?z:null},c=[],m.texture&&c.push(m),d.texture&&c.push(d),l=[],r=0,u=c.length;u>r;r++){for(b=c[r],q=!0,A=a.require,s=0,v=A.length;v>s;s++)i=A[s],b[i]===!1&&(q=!1);q&&l.push(b)}for(t=0,w=l.length;w>t;t++)for(b=l[t],B=a.prefer,h=y=0,x=B.length;x>y;h=++y)k=B[h],j=Math.pow(2,a.prefer.length-h-1),b[k]&&(b.score+=j);if(l.sort(function(a,b){return a.score===b.score?0:a.score<b.score?1:a.score>b.score?-1:void 0}),0===l.length){if(a["throws"])throw"No floating point texture support that is "+a.require.join(", ");return null}return l=l[0],{filterable:l.filterable,renderable:l.renderable,type:l.type,precision:l.precision}}}},i(),j(),e=function(){function a(a,b){var c,d;this.gl=a,d=b.vertex,c=b.fragment,this.program=this.gl.createProgram(),this.vs=this.gl.createShader(this.gl.VERTEX_SHADER),this.fs=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vs),this.gl.attachShader(this.program,this.fs),this.compileShader(this.vs,d),this.compileShader(this.fs,c),this.link(),this.value_cache={},this.uniform_cache={},this.attribCache={}}return a.prototype.attribLocation=function(a){var b;return b=this.attribCache[a],void 0===b&&(b=this.attribCache[a]=this.gl.getAttribLocation(this.program,a)),b},a.prototype.compileShader=function(a,b){if(this.gl.shaderSource(a,b),this.gl.compileShader(a),!this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS))throw"Shader Compile Error: "+this.gl.getShaderInfoLog(a)},a.prototype.link=function(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw"Shader Link Error: "+this.gl.getProgramInfoLog(this.program)},a.prototype.use=function(){return this.gl.useProgram(this.program),this},a.prototype.uniformLoc=function(a){var b;return b=this.uniform_cache[a],void 0===b&&(b=this.uniform_cache[a]=this.gl.getUniformLocation(this.program,a)),b},a.prototype["int"]=function(a,b){var c,d;return c=this.value_cache[a],c!==b&&(this.value_cache[a]=b,d=this.uniformLoc(a),d&&this.gl.uniform1i(d,b)),this},a.prototype.vec2=function(a,b,c){var d;return d=this.uniformLoc(a),d&&this.gl.uniform2f(d,b,c),this},a.prototype["float"]=function(a,b){var c,d;return c=this.value_cache[a],c!==b&&(this.value_cache[a]=b,d=this.uniformLoc(a),d&&this.gl.uniform1f(d,b)),this},a}(),b=function(){function a(a){this.gl=a,this.buffer=this.gl.createFramebuffer()}return a.prototype.destroy=function(){return this.gl.deleteFRamebuffer(this.buffer)},a.prototype.bind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer),this},a.prototype.unbind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this},a.prototype.check=function(){var a;switch(a=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER)){case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}return this},a.prototype.color=function(a){return this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,a.target,a.handle,0),this.check(),this},a.prototype.depth=function(a){return this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,a.id),this.check(),this},a.prototype.destroy=function(){return this.gl.deleteFramebuffer(this.buffer)},a}(),f=function(){function a(a,b){var c,d;switch(this.gl=a,null==b&&(b={}),this.channels=this.gl[(null!=(c=b.channels)?c:"rgba").toUpperCase()],"number"==typeof b.type?this.type=b.type:this.type=this.gl[(null!=(d=b.type)?d:"unsigned_byte").toUpperCase()],this.channels){case this.gl.RGBA:this.chancount=4;break;case this.gl.RGB:this.chancount=3;break;case this.gl.LUMINANCE_ALPHA:this.chancount=2;break;default:this.chancount=1}this.target=this.gl.TEXTURE_2D,this.handle=this.gl.createTexture()}return a.prototype.destroy=function(){return this.gl.deleteTexture(this.handle)},a.prototype.bind=function(a){if(null==a&&(a=0),a>15)throw"Texture unit too large: "+a;return this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.target,this.handle),this},a.prototype.setSize=function(a,b){return this.width=a,this.height=b,this.gl.texImage2D(this.target,0,this.channels,this.width,this.height,0,this.channels,this.type,null),this},a.prototype.upload=function(a){return this.width=a.width,this.height=a.height,this.gl.texImage2D(this.target,0,this.channels,this.channels,this.type,a),this},a.prototype.linear=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this},a.prototype.nearest=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this},a.prototype.clampToEdge=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this},a.prototype.repeat=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this},a}(),d=function(){function a(a,c,d){var e;this.gl=a,this.width=c,this.height=d,e=this.gl.getFloatExtension({require:["renderable"]}),this.texture=new f(this.gl,{type:e.type}).bind(0).setSize(this.width,this.height).nearest().clampToEdge(),this.fbo=new b(this.gl).bind().color(this.texture).unbind()}return a.prototype.use=function(){return this.fbo.bind()},a.prototype.bind=function(a){return this.texture.bind(a)},a.prototype.end=function(){return this.fbo.unbind()},a.prototype.resize=function(a,b){return this.width=a,this.height=b,this.texture.bind(0).setSize(this.width,this.height)},a}(),k="attribute vec4 position;\nvarying vec2 texcoord;\nvoid main(){\n    texcoord = position.xy*0.5+0.5;\n    gl_Position = position;\n}",h="#ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp int;\n    precision highp float;\n#else\n    precision mediump int;\n    precision mediump float;\n#endif\nuniform sampler2D source;\nvarying vec2 texcoord;",c=function(){function a(a,b,c,f){var g,i,j;for(this.heatmap=a,this.gl=b,this.width=c,this.height=f,this.shader=new e(this.gl,{vertex:"attribute vec4 position, intensity;\nvarying vec2 off, dim;\nvarying float vIntensity;\nuniform vec2 viewport;\n\nvoid main(){\n    dim = abs(position.zw);\n    off = position.zw;\n    vec2 pos = position.xy + position.zw;\n    vIntensity = intensity.x;\n    gl_Position = vec4((pos/viewport)*2.0-1.0, 0.0, 1.0);\n}",fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp int;\n    precision highp float;\n#else\n    precision mediump int;\n    precision mediump float;\n#endif\n varying vec2 off, dim;\n varying float vIntensity;\nvoid main(){\n    float falloff = (1.0 - smoothstep(0.0, 1.0, length(off/dim)));\n    float intensity = falloff*vIntensity;\n     gl_FragColor = vec4(intensity,0.0,0,1.0);\n }"}),this.clampShader=new e(this.gl,{vertex:k,fragment:h+"uniform float low, high;\nvoid main(){\n    gl_FragColor = vec4(clamp(texture2D(source, texcoord).rgb, low, high), 1.0);\n}"}),this.multiplyShader=new e(this.gl,{vertex:k,fragment:h+"uniform float value;\nvoid main(){\n    gl_FragColor = vec4(texture2D(source, texcoord).rgb*value, 1.0);\n}"}),this.blurShader=new e(this.gl,{vertex:k,fragment:h+"uniform vec2 viewport;\nvoid main(){\n    vec4 result = vec4(0.0);\n    for(int x=-1; x<=1; x++){\n        for(int y=-1; y<=1; y++){\n            vec2 off = vec2(x,y)/viewport;\n            //float factor = 1.0 - smoothstep(0.0, 1.5, length(off));\n            float factor = 1.0;\n            result += vec4(texture2D(source, texcoord+off).rgb*factor, factor);\n        }\n    }\n    gl_FragColor = vec4(result.rgb/result.w, 1.0);\n}"}),this.nodeBack=new d(this.gl,this.width,this.height),this.nodeFront=new d(this.gl,this.width,this.height),this.vertexBuffer=this.gl.createBuffer(),this.vertexSize=8,this.maxPointCount=10240,this.vertexBufferData=new Float32Array(this.maxPointCount*this.vertexSize*6),this.vertexBufferViews=[],g=i=0,j=this.maxPointCount;j>=0?j>i:i>j;g=j>=0?++i:--i)this.vertexBufferViews.push(new Float32Array(this.vertexBufferData.buffer,0,g*this.vertexSize*6));this.bufferIndex=0,this.pointCount=0}return a.prototype.resize=function(a,b){return this.width=a,this.height=b,this.nodeBack.resize(this.width,this.height),this.nodeFront.resize(this.width,this.height)},a.prototype.update=function(){var a,b;return this.pointCount>0?(this.gl.enable(this.gl.BLEND),this.nodeFront.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexBufferViews[this.pointCount],this.gl.STREAM_DRAW),b=this.shader.attribLocation("position"),a=this.shader.attribLocation("intensity"),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(b,4,this.gl.FLOAT,!1,32,0),this.gl.vertexAttribPointer(a,4,this.gl.FLOAT,!1,32,16),this.shader.use().vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6*this.pointCount),this.gl.disableVertexAttribArray(1),this.pointCount=0,this.bufferIndex=0,this.nodeFront.end(),this.gl.disable(this.gl.BLEND)):void 0},a.prototype.clear=function(){return this.nodeFront.use(),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.nodeFront.end()},a.prototype.clamp=function(a,b){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.clampShader.use()["int"]("source",0)["float"]("low",a)["float"]("high",b),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},a.prototype.multiply=function(a){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.multiplyShader.use()["int"]("source",0)["float"]("value",a),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},a.prototype.blur=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.blurShader.use()["int"]("source",0).vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},a.prototype.swap=function(){var a;return a=this.nodeFront,this.nodeFront=this.nodeBack,this.nodeBack=a},a.prototype.addVertex=function(a,b,c,d,e){return this.vertexBufferData[this.bufferIndex++]=a,this.vertexBufferData[this.bufferIndex++]=b,this.vertexBufferData[this.bufferIndex++]=c,this.vertexBufferData[this.bufferIndex++]=d,this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=e},a.prototype.addPoint=function(a,b,c,d){var e,f;return null==c&&(c=50),null==d&&(d=.2),
this.pointCount>=this.maxPointCount-1&&this.update(),b=this.height-b,e=c/2,f=c/2,this.addVertex(a,b,-e,-f,d),this.addVertex(a,b,+e,-f,d),this.addVertex(a,b,-e,+f,d),this.addVertex(a,b,-e,+f,d),this.addVertex(a,b,+e,-f,d),this.addVertex(a,b,+e,+f,d),this.pointCount+=1},a}(),g=function(){function b(b){var d,g,i,j,l,m,n,o,p,q,r,s,t,u;s=null!=b?b:{},this.canvas=s.canvas,this.width=s.width,this.height=s.height,o=s.intensityToAlpha,m=s.gradientTexture,g=s.alphaRange,u=s.bgColor,this.canvas||(this.canvas=document.createElement("canvas"));try{if(this.gl=this.canvas.getContext("experimental-webgl",{depth:!1,antialias:!1,preserveDrawingBuffer:!0}),null===this.gl&&(this.gl=this.canvas.getContext("webgl",{depth:!1,antialias:!1,preserveDrawingBuffer:!0}),null===this.gl))throw"WebGL not supported"}catch(v){throw j=v,"WebGL not supported"}null!=a.WebGLDebugUtils&&(console.log("debugging mode"),this.gl=WebGLDebugUtils.makeDebugContext(this.gl,function(a,b,c){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to: "+b})),this.gl.enableVertexAttribArray(0),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),m?(r=this.gradientTexture=new f(this.gl,{channels:"rgba"}).bind(0).setSize(2,2).nearest().clampToEdge(),"string"==typeof m?(n=new Image,n.onload=function(){return r.bind().upload(n)},n.src=m):m.width>0&&m.height>0?r.upload(m):m.onload=function(){return r.upload(m)},l="uniform sampler2D gradientTexture;\nvec3 getColor(float intensity){\n    return texture2D(gradientTexture, vec2(intensity, 0.0)).rgb;\n}"):(r=null,l="vec3 getColor(float intensity){\n",l+=u?" vec3 blue = vec3("+parseInt(u.r||0)+", "+parseInt(u.g||0)+", "+parseInt(u.b||0)+");\n":"    vec3 blue = vec3(0.0, 0.0, 1.0);\n",l+="    vec3 cyan = vec3(0.0, 1.0, 1.0);\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    vec3 yellow = vec3(1.0, 1.0, 0.0);\n    vec3 red = vec3(1.0, 0.0, 0.0);\n\n    vec3 color = (\n        fade(-0.25, 0.25, intensity)*blue +\n        fade(0.0, 0.5, intensity)*cyan +\n        fade(0.25, 0.75, intensity)*green +\n        fade(0.5, 1.0, intensity)*yellow +\n        smoothstep(0.75, 1.0, intensity)*red\n    );\n    return color;\n}"),null==o&&(o=!0),o?(t=null!=g?g:[0,1],i=t[0],d=t[1],p="vec4 alphaFun(vec3 color, float intensity){\n    float alpha = smoothstep("+i.toFixed(8)+", "+d.toFixed(8)+", intensity);\n    return vec4(color*alpha, alpha);\n }"):p="vec4 alphaFun(vec3 color, float intensity){\n    return vec4(color, 1.0);\n }",this.shader=new e(this.gl,{vertex:k,fragment:h+("float linstep(float low, float high, float value){\n    return clamp((value-low)/(high-low), 0.0, 1.0);\n}\n\n float fade(float low, float high, float value){\n    float mid = (low+high)*0.5;\n    float range = (high-low)*0.5;\n    float x = 1.0 - clamp(abs(mid-value)/range, 0.0, 1.0);\n    return smoothstep(0.0, 1.0, x);\n}\n\n"+l+"\n"+p+"\n\n void main(){\n     float intensity = smoothstep(0.0, 1.0, texture2D(source, texcoord).r);\n    vec3 color = getColor(intensity);\n     gl_FragColor = alphaFun(color, intensity);\n }")}),null==this.width&&(this.width=this.canvas.offsetWidth||2),null==this.height&&(this.height=this.canvas.offsetHeight||2),this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.quad=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),q=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,-1,1,0,1,1,-1,0,1,1,1,0,1]),this.gl.bufferData(this.gl.ARRAY_BUFFER,q,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.heights=new c(this,this.gl,this.width,this.height)}return b.prototype.adjustSize=function(){var a,b;return b=this.canvas.offsetWidth||2,a=this.canvas.offsetHeight||2,this.width!==b||this.height!==a?(this.gl.viewport(0,0,b,a),this.canvas.width=b,this.canvas.height=a,this.width=b,this.height=a,this.heights.resize(this.width,this.height)):void 0},b.prototype.display=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.heights.nodeFront.bind(0),this.gradientTexture&&this.gradientTexture.bind(1),this.shader.use()["int"]("source",0)["int"]("gradientTexture",1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},b.prototype.update=function(){return this.heights.update()},b.prototype.clear=function(){return this.heights.clear()},b.prototype.clamp=function(a,b){return null==a&&(a=0),null==b&&(b=1),this.heights.clamp(a,b)},b.prototype.multiply=function(a){return null==a&&(a=.95),this.heights.multiply(a)},b.prototype.blur=function(){return this.heights.blur()},b.prototype.addPoint=function(a,b,c,d){return this.heights.addPoint(a,b,c,d)},b.prototype.addPoints=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addPoint(b.x,b.y,b.size,b.intensity));return e},b}(),a.createWebGLHeatmap=function(a){return new g(a)}}(a);var V=function(a){a||(a={}),this.radius=a.radius||10,this.maxValue=a.maxValue||1,this.minValue=a.minValue||0,this.width=a.width||100,this.height=a.height||100,this.intensityToAlpha=a.intensityToAlpha||!1,this.alphaRange=a.alphaRange||[0,1],this.gradientTexture=a.gradientTexture,this.canvasHeight=100,this.canvasWidth=parseInt(this.canvasHeight*this.width/this.height),this.positionX=a.positionX==b?this.width/2:parseFloat(a.positionX),this.positionY=a.positionY==b?this.height/2:parseFloat(a.positionY),this.heatmap=createWebGLHeatmap({canvas:null,width:this.canvasWidth,height:this.canvasHeight,intensityToAlpha:this.intensityToAlpha,alphaRange:this.alphaRange,gradientTexture:this.gradientTexture,bgColor:a.bgColor})};mono.extend(V,Object,{createHeatMap:function(){},_getOriginal:function(){var a=this.positionX-this.width/2,b=this.height/2+this.positionY;return{x:a,y:b}},_getOriginalX:function(){return this.positionX-this.width/2},_getOriginalY:function(){return this.height/2+this.positionY},_transPositionX:function(a){return(parseFloat(a)-this._getOriginalX())*(this.canvasWidth/this.width)},_transPositionY:function(a){return(this._getOriginalY()-parseFloat(a))*(this.canvasHeight/this.height)},_transWidth:function(a){var b=parseFloat(a);return 0>=b?0:b*this.canvasWidth/this.width},_transHeight:function(a){var b=parseFloat(a);return 0>=b?0:b*this.canvasHeight/this.height},_generateNearPointsForArea:function(a,b,c,d,e){if(c&&d){var f=3*parseInt(c*d),g=a-c/2,h=b-d/2;if(!(0>g||0>h))for(var i=0,j=5;f>i;){var k=(2*Math.random()-1)*(j+c/2),l=(2*Math.random()-1)*(j+d/2),m=0,n=0;m=a+k,n=b+l,m>g&&g+c>m&&n>h&&h+d>n||(this.heatmap.addPoint(m,n,this.radius/2,e/30),i++)}}},addPointWithArea:function(a){if(a)if(a instanceof Array&&a.length>0)for(var b=0;b<a.length;b++)arguments.callee(a[b]);else a.type&&"circle"===a.type?this._createCircleCloud(a):this._createRectCloud(a)},_createCircleCloud:function(a){if(a){parseFloat(a.x)||0,parseFloat(a.y)||0,parseFloat(a.radius)||0}},_createRectCloud:function(a){if(a){var b=parseFloat(a.x)||0,c=parseFloat(a.y)||0,d=parseFloat(a.w)||0,e=parseFloat(a.l)||0,f=parseFloat(a.value)||0,g=a.axis;if(d=this._transWidth(d),e=this._transHeight(e),g&&"z"==g){var h=e;e=d,d=h}if(!d&&!e)return void this.addPoint(b,c,f);e||(e=d),d||(d=e);var i=this._transPositionX(b),j=this._transPositionY(c);this._generatePointsForArea(i,j,d,e,f)}},_generatePointsForArea:function(a,b,c,d,e){if(c&&d)for(var f=a-c/2,g=b-d/2,h=0,i=parseInt(c*d),j=1,k=1;i>h&&(j>=c&&(j=1,k++),!(j>=c&&k>=d));){var l=f+j,m=g+k;this.heatmap.addPoint(l,m,this.radius,e/20),j++,h++}},_generatePointsForArea_for_random:function(a,b,c,d,e){if(c&&d){c+=5,d+=5;for(var f=a-c/2,g=b-d/2,h=0,i=parseInt(c*d);i>h;){var j=f+Math.random()*c,k=g+Math.random()*d;this.heatmap.addPoint(j,k,this.radius,e/30),h++}}},_paintAtCoord:function(a,b,c){for(var d=0;d<2*this.radius;){var e=2*Math.random()-1,f=2*Math.random()-1,g=e*e+f*f;if(!(g>1)){var h=Math.sqrt(g);e/=h,f/=h,e*=1-g,f*=1-g,d+=1,this.heatmap.addPoint(a+e*this.radius*2,b+f*this.radius*2,this.radius,c/10)}}},addPoint:function(a,b,c,d){a=this._transPositionX(a),b=this._transPositionY(b);for(var e=0;20>e;){var f=2*Math.random()-1,g=2*Math.random()-1,h=f*f+g*g;if(!(h>1)){var i=Math.sqrt(h);f/=i,g/=i,f*=1-h,g*=1-h,e+=1,this.heatmap.addPoint(a+10*f,b+5*g,this.radius,c/20)}}},addPoint1:function(a,c,d,e){a=this._transPositionX(a),c=this._transPositionY(c),null!=d&&d!=b&&(d=(parseFloat(d)-this.minValue)/(this.maxValue-this.minValue),0>d&&(d=0)),e?this.heatmap.addPoint(a,c,e,d):this._paintAtCoord(a,c,d)},update:function(){this.heatmap.adjustSize(),this.heatmap.update(),this.heatmap.display()},refresh:function(b){var c=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,d=this;c(function(){document.body.appendChild(d.heatmap.canvas),d.update(),b&&b()})},clear:function(){this.heatmap.clear()},getCanvas:function(){return this.heatmap.canvas},getImage:function(){return this.heatmap.canvas?this.heatmap.canvas.toDataURL():void console.log("getImage error!")},getTemperatureBoard:function(){var a=new mono.Plane(this.width,this.height);a.setStyle("m.texture.repeat",new mono.Vec2(1,1)).setStyle("m.type","basic").setStyle("m.side","both"),a.setRotation(90*Math.PI/180,0,0);var b=this;return this.refresh(function(){a.setStyle("m.texture.image",b.getImage()),document.body.removeChild(b.heatmap.canvas)}),a.setPositionX(this.positionX),a.setPositionZ(this.positionY),a}}),c.HeatMap3D=V;var W=function(a){if(this.defaultOptions={gradientColors:["rgba(0, 102, 255, 0.9)","cyan","lime","yellow","red"],minAlpha:.05,valueScale:1,opacity:1,positionX:null,positionY:null,width:500,height:500,canvasHeight:500,blurSize:30,withBg:!0},this.option=a,a)for(var c in this.defaultOptions)a[c]!==b?this.option[c]=a[c]:this.option[c]=this.defaultOptions[c];else this.option=this.defaultOptions;this.datas=[],this.heatMapCanvas=document.createElement("canvas"),this.width=this.option.width,this.height=this.option.height,this.canvasHeight=this.option.canvasHeight,this.canvasWidth=this.option.canvasWidth=parseInt(this.canvasHeight*this.width/this.height),this.positionX=this.option.positionX==b?this.width/2:parseFloat(this.option.positionX),this.positionY=this.option.positionY==b?this.height/2:parseFloat(this.option.positionY),this.BRUSH_SIZE=40*this.canvasHeight/this.height,this.GRADIENT_LEVELS=256,this.withBg=this.option.withBg};mono.extend(W,Object,{addPoint:function(a,b,c){if(1===arguments.length&&arguments[0]instanceof Array){var d=arguments[0];a=d[0],b=d[1],c=d[2]}a=this._transPositionX(a),b=this._transPositionY(b),this.datas.push([a,b,c])},addPointWithArea:function(a){if(a)if(a instanceof Array&&a.length>0)for(var b=0;b<a.length;b++)arguments.callee(a[b]);else this._createRectCloud(a)},_createRectCloud:function(a){if(a){var b=parseFloat(a.x)||0,c=parseFloat(a.y)||0,d=parseFloat(a.w)||0,e=parseFloat(a.l)||0,f=parseFloat(a.value)||0,g=a.axis;if(d=this._transWidth(d),e=this._transHeight(e),g&&"z"==g){var h=e;e=d,d=h}if(!d&&!e)return void this.addPoint(b,c,f);e||(e=d),d||(d=e);var i=this._transPositionX(b),j=this._transPositionY(c);this._generatePointsForArea(i,j,d,e,f)}},_generatePointsForArea:function(a,b,c,d,e){if(c&&d){var f=this.BRUSH_SIZE,g=parseInt(c/f),h=parseInt(d/f);g%2===0&&(g+=1),h%2===0&&(h+=1);var i=0,j=0;g>5&&(i=1,g+=i),h>5&&(j=1,h+=j);for(var k=a,l=b,m=0;h>m;m++)for(var n=l+Math.pow(-1,m)*m/2*f,o=0;g>o;o++){var p=k+Math.pow(-1,o)*o/2*f;0===o&&(p=k);var q=1;(i>=g-o||j>h-m)&&(q=.3),this.datas.push([p,n,e*q*Math.random()])}}},getCanvas:function(){var a=this.datas,b=this.canvasWidth,c=this.canvasHeight,d=this._createBrush(),e=this._createGradient(),f=this.BRUSH_SIZE+this.option.blurSize,g=this.heatMapCanvas;g.width=b,g.height=c;for(var h=g.getContext("2d"),i=a.length,j=0;i>j;++j){var k=a[j],l=k[0],m=k[1],n=k[2],o=Math.min(1,Math.max(n*this.option.valueScale||this.option.minAlpha,this.option.minAlpha));h.globalAlpha=o,h.drawImage(d,l-f,m-f)}for(var p=h.getImageData(0,0,g.width,g.height),q=p.data,i=q.length/4;i--;){var r=4*i+3,o=q[r]/256,s=Math.floor(o*(this.GRADIENT_LEVELS-1));q[r-3]=e[4*s],q[r-2]=e[4*s+1],q[r-1]=e[4*s+2],this.withBg?q[r]=190:q[r]*=this.option.opacity}return h.putImageData(p,0,0),g},_createBrush:function(){if(!this._brushCanvas){this._brushCanvas=document.createElement("canvas");var a=this.BRUSH_SIZE+this.option.blurSize,b=2*a;this._brushCanvas.width=b,this._brushCanvas.height=b;var c=this._brushCanvas.getContext("2d");c.shadowOffsetX=b,c.shadowBlur=this.option.blurSize,c.shadowColor="black",c.beginPath(),c.arc(-a,a,this.BRUSH_SIZE,0,2*Math.PI,!0),c.closePath(),c.fill()}return this._brushCanvas},_createGradient:function(){if(!this._gradientPixels){var a=this.GRADIENT_LEVELS,b=document.createElement("canvas");b.width=1,b.height=a;for(var c=b.getContext("2d"),d=c.createLinearGradient(0,0,0,a),e=this.option.gradientColors.length,f=0;e>f;++f)"string"==typeof this.option.gradientColors[f]?d.addColorStop((f+1)/e,this.option.gradientColors[f]):d.addColorStop(this.option.gradientColors[f].offset,this.option.gradientColors[f].color);c.fillStyle=d,c.fillRect(0,0,1,a),this._gradientPixels=c.getImageData(0,0,1,a).data}return this._gradientPixels},_getOriginal:function(){var a=this.positionX-this.width/2,b=this.height/2+this.positionY;return{x:a,y:b}},_getOriginalX:function(){return this.positionX-this.width/2},_getOriginalY:function(){return this.height/2+this.positionY},_transPositionX:function(a){return(parseFloat(a)-this._getOriginalX())*(this.canvasWidth/this.width)},_transPositionY:function(a){return(this._getOriginalY()-parseFloat(a))*(this.canvasHeight/this.height)},_transWidth:function(a){var b=parseFloat(a);return 0>=b?0:b*this.canvasWidth/this.width},_transHeight:function(a){var b=parseFloat(a);return 0>=b?0:b*this.canvasHeight/this.height},clear:function(){this.datas=[]},refresh:function(b){var c=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,d=this;c(function(){document.body.appendChild(d.getCanvas()),b&&b()})},getImage:function(){return this.heatMapCanvas?this.heatMapCanvas.toDataURL():void console.log("getImage error!")},getTemperatureBoard:function(){var a=new mono.Plane(this.width,this.height);a.setStyle("m.texture.repeat",new mono.Vec2(1,1)).setStyle("m.type","basic").setStyle("m.side","both"),this.withBg||(a.setStyle("m.transparent",!0),a.setStyle("m.type","phong")),a.setRotation(90*Math.PI/180,0,0);var b=this;return this.refresh(function(){a.setStyle("m.texture.image",b.heatMapCanvas),document.body.removeChild(b.heatMapCanvas)}),a.setPositionX(this.positionX),a.setPositionZ(this.positionY),a}}),c.HeatMap=W;var X=function(a){this.sceneManager=a,this.dataManager=this.sceneManager.dataManager,this.dataPowerMap={},this.virtualLevel=new c.VirtualManager(this.sceneManager),this.visibleLevel=new c.VisibleManager(this.sceneManager),this.initDrmListener(),this._dRMManagerChangeDispatcher=new mono.EventDispatcher,this.registerDRM()};mono.extend(X,Object,{registerDRM:function(){this.addDRMChangeListener(this.drmListener),this.sceneManager.viewManager3d.addVisibleFilter(this.visibleLevel),this.sceneManager.viewManager3d.addMaterialFilter(this.virtualLevel)},unRegister:function(){this.removeDRMChangeListener(this.drmListener),this.sceneManager.viewManager3d.removeVisibleFilter(this.visibleLevel),this.sceneManager.viewManager3d.removeMaterialFilter(this.virtualLevel)},initDrmListener:function(){var a=this;this.drmListener=function(b){var c=b.kind,d=b.dataId,e=b.oldLevel,f=b.newLevel;c&&("add"==c?a._addOrUpdateAction(d,e,f):"remove"==c?a._removeAction(d,e,f):"clear"==c&&a._clearAction())}},_addOrUpdateAction:function(a,b,c){if(a){var d=this.dataManager.getDataById(a),e=this.getParentLevel(d)||0;c>=e&&(1==c?this.setLevel1ForData(d):2==c?this.setLevel2ForData(d):3==c?this.setLevel3ForData(d):this.setLevel0ForData(d),this.sceneManager.viewManager3d.clearVisibleMap())}},getParentLevel:function(a){if(!a)return 0;var d=null;if(d=a instanceof c.Data?a:this.dataManager.getDataById(a),!d)return 0;var e=this.dataManager.getDataById(d.getParentId());if(!e)return 0;if(this.dataPowerMap[e.getId()]!=b){var f=this.dataPowerMap[e.getId()];if(3==f)return 3;var g=this.getParentLevel(e,this);return g>f?g:f}return this.getParentLevel(e,this)},setLevel1ForData:function(a){if(a){this._removeFromLevel3(a),this._removeFromLevel2(a),this.virtualLevel.add(a);var b=a.getChildren();if(b&&b.size()>0)for(var c=0;c<b.size();c++){var d=b.get(c),e=this.dataPowerMap[d.getId()];d&&(!e||1>=e)?this.setLevel1ForData(d,this):2==e?this.setLevel2ForData(d,this):3==e&&this.setLevel3ForData(d,this)}}},setLevel2ForData:function(a){if(a){this._removeFromLevel3(a),this.visibleLevel.setVisible(a,!1);var b=a.getChildren();if(b&&b.size()>0)for(var c=0;c<b.size();c++){var d=b.get(c),e=this.dataPowerMap[d.getId()];d&&(!e||2>=e)?this.setLevel2ForData(d,this):3==e&&this.setLevel3ForData(d,this)}}},setLevel3ForData:function(a){},setLevel0ForData:function(a){if(a){this._removeFromLevel3(a),this._removeFromLevel2(a),this._removeFromLevel1(a);var b=a.getChildren();if(b&&b.size()>0)for(var c=0;c<b.size();c++){var d=b.get(c),e=this.dataPowerMap[d.getId()];d&&!e?this.setLevel0ForData(d,this):1==e?this.setLevel1ForData(d,this):2==e?this.setLevel2ForData(d,this):3==e&&this.setLevel3ForData(d,this)}}},_removeFromLevel3:function(a){},_removeFromLevel2:function(a){this.visibleLevel.setVisible(a,!0)},_removeFromLevel1:function(a){this.virtualLevel.remove(a)},_removeFromLevel0:function(a){},_clearLevel3:function(){},_clearLevel2:function(){this.visibleLevel.clear()},_clearLevel1:function(){this.virtualLevel.clearAll()},_clearLevel0:function(){},_removeAction:function(a,b){if(a){var c=this.dataManager.getDataById(a),d=this.getParentLevel(c)||0;b>d&&(1==d?this.setLevel1ForData(c):2==d?this.setLevel2ForData(c):3==d?this.setLevel3ForData(c):this.setLevel0ForData(c),this.sceneManager.viewManager3d.clearVisibleMap())}},_clearAction:function(){this._clearLevel0(),this._clearLevel1(),this._clearLevel2(),this._clearLevel3(),this.sceneManager.viewManager3d.clearVisibleMap()},initDefaultLevel:function(a){var b=this.dataManager._dataMap;for(var c in b)this._addOrUpdateAction(c,null,a)},update:function(a,d){if(a){(null==d||d==b)&&console.log("please input right powerLevel, like 0,1,2,3");var e=a;a instanceof c.Data&&(e=a.getId());var f=this.dataPowerMap[e];this.dataPowerMap[e]=d,this._dRMManagerChangeDispatcher.fire({kind:"add",dataId:e,oldLevel:f,newLevel:d})}},remove:function(a){if(a){var d=a;if(a instanceof c.Data&&(d=a.getId()),this.dataPowerMap[d]!=b){var e=this.dataPowerMap[d];delete this.dataPowerMap[d],this._dRMManagerChangeDispatcher.fire({kind:"remove",dataId:d,oldLevel:e})}}},clear:function(){this.dataPowerMap={},this._dRMManagerChangeDispatcher.fire({kind:"clear"})},addDRMChangeListener:function(a,b,c){this._dRMManagerChangeDispatcher.add(a,b,c)},removeDRMChangeListener:function(a,b,c){this._dRMManagerChangeDispatcher.remove(a,b)}}),c.DRMManager=X,c.PopMenuManager=function(a){this.sceneManager=a,this.getMenuItemsFunction=null,this._initPopMenu()},mono.extend(c.PopMenuManager,Object,{_initPopMenu:function(){function a(){var a,e;c.getDataBox();d.onMenuShowing=function(f){e=f;var g=c.getFirstElementByMouseEvent(f,!1,function(a){var b=a.getClient("mainVisible"),c=Utils.isNotNull(b);return!c}),h=[];if(g){a=g.element;var i=main.sceneManager.getNodeData(a);h=b.getMenuItems(a,i,e,g)}else h=b.getMenuItems(null,null,e,null);return h&&h.length>0?(d.setMenuItems(h),!0):!1}}var b=this,c=this.sceneManager.network3d,d=this._popupMenu=new twaver.controls.PopupMenu(c.getRootView());d.setBackground("#90C3D4"),d.setBorder("2px solid #90C3D4");var e=d.show;d.show=function(a){e.call(this,a);var b=this._view,c=b.style;c.left=parseInt(c.left)+1+"px",c.top=parseInt(c.top)+1+"px"},a()},getPopupMenu:function(){return this._popupMenu},getMenuItems:function(a,b,c,d){return this.getMenuItemsFunction?this.getMenuItemsFunction(a,b,c,d):[]}})}(window);